<?xml version="1.0" encoding="UTF-8"?><bugzilla maintainer="bugzilla-admin@apache.org" urlbase="https://issues.apache.org/bugzilla/" version="4.4.2">

    <bug>
          <bug_id>372</bug_id>
          
          <creation_ts>2000-12-22 23:19:00 +0000</creation_ts>
          <short_desc>examples/ShowSource always reports "Invalid JSP file" due to logic error in ShowSource.java BugRat Report#661</short_desc>
          <delta_ts>2007-02-24 02:17:36 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Unknown</version>
          <rep_platform>PC</rep_platform>
          <op_sys>FreeBSD</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P1</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>0</everconfirmed>
          <reporter name="Tony Robertson">tony_robertson</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>347</commentid>
    <comment_count>0</comment_count>
    <who name="Tomcat Developers Mailing List">dev</who>
    <bug_when>2000-12-22 23:19:25 +0000</bug_when>
    <thetext>Within the source for the ShowSource tab from the examples
context, ie. the file installed at:
$(TOMCAT_HOME)\webapps\examples\WEB-INF\classes\examples\ShowSource.java,
lines 23 to 26 look like this:

if ((jspFile.indexOf( ".." ) &gt;= 0) ||
  (jspFile.toUpperCase().indexOf("/WEB-INF/") != 0) ||
  (jspFile.toUpperCase().indexOf("/META-INF/") != 0))
  throw new JspTagException("Invalid JSP file " + jspFile);

lines 24 and 25 should use "!= -1" rather than "!= 0"

This effects the "show source" links of all the
jsp examples that use the "ShowSource" tag.

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>2989</commentid>
    <comment_count>1</comment_count>
    <who name="Marc Saegesser">marc.saegesser</who>
    <bug_when>2001-06-14 08:26:25 +0000</bug_when>
    <thetext>Fixed in 3.2.3-dev and 3.3</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>99738</commentid>
    <comment_count>2</comment_count>
    <who name="Sachin Kumar">sachinxman</who>
    <bug_when>2007-02-24 02:17:36 +0000</bug_when>
    <thetext>Have you fixed the problem ??
sachinxman@gmail.com</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>2500</bug_id>
          
          <creation_ts>2001-07-08 10:08:00 +0000</creation_ts>
          <short_desc>FileNotFoundException from service() unintentionally caught</short_desc>
          <delta_ts>2007-08-04 11:19:18 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Shawn Bayern">bayern</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>3496</commentid>
    <comment_count>0</comment_count>
    <who name="Shawn Bayern">bayern</who>
    <bug_when>2001-07-08 10:08:25 +0000</bug_when>
    <thetext>In the service() method of org.apache.jasper.servlet.JspServlet, I believe the 
scope for which the 'catch FileNotFoundException' block applies is too great;
if a FileNotFoundException is thrown from within the JSP page, the result is
an HTTP 404 error.  The calling code believes the JSP resource itself wasn't
found, when in fact the exception should be treated as internal to the page.
(You can test with

   &lt;% if (1==1) throw new java.io.FileNotFoundException(); %&gt;

I noticed this problem when debugging the code of a colleague, Shawn Douglas,
whose component logic called by the JSP page threw a FileNotFoundException.)

The offending code seems to be:

           try {
                loadIfNecessary(request, response);

                // If a page is to only to be precompiled return.
                if (precompile)
                    return;

                if (theServlet instanceof SingleThreadModel) {
                    // sync on the wrapper so that the freshness
                    // of the page is determined right before servicing
                    synchronized (this) {
                        theServlet.service(request, response);
                    }
                } else {
                    theServlet.service(request, response);
                }

            } catch (FileNotFoundException ex) {

                    ...

but I haven't had the time to look at it thoroughly.  I believe this affects 
Tomcat 3.x as well.  The necessary fix should just be to narrow the scope
of the 'catch' block, but I haven't had a chance to think that through 
completely or test it.  (Sorry! :-) )</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>3605</commentid>
    <comment_count>1</comment_count>
    <who name="Craig McClanahan">craig.mcclanahan</who>
    <bug_when>2001-07-10 17:48:14 +0000</bug_when>
    <thetext>It seems to me that Jasper is doing the right thing -- if the application wants
to use FileNotFoundException internal to a page, it should swallow that
exception instead of allowing it to propogate back to the container.

Maybe there should be some spec-based description of how exceptions thrown by
JSP page components should be handled?
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>3699</commentid>
    <comment_count>2</comment_count>
    <who name="Craig McClanahan">craig.mcclanahan</who>
    <bug_when>2001-07-12 18:23:51 +0000</bug_when>
    <thetext>Changing to an "enhancement" request since this is a non-spec issue.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>35199</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-04-15 15:28:44 +0000</bug_when>
    <thetext>At this point, this will not be fixed (if still present in Jasper 2).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>100103</commentid>
    <comment_count>4</comment_count>
    <who name="Jonathan Leech">jleech</who>
    <bug_when>2007-03-06 13:27:01 +0000</bug_when>
    <thetext>I disagree with Remy and Craig, and I think if you polled 10 developers, 11 of
them would call this a bug.

The specification pretty clearly lays out what is to happen when a .jsp page
throws an Exception:

public abstract void handlePageException(java.lang.Throwable t)
This method is intended to process an unhandled ’page’ level exception by
forwarding the exception to the specified error page for this JSP. If forwarding
is not possible (for example because the response has already been committed),
an implementation dependent mechanism should be used to invoke
the error page (e.g. “including” the error page instead).
If no error page is defined in the page, the exception should be rethrown so
that the standard servlet error handling takes over.

In this case, if I specifically define an error page for the .jsp, it is
invoked, and the 404 error is not reported - Hurray!

However, contrary to the spec, if an error page isn't defined, the standard
servlet error handling doesn't take over.  For example, defining the following
in web.xml, according to the servlet spec, dictates that the given error page
should be invoked when a FileNotFoundException is thrown:
&lt;error-page&gt;
   &lt;exception-type&gt;java.io.FileNotFoundException&lt;/exception-type&gt;
   &lt;location&gt;/error.jsp&lt;/location&gt;
&lt;/error-page&gt;

As the above doesn't happen, and a 404 error is displayed instead, this behavior
violates the spec and is a bug.  I am reopening it.  As it is still broken in
Tomcat5, I am putting that for the Product field.  As it is not an enhancement
but a bug, I am changing the Severity to 'minor'.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>106337</commentid>
    <comment_count>5</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2007-08-04 11:19:18 +0000</bug_when>
    <thetext>This is now fixed in svn for 5.5.x and 6.0.x and will be included in the next
releases of each.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>4690</bug_id>
          
          <creation_ts>2001-11-06 14:22:00 +0000</creation_ts>
          <short_desc>sessions not scoped according to spec section 7.3</short_desc>
          <delta_ts>2004-11-16 19:05:38 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="John McNally">jmcnally</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>arvind.srinivasan</cc>
    
    <cc>bob</cc>
    
    <cc>ddewolf</cc>
    
    <cc>dsoleno</cc>
    
    <cc>elaine.chien</cc>
    
    <cc>eric.dalquist</cc>
    
    <cc>kweiner</cc>
    
    <cc>nlothian</cc>
    
    <cc>sdgoldst</cc>
    
    <cc>shasti</cc>
          <votes>3</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>7622</commentid>
    <comment_count>0</comment_count>
    <who name="John McNally">jmcnally</who>
    <bug_when>2001-11-06 14:22:12 +0000</bug_when>
    <thetext>The session for a request is set according to the context in which the request
originated.  When a request is passed to a servlet in another context the
session object should not be the same as in the original context.

Looking at the code, it appears this boils down to having the context stored in
the request reflect the actual context where the request is currently being
processed.  A mechanism also needs to be in place so that any sessions initiated
in the second (or greater) context in the chain will have the same id as the
session in the original context.

This bug is present in the current CVS and was reported against tomcat and
servlet 2.2 spec as well.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>7623</commentid>
    <comment_count>1</comment_count>
      <attachid>771</attachid>
    <who name="John McNally">jmcnally</who>
    <bug_when>2001-11-06 14:41:52 +0000</bug_when>
    <thetext>Created attachment 771
my attempt to fix the problem, did not work do to use of Facade class</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>7626</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2001-11-06 17:33:37 +0000</bug_when>
    <thetext>I checked the spec, and it seems you're right. I wouldn't categorize it as high 
priority, as I'm not a big fan of cross context access (for security reasons, 
plus I think that webapps should be as self-contained as possible).

The patch appears far reaching and high risk, so it's not going in 4.0.x 
anytime soon (and will be documented as a known issue in all Tomcat 4.0.x 
versions which do have this problem).
Waiting for Craig's opinion on this subject ...</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>8432</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2001-11-29 10:34:56 +0000</bug_when>
    <thetext>This bug is complex to fix, and for this reason will probably not be fixed in 
the 4.0.x branch, but more likely for 4.1. This will be mentioned in the 
release notes.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>13870</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2002-04-17 16:27:18 +0000</bug_when>
    <thetext>*** Bug 8213 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>16188</commentid>
    <comment_count>5</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2002-05-15 17:50:28 +0000</bug_when>
    <thetext>*** Bug 9116 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>19672</commentid>
    <comment_count>6</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2002-07-17 09:57:11 +0000</bug_when>
    <thetext>*** Bug 10886 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>21427</commentid>
    <comment_count>7</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2002-08-21 07:09:45 +0000</bug_when>
    <thetext>*** Bug 11879 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>24331</commentid>
    <comment_count>8</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2002-10-11 05:29:54 +0000</bug_when>
    <thetext>*** Bug 13516 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>28102</commentid>
    <comment_count>9</comment_count>
    <who name="louis">louis</who>
    <bug_when>2002-12-20 10:54:39 +0000</bug_when>
    <thetext>I hope someone can solve this problem, this is a serious problem to me, and I 
can't think of a solution to solve my problem other than using cross context.

I working on a project which related to goverment policy.  Therefore the 
application has to change every year (I mean the application calculation engine 
and the jsp page).  Although it change to new year application, but the old 
application still has to stay alive for users who haven't migrate their data to 
new year application.  

Every year I have to deploy a new application and allow old application can 
cross context to talk to new application.  Due to the session problem, the 
whole things cannot be done unless I change to another application server.

Now is already version 4.1.18, this bug still haven't solve yet.  Hope someone 
can consider this issue.

My post in tomcat user mailing list:
http://archives.apache.org/eyebrowse/ReadMsg?listName=tomcat-
user@jakarta.apache.org&amp;msgNo=95890

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>35755</commentid>
    <comment_count>10</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-04-22 08:44:30 +0000</bug_when>
    <thetext>This will not get fixed in Tomcat 4.1.x. Spec people will have to assess the
severity of the problem.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42155</commentid>
    <comment_count>11</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-05 13:26:19 +0000</bug_when>
    <thetext>This should now be fixed. The fix will be included in 5.0.7.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62567</commentid>
    <comment_count>12</comment_count>
    <who name="David H. DeWolf">ddewolf</who>
    <bug_when>2004-08-27 02:36:56 +0000</bug_when>
    <thetext>While the new session is now being created and provided to the included
resource, no cookie is being added to the response to allow the session to be
retrieved when direct requests to the included context are recieved.  

(Pluto bug PLUTO-53 depends upon a fix to this issue:
http://nagoya.apache.org/jira/browse/PLUTO-53)

I have have attached a patch.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62568</commentid>
    <comment_count>13</comment_count>
      <attachid>12542</attachid>
    <who name="David H. DeWolf">ddewolf</who>
    <bug_when>2004-08-27 02:38:22 +0000</bug_when>
    <thetext>Created attachment 12542
Cross Context Patch - Add Cookie if able to</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62790</commentid>
    <comment_count>14</comment_count>
    <who name="Eric Dalquist">eric.dalquist</who>
    <bug_when>2004-08-30 17:13:01 +0000</bug_when>
    <thetext>I tried applying the specified path to 5.0.27 My portlet test still failed. The
portlet's session ID was different than the servlet's session ID.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63904</commentid>
    <comment_count>15</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-20 18:56:27 +0000</bug_when>
    <thetext>There have been two Servlet Spec versions and many more Tomcat versions since 
this bug was originally filed.  Does this still matter to anyone, or at least 
to the original poster?

Is the latest Servlet Spec (v2.4) clear on this issue?  How is it handled in 
the latest stable Tomcat (5.0.28 at the time of this writing)?  Who would 
object if this issue is closed as WONTFIX, since that's been the effective 
status for a year now?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63928</commentid>
    <comment_count>16</comment_count>
    <who name="John McNally">jmcnally</who>
    <bug_when>2004-09-20 22:45:27 +0000</bug_when>
    <thetext>I was the original poster and I obviously haven't been waiting 3 years hoping it
will be fixed and I am less dependent on the cross-context behavior now than I
was then.  I simply filed the issue as a failure in the reference implementation
to meet the specification.  

But there are others who are still suffering from this problem and many dupes
were filed as well.  Remy indicates that it should have been fixed, but it
appears there is still a bug.  The problem in Tomcat 4.x was deep in the
architecture, but  it sounds like a solution is closer at hand now, it would
seem a shame to declare it a WONTFIX, if the current bug turns out to be simple.

Resetting this to Tomcat 4 and declaring it WONTFIX while also entering a more
specific defect report in Tomcat 5 might be a reasonable route though. </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63932</commentid>
    <comment_count>17</comment_count>
    <who name="David H. DeWolf">ddewolf</who>
    <bug_when>2004-09-20 23:37:03 +0000</bug_when>
    <thetext>I would also object.  The Portlet Specification depends upon cross context
functionality working properly and there have been several complaints on the
Pluto user and dev lists about this.  I'm pretty sure that the underlying
problem is in tomcat and not in pluto.  

As I stated before, the fix seems to be implemented halfway.  The session which
is passed to the target context is now unique, however, it is not permenantly
associated with the context and thus can't be retrieved during future requests.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63986</commentid>
    <comment_count>18</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-09-21 16:17:51 +0000</bug_when>
    <thetext>I completely disagree with this.
The included session is merely a shadow of the including session. As a result,
it will not be handled as an actual session with an independant cookie. This is
not specified, so this is my interpretation, which should stand until
crosscontext session lifecycle and behavior is actually fully specified.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64728</commentid>
    <comment_count>19</comment_count>
    <who name="David H. DeWolf">ddewolf</who>
    <bug_when>2004-10-07 05:17:45 +0000</bug_when>
    <thetext>Can you provide some insight on why your interpretation is that this session is
a mere shadow?  What use would a session be if it can't be retrieved later on
for use by subsequent requests?

Can you provide any ideas on how we can meet the requirements of the portlet
specification's Application Scoped attributes (15.3) with your interpretation.
I'm not necessarily a fan of cross context apps either, however, our issue is
that we're trying to implement a specification which *seems* to require a
different interpretation of the servlet spec than yours.  Any help would be
greatly appreciated.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64770</commentid>
    <comment_count>20</comment_count>
    <who name="Eric Dalquist">eric.dalquist</who>
    <bug_when>2004-10-07 16:30:11 +0000</bug_when>
    <thetext>I just voted for this bug and wanted to voice a comment as well. uPortal 2.3 and
higher uses the Pluto JSR-168 portlet container in it's framework and is running
into this bug as well. This issue is more pronounced in a portal environment
since the abaility to share a session in the manner described in the bug is
essential for a portlet to securly pass session scoped data to a servlet outside
of the portal to initiate a download or similar action.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64772</commentid>
    <comment_count>21</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-10-07 16:32:19 +0000</bug_when>
    <thetext>It's not my fault if the portal JSR decided to make asumptions about the servlet
specification, and then, to be sure that they would piss off people, included
their dubious asumptions in their TCK.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64793</commentid>
    <comment_count>22</comment_count>
    <who name="Nick Lothian">nlothian</who>
    <bug_when>2004-10-07 23:29:47 +0000</bug_when>
    <thetext>It seems to me that the only assumption that was made was that sessions would
work normally when used from a cross-context dispatcher. Why is this such a
dubious assumption?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64885</commentid>
    <comment_count>23</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-10-10 20:54:32 +0000</bug_when>
    <thetext>I think this is an issue to be resolved between the Portlet Spec people and 
the Servlet Spec people.  Tomcat's implementation is strictly according to the 
Servlet Spec, and is valid (passes all TCKs 100%) according to that Spec.  IF 
the Spec specifies cross-context behavior that we don't support (it doesn't), 
then you'd have a legit Tomcat bug.  

If the Portlet Spec relies on behavior that is unspecified or unclear in the 
Servlet Spec, contact the JSR 154 team (jsr-154-comments@jcp.org) to address 
the issue.  The Servlet Spec, like the Portlet Spec, is very much alive.  I 
would not be surprised to see clarification on this cross-context stuff in 
v2.5 of the Servlet Spec.  And needless to say, the next major Tomcat version 
will implement the next Servlet Spec version accurately and fully, just as it 
does now.  But until such a Spec change is made, this is not a Tomcat bug.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65125</commentid>
    <comment_count>24</comment_count>
    <who name="David H. DeWolf">ddewolf</who>
    <bug_when>2004-10-14 13:11:07 +0000</bug_when>
    <thetext>This bug has been resolved through the patch referenced to below:

http://nagoya.apache.org/eyebrowse/ReadMsg?listName=tomcat-dev@jakarta.apache.org&amp;msgNo=80223

Anyone wanting to use this functionality must remember to set the
"emptySessionPath" attribute in their connector configuration.  An example is below.

&lt;Connector port="8080" maxThreads="150" minSpareThreads="25"
           maxSpareThreads="75" enableLookups="false"
           redirectPort="8443" acceptCount="100"
           connectionTimeout="20000" disableUploadTimeout="true"
           emptySessionPath="true" /&gt; 


Many thanks to the Tomcat team for working with us to find an acceptable
solution to all parties!</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>771</attachid>
            <date>2001-11-06 14:41:00 +0000</date>
            <delta_ts>2001-11-06 14:41:52 +0000</delta_ts>
            <desc>my attempt to fix the problem, did not work do to use of Facade class</desc>
            <filename>diff.txt</filename>
            <type>text/plain</type>
            <size>11011</size>
            <attacher name="John McNally">jmcnally</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>12542</attachid>
            <date>2004-08-27 02:38:00 +0000</date>
            <delta_ts>2004-08-27 02:38:22 +0000</delta_ts>
            <desc>Cross Context Patch - Add Cookie if able to</desc>
            <filename>cross_context_patch.txt</filename>
            <type>text/plain</type>
            <size>4753</size>
            <attacher name="David H. DeWolf">ddewolf</attacher>
            

          </attachment>
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>4829</bug_id>
          
          <creation_ts>2001-11-13 02:39:00 +0000</creation_ts>
          <short_desc>Automatic deployment of war files does not work properly</short_desc>
          <delta_ts>2004-11-16 19:05:38 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.3</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P1</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Eric Roske">e.roske</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>daling.xu</cc>
    
    <cc>feahmed</cc>
    
    <cc>flawlor</cc>
    
    <cc>gmaloon</cc>
    
    <cc>jian.cai</cc>
    
    <cc>pfg</cc>
    
    <cc>radim.kubacki</cc>
    
    <cc>RealOkun</cc>
    
    <cc>tony</cc>
    
    <cc>vlewis</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>7834</commentid>
    <comment_count>0</comment_count>
    <who name="Eric Roske">e.roske</who>
    <bug_when>2001-11-13 02:39:47 +0000</bug_when>
    <thetext>When we define a context in the server.xml file for our application, it will 
not be deployed. We have deleted the directory webapps/lexis before starting 
tomcat.

        &lt;Context path="/lexis" docBase="lexis.war"&gt;
            &lt;Parameter name="appName" value="lexis" override="false"/&gt;
            &lt;Logger className="org.apache.catalina.logger.FileLogger"
                  prefix="localhost_lexis_log." suffix=".txt" timestamp="true"/&gt;
        &lt;/Context&gt;

Without defining a context the application lexis is deployed and starts without 
any problems.

It does however work while working with Apache and the Warp Connector when it 
is first activated by calling http://www.foobar.com/lexis/lexis.do</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>7877</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2001-11-13 10:57:38 +0000</bug_when>
    <thetext>When  you use that kind of declaration (referencing a WAR), the webapp is run
without unpacking the WAR (although the JARs and the classes will be extracted
to a temporary location).
Struts should run in that mode, but webapps which require filesystem access will
not (getRealPath() will return null, and direct filesystem access to the
webapp's resources will obviously fail).

If you don't want that to happen, you can let Tomcat extract the WAR, and then
declare your context as &lt;Context path="/lexis" docBase="lexis"&gt;.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>7959</commentid>
    <comment_count>2</comment_count>
    <who name="Eric Roske">e.roske</who>
    <bug_when>2001-11-15 13:34:05 +0000</bug_when>
    <thetext>We had already tried your proposal, but it does not work.

We have not changed the parameter unpackWARs (which -I think-
is responsible for the unpacking), but Tomcat does not unpack the
webapp:

&lt;Host name="localhost" debug="0" appBase="webapps" unpackWARs="true"&gt;

Is there any other way to let Tomcat extract the WAR file?

We _must_ define a context for lexis, to do the folowing:
1) avoid the sessions to be persisted and reloaded (saveOnRestart="false") when 
Tomcat is shut down and restarted (Just because we do not only use struts: we 
also use log4j, which is not Serializable, and at higher levels the 
PersistentManager declarations seem not to work)
2) to log4j the lexis application to a specific file/directory
3) to use application parameters

((Without defining a context for the webapp lexis Tomcat
DOES extract the WAR file. Only when I __define__ a context
it DOES NOT!!))
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>7961</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2001-11-15 14:14:43 +0000</bug_when>
    <thetext>What I suggest doing works for me. That's how the examples webapp is declared 
(and it uses a lot of custom parameters).

The unpackWARs attribute is used only when auto-deploying webapps, not when 
explicitely declaring contexts.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>7971</commentid>
    <comment_count>4</comment_count>
    <who name="Eric Roske">e.roske</who>
    <bug_when>2001-11-16 00:38:45 +0000</bug_when>
    <thetext>Yeah, it does work ONLY if the webapp is in extracted form under webapp/lexis...

BUT the examples webapp is now NOT distributed as a war-file. It was so 
distributed in earlier Versions. Tomcat 3.2.1 had some war-files: admin, 
examples, ROOT and test. With Catalina these webapps aren't distibuted anymore 
as war-files.

May this be because of this problem, or should we developers avoid using war-
files to distribute our applications/updates?

Please take a closer look to the following:
==================================================================
WHEN I DO NOT DEFINE A CONTEXT FOR lexis, BUT A DefaultContext,

      &lt;Host name="localhost" debug="0" appBase="webapps" unpackWARs="true"&gt;

        &lt;Valve className="org.apache.catalina.authenticator.SingleSignOn"
                   debug="0"/&gt;
        &lt;Valve className="org.apache.catalina.valves.AccessLogValve"
                 directory="logs"  prefix="localhost_access_log." suffix=".txt"
                 pattern="common"/&gt;

        &lt;Logger className="org.apache.catalina.logger.SystemOutLogger"/&gt;

        &lt;DefaultContext reloadable="true"&gt;
          &lt;Manager className="org.apache.catalina.session.PersistentManager"
              debug="4"
              saveOnRestart="false"
              maxActiveSessions="-1"
              minIdleSwap="-1"
              maxIdleSwap="-1"
              maxIdleBackup="-1"&gt;
                &lt;Store className="org.apache.catalina.session.FileStore"/&gt;
          &lt;/Manager&gt;
        &lt;/DefaultContext&gt;
        .....

THE WAR FILE webapps/lexis.war WILL BE EXPANDED AND DEPLOYED.
BUT THIS DEFAULT CONTEXT WILL JUST BE IGNORED (saveOnRestart="false").
I AM ALSO NOT ABLE TO DEFINE APPLICATION PARAMETERS:
==================================================================
Starting service Tomcat-Standalone
Apache Tomcat/4.0.1
StandardHost[localhost]: Installing web application at context path /lexis from 
URL jar:file:D:\Programme\JBuilder5\tomcat\webapps\lexis.war!/
WebappLoader[/lexis]: Deploying class repositories to work directory 
D:\Programme\JBuilder5\tomcat\work\localhost\lexis
WebappLoader[/lexis]: Deploy JAR /WEB-INF/lib/activation.jar to 
D:\Programme\JBuilder5\tomcat\webapps\lexis\WEB-INF\lib\activation.jar
WebappLoader[/lexis]: Deploy JAR /WEB-INF/lib/crimson.jar to 
D:\Programme\JBuilder5\tomcat\webapps\lexis\WEB-INF\lib\crimson.jar
WebappLoader[/lexis]: Deploy JAR /WEB-INF/lib/jaxp.jar to D:\Programme\JBuilder5
\tomcat\webapps\lexis\WEB-INF\lib\jaxp.jar
WebappLoader[/lexis]: Deploy JAR /WEB-INF/lib/lexis.jar to 
D:\Programme\JBuilder5\tomcat\webapps\lexis\WEB-INF\lib\lexis.jar
WebappLoader[/lexis]: Deploy JAR /WEB-INF/lib/log4j.jar to 
D:\Programme\JBuilder5\tomcat\webapps\lexis\WEB-INF\lib\log4j.jar
WebappLoader[/lexis]: Deploy JAR /WEB-INF/lib/mail.jar to D:\Programme\JBuilder5
\tomcat\webapps\lexis\WEB-INF\lib\mail.jar
WebappLoader[/lexis]: Deploy JAR /WEB-INF/lib/struts.jar to 
D:\Programme\JBuilder5\tomcat\webapps\lexis\WEB-INF\lib\struts.jar
StandardManager[/lexis]: Seeding random number generator class 
java.security.SecureRandom
StandardManager[/lexis]: Seeding of random number generator has been completed
StandardManager[/lexis] IOException while loading persisted sessions: 
java.io.WriteAbortedException: Writing aborted by exception; 
java.io.NotSerializableExce
ion: org.apache.log4j.Category
java.io.WriteAbortedException: Writing aborted by exception; 
java.io.NotSerializableException: org.apache.log4j.Category
        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:445)
        at java.io.ObjectInputStream.inputClassFields
(ObjectInputStream.java:2263)
        at java.io.ObjectInputStream.defaultReadObject
(ObjectInputStream.java:519)
        at java.io.ObjectInputStream.inputObject(ObjectInputStream.java:1412)
        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:386)
        at java.io.ObjectInputStream.inputClassFields
(ObjectInputStream.java:2263)
        at java.io.ObjectInputStream.defaultReadObject
(ObjectInputStream.java:519)
        at java.io.ObjectInputStream.inputObject(ObjectInputStream.java:1412)
        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:386)
        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:236)
        at org.apache.catalina.session.StandardSession.readObject
(StandardSession.java:1268)
        at org.apache.catalina.session.StandardSession.readObjectData
(StandardSession.java:810)
        at org.apache.catalina.session.StandardManager.load
(StandardManager.java:411)
        at org.apache.catalina.session.StandardManager.start
(StandardManager.java:617)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1104)
        at org.apache.catalina.core.StandardContext.start
(StandardContext.java:3334)
        at org.apache.catalina.core.ContainerBase.addChild
(ContainerBase.java:785)
        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:454)
        at org.apache.catalina.core.StandardHost.install(StandardHost.java:712)
        at org.apache.catalina.startup.HostConfig.deployApps
(HostConfig.java:647)
        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:777)
        at org.apache.catalina.startup.HostConfig.lifecycleEvent
(HostConfig.java:463)
        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent
(LifecycleSupport.java:155)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1131)
        at org.apache.catalina.core.StandardHost.start(StandardHost.java:612)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1123)
        at org.apache.catalina.core.StandardEngine.start
(StandardEngine.java:307)
        at org.apache.catalina.core.StandardService.start
(StandardService.java:388)
        at org.apache.catalina.core.StandardServer.start
(StandardServer.java:505)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:776)
        at org.apache.catalina.startup.Catalina.execute(Catalina.java:681)
        at org.apache.catalina.startup.Catalina.process(Catalina.java:179)
        at java.lang.reflect.Method.invoke(Native Method)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:243)

StandardManager[/lexis] Exception loading sessions from persistent storage
java.io.WriteAbortedException: Writing aborted by exception; 
java.io.NotSerializableException: org.apache.log4j.Category
        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:445)
        at java.io.ObjectInputStream.inputClassFields
(ObjectInputStream.java:2263)
        at java.io.ObjectInputStream.defaultReadObject
(ObjectInputStream.java:519)
        at java.io.ObjectInputStream.inputObject(ObjectInputStream.java:1412)
        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:386)
        at java.io.ObjectInputStream.inputClassFields
(ObjectInputStream.java:2263)
        at java.io.ObjectInputStream.defaultReadObject
(ObjectInputStream.java:519)
        at java.io.ObjectInputStream.inputObject(ObjectInputStream.java:1412)
        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:386)
        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:236)
        at org.apache.catalina.session.StandardSession.readObject
(StandardSession.java:1268)
        at org.apache.catalina.session.StandardSession.readObjectData
(StandardSession.java:810)
        at org.apache.catalina.session.StandardManager.load
(StandardManager.java:411)
        at org.apache.catalina.session.StandardManager.start
(StandardManager.java:617)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1104)
        at org.apache.catalina.core.StandardContext.start
(StandardContext.java:3334)
        at org.apache.catalina.core.ContainerBase.addChild
(ContainerBase.java:785)
        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:454)
        at org.apache.catalina.core.StandardHost.install(StandardHost.java:712)
        at org.apache.catalina.startup.HostConfig.deployApps
(HostConfig.java:647)
        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:777)
        at org.apache.catalina.startup.HostConfig.lifecycleEvent
(HostConfig.java:463)
        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent
(LifecycleSupport.java:155)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1131)
        at org.apache.catalina.core.StandardHost.start(StandardHost.java:612)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1123)
        at org.apache.catalina.core.StandardEngine.start
(StandardEngine.java:307)
        at org.apache.catalina.core.StandardService.start
(StandardService.java:388)
        at org.apache.catalina.core.StandardServer.start
(StandardServer.java:505)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:776)
        at org.apache.catalina.startup.Catalina.execute(Catalina.java:681)
        at org.apache.catalina.startup.Catalina.process(Catalina.java:179)
        at java.lang.reflect.Method.invoke(Native Method)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:243)

ContextConfig[/lexis]: Configured an authenticator for method BASIC
StandardWrapper[/lexis:default]: Loading container servlet default
default: init
action: init
2001-11-16 09:20:47,185 [main] INFO  com.lincas.web.servlets.MainServlet  - Die 
Lexis Anwendungskonfigurationsdatei D:\Programme\JBuilder5\tomcat\webapps\lexi
WEB-INF\lexis-config.xml wurde geladen
2001-11-16 09:20:47,195 [main] INFO  com.lincas.web.servlets.MainServlet  - 
Default Lexis Anwendungskonfiguration: LEXIS
2001-11-16 09:20:47,195 [main] INFO  com.lincas.web.servlets.MainServlet  - 
Mailserver 195.206.1.128 f³r LEXIS initialisiert
2001-11-16 09:20:47,195 [main] INFO  com.lincas.web.servlets.MainServlet  - 
Mailserver 195.206.1.128 f³r ROLIX initialisiert
2001-11-16 09:20:47,195 [main] INFO  com.lincas.web.servlets.MainServlet  - 
Mailserver 195.206.1.128 f³r KOLIX initialisiert
2001-11-16 09:20:47,195 [main] INFO  com.lincas.web.servlets.MainServlet  - Die 
LEXIS-Anwendung wurde initialisiert
StandardWrapper[/lexis:invoker]: Loading container servlet invoker
invoker: init
jsp: init
StandardHost[localhost]: Installing web application at context path /manager 
from URL file:D:\Programme\JBuilder5\tomcat\webapps\manager
WebappLoader[/manager]: Deploying class repositories to work directory 
D:\Programme\JBuilder5\tomcat\work\localhost\manager
StandardManager[/manager]: Seeding random number generator class 
java.security.SecureRandom
StandardManager[/manager]: Seeding of random number generator has been completed
ContextConfig[/manager]: Configured an authenticator for method BASIC
StandardWrapper[/manager:default]: Loading container servlet default
default: init
StandardWrapper[/manager:invoker]: Loading container servlet invoker
invoker: init
jsp: init
StandardHost[localhost]: Installing web application at context path  from URL 
file:D:\Programme\JBuilder5\tomcat\webapps\ROOT
WebappLoader[]: Deploying class repositories to work directory 
D:\Programme\JBuilder5\tomcat\work\localhost\_
StandardManager[]: Seeding random number generator class 
java.security.SecureRandom
StandardManager[]: Seeding of random number generator has been completed
StandardWrapper[:default]: Loading container servlet default
default: init
StandardWrapper[:invoker]: Loading container servlet invoker
invoker: init
jsp: init
StandardHost[localhost]: Installing web application at context path /tomcat-
docs from URL file:D:\Programme\JBuilder5\tomcat\webapps\tomcat-docs
WebappLoader[/tomcat-docs]: Deploying class repositories to work directory 
D:\Programme\JBuilder5\tomcat\work\localhost\tomcat-docs
StandardManager[/tomcat-docs]: Seeding random number generator class 
java.security.SecureRandom
StandardManager[/tomcat-docs]: Seeding of random number generator has been 
completed
StandardWrapper[/tomcat-docs:default]: Loading container servlet default
default: init
StandardWrapper[/tomcat-docs:invoker]: Loading container servlet invoker
invoker: init
jsp: init
StandardHost[localhost]: Installing web application at context path /webdav 
from URL file:D:\Programme\JBuilder5\tomcat\webapps\webdav
WebappLoader[/webdav]: Deploying class repositories to work directory 
D:\Programme\JBuilder5\tomcat\work\localhost\webdav
StandardManager[/webdav]: Seeding random number generator class 
java.security.SecureRandom
StandardManager[/webdav]: Seeding of random number generator has been completed
StandardWrapper[/webdav:default]: Loading container servlet default
default: init
StandardWrapper[/webdav:invoker]: Loading container servlet invoker
invoker: init
jsp: init
Starting service Tomcat-Apache
Apache Tomcat/4.0.1

==================================================================
WHEN I DEFINE A CONTEXT FOR lexis, 

        &lt;Context path="/lexis" docBase="lexis" debug="0" reloadable="true"&gt;
          &lt;Logger className="org.apache.catalina.logger.FileLogger"
                  prefix="localhost_lexis_log." suffix=".txt" timestamp="true"/&gt;
          &lt;Manager className="org.apache.catalina.session.PersistentManager"
                 debug="0"
                 saveOnRestart="false"
                 maxActiveSessions="-1"
                 minIdleSwap="-1"
                 maxIdleSwap="-1"
                 maxIdleBackup="-1"&gt;
                &lt;Store className="org.apache.catalina.session.FileStore"/&gt;
          &lt;/Manager&gt;
        &lt;/Context&gt;
        
THE WAR FILE webapps/lexis.war WILL NOT BE EXPANDED AND DEPLOYED
(I HAVE DIRECTORY webapps/lexis DELETED BEFORE STARTING TOMCAT):
==================================================================
Starting service Tomcat-Standalone
Apache Tomcat/4.0.1
StandardHost[localhost]: Installing web application at context path /manager 
from URL file:D:\Programme\JBuilder5\tomcat\webapps\manager
WebappLoader[/manager]: Deploying class repositories to work directory 
D:\Programme\JBuilder5\tomcat\work\localhost\manager
StandardManager[/manager]: Seeding random number generator class 
java.security.SecureRandom
StandardManager[/manager]: Seeding of random number generator has been completed
ContextConfig[/manager]: Configured an authenticator for method BASIC
StandardWrapper[/manager:default]: Loading container servlet default
default: init
StandardWrapper[/manager:invoker]: Loading container servlet invoker
invoker: init
jsp: init
StandardHost[localhost]: Installing web application at context path  from URL 
file:D:\Programme\JBuilder5\tomcat\webapps\ROOT
WebappLoader[]: Deploying class repositories to work directory 
D:\Programme\JBuilder5\tomcat\work\localhost\_
StandardManager[]: Seeding random number generator class 
java.security.SecureRandom
StandardManager[]: Seeding of random number generator has been completed
StandardWrapper[:default]: Loading container servlet default
default: init
StandardWrapper[:invoker]: Loading container servlet invoker
invoker: init
jsp: init
StandardHost[localhost]: Installing web application at context path /tomcat-
docs from URL file:D:\Programme\JBuilder5\tomcat\webapps\tomcat-docs
WebappLoader[/tomcat-docs]: Deploying class repositories to work directory 
D:\Programme\JBuilder5\tomcat\work\localhost\tomcat-docs
StandardManager[/tomcat-docs]: Seeding random number generator class 
java.security.SecureRandom
StandardManager[/tomcat-docs]: Seeding of random number generator has been 
completed
StandardWrapper[/tomcat-docs:default]: Loading container servlet default
default: init
StandardWrapper[/tomcat-docs:invoker]: Loading container servlet invoker
invoker: init
jsp: init
StandardHost[localhost]: Installing web application at context path /webdav 
from URL file:D:\Programme\JBuilder5\tomcat\webapps\webdav
WebappLoader[/webdav]: Deploying class repositories to work directory 
D:\Programme\JBuilder5\tomcat\work\localhost\webdav
StandardManager[/webdav]: Seeding random number generator class 
java.security.SecureRandom
StandardManager[/webdav]: Seeding of random number generator has been completed
StandardWrapper[/webdav:default]: Loading container servlet default
default: init
StandardWrapper[/webdav:invoker]: Loading container servlet invoker
invoker: init
jsp: init
Starting service Tomcat-Apache
Apache Tomcat/4.0.1
================================================================================
=====
AND WHEN I TRY TO CALL THE WEBAPP (http://localhost:8080/lexis/lexis.do) I 
BECOME:
HTTP Status 404: The requested resource (/lexis/lexis.do) is not available
================================================================================
=====



</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>7978</commentid>
    <comment_count>5</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2001-11-16 02:08:40 +0000</bug_when>
    <thetext>I have test the DefaultContext with nightly 11/12/2001 build
and it works with Parameter and Env 
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>8345</commentid>
    <comment_count>6</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2001-11-27 11:55:43 +0000</bug_when>
    <thetext>*** Bug 5105 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>8399</commentid>
    <comment_count>7</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2001-11-28 09:10:16 +0000</bug_when>
    <thetext>*** Bug 5105 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>9271</commentid>
    <comment_count>8</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2002-01-02 06:36:34 +0000</bug_when>
    <thetext>*** Bug 5600 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>10782</commentid>
    <comment_count>9</comment_count>
    <who name="Victor Lewis">vlewis</who>
    <bug_when>2002-02-16 03:21:15 +0000</bug_when>
    <thetext>[Note that this is still the behaviour in 4.0.2].

I must concur with the reporter.  The documentation at tomcat-
docs/config/host.html leads one to believe that the auto-deployment of the 
application is orthogonal to the automatic creation of the &lt;context&gt; if it is 
not supplied. 

A work-around we have experimented with is to choose a path that is different 
from the docBase (given that documents.war is in the webapps directory):
	&lt;Context path=”/docs” docBase=”documents”/&gt;
At first this seems to work but there are two problems
1. This actually deploys as two applications, each using the same docBase.  
Once at /docs and the other at /documents.
2. There is a race condition.  If the “/doc” context is started before the 
documents.war is deployed it will not be found until tomcat is restarted.

It does not seem unreasonable to want to have a war file auto deploy and 
specify a &lt;context&gt; in the server.xml file.  I may have an application for 
which I wish to create files in the applications docBase and want to add 
parameters to the &lt;context&gt; (e.g. &lt;realm&gt;.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>10799</commentid>
    <comment_count>10</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2002-02-16 07:04:10 +0000</bug_when>
    <thetext>As I stated quite a few times, this "bug" will not be fixed.
If you are not satisfied with the current behavior, the best way to fix it is to
submit a patch, and we'll consider it for inclusion.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>11527</commentid>
    <comment_count>11</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2002-03-06 23:30:47 +0000</bug_when>
    <thetext>*** Bug 6941 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>12188</commentid>
    <comment_count>12</comment_count>
    <who name="paulgarvie">pfg</who>
    <bug_when>2002-03-22 18:36:32 +0000</bug_when>
    <thetext>I have also observed this behavior. This probably could be considered more of a 
bug in the documentation than the code. The 4.0 on-line docs state you can "set 
(the unpackWARS attribute of a &lt;Host&gt; element) to true if you want web 
applications that are deployed into this virtual host from a Web Application 
Archive (WAR) file to be unpacked into a disk directory structure." They also 
state that "(y)ou can nest one or more Context elements inside this Host 
element, each representing a different web application associated with this 
virtual host."

As to Context, "(t)he &lt;Context&gt; element represents a web application, which is 
run within a particular virtual host. Each web application is based on a Web 
Application Archive (WAR) file, or a corresponding directory containing the 
corresponding unpacked contents...", and that"(e)ach (&lt;Context&gt; element) MUST 
have a unique context path, which is defined by the path attribute."

The docs don't say that before Tomcat unpacks any warfiles, it will first 
attempt to verify the context path of a &lt;Context&gt; element by checking for a 
web.xml file in the corresponding webapp WEB-INF directories. It also doesn't 
state that if it can't find the web.xml file in the context path directory 
referenced by the &lt;Context&gt; element, it will shut down.

If anything, the desired behavior should be the opposite: unpack the warfiles, 
then check the &lt;Context&gt; elements in server.xml against the appropriate 
web.xml. That might be a little less irritating than not.

PaulGarvie</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>12409</commentid>
    <comment_count>13</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2002-03-27 18:22:14 +0000</bug_when>
    <thetext>*** Bug 7527 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>12427</commentid>
    <comment_count>14</comment_count>
    <who name="Bob">feahmed</who>
    <bug_when>2002-03-27 21:33:56 +0000</bug_when>
    <thetext>I strongly believe this is a problem. As an example, if I have a WAR file 
named "MyAppl.war", and I dont define anything about it in "server.xml", just 
place the file in CATALINA_HOME/webapps, the file is automatically unpacked. 
But in order to be able to get other servlet contexts, if I add the following 
line in the server.xml :

&lt;Context path="/MyAppl"  docBase="MyAppl" crossContext="true"/&gt;

now the WAR file is NOT automatically expanded. 

In summary "a WAR file is automatically expanded by Tomcat, but if I just want 
to enable crosscontext support, it will not be expanded automatically." Doesnt 
it sound like a bug?  Just because I want the crosscontext property enabled for 
the application and I  add a line in server.xml I would not be able to 
distribute my app as a WAR file, but would have to distribute it in expanded 
form?
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>13429</commentid>
    <comment_count>15</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2002-04-12 23:05:12 +0000</bug_when>
    <thetext>*** Bug 8036 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>14457</commentid>
    <comment_count>16</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2002-04-23 15:01:30 +0000</bug_when>
    <thetext>*** Bug 8418 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>17255</commentid>
    <comment_count>17</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2002-06-06 01:07:03 +0000</bug_when>
    <thetext>*** Bug 6739 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>19557</commentid>
    <comment_count>18</comment_count>
    <who name="Tim Cooke">tim.cooke</who>
    <bug_when>2002-07-15 13:56:34 +0000</bug_when>
    <thetext>Dear Remy

You have my full sympathy about this problem, but there is a lot of confusion 
occurring.

You're being perfectly reasonable both in pointing out that this isn't a bug at 
all, but the designed behavior, and in suggesting that bug reporters instead 
submit a patch to change the behavior.

The problem is that many people who are experiencing this bug, and this applies 
to me, are not technically adept enough to propose such a change - is there any 
chance that you could revisit the stated design and , or would this then 
contravene a specification?

What I believe people want or need is to be able to start Tomcat *with* a 
context (e.g. "MyApp") defined in server.xml, and with a "MyApp.war" file in 
place, but *without* the exploded "MyApp" webapp directory; in this scenario it 
would be most excellent if Tomcat unpacked the WAR before alternatively 
discovering the absence of the declared context.

What are your thoughts on this suggestion?

TIA

Kind regards
Tim Cooke
P.S. At present I run Tomcat 4.0.1.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>35756</commentid>
    <comment_count>19</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-04-22 08:48:20 +0000</bug_when>
    <thetext>No further behavior modifications will be made in Tomcat 4.1.x, so this won't be
addressed.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39378</commentid>
    <comment_count>20</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-06-24 22:50:17 +0000</bug_when>
    <thetext>Improvements have been made to Tomcat 5.0 deployer, which should address this
RFE. This will be in Tomcat 5.0.4.</thetext>
  </long_desc>
      
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>6582</bug_id>
          
          <creation_ts>2002-02-20 15:56:00 +0000</creation_ts>
          <short_desc>SERVLETAPI: Sample code does not match behavior</short_desc>
          <delta_ts>2005-09-24 15:07:44 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Examples</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>http://127.0.0.1:8080/examples/servlets/reqparams.html</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P1</priority>
          <bug_severity>blocker</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Chris Merrill">chris</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>10953</commentid>
    <comment_count>0</comment_count>
    <who name="Chris Merrill">chris</who>
    <bug_when>2002-02-20 15:56:56 +0000</bug_when>
    <thetext>The "Source Code for Request Parameter Example" link does 
not show the correct source code for the sample servlet 
that is installed.  This can be verified both by the behavior 
of the servlet and looking at the true sample source at
%CATALINA_HOME%\webapps\examples\WEB-INF\classes\RequestParamExample.java.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48618</commentid>
    <comment_count>1</comment_count>
      <attachid>9425</attachid>
    <who name="Mark Thomas">medthomas</who>
    <bug_when>2003-12-06 19:23:28 +0000</bug_when>
    <thetext>Created attachment 9425
Patch for TC4 to fix this bug</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48619</commentid>
    <comment_count>2</comment_count>
      <attachid>9426</attachid>
    <who name="Mark Thomas">medthomas</who>
    <bug_when>2003-12-06 19:23:44 +0000</bug_when>
    <thetext>Created attachment 9426
Patch for TC5 to fix this bug</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>69219</commentid>
    <comment_count>3</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2005-01-04 23:50:45 +0000</bug_when>
    <thetext>Fixed in TC4 but needs jakarta-servletapi-5 karama to fix for TC5 which means
one of the spec team needs to commmit the patch.

Updating severity as discussed on tomcat-dev mailing list.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>80433</commentid>
    <comment_count>4</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2005-09-24 23:07:44 +0000</bug_when>
    <thetext>Fixed now we have commit access to the examples in SVN.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>9425</attachid>
            <date>2003-12-06 19:23:00 +0000</date>
            <delta_ts>2003-12-06 19:23:28 +0000</delta_ts>
            <desc>Patch for TC4 to fix this bug</desc>
            <filename>reqparams-html-TC4.patch</filename>
            <type>text/plain</type>
            <size>4100</size>
            <attacher name="Mark Thomas">medthomas</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>9426</attachid>
            <date>2003-12-06 19:23:00 +0000</date>
            <delta_ts>2003-12-06 19:23:44 +0000</delta_ts>
            <desc>Patch for TC5 to fix this bug</desc>
            <filename>reqparams-html-TC5.patch</filename>
            <type>text/plain</type>
            <size>3701</size>
            <attacher name="Mark Thomas">medthomas</attacher>
            

          </attachment>
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>9351</bug_id>
          
          <creation_ts>2002-05-23 14:43:00 +0000</creation_ts>
          <short_desc>IPv6 HTTP/1.1 requests not working</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jorge Serna">jserna</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>16593</commentid>
    <comment_count>0</comment_count>
    <who name="Jorge Serna">jserna</who>
    <bug_when>2002-05-23 14:43:38 +0000</bug_when>
    <thetext>The problem is in org.apache.catalina.connector.http.HttpProcessor the parsing 
of the Host header assumes that its format is:

&lt;host_name&gt;[:port]

where host_name mustn't contain any ':' character.

But with IPv6 addresses (RFC 2736 - Format for literal IPv6 addresses in URL), 
a valid address could be:

[3ffe:3328:6:3::2]:80

and so the code:

---

} else if (header.equals(DefaultHeaders.HOST_NAME)) {
                  int n = value.indexOf(':');

----

which assumes ':' only as port separator is not working.

Additional parsing must be added to this class in order to take into account 
IPv6 Addresses.

Jorge Serna</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>16600</commentid>
    <comment_count>1</comment_count>
    <who name="Pier Fumagalli">pier</who>
    <bug_when>2002-05-23 16:31:40 +0000</bug_when>
    <thetext>Can you submit a patch on that topic, of course tested with J2SE 1.4, to 
see if it actually works?
A current workaround would be to use a host name resolving as an IPv6 
address (for example, I use localhost_ipv6 , which resolves to "::1"), but I 
never tested it on Tomcat...</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>16604</commentid>
    <comment_count>2</comment_count>
    <who name="Jorge Serna">jserna</who>
    <bug_when>2002-05-23 17:18:44 +0000</bug_when>
    <thetext>I have developed no bug fix yet, but it shouldn't be very difficult to do it 
(it's a simple String parsing). As of now we're using a little workaround which 
is using names instead of IPv6 addresses, and it works fine.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34850</commentid>
    <comment_count>3</comment_count>
      <attachid>5762</attachid>
    <who name="Masashi Yamaguchi">yamagu</who>
    <bug_when>2003-04-10 05:58:41 +0000</bug_when>
    <thetext>Created attachment 5762
patch for org.apache.coyote.http11.Http11Processor</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34851</commentid>
    <comment_count>4</comment_count>
      <attachid>5763</attachid>
    <who name="Masashi Yamaguchi">yamagu</who>
    <bug_when>2003-04-10 06:00:47 +0000</bug_when>
    <thetext>Created attachment 5763
test case for org.apache.coyote.http11.Http11Processor</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34907</commentid>
    <comment_count>5</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-04-10 18:37:21 +0000</bug_when>
    <thetext>No offense, but I think there is little market for IPv6 in TC right now. As
such, it will not be ported in Tomcat 4.x. Thanks for the patch, anyway.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34932</commentid>
    <comment_count>6</comment_count>
    <who name="Masashi Yamaguchi">yamagu</who>
    <bug_when>2003-04-11 05:03:24 +0000</bug_when>
    <thetext>I have found other problems of IPv6 HTTP/1.1 requests.




When hotname is IPv6 address,


HttpServletRequest#getRequestURL() and HttpServletResponse#sendRedirect() don't 
work properly.




I have developed additional patches,


and I will post patches and test-cases.


-  org.apache.coyote.tomcat4.CoyoteReques


-  org.apache.coyote.tomcat5.CoyoteRequest


-  org.apache.coyote.tomcat5.CoyoteResponset


-  org.apache.catalina.util.URL


-  org.apache.tomcat.util.net.URL






example of problems:


  [Tomcat4 &amp; 5]


  When Host header is "[3ffe:3328:6:3::2]:80",


  HttpServletRequest#getRequestURL() returns "http://3ffe:3328:6:3::2:80/abc".


  Expected return-value was "http://[3ffe:3328:6:3::2]:80/abc".




  [Tomcat4]


  When Host header is "[3ffe:3328:6:3::2]:80",


  HttpServletResponse#sendRedirect() fails to create Location header.


  (catches IllegalArgumentException and set status SC_NOT_FOUND.)




  [Tomcat5]


  When Host header is "[3ffe:3328:6:3::2]:80",


  HttpServletResponse#sendRedirect() sets "http://3ffe:3328:6:3::2:80/abc/" to 
Location header.


  Expected Location header was "http://[3ffe:3328:6:3::2]:80/abc/".


</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34933</commentid>
    <comment_count>7</comment_count>
      <attachid>5788</attachid>
    <who name="Masashi Yamaguchi">yamagu</who>
    <bug_when>2003-04-11 05:07:13 +0000</bug_when>
    <thetext>Created attachment 5788
patch for org.apache.coyote.tomcat4.CoyoteReques</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34934</commentid>
    <comment_count>8</comment_count>
      <attachid>5789</attachid>
    <who name="Masashi Yamaguchi">yamagu</who>
    <bug_when>2003-04-11 05:07:47 +0000</bug_when>
    <thetext>Created attachment 5789
patch for org.apache.coyote.tomcat5.CoyoteRequest</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34936</commentid>
    <comment_count>9</comment_count>
      <attachid>5790</attachid>
    <who name="Masashi Yamaguchi">yamagu</who>
    <bug_when>2003-04-11 05:08:31 +0000</bug_when>
    <thetext>Created attachment 5790
org.apache.coyote.tomcat5.CoyoteResponset</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34937</commentid>
    <comment_count>10</comment_count>
      <attachid>5791</attachid>
    <who name="Masashi Yamaguchi">yamagu</who>
    <bug_when>2003-04-11 05:09:57 +0000</bug_when>
    <thetext>Created attachment 5791
patch for org.apache.tomcat.util.net.URL</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34938</commentid>
    <comment_count>11</comment_count>
      <attachid>5792</attachid>
    <who name="Masashi Yamaguchi">yamagu</who>
    <bug_when>2003-04-11 05:11:29 +0000</bug_when>
    <thetext>Created attachment 5792
test case for org.apache.tomcat.util.net.URL</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34939</commentid>
    <comment_count>12</comment_count>
      <attachid>5793</attachid>
    <who name="Masashi Yamaguchi">yamagu</who>
    <bug_when>2003-04-11 05:12:34 +0000</bug_when>
    <thetext>Created attachment 5793
patch for org.apache.catalina.util.URL</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34940</commentid>
    <comment_count>13</comment_count>
      <attachid>5794</attachid>
    <who name="Masashi Yamaguchi">yamagu</who>
    <bug_when>2003-04-11 05:13:02 +0000</bug_when>
    <thetext>Created attachment 5794
test case for org.apache.catalina.util.URL</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34941</commentid>
    <comment_count>14</comment_count>
    <who name="Masashi Yamaguchi">yamagu</who>
    <bug_when>2003-04-11 05:22:26 +0000</bug_when>
    <thetext>I've posted all patches and test-cases I maked.

org.apache.catalina.connector package has same problems,
but it was "deprecated" sp I have do nothing to it.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34943</commentid>
    <comment_count>15</comment_count>
    <who name="">william.barker</who>
    <bug_when>2003-04-11 06:16:43 +0000</bug_when>
    <thetext>Your patches still have bugs in them.  I've committed changes to 
o.a.t.u.net.URL (one of the less critical classes) based on a heavily modified 
version of your patch.  You might want to review it to see some of the 
problems, and re-submit fixed patches.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34958</commentid>
    <comment_count>16</comment_count>
    <who name="Masashi Yamaguchi">yamagu</who>
    <bug_when>2003-04-11 11:04:55 +0000</bug_when>
    <thetext>I have reviewed comitted o.a.t.u.net.URL
and I realize that I have misunderstanded URL#getHost()'s sepecification.
"URL#getHost() returns IPv6 address enclosed in square brackets."

o.a.c.u.URL's patch I posted is invalid.
o.a.c.u.URL needs patch same with o.a.t.u.net.URL.

CoyoteRequest's patch I posted is invalid.
CoyoteRequest needs no patches.

Does ServletRequest#getServerName() also returns enclosed IPv6 address?
If it does,
 CoyoteResponse needs no patches,
 Http11Processor's patch I posted has to be fixed.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34960</commentid>
    <comment_count>17</comment_count>
      <attachid>5798</attachid>
    <who name="Masashi Yamaguchi">yamagu</who>
    <bug_when>2003-04-11 11:07:46 +0000</bug_when>
    <thetext>Created attachment 5798
fixed patch for org.apache.coyote.http11.Http11Processor. (ServletRequest#getServerName() returns enclosed IPv6 address)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34961</commentid>
    <comment_count>18</comment_count>
      <attachid>5799</attachid>
    <who name="Masashi Yamaguchi">yamagu</who>
    <bug_when>2003-04-11 11:11:12 +0000</bug_when>
    <thetext>Created attachment 5799
fixed test case for org.apache.coyote.http11.Http11Processor. (serverName is enclosed IPv6 address)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34962</commentid>
    <comment_count>19</comment_count>
      <attachid>5800</attachid>
    <who name="Masashi Yamaguchi">yamagu</who>
    <bug_when>2003-04-11 11:15:28 +0000</bug_when>
    <thetext>Created attachment 5800
fixed test case for o.a.t.u.net.URL (getHost() returns enclosed IPv6 address)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42146</commentid>
    <comment_count>20</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-05 12:38:03 +0000</bug_when>
    <thetext>I have applied the patch to Http11Processor, thanks :)
As for o.a.c.u.URL, it does not seem to be used anymore, so I see no reason for
patching it (t.u.net.URL).</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>5762</attachid>
            <date>2003-04-10 05:58:00 +0000</date>
            <delta_ts>2003-04-10 05:58:41 +0000</delta_ts>
            <desc>patch for org.apache.coyote.http11.Http11Processor</desc>
            <filename>diff.txt</filename>
            <type>text/plain</type>
            <size>2331</size>
            <attacher name="Masashi Yamaguchi">yamagu</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>5763</attachid>
            <date>2003-04-10 06:00:00 +0000</date>
            <delta_ts>2003-04-10 06:00:47 +0000</delta_ts>
            <desc>test case for org.apache.coyote.http11.Http11Processor</desc>
            <filename>Http11ProcessorTest.java</filename>
            <type>text/plain</type>
            <size>4922</size>
            <attacher name="Masashi Yamaguchi">yamagu</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>5788</attachid>
            <date>2003-04-11 05:07:00 +0000</date>
            <delta_ts>2003-04-11 05:07:13 +0000</delta_ts>
            <desc>patch for org.apache.coyote.tomcat4.CoyoteReques</desc>
            <filename>tomcat4-coyoteRequest_diff.txt</filename>
            <type>text/plain</type>
            <size>1021</size>
            <attacher name="Masashi Yamaguchi">yamagu</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>5789</attachid>
            <date>2003-04-11 05:07:00 +0000</date>
            <delta_ts>2003-04-11 05:07:47 +0000</delta_ts>
            <desc>patch for org.apache.coyote.tomcat5.CoyoteRequest</desc>
            <filename>tomcat5-coyoteRequest_diff.txt</filename>
            <type>text/plain</type>
            <size>1021</size>
            <attacher name="Masashi Yamaguchi">yamagu</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>5790</attachid>
            <date>2003-04-11 05:08:00 +0000</date>
            <delta_ts>2003-04-11 05:08:31 +0000</delta_ts>
            <desc>org.apache.coyote.tomcat5.CoyoteResponset</desc>
            <filename>tomcat5-coyoteResponse_diff.txt</filename>
            <type>text/plain</type>
            <size>942</size>
            <attacher name="Masashi Yamaguchi">yamagu</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>5791</attachid>
            <date>2003-04-11 05:09:00 +0000</date>
            <delta_ts>2003-04-11 05:09:57 +0000</delta_ts>
            <desc>patch for org.apache.tomcat.util.net.URL</desc>
            <filename>tomcat_util_net_URL_diff.txt</filename>
            <type>text/plain</type>
            <size>2229</size>
            <attacher name="Masashi Yamaguchi">yamagu</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>5792</attachid>
            <date>2003-04-11 05:11:00 +0000</date>
            <delta_ts>2003-04-11 05:11:29 +0000</delta_ts>
            <desc>test case for org.apache.tomcat.util.net.URL</desc>
            <filename>URLTest.java</filename>
            <type>text/plain</type>
            <size>6169</size>
            <attacher name="Masashi Yamaguchi">yamagu</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>5793</attachid>
            <date>2003-04-11 05:12:00 +0000</date>
            <delta_ts>2003-04-11 05:12:34 +0000</delta_ts>
            <desc>patch for org.apache.catalina.util.URL</desc>
            <filename>catalina_util_URL_diff.txt</filename>
            <type>text/plain</type>
            <size>2220</size>
            <attacher name="Masashi Yamaguchi">yamagu</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>5794</attachid>
            <date>2003-04-11 05:13:00 +0000</date>
            <delta_ts>2003-04-11 05:13:02 +0000</delta_ts>
            <desc>test case for org.apache.catalina.util.URL</desc>
            <filename>URLTest.java</filename>
            <type>text/plain</type>
            <size>6165</size>
            <attacher name="Masashi Yamaguchi">yamagu</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>5798</attachid>
            <date>2003-04-11 11:07:00 +0000</date>
            <delta_ts>2003-04-11 11:07:46 +0000</delta_ts>
            <desc>fixed patch for org.apache.coyote.http11.Http11Processor. (ServletRequest#getServerName() returns enclosed IPv6 address)</desc>
            <filename>http11processor_diff.txt</filename>
            <type>text/plain</type>
            <size>1185</size>
            <attacher name="Masashi Yamaguchi">yamagu</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>5799</attachid>
            <date>2003-04-11 11:11:00 +0000</date>
            <delta_ts>2003-04-11 11:11:12 +0000</delta_ts>
            <desc>fixed test case for org.apache.coyote.http11.Http11Processor. (serverName is enclosed IPv6 address)</desc>
            <filename>Http11ProcessorTest.java</filename>
            <type>text/plain</type>
            <size>4926</size>
            <attacher name="Masashi Yamaguchi">yamagu</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>5800</attachid>
            <date>2003-04-11 11:15:00 +0000</date>
            <delta_ts>2003-04-11 11:15:28 +0000</delta_ts>
            <desc>fixed test case for o.a.t.u.net.URL (getHost() returns enclosed IPv6 address)</desc>
            <filename>URLTest.java</filename>
            <type>text/plain</type>
            <size>6256</size>
            <attacher name="Masashi Yamaguchi">yamagu</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>10671</bug_id>
          
          <creation_ts>2002-07-11 03:08:00 +0000</creation_ts>
          <short_desc>Major issues with jsp:param in jsp:include and jsp:forward</short_desc>
          <delta_ts>2005-01-17 06:35:25 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.28</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jess Holle">jessh</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>1</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>19296</commentid>
    <comment_count>0</comment_count>
    <who name="Jess Holle">jessh</who>
    <bug_when>2002-07-11 03:08:59 +0000</bug_when>
    <thetext>This is related to bug 9361, which I also filed, but I have now run across a 
number of more substantive, related issues.

Tomcat 4.1.3 (and 4.1.2 and I'm not sure how far previously) take:
  &lt;jsp:include ....&gt;
    ...
    &lt;jsp:param name="foo" value="&lt;%=bar%&gt;"/&gt;
    ...
and generate something like
  JspEngine.include( ... + "&amp;foo=" + java.net.URLEncoder.encode( bar ) ... );
whereas Tomcat 3.x did something like
  JspEngine.include( ... + "&amp;foo=" + bar ... );
[Yes, I know the class is not actually "JspEngine", but you get the idea.]

This was apparently done to fix issues when bar.toString()'s result contained 
&amp;, =, or other special characters.

Unfortunately, this change has a number of critical issues:
  1) As per 9361, if 'bar' is null, then this throws an exception, whereas most
     every servlet engine around (including Tomcat 3.2.x and 3.3.x) do not.
  2) If 'bar' is not a String, then the JSP page will no longer compile,
     whereas non-String variables could be used in this context previously and
     in other JSP engines.
  3) java.net.URLEncoder.encode() does not properly handle non-ASCII or at
     least non-Latin characters.  One has to do something like get the string
     bytes as per UTF8 then URLEncode the string formed from these bytes
     (interpretting each byte as a char) -- or more efficiently do this all in
     a single pass.  Thus the original intent of using URLEncoder.encode() is
     not fully accomplished by the change anyway.

As it stands now, Tomcat 4.1.x seriously cripples jsp:param as it is commonly 
used.  If this is as per the JSP 1.2 spec, please point this out (though I'd 
have trouble believing this).

I strongly suggest a single
  String JspEngine.encode( Object obj )
method that will return "" for a null object and otherwise to obj.toString(), 
UTF8 encode and URL encode this result.

As it is now, I suspect we were better off overall with the Tomcat 3.x 
jsp:param code generation, i.e. a heck of a lot of big, real apps run just fine 
on it without running afoul of URL encoding issues.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>19419</commentid>
    <comment_count>1</comment_count>
    <who name="Mark Renouf">mark</who>
    <bug_when>2002-07-12 16:00:48 +0000</bug_when>
    <thetext>I was going to file a bug regarding this, until I realized this was changed in
4.1.x. So by default now (in 4.1.x) the behavior is to URLEncode the parameter
values automatically?

I ran into an issue with passing URLS as paramters where the invalid characters
(for a url), when not escaped, would effectively "hide" any further parameters
from being parsed. In ServletExec 3.1 the URLEncode step is automatically done.
So it sounds like this was also added to Tomcat 4.1.x?

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>19423</commentid>
    <comment_count>2</comment_count>
    <who name="Jess Holle">jessh</who>
    <bug_when>2002-07-12 16:23:31 +0000</bug_when>
    <thetext>Yes, the URLEncode bit was added to 4.1.x BUT as per my description above simply
doing this brings with it as many problems as it solves.

The UTF8 bit is necessary to handle non-ASCII (or at least non-Latin)
characters, but just to handle normal accepted usages null and non-String object
handling must be added back in.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>19817</commentid>
    <comment_count>3</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2002-07-18 21:48:24 +0000</bug_when>
    <thetext>There is a two argument version of java.net.URLEncoder.encode in j2sdk 1.4 that
let the encoding be specified as the 2nd argument.  I should probably use that,
but unfortunately that is not available in 1.3.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>19846</commentid>
    <comment_count>4</comment_count>
    <who name="Andreas Junghans">Andreas.Junghans</who>
    <bug_when>2002-07-19 08:06:45 +0000</bug_when>
    <thetext>We ran into URL encoding problems in one of our projects and found this at the 
W3C:

http://www.w3.org/International/URLUTF8Encoder.java

It seems to do exactly what the new encode method in JDK 1.4 does.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>19849</commentid>
    <comment_count>5</comment_count>
    <who name="Henner Zeller">H.Zeller</who>
    <bug_when>2002-07-19 10:17:26 +0000</bug_when>
    <thetext>BTW, should this be _always_ UTF8 or shouldn't this be the value of the 
document-encoding of the specific page instead ? If we have a page served as 
ISO-8859-1, then the URLencoding should as well encodes characters to its 
ISO-8859-1 byte representation; if the page is UTF8, then we should serve 
URL-encode with UTF8. I assume, many browsers will run into problems 
otherwise, because encoding is mixed in the same page ? </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>20055</commentid>
    <comment_count>6</comment_count>
    <who name="Jess Holle">jessh</who>
    <bug_when>2002-07-23 14:52:57 +0000</bug_when>
    <thetext>One can always encode hyperlinks to UTF-8 bytes and then URLEncode them.  This
always results in ASCII without any special characters.  The issue is that the
code processing the link requests must know to expect UTF-8 encoded data.  The
issue here is in making all of one's form submissions follow this as well (or
using POST for forms and handling POST and GET a bit differently).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22016</commentid>
    <comment_count>7</comment_count>
    <who name="Jess Holle">jessh</who>
    <bug_when>2002-08-30 04:58:59 +0000</bug_when>
    <thetext>There is talk of calling 4.1.10 a final release, but yet this apparent spec 
violation has not been fixed?!?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22499</commentid>
    <comment_count>8</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2002-09-09 10:53:34 +0000</bug_when>
    <thetext>The behavior in 4.1.11 will be identical to Tomcat 4.0.x. It is still unclear 
to me if this is a spec violation or not.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22503</commentid>
    <comment_count>9</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2002-09-09 10:56:57 +0000</bug_when>
    <thetext>*** Bug 9361 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44943</commentid>
    <comment_count>10</comment_count>
    <who name="Kahro Raie">kahroo</who>
    <bug_when>2003-10-01 12:02:17 +0000</bug_when>
    <thetext>I lately ran into ALMOUST the same URL encoding decoding problem.
As it seems no action is going to be taken I'll describe my situation so it
could help in the desition making.

First I need to put ISO-8859-4 characters on the URL (I know it's bad design and
the next time I'll use underlying coding ;). For example the URL to be encoded
is: "folder.do?path=/Uusim/täpiline".

Now I use struts for createing the actual URL and so the URL is encoded in
UTF-8. When tomcat decodes the request URL on the next step useing platform
defaul encodeing ISO-8859-4 I get different result.

As you all can see the problem could even be none of Tomcat's business but while
figuring about the solutions I came up with a little example that makes it
Tomcat's problem:

Lets assume that I encode the url with URLEncoder.encode(java.lang.String)
manually. Then struts will not find any unaceptable characters and leaves the
URL alone (At least I hope so). Now I shouldn't have no problems with Tomcat's
decodeing method.

But the same problem comes up again when my application is distributed and the
url location happens to be on a different server with a different encodeing. Now
when the different server happens to be out of my hands and so the encodeing
remains different then I'll have to deal with the encoding problem on
application level and that's a bit stupid.

So my opinion is that the URL encodeing and decodeing should allways be done in
UTF-8 encodeing like the "World Wide Web Consortium" recommends. And maybe
introduce a configuration parameter for extreme cases when some other server
handles this issue incorrectly.

I'd be happy to get any response concering this issue.

PS! I also checked and think that this problem is currently up with both the
4.1.27 and 5.0.12 server versions.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44953</commentid>
    <comment_count>11</comment_count>
    <who name="Jess Holle">jessh</who>
    <bug_when>2003-10-01 14:24:17 +0000</bug_when>
    <thetext>We have not hit these issues with 4.1.24 they went away for us quite some 4.1.x
releases back.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>46098</commentid>
    <comment_count>12</comment_count>
    <who name="Ben Kelley">ben_kelley</who>
    <bug_when>2003-10-23 01:30:20 +0000</bug_when>
    <thetext>I agree that passing non-ISO-8859-1 characters (or whatever your platform 
default is) via &lt;jsp:param&gt; is broken in 4.1.27.

A suggested work-around:

While this work-around won't be suitable for all applications, it is handy 
where an included page (or a page that is always the target of a forward) 
wants to receive characters that would otherwise not work.

Basically encode the value of the parameter into something that can be 
represented in ISO-8859-1 before passing it to &lt;jsp:param&gt;, and then do the 
reverse encoding in the called page. Using Java 1.4's URLEncoder.encode
(string, "UTF-8") before giving the string to &lt;jsp:param&gt; is one such encoding 
that does this.

This causes:
[non ISO-8859-1 suitable string]
  (encode using URLEncoder.encode(string, "UTF-8"))
[string that can be represented in ISO-8859-1]
  (pass to &lt;jsp:include&gt; or &lt;jsp:forward&gt; via &lt;jsp:param&gt;)
  (Tomcat calls URLEncoder.encode(string))
  (Tomcat calls the included or forwarded page)
  (Tomcat calls URLEncoder.decode(string))
[string that can be represented in ISO-8859-1]
  (decode using URLDecoder.decode(string, "UTF-8"))
[original string]
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>69656</commentid>
    <comment_count>13</comment_count>
    <who name="Rohan Pinto">rpinto</who>
    <bug_when>2005-01-14 00:06:32 +0000</bug_when>
    <thetext>http://issues.apache.org/bugzilla/show_bug.cgi?id=31804
 
Could someone please advise me on whether this Bug is fixed?
Bugzilla shows this bug to be filed under Tomcat 4.0 I am using Tomcat 5.0.28 
and am having problems when using the jsp:param tag. I get tons of deprecation 
errors.
 
My IDE is jbuilder 2005 and am using :
java version "1.4.2_05"
Java(TM) 2 Runtime Environment, Standard Edition (build 1.4.2_05-b04) Java 
HotSpot(TM) Client VM (build 1.4.2_05-b04, mixed mode)

 
any tips on whether this bugID is fixed for Tomcat 5.0.28 (or how could it be 
fixed OR a workaround ) would be greatly appreciated.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>69657</commentid>
    <comment_count>14</comment_count>
    <who name="Rohan Pinto">rpinto</who>
    <bug_when>2005-01-14 00:08:14 +0000</bug_when>
    <thetext>sorry. prior post had the wrong URL the correct one is : 
http://issues.apache.org/bugzilla/show_bug.cgi?id=10671</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>69756</commentid>
    <comment_count>15</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2005-01-17 03:24:24 +0000</bug_when>
    <thetext>Jess, I'm closing this item.  Please reopen if and only if it's relevant in 
Tomcat 5.5.6.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>69770</commentid>
    <comment_count>16</comment_count>
    <who name="Jess Holle">jessh</who>
    <bug_when>2005-01-17 15:35:25 +0000</bug_when>
    <thetext>I *believe* this has been fixed in recent 4.1, 5.0, and 5.5 releases -- at least
we've not been bitten by it recently.  I've not had a chance to go looking for
it lately either.  If it is still an issue in 5.5 someone will re-open.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>11740</bug_id>
          
          <creation_ts>2002-08-15 19:12:00 +0000</creation_ts>
          <short_desc>Errors on startup during tomcat</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>21099</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-08-15 19:12:06 +0000</bug_when>
    <thetext>When you startup Tomcat 5 there is lot errors related to XML schema in
catalina.out or console depending upon the startup srcipt used.
=====================================
Here is a sample
Aug 14, 2002 12:52:37 PM org.apache.commons.digester.Digester warning
SEVERE: Parse Warning at line 1981 column 20: schema_reference.4: Failed
to read schema document 'null', because 1) could not find the document;
2) the document could not be read; 3) the root element of the document
is not &lt;xsd:schema&gt;.
org.xml.sax.SAXParseException: schema_reference.4: Failed to read schema
document 'null', because 1) could not find the document; 2) the document
could not be read; 3) the root element of the document is not &lt;xsd:schema&gt;.
      at
org.apache.xerces.util.ErrorHandlerWrapper.createSAXParseException(ErrorHandlerWrapper.java:232)
      at
org.apache.xerces.util.ErrorHandlerWrapper.warning(ErrorHandlerWrapper.java:141)
      at
org.apache.xerces.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:358)
      at
org.apache.xerces.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:296)
      at
org.apache.xerces.impl.xs.traversers.XSDHandler.reportSchemaWarning(XSDHandler.java:1841)
      at
org.apache.xerces.impl.xs.traversers.XSDHandler.getSchema(XSDHandler.java:1298)
      at
org.apache.xerces.impl.xs.traversers.XSDHandler.parseSchema(XSDHandler.java:392)
      at
org.apache.xerces.impl.xs.traversers.XSDHandler.parseSchema(XSDHandler.java:381)
      at
org.apache.xerces.impl.xs.XMLSchemaValidator.parseSchema(XMLSchemaValidator.java:2250)
      at
org.apache.xerces.impl.xs.XMLSchemaValidator.findSchemaGrammar(XMLSchemaValidator.java:2178)
      at
org.apache.xerces.impl.xs.XMLSchemaValidator.handleStartElement(XMLSchemaValidator.java:1724)
      at
org.apache.xerces.impl.xs.XMLSchemaValidator.startElement(XMLSchemaValidator.java:568)
      at
org.apache.xerces.impl.XMLNamespaceBinder.handleStartElement(XMLNamespaceBinder.java:832)
      at
org.apache.xerces.impl.XMLNamespaceBinder.startElement(XMLNamespaceBinder.java:568)
      at
org.apache.xerces.impl.dtd.XMLDTDValidator.startElement(XMLDTDValidator.java:796)
      at
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanStartElement(XMLDocumentFragmentScannerImpl.java:752)
      at
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(XMLDocumentFragmentScannerImpl.java:1454)
      at
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:333)
      at
org.apache.xerces.parsers.StandardParserConfiguration.parse(StandardParserConfiguration.java:529)
      at
org.apache.xerces.parsers.StandardParserConfiguration.parse(StandardParserConfiguration.java:585)
      at org.apache.xerces.parsers.XMLParser.parse(XMLParser.java:147)
      at
org.apache.xerces.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1148)
      at org.apache.commons.digester.Digester.parse(Digester.java:1514)
      at
org.apache.catalina.startup.ContextConfig.tldScanStream(ContextConfig.java:1050)
      at
org.apache.catalina.startup.ContextConfig.tldScanJar(ContextConfig.java:994)
      at
org.apache.catalina.startup.ContextConfig.tldScan(ContextConfig.java:941)
      at
org.apache.catalina.startup.ContextConfig.start(ContextConfig.java:720)
      at
org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:247)
      at
org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)
      at
org.apache.catalina.core.StandardContext.start(StandardContext.java:3493)
      at
org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:821)
      at
org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:807)
      at
org.apache.catalina.core.StandardHost.addChild(StandardHost.java:579)
      at
org.apache.catalina.core.StandardHostDeployer.addChild(StandardHostDeployer.java:617)
      at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
      at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
      at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
      at java.lang.reflect.Method.invoke(Method.java:324)
      at
org.apache.commons.beanutils.MethodUtils.invokeMethod(MethodUtils.java:228)
      at org.apache.commons.digester.SetNextRule.end(SetNextRule.java:260)
      at
org.apache.commons.digester.Digester.endElement(Digester.java:1036)
      at
org.apache.xerces.parsers.AbstractSAXParser.endElement(AbstractSAXParser.java:559)
      at
org.apache.xerces.impl.XMLNamespaceBinder.endElement(XMLNamespaceBinder.java:646)
      at
org.apache.xerces.impl.dtd.XMLDTDValidator.handleEndElement(XMLDTDValidator.java:2978)
      at
org.apache.xerces.impl.dtd.XMLDTDValidator.endElement(XMLDTDValidator.java:918)
      at
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.handleEndElement(XMLDocumentFragmentScannerImpl.java:1145)
      at
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanEndElement(XMLDocumentFragmentScannerImpl.java:988)
      at
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(XMLDocumentFragmentScannerImpl.java:1446)
      at
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:333)
      at
org.apache.xerces.parsers.StandardParserConfiguration.parse(StandardParserConfiguration.java:529)
      at
org.apache.xerces.parsers.StandardParserConfiguration.parse(StandardParserConfiguration.java:585)
      at org.apache.xerces.parsers.XMLParser.parse(XMLParser.java:147)
      at
org.apache.xerces.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1148)
      at org.apache.commons.digester.Digester.parse(Digester.java:1514)
      at
org.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:423)
      at
org.apache.catalina.core.StandardHost.install(StandardHost.java:803)
      at
org.apache.catalina.startup.HostConfig.deployDescriptors(HostConfig.java:452)
      at
org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:409)
      at org.apache.catalina.startup.HostConfig.start(HostConfig.java:879)
      at
org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:368)
      at
org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)
      at
org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1196)
      at
org.apache.catalina.core.StandardHost.start(StandardHost.java:738)
      at
org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1188)
      at
org.apache.catalina.core.StandardEngine.start(StandardEngine.java:347)
      at
org.apache.catalina.core.StandardService.start(StandardService.java:497)
      at
org.apache.catalina.core.StandardServer.start(StandardServer.java:2231)
      at org.apache.catalina.startup.Catalina.start(Catalina.java:516)
      at org.apache.catalina.startup.Catalina.execute(Catalina.java:402)
      at org.apache.catalina.startup.Catalina.process(Catalina.java:180)
      at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
      at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
      at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
      at java.lang.reflect.Method.invoke(Method.java:324)
      at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:203)</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>11742</bug_id>
          
          <creation_ts>2002-08-15 19:17:00 +0000</creation_ts>
          <short_desc>jsp:attribute with a non string body</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>21100</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-08-15 19:17:47 +0000</bug_when>
    <thetext>If we have a tag that has an attribute that accepts non -string objects as
values,using &lt;jsp:attribute&gt; to supply values to the attribute throws an
exception. This is a complie time error , this happens because the body of the
jsp:attribute is evaluated ansd converted to a string and then assigned to the
setter method of the tag handler which in turn takes in a argument of type other
than string.
The body of the jsp:attribute contains a expression.

Here is the JSP:

&lt;!-- This JSP tests the use of jsp:attribute and jsp:body with a Custom tag
implementing body support --&gt;

&lt;%@taglib uri="/WEB-INF/JSPAttTL.tld" prefix="att" %&gt;
&lt;%@page import="java.util.*" %&gt;
&lt;jsp:useBean id="depts" class="tlitertag.OrgList" /&gt;
&lt;att:list name="dept"  &gt;
	&lt;jsp:attribute&gt;
		${depts.organization}
	&lt;/jsp:attribute&gt;

    &lt;jsp:body&gt;
      &lt;%=pageContext.getAttribute("dept") %&gt;
    &lt;/jsp:body&gt;
&lt;/att:list&gt;
========
Here entity accepts a value of type java.util.ArrayList and organization is a
property of type ArrayList</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>21101</commentid>
    <comment_count>1</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-08-15 19:23:07 +0000</bug_when>
    <thetext>Oops...
The JSp has a small problem:
it should read as 
&lt;%@taglib uri="/WEB-INF/JSPAttTL.tld" prefix="att" %&gt;
&lt;%@page import="java.util.*" %&gt;
&lt;jsp:useBean id="depts" class="tlitertag.OrgList" /&gt;
&lt;att:list name="dept"  &gt;
&lt;jsp:attribute name="entity" &gt;
${depts.organization}
	&lt;/jsp:attribute&gt;

&lt;jsp:body&gt;
&lt;%=pageContext.getAttribute("dept") %&gt;
&lt;/jsp:body&gt;
&lt;/att:list&gt;

The problem nevertheless exists

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>21991</commentid>
    <comment_count>2</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-08-29 19:26:02 +0000</bug_when>
    <thetext>Fixed.
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>11829</bug_id>
          
          <creation_ts>2002-08-19 17:28:00 +0000</creation_ts>
          <short_desc>Unable to use Property editors with jsp:attribute</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>21288</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-08-19 17:28:55 +0000</bug_when>
    <thetext>This happens while using jsp:setProperty.
Section 2.13.1 of the JSP Spec says that a property editor can be used for
implict concversion od the property values assigned via jsp:setProperty.

I have a property editor defined for  a Date . 
I use jsp:attribute to set the value of the Date via jsp:setProperty, and an 
Illegal Argument exception is thrown.
Here is the sample jsp:
=====================
&lt;!-- This JSP tests to see if a Property Editor works fine with jsp:attribute --
&gt;
&lt;%@page contentType="text/html"%&gt;

&lt;html&gt;
&lt;head&gt;&lt;title&gt;PosPETestDate&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;!-- This JSP is used to test the PropertyEditor.setAstext() method --&gt;

 &lt;jsp:useBean id="peTest"  class="bean.propeditor.PETest" /&gt;


 &lt;jsp:setProperty name="peTest"  property="dateOfBirth" &gt;
        &lt;jsp:attribute name="value"&gt;
          01.02.2001
         &lt;/jsp:attribute&gt;
 &lt;/jsp:setProperty&gt;


The Date of Birth is : &lt;jsp:getProperty name ="peTest" property="dateOfBirth" /&gt;
&lt;/body&gt;
&lt;/html&gt;
==========================

This works fine if the value of the date is given as an XML attribute.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>21913</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-08-28 17:58:20 +0000</bug_when>
    <thetext>Fixed.
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>11883</bug_id>
          
          <creation_ts>2002-08-21 05:18:00 +0000</creation_ts>
          <short_desc>Unable to use Dynamic attributes</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlet &amp; JSP API</component>
          <version>Unknown</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>blocker</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>21422</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-08-21 05:18:51 +0000</bug_when>
    <thetext>The JSP spec says " A tag handler should implement the DynamicAttributes
interface to be able to accept dynamic attributes"

However ,when a tag handler that implements DynamicAttributes  is compiled , an
error is thrown :

Tag Handler &lt;&lt;name&gt;&gt; should be declared abstract  ;it does not define
setDynamicAttribute(java.lang.String,java.lang.String,java.lang.Object) in &lt;&lt;name&gt;&gt;

This causes a problem as according to the spec the container would invoke the
setDynamic Attributes method at runtime.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22195</commentid>
    <comment_count>1</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-03 16:52:44 +0000</bug_when>
    <thetext>Fixed by Mark Roth</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>11884</bug_id>
          
          <creation_ts>2002-08-21 05:21:00 +0000</creation_ts>
          <short_desc>getParent in a SimpleTag implementation returns a Tag</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlet &amp; JSP API</component>
          <version>Unknown</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>21423</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-08-21 05:21:50 +0000</bug_when>
    <thetext>If getparent is called within a tag handler implementing SimpleTag , an instance
of javax.servlet.jsp.tagext.Tag is returned.
According to the spec javax.servlet.jsp.tagext.Tag adapter should be returned</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22196</commentid>
    <comment_count>1</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-03 16:53:12 +0000</bug_when>
    <thetext>Fixed by Mark Roth pending verification</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12003</bug_id>
          
          <creation_ts>2002-08-24 02:58:00 +0000</creation_ts>
          <short_desc>Unable t use jsp:include in a fragment</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>21661</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-08-24 02:58:28 +0000</bug_when>
    <thetext>If a jsp:include is used in a Fragment ( body of a simple tag handler) with 
bodycontent JSP a compilation error is thrown.

==============================
org.apache.jasper.JasperException: Unable to compile class for JSP

An error occurred at line: -1 in the jsp file: null

Generated servlet error:
    [javac] Compiling 1 source file
/home/ps125818/locus/tomcat5-src/jakarta-tomcat-
5/dist/work/Standalone/localhost/jsp20-
tests/jsp2/simpletagspos/STBodyInclActionPos_jsp.java:112: include
(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse,ja
va.lang.String,javax.servlet.jsp.JspWriter,boolean) in 
org.apache.jasper.runtime.JspRuntimeLibrary cannot be applied to 
(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse,ja
va.lang.String,java.io.Writer,boolean)
      JspRuntimeLibrary.include(request, response, "$inclFile", out, false);
                       ^
1 error


	at org.apache.jasper.compiler.DefaultErrorHandler.javacError
(DefaultErrorHandler.java:125)
	at org.apache.jasper.compiler.ErrorDispatcher.javacError
(ErrorDispatcher.java:293)
	at org.apache.jasper.compiler.Compiler.generateClass(Compiler.java:364)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:382)
	at org.apache.jasper.JspCompilationContext.compile
(JspCompilationContext.java:552)
	at org.apache.jasper.servlet.JspServletWrapper.service
(JspServletWrapper.java:241)
	at org.apache.jasper.servlet.JspServlet.serviceJspFile
(JspServlet.java:289)
	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter
(ApplicationFilterChain.java:247)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter
(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.StandardWrapperValve.invoke
(StandardWrapperValve.java:263)
	at 
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex
t(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.catalina.core.StandardContextValve.invoke
(StandardContextValve.java:191)
	at 
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex
t(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.catalina.core.StandardContext.invoke
(StandardContext.java:2487)
	at org.apache.catalina.core.StandardHostValve.invoke
(StandardHostValve.java:180)
	at 
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex
t(StandardPipeline.java:643)
	at org.apache.catalina.valves.ErrorDispatcherValve.invoke
(ErrorDispatcherValve.java:170)
	at 
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex
t(StandardPipeline.java:641)
	at org.apache.catalina.valves.ErrorReportValve.invoke
(ErrorReportValve.java:171)
	at 
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex
t(StandardPipeline.java:641)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.catalina.core.StandardEngineValve.invoke
(StandardEngineValve.java:174)
	at 
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex
t(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service
(CoyoteAdapter.java:223)
	at org.apache.coyote.http11.Http11Processor.process
(Http11Processor.java:405)
	at 
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio
n(Http11Protocol.java:380)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt
(PoolTcpEndpoint.java:508)
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run
(ThreadPool.java:533)
	at java.lang.Thread.run(Thread.java:536)



--------------------------------------------------------------------------------</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>21858</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-08-27 22:44:37 +0000</bug_when>
    <thetext>Fixed.
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12020</bug_id>
          
          <creation_ts>2002-08-25 04:05:00 +0000</creation_ts>
          <short_desc>Using a name-from-attribute in the variable diirective in a tag file gives an error</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Unknown</version>
          <rep_platform>Sun</rep_platform>
          <op_sys>Solaris</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>21701</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-08-25 04:05:11 +0000</bug_when>
    <thetext>If a tag file has a variable directive that has a "name-from-attribute" as an
attribute ,a translation time exception thrown.
Here is the tag file:
=============


&lt;%@tag dynamic-attributes="false" import="java.io.*" isScriptingEnabled="true" %&gt;

&lt;%@attribute name="id" required="true" rtexprvalue="false" %&gt;
&lt;%@attribute name="frag1" fragment="true" required="true"  %&gt;
&lt;%@variable name-from-attribute="url" scope="AT_BEGIN" %&gt;
&lt;jsp:invoke fragment="frag1"/&gt;
&lt;jsp:doBody/&gt;



=============
org.apache.jasper.JasperException: /WEB-INF/tags/tagfilepos/MySimpleTag.tag(6,0)
Variable directive: Invalid attribute, name-from-attribute
	at
org.apache.jasper.compiler.DefaultErrorHandler.jspError(DefaultErrorHandler.java:95)
	at org.apache.jasper.compiler.ErrorDispatcher.dispatch(ErrorDispatcher.java:440)
	at org.apache.jasper.compiler.ErrorDispatcher.jspError(ErrorDispatcher.java:219)
	at org.apache.jasper.compiler.JspUtil.checkAttributes(JspUtil.java:383)
	at
org.apache.jasper.compiler.TagFileProcessor$TagFileVisitor.visit(TagFileProcessor.java:213)
	at org.apache.jasper.compiler.Node$VariableDirective.accept(Node.java:511)
	at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1543)
	at org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:1585)
	at org.apache.jasper.compiler.Node$Visitor.visit(Node.java:1591)
	at org.apache.jasper.compiler.Node$Root.accept(Node.java:334)
	at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1543)
	at
org.apache.jasper.compiler.TagFileProcessor.parseTagFile(TagFileProcessor.java:326)
	at
org.apache.jasper.compiler.TagLibraryInfoImpl.createTagFileInfo(TagLibraryInfoImpl.java:464)
	at
org.apache.jasper.compiler.TagLibraryInfoImpl.parseTLD(TagLibraryInfoImpl.java:289)
	at org.apache.jasper.compiler.TagLibraryInfoImpl.(TagLibraryInfoImpl.java:195)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective(Parser.java:406)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parse(ParserController.java:210)
	at org.apache.jasper.compiler.ParserController.parse(ParserController.java:160)
	at org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:257)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:381)
	at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:552)
	at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:241)
	at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:289)
	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)
	at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:247)
	at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)
	at
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:260)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2505)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at
org.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:171)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:223)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:405)
	at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:380)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:508)
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:533)
	at java.lang.Thread.run(Thread.java:536)</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12046</bug_id>
          
          <creation_ts>2002-08-26 17:06:00 +0000</creation_ts>
          <short_desc>Reloading of tag files when modified</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Unknown</version>
          <rep_platform>All</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>21745</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-08-26 17:06:30 +0000</bug_when>
    <thetext>If a jsp  ( foo.jsp) refers to a tag defined by a tag file (footag.tag) , and
footag.tag is modified after foo.jsp has been compiled ,the footag.tag is not
recompiled and loaded again.
The foo.jsp needs to be recompiled again for these changes to take effect.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>12088</bug_id>
          
          <creation_ts>2002-08-27 16:45:00 +0000</creation_ts>
          <short_desc>When a SkipPageException is thrown from a tag  the JSP returns a HTTP500 ( as the exception is wrapped with a Servlet Exception)</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Unknown</version>
          <rep_platform>All</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>21816</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-08-27 16:45:44 +0000</bug_when>
    <thetext>Lets say we have a JSP that includes a JSP that has a simple tag handler which
throws a SkipPage Exception based upon a certain condition.
In this case the the calling JSP returns a HTTP 500 ( Servlet Exception wrapping
the SkipPage Exception)

This defeats the purpose of using the SkipPage Exception to skip evaluationof
the rest of the page and continiue with the calling page.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12107</bug_id>
          
          <creation_ts>2002-08-27 21:31:00 +0000</creation_ts>
          <short_desc>ContentType header value is set as null while using taglib/include directive</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Unknown</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>21849</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-08-27 21:31:01 +0000</bug_when>
    <thetext>If a JSP page has  an include directive or a taglib directive ,  then the
response header for ContentType  is set as null. It should be text/html"

This causes the XXML style comments and the HTML elemnst also to be displayed in
browsers like Netscape. 
However the display is perfect in IE.

Also having a page directive alone does not cause the header ContentType to be
set to null.To reproduce :
Write  a small JSP with a taglib directive 
Enable the requestdumpervalve in localhost to capture the headers.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22300</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2002-09-04 23:01:14 +0000</bug_when>
    <thetext>The content is null only when a tag file is used.  It is correct for a page that
has an include directive or taglib directive for a classic tag.</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>12109</bug_id>
          
          <creation_ts>2002-08-27 21:58:00 +0000</creation_ts>
          <short_desc>Using functions in EL causes a NPE to be thrown in the GenerateELFunctionMap.java</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Unknown</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>21851</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-08-27 21:58:39 +0000</bug_when>
    <thetext>If a JSP uses a functions defined by EL a translation time NPE is thrown.
==================
rg.apache.jasper.JasperException: Unable to compile class for JSP
	at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:558)
	at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:241)
	at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:289)
	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)
	at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:247)
	at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)
	at
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:260)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2505)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at
org.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:171)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)
	at org.apache.catalina.valves.RequestDumperValve.invoke(RequestDumperValve.java:221)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:223)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:405)
	at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:380)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:508)
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:533)
	at java.lang.Thread.run(Thread.java:536)

root cause

java.lang.NullPointerException
	at org.apache.jasper.compiler.Generator.generateELFunctionMap(Generator.java:593)
	at
org.apache.jasper.compiler.Generator.genPreambleStaticInitializers(Generator.java:391)
	at org.apache.jasper.compiler.Generator.generatePreamble(Generator.java:471)
	at org.apache.jasper.compiler.Generator.generate(Generator.java:2868)
	at org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:279)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:381)
	at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:552)
	at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:241)
	at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:289)
	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)
	at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:247)
	at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)
	at
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:260)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2505)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at
org.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:171)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)
	at org.apache.catalina.valves.RequestDumperValve.invoke(RequestDumperValve.java:221)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:223)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:405)
	at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:380)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:508)
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:533)
	at java.lang.Thread.run(Thread.java:536)

===================</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22044</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-08-30 16:54:24 +0000</bug_when>
    <thetext>Fixed.
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12135</bug_id>
          
          <creation_ts>2002-08-28 18:42:00 +0000</creation_ts>
          <short_desc>servlets-examples application does not get started up</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Examples</component>
          <version>Unknown</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>j2ee14betawaived</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>21916</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-08-28 18:42:23 +0000</bug_when>
    <thetext>This happens because the web.xml contains a mapping for a non existent tld with
WEB-INF/jsp .</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>26379</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2002-11-15 13:48:57 +0000</bug_when>
    <thetext>This was fixed in Tomcat CVS.</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>12147</bug_id>
          
          <creation_ts>2002-08-29 01:05:00 +0000</creation_ts>
          <short_desc>session logout() method does not invalidate the session</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Unknown</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="James Cai">jian.cai</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>21940</commentid>
    <comment_count>0</comment_count>
    <who name="James Cai">jian.cai</who>
    <bug_when>2002-08-29 01:05:56 +0000</bug_when>
    <thetext>After HttpSession.logout()was called, the session is still active. 
The BASIC authentication did not logout the user and ask passwords when the 
logout() method had been called.

The following is the code to call logout()

     Debug.println("LogoutHandler: perform");

        HttpSession session = (HttpSession)signoutevent.get("session");
        if (session!=null)
        {
            Debug.println("current session id:"+ session.getId());
            Debug.println("current session status:" + session.getCreationTime
()); 
            session.logout();
            
            Debug.println("new session id:"+ session.getId());
            Debug.println("new session status:" + session.isNew());
            Debug.println("new session status:" + session.getCreationTime());
         
        }

The folloing is the debug message:

LogoutHandler: perform
current session id:F1C4C622A113E256274753A6B11631A4
current session status:1030582292752
new session id:F1C4C622A113E256274753A6B11631A4
new session status:false
new session status:1030582292752

The following is the security config

&lt;security-constraint&gt;
      &lt;display-name&gt;Security For Container Login&lt;/display-name&gt;
      &lt;web-resource-collection&gt;
         &lt;web-resource-name&gt;Protected Area&lt;/web-resource-name&gt;
         &lt;url-pattern&gt;/control/signin_cfb&lt;/url-pattern&gt;
	 &lt;http-method&gt;DELETE&lt;/http-method&gt;
         &lt;http-method&gt;GET&lt;/http-method&gt;
         &lt;http-method&gt;POST&lt;/http-method&gt;
	 &lt;http-method&gt;PUT&lt;/http-method&gt;
      &lt;/web-resource-collection&gt;
      &lt;auth-constraint&gt;
         &lt;role-name&gt;tomcat&lt;/role-name&gt;
	 &lt;role-name&gt;manager&lt;/role-name&gt;
	 &lt;role-name&gt;engineer&lt;/role-name&gt;
      &lt;/auth-constraint&gt;
    &lt;/security-constraint&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22320</commentid>
    <comment_count>1</comment_count>
    <who name="Bob Herrmann">bob</who>
    <bug_when>2002-09-05 13:08:45 +0000</bug_when>
    <thetext>Hi.  "Basic Authentication" works by challening the browswer when a protected 
resource is requested.  Thereafter, the browser supplies the
username/password/domain with every subsequent request.  Esentially the browser
logs in everytime a request is made.  Therefore, the logout() method cannot
cause the user to get a "login dialog."

When using "Basic Authentication", calling logout() clears the user's session. 
If using SingleSignOn, then all the users sessions are cleared.</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>12201</bug_id>
          
          <creation_ts>2002-08-31 00:04:00 +0000</creation_ts>
          <short_desc>Problme defining values for type element in attributes of  custom actions</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Unknown</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22052</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-08-31 00:04:27 +0000</bug_when>
    <thetext>If the &lt;type&gt; element of an attribute belonging to a Custom Attribute is
specified as "boolean" then a translation exception occurs which says :
Unknown attribute type (boolean) for attribute test

This happens with the JSTL tag &lt;c:when&gt;

This also happens when a attribute has "String" defined as type.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22210</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-09-03 22:37:44 +0000</bug_when>
    <thetext>Fixed.
Problem occurred with *any* primitive type specified with the &lt;type&gt; subelement
of the &lt;attribute&gt; element, not just with "boolean", because we were passing the
type string to Class.forName() in order to determine an attribute's expected
type. Of course, Class.forName() will fail for any primitive types.
Added special treatment for primitive types, which determines the Class object
for a primitive type by appending ".class" to the keyword of the primitive type
(e.g., "boolean.class").</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12269</bug_id>
          
          <creation_ts>2002-09-03 17:27:00 +0000</creation_ts>
          <short_desc>body-content attribute of tag directive needs to be compared in a case insensitive manner</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22199</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-03 17:27:07 +0000</bug_when>
    <thetext>In the TagFileProcessor.java the contents of the "body-content" attribute of 
the tag directive in a tag file are compared with the capitalized version of 
the valid values ( Values from TagInfo.java) .
They need to be compared in a case \-insensitive manner</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12282</bug_id>
          
          <creation_ts>2002-09-04 01:35:00 +0000</creation_ts>
          <short_desc>NPE thrown when a tag defined by a tag file is specified as a fragment in the attribute of  a tag defined by tag file</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Unknown</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22217</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-04 01:35:40 +0000</bug_when>
    <thetext>Lets take a tag defined by a tag file.This tag would take in an attribute of
type fragment. The fragment would consist of another tag . This tag would also
be defined by a tag file.
In such a case a NPE is thrown.

&lt;tf:outertag &gt;
  &lt;jsp:attribute name="frag"&gt;
    &lt;tf:innertag /&gt;
   &lt;/jsp:attribute&gt;
&lt;/tf:outertag&gt;

where innertag and outertag are tags defined by tag files.

===================
org.apache.jasper.JasperException: Unable to compile class for JSP
	at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:558)
	at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:270)
	at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:289)
	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)
	at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:247)
	at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)
	at
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:260)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2505)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at
org.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:171)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:223)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:405)
	at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:380)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:508)
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:533)
	at java.lang.Thread.run(Thread.java:536)

root cause

java.lang.NullPointerException
	at java.beans.Introspector.findExplicitBeanInfo(Introspector.java:380)
	at java.beans.Introspector.(Introspector.java:331)
	at java.beans.Introspector.getBeanInfo(Introspector.java:132)
	at org.apache.jasper.compiler.Generator$TagHandlerInfo.(Generator.java:3235)
	at org.apache.jasper.compiler.Generator$GenerateVisitor.visit(Generator.java:1470)
	at org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1021)
	at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1543)
	at org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:1585)
	at
org.apache.jasper.compiler.Generator$GenerateVisitor.generateJspFragment(Generator.java:2675)
	at
org.apache.jasper.compiler.Generator$GenerateVisitor.generateNamedAttributeJspFragment(Generator.java:2748)
	at
org.apache.jasper.compiler.Generator$GenerateVisitor.generateSetters(Generator.java:2486)
	at
org.apache.jasper.compiler.Generator$GenerateVisitor.generateCustomDoTag(Generator.java:2176)
	at org.apache.jasper.compiler.Generator$GenerateVisitor.visit(Generator.java:1539)
	at org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1021)
	at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1543)
	at org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:1585)
	at org.apache.jasper.compiler.Node$Visitor.visit(Node.java:1591)
	at org.apache.jasper.compiler.Node$Root.accept(Node.java:334)
	at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1543)
	at org.apache.jasper.compiler.Generator.generate(Generator.java:2888)
	at org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:279)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:381)
	at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:552)
	at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:270)
	at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:289)
	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)
	at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:247)
	at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)
	at
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:260)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2505)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at
org.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:171)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:223)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:405)
	at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:380)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:508)
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:533)
	at java.lang.Thread.run(Thread.java:536)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22287</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-09-04 17:28:05 +0000</bug_when>
    <thetext>Fixed.
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12283</bug_id>
          
          <creation_ts>2002-09-04 01:44:00 +0000</creation_ts>
          <short_desc>If a tag implementing SimpleTag is invoked within a tag file a NPE is thrown</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Unknown</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22218</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-04 01:44:45 +0000</bug_when>
    <thetext>A tag file invokes a tag that implements SimpleTag.
This causes a NPE to be thrown at translation.
====================
This is the JSP file
&lt;!-- This JSP calls a tag defined by a tag file that calls a Simple Tag that
returns a SkipPageException --&gt;

&lt;%@taglib uri="/TagFile" prefix="tf" %&gt;

This is the template text before the tag

&lt;tf:NestSTEx start="0" end="10" /&gt;

This is the template text after the tag
=======================================
This is the tag file for NestSTEx
========================================

&lt;!-- The tag file defines a tag that calls a Simple Tag that returns a SKIP_PAGE --&gt;
&lt;%@tag dynamic-attributes="false" isELEnabled="true" isScriptingEnabled="true" %&gt;
&lt;%@taglib uri="/SimpleTaglib" prefix="st" %&gt;
&lt;%@attribute name="start" type="integer" rtexprvalue="false" %&gt;
&lt;%@attribute name="end" type="integer" rtexprvalue="false" %&gt;

This is the template text in the body of the tag file

&lt;st:simpleEx start="10" end="0" &gt;
	Template text here 
&lt;/st:simpleEx&gt;


This is the text after the inclusion of the tag 
&lt;jsp:doBody/&gt;

===================================================</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22282</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-09-04 16:43:09 +0000</bug_when>
    <thetext>Fixed.
(Notice that the fact that the SimpleTag was throwing a SkipPageException was
irrelevant for this bug.)</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12319</bug_id>
          
          <creation_ts>2002-09-04 21:47:00 +0000</creation_ts>
          <short_desc>Compile Error when a Classic Tag is nested in the jsp:attribute of a Simple Tag</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22293</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-04 21:47:50 +0000</bug_when>
    <thetext>Lets take the case :
&lt;st:simpleTag att1="var" &gt;
   &lt;jsp:attribute name="param" &gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22294</commentid>
    <comment_count>1</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-04 21:54:13 +0000</bug_when>
    <thetext>--------------------------------------------------------------------------------

Lets take the case :
&lt;st:simpleTag att1="var" &gt;
   &lt;jsp:attribute name="param" &gt;
      &lt;ct:classicTag var="name" /&gt;
   &lt;/jsp:attribute&gt;

  &lt;jsp:body&gt;
    &lt;st:simpleTag1 att2="${var}" &gt;
      &lt;jsp:attribute name="param1" &gt;
           Somevalue 
      &lt;/jsp:attribute&gt;
     &lt;jsp:body&gt;
        &lt;ct:classicTag1 var1="name1" &gt;
        .....
      &lt;/jsp:body&gt;
     &lt;/st:simpleTag1&gt;
   &lt;/jsp:body&gt;
  &lt;/st:simpleTag&gt;
===============================================
When a jsp like this gets translated there are couple of "return;" statement 
inside the public boolean invokex (where x=0,1,2) methods.
This causes a compilation error.


</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22296</commentid>
    <comment_count>2</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-04 21:56:47 +0000</bug_when>
    <thetext>*** Bug 12318 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22625</commentid>
    <comment_count>3</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-09-10 21:51:41 +0000</bug_when>
    <thetext>Fixed.
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12321</bug_id>
          
          <creation_ts>2002-09-04 22:37:00 +0000</creation_ts>
          <short_desc>StackOverflow Exception when a tag defined by a tag file is called within a tag file</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22298</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-04 22:37:23 +0000</bug_when>
    <thetext>If a tag file invokes a another tag defined by a tag file within the same sub-
directory under WEB-INF/tags AND the taglib directive uses an Implicit Tag 
Library a java.lang.StackOverflowException occurs.

===========================================
javax.servlet.ServletException
	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:248)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter
(ApplicationFilterChain.java:247)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter
(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.StandardWrapperValve.invoke
(StandardWrapperValve.java:260)
	at 
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex
t(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.catalina.core.StandardContextValve.invoke
(StandardContextValve.java:191)
	at 
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex
t(StandardPipeline.java:643)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke
(AuthenticatorBase.java:474)
	at 
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex
t(StandardPipeline.java:641)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.catalina.core.StandardContext.invoke
(StandardContext.java:2505)
	at org.apache.catalina.core.StandardHostValve.invoke
(StandardHostValve.java:180)
	at 
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex
t(StandardPipeline.java:643)
	at org.apache.catalina.valves.ErrorDispatcherValve.invoke
(ErrorDispatcherValve.java:170)
	at 
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex
t(StandardPipeline.java:641)
	at org.apache.catalina.valves.ErrorReportValve.invoke
(ErrorReportValve.java:171)
	at 
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex
t(StandardPipeline.java:641)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.catalina.core.StandardEngineValve.invoke
(StandardEngineValve.java:174)
	at 
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex
t(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service
(CoyoteAdapter.java:223)
	at org.apache.coyote.http11.Http11Processor.process
(Http11Processor.java:405)
	at 
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio
n(Http11Protocol.java:380)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt
(PoolTcpEndpoint.java:508)
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run
(ThreadPool.java:533)
	at java.lang.Thread.run(Thread.java:536)


root cause 

java.lang.StackOverflowError
	at java.io.File.(File.java:266)
	at org.apache.naming.resources.FileDirContext.file
(FileDirContext.java:857)
	at org.apache.naming.resources.FileDirContext.listBindings
(FileDirContext.java:361)
	at org.apache.naming.resources.ProxyDirContext.listBindings
(ProxyDirContext.java:523)
	at org.apache.catalina.core.ApplicationContext.listCollectionPaths
(ApplicationContext.java:1120)
	at org.apache.catalina.core.ApplicationContext.getResourcePathsInternal
(ApplicationContext.java:739)
	at org.apache.catalina.core.ApplicationContext.getResourcePaths
(ApplicationContext.java:721)
	at org.apache.catalina.core.ApplicationContextFacade.getResourcePaths
(ApplicationContextFacade.java:158)
	at org.apache.jasper.JspCompilationContext.getResourcePaths
(JspCompilationContext.java:270)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:113)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)
	at org.apache.jasper.compiler.TagFileProcessor.parseTagFile
(TagFileProcessor.java:316)
	at org.apache.jasper.compiler.ImplicitTagLibraryInfo.
(ImplicitTagLibraryInfo.java:126)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective
(Parser.java:412)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:149)
	at org.apache.jasper.compiler.ParserController.parseFile
(ParserController.java:234)
	at org.apache.jasper.compiler.ParserController.parseTagFile
(ParserController.java:185)



--------------------------------------------------------------------------------

Apache Tomcat/5.0</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22331</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-09-05 18:34:02 +0000</bug_when>
    <thetext>Fixed.
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12343</bug_id>
          
          <creation_ts>2002-09-05 20:11:00 +0000</creation_ts>
          <short_desc>Dynamic Attributes specified via jsp:attribute not recognized if specified as body content</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Unknown</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22332</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-05 20:11:49 +0000</bug_when>
    <thetext>If a tag is declared to accept Dynamic Attributes ,and the attributes are
specified as body to &lt;jsp:attribute&gt; tags,the container does not seem to
recognize them
This happens in cases where the tag is either a Simple tag or a Classic tag.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22343</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-09-06 00:15:39 +0000</bug_when>
    <thetext>Fixed.
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12381</bug_id>
          
          <creation_ts>2002-09-06 20:49:00 +0000</creation_ts>
          <short_desc>Mangling file names not unique</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Steve Downey">steve.downey</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22392</commentid>
    <comment_count>0</comment_count>
    <who name="Steve Downey">steve.downey</who>
    <bug_when>2002-09-06 20:49:36 +0000</bug_when>
    <thetext>If the file name doesn't start with a valid java identifier start character, a 
_ is prepended. Unfortunately, _ is a valid java identifier start character. 
So, for example, 0.jsp and _0.jsp, will both be mapped to _0_jsp.java.  
 
In general, if _ is to be used as an escape character, _ needs to be escaped 
itself.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22401</commentid>
    <comment_count>1</comment_count>
      <attachid>2964</attachid>
    <who name="Steve Downey">steve.downey</who>
    <bug_when>2002-09-07 03:55:43 +0000</bug_when>
    <thetext>Created attachment 2964
fixes mangling to handle '_' as the escape char</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22402</commentid>
    <comment_count>2</comment_count>
    <who name="Steve Downey">steve.downey</who>
    <bug_when>2002-09-07 04:00:15 +0000</bug_when>
    <thetext>The fix doesn't quite fix everything. For example, the jsp files "a(.jsp" and 
a_00028.jsp will be mapped to the same java class file. 
 
The attached patch mangles all non-valid characters plus '_'. It also shortens 
the mangled sequence. Chars range in value from \u0000 to \uFFFF, so only 4 
hex digits are required, not 5. The total string length is 5 instead of 6. 
 
 </thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>2964</attachid>
            <date>2002-09-07 03:55:00 +0000</date>
            <delta_ts>2002-09-07 03:55:43 +0000</delta_ts>
            <desc>fixes mangling to handle '_' as the escape char</desc>
            <filename>Mangle.patch</filename>
            <type>text/plain</type>
            <size>2974</size>
            <attacher name="Steve Downey">steve.downey</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12393</bug_id>
          
          <creation_ts>2002-09-08 02:18:00 +0000</creation_ts>
          <short_desc>Compile time error if passing EL as argument to property attribute</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Unknown</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22436</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-08 02:18:18 +0000</bug_when>
    <thetext>The following compile time error occurs when a JSP has a set property that has
an EL expression supplying  a value to the "value" attribute of the jsp:property
action.

An error occurred at line: 15 in the jsp file: /jsp2/jspelpos/ELOperatorCompPos.jsp

Generated servlet error:
    [javac] Compili
ng 1 source file
/home/ps125818/locus/tomcat5-src/jakarta-tomcat-5/dist/work/Standalone/localhost/tcatjsp2-tests/jsp2/jspelpos/ELOperatorCompPos_jsp.java:87:
handleSetPropertyExpression(java.lang.Object,java.lang.String,java.lang.String,javax.servlet.jsp.PageContext,javax.servlet.jsp.el.VariableResolver,javax.servlet.jsp.el.FunctionMapper)
in org.apache.jasper.runtime.JspRuntimeLibrary cannot be applied to
(java.lang.Object,java.lang.String,java.lang.String,javax.servlet.jsp.PageContext,javax.servlet.jsp.PageContext,org.apache.jsp.ELOperatorCompPos_jsp)
     
JspRuntimeLibrary.handleSetPropertyExpression(pageContext.findAttribute("cust"),
"firstName", "${list[1].firstName}", pageContext, pageContext, this );
                       ^
1 error


	at
org.apache.jasper.compiler.DefaultErrorHandler.javacError(DefaultErrorHandler.java:125)
	at org.apache.jasper.compiler.ErrorDispatcher.javacError(ErrorDispatcher.java:293)
	at org.apache.jasper.compiler.Compiler.generateClass(Compiler.java:364)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:382)
	at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:553)
	at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:270)
	at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:289)
	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)
	at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:247)
	at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)
	at
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:260)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2505)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at
org.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:171)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:223)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:405)
	at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:380)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:508)
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:533)
	at java.lang.Thread.run(Thread.java:536)
============
Here is the JSP:

This JSP demonstrates the use of "[]" and "." operators to access methods and
properties via EL

The bean is an ArrayList of classes of type Customer. &lt;br&gt;
Each Customer has the following properties:
id&lt;br&gt;
First Name &lt;br&gt;
Last Name &lt;br&gt;
Sex&lt;br&gt;
The idea is to demonstrate the access of the Customer peroperties using the EL. &lt;br&gt;


&lt;jsp:useBean id="list" class="misc.CustomerList" /&gt;

&lt;jsp:useBean id="cust" class="misc.Customer" /&gt;

&lt;jsp:setProperty name="cust" property="firstName" value="${list[1].firstName}" /&gt;

The customer's first name is ${cust.firstName}





The first Name of the First Customer : ${list[0].firstName} &lt;br&gt;
The last Name of the Last Customer : ${list[4].lastName}</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22545</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-09-09 18:13:58 +0000</bug_when>
    <thetext>Fixed.
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12414</bug_id>
          
          <creation_ts>2002-09-09 05:02:00 +0000</creation_ts>
          <short_desc>Tag file defined in XML syntax does not seem to recignize import attribute in tag directive</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>j2ee14betawaived</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22479</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-09 05:02:01 +0000</bug_when>
    <thetext>If a tag file is defined in XML syntax , then the value of the attribute import 
in the tag directive is not reflected in the import list in the Simple Tag 
Handler ( java) file that this tag file is translated into.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12456</bug_id>
          
          <creation_ts>2002-09-09 20:20:00 +0000</creation_ts>
          <short_desc>RequestDispatcher for ERROR value does not get filtered</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Unknown</version>
          <rep_platform>PC</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="James Cai">jian.cai</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22552</commentid>
    <comment_count>0</comment_count>
    <who name="James Cai">jian.cai</who>
    <bug_when>2002-09-09 20:20:55 +0000</bug_when>
    <thetext>A servlet (reqServlet.class) throws a 404 error page using:

    resp.sendError(404, "Error from ReqDispacherServlet");

That error page has been mapped with a filter with 
&lt;dispatcher&gt;ERROR&lt;/dispatcher&gt;.

  &lt;filter-mapping&gt;
        &lt;filter-name&gt;DispatcherFilterErr&lt;/filter-name&gt;
        &lt;url-pattern&gt;/error&lt;/url-pattern&gt;
        &lt;dispatcher&gt;ERROR&lt;/dispatcher&gt;
   &lt;/filter-mapping&gt;

The error page is set as :

   &lt;error-page&gt;
        &lt;error-code&gt;
            404
        &lt;/error-code&gt;
        &lt;location&gt;
            /error
        &lt;/location&gt;
    &lt;/error-page&gt;

However, a call to reqServlet did not activate the  filter (DispatchFilterErr).

SRV.6.2.5 states: the Filter will be applied to the request "only when the 
request is being processed with the error page mechanism specified in SRV9.9 to 
an error resource matching the &lt;url-pattern&gt;. This is indicated by a 
&lt;dispatcher&gt; element with the value ERROR."</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22714</commentid>
    <comment_count>1</comment_count>
    <who name="Amy Roh">amyroh</who>
    <bug_when>2002-09-12 00:10:23 +0000</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12457</bug_id>
          
          <creation_ts>2002-09-09 20:47:00 +0000</creation_ts>
          <short_desc>Filter does not work when RequestDispatcher uses INCLUDE value</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Unknown</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="James Cai">jian.cai</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>gregory.murray</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22554</commentid>
    <comment_count>0</comment_count>
    <who name="James Cai">jian.cai</who>
    <bug_when>2002-09-09 20:47:04 +0000</bug_when>
    <thetext>servlet "/reqdisp" calls a request disapcher (named rd) has name 
commencing 'admin' which uses 

RequestDispatcher rd = req.getRequestDispatcher("/admin");
rd.include(req, resp);

A filter has been mapped to /admin:

   &lt;filter-mapping&gt;
        &lt;filter-name&gt;DispatcherFilterIcd&lt;/filter-name&gt;
        &lt;url-pattern&gt;/admin&lt;/url-pattern&gt;
        &lt;dispatcher&gt;INCLUDE&lt;/dispatcher&gt;
   &lt;/filter-mapping&gt;

but when request /reqdisp, the filter does not work (it has been initialized).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22715</commentid>
    <comment_count>1</comment_count>
    <who name="Amy Roh">amyroh</who>
    <bug_when>2002-09-12 00:10:40 +0000</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>23315</commentid>
    <comment_count>2</comment_count>
    <who name="James Cai">jian.cai</who>
    <bug_when>2002-09-24 17:41:59 +0000</bug_when>
    <thetext>In the lastest Integration with J2EE RI, this problem occured again. It was 
fixed before</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>23337</commentid>
    <comment_count>3</comment_count>
    <who name="Amy Roh">amyroh</who>
    <bug_when>2002-09-24 23:07:59 +0000</bug_when>
    <thetext>Can you see if this works with the latest update of web-app_2_4.xsd?  The new 
web-app_2_4.xsd is checked into the cvs.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>26971</commentid>
    <comment_count>4</comment_count>
    <who name="Bob Herrmann">bob</who>
    <bug_when>2002-11-25 21:47:31 +0000</bug_when>
    <thetext>Hey, Is anybody looking at this? (my guess, no.)   I am starting to look into it.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33884</commentid>
    <comment_count>5</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2003-03-27 02:13:09 +0000</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12461</bug_id>
          
          <creation_ts>2002-09-09 21:47:00 +0000</creation_ts>
          <short_desc>Jasper imports classes it shouldn't</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>j2ee14betawaived</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Steve Downey">steve.downey</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22557</commentid>
    <comment_count>0</comment_count>
    <who name="Steve Downey">steve.downey</who>
    <bug_when>2002-09-09 21:47:56 +0000</bug_when>
    <thetext>Jasper imports 'org.apache.jasper.runtime.*' in the java it generates. According
to spec, the only default imports should be "javax.servlet.*",
"javax.servlet.http.*", and "javax.servlet.jsp.*"

Classes from the o.a.j.runtime package should be used via fully qualified names. 

see attached patch (supercedes one posted to tomcat-dev as there's a conflict now)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22558</commentid>
    <comment_count>1</comment_count>
      <attachid>2981</attachid>
    <who name="Steve Downey">steve.downey</who>
    <bug_when>2002-09-09 21:49:14 +0000</bug_when>
    <thetext>Created attachment 2981
replaces o.a.j.runtime imports with fully qualified class names</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>23162</commentid>
    <comment_count>2</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-09-20 17:53:22 +0000</bug_when>
    <thetext>Fixed. Thanks for the patch!

</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>2981</attachid>
            <date>2002-09-09 21:49:00 +0000</date>
            <delta_ts>2002-09-09 21:49:14 +0000</delta_ts>
            <desc>replaces o.a.j.runtime imports with fully qualified class names</desc>
            <filename>NoJasperRuntimeImport.patch</filename>
            <type>text/plain</type>
            <size>5651</size>
            <attacher name="Steve Downey">steve.downey</attacher>
            

          </attachment>
      

    <bug_classification class="CLEANUP">CLEANUP</bug_classification></bug>
    <bug>
          <bug_id>12466</bug_id>
          
          <creation_ts>2002-09-10 01:29:00 +0000</creation_ts>
          <short_desc>Unable to call jsp:invoke in the body of a classic/simple tag in a tag file.</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22567</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-10 01:29:24 +0000</bug_when>
    <thetext>If in a tag file there are two tags :

&lt;ct:ClassicTag var="foo" &gt;
  &lt;st:SimpleTag&gt;
     &lt;jsp:invoke fragment="fragment1" /&gt;
  &lt;/st:SimpleTag&gt;
&lt;/ct:ClassicTag&gt;

In this case when the tag file is complied a compile time error is thrown :
location: class org.apache.jsp.tagfile.dbAccess.dbAccessHelper
      _jspx_params = new java.util.HashMap();
      ^
/home/ps125818/locus/tomcat5-src/jakarta-tomcat-5/dist/work/Standalone/localhost/ActTrack/tagfiles/org/apache/jsp/tagfile/dbAccess.java:178:
cannot resolve symbol
symbol  : variable _jspx_params  
location: class org.apache.jsp.tagfile.dbAccess.dbAccessHelper
getQuery().invoke(null, _jspx_params);
                        ^

In the invoke method _jspx_params is not defined. 
The Map object "params" passed in the signature of should be used ?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22696</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-09-11 18:08:32 +0000</bug_when>
    <thetext>Fixed.
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12467</bug_id>
          
          <creation_ts>2002-09-10 01:33:00 +0000</creation_ts>
          <short_desc>Unable to call jsp:invoke withing a classic tag handler in a tag file</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22568</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-10 01:33:25 +0000</bug_when>
    <thetext>If a classic tag handler has a jsp:invoke action in its body, a compile time
error is thrown while compiling the java file generated.
This is related to the non-decalartion of the Map _jspx_params in the tag
handler method craeted in the java file for the tag file.

Test case 
/ActTrack/WEB-INF/tags/database/dbAccessCT.tag
/ActTrack/jsp/Review/status_review_proj_CT.jsp?by=proj&amp;fromdate=2001-01-01&amp;todate=2001-12-12</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22697</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-09-11 18:08:53 +0000</bug_when>
    <thetext>Fixed.
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12469</bug_id>
          
          <creation_ts>2002-09-10 02:41:00 +0000</creation_ts>
          <short_desc>Whitespace has different definition in XML and Java</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Steve Downey">steve.downey</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22572</commentid>
    <comment_count>0</comment_count>
    <who name="Steve Downey">steve.downey</who>
    <bug_when>2002-09-10 02:41:23 +0000</bug_when>
    <thetext>According to the JSP spec [5.2.1] in a JSP Document, all textual nodes which
contain only whitespace, except for jsp:text, are dropped. However the
definition of whitespace is not the same as that of Java. The formfeed character
is NOT a whitespace character in XML, and is in Character.isSpace(). The JSP
spec actually calls these out literally.

Yes, this is anal. I was only looking at it because isSpace is also happens to
be a deprecated method.

Patch will be attached.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22574</commentid>
    <comment_count>1</comment_count>
      <attachid>2985</attachid>
    <who name="Steve Downey">steve.downey</who>
    <bug_when>2002-09-10 03:14:27 +0000</bug_when>
    <thetext>Created attachment 2985
replace Character.isSpace() with tests against literals</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>2985</attachid>
            <date>2002-09-10 03:14:00 +0000</date>
            <delta_ts>2002-09-10 03:14:27 +0000</delta_ts>
            <desc>replace Character.isSpace() with tests against literals</desc>
            <filename>whitespace-xml-def.patch</filename>
            <type>text/plain</type>
            <size>696</size>
            <attacher name="Steve Downey">steve.downey</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12558</bug_id>
          
          <creation_ts>2002-09-12 02:26:00 +0000</creation_ts>
          <short_desc>Unable to capture fragment evaluation in a Writer if the fragment writes to the default 'out'</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>j2ee14betawaived</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22721</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-12 02:26:54 +0000</bug_when>
    <thetext>Lets take the case when a Simple Tag evaluates its body and captures the
evaluation in a StringWriter.
The body in turn consists of a classic tag ( or simple tag) that writes some
text to the default writer ( using pageContext.getOut().println() )

What happens is that the text gets written into the default out and is not
captured by the StringWriter.

&lt;st:SimpleTag att1="attvalue1"&gt;
   &lt;ct:classictag&gt;
    &lt;/ct:classictag&gt;
&lt;/st:simpletag&gt;</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12559</bug_id>
          
          <creation_ts>2002-09-12 04:13:00 +0000</creation_ts>
          <short_desc>setLocale gives wrong content type</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Unknown</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="James Cai">jian.cai</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22724</commentid>
    <comment_count>0</comment_count>
    <who name="James Cai">jian.cai</who>
    <bug_when>2002-09-12 04:13:31 +0000</bug_when>
    <thetext>The following entry in web.xml set a locale mapping to encoding.

      &lt;locale-encoding-mapping-list&gt;
        &lt;locale-encoding-mapping&gt;
            &lt;locale&gt;zh&lt;/locale&gt;
            &lt;encoding&gt;gb2312&lt;/encoding&gt;
        &lt;/locale-encoding-mapping&gt;
      &lt;/locale-encoding-mapping-list&gt;

The servlet (AdminServlet) set the locale of response if the request parameter 
has "lan".

When access /admin?lan=zh, the broswer tried to save the file as a binary file.
When access /admin?lan=en, the broswer tried to save the file as a binary file.
When access /admin, the broswer shown the HTML file
When access /admin?lan=(other), the broswer shown the HTML file.

It seemed the setLocale() incorrectly changed the content_type of the response 
when the locale to be set to zh or en.

public class AdminServlet extends HttpServlet {

    String precedence="starting";
    
    public void init(ServletConfig sc) throws ServletException {

    }


    public void service (ServletRequest request,ServletResponse response) 
throws ServletException, IOException {
        
       response.setContentType("text/html"); 
       
       String languagepref = request.getParameter("lan");
                if (languagepref!=null)
                {
                    response.setLocale(new java.util.Locale
(languagepref));                    
                }

        //response.setContentType("text/html");	
        PrintWriter out = response.getWriter();	
        
        out.println("&lt;HTML&gt;\n");
        out.println("&lt;Body&gt;\n");
	out.println("&lt;p&gt;Admin Servelt&lt;/p&gt;\n");

        out.println("characterecoding: " + response.getCharacterEncoding()
+ "\n");
        out.println("locale: " + response.getLocale()+ "\n");
       // out.flush();
    }
}</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22739</commentid>
    <comment_count>1</comment_count>
    <who name="Kan Ogawa">super-creek</who>
    <bug_when>2002-09-12 14:01:03 +0000</bug_when>
    <thetext>Hi, James.

If you use my patch for Bug 10901, is Bug 12559 solved ???
( Bug 10901 is different from this bug. )

When customizing the patch for Bug 10901,
I encountered the same phenomenon as this bug you reported.
However, I didn't detect that bug at this time.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22886</commentid>
    <comment_count>2</comment_count>
    <who name="Patrick Luby">patrick.luby</who>
    <bug_when>2002-09-15 20:12:28 +0000</bug_when>
    <thetext>I tried this test case in the latest Tomcat 5 and the servlet always returns
valid HTML with the expected values. So, it appears that the patch for bug 10901
fixed this problem.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12590</bug_id>
          
          <creation_ts>2002-09-12 20:02:00 +0000</creation_ts>
          <short_desc>Unable to nest jsp:attribute within jsp:body if used with jsp:include</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22758</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-12 20:02:36 +0000</bug_when>
    <thetext>A test case like:

&lt;jsp:include &gt;
   &lt;jsp:attribute name="page&gt;
     foo.jsp
    &lt;/jsp:attribute&gt;
    &lt;jsp:body&gt;
       &lt;jsp:param&gt;
          &lt;jsp:attribute name="name" &gt;
            ....
 ....
&lt;/jsp:include&gt;

Throws a error :
============
org.apache.jasper.JasperException: /jsp2/jspattrpos/param-in-param.jsp(13,15)
Not allowed in a template text body.
	at
org.apache.jasper.compiler.DefaultErrorHandler.jspError(DefaultErrorHandler.java:95)
	at org.apache.jasper.compiler.ErrorDispatcher.dispatch(ErrorDispatcher.java:440)
	at org.apache.jasper.compiler.ErrorDispatcher.jspError(ErrorDispatcher.java:126)
	at org.apache.jasper.compiler.Parser.parseElementsTemplateText(Parser.java:1524)
	at org.apache.jasper.compiler.Parser.parseBody(Parser.java:1642)
	at org.apache.jasper.compiler.Parser.parseNamedAttributes(Parser.java:1688)
	at org.apache.jasper.compiler.Parser.parseEmptyBody(Parser.java:904)
	at org.apache.jasper.compiler.Parser.parseParam(Parser.java:792)
	at org.apache.jasper.compiler.Parser.parseBody(Parser.java:1639)
	at org.apache.jasper.compiler.Parser.parseJspBody(Parser.java:1574)
	at org.apache.jasper.compiler.Parser.parseJspAttributeAndBody(Parser.java:1016)
	at org.apache.jasper.compiler.Parser.parseOptionalBody(Parser.java:981)
	at org.apache.jasper.compiler.Parser.parseInclude(Parser.java:821)
	at org.apache.jasper.compiler.Parser.parseAction(Parser.java:1140)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1420)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:159)
	at org.apache.jasper.compiler.ParserController.parseFile(ParserController.java:245)
	at org.apache.jasper.compiler.ParserController.parse(ParserController.java:169)
	at org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:259)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:409)
	at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:570)
	at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:295)
	at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:289)
	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)
	at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:247)
	at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)
	at
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:271)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2505)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at
org.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:171)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:223)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:405)
	at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:380)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:508)
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:533)
	at java.lang.Thread.run(Thread.java:536)</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12594</bug_id>
          
          <creation_ts>2002-09-12 20:35:00 +0000</creation_ts>
          <short_desc>If a SKIP_PAGE is returned from a classic tag nested within a Simple Tag , the page following the simple tag is displayed</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22762</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-12 20:35:55 +0000</bug_when>
    <thetext>Lets take this case :
&lt;st:simpletag att="val1" &gt;
   &lt;ct:tagex att2="val2"&gt;
      I return a SKIP_PAGE 
    &lt;/st:tagex&gt;
     Template text 
&lt;/st:simpletag&gt;
   This is the text after the simple tag

In such a case where ct:tagex returns a SKIP_PAGE in the doEndTag the text after
the end tag of the simple tag handler is displayed.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12638</bug_id>
          
          <creation_ts>2002-09-14 01:59:00 +0000</creation_ts>
          <short_desc>${pageContext.errorData.throwable.message} throws an error</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22857</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-14 01:59:08 +0000</bug_when>
    <thetext>If a error page has a EL expression that tries to recover the error message 
thrown in the EL is unable to locate the ErrorData object using the following 
expression

${pageContext.errorData.throwable.message}

javax.servlet.jsp.JspException: An error occurred while evaluating custom 
action attribute "&lt;unknown&gt;" with 
value "${pageContext.errorData.throwable.message}": An error occurred while 
getting property "errorData" from an instance of class 
org.apache.jasper.runtime.PageContextImpl
   at org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate
(PageContextImpl.java:600)
   at org.apache.jsp.errorpage_jsp._jspService(errorpage_jsp.java:83)


Test Case: /jsp20-tests/jsp2/Exception.jsp</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>23131</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-09-20 00:47:36 +0000</bug_when>
    <thetext>Fixed (pending patch to jsr152/src/share/javax/servlet/jsp/PageContext.java in
jakarta-servletapi-5 repository).
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12653</bug_id>
          
          <creation_ts>2002-09-15 01:13:00 +0000</creation_ts>
          <short_desc>include-coda does not get included if JSP has a taglib directive</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22870</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-15 01:13:11 +0000</bug_when>
    <thetext>If a JSP has a configuration element that defines a include-coda for it,and it 
also has a taglib directive within the JSP,then the include-coda does not get 
included.
test case:
jsp20-tests/jsp2/include/srcinclude/JSPConfScrEnablePos.jsp</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22889</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-09-15 23:12:45 +0000</bug_when>
    <thetext>Fixed.
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12654</bug_id>
          
          <creation_ts>2002-09-15 01:17:00 +0000</creation_ts>
          <short_desc>Translation Exception not thrown when a pageEncoding directive specifies a different pageEncoding than the one specified by configuration elements</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22871</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-15 01:17:03 +0000</bug_when>
    <thetext>If a JSP has a configuration element defined for a page-encoding , and a page-
encoding directive specifies a different encoding (say UTF-8) then as per the 
spec a translation exception should be thrown , but is not thrown

Test case:
/jsp20-tests/jsp2/JSPConfneg/pageencoding/*.jsp</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22885</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-09-15 19:13:47 +0000</bug_when>
    <thetext>Fixed.
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12715</bug_id>
          
          <creation_ts>2002-09-16 23:53:00 +0000</creation_ts>
          <short_desc>webapp_2_4.xsd missed "ERROR" value in "dispatcher"</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlet &amp; JSP API</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="James Cai">jian.cai</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22962</commentid>
    <comment_count>0</comment_count>
    <who name="James Cai">jian.cai</who>
    <bug_when>2002-09-16 23:53:58 +0000</bug_when>
    <thetext>The dispatcherType in webapp_2_4.xsd missed the ERROR value:

&lt;xsd:simpleType name="dispatcherType"&gt;
&lt;xsd:annotation&gt;
&lt;xsd:documentation&gt;

The dispatcher has three legal values, FORWARD and REQUEST
and INCLUDE. A value of FORWARD means the Filter
will be applied under RequestDispatcher.forward() calls.
A value of REQUEST means the Filter will be applied
under ordinary client calls to the path or servlet. A value of
INCLUDE means the Filter will be applied under
RequestDispatcher.include() calls.
The absence of any dispatcher elements in a
filter-mapping indicates a default of applying
filters only under ordinary client calls to the path or servlet.

&lt;/xsd:documentation&gt;
&lt;/xsd:annotation&gt;

    &lt;xsd:restriction base="j2ee:string"&gt;
        &lt;xsd:enumeration value="FORWARD"/&gt;
    &lt;xsd:enumeration value="INCLUDE"/&gt;
    &lt;xsd:enumeration value="REQUEST"/&gt;

    &lt;/xsd:restriction&gt;

&lt;/xsd:simpleType&gt;


According to servelt spec 2.4 P53, there should be ERROR value for the 
&lt;dispacher&gt; entry.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>23336</commentid>
    <comment_count>1</comment_count>
    <who name="Amy Roh">amyroh</who>
    <bug_when>2002-09-24 23:05:02 +0000</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12717</bug_id>
          
          <creation_ts>2002-09-17 03:10:00 +0000</creation_ts>
          <short_desc>No Translation error thrown when an attribute that does not take in a rtexprvalue is given a EL as a value</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22968</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-17 03:10:00 +0000</bug_when>
    <thetext>If tag foo has an attribute att1 that does not take runtime expressions as a 
value and a EL expression is given as a value to this attribute, a translation 
time expression should be thrown, but is not thrown.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>23004</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-09-17 20:15:48 +0000</bug_when>
    <thetext>Fixed.
Translation exception is now thrown if scriptlet or EL expression is specified
as the value of an XML-style attribute whose &lt;rtexprvalue&gt; TLD element is set to
FALSE (translation exception was already thrown for &lt;jsp:attribute&gt; style
attributes).</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12718</bug_id>
          
          <creation_ts>2002-09-17 03:10:00 +0000</creation_ts>
          <short_desc>A variable scoped within a fragment in a tag file is always expsed as a string</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>22969</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-17 03:10:51 +0000</bug_when>
    <thetext> </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22970</commentid>
    <comment_count>1</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-17 03:13:08 +0000</bug_when>
    <thetext>If a tag file declares a variable within a fragment with a variable-class 
specified. If the variable is accessed withing the frgament using EL , it is 
observed that the type of the object exposed by the variable is a String not a 
type specified by variable class.

Test case:
jsp20-tests/jsp2/tagfilepos/TFFragVarPos.jsp</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>22972</commentid>
    <comment_count>2</comment_count>
    <who name="Steve Downey">steve.downey</who>
    <bug_when>2002-09-17 03:44:27 +0000</bug_when>
    <thetext> Is jsp20-tests/jsp2 something that the rest of us can see? </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>23128</commentid>
    <comment_count>3</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-09-19 23:20:12 +0000</bug_when>
    <thetext>Fixed.
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>12755</bug_id>
          
          <creation_ts>2002-09-18 00:40:00 +0000</creation_ts>
          <short_desc>welcome file for jsp does not work</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="James Cai">jian.cai</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>23007</commentid>
    <comment_count>0</comment_count>
    <who name="James Cai">jian.cai</who>
    <bug_when>2002-09-18 00:40:58 +0000</bug_when>
    <thetext>Tomcat could not use the jsp as welcome file. This feature used to work. 

The following is the config entry in web.xml.

  &lt;welcome-file-list&gt; 
    &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt; 
  &lt;/welcome-file-list&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>23324</commentid>
    <comment_count>1</comment_count>
      <attachid>3203</attachid>
    <who name="Bob Herrmann">bob</who>
    <bug_when>2002-09-24 19:49:55 +0000</bug_when>
    <thetext>Created attachment 3203
a build tree for a war file that demonstrates working welcome files.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>23325</commentid>
    <comment_count>2</comment_count>
    <who name="Bob Herrmann">bob</who>
    <bug_when>2002-09-24 19:50:58 +0000</bug_when>
    <thetext>Humm...  I am having difficulty reproducing this.  I have attached a testcase
that  seems to demonstrate that everything is working....</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>23328</commentid>
    <comment_count>3</comment_count>
    <who name="James Cai">jian.cai</who>
    <bug_when>2002-09-24 20:32:14 +0000</bug_when>
    <thetext>This problem used to be in one of the previous Tomcat 5.0 build. It might go
away in Tomcat latest build . But in the J2EE pre integration build (Having
Tomcat 5.0 HEAD), welcome file within a ear does not.  </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>23355</commentid>
    <comment_count>4</comment_count>
    <who name="Bob Herrmann">bob</who>
    <bug_when>2002-09-25 13:31:47 +0000</bug_when>
    <thetext>Original poster says HEAD is now working correctly.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>3203</attachid>
            <date>2002-09-24 19:49:00 +0000</date>
            <delta_ts>2002-09-24 19:49:55 +0000</delta_ts>
            <desc>a build tree for a war file that demonstrates working welcome files.</desc>
            <filename>welcome.tgz</filename>
            <type>application/x-gzip</type>
            <size>2062</size>
            <attacher name="Bob Herrmann">bob</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>13000</bug_id>
          
          <creation_ts>2002-09-25 19:04:00 +0000</creation_ts>
          <short_desc>tag file handler generation with complex attributes</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jan Luehe">jan.luehe</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>23388</commentid>
    <comment_count>0</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-09-25 19:04:28 +0000</bug_when>
    <thetext>stephanie.bodoff@sun.com writes:

I'm experimenting with tag files and believe I have found a bug. Here's 
my tag file (simplified for debugging):

&lt;%@ attribute name="books" required="true" rtexprvalue="true" 
type="java.util.Collection" %&gt;
&lt;%@ attribute name="color" required="true" %&gt;

${color}
${books.numberOfBooks}

I'm passing a collection for the books attribute. However, I'm getting 
JSP exception (and not a very helpful one at that) when the tag is 
executed because the tag handler generated from the tag file is 
incorrect- the type of the books attribute is set to String instead of 
Collection. Is this a bug that has been fixed that I haven't picked up 
or is it a new one?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>23394</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-09-25 20:51:17 +0000</bug_when>
    <thetext>Fixed.
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>13058</bug_id>
          
          <creation_ts>2002-09-27 02:36:00 +0000</creation_ts>
          <short_desc>Dynamic Attributes do not take in RT expressions</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>23496</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-27 02:36:19 +0000</bug_when>
    <thetext>If an attribute in a tag has been sepecified as a dynamic attribute , and a EL 
expression is specified ( or runtime expression) as the value of the attribute 
then a Eception is thrown that says that EL or runtime expressions not allowed 
in template text body.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>23497</commentid>
    <comment_count>1</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-09-27 02:39:14 +0000</bug_when>
    <thetext>This happens only in the case when the attribute value is specified as a bodyof 
the jsp:attribute element</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>13094</bug_id>
          
          <creation_ts>2002-09-27 18:23:00 +0000</creation_ts>
          <short_desc>Compliance Issue - NPE not thrown if a null reference is passed to PageContext.handlePageException(Exception) or PageContext.handlePageException(Throwable).</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>23567</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2002-09-27 18:23:46 +0000</bug_when>
    <thetext>Javadocs for PageContext.handlePageException(Exception) and 
PageContext.handlePageException(Throwable) clearly state that
a NullPointerException is to be thrown if a null reference is passed
to these methods.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>23569</commentid>
    <comment_count>1</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2002-09-27 18:25:57 +0000</bug_when>
    <thetext>*** Bug 13093 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>13138</bug_id>
          
          <creation_ts>2002-09-30 14:03:00 +0000</creation_ts>
          <short_desc>Compliance issue.  PageContext.setAttribute(String, Object, int) fails to throw an IllegalArgumentException if provide an invalid scope.</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>23643</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2002-09-30 14:03:06 +0000</bug_when>
    <thetext>Per the Javadocs, PageContext.setAttribute(String, Object, int)
must throw an IllegalArgumentException if provided an invalid scope.

I looked at o.a.j.runtime.PageContextImpl and found that the default case in the
switch does nothing when it should throw an IllegalArgumentException.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>13140</bug_id>
          
          <creation_ts>2002-09-30 14:12:00 +0000</creation_ts>
          <short_desc>Compliance issue - PageContext.setAttribute, under certain circumstances, fails to throw an NPE when the value provided is null</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>23644</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2002-09-30 14:12:12 +0000</bug_when>
    <thetext>If trying to set a PageContext attribute in the following scopes, an NPE is not
thrown when the value provided is null:

   JspContext.REQUEST_SCOPE
   JspContext.SESSION_SCOPE
   JspContext.APPLICATION_SCOPE

   ex.

   pageContext.setAttribute("attrName", null, JspContext.APPLICATION_SCOPE);</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>13173</bug_id>
          
          <creation_ts>2002-10-01 13:40:00 +0000</creation_ts>
          <short_desc>NPE thrown by ELException.toString() if not originally created with a root cause exception.</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>23689</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2002-10-01 13:40:19 +0000</bug_when>
    <thetext>Given:

ELException ele = new ELException();
String str = ele.toString().


Resulting stacktrace:

 java.lang.NullPointerException
     [java] 	at javax.servlet.jsp.el.ELException.toString(ELException.java:139)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>23832</commentid>
    <comment_count>1</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2002-10-03 14:39:23 +0000</bug_when>
    <thetext>Closing as the toString() method will be removed.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>13552</bug_id>
          
          <creation_ts>2002-10-11 20:04:00 +0000</creation_ts>
          <short_desc>missing attribute name in exception message when EL expression evaluation fails</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jan Luehe">jan.luehe</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>24369</commentid>
    <comment_count>0</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-10-11 20:04:08 +0000</bug_when>
    <thetext>When an EL expression that is supplied as the value for an action
attribute fails to evaluate, the exception message does not contain
the name of the attribute. Instead, it contains an empty string.

For example, if the following EL expression

  &lt;c:set var="book" value="${bookDB.bookDetails}" /&gt;

fails to evaluate, this exception message is printed:

  An error occurred while evaluating custom action attribute "" with
  value "${bookDB.bookDetails.title}"

It would be useful if the exception message contained the attribute name.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39379</commentid>
    <comment_count>1</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2003-06-24 23:02:47 +0000</bug_when>
    <thetext>I think someone fixed this.
I tried to recreate with this:
&lt;%pageContext.setAttribute("prescription", "cowbell");%&gt;
&lt;c:set var="fever" value="${prescription.more.what}" /&gt;

And got:
javax.servlet.ServletException: Unable to find a value for "more" in object of
class "java.lang.String" using operator "."
 ...
root cause

javax.servlet.jsp.el.ELException: Unable to find a value for "more" in object of
class "java.lang.String" using operator "."
	at org.apache.commons.el.Logger.logError(Logger.java:481)
...


If this is still valid - it seems that this might belong to commons-el and not
tomcat. </thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>13553</bug_id>
          
          <creation_ts>2002-10-11 20:18:00 +0000</creation_ts>
          <short_desc>Jasper incorrectly generating a translation error if a tag has both a TEI and variable declarations.</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>24370</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2002-10-11 20:18:24 +0000</bug_when>
    <thetext>Given:

&lt;tag&gt;
    &lt;name&gt;test&lt;/name&gt;
    &lt;tei-class&gt;com.foo.TestTEI&lt;/tei-class&gt;
    &lt;variable&gt;
        &lt;name-given&gt;var1&lt;/name-given&gt;
    &lt;/variable&gt;
&lt;/tag&gt;

Jasper will generate the following:

   "variable subelement defined in TLD when TagExtraInfo class MyClass
    is non-null"

This translation error should only occur if a tag has a variable declaration
and a call to TagExtraInfo.getVariableInfo() returns a non-null value.

See lines 412-418 in o.a.j.compile.TagLibraryInfoImpl.java.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>13587</bug_id>
          
          <creation_ts>2002-10-14 01:33:00 +0000</creation_ts>
          <short_desc>version out of date in some document</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Documentation</component>
          <version>5.0.0</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="IAS">iasandcb</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>24439</commentid>
    <comment_count>0</comment_count>
    <who name="IAS">iasandcb</who>
    <bug_when>2002-10-14 01:33:15 +0000</bug_when>
    <thetext>In webapps\tomcat-docs\catalina\funcspecs\fs-admin-apps.html
Dependencies-External Technologies section says
JavaServer Pages Standard Tag Library 1.0-EA (when available) 

Actually JSTL now has 1.0 final spec and 1.0.1 RI from Jakarta Taglibs-
Standard.

JavaServer Pages Standard Tag Library 1.0(Taglibs-Standard 1.0.1)

should be better for the statement.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39383</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">shapira</who>
    <bug_when>2003-06-25 01:42:45 +0000</bug_when>
    <thetext>Updated document to JSTL 1.0.</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>13619</bug_id>
          
          <creation_ts>2002-10-14 22:57:00 +0000</creation_ts>
          <short_desc>TagInfo.getAttributes returns a zero-length array instead of null if a tag has not defined attributes.</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>24504</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2002-10-14 22:57:19 +0000</bug_when>
    <thetext>According to the javadocs, TagInfo.getAttributes must return null if the tag in
question is defined with no attributes.

Looking at line 280 of o.a.j.c.TagFileProcessor.java, the size of a vector is
used to initialize the size of the array, so if the even if the vector has no
elements the array is initialized and passed to the constructor of TagInfo.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>13723</bug_id>
          
          <creation_ts>2002-10-17 08:33:00 +0000</creation_ts>
          <short_desc>Tom Cat does not start</short_desc>
          <delta_ts>2006-02-27 10:31:06 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.5.4</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P1</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prashanth Hiremath">prashanth</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>hdshah</cc>
    
    <cc>rgreen</cc>
    
    <cc>srinivas_raob1</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>24766</commentid>
    <comment_count>0</comment_count>
    <who name="Prashanth Hiremath">prashanth</who>
    <bug_when>2002-10-17 08:33:27 +0000</bug_when>
    <thetext>When I startup the Tomcat server it threw 
java.lang.IllegalMonitorStateException: current thread not owner</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>24774</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2002-10-17 12:20:16 +0000</bug_when>
    <thetext>I never encountered any problem like this with Tomcat on Win 2k or XP, nor can
reproduce this. There is probably a setup problem somewhere (or at least, you'll
have to give very detailed instructions on how to reproduce thise - and for
starters, you *must* include the full stack trace when dealing with
never-before-seen errors).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>24818</commentid>
    <comment_count>2</comment_count>
    <who name="Hans Bergsten">hans</who>
    <bug_when>2002-10-17 18:10:56 +0000</bug_when>
    <thetext>I've seen this on Windows 98 with JDK 1.2.2, and it may be the same with other
Windows versions and this old JDK. 

I noticed that it can be "fixed" by turning off the JIT, e.g. by setting
JAVA_COMPILER=NONE. Looks like a JIT bug to me.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>24841</commentid>
    <comment_count>3</comment_count>
    <who name="Prashanth Hiremath">prashanth</who>
    <bug_when>2002-10-18 05:43:31 +0000</bug_when>
    <thetext>Thanks to Hans Bergsten, I set an envirionmental variable JAVA_COMPILER=NONE 
and the bug is fixed.

Thanks once again.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>24954</commentid>
    <comment_count>4</comment_count>
    <who name="aditya">aditya.kulkarni</who>
    <bug_when>2002-10-21 16:04:44 +0000</bug_when>
    <thetext>I got exactly same error. I am using win98.
************************************************
D:\&gt;D:\jakarta-tomcat-4.1.12\bin\startup start
Using CATALINA_BASE:   D:\jakarta-tomcat-4.1.12
Using CATALINA_HOME:   D:\jakarta-tomcat-4.1.12
Using CATALINA_TMPDIR: D:\jakarta-tomcat-4.1.12\temp
Using JAVA_HOME:       D:\jdk1.2.2
1  "D:\jdk1.2.2\bin\java"    -Djava.endorsed.dirs="D:\jakarta-tomcat-4.1.12\bin;
D:\jakarta-tomcat-4.1.12\common\endorsed" -classpath "D:\jdk1.2.2\lib\tools.jar;
D:\jakarta-tomcat-4.1.12\bin\bootstrap.jar" -Dcatalina.base="D:\jakarta-tomcat-4
.1.12" -Dcatalina.home="D:\jakarta-tomcat-4.1.12" -Djava.io.tmpdir="D:\jakarta-t
omcat-4.1.12\temp" org.apache.catalina.startup.Bootstrap
Bootstrap: Class loader creation threw exception
java.lang.IllegalMonitorStateException: current thread not owner
        at org.apache.catalina.loader.StandardClassLoader.addRepositoryInternal(
StandardClassLoader.java, Compiled Code)
        at org.apache.catalina.loader.StandardClassLoader.&lt;init&gt;(StandardClassLo
ader.java, Compiled Code)
        at org.apache.catalina.startup.ClassLoaderFactory.createClassLoader(Clas
sLoaderFactory.java, Compiled Code)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java, Compiled C
ode)
D:\&gt;
************************************************</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>25395</commentid>
    <comment_count>5</comment_count>
    <who name="Yogen Sanghani">yogen</who>
    <bug_when>2002-10-30 21:08:31 +0000</bug_when>
    <thetext>I also had the exact same problem on Win2k, JDK 1.2.2, Tomcat 4.1 and it got 
fixed with setting the environment variable JAVA_COMPILER=NONE.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>25512</commentid>
    <comment_count>6</comment_count>
      <attachid>3706</attachid>
    <who name="Mauro Murzi">murzi_m</who>
    <bug_when>2002-11-02 19:25:51 +0000</bug_when>
    <thetext>Created attachment 3706
java.lang.IllegalMonitorStateException: current thread not owner</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>31743</commentid>
    <comment_count>7</comment_count>
    <who name="Andy Cooke">andy</who>
    <bug_when>2003-02-21 11:38:07 +0000</bug_when>
    <thetext>I've also been getting this error and it seems to be a basic problem with 
running Tomcat 4 with JDK 1.2.

Searching through the tomcat-user list showed a number of people were reporting 
this error. Some people seem to be able to resolve the problem with the 
JAVA_COMPILER=NONE fix. However, the actual root of the problem was pointed out 
as being a bug in java:
http://developer.java.sun.com/developer/bugParade/bugs/4776385.html

The suggested workaround of using the hotspot VM seems to have worked for me. 
To fix it on the Tomcat site would require compilation in 1.3 or 1.2 instead of 
1.4, which is probably not feasible. Maybe this could be added to the Tomcat 4 
FAQ?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>31769</commentid>
    <comment_count>8</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2003-02-21 17:10:23 +0000</bug_when>
    <thetext>I added this my FAQ.  (http://tomcatfaq.sourceforge.net/)

Hopefully the developers will add a note to the README file too.

Changing status to WONTFIX since the public distribution from jakarta won't be
compiled using jdk1.2.X. (I least that is my assumption) It will be up to the
user to recompile from src tree.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>45077</commentid>
    <comment_count>9</comment_count>
    <who name="B.Srinivas Rao">srinivas_raob1</who>
    <bug_when>2003-10-04 20:44:16 +0000</bug_when>
    <thetext>
When I shutdown tomcat (or when it is running), I get the error 
java.lang.IllegalMonitorStateException: current thread not owner 
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>45078</commentid>
    <comment_count>10</comment_count>
    <who name="B.Srinivas Rao">srinivas_raob1</who>
    <bug_when>2003-10-04 20:48:29 +0000</bug_when>
    <thetext>
when I start server using startup.bat ,server runs for few seconds &amp; 
automatically shuts down &amp; also 
When Iam using shutdown.bat, I get the error 
java.lang.IllegalMonitorStateException: current thread not owner 
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>47613</commentid>
    <comment_count>11</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2003-11-19 11:40:28 +0000</bug_when>
    <thetext>*** Bug 24819 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>66761</commentid>
    <comment_count>12</comment_count>
    <who name="Roland Green">rgreen</who>
    <bug_when>2004-11-11 21:34:29 +0000</bug_when>
    <thetext>I installed the Apache Tomcat application server on a windows 2000 advanced
server PC with service pack 3.  When I tried to start the application via the
configuration tool, the configuration tool's start button indicates that the
application has started but there is nothing binding to port 8080 (the tomcat
admin port). In addition I am not able to connect to http://127.0.0.1:8080.
Finally when I check the tomcat log files there is nothing in "stderr.log or
stdout.log files"  but the "jakarta_service_20041111.log" file contains the
following data below.


[2004-11-11 15:34:37] [info] Service Tomcat5 name Apache Tomcat
[2004-11-11 15:34:38] [info] Service Tomcat5 installed
[2004-11-11 15:34:38] [info] Procrun finished.
[2004-11-11 15:34:38] [info] Updating service...
[2004-11-11 15:34:39] [info] Service Tomcat5 updated
[2004-11-11 15:34:39] [info] Update service finished.
[2004-11-11 15:34:39] [info] Procrun finished.
[2004-11-11 15:34:44] [info] Updating service...
[2004-11-11 15:34:44] [info] Service Tomcat5 updated
[2004-11-11 15:34:44] [info] Update service finished.
[2004-11-11 15:34:44] [info] Procrun finished.
[2004-11-11 15:34:45] [info] Updating service...
[2004-11-11 15:34:45] [info] Service Tomcat5 updated
[2004-11-11 15:34:45] [info] Update service finished.
[2004-11-11 15:34:45] [info] Procrun finished.
[2004-11-11 15:34:49] [info] Running Service...
[2004-11-11 15:34:49] [info] Starting service...
[2004-11-11 15:34:52] [info] Service started in 2484 ms.
[2004-11-11 15:34:56] [info] Run service finished.
[2004-11-11 15:34:56] [info] Procrun finished.
[2004-11-11 15:40:28] [info] Running Service...
[2004-11-11 15:40:28] [info] Starting service...
[2004-11-11 15:40:29] [info] Service started in 1265 ms.
[2004-11-11 15:40:33] [info] Run service finished.
[2004-11-11 15:40:33] [info] Procrun finished.
[2004-11-11 15:43:02] [info] Running Service...
[2004-11-11 15:43:02] [info] Starting service...
[2004-11-11 15:43:13] [info] Service started in 11234 ms.
[2004-11-11 15:43:21] [info] Run service finished.
[2004-11-11 15:43:21] [info] Procrun finished.
[2004-11-11 15:45:30] [info] Running Service...
[2004-11-11 15:45:30] [info] Starting service...
[2004-11-11 15:45:31] [info] Service started in 1265 ms.
[2004-11-11 15:45:35] [info] Run service finished.
[2004-11-11 15:45:35] [info] Procrun finished.
[2004-11-11 15:49:18] [1193 prunsrv.c] [debug] Procrun log initialized
[2004-11-11 15:49:18] [info] Running Service...
[2004-11-11 15:49:18] [1036 prunsrv.c] [debug] Inside ServiceMain...
[2004-11-11 15:49:18] [info] Starting service...
[2004-11-11 15:49:18] [408  javajni.c] [debug] Jvm Option[0]
-Dcatalina.home=C:\Program Files\Apache Software Foundation\Tomcat 5.5
[2004-11-11 15:49:18] [408  javajni.c] [debug] Jvm Option[1]
-Djava.endorsed.dirs=C:\Program Files\Apache Software Foundation\Tomcat
5.5\common\endorsed
[2004-11-11 15:49:18] [408  javajni.c] [debug] Jvm Option[2]
-Djava.io.tmpdir=C:\Program Files\Apache Software Foundation\Tomcat 5.5\temp
[2004-11-11 15:49:18] [408  javajni.c] [debug] Jvm Option[3] -Xrs
[2004-11-11 15:49:18] [408  javajni.c] [debug] Jvm Option[4]
-Djava.class.path=C:\Program Files\Apache Software Foundation\Tomcat
5.5\bin\bootstrap.jar
[2004-11-11 15:49:18] [408  javajni.c] [debug] Jvm Option[5] vfprintf
[2004-11-11 15:49:19] [494  javajni.c] [debug] argv[0] = start
[2004-11-11 15:49:20] [907  prunsrv.c] [debug] Java started
org/apache/catalina/startup/Bootstrap
[2004-11-11 15:49:20] [info] Service started in 1250 ms.
[2004-11-11 15:49:20] [1110 prunsrv.c] [debug] Waitning worker to finish...
[2004-11-11 15:49:24] [531  javajni.c] [debug] Java Worker thread finished
[2004-11-11 15:49:24] [1115 prunsrv.c] [debug] Worker finished.
[2004-11-11 15:49:24] [info] Run service finished.
[2004-11-11 15:49:24] [info] Procrun finished.
[2004-11-11 16:04:56] [1193 prunsrv.c] [debug] Procrun log initialized
[2004-11-11 16:04:56] [info] Running Service...
[2004-11-11 16:04:56] [1036 prunsrv.c] [debug] Inside ServiceMain...
[2004-11-11 16:04:56] [info] Starting service...
[2004-11-11 16:04:56] [408  javajni.c] [debug] Jvm Option[0]
-Dcatalina.home=C:\Program Files\Apache Software Foundation\Tomcat 5.5
[2004-11-11 16:04:56] [408  javajni.c] [debug] Jvm Option[1]
-Djava.endorsed.dirs=C:\Program Files\Apache Software Foundation\Tomcat
5.5\common\endorsed
[2004-11-11 16:04:56] [408  javajni.c] [debug] Jvm Option[2]
-Djava.io.tmpdir=C:\Program Files\Apache Software Foundation\Tomcat 5.5\temp
[2004-11-11 16:04:56] [408  javajni.c] [debug] Jvm Option[3] -Xrs
[2004-11-11 16:04:56] [408  javajni.c] [debug] Jvm Option[4]
-Djava.class.path=C:\Program Files\Apache Software Foundation\Tomcat
5.5\bin\bootstrap.jar
[2004-11-11 16:04:56] [408  javajni.c] [debug] Jvm Option[5] vfprintf
[2004-11-11 16:04:56] [494  javajni.c] [debug] argv[0] = start
[2004-11-11 16:04:57] [907  prunsrv.c] [debug] Java started
org/apache/catalina/startup/Bootstrap
[2004-11-11 16:04:57] [info] Service started in 1265 ms.
[2004-11-11 16:04:57] [1110 prunsrv.c] [debug] Waitning worker to finish...
[2004-11-11 16:05:01] [531  javajni.c] [debug] Java Worker thread finished
[2004-11-11 16:05:01] [1115 prunsrv.c] [debug] Worker finished.
[2004-11-11 16:05:01] [info] Run service finished.
[2004-11-11 16:05:01] [info] Procrun finished.
[2004-11-11 16:05:13] [1193 prunsrv.c] [debug] Procrun log initialized
[2004-11-11 16:05:13] [info] Running Service...
[2004-11-11 16:05:13] [1036 prunsrv.c] [debug] Inside ServiceMain...
[2004-11-11 16:05:13] [info] Starting service...
[2004-11-11 16:05:13] [408  javajni.c] [debug] Jvm Option[0]
-Dcatalina.home=C:\Program Files\Apache Software Foundation\Tomcat 5.5
[2004-11-11 16:05:13] [408  javajni.c] [debug] Jvm Option[1]
-Djava.endorsed.dirs=C:\Program Files\Apache Software Foundation\Tomcat
5.5\common\endorsed
[2004-11-11 16:05:13] [408  javajni.c] [debug] Jvm Option[2]
-Djava.io.tmpdir=C:\Program Files\Apache Software Foundation\Tomcat 5.5\temp
[2004-11-11 16:05:13] [408  javajni.c] [debug] Jvm Option[3] -Xrs
[2004-11-11 16:05:13] [408  javajni.c] [debug] Jvm Option[4]
-Djava.class.path=C:\Program Files\Apache Software Foundation\Tomcat
5.5\bin\bootstrap.jar
[2004-11-11 16:05:13] [408  javajni.c] [debug] Jvm Option[5] vfprintf
[2004-11-11 16:05:13] [494  javajni.c] [debug] argv[0] = start
[2004-11-11 16:05:14] [907  prunsrv.c] [debug] Java started
org/apache/catalina/startup/Bootstrap
[2004-11-11 16:05:14] [info] Service started in 1250 ms.
[2004-11-11 16:05:14] [1110 prunsrv.c] [debug] Waitning worker to finish...
[2004-11-11 16:05:18] [531  javajni.c] [debug] Java Worker thread finished
[2004-11-11 16:05:18] [1115 prunsrv.c] [debug] Worker finished.
[2004-11-11 16:05:18] [info] Run service finished.
[2004-11-11 16:05:18] [info] Procrun finished.
[2004-11-11 16:12:18] [1193 prunsrv.c] [debug] Procrun log initialized
[2004-11-11 16:12:18] [info] Running Service...
[2004-11-11 16:12:18] [1036 prunsrv.c] [debug] Inside ServiceMain...
[2004-11-11 16:12:18] [info] Starting service...
[2004-11-11 16:12:18] [408  javajni.c] [debug] Jvm Option[0]
-Dcatalina.home=C:\Program Files\Apache Software Foundation\Tomcat 5.5
[2004-11-11 16:12:18] [408  javajni.c] [debug] Jvm Option[1]
-Djava.endorsed.dirs=C:\Program Files\Apache Software Foundation\Tomcat
5.5\common\endorsed
[2004-11-11 16:12:18] [408  javajni.c] [debug] Jvm Option[2]
-Djava.io.tmpdir=C:\Program Files\Apache Software Foundation\Tomcat 5.5\temp
[2004-11-11 16:12:18] [408  javajni.c] [debug] Jvm Option[3] -Xrs
[2004-11-11 16:12:18] [408  javajni.c] [debug] Jvm Option[4]
-Djava.class.path=C:\Program Files\Apache Software Foundation\Tomcat
5.5\bin\bootstrap.jar
[2004-11-11 16:12:18] [408  javajni.c] [debug] Jvm Option[5] vfprintf
[2004-11-11 16:12:18] [494  javajni.c] [debug] argv[0] = start
[2004-11-11 16:12:19] [907  prunsrv.c] [debug] Java started
org/apache/catalina/startup/Bootstrap
[2004-11-11 16:12:19] [info] Service started in 1265 ms.
[2004-11-11 16:12:19] [1110 prunsrv.c] [debug] Waitning worker to finish...
[2004-11-11 16:12:23] [531  javajni.c] [debug] Java Worker thread finished
[2004-11-11 16:12:23] [1115 prunsrv.c] [debug] Worker finished.
[2004-11-11 16:12:23] [info] Run service finished.
[2004-11-11 16:12:23] [info] Procrun finished.
[2004-11-11 16:13:04] [1193 prunsrv.c] [debug] Procrun log initialized
[2004-11-11 16:13:04] [info] Running Service...
[2004-11-11 16:13:04] [1036 prunsrv.c] [debug] Inside ServiceMain...
[2004-11-11 16:13:04] [info] Starting service...
[2004-11-11 16:13:04] [408  javajni.c] [debug] Jvm Option[0]
-Dcatalina.home=C:\Program Files\Apache Software Foundation\Tomcat 5.5
[2004-11-11 16:13:04] [408  javajni.c] [debug] Jvm Option[1]
-Djava.endorsed.dirs=C:\Program Files\Apache Software Foundation\Tomcat
5.5\common\endorsed
[2004-11-11 16:13:04] [408  javajni.c] [debug] Jvm Option[2]
-Djava.io.tmpdir=C:\Program Files\Apache Software Foundation\Tomcat 5.5\temp
[2004-11-11 16:13:04] [408  javajni.c] [debug] Jvm Option[3] -Xrs
[2004-11-11 16:13:04] [408  javajni.c] [debug] Jvm Option[4]
-Djava.class.path=C:\Program Files\Apache Software Foundation\Tomcat
5.5\bin\bootstrap.jar
[2004-11-11 16:13:04] [408  javajni.c] [debug] Jvm Option[5] vfprintf
[2004-11-11 16:13:04] [494  javajni.c] [debug] argv[0] = start
[2004-11-11 16:13:05] [907  prunsrv.c] [debug] Java started
org/apache/catalina/startup/Bootstrap
[2004-11-11 16:13:05] [info] Service started in 1265 ms.
[2004-11-11 16:13:05] [1110 prunsrv.c] [debug] Waitning worker to finish...
[2004-11-11 16:13:09] [531  javajni.c] [debug] Java Worker thread finished
[2004-11-11 16:13:09] [1115 prunsrv.c] [debug] Worker finished.
[2004-11-11 16:13:09] [info] Run service finished.
[2004-11-11 16:13:09] [info] Procrun finished.
[2004-11-11 16:13:54] [1193 prunsrv.c] [debug] Procrun log initialized
[2004-11-11 16:13:54] [info] Running Service...
[2004-11-11 16:13:54] [1036 prunsrv.c] [debug] Inside ServiceMain...
[2004-11-11 16:13:54] [info] Starting service...
[2004-11-11 16:13:54] [408  javajni.c] [debug] Jvm Option[0]
-Dcatalina.home=C:\Program Files\Apache Software Foundation\Tomcat 5.5
[2004-11-11 16:13:54] [408  javajni.c] [debug] Jvm Option[1]
-Djava.endorsed.dirs=C:\Program Files\Apache Software Foundation\Tomcat
5.5\common\endorsed
[2004-11-11 16:13:54] [408  javajni.c] [debug] Jvm Option[2]
-Djava.io.tmpdir=C:\Program Files\Apache Software Foundation\Tomcat 5.5\temp
[2004-11-11 16:13:54] [408  javajni.c] [debug] Jvm Option[3] -Xrs
[2004-11-11 16:13:54] [408  javajni.c] [debug] Jvm Option[4]
-Djava.class.path=C:\Program Files\Apache Software Foundation\Tomcat
5.5\bin\bootstrap.jar
[2004-11-11 16:13:54] [408  javajni.c] [debug] Jvm Option[5] vfprintf
[2004-11-11 16:13:54] [494  javajni.c] [debug] argv[0] = start
[2004-11-11 16:13:55] [907  prunsrv.c] [debug] Java started
org/apache/catalina/startup/Bootstrap
[2004-11-11 16:13:55] [info] Service started in 1265 ms.
[2004-11-11 16:13:55] [1110 prunsrv.c] [debug] Waitning worker to finish...
[2004-11-11 16:13:59] [531  javajni.c] [debug] Java Worker thread finished
[2004-11-11 16:13:59] [1115 prunsrv.c] [debug] Worker finished.
[2004-11-11 16:13:59] [info] Run service finished.
[2004-11-11 16:13:59] [info] Procrun finished.
[2004-11-11 16:14:46] [1193 prunsrv.c] [debug] Procrun log initialized
[2004-11-11 16:14:46] [info] Running Service...
[2004-11-11 16:14:46] [1036 prunsrv.c] [debug] Inside ServiceMain...
[2004-11-11 16:14:46] [info] Starting service...
[2004-11-11 16:14:46] [408  javajni.c] [debug] Jvm Option[0]
-Dcatalina.home=C:\Program Files\Apache Software Foundation\Tomcat 5.5
[2004-11-11 16:14:46] [408  javajni.c] [debug] Jvm Option[1]
-Djava.endorsed.dirs=C:\Program Files\Apache Software Foundation\Tomcat
5.5\common\endorsed
[2004-11-11 16:14:46] [408  javajni.c] [debug] Jvm Option[2]
-Djava.io.tmpdir=C:\Program Files\Apache Software Foundation\Tomcat 5.5\temp
[2004-11-11 16:14:46] [408  javajni.c] [debug] Jvm Option[3] -Xrs
[2004-11-11 16:14:46] [408  javajni.c] [debug] Jvm Option[4]
-Djava.class.path=C:\Program Files\Apache Software Foundation\Tomcat
5.5\bin\bootstrap.jar
[2004-11-11 16:14:46] [408  javajni.c] [debug] Jvm Option[5] vfprintf
[2004-11-11 16:14:46] [494  javajni.c] [debug] argv[0] = start
[2004-11-11 16:14:47] [907  prunsrv.c] [debug] Java started
org/apache/catalina/startup/Bootstrap
[2004-11-11 16:14:47] [info] Service started in 1265 ms.
[2004-11-11 16:14:47] [1110 prunsrv.c] [debug] Waitning worker to finish...
[2004-11-11 16:14:51] [531  javajni.c] [debug] Java Worker thread finished
[2004-11-11 16:14:51] [1115 prunsrv.c] [debug] Worker finished.
[2004-11-11 16:14:51] [info] Run service finished.
[2004-11-11 16:14:51] [info] Procrun finished.
[2004-11-11 16:15:00] [1193 prunsrv.c] [debug] Procrun log initialized
[2004-11-11 16:15:00] [info] Running Service...
[2004-11-11 16:15:00] [1036 prunsrv.c] [debug] Inside ServiceMain...
[2004-11-11 16:15:00] [info] Starting service...
[2004-11-11 16:15:00] [408  javajni.c] [debug] Jvm Option[0]
-Dcatalina.home=C:\Program Files\Apache Software Foundation\Tomcat 5.5
[2004-11-11 16:15:00] [408  javajni.c] [debug] Jvm Option[1]
-Djava.endorsed.dirs=C:\Program Files\Apache Software Foundation\Tomcat
5.5\common\endorsed
[2004-11-11 16:15:00] [408  javajni.c] [debug] Jvm Option[2]
-Djava.io.tmpdir=C:\Program Files\Apache Software Foundation\Tomcat 5.5\temp
[2004-11-11 16:15:00] [408  javajni.c] [debug] Jvm Option[3] -Xrs
[2004-11-11 16:15:00] [408  javajni.c] [debug] Jvm Option[4]
-Djava.class.path=C:\Program Files\Apache Software Foundation\Tomcat
5.5\bin\bootstrap.jar
[2004-11-11 16:15:00] [408  javajni.c] [debug] Jvm Option[5] vfprintf
[2004-11-11 16:15:01] [494  javajni.c] [debug] argv[0] = start
[2004-11-11 16:15:02] [907  prunsrv.c] [debug] Java started
org/apache/catalina/startup/Bootstrap
[2004-11-11 16:15:02] [info] Service started in 1281 ms.
[2004-11-11 16:15:02] [1110 prunsrv.c] [debug] Waitning worker to finish...
[2004-11-11 16:15:06] [531  javajni.c] [debug] Java Worker thread finished
[2004-11-11 16:15:06] [1115 prunsrv.c] [debug] Worker finished.
[2004-11-11 16:15:06] [info] Run service finished.
[2004-11-11 16:15:06] [info] Procrun finished.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>84542</commentid>
    <comment_count>13</comment_count>
    <who name="Michael.Zheng">xioshanying</who>
    <bug_when>2006-01-12 17:28:23 +0000</bug_when>
    <thetext>
I am running Tomcat 5.5.12 and jdk1.5.0_06, and I still get this problem.
This problem will happen from time to time, maybe after 3 days of normal 
running. The stack trace is :

java.lang.IllegalMonitorStateException: current thread not owner
	at java.lang.Object.notifyAll(Native Method)
	at org.apache.tomcat.util.net.AprEndpoint$Worker.run
(AprEndpoint.java:1216)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>84543</commentid>
    <comment_count>14</comment_count>
    <who name="Michael.Zheng">xioshanying</who>
    <bug_when>2006-01-12 17:31:12 +0000</bug_when>
    <thetext>
I am running Tomcat 5.5.12 and jdk1.5.0_06, and I still get this problem.
This problem will happen from time to time, maybe after 3 days of normal 
running. The stack trace is :

java.lang.IllegalMonitorStateException: current thread not owner
	at java.lang.Object.notifyAll(Native Method)
	at org.apache.tomcat.util.net.AprEndpoint$Worker.run
(AprEndpoint.java:1216)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>86260</commentid>
    <comment_count>15</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2006-02-27 19:31:06 +0000</bug_when>
    <thetext>Michael, your bug is different, please open a new Bugzilla issue for it.  Yours
has to do with the AprEndpoint / APR connector, brand new to Tomcat 5.5, and
does not have to do with the JIT/HotSpot/JDK 1.2.2 issues encountered earlier.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>3706</attachid>
            <date>2002-11-02 19:25:00 +0000</date>
            <delta_ts>2002-11-02 19:25:51 +0000</delta_ts>
            <desc>java.lang.IllegalMonitorStateException: current thread not owner</desc>
            <filename>tomcatMonitor</filename>
            <type>text/plain</type>
            <size>163</size>
            <attacher name="Mauro Murzi">murzi_m</attacher>
            

          </attachment>
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>14230</bug_id>
          
          <creation_ts>2002-11-04 16:36:00 +0000</creation_ts>
          <short_desc>JSP errorPage mechanism is failing in HEAD build of Tomcat 5</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>blocker</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>25624</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2002-11-04 16:36:32 +0000</bug_when>
    <thetext>It would seem a problem has appeared in dispatching a request to an error page
defined in a JSP.

Here is an example of the failure from Watchdog:

   [java]  [watchdog] ERROR: Server's response and configured goldenfile do not
match!
     [java]  [watchdog] Response received from server:
     [java]  [watchdog] ---------------------------------------------------------
     [java]  [watchdog] &lt;html&gt;&lt;head&gt;&lt;title&gt;Apache Tomcat/5.0 - Error
report&lt;/title&gt;&lt;STYLE&gt;&lt;!--H1{font-family : sans-serif,Arial,Tahoma;color :
white;background-color : #0086b2;} H3{font-family :
sans-serif,Arial,Tahoma;color : white;background-color : #0086b2;}
BODY{font-family : sans-serif,Arial,Tahoma;color : black;background-color :
white;} B{color : white;background-color : #0086b2;} HR{color : #0086b2;}
--&gt;&lt;/STYLE&gt; &lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP Status 500 - &lt;/h1&gt;&lt;HR size="1"
noshade&gt;&lt;p&gt;&lt;b&gt;type&lt;/b&gt; Exception report&lt;/p&gt;&lt;p&gt;&lt;b&gt;message&lt;/b&gt;
&lt;u&gt;&lt;/u&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;description&lt;/b&gt; &lt;u&gt;The server encountered an internal error ()
that prevented it from fulfilling this request.&lt;/u&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;exception&lt;/b&gt;
&lt;pre&gt;java.lang.ArithmeticException: / by zero
     [java]  [watchdog] 	at
org.apache.jsp.positiveErrorPage_jsp._jspService(positiveErrorPage_jsp.java:63)
     [java]  [watchdog] 	at
org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:135)


Instead of the defined error page being invoked, the default error page
mechanism for uncaught exceptions is being used.

I don't believe this to be an issue with Jasper2 as it relies on the Servlet
container's RequestDispatcher to handle this functionality.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>25826</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2002-11-06 22:16:58 +0000</bug_when>
    <thetext>Reverting costin's flush-in-release patch fixes this problem</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>14273</bug_id>
          
          <creation_ts>2002-11-05 20:46:00 +0000</creation_ts>
          <short_desc>Unable to invoke a fragment within a tag in a tag file</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Unknown</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>25722</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-11-05 20:46:48 +0000</bug_when>
    <thetext>If there is a tag file that contains a tag( simple or classic), and 
&gt; within the body of the tag a fragment is invoked using the jsp:invoke 
&gt; action, the tag file throws a compilation error.
&gt; e.g:
&gt; &lt;!-- a.tag --&gt;
&gt; &lt;%@attribute name="frag" fragment="true" %&gt;
&gt; &lt;ct:complexTag var="foo" &gt;
&gt;     &lt;jsp:invoke fragment="frag" /&gt;
&gt; &lt;/ct:complexTag&gt;
&gt; 
&gt; In this case the _jspx_out that is passed to the getFrag.invoke(...) 
&gt; creates the problem, as the compler finds that this is not defined in 
&gt; the helper class.
&gt; 
&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>25825</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-11-06 22:02:18 +0000</bug_when>
    <thetext>Fixed.
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>14413</bug_id>
          
          <creation_ts>2002-11-09 19:00:00 +0000</creation_ts>
          <short_desc>NPE while using jsp:attribute in JSP Document</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.0</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Prasad Subramanian">prasad.subramanian</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>26012</commentid>
    <comment_count>0</comment_count>
    <who name="Prasad Subramanian">prasad.subramanian</who>
    <bug_when>2002-11-09 19:00:13 +0000</bug_when>
    <thetext>If a JSPDocument has a jsp:attribute that has both the attributes specified as
XML style attributes ,a NPE is thrown while parsing. In case the value attribute
is specified as a body then the JSP document is compiled and executed properly.

Here is the JSP Document :
&lt;jsp:root xmlns:jsp="http://java.sun.com/JSP/Page" xmlns:st="/SimpleTaglib"  
version="2.0" &gt;
 &lt;st:simplefmtbegin var="myDt" pattern="MM/dd/yyyy" &gt;
    	&lt;jsp:attribute name="input" value="02/02/2001"/&gt;
 &lt;/st:simplefmtbegin&gt;
 &lt;jsp:text&gt;&lt;![CDATA[ &lt;br&gt; This is the date &lt;br&gt; ]]&gt; &lt;/jsp:text&gt;
 
 &lt;jsp:text&gt;&lt;![CDATA[ &lt;br&gt; This is the date from EL &lt;br&gt; ]]&gt; &lt;/jsp:text&gt;
 
 &lt;jsp:text&gt;${myDt}&lt;/jsp:text&gt;
     
&lt;/jsp:root&gt;

=====
Here is the error 
=====
java.lang.NullPointerException
	at
org.apache.jasper.compiler.JspDocumentParser.endElement(JspDocumentParser.java:380)
	at
org.apache.xerces.parsers.AbstractSAXParser.endElement(AbstractSAXParser.java:585)
	at
org.apache.xerces.parsers.AbstractXMLDocumentParser.emptyElement(AbstractXMLDocumentParser.java:222)
	at
org.apache.xerces.impl.XMLNamespaceBinder.emptyElement(XMLNamespaceBinder.java:595)
	at
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanStartElement(XMLDocumentFragmentScannerImpl.java:747)
	at
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(XMLDocumentFragmentScannerImpl.java:1477)
	at
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:329)
	at org.apache.xerces.parsers.DTDConfiguration.parse(DTDConfiguration.java:525)
	at org.apache.xerces.parsers.DTDConfiguration.parse(DTDConfiguration.java:581)
	at org.apache.xerces.parsers.XMLParser.parse(XMLParser.java:152)
	at org.apache.xerces.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1175)
	at javax.xml.parsers.SAXParser.parse(SAXParser.java:394)
	at org.apache.jasper.compiler.JspDocumentParser.parse(JspDocumentParser.java:180)
	at org.apache.jasper.compiler.ParserController.parseFile(ParserController.java:207)
	at org.apache.jasper.compiler.ParserController.parse(ParserController.java:150)
	at org.apache.jasper.compiler.ParserController.parse(ParserController.java:139)
	at org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:263)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:413)
	at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:552)
	at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:297)
	at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:295)
	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:241)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)
	at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:280)
	at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:194)
	at
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:276)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)
	at
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)
	at org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2523)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at
org.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:172)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)
	at
org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)
	at
org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:223)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:413)
	at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:380)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:537)
	at
org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:533)
	at java.lang.Thread.run(Thread.java:536)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>26084</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-11-11 19:27:02 +0000</bug_when>
    <thetext>Fixed.
A more meaningful exception (consistent with the exception thrown in the
standard syntax case) is now thrown (notice that it is illegal for
&lt;jsp:attribute&gt; to specify a 'value' attribute).</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>14526</bug_id>
          
          <creation_ts>2002-11-13 21:05:00 +0000</creation_ts>
          <short_desc>&lt;jsp:element&gt; not supported in standard syntax</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Unknown</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>blocker</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jan Luehe">jan.luehe</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>26238</commentid>
    <comment_count>0</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-11-13 21:05:41 +0000</bug_when>
    <thetext>&lt;jsp:element&gt; currently is supported in XML syntax only. According to the spec,
which has been clarified in this respect, it also must be supported in standard
syntax.</thetext>
  </long_desc>
      
      

    <bug_classification class="SPEC">SPEC</bug_classification></bug>
    <bug>
          <bug_id>14616</bug_id>
          
          <creation_ts>2002-11-16 18:22:00 +0000</creation_ts>
          <short_desc>Redirects should be issued prior to authentication challenges</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Keith Wannamaker">Keith</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>26415</commentid>
    <comment_count>0</comment_count>
    <who name="Keith Wannamaker">Keith</who>
    <bug_when>2002-11-16 18:22:11 +0000</bug_when>
    <thetext>4.0.6 exhibits this wrong behavior:
 GET /foo                       -&gt;  401
 GET /foo with auth             -&gt;  301 to /foo/
 GET /foo/ with auth            -&gt;  200    
 GET /bar with auth  .. (browser will send auth to other realms!)

It should exhibit this correct behavior (as Apache does):
 GET /foo                       -&gt;  301 to /foo/
 GET /foo/                      -&gt;  401
 GET /foo/ with auth            -&gt;  200
 GET /bar  WITHOUT auth

Otherwise, browsers will cache and send auth information for the
entire domain and not just a protected directory.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33003</commentid>
    <comment_count>1</comment_count>
    <who name="Keith Wannamaker">Keith</who>
    <bug_when>2003-03-12 02:39:05 +0000</bug_when>
    <thetext>Proposed patch (against TOMCAT_4_1_18):

Index: 
catalina/src/share/org/apache/catalina/authenticator/AuthenticatorBase.java
===================================================================
RCS file: /home/cvs/jakarta-tomcat-
4.0/catalina/src/share/org/apache/catalina/authenticator/AuthenticatorBase.java,
v
retrieving revision 1.35
diff -u -r1.35 AuthenticatorBase.java
--- catalina/src/share/org/apache/catalina/authenticator/AuthenticatorBase.java
16 Nov 2002 04:49:22 -0000      1.35
+++ catalina/src/share/org/apache/catalina/authenticator/AuthenticatorBase.java
12 Mar 2003 02:34:45 -0000
@@ -443,6 +443,17 @@
         }
         HttpRequest hrequest = (HttpRequest) request;
         HttpResponse hresponse = (HttpResponse) response;
+
+        // Do not authenticate prior to redirects for trailing slashes,
+        // at least for the root of the context
+        String requestURI = hrequest.getDecodedRequestURI();
+        String contextPath = this.context.getPath();
+        if (requestURI.charAt(requestURI.length() - 1) != '/' &amp;&amp;
+            requestURI.equals(contextPath)) {
+            context.invokeNext(request, response);
+            return;
+        }
+
         if (debug &gt;= 1)
             log("Security checking request " +
                 ((HttpServletRequest) request.getRequest()).getMethod() + " " +
@@ -473,8 +484,6 @@
         // Special handling for form-based logins to deal with the case
         // where the login form (and therefore the "j_security_check" URI
         // to which it submits) might be outside the secured area
-        String contextPath = this.context.getPath();
-        String requestURI = hrequest.getDecodedRequestURI();
         if (requestURI.startsWith(contextPath) &amp;&amp;
             requestURI.endsWith(Constants.FORM_ACTION)) {
             if (!authenticate(hrequest, hresponse, config)) {</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33037</commentid>
    <comment_count>2</comment_count>
    <who name="Keith Wannamaker">Keith</who>
    <bug_when>2003-03-12 14:59:53 +0000</bug_when>
    <thetext>Fixed in 4.1.23, changed product and version as a placeholder to do this work 
in 5.0.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33050</commentid>
    <comment_count>3</comment_count>
    <who name="Keith Wannamaker">Keith</who>
    <bug_when>2003-03-12 16:22:29 +0000</bug_when>
    <thetext>Remy informs me this is fixed in 5.0, super.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>14660</bug_id>
          
          <creation_ts>2002-11-19 00:21:00 +0000</creation_ts>
          <short_desc>Unable to use custom tag when running applicaiton in war</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.0</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="James Cai">jian.cai</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>26524</commentid>
    <comment_count>0</comment_count>
    <who name="James Cai">jian.cai</who>
    <bug_when>2002-11-19 00:21:55 +0000</bug_when>
    <thetext>When the web application was running as a war file (unpacked), the JSPer 
through a exception of compiling the JSP. And the custom tags got error.  But 
the same applicaiton can be run when the webapplication unpacked.

the exception is :

java.lang.NullPointerException
        at org.apache.jasper.compiler.SmapUtil.inputSmapPath(SmapUtil.java:163)
        at org.apache.jasper.compiler.SmapUtil.generateSmap(SmapUtil.java:104)
        at org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:303)
        at org.apache.jasper.compiler.Compiler.compile(Compiler.java:413)
        at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext
.java:552)
        at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper
.java:297)
        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:2
95)
        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:241)
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(Appl
icationFilterChain.java:280)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationF
ilterChain.java:194)
        at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDisp
atcher.java:727)
        at org.apache.catalina.core.ApplicationDispatcher.doInclude(ApplicationD
ispatcher.java:616)
        at org.apache.catalina.core.ApplicationDispatcher.include(ApplicationDis
patcher.java:530)
        at com.sun.j2ee.workflow.taglib.InsertTag.doEndTag(InsertTag.java:63)
        at org.apache.jsp.template_jsp._jspx_meth_j2ee_insert_4(template_jsp.jav
a:198)
        at org.apache.jsp.template_jsp._jspService(template_jsp.java:95)
        at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:138)
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)
        at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper
.java:317)
        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:2
95)
        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:241)
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(Appl
icationFilterChain.java:280)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationF
ilterChain.java:194)
        at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDisp
atcher.java:727)
        at org.apache.catalina.core.ApplicationDispatcher.doForward(ApplicationD
ispatcher.java:464)
        at org.apache.catalina.core.ApplicationDispatcher.forward(ApplicationDis
patcher.java:356)
        at com.sun.j2ee.workflow.control.web.MainServlet.doGet(MainServlet.java:
127)
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:740)
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(Appl
icationFilterChain.java:280)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationF
ilterChain.java:194)
        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperV
alve.java:276)
        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex
t.invokeNext(StandardPipeline.java:643)
        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav
a:480)
        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)

        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextV
alve.java:191)
        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex
t.invokeNext(StandardPipeline.java:643)
        at org.apache.catalina.valves.RequestListenerValve.invoke(RequestListene
rValve.java:170)
        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex
t.invokeNext(StandardPipeline.java:641)
        at org.apache.catalina.authenticator.AuthenticatorBase.invoke(Authentica
torBase.java:474)
        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex
t.invokeNext(StandardPipeline.java:641)
        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav
a:480)
        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)

        at org.apache.catalina.core.StandardContext.invoke(StandardContext.java:
2523)
        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.j
ava:180)
        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex
t.invokeNext(StandardPipeline.java:643)
        at org.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatche
rValve.java:170)
        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex
t.invokeNext(StandardPipeline.java:641)
        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.j
ava:172)
        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex
t.invokeNext(StandardPipeline.java:641)
        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav
a:480)
        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)

        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineVal
ve.java:174)
        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex
t.invokeNext(StandardPipeline.java:643)
        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav
a:480)
        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)

        at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:22
3)
        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java
:413)
        at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.proce
ssConnection(Http11Protocol.java:380)
        at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java
:537)
        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadP
ool.java:533)
        at java.lang.Thread.run(Thread.java:536)
InsertTag:doEndTag caught: org.apache.jasper.JasperException: Unable to compile
class for JSP</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>26536</commentid>
    <comment_count>1</comment_count>
    <who name="James Cai">jian.cai</who>
    <bug_when>2002-11-19 01:47:12 +0000</bug_when>
    <thetext>Here is the simple way to reproduce the bug:

In the server.xml add the following &lt;Context..&gt; entry inside the &lt;Host
name="localhost" ...&gt; element

like:
 
&lt;Host name="localhost" debug="0" appBase="webapps"
       unpackWARs="true" autoDeploy="true"&gt;
......

        &lt;Context className="org.apache.catalina.core.StandardContext"
cachingAllowed="true"
charsetMapperClass="org.apache.catalina.util.CharsetMapper" cookies="true"
crossContext="false" debug="0" displayName="JSPSample"
docBase="jsp-examples2.war"
mapperClass="org.apache.catalina.core.StandardContextMapper" override="true"
path="/jsp-examples2" privileged="false" reloadable="false" useNaming="true"
wrapperClass="org.apache.catalina.core.StandardWrapper"&gt;
        &lt;/Context&gt;


	the context points to a jsp-examples2.war (just a copy of the jsp-examples.war)
as docBase. When the containter starts, there will be no jsp-examples2 directory
created. The webapplication can be access in http://localhost:8080/jsp-examples2/

but when click the links of the samples, there will be exception:

Such as:

java.lang.NullPointerException
        at org.apache.jasper.compiler.SmapUtil.inputSmapPath(SmapUtil.java:163)
        at org.apache.jasper.compiler.SmapUtil.generateSmap(SmapUtil.java:104)
        at org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:303)
        at org.apache.jasper.compiler.Compiler.compile(Compiler.java:413)
        at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext
.java:552)
        at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper
.java:297)
        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:2
95)
        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:241)
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(Appl
icationFilterChain.java:280)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationF
ilterChain.java:194)
        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperV
alve.java:276)
        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex
t.invokeNext(StandardPipeline.java:643)
        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav
a:480)
        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)

        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextV
alve.java:191)
        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex
t.invokeNext(StandardPipeline.java:643)
        at org.apache.catalina.authenticator.AuthenticatorBase.invoke(Authentica
torBase.java:474)
        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex
t.invokeNext(StandardPipeline.java:641)
        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav
a:480)
        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)

        at org.apache.catalina.core.StandardContext.invoke(StandardContext.java:
2523)
        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.j
ava:180)
        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex
t.invokeNext(StandardPipeline.java:643)
        at org.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatche
rValve.java:170)
        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex
t.invokeNext(StandardPipeline.java:641)
        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.j
ava:172)
        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex
t.invokeNext(StandardPipeline.java:641)
        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav
a:480)
        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)

        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineVal
ve.java:174)
        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex
t.invokeNext(StandardPipeline.java:643)
        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav
a:480)
        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)

        at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:22
3)
        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java
:413)
        at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.proce
ssConnection(Http11Protocol.java:380)
        at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java
:537)
        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadP
ool.java:533)
        at java.lang.Thread.run(Thread.java:536)
&lt;/Host&gt;</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>14854</bug_id>
          
          <creation_ts>2002-11-26 14:52:00 +0000</creation_ts>
          <short_desc>Allow redeploying tag libraries from the same jar, do not lock the jar files on Windows</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Petr Jiricka">petr.jiricka</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>26995</commentid>
    <comment_count>0</comment_count>
    <who name="Petr Jiricka">petr.jiricka</who>
    <bug_when>2002-11-26 14:52:54 +0000</bug_when>
    <thetext>There are two separate but related problems:

When Jasper loads .tld files from the tag library jar files, it does not close 
the jar files. Because of this, the file can not be deleted/overwritten on 
Windows, which causes pain when developing the application (and frequent 
changes are desirable).

When using Jasper inside Catalina, then a workaround is to stop the application 
using the manager application (or stop the server, but that does not help the 
speed of the development cycle). However, when Jasper is used outside the 
server as a standalone embedded application, then there is no workaround. 

The second problem is that Jasper uses the caches in JarURLConnection, which 
means that one .tld can not be redeployed from the same jar. A simple fix is to 
call connection.setUseCaches(false), which now in JDK 1.4 finally works.

Another minor issue in class TldLocationsCache is the fact that it does not 
always close the .tld file stream, which seems strange. I don't see any reason 
why not to close the stream.

The following patch may not be a complete solution to all these problems, but 
it goes in that direction. Please consider applying it. 

Thanks. Petr</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>26996</commentid>
    <comment_count>1</comment_count>
      <attachid>3953</attachid>
    <who name="Petr Jiricka">petr.jiricka</who>
    <bug_when>2002-11-26 14:55:48 +0000</bug_when>
    <thetext>Created attachment 3953
Patch which partially addresses the above issues</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>27286</commentid>
    <comment_count>2</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2002-12-02 22:31:29 +0000</bug_when>
    <thetext>Patch applied.

I notice that redeployMode is not on by default; should we?

Also, does this patch fixes the problems in the bug report?  If so, please
update bugzilla.  If not, what are the problems that was not addressed?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>35575</commentid>
    <comment_count>3</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-04-18 18:04:46 +0000</bug_when>
    <thetext>There have been some changes in this area of the code, and since I haven't heard
from you, I assume that it has been fixed.  Reopen if that's not the case.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>3953</attachid>
            <date>2002-11-26 14:55:00 +0000</date>
            <delta_ts>2002-11-26 14:55:48 +0000</delta_ts>
            <desc>Patch which partially addresses the above issues</desc>
            <filename>patch.txt</filename>
            <type>text/plain</type>
            <size>4462</size>
            <attacher name="Petr Jiricka">petr.jiricka</attacher>
            

          </attachment>
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>15002</bug_id>
          
          <creation_ts>2002-12-02 19:28:00 +0000</creation_ts>
          <short_desc>Tag files in different directories not belonging to different tag libraries</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jan Luehe">jan.luehe</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>backhous</cc>
    
    <cc>Phil.Hanna</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>27270</commentid>
    <comment_count>0</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-12-02 19:28:24 +0000</bug_when>
    <thetext>Tag files located in different directories must belong to different implicit tag
libraries.

However, Jasper currently stores the corresponding tag handlers in the same
directory (&lt;web-app-name&gt;/tagfiles/org/apache/jsp/tagfile/) and assigns them to
the same package.

For example, the tag handlers corresponding to

  /WEB-INF/tags/foo/test.tag and
  /WEB-INF/tags/bar/test.tag

in a web application named "webtest" are both stored in 

  &lt;scratch_dir&gt;/webtest/tagfiles/org/apache/jsp/tagfile/test.java</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>27271</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-12-02 19:29:54 +0000</bug_when>
    <thetext>The path of a tag file is now reflected in the directory in which the
corresponding tag handler is stored, and in the name of the package to
which the tag handler is assigned.

This change also avoids conflicts between tag files with the same name
and path under /META-INF/tags/ and /WEB-INF/tags/, by adding "meta" or
"web", respectively, to the directory and package names of the
respective tag handlers.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>27278</commentid>
    <comment_count>2</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2002-12-02 19:52:46 +0000</bug_when>
    <thetext>*** Bug 14741 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>27280</commentid>
    <comment_count>3</comment_count>
    <who name="Richard Backhouse">backhous</who>
    <bug_when>2002-12-02 20:08:35 +0000</bug_when>
    <thetext>This fix breaks ALL tag files with the latest checkout from cvs you get this
if you run the Hello World tag file example :

org.apache.jasper.JasperException: Unable to compile class for JSP
	at org.apache.jasper.JspCompilationContext.compile
(JspCompilationContext.java:564)
	at org.apache.jasper.servlet.JspServletWrapper.loadTagFile
(JspServletWrapper.java:207)
	at org.apache.jasper.compiler.TagFileProcessor.loadTagFile
(TagFileProcessor.java:388)
	at org.apache.jasper.compiler.TagFileProcessor.access$000
(TagFileProcessor.java:83)
	at 
org.apache.jasper.compiler.TagFileProcessor$TagFileLoaderVisitor.visit
(TagFileProcessor.java:430)
	at org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1038)
	at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1554)
	at org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:1596)
	at org.apache.jasper.compiler.Node$Visitor.visit(Node.java:1602)
	at org.apache.jasper.compiler.Node$Root.accept(Node.java:345)
	at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1554)
	at org.apache.jasper.compiler.TagFileProcessor.loadTagFiles
(TagFileProcessor.java:448)
	at org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:285)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:413)
	at org.apache.jasper.JspCompilationContext.compile
(JspCompilationContext.java:558)
	at org.apache.jasper.servlet.JspServletWrapper.service
(JspServletWrapper.java:289)
	at org.apache.jasper.servlet.JspServlet.serviceJspFile
(JspServlet.java:295)
	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:241)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter
(ApplicationFilterChain.java:280)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter
(ApplicationFilterChain.java:194)
	at org.apache.catalina.core.StandardWrapperValve.invoke
(StandardWrapperValve.java:277)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:490)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)
	at org.apache.catalina.core.StandardContextValve.invoke
(StandardContextValve.java:191)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke
(AuthenticatorBase.java:496)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:149)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:490)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)
	at org.apache.catalina.core.StandardContext.invoke
(StandardContext.java:2523)
	at org.apache.catalina.core.StandardHostValve.invoke
(StandardHostValve.java:180)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.valves.ErrorDispatcherValve.invoke
(ErrorDispatcherValve.java:170)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:149)
	at org.apache.catalina.valves.ErrorReportValve.invoke
(ErrorReportValve.java:172)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:149)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:490)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)
	at org.apache.catalina.core.StandardEngineValve.invoke
(StandardEngineValve.java:174)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:490)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service
(CoyoteAdapter.java:223)
	at org.apache.coyote.http11.Http11Processor.process
(Http11Processor.java:432)
	at 
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio
n(Http11Protocol.java:386)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt
(PoolTcpEndpoint.java:534)
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run
(ThreadPool.java:530)
	at java.lang.Thread.run(Thread.java:536)


root cause 

java.io.FileNotFoundException: no such file: C:\dev\jakarta\jakarta-tomcat-5
\build\work\Standalone\localhost\jsp-examples\tags\helloWorld.class
	at org.apache.jasper.compiler.SmapUtil$SDEInstaller.(SmapUtil.java:220)
	at org.apache.jasper.compiler.SmapUtil$SDEInstaller.install
(SmapUtil.java:208)
	at org.apache.jasper.compiler.SmapUtil.installSmap(SmapUtil.java:147)
	at org.apache.jasper.compiler.Compiler.generateClass(Compiler.java:404)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:414)
	at org.apache.jasper.JspCompilationContext.compile
(JspCompilationContext.java:558)
	at org.apache.jasper.servlet.JspServletWrapper.loadTagFile
(JspServletWrapper.java:207)
	at org.apache.jasper.compiler.TagFileProcessor.loadTagFile
(TagFileProcessor.java:388)
	at org.apache.jasper.compiler.TagFileProcessor.access$000
(TagFileProcessor.java:83)
	at 
org.apache.jasper.compiler.TagFileProcessor$TagFileLoaderVisitor.visit
(TagFileProcessor.java:430)
	at org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1038)
	at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1554)
	at org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:1596)
	at org.apache.jasper.compiler.Node$Visitor.visit(Node.java:1602)
	at org.apache.jasper.compiler.Node$Root.accept(Node.java:345)
	at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1554)
	at org.apache.jasper.compiler.TagFileProcessor.loadTagFiles
(TagFileProcessor.java:448)
	at org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:285)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:413)
	at org.apache.jasper.JspCompilationContext.compile
(JspCompilationContext.java:558)
	at org.apache.jasper.servlet.JspServletWrapper.service
(JspServletWrapper.java:289)
	at org.apache.jasper.servlet.JspServlet.serviceJspFile
(JspServlet.java:295)
	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:241)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter
(ApplicationFilterChain.java:280)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter
(ApplicationFilterChain.java:194)
	at org.apache.catalina.core.StandardWrapperValve.invoke
(StandardWrapperValve.java:277)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:490)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)
	at org.apache.catalina.core.StandardContextValve.invoke
(StandardContextValve.java:191)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke
(AuthenticatorBase.java:496)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:149)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:490)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)
	at org.apache.catalina.core.StandardContext.invoke
(StandardContext.java:2523)
	at org.apache.catalina.core.StandardHostValve.invoke
(StandardHostValve.java:180)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.valves.ErrorDispatcherValve.invoke
(ErrorDispatcherValve.java:170)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:149)
	at org.apache.catalina.valves.ErrorReportValve.invoke
(ErrorReportValve.java:172)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:149)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:490)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)
	at org.apache.catalina.core.StandardEngineValve.invoke
(StandardEngineValve.java:174)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:490)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service
(CoyoteAdapter.java:223)
	at org.apache.coyote.http11.Http11Processor.process
(Http11Processor.java:432)
	at 
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio
n(Http11Protocol.java:386)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt
(PoolTcpEndpoint.java:534)
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run
(ThreadPool.java:530)
	at java.lang.Thread.run(Thread.java:536)

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>27288</commentid>
    <comment_count>4</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-12-02 23:00:17 +0000</bug_when>
    <thetext>All the tag file examples of the jsp-examples webapp work for me.
Please make sure to remove your installation's scratch dir and to
do a clean build of jasper.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>27329</commentid>
    <comment_count>5</comment_count>
    <who name="Richard Backhouse">backhous</who>
    <bug_when>2002-12-03 14:43:38 +0000</bug_when>
    <thetext>I tried building the whole of tomcat-5 from scratch on a different machine and 
got the same error. 

After investigating it more it seems that the problem is that the tagfile java 
file is being created in the wrong directory. When I hit the hello world tagfile
example the helloWorld.java is in this directory :

\Standalone\localhost\jsp-examples\tags

when it should be in 

\Standalone\localhost\jsp-examples\tags\org\apache\jsp\tag\web

After copying the java file to this directory and hitting the jsp again it works

So to reiterate i get this with a complete fresh checkout of all of tomcat-5.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>27445</commentid>
    <comment_count>6</comment_count>
    <who name="Phil Hanna">Phil.Hanna</who>
    <bug_when>2002-12-04 22:47:55 +0000</bug_when>
    <thetext>I also get the same error as Richard, both for the JSP examples and for any tag 
files I write from scratch.  I am using the nightly build of Tomcat 5 on 
Windows NT 4.0, with clean directories.  It worked up until November 27 and 
stopped working after this fix was applied.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>27447</commentid>
    <comment_count>7</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-12-05 00:00:06 +0000</bug_when>
    <thetext>Looking into this. Problem must be related to file path separators on Windows.
Examples work fine on Solaris.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40958</commentid>
    <comment_count>8</comment_count>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-07-19 00:53:05 +0000</bug_when>
    <thetext>I'm unable to reproduce this, so I assume it has been fixed, and just not 
updated in Bugzilla.  Anyone who can reproduce it, please reopen.

Running a fresh checkout of Tomcat 5 on Windows XP, I was able to run all the 
tagfile examples in the jsp-examples webapp.

I also tested the original problem case of /WEB-INF/tags/foo/test.tag and /WEB-
INF/tags/bar/test.tag.  There was no sign of a conflict, and the tags compiled 
to &lt;scratch_dir&gt;/&lt;appname&gt;/org/apache/jsp/tag/web/foo/test.java and 
&lt;scratch_dir&gt;/&lt;appname&gt;/org/apache/jsp/tag/web/bar/test.java, respectively, as 
Jan's note said they would.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>15003</bug_id>
          
          <creation_ts>2002-12-02 19:39:00 +0000</creation_ts>
          <short_desc>Tag pool size not configurable</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jan Luehe">jan.luehe</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>27272</commentid>
    <comment_count>0</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-12-02 19:39:26 +0000</bug_when>
    <thetext> </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>27273</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-12-02 19:42:10 +0000</bug_when>
    <thetext>Added init parameter named "tagPoolSize".
</thetext>
  </long_desc>
      
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>15189</bug_id>
          
          <creation_ts>2002-12-09 18:05:00 +0000</creation_ts>
          <short_desc>Error message provided when jsp:param element is not used properly is misleading</short_desc>
          <delta_ts>2004-11-16 19:05:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>27557</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2002-12-09 18:05:44 +0000</bug_when>
    <thetext>Example:

test.jsp
--------------------------

&lt;jsp:param name="param1" value="value1" /&gt;

&lt;%-- end of JSP --%&gt;

When Jasper processes this page the following error message is returned:

  'The action is not a recognizable standard action.'

This is somewhat misleading since jsp:param is a valid standard action, but the
usage context is incorrect.

I would like to request that the parser be enhanced to handle such cases so that
meaningful error messages can be provided.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>15337</bug_id>
          
          <creation_ts>2002-12-12 22:17:00 +0000</creation_ts>
          <short_desc>ArrayIndexOutOfBoundException thrown when bad JSP provided to Jasper parser</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>27767</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2002-12-12 22:17:08 +0000</bug_when>
    <thetext>Given the following invalid JSP page:
----------- Invalid.jsp ----------------

&lt;jsp:plugin code="foo.class" codebase="/" &gt;

----------------------------------------

The following exception is raised:

[java] &lt;/pre&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;root cause&lt;/b&gt;
&lt;pre&gt;java.lang.ArrayIndexOutOfBoundsException: 329
     [java]     at org.apache.jasper.compiler.JspReader.peekChar(JspReader.java:222)
     [java]     at org.apache.jasper.compiler.JspReader.isSpace(JspReader.java:412)
     [java]     at
org.apache.jasper.compiler.JspReader.skipSpaces(JspReader.java:320)
     [java]     at
org.apache.jasper.compiler.JspReader.matchesOptionalSpacesFollowedBy(JspReader.java:309)


I think Jasper could report this a bit better stating the action isn't closed
vs. what is currently returned.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>15338</bug_id>
          
          <creation_ts>2002-12-12 22:25:00 +0000</creation_ts>
          <short_desc>jsp:params action used outside of the expected context yields misleading error message.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>27768</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2002-12-12 22:25:53 +0000</bug_when>
    <thetext>Given the following JSP:

-------- InvalidUsage.jsp -----------

&lt;jsp:params&gt;
   &lt;jsp:param name="param1" value="value1" /&gt;
&lt;/jsp:params&gt;

-------------------------------------

The following error is returned:
org.apache.jasper.JasperException: /JspParamsUsageContextTest.jsp(10,5) The
action is not a recognizable standard action.

This is misleading as jsp:params is a standard action.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>15354</bug_id>
          
          <creation_ts>2002-12-13 14:44:00 +0000</creation_ts>
          <short_desc>Jasper doesn't cause a translation error if an EL or RT expression is provided to an attribute of jsp:plugin that doesn't accept dynamic attribute values.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>27801</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2002-12-13 14:44:58 +0000</bug_when>
    <thetext>According to Sections JSP.1.14.1 and JSP.5.7, the only attributes of the
jsp:plugin action that accept dynamic attribute values are the height and width
attributes.  

A translation-time error must occur if any other attribute of the jsp:plugin
action is provided either an EL or RT expression.

A translation error doesn't occur in this case for the following attributes:

align
codebase
code
hspace
vspace
iepluginurl
nspluginurl
jreversion
name
type *

* When providing an RT or EL expression to the 'type' attribute
  a translation error does occur, but for the wrong reason.  The
  error in this case is that the value provided to the type attribute
  is invalid.  The value must be 'bean' or 'applet'.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>27810</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2002-12-13 15:28:13 +0000</bug_when>
    <thetext>Add 'archive' to the list of static attributes.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>15355</bug_id>
          
          <creation_ts>2002-12-13 14:47:00 +0000</creation_ts>
          <short_desc>If a jsp:params element (nested within a jsp:plugin element) has no nested jsp:param elements, a translation error is not generated.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>27802</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2002-12-13 14:47:50 +0000</bug_when>
    <thetext>The syntax for jsp:plugin, according to JSP.5.7 states that if the jsp:params
element is present as a child of the jsp:plugin element, it must have at least one
nested jsp:param element.  

However, if Jasper is provided a JSP that contains such an error condition, no
translation-time error is raised.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>15360</bug_id>
          
          <creation_ts>2002-12-13 15:17:00 +0000</creation_ts>
          <short_desc>jsp:fallback action used outside of the expected context yields misleading error message.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>27809</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2002-12-13 15:17:56 +0000</bug_when>
    <thetext>Given the following JSP:

-------- InvalidUsage.jsp -----------

&lt;jsp:fallback&gt;fallback_text&lt;/jsp:fallback&gt;

-------------------------------------

The following error is returned:
org.apache.jasper.JasperException: /JspParamsUsageContextTest.jsp(10,5) The
action is not a recognizable standard action.

This is misleading as jsp:fallback is a standard action.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>15364</bug_id>
          
          <creation_ts>2002-12-13 16:03:00 +0000</creation_ts>
          <short_desc>The jsp:body action doesn't work as expected when used with the jsp:fallback action.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>27811</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2002-12-13 16:03:01 +0000</bug_when>
    <thetext>If the body of jsp:fallback is supplied via a jsp:body action, the jsp:body
action is treated as template text and appears in the response.

Example output:
------------------------------------------
&lt;OBJECT classid=clsid:8AD9C840-044E-11D1-B3E9-00805F499D93 name="test"
width="10" height="10" hspace="1" vspace="1" align="middle"
codebase="http://www.nowaythiswebsitecouldpossiblyexist.com"&gt;
     [java] &lt;PARAM name="java_code" value="foo.class"&gt;
     [java] &lt;PARAM name="java_codebase" value="/"&gt;
     [java] &lt;PARAM name="java_archive" value="test.jar"&gt;
     [java] &lt;PARAM name="type" value="application/x-java-bean;version=1.3.1"&gt;
     [java] &lt;PARAM name="test" value="testvalue"&gt;
     [java] &lt;COMMENT&gt;
     [java] &lt;EMBED type="application/x-java-bean;version=1.3.1" name="test"
width="10" height="10" hspace="1" vspace="1" align="middle"
pluginspage="http://www.nowaythiswebsitecouldpossiblyexist.com"
java_code="foo.class" java_codebase="/" java_archive="test.jar" test="testvalue"&gt;
     [java] &lt;NOEMBED&gt;
     [java] &lt;/COMMENT&gt;
     [java]                 &lt;jsp:body&gt;fallback_text&lt;/jsp:body&gt;
     [java] &lt;/NOEMBED&gt;&lt;/EMBED&gt;
     [java] &lt;/OBJECT&gt;</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>15391</bug_id>
          
          <creation_ts>2002-12-16 12:08:00 +0000</creation_ts>
          <short_desc>Jasper generates a translation error if the body of jsp:params is supplied though jsp:body</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>27869</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2002-12-16 12:08:30 +0000</bug_when>
    <thetext>Given the following segment
-------------------------------------------------

&lt;jsp:plugin code="foo.class" codebase="/"&gt;
    &lt;jsp:params&gt;
        &lt;jsp:body&gt;
            &lt;jsp:param name="param1" value="param2" /&gt;
        &lt;/jsp:body&gt;
    &lt;/jsp:params&gt;
&lt;/jsp:plugin&gt;

--------------------------------------------------

A translation error is incorrectly generated with the following
message.

  Expected "param" tag with "name" and "value" attributes

Section 5.11 of the 2.0 PFD states:

  "It is also legal to use the &lt;jsp:body&gt; standard action to supply
   bodies to standard actions, for *any* standard action that accepts
   a body."</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>15404</bug_id>
          
          <creation_ts>2002-12-16 15:57:00 +0000</creation_ts>
          <short_desc>No error condition raised if mandatory TLD elements &lt;jsp-version&gt; and &lt;tlib-version&gt; are not present in the TLD</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>27882</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2002-12-16 15:57:59 +0000</bug_when>
    <thetext>According to the PFD specification, the TLD elements &lt;jsp-version&gt; and
&lt;tlib-version&gt; are supposed to be mandatory, however, Jasper doesn't raise an
error condition if it encounters a TLD with these elements missing.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>15410</bug_id>
          
          <creation_ts>2002-12-16 19:16:00 +0000</creation_ts>
          <short_desc>if the jsp:attribute action is used out of the spec'd context, a misleading error message is generated.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>27891</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2002-12-16 19:16:43 +0000</bug_when>
    <thetext>The following message is generated when using jsp:attribute in a context other
than nesting within a standard or custom action:

    - The action is not a recognizable standard action.

This error is misleading as jsp:attribute is a standard action...just the usage
context is incorrect.

Would like to request that Jasper be enhanced to have a more meaningful error
message.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>15411</bug_id>
          
          <creation_ts>2002-12-16 19:48:00 +0000</creation_ts>
          <short_desc>A translation error does not occur if jsp:attribute is used to provide an attribute value for an XML element that should be conisdered template text.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>27896</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2002-12-16 19:48:26 +0000</bug_when>
    <thetext>JSP.5.10 - &lt;jsp:attribute&gt; - states:

  "The action must only appear as a subelement of a standard or custom action.  
   An attempt to use it otherwise must result in a translation error."

The spec then gives an example

  "For example, it cannot be used to specify the value of an attribute for
   XML elements that are template text."

Given the following:

-----------------------------------------------
&lt;?xml version="1.0"?&gt;

&lt;root&gt;
    &lt;child&gt;
        &lt;jsp:attribute xmlns:jsp="http://java.sun.com/JSP/Page"
            name="myAttrName"&gt;
           myAttrValue
        &lt;/jsp:attribute&gt;
    &lt;/child&gt;
&lt;/root&gt;
-------------------------------------------

A translation-time error is not generated.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>15771</bug_id>
          
          <creation_ts>2003-01-03 00:48:00 +0000</creation_ts>
          <short_desc>correction needed to Makefile.apxs</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:AJP</component>
          <version>5.0.0</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Philip Brown">phil</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>28834</commentid>
    <comment_count>0</comment_count>
    <who name="Philip Brown">phil</who>
    <bug_when>2003-01-03 00:48:25 +0000</bug_when>
    <thetext>jk/native2/server/apache13/Makefile.apxs.in
the line with $(APXS) in it needs to be fixed, to replace

  mod_jk2.c

with something like

 ${C_FILES}

Then C_FILES needs to be defined to add jk_service_apache13.c

eg:

C_FILES=jk_service_apache13.c mod_jk2.c

the code does not properly build as-is, since the DSO will be missing the code
in jk_service_apache13.c


PS: This is with "jk2-2.0.2" source.

I think it should really have its own bug area. But since it doesnt, I guess I
have to file the bug in this section.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39528</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2003-06-26 23:45:47 +0000</bug_when>
    <thetext>Fixed per patch suggestions.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>15772</bug_id>
          
          <creation_ts>2003-01-03 02:19:00 +0000</creation_ts>
          <short_desc>catalina's web.xml missing mime-types some incorrect...</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jacob Kjome">hoju</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>28837</commentid>
    <comment_count>0</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2003-01-03 02:19:43 +0000</bug_when>
    <thetext>I had reported a bug with Tomcat-4.1.10 missing xml and xsl mime type entries. 
It was fixed shortly thereafter, but it doesn't seem as if the change ever made
it to Tomcat5.  There are also a few other issues that are listed below...

The following mime-types are missing...

&lt;mime-mapping&gt;
    &lt;extension&gt;jsf&lt;/extension&gt;
    &lt;mime-type&gt;text/plain&lt;/mime-type&gt;
&lt;/mime-mapping&gt;
&lt;mime-mapping&gt;
    &lt;extension&gt;jspf&lt;/extension&gt;
    &lt;mime-type&gt;text/plain&lt;/mime-type&gt;
&lt;/mime-mapping&gt;

The above was added in the Tomcat-4.1.11 release by Remy.  See the following for
info:
http://nagoya.apache.org/bugzilla/show_bug.cgi?id=11674

&lt;mime-mapping&gt;
    &lt;extension&gt;xml&lt;/extension&gt;
    &lt;mime-type&gt;text/xml&lt;/mime-type&gt;
&lt;/mime-mapping&gt;
&lt;mime-mapping&gt;
    &lt;extension&gt;xsl&lt;/extension&gt;
    &lt;mime-type&gt;text/xml&lt;/mime-type&gt;
&lt;/mime-mapping&gt;


The following is wrong...

&lt;mime-mapping&gt;
    &lt;!-- WML Script Source --&gt;
    &lt;extension&gt;wmls&lt;/extension&gt;
    &lt;mime-type&gt;text/vnd.wap.wmls&lt;/mime-type&gt;
&lt;/mime-mapping&gt;

it should be...

&lt;mime-mapping&gt;
    &lt;!-- WML Script Source --&gt;
    &lt;extension&gt;wmls&lt;/extension&gt;
    &lt;mime-type&gt;text/vnd.wap.wmlscript&lt;/mime-type&gt;
&lt;/mime-mapping&gt;

I also cleaned up a couple of white space issues that were different between the
Tomcat-4.1.18 web.xml file and the Tomcat-5.0 nightly web.xml file.  A corrected
version is coming up...

Jake</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>28838</commentid>
    <comment_count>1</comment_count>
      <attachid>4327</attachid>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2003-01-03 02:22:05 +0000</bug_when>
    <thetext>Created attachment 4327
zip file containing corrected web.xml based on Tomcat-5.0-nightly 2003-01-02</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>29020</commentid>
    <comment_count>2</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2003-01-08 16:18:24 +0000</bug_when>
    <thetext>OK I have ported the change from Tomcat 4.1.x branch and make the change you
requested. What is the white space issue?

-- Jeanfrancois</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>29032</commentid>
    <comment_count>3</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2003-01-08 19:36:29 +0000</bug_when>
    <thetext>The white-space issue isn't much of an issue.  In the mods I made, I just made 
sure that anything in common between the web.xml from Tomcat-4.1.18 and Tomcat-
5.0 looked exactly the same.  Since Tomcat-4.1.18 is the stable side of things, 
I made the web.xml of Tomcat-5.0 match that of Tomcat-4.1.18.  In the case of 
white-space, this means that if the web.xml of Tomcat-5.0 had an extra tab at 
the end of a line where it didn't in Tomcat-4.1.18, I removed it to make it 
match Tomcat-4.1.18's web.xml.  To see what I am talking about, perform a diff 
on the old Tomcat-5.0 web.xml and compare it to that of Tomcat-4.1.18.  Notice 
the differences where there really shouldn't be any?

Does that make sense?  It may seem pedantic, but it makes it easier to perform 
diff's on the files so that it is easier to keep them in sync.  Again, not a 
big issue, but I figured I might as well fix it while I was making other more 
meaningful changes.  Thanks for applying the changes!

Jake</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>4327</attachid>
            <date>2003-01-03 02:22:00 +0000</date>
            <delta_ts>2003-01-03 02:22:05 +0000</delta_ts>
            <desc>zip file containing corrected web.xml based on Tomcat-5.0-nightly 2003-01-02</desc>
            <filename>web.xml-corrected.zip</filename>
            <type>application/octet-stream</type>
            <size>5368</size>
            <attacher name="Jacob Kjome">hoju</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>15774</bug_id>
          
          <creation_ts>2003-01-03 06:50:00 +0000</creation_ts>
          <short_desc>tomcat5 shared/lib behavior different than that of tomcat4.1.x</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jacob Kjome">hoju</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>28840</commentid>
    <comment_count>0</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2003-01-03 06:50:04 +0000</bug_when>
    <thetext>Using Tomcat-4.1.x, I can have separate instances of Tomcat running which access
their own shared/lib folder.  In Tomcat-5.0 latest nightly build, that doesn't
seem to be the case.  In fact, Tomcat5 only ever sees CATALINA_HOME/shared/lib
where Tomcat4.1.x only ever sees CATALINA_BASE/shared/lib and only when
CATALINA_BASE happens to be the same as CATALINA_HOME does Tomcat4.1.x see
CATALINA_HOME/shared/lib.

For instance, using Tomcat-4.1.18, if I have some jars in
CATALINA_HOME/shared/lib and I start up a new tomcat instance with CATALINA_BASE
set as something other than CATALINA_HOME, the jars in CATALINA_HOME/shared/lib
will *not* be loaded.  Instead, jars will be loaded from
CATALINA_BASE/shared/lib (if it exists).  This is the behavior I expect and love!

However, using Tomcat-5.0, if I set things up the same way, jars in
CATALNIA_HOME/shared/lib *will* be loaded and jars in CATALNIA_BASE/shared/lib
are completely ignored. This is behavior that I don't expect and don't like.

For a concrete example...
I use the capability of running separate instances of Tomcat to run apps which
require different versions of xerces.  I put xerces-1.4.4.jar in
CATALINA_HOME/shared/lib for apps which I use most often.  However, I have other
apps that need either slightly modified version of xerces-1.4.4 or require
xerces-2.x.x.  For those cases, I run separate instances of Tomcat (running on
different ports, of course), each with a distinct CATALNIA_BASE and a local
CATALINA_BASE/shared/lib with the appropriately versioned jars that I need for a
particular set of apps.  Everyone is happy because everyone gets to use their
own shared set of libraries without stepping on each other.

So, obviously, this is a great feature in Tomcat-4.1.x (and, I assume,
Tomcat-4.0.x) but it seems to be broken in Tomcat-5.0.  

Is this new behavior in Tomcat-5.0 a bug or was it intentional?  If it was
intentional, can someone please explain the reasons for the change in behavior
to that of Tomcat-4.1.x?

Jake</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>29389</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-01-15 08:28:06 +0000</bug_when>
    <thetext>This should work off CATALINA_BASE by default again now. You may also configure 
the CL using conf/catalina.properties (so don't complain).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>29438</commentid>
    <comment_count>2</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2003-01-15 18:13:36 +0000</bug_when>
    <thetext>Thanks Remy,

No complaints here.  I had no idea it was setable in catalina.propeties as that
didn't exist in Tomcat-4.x.x.  Without default behavior being the same as
Tomcat-4.1.x, though, I think that would be an issue for those counting on the
behavior and not having the proper info on how to get the desired behavior. 
This just makes the default config of Tomcat-5 simpler.  Again, thanks for
making the change and pointing out where I can change it myself.

Jake</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>29454</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-01-15 20:00:54 +0000</bug_when>
    <thetext>Actually, the classloading scheme may undergo a radical change by the time
Tomcat 5 gets released.</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>15851</bug_id>
          
          <creation_ts>2003-01-07 18:55:00 +0000</creation_ts>
          <short_desc>Parser generates a NullPointerException for invalid use case of jsp:attribute instead of a useful message.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>28947</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-01-07 18:55:10 +0000</bug_when>
    <thetext>Consider the following fragment which is supposed to generate a translation-time
error:

&lt;jsp:attribute&gt;
    &lt;jsp:attribute name="name"&gt;
        someattr
    &lt;/jsp:attribute&gt;
    &lt;jsp:body&gt;
        someattrvalue
    &lt;/jsp:body&gt;
&lt;/jsp:attribute&gt;

According to the specification, if a jsp:attribute standard action is nested
within another jsp:attribute standard action, a translation error must occur.

In this case, a translation error does occur, but for the wrong reason.  Here is
the resulting cause:

&lt;stacktrace&gt;
java.lang.NullPointerException
        at org.apache.jasper.compiler.Parser.getAttributeBodyType(Parser.java:1736)
        at org.apache.jasper.compiler.Parser.parseNamedAttributes(Parser.java:1710)
        at
org.apache.jasper.compiler.Parser.parseJspAttributeAndBody(Parser.java:1045)
        at org.apache.jasper.compiler.Parser.parseOptionalBody(Parser.java:1017)
        at org.apache.jasper.compiler.Parser.parseCustomTag(Parser.java:1313)
        at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1458)
        at org.apache.jasper.compiler.Parser.parse(Parser.java:164)
&lt;/stacktrace&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>29631</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2003-01-17 20:15:26 +0000</bug_when>
    <thetext>NPE no longer occurs, but error message:

  jsp:attribute must be the subelement of a standard or custom action

is not what we want:

  a jsp:attribute standard action cannot be nested within another jsp:attribute
  standard action
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>29827</commentid>
    <comment_count>2</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-01-22 01:49:05 +0000</bug_when>
    <thetext>The test page

&lt;jsp:attribute&gt;
    &lt;jsp:attribute name="name"&gt;
        someattr
    &lt;/jsp:attribute&gt;
    &lt;jsp:body&gt;
        someattrvalue
    &lt;/jsp:body&gt;
&lt;/jsp:attribute&gt;

is not a valid page.  The compiler's error message

    jsp:attribute must be the subelement of a standard or custom action

is valid.  If the page is modified so that jsp:attribute is nested in a standard
action, such as

&lt;jsp:include&gt;
  &lt;jsp:attribute&gt;
    &lt;jsp:attribute name="name"&gt;
        someattr
    &lt;/jsp:attribute&gt;
    &lt;jsp:body&gt;
        someattrvalue
    &lt;/jsp:body&gt;
  &lt;/jsp:attribute&gt;
&lt;/jsp:include&gt;

then the compiler will generate the message

    a jsp:attribute standard action cannot be nested within another
    jsp:attribute standard action

as expected.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>15854</bug_id>
          
          <creation_ts>2003-01-07 19:42:00 +0000</creation_ts>
          <short_desc>Unable to provide a qname attribute value to the name attribute of the jsp:attribute action.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>28952</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-01-07 19:42:01 +0000</bug_when>
    <thetext>According to table JSP.5-8, in particular the section regarding the 'name'
attribute:

    "The value of name can be a QName.  If so, the prefix must match that of the 
     action it applies to,...."

So given the following:

&lt;some:action&gt;
    &lt;jsp:attribute name="some:attributename"&gt;
        attributevalue
    &lt;/jsp:attribute&gt;
&lt;/some:action&gt;

The following error is incorrectly returned:

&lt;error&gt;
/JspAttributeQNameTest1.jsp(9,0) According to the TLD attribute attributename is
mandatory for tag action
&lt;/error&gt;</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>15863</bug_id>
          
          <creation_ts>2003-01-07 21:31:00 +0000</creation_ts>
          <short_desc>An NPE occurs in Jasper2's parser when the body of jsp:attribute is empty.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>28972</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-01-07 21:31:44 +0000</bug_when>
    <thetext>According to the JSP 2.0 specicifcation, if the body of the jsp:attribute action
is empty, it is the equivalent of specifying "" as the value of the attribute.

When Jasper2 is provided such a scenario, an NPE occurs.

Stacktrace below:

&lt;stacktrace&gt;
java.lang.NullPointerException
        at
org.apache.jasper.compiler.Validator$ValidateVisitor.visit(Validator.java:825)
        at org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1022)
        at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1634)
        at org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:1676)
        at org.apache.jasper.compiler.Node$Visitor.visit(Node.java:1682)
        at org.apache.jasper.compiler.Node$Root.accept(Node.java:323)
        at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1634)
        at org.apache.jasper.compiler.Validator.validate(Validator.java:1167)
        at org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:260)
        at org.apache.jasper.compiler.Compiler.compile(Compiler.java:427)
        at
org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:571)
&lt;/stacktrace&gt;</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>15904</bug_id>
          
          <creation_ts>2003-01-08 20:37:00 +0000</creation_ts>
          <short_desc>UnsupportedEncodingException not thrown if invalid charset (from content type) is set and a call to ServletResponse.getWriter() is made.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>29040</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-01-08 20:37:35 +0000</bug_when>
    <thetext>According the the javadocs for Servletrespons.getWriter():
  - "java.io.UnsupportedEncodingException - if the charset specified in
setContentType cannot be used"

The following code doesn't cause the UnsupportedEncodingException to be thrown:

response.setContentType("text/html; charset=invalid-charset");
response.getWriter();</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>29268</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-01-13 15:05:11 +0000</bug_when>
    <thetext>Fixed in CVS (a few days ago).</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>15937</bug_id>
          
          <creation_ts>2003-01-09 23:42:00 +0000</creation_ts>
          <short_desc>Misleading error message produced if jsp:body is not a child of a standard or custom action.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>29093</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-01-09 23:42:18 +0000</bug_when>
    <thetext>The following error is produced when jsp:body is not a child of a custom or
standard action:

   "The action is not a recognizable standard action."

This is misleading as jsp:body is indeed a standard action.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>15961</bug_id>
          
          <creation_ts>2003-01-10 17:30:00 +0000</creation_ts>
          <short_desc>getBodyContent() is not returning null when the action has only jsp:attribute actions within the body.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>29137</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-01-10 17:30:01 +0000</bug_when>
    <thetext>JSP.5.11 states:

"If one or more jsp:attribute elements appear in the body of a tag invocation
but no jsp:body element appears, it is the equivalent of the tag having an empty
body"

Consider the following example using a tag handler that extends BodyTagSupport
and implements DynamicAttributes

&lt;body:cemptybody&gt;
    &lt;jsp:attribute name="attr1"&gt;value1&lt;/jsp:attribute&gt;
    &lt;jsp:attribute name="attr2"&gt;value2&lt;/jsp:attribute&gt;
&lt;/body:cemptybody&gt;

The cemptybody action attempts to validate that a call to getBodyContent()
returns null.

Keep in mind that the javadocs state that setBodyContent() will not be invoked for 
an empty tag.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>29381</commentid>
    <comment_count>1</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-01-15 00:49:46 +0000</bug_when>
    <thetext>The issue has been resolved for Classic tag handlers, however a clarification
has been added to the spec with regards to this case with Simple tag handlers:

JSP.12.6, item 5, bullet 1: Change to:

    * If the tag is declared to have a body-content
      of "empty" or no body or an empty body is passed
      for this invocation, then null is passed to
      setJspBody().

If the TLD doesn't mark body-content as empty and an empty jsp:body element is
provided, getJspBody() doesn't return null as it should.
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>15964</bug_id>
          
          <creation_ts>2003-01-10 18:32:00 +0000</creation_ts>
          <short_desc>Wrong source paths in generated SMAP file entries</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.0</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jim Hennessy">jph</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>29142</commentid>
    <comment_count>0</comment_count>
    <who name="Jim Hennessy">jph</who>
    <bug_when>2003-01-10 18:32:23 +0000</bug_when>
    <thetext>One of the new features of Jasper in Tomcat 5 is that it attaches a "Source
Map" attribute to class files to describe the file name and line number
mapping from a JSP source file to the generated Java source file.

According to JSR-45, each file entry in the SMAP defines a source name,
and optionally, a source path.  The SMAP that I see in the class files
generated by Jasper doesn't specify a source path.  This means that the
source path defaults to a subdirectory based on the package of the class
file.  In other words, for class files generated by Jasper, the source
path ends up being "org/apache/jsp".  This is the source path for both
the "JSP" stratum and the "Java" stratum.  The problem is that this
source path is wrong for both strata, given how Jasper stores files.

An example would help explain this.  Say the user wants to debug the
"numguess.jsp" file that's part of the "jsp-examples" web application
that comes with Tomcat.  I've written a debugger that allows the user to
enter directory names that the debugger should search for source files.
Other debuggers have pretty much the same technique for finding source
files.  For this discussion, let's call this the debugger's "search
path".  Let's say the entries in the search path are "A" and "B".  When
a debugger wants to locate a source file corresponding to a particular
location in a class, it uses the Java Debugging Interface (JDI) API to
read the source name and source path for the stratum it intends to use
for the display.  Let's assume for the moment it wants to use the JSP
stratum.  So the debugger first looks for the file
"A/org/apache/jsp/numguess.jsp", then for
"B/org/apache/jsp/numguess.jsp".  You get the idea.  The problem is that
there's no directory that the user could specify in the debugger's
search path that allows the debugger to find the file, because the jsp
file doesn't reside in a "org/apache/jsp" subdirectory of any directory.
Instead, it resides in the "TH/webapps/jsp-examples/num" directory,
where "TH" is the Tomcat home directory.

One possibility would be for Jasper to specify "." (just a dot, meaning
the current directory) as the source path in the SMAP for the JSP
stratum.  Then the user could enter "TH/webapps/jsp-examples/num" as the
path to search.  The debugger would be able to locate the file, since it
would then be looking for "TH/webapps/jsp-examples/num/./numguess.jsp".
But I have a better suggestion:  How about specifying the subdirectory
of the directory in which the web application is expanded?  Continuing
the example, this means specifying the source path "num" for the file
"numguess.jsp".  The user would then enter "TH/webapps/jsp-examples"
into the debugger's search path.  When the debugger tries to locate the
file, it will paste together these three pieces and come up with
"TH/webapps/jsp-examples/num/numguess.jsp", successfully finding the
file.  The advantage of this approach is that the user need only enter
the top directory of the web application into the debugger's search path
and the debugger will then be able to locate any JSP file for the web
application.  If "." were used, the user would need to enter every
directory under the web application's top directory that contains a JSP
to be debugged into the debugger's search path.

A similar problem exists for the "Java" stratum.  If the user of the
debugger wanted to debug the JSP using the Java stratum, the debugger
would try to locate the "numguess_jsp.java" file by searching the
subdirectories of the debugger's search path.  But again, the debugger
would be unable to find the java file because it doesn't reside in a
"org/apache/jsp" subdirectory of any directory.  Just poking around,
Jasper seems to put the Java source file under the "TH/work" directory, in
my case in the directory "TH/work/Standalone/localhost/jsp-examples/num".
The solution here isn't as simple as for the JSP stratum, however, since I
don't think it's possible to change the source path for a file in the Java
stratum in the SMAP.  In other words, the source path for
"numguess_jsp.java" is stuck being "org/apache/jsp", since that's the
package the class is in.  So, I can think of only two solutions:

1. Put the java file into the expected hierarchy.  Perhaps designate that
   the "jsp" subdirectory of the web application's work directory will be
   the root of all jsp-related Java source files.  Then change the Jasper
   source code generator to write the Java source file into the directory
   "TH/work/Standalone/localhost/jsp-examples/jsp/org/apache/jsp".  So the
   user of the debugger would enter
   "TH/work/Standalone/localhost/jsp-examples/jsp" into the debugger's
   search path, allowing it to locate any Java source file generated by
   Jasper for that web application.  I don't know if it's even necessary to
   create a "jsp" top directory.  I suggested it only to keep these source
   and class files out the way of any other files in the work area, but if in
   fact the work area isn't used for anything else, then leave it off.

2. Change the package associated with the generated Java file, so
   that the source file can be found where it is today.  I don't
   really like this suggestion, but I thought I'd mention it.  In our
   example, this means generating the source such that the
   "numguess_jsp.java" source file starts with "package num" instead
   of "package org.apache.jsp".  In this case, the user would enter
   "TH/work/Standalone/localhost/jsp-examples" into the debugger's
   search path, allowing it to locate any Java source file generated
   by Jasper for that web application.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34662</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-04-08 01:15:15 +0000</bug_when>
    <thetext>It looks like that if we use package names that mirror the file heirachy for the
JSP files, and place the .java and .class files in the similiar directory
heirachy, then we can solve the problem for both JSP and Java stratum.  Let me
elaborate.

The file TC/webapps/jsp-examples/num/numguess.jsp will have the package name of
"jsp.jsp-examples.num".  The prepend the name "jsp" is for the top level JSP
files, since they have to be in a package.  The generated .java and .class files
will then be in TC/work/Standalone/localhost/jsp/jsp-examples/num directory. 
Then we can leave the source path empty, as is now, and it'll be easy for the
user to tell the debugger where to find the .jsp and .class files.

If you think this will work, I'll make a proposal on the tomcat-dev.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34730</commentid>
    <comment_count>2</comment_count>
    <who name="Jim Hennessy">jph</who>
    <bug_when>2003-04-08 15:03:41 +0000</bug_when>
    <thetext>I like your proposal, I think.  To make sure I understand what you're proposing,
I'll continue the example for the numguess.jsp file:

1. For the JSP stratum, you'll store a source path of jsp-examples/num.
2. For the Java stratum, you'll put the generated Java and class files into the
   directory TC/webapps/work/Standalone/localhost/jsp/jsp-examples/num, and use
   a package name of jsp.jsp-examples.num in the Java file.

This seems very convienient for the user of the debugger.  They would add
TC/webapps to their debugger's search path in order to debug any JSP file (if
the war files are being exploded) in any web app in the JSP stratum, and
TC/webapps/work/Standalone/localhost to the search path to debug any generated
Java file in any web app in the Java stratum.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>35376</commentid>
    <comment_count>3</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-04-16 19:49:29 +0000</bug_when>
    <thetext>Fixed with my latest commit.  Let me know if there are problems.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>15966</bug_id>
          
          <creation_ts>2003-01-10 18:54:00 +0000</creation_ts>
          <short_desc>Jasper parser is incorrectly handling empty jsp:body elements</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>29145</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-01-10 18:54:24 +0000</bug_when>
    <thetext>Given the following productions:

JspBodyBody ::= (S? JspBodyEmptyBody)
              | (S&gt; '&gt;' (JspBodyBodyContent - '') '&lt;/jsp:boyd&gt;'

and

JspBodyEmptyBody ::=   '/&gt;'
                     | '&gt;&lt;/jsp:body&gt;'
                     | &lt;TRANSLATION_ERROR&gt;

Jasper generates a translation error with the error message of 
"&amp;lt;jsp:body&amp;gt; must not have any attributes" When it encounters 
something like:

  &lt;ctm:action&gt;
     &lt;jsp:body /&gt;
  &lt;ctm:action&gt;


For the following code snippet:

   &lt;ctm:action&gt;
      &lt;jsp:body&gt;&lt;/jsp:body&gt;
   &lt;cts:action&gt;

This error message is generated at translation time:

  "Empty body not allowed for &amp;lt;jsp:body&amp;gt;"  

which is incorrect according to the grammar.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>15967</bug_id>
          
          <creation_ts>2003-01-10 19:33:00 +0000</creation_ts>
          <short_desc>IllegalStateException not thrown by HttpSession.getLastAccessedTime() if session has been invalidated.</short_desc>
          <delta_ts>2008-02-27 02:17:53 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>kame</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>29149</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-01-10 19:33:40 +0000</bug_when>
    <thetext>According to the javadocs for HttpSession.getLastAccessedTime() will throw 
an IllegalStateException if called against a method that has been invalidated.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>29174</commentid>
    <comment_count>1</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2003-01-11 02:51:54 +0000</bug_when>
    <thetext>I have added the proper exception.

Thanks :-)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>111502</commentid>
    <comment_count>2</comment_count>
    <who name="Damien Bonvillain">kame</who>
    <bug_when>2007-12-06 06:46:01 +0000</bug_when>
    <thetext>getLastAccessedTime has never been marked as throwing IllegalStateException
(J2EE 1.2 =&gt; 1.4), and this is non-sense to make it throw it, because it's the
only way to detect conveniently that a session is in timeout (combined with
getMaxInactiveInterval).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>111517</commentid>
    <comment_count>3</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2007-12-06 11:20:09 +0000</bug_when>
    <thetext>Although this exception isn't in the pdf for the 2.4 spec it is in source code
and the javadoc. It was clearly intended to be there. It would have been
included in the pdf if it wasn't for the typo that was corrected in the first
errata.

See http://jcp.org/aboutJava/communityprocess/maintenance/jsr154/errata204.txt
for more details.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>114040</commentid>
    <comment_count>4</comment_count>
    <who name="Damien Bonvillain">kame</who>
    <bug_when>2008-02-27 02:17:53 +0000</bug_when>
    <thetext>&gt; Although this exception isn't in the pdf for the 2.4 spec

It has never been in the PDF spec, neither 2.2, 2.3 nor 2.4.

&gt; it is in source code and the javadoc.

It has never been in the publicized javadoc, neither 2.2, 2.3 nor 2.4.
http://java.sun.com/j2ee/1.4/docs/api/javax/servlet/http/HttpSession.html#getLastAccessedTime()
There is no source code for 2.2 or 2.3, it's binary only and non-normative.

&gt; It was clearly intended to be there. [...]
&gt; See http://jcp.org/aboutJava/communityprocess/maintenance/jsr154/errata204.txt
&gt; for more details.

I stand corrected. Maintenance Review 1 adds IllegalStateException on getId and getLastAccessedTime. Maintenance Review 5 (for 2.5) removes it from getId, but "leaves" it on getLastAccessedTime.
At least we've won a new definition of "clearly intended": "never present during 5 years of maintained documentation, and render the method useless". For the "method useless" part, see http://bugs.sun.com/view_bug.do?bug_id=6470831 , ain't it sweet to access internal method to circumvent a "clearly intended" misbehaviour? All we need now is to mark getMaxInactiveInterval() as throwing the same exception :-)</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>16027</bug_id>
          
          <creation_ts>2003-01-13 15:01:00 +0000</creation_ts>
          <short_desc>Misleading error message generated when jsp:body is nested within another jsp:body element.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>29266</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-01-13 15:01:52 +0000</bug_when>
    <thetext>In the case described in the summary, a translation error is generated, but
error message returned by the translation time error is misleading:

   "jsp:body must be the subelement of a standard or custom action"</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>16030</bug_id>
          
          <creation_ts>2003-01-13 16:52:00 +0000</creation_ts>
          <short_desc>Incorrected error message generated when jsp:body is used to provide the body of a jsp:attribute action</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>29279</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-01-13 16:52:18 +0000</bug_when>
    <thetext>The JSP 2.0 specification states that a translation-time error must occur if
jsp:body is used to provide the body of a jsp:attribute action.

While Jasper does generate a translation-time error for this case, the error
message is incorrect:

    "The action is not a recognizable standard action."</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>16077</bug_id>
          
          <creation_ts>2003-01-14 21:22:00 +0000</creation_ts>
          <short_desc>Invalid error generated when translating a valid JSP document</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>29368</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-01-14 21:22:27 +0000</bug_when>
    <thetext>Given the following simple JSP 2.0 Document:
&lt;?xml version="1.0"?&gt;
&lt;root xmlns:jsp="http://java.sun.com/JSP/Page"&gt;
    &lt;jsp:directive.page contentType="text/xml" /&gt;
    &lt;jsp:text&gt;&lt;![CDATA[Hello World]]&gt;&lt;/jsp:text&gt;
&lt;/root&gt;

The following error message is now returned with the latest nightly build:

  "jsp:attribute must be the subelement of a standard or custom action"</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>29372</commentid>
    <comment_count>1</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-01-14 21:49:45 +0000</bug_when>
    <thetext>*** Bug 16079 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>29373</commentid>
    <comment_count>2</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-01-14 21:51:13 +0000</bug_when>
    <thetext>Woke up a bit and noticed that the line the translator is complaining about in
all my cases is the &lt;root&gt; element with the jsp namespace declaration.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>16078</bug_id>
          
          <creation_ts>2003-01-14 21:36:00 +0000</creation_ts>
          <short_desc>Request parameter aggregation when using &lt;jsp:param&gt; is no longer working as expected.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>29369</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-01-14 21:36:30 +0000</bug_when>
    <thetext>Given the following request line:

    GET /test.jsp?param1=value1 HTTP/1.1

test.jsp
---------------------------------------
&lt;jsp:forward page="resource.jsp"&gt;
    &lt;jsp:param name="param1" value="value2" /&gt;
    &lt;jsp:param name="param2" value="value2" /&gt;
&lt;/jsp:forward&gt;
---------------------------------------

resource.jsp
-------------------------------------------------
&lt;%@ page contentType="text/plain" %&gt;
&lt;%
    String[] param1Values = request.getParameterValues("param1");
    String[] param2Values = request.getParameterValues("param2");
    for (int i = 0; i &lt; param1Values.length; i++) {
        out.println("PARAM1 VALUE: " + param1Values[i]);
    }
    for (int i = 0; i &lt; param2Values.length; i++) {
        out.println("PARAM2 VALUE: " + param2Values[i]);
    }

%&gt;
--------------------------------------------------------------------

When checking the values of the request parameters in resource.jsp,
param1 has value2,value2,value1 as values instead of value2,value1.
param2 has value2,value2 as values instead of just value2.

This worked properly in previous builds.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>30226</commentid>
    <comment_count>1</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2003-01-29 01:44:44 +0000</bug_when>
    <thetext>Fixed. mergeParameters was called twice.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>16088</bug_id>
          
          <creation_ts>2003-01-15 00:30:00 +0000</creation_ts>
          <short_desc>Translation error not generated if body of jsp:attribute, providing an attribute value of type JspFragment, contains a scripting element</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>29380</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-01-15 00:30:38 +0000</bug_when>
    <thetext>From JSP.5.10

   "For custom action attributes of type javax.servlet.jsp.tagext.JspFragment, 
    the container must create a JspFragment out of the body of the 
    &lt;jsp:attribute&gt; action and pass it to the tag handler.  This applies for
    both Classic Tag Handlers and Simple Tag Handlers.  A translation error must
    result if the body of the &lt;jsp:attribute&gt; action is not scriptless in this
    case"

Given
------------------------------------------------------------
&lt;%@ page contentType="text/plain" %&gt;
&lt;%@ taglib uri="http://blurb.org" prefix="attr" %&gt;

&lt;attr:classic&gt;
    &lt;jsp:attribute name="fragment"&gt;
        &lt;%= "fragment body" %&gt;
    &lt;/jsp:attribute&gt;
&lt;/attr:classic&gt;
-------------------------------------------------------------

In the TLD, the classic tag has one attribute named 'fragment' with the 
&lt;fragment&gt; element body set to true.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>16113</bug_id>
          
          <creation_ts>2003-01-15 16:43:00 +0000</creation_ts>
          <short_desc>removing then replacing a jsp page continues to give a 404</short_desc>
          <delta_ts>2005-07-07 16:07:11 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.19</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Donald Ball">dball</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>t_santosh_k</cc>
          <votes>7</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>29406</commentid>
    <comment_count>0</comment_count>
    <who name="Donald Ball">dball</who>
    <bug_when>2003-01-15 16:44:00 +0000</bug_when>
    <thetext>Hi guys. I've got what appears to be a bona fide error in tomcat's jsp servlet
or one of its friends. The steps to reproduce the problem are:

1. start tomcat-4.1.18 with a webapp containing a foo.jsp page
2. hit the foo.jsp url and see the page
3. remove foo.jsp from the webapp
4. reload the foo.jsp url until you finally get a 404 (why does this take
several tries?)
5. replace the foo.jsp file in the webapp
6. note that hitting the foo.jsp url will forever give you a 404 until you
restart tomcat</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>29412</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-01-15 16:54:40 +0000</bug_when>
    <thetext>I can reproduce it. It doesn't happen with non-JSPs, such as images, so it
shouldn't be a cache bug.
BTW, the (small) delay is there because there's a cache.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>30373</commentid>
    <comment_count>2</comment_count>
    <who name="Donald Ball">dball</who>
    <bug_when>2003-01-30 20:10:44 +0000</bug_when>
    <thetext>FWIW, this problem does not occur with tomcat-4.0.6. The problem is serious
enough in our context that we have been forced to downgrade.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40472</commentid>
    <comment_count>3</comment_count>
    <who name="David Wood">obsidian</who>
    <bug_when>2003-07-11 14:40:23 +0000</bug_when>
    <thetext>We're seeing it too. Very nasty.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40492</commentid>
    <comment_count>4</comment_count>
    <who name="David Wood">obsidian</who>
    <bug_when>2003-07-11 17:36:41 +0000</bug_when>
    <thetext>I have a working patch for this bug; I'd appreciate help/advice from anyone 
more familiar with creating and submitting patches to the Tomcat team.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44210</commentid>
    <comment_count>5</comment_count>
    <who name="Donald Ball">dball</who>
    <bug_when>2003-09-15 16:19:32 +0000</bug_when>
    <thetext>Any word on this bug? Very surprised to see the 4.0.x series disappear from the
jakarta mirrors with serious bugs like this outstanding in the 4.1 branch.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44226</commentid>
    <comment_count>6</comment_count>
    <who name="David Wood">obsidian</who>
    <bug_when>2003-09-15 22:41:07 +0000</bug_when>
    <thetext>What I wrote (patch against 4.1.24 source archive) never got in. 

I was building a patch file; as a sanity check, I had checked out the public CVS
code labeled "TOMCAT_4_1_24", and I saw that it didn't match their "4.1.24"
source archives. When I asked about this, Remy basically told me "learn CVS",
and that was the only response I got. 

I did notice that the dev code in CVS had progressed pretty far from 4.1.24
already at the time, and I recall seeing some significant changes in and around
the relevant code... I guessed that this bug had already been fixed, and just
forgotten in the DB. 

Does this still happen in 4.1.27? </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>46801</commentid>
    <comment_count>7</comment_count>
    <who name="Donald Ball">dball</who>
    <bug_when>2003-11-04 18:19:12 +0000</bug_when>
    <thetext>I have verified that it is still a bug in 4.1.29. David, would it be possible
for you to mail me a copy of your patch?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53424</commentid>
    <comment_count>8</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-03-04 13:53:08 +0000</bug_when>
    <thetext>If you have a patch, preferably against 5.0.19, please post it so we can 
evaluate how risky it is.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53507</commentid>
    <comment_count>9</comment_count>
    <who name="Torsten Fohrer">tfohrer</who>
    <bug_when>2004-03-05 13:26:17 +0000</bug_when>
    <thetext>Simply compare JspRuntimeContext.checkCompile(), this calls 
ctxt.incrementRemoved() if a FileNotFoundException occur. JspServletWrapper 
only set a 404 if a FileNotFoundException occur and finish. 
 
Code from JspRuntineContext: 
            synchronized(jsw) { 
                try { 
                    ctxt.compile(); 
                } catch (FileNotFoundException ex) { 
                    ctxt.incrementRemoved(); 
                } catch (Throwable t) { 
                    jsw.getServletContext().log("Background compile failed", 
                                                t); 
                } 
            } 
 
Code from JspServletWrapper: 
 
       } catch (FileNotFoundException ex) { 
            String includeRequestUri = (String) 
                request.getAttribute("javax.servlet.include.request_uri"); 
            if (includeRequestUri != null) { 
                // This file was included. Throw an exception as 
                // a response.sendError() will be ignored by the 
                // servlet engine. 
                throw new ServletException(ex); 
            } else { 
                try { 
                    response.sendError(HttpServletResponse.SC_NOT_FOUND, 
                                      ex.getMessage()); 
                } catch (IllegalStateException ise) { 
                    log.error(Localizer.getMessage("jsp.error.file.not.found", 
                                                   ex.getMessage()), 
                              ex); 
                } 
 
 
add a simple ctxt.incrementRemoved in catch block and test case works. </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53508</commentid>
    <comment_count>10</comment_count>
    <who name="Q. Bordeaux">q.bordeaux</who>
    <bug_when>2004-03-05 13:39:02 +0000</bug_when>
    <thetext>Another solution : in JspServletWrapper, line 343, before sending
HttpServletResponse.SC_NOT_FOUND, remove wrapper from collection of previously
created wrapper : 

Code from JspServletWrapper: 

       } catch (FileNotFoundException ex) { 
            String includeRequestUri = (String) 
                request.getAttribute("javax.servlet.include.request_uri"); 
            if (includeRequestUri != null) { 
                // This file was included. Throw an exception as 
                // a response.sendError() will be ignored by the 
                // servlet engine. 
                throw new ServletException(ex); 
            } else { 
                try { 
                    // BELOW 1 LINE PROPOSED FOR THIS BUG
                    ctxt.getRuntimeContext().removeWrapper(jspUri);
                    response.sendError(HttpServletResponse.SC_NOT_FOUND, 
                                      ex.getMessage()); 
                } catch (IllegalStateException ise) { 
                    log.error(Localizer.getMessage("jsp.error.file.not.found", 
                                                   ex.getMessage()), 
                              ex); 
                } </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53509</commentid>
    <comment_count>11</comment_count>
    <who name="Torsten Fohrer">tfohrer</who>
    <bug_when>2004-03-05 13:44:33 +0000</bug_when>
    <thetext>using incrementRemoved() is cleaner, it removes wrapper and java-/class-file. 
 
Code from JspCompilationContext: 
 
    // ==================== Removal ==================== 
 
    public void incrementRemoved() { 
        if (removed &gt; 1) { 
            jspCompiler.removeGeneratedFiles(); 
            if( rctxt != null ) 
                rctxt.removeWrapper(jspUri); 
        } 
        removed++; 
    } 
 </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53510</commentid>
    <comment_count>12</comment_count>
    <who name="Q. Bordeaux">q.bordeaux</who>
    <bug_when>2004-03-05 13:50:37 +0000</bug_when>
    <thetext>OK, I agree.

What's happen now? I suppose this patch must be validated and voted by Tomcat
commiters.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53511</commentid>
    <comment_count>13</comment_count>
    <who name="Torsten Fohrer">tfohrer</who>
    <bug_when>2004-03-05 13:56:28 +0000</bug_when>
    <thetext>Example for fixed code 
 
JspServletWrapper: 
       } catch (FileNotFoundException ex) {  
            String includeRequestUri = (String)  
                request.getAttribute("javax.servlet.include.request_uri");  
            ctxt.incrementRemoved() 
            if (includeRequestUri != null) {  
                // This file was included. Throw an exception as  
                // a response.sendError() will be ignored by the  
                // servlet engine.  
                throw new ServletException(ex);  
            } else {  
                try {  
                    response.sendError(HttpServletResponse.SC_NOT_FOUND,  
                                      ex.getMessage());  
                } catch (IllegalStateException ise) {  
                    log.error(Localizer.getMessage("jsp.error.file.not.found",  
                                                   ex.getMessage()),  
                              ex);  
                }  
  </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53513</commentid>
    <comment_count>14</comment_count>
    <who name="Torsten Fohrer">tfohrer</who>
    <bug_when>2004-03-05 14:19:43 +0000</bug_when>
    <thetext>oh, you reminder JspServletWrapper/JspCompilationContext in your reminder, 
read the discussion on tomcat-user currently. 
 
i agree with Q. Bordeaux. 
 
some live-enviroment requires jasper background compilation or development 
enabled. 
some not, use precompile instead. 
 </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53598</commentid>
    <comment_count>15</comment_count>
      <attachid>10692</attachid>
    <who name="Torsten Fohrer">tfohrer</who>
    <bug_when>2004-03-07 08:56:37 +0000</bug_when>
    <thetext>Created attachment 10692
poproposed patch</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53693</commentid>
    <comment_count>16</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-03-09 00:48:04 +0000</bug_when>
    <thetext>Patch applied.  Thanks.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53719</commentid>
    <comment_count>17</comment_count>
    <who name="Q. Bordeaux">q.bordeaux</who>
    <bug_when>2004-03-09 13:58:05 +0000</bug_when>
    <thetext>Does this patch is applied to both Tomcat 5.x and Tomcat 4.1.x or only to Tomcat
5.x?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53738</commentid>
    <comment_count>18</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-03-09 17:55:18 +0000</bug_when>
    <thetext>I just applied the patch to 4.1.x also.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>77088</commentid>
    <comment_count>19</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2005-07-08 00:07:11 +0000</bug_when>
    <thetext>*** Bug 35650 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>10692</attachid>
            <date>2004-03-07 08:56:00 +0000</date>
            <delta_ts>2004-03-07 08:56:37 +0000</delta_ts>
            <desc>poproposed patch</desc>
            <filename>JspServletWrapper.patch-404jsp</filename>
            <type>text/plain</type>
            <size>725</size>
            <attacher name="Torsten Fohrer">tfohrer</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>16127</bug_id>
          
          <creation_ts>2003-01-15 18:42:00 +0000</creation_ts>
          <short_desc>Seems to be a problem doing a static include of content when using a different charset.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>29443</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-01-15 18:42:03 +0000</bug_when>
    <thetext>According to JSP.4.1 of the 2.0 specificiation, Files included using the include
directive are read using the character encoding of the including page.

For my case, I have a JSP Document encoded in UTF-16BE (the JSP Document also
sets the response content type to text/plain; charset=ISO-8859-1".  The document
uses an include directive to include another text document also encoded in
UTF-16BE.  

Reviewing the result of the page, I can see that the included content is still
in UTF-16BE instead of ISO-8859-1 (note, I can leave off the contentType
attribute of the page directive so that the response is text/xml with a charset
of UTF-8, but it makes no difference).

Here is the calling JSP Document:
-------------------------------------------------
?xml version="1.0" encoding="UTF-16BE"?&gt;
&lt;root xmlns:jsp="http://java.sun.com/JSP/Page"&gt;
    &lt;jsp:directive.page contentType="text/plain; charset=ISO-8859-1" /&gt;
    &lt;jsp:directive.include file="inclusion_utf-16BE.txt" /&gt;
&lt;/root&gt;
-------------------------------------------------

The included text file contains (encoded in UTF-16BE):       
    &lt;included&gt;Included Content&lt;/included&gt;


The result that I'm seeing looks something like:

&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;root
xmlns:jsp="http://java.sun.com/JSP/Page"&gt;^@&lt;^@i^@n^@c^@l^@u^@d^@e^@d^@&gt;^@I^@n^@c^@l^@u^@d^@e^@d^@
^@C^@o^@n^@t^@e^@n^@t^@&lt;^@/^@i^@n^@c^@l^@u^@d^@e^@d^@&gt;^@
&lt;/root&gt;

This was working in previous builds.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>29450</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-01-15 19:56:09 +0000</bug_when>
    <thetext>Ok, maybe it doesn't work, but since the writer object used is the same, and the
including page can't set its own encoding either, I'd like you to explain how it
can not work (or if it doesn't, how I can make it work).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>29536</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-01-16 14:17:24 +0000</bug_when>
    <thetext>It seems I misunderstood the bug report.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>30034</commentid>
    <comment_count>3</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2003-01-25 01:20:49 +0000</bug_when>
    <thetext>Ryan,

JSP.4.1 talks about the "Page Character Encoding", but from your bug report it
seems like you are complaining about the response character encoding, which is
covered in JSP.4.2 ("Response Character Encoding").

It seems like in your example, both the JSP document and its included segment
are read using the UTF-16BE encoding specified in the JSP document's XML prolog.
So far so good.

However, since the wrapping JSP document specifies a response encoding of
ISO-8859-1, you would expect the response to be encoded that way. I agree, but
JSP.4.2 actually does not mention anything about it. I'll ping Mark to see if he
could clarify JSP.4.2.

Thanks,

Jan

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>30036</commentid>
    <comment_count>4</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2003-01-25 04:49:17 +0000</bug_when>
    <thetext>Sorry, JSP.4.2 already is perfectly clear. I thought it needed to mention
something about included JSP segments, but that's not needed, since they're
expanded in place.

I've fixed the bug in my private workspace and will commit my changes soon.
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>16129</bug_id>
          
          <creation_ts>2003-01-15 19:01:00 +0000</creation_ts>
          <short_desc>A translation-time error is not raised when the value of the page directives pageEncoding attribute fails to match that of the xml prolog of the JSP document.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>29444</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-01-15 19:01:51 +0000</bug_when>
    <thetext>A translation error is not generated when Jasper is presented the following:

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;root&gt;
    &lt;jsp:directive.page 
         xmlns:jsp="http://java.sun.com/JSP/Page"
         pageEncoding="ISO-8859-1" /&gt;
&lt;/root&gt;

JSP.4.1 states the following for JSP documents:

   "It is a translation-time error to name different encodings 
    in two or more of the following:  the XML prolog of a JSP
    page, the pageEncoding attribute of the page directive of the
    JSP page, and in a JSP configuration element whose URL pattern
    matches the page.

This worked as expected in previous builds.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>16395</bug_id>
          
          <creation_ts>2003-01-24 15:16:00 +0000</creation_ts>
          <short_desc>Incorrect SMAP mapping information</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Martin Grebac">martin.grebac</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>30017</commentid>
    <comment_count>0</comment_count>
    <who name="Martin Grebac">martin.grebac</who>
    <bug_when>2003-01-24 15:16:01 +0000</bug_when>
    <thetext>I've got following included jsps:

hello.jsp:
----------
&lt;HTML&gt;
&lt;HEAD&gt;
&lt;TITLE&gt;Hello example&lt;/TITLE&gt;
&lt;/HEAD&gt;
&lt;BODY&gt;
&lt;%@ include file="greeting.jsp" %&gt;
&lt;/BODY&gt;
&lt;/HTML&gt;

greeting.jsp:
-------------
Hello there!&lt;P&gt;
Goodbye on January

When the hello.jsp is compiled, SMAP information included in the classfile looks
like this:

SMAP
hello_jsp.java
JSP
*S JSP
*F
0 hello.jsp
1 greeting.jsp
*L
0:0,0
0:45
1:46
2:47
2:48
3:49
4:50
5:0,0
0#1:0,0
0:51
0:52
5#0:53
6:54
7:55
*E

where line 5:0,0 is incorrectly mapped.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>16572</bug_id>
          
          <creation_ts>2003-01-29 23:26:00 +0000</creation_ts>
          <short_desc>Compile error when invoking tag file that uses JSTL</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>blocker</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Hans Bergsten">hans</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>30313</commentid>
    <comment_count>0</comment_count>
    <who name="Hans Bergsten">hans</who>
    <bug_when>2003-01-29 23:26:45 +0000</bug_when>
    <thetext>A simple JSP page:

  &lt;%@ taglib prefix="my" tagdir="/WEB-INF/tags/mytags" %&gt;
  &lt;my:test/&gt;

invoking a simple tag file:
  &lt;%@ taglib prefix="c" uri="http://java.sun.com/jstl/core_rt" %&gt;
  &lt;jsp:useBean id="now" class="java.util.Date" /&gt;
  &lt;c:out value="${now}" /&gt;

Results in:
org.apache.jasper.JasperException: Unable to compile class for JSP

An error occurred at line: -1 in the jsp file: null

Generated servlet error:



	at
org.apache.jasper.compiler.DefaultErrorHandler.javacError(DefaultErrorHandler.java:120)
	at org.apache.jasper.compiler.ErrorDispatcher.javacError(ErrorDispatcher.java:307)
	at org.apache.jasper.compiler.Compiler.generateClass(Compiler.java:405)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:429)
	at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:572)
	at
org.apache.jasper.servlet.JspServletWrapper.loadTagFile(JspServletWrapper.java:215)
	at
org.apache.jasper.compiler.TagFileProcessor.loadTagFile(TagFileProcessor.java:446)
	at org.apache.jasper.compiler.TagFileProcessor.access$000(TagFileProcessor.java:84)
	at
org.apache.jasper.compiler.TagFileProcessor$TagFileLoaderVisitor.visit(TagFileProcessor.java:488)
	at org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1033)
	at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1700)
        [...]

If I change the tag file to not use &lt;c:out&gt;, everything works fine:

  &lt;jsp:useBean id="now" class="java.util.Date" /&gt;
  ${now}

Since I've seen the same error with other JSTL (1.0.1) actions, I assume there's
a problem with JSTL (or custom actions in general) in tag files.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>30317</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-01-30 00:32:36 +0000</bug_when>
    <thetext>The bug was due to a recent change in tag pooling, and the changes introduced a
bug when tag pooling is enabled in a tag file.  The method
org.apache.jasper.runtime.TagHandlerPool.getTagHandlerPool has been modified to
take a jspServlet, which a tag file is not.  Hence the bug.

A workaround is to turn off tag pooling.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>16727</bug_id>
          
          <creation_ts>2003-02-03 18:37:00 +0000</creation_ts>
          <short_desc>Incorrect exception raised when tag file uses jsp:invoke to store result of fragment into session scope and calling page doesn't participate in a session.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>30583</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-02-03 18:37:55 +0000</bug_when>
    <thetext>Table JSP.5-8 states that the container must throw am IllegalStateException at
runtime if scope is session and the calling page does not participate in a session.

Consider the following:

TestPage.jsp
-----------------------------------------
&lt;%@ page session="false" %&gt;
&lt;%@ taglib tagdir="/WEB-INF/tags" prefix="tags" %&gt;
&lt;tags:notInSession&gt;
    &lt;jsp:attribute name="attr1"&gt;
        attribute value
    &lt;/jsp:attribute&gt;
&lt;/tags:notInSession&gt;
------------------------------------------

notInSession.tag
------------------------------------------
&lt;%@ attribute name="attr1" fragment="true" %&gt;

&lt;jsp:invoke fragment="attr1" var="someVar" scope="session" /&gt;
------------------------------------------

If I wrap the section of the calling page that invokes the tag with 
a try catch, an Exception is indeed thrown, but it is an instance of
JspException.  If I check the root exception of the JspException it is
an instance of IllegalArgumentException.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>16728</bug_id>
          
          <creation_ts>2003-02-03 18:52:00 +0000</creation_ts>
          <short_desc>Translation error not raised of jsp:attribute is provided an invalid value to the 'scope' attribute</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>30587</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-02-03 18:52:55 +0000</bug_when>
    <thetext>Table JSP.5-8 states that the valid values that can be provided to the 'scope' 
attribute of jsp:invoke are 'page', 'request', 'session', 'application'.

If I provide values such as Page, reQuest, sessioN, or ApplicatioN a translation
error is not raised by the container.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>16731</bug_id>
          
          <creation_ts>2003-02-03 19:27:00 +0000</creation_ts>
          <short_desc>A translation error is not raised by the container if jsp:invoke specifies the 'scope' attribute but not 'var' or 'varReader'</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>30588</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-02-03 19:27:09 +0000</bug_when>
    <thetext>JSP.5-8 states that a translation error will result if the scope attribute
is specified and var or varReader are not.

The current Jasper impementation doesn't raise any translation error and instead
ignores the scope attribute and sends the result of jsp:invoke to the current
writer.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>16778</bug_id>
          
          <creation_ts>2003-02-04 20:50:00 +0000</creation_ts>
          <short_desc>jsp:include doesn't work in tag file</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Alexander Jerusalem">ajeru</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>30682</commentid>
    <comment_count>0</comment_count>
    <who name="Alexander Jerusalem">ajeru</who>
    <bug_when>2003-02-04 20:50:19 +0000</bug_when>
    <thetext>&lt;jsp:include.../&gt; doesn't seem to work in tag files. I'm getting this exception
when the tag file is compiled (this is from a nightly build I downloaded a few
days ago):


org.apache.jasper.JasperException: Unable to compile class for JSP

An error occurred at line: -1 in the jsp file: null

Generated servlet error:
    [javac] Since fork is true, ignoring compiler setting.
    [javac] Compiling 1 source file
    [javac] Since fork is true, ignoring compiler setting.
    [javac]
D:\prog\tomcat5\src\jakarta-tomcat-5\build\work\Standalone\localhost\n6\tags\org\apache\jsp\tag\web\mainframe.java:109:
include(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse,java.lang.String,java.io.Writer,boolean)
in org.apache.jasper.runtime.JspRuntimeLibrary cannot be applied to
(javax.servlet.ServletRequest,javax.servlet.ServletResponse,java.lang.String,javax.servlet.jsp.JspWriter,boolean)
    [javac]       org.apache.jasper.runtime.JspRuntimeLibrary.include(request,
response, "/n6/blah.html", out, false);
    [javac]                                                  ^
    [javac] 1 error



	at
org.apache.jasper.compiler.DefaultErrorHandler.javacError(DefaultErrorHandler.java:120)
	at org.apache.jasper.compiler.ErrorDispatcher.javacError(ErrorDispatcher.java:307)
	at org.apache.jasper.compiler.Compiler.generateClass(Compiler.java:399)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:427)
	at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:572)
	at
org.apache.jasper.servlet.JspServletWrapper.loadTagFile(JspServletWrapper.java:215)
	at
org.apache.jasper.compiler.TagFileProcessor.loadTagFile(TagFileProcessor.java:446)
	at org.apache.jasper.compiler.TagFileProcessor.access$000(TagFileProcessor.java:84)
	at
org.apache.jasper.compiler.TagFileProcessor$TagFileLoaderVisitor.visit(TagFileProcessor.java:488)
	at org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1033)
	at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1700)
	at org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:1742)
	at org.apache.jasper.compiler.Node$Visitor.visit(Node.java:1748)
	at org.apache.jasper.compiler.Node$Root.accept(Node.java:334)
	at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1700)
	at
org.apache.jasper.compiler.TagFileProcessor.loadTagFiles(TagFileProcessor.java:506)
	at org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:262)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:426)
	at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:572)
	at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:297)
	at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:293)
	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)
	at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:288)
	at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:294)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:490)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1005)
	at
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:196)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:490)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1005)
	at org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2608)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at
org.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:172)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:490)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1005)
	at
org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:163)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:490)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1005)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:196)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:612)
	at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:428)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:565)
	at
org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:623)
	at java.lang.Thread.run(Thread.java:536)</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>16865</bug_id>
          
          <creation_ts>2003-02-07 01:22:00 +0000</creation_ts>
          <short_desc>EL expressions in tag files no longer works</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>blocker</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Hans Bergsten">hans</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>30855</commentid>
    <comment_count>0</comment_count>
    <who name="Hans Bergsten">hans</who>
    <bug_when>2003-02-07 01:22:05 +0000</bug_when>
    <thetext>Something is fundamentally wrong with EL evaluation in tag files, a bug that
must have been introduced recently (a nightly build from last week worked fine).

This tag file:

  &lt;%@ taglib prefix="c" uri="http://java.sun.com/jstl/core_rt" %&gt;
  &lt;%@ tag body-content="scriptless" %&gt;

  Static text and c:out: &lt;c:out value="static text" /&gt;
  &lt;br&gt;
  EL expr with variable and c:out: 
  &lt;c:out value="${pageContext.request.servletPath}" /&gt;
  &lt;br&gt;
  EL expr with variable in text: ${pageContext.request.servletPath}
  &lt;br&gt;
  EL expr with static text: ${'static text'}

produces this output when invoked from a JSP page:

  Static text and c:out: static text
  EL expr with variable and c:out:
  EL expr with variable in text:
  EL expr with static text: static text 

In other words, evaluation of an EL expression that contains variables (I've
tested with other variables than pageContext, used here) results in the empty
string. An EL expression that only contains static text is evaluated correctly.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>30856</commentid>
    <comment_count>1</comment_count>
    <who name="Hans Bergsten">hans</who>
    <bug_when>2003-02-07 02:08:06 +0000</bug_when>
    <thetext>The cause for this seems to be that in JspContextWrapper (which is used as the
PageContext implementation in a tag file), the getVariableResolver() method
returns null.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>30857</commentid>
    <comment_count>2</comment_count>
    <who name="Hans Bergsten">hans</who>
    <bug_when>2003-02-07 02:17:26 +0000</bug_when>
    <thetext>Okay, I've verified that relaying getVariableResolver() in JspContextWrapper to
the original JspContext fixes this problem, i.e.:

  public VariableResolver getVariableResolver() {
    invokingJspCtxt.getVariableResolver();
  }
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>30858</commentid>
    <comment_count>3</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-02-07 02:40:33 +0000</bug_when>
    <thetext>The suggested fix would only work for attributes that are alredy defined in the
invoking context, and not for those that are defined locally in the tag files. 
I have a fix that I am now testing, and would commit that if it works.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>30859</commentid>
    <comment_count>4</comment_count>
    <who name="Hans Bergsten">hans</who>
    <bug_when>2003-02-07 02:46:00 +0000</bug_when>
    <thetext>Nae, this is not the complete solution. Now the JSP page scope is used when
resolving variables in the tag file. I guess JspContextWrapper needs its own
VariableResolver that knows about the tag file's local page scope, but how fix
that is beyond what I can figure out at the moment ;-)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>30860</commentid>
    <comment_count>5</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-02-07 03:03:28 +0000</bug_when>
    <thetext>Thanks for reporting this problem and pointing me to the right direction.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>16899</bug_id>
          
          <creation_ts>2003-02-08 03:22:00 +0000</creation_ts>
          <short_desc>tomcat-5 can not compile tiles</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Brian Millett">bpm</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>30928</commentid>
    <comment_count>0</comment_count>
    <who name="Brian Millett">bpm</who>
    <bug_when>2003-02-08 03:22:49 +0000</bug_when>
    <thetext>On solaris and linux with jdk 1.4.1, jakarta-tomcat-5 nightly build &amp; nightly
build of struts, I get the following error running any tiles based app.

[ServletException in:/layouts/vboxLayout.jsp] Unable to compile class for JSP An
error occurred at line: 14 in the jsp file: /layouts/vboxLayout.jsp Generated
servlet error: [javac] Since compiler setting isn't classic or modern,ignoring
fork setting. [javac] Compiling 1 source file [javac] Since compiler setting
isn't classic or modern,ignoring fork setting. [javac]
/home/bpm/compile_area/cvs_jakarta/jakarta-tomcat-5/dist/work/Standalone/localhost/tiles-documentation/layouts/vboxLayout_jsp.java:68:12:68:15:
Semantic Error: No field named "list" was found in type
"org.apache.jsp.vboxLayout_jsp". '

and this:

[ServletException in:/layout/columnsLayout.jsp] Unable to compile class for JSP
An error occurred at line: 13 in the jsp file: /layout/columnsLayout.jsp
Generated servlet error: [javac] Since compiler setting isn't classic or
modern,ignoring fork setting. [javac] Compiling 1 source file [javac] Since
compiler setting isn't classic or modern,ignoring fork setting. [javac]
/home/bpm/compile_area/cvs_jakarta/jakarta-tomcat-5/dist/work/Standalone/localhost/tiles-documentation/layout/columnsLayout_jsp.java:72:32:72:41:
Semantic Error: No field named "numColsStr" was found in type
"org.apache.jsp.columnsLayout_jsp". '

Also in the struts-exercise-taglib, the &lt;bean:define&gt; tags has the following error:

org.apache.jasper.JasperException: Unable to compile class for JSP

An error occurred at line: 34 in the jsp file: /bean-define.jsp

Generated servlet error:
    [javac] Since compiler setting isn't classic or modern,ignoring fork setting.
    [javac] Compiling 1 source file
    [javac] Since compiler setting isn't classic or modern,ignoring fork setting.
    [javac]
/home/bpm/compile_area/cvs_jakarta/jakarta-tomcat-5/dist/work/Standalone/localhost/struts-exercise-taglib/bean_0002ddefine_jsp.java:131:33:131:45:
Semantic Error: No field named "test1_boolean" was found in type
"org.apache.jsp.bean_0002ddefine_jsp".</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>30941</commentid>
    <comment_count>1</comment_count>
    <who name="Craig McClanahan">craig.mcclanahan</who>
    <bug_when>2003-02-08 23:50:22 +0000</bug_when>
    <thetext>It is impossible to diagnose the cause of this compile error without seeing the
actual page in question, so we can see what is on line 14.

Does this application compile and work correctly on Tomcat 4.1.18?  If so, it is
likely to be a bug in the Tomcat 5 JSP page compiler, and should be reported as
such.  If not, then it is a bug in your page.

Either way, you'll need to provide more information if you want this to be
looked at.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>30946</commentid>
    <comment_count>2</comment_count>
    <who name="Mohan Kishore">mohankishore</who>
    <bug_when>2003-02-09 01:32:09 +0000</bug_when>
    <thetext>tried out the tiles-documentation.war (nightly build) with tomcat5.0.0 alpha 
release. Had some initial problems with tomcat (have to manually create a 
missing 'temp' directory). Once tomcat was setup, i notice a peculiar behaviour:

If I visit tomcat jsp-examples first and then tiles-documentation, everything 
is fine.

If I visit tiles-documentation first, all subsequent JSP compiles fail. Am 
going to attach the Exception page.

tomcat 4.1.12 does not show this peculiar behaviour and everything runs fine...</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>30948</commentid>
    <comment_count>3</comment_count>
      <attachid>4793</attachid>
    <who name="Mohan Kishore">mohankishore</who>
    <bug_when>2003-02-09 01:33:03 +0000</bug_when>
    <thetext>Created attachment 4793
JSP compile error.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>30952</commentid>
    <comment_count>4</comment_count>
    <who name="Brian Millett">bpm</who>
    <bug_when>2003-02-09 02:48:48 +0000</bug_when>
    <thetext>Sorry for not being precise.  The problem is the distributed examples from the
struts webapps:  1) tiles-documentation.war gives the first error, 2)
struts-exercise-taglibs.war gives the second error.  

Yes you are correct that jakarta-tomcat-5.0 alpha does compile the
tiles-documentation.  However, the nightly builds of tomcat-5 have failed for
the last two weeks.  I did not know if it was a jasper compiler error as these
errors are only seen with struts tiles.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>31547</commentid>
    <comment_count>5</comment_count>
    <who name="Brian Millett">bpm</who>
    <bug_when>2003-02-18 20:26:53 +0000</bug_when>
    <thetext>The latest CVS co as of 2/18/03 (must disable precompile of jsp in
jakarta-tomcat-5) works just fine.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>4793</attachid>
            <date>2003-02-09 01:33:00 +0000</date>
            <delta_ts>2003-02-09 01:33:03 +0000</delta_ts>
            <desc>JSP compile error.</desc>
            <filename>Apache Tomcat-5_0_0 - Error report.htm</filename>
            <type>text/html</type>
            <size>8364</size>
            <attacher name="Mohan Kishore">mohankishore</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>17052</bug_id>
          
          <creation_ts>2003-02-13 17:36:00 +0000</creation_ts>
          <short_desc>jsp:element name attribute clobbered by nested jsp:attribute</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.0</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Phil Hanna">Phil.Hanna</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>31252</commentid>
    <comment_count>0</comment_count>
    <who name="Phil Hanna">Phil.Hanna</who>
    <bug_when>2003-02-13 17:36:50 +0000</bug_when>
    <thetext>If a &lt;jsp:element&gt; has a nested &lt;jsp:attribute name="name"&gt;, the
&lt;jsp:attribute&gt; body is erroneously used as the tag name of the
generated element.

The JSP 2.0 spec JSP.5.14 says:

   A jsp:element element has one mandatory
   attribute, name, of type String. The value of
   the attribute is used as that of the tag of the
   element generated.

In other words,

   &lt;jsp:element name="foo"&gt;
      &lt;jsp:attribute name="bar"&gt;yada&lt;/jsp:attribute&gt;
   &lt;/jsp:element&gt;

generates this:

   &lt;foo bar="yada"/&gt;

However, if the attribute's name happens to be "name", the tag
name gets clobbered. Hence for this coding:

   &lt;jsp:element name="input"&gt;
      &lt;jsp:attribute name="type"&gt;text&lt;/jsp:attribute&gt;
      &lt;jsp:attribute name="name"&gt;userName&lt;/jsp:attribute&gt;
   &lt;/jsp:element&gt;

instead of this:

   &lt;input type="text" name="userName" size="20"/&gt;

it generates this:

   &lt;userName type="text" size="20"/&gt;

This makes it impossible with XML syntax to generate HTML forms,
that use named input elements.

--- Suggested Fix ---

The affected classes are in the org.apache.jasper.compiler package:

   Generator.java
   Node.java

In the Generator class, in the method

   public void visit(Node.JspElement n)

the code currently has special handling for any attribute named
"name", making it the tag name and excluding it from the rest of
the attribute generation.  This appears to be wrong to me, as it
confuses &lt;jsp:attribute name="name"&gt; and &lt;jsp:element
name="foo"&gt;, and it makes it impossible to create &lt;input
type="text" name="foo"/&gt;, as noted above.

I think the fix would involve:

   1. In Node.java: add a "name" property to the Node.JspElement
      class, corresponding to the "name" attribute of the
      &lt;jsp:element&gt; standard action. In the constructor, extract
      the required "name" attribute passed in the first
      parameter, and store it as the value of the name property. 

   2. In Generator.java: In the visit(Node.JspElement n) method,
      take out the special handling, just using the
      Node.JspElement "name" property as the tag name,
      and allowing *all* Node.JspAttribute elements to
      contribute to the tag attributes without skipping "name".</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>17059</bug_id>
          
          <creation_ts>2003-02-13 20:39:00 +0000</creation_ts>
          <short_desc>o.a.j.compiler.ImplicitTagLibraryInfo doesn't include tag files with the extension of .tagx when generating an implicit TLD</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>31260</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-02-13 20:39:08 +0000</bug_when>
    <thetext>JSP.8.1 states that valid extensions for tag files are .tag (standard syntax)
and .tagx (XML syntax).

Looking at the constuctor for ImplicitTagLibraryInfo, only tag files with the
extension of .tag are considered during processing.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>17061</bug_id>
          
          <creation_ts>2003-02-13 21:00:00 +0000</creation_ts>
          <short_desc>[PATCH] Allow tomcat5 to startup/shutdown with cygwin</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.0</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Tim Funk">funkman</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>31262</commentid>
    <comment_count>0</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2003-02-13 21:01:00 +0000</bug_when>
    <thetext>tomcat5 doesn't startup with cygwin.

It is because CATALINA_BASE and CATALINA_TMPDIR are set but not translated back
to windows paths instead of cygwin paths. This is very evident when the
environment variables get echoed.

Patch is attached to fix catalina.sh</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>31264</commentid>
    <comment_count>1</comment_count>
      <attachid>4864</attachid>
    <who name="Tim Funk">funkman</who>
    <bug_when>2003-02-13 21:02:15 +0000</bug_when>
    <thetext>Created attachment 4864
patch of build/catalina.sh</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>31273</commentid>
    <comment_count>2</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2003-02-14 01:00:13 +0000</bug_when>
    <thetext>Fixed. Thanks.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>4864</attachid>
            <date>2003-02-13 21:02:00 +0000</date>
            <delta_ts>2003-02-13 21:02:15 +0000</delta_ts>
            <desc>patch of build/catalina.sh</desc>
            <filename>catalina.txt</filename>
            <type>text/plain</type>
            <size>693</size>
            <attacher name="Tim Funk">funkman</attacher>
            

          </attachment>
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>17062</bug_id>
          
          <creation_ts>2003-02-13 21:52:00 +0000</creation_ts>
          <short_desc>Unable to specify the 'var' or 'varReader' attributes of jsp:invoke using the jsp:attribute action.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>31265</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-02-13 21:52:55 +0000</bug_when>
    <thetext>Consider the following fragment of a tag file:

&lt;jsp:invoke&gt;
    &lt;jsp:attribute name="fragment"&gt;frag1&lt;/jsp:attribute&gt;
    &lt;jsp:attribute name="var"&gt;exported&lt;/jsp:attribute&gt;
    &lt;jsp:attribute name="scope"&gt;request&lt;/jsp:attribute&gt;
&lt;/jsp:invoke&gt;

When invoked jasper generates a translation-time error

&lt;error&gt;

JspAttributeTag.tag(7,0) Missing 'var' or 'varReader' attribute

&lt;/error&gt;</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>17171</bug_id>
          
          <creation_ts>2003-02-18 16:47:00 +0000</creation_ts>
          <short_desc>Tomcat 5 Nightly binaries are not available</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Native:Packaging</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Matt Raible">mraible</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>31534</commentid>
    <comment_count>0</comment_count>
    <who name="Matt Raible">mraible</who>
    <bug_when>2003-02-18 16:47:25 +0000</bug_when>
    <thetext>I want to download a binary version of the latest Tomcat 5, but when I go to 
the nightly builds area - the .zip and .tar.gz files are empty for the binary 
versions:

http://cvs.apache.org/builds/jakarta-tomcat-5/nightly/</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>31692</commentid>
    <comment_count>1</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2003-02-20 18:48:09 +0000</bug_when>
    <thetext>Hi,

when the build failed, a mail will be posted to tomcat-dev@jakarta.apache.org.
Look at this list before filling a bug since the script will also fail.

Thanks,

-- Jeanfrancois</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>17204</bug_id>
          
          <creation_ts>2003-02-19 14:44:00 +0000</creation_ts>
          <short_desc>jsp:element generates incorrect output when used in a JSP Document and the element includes an xmlns attribute.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>31604</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-02-19 14:44:36 +0000</bug_when>
    <thetext>Given the following segment within a JSP Document:

&lt;jsp:element name="elementName"
    xmlns:jsp="http://java.sun.com/JSP/Page&gt;body&lt;/jsp:element&gt;

Will generate the following:

  &lt;elementName xmlns:jsp="http://java.sun.com/JSP/Page"&gt;body&lt;/elementName&gt;

The xmlns attribute in this case shouldn't be passed through to the output,
unless explicitly set using a jsp:attribute action.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>17310</bug_id>
          
          <creation_ts>2003-02-22 21:43:00 +0000</creation_ts>
          <short_desc>;jsessionid confuses StandardHost....can't find Context</short_desc>
          <delta_ts>2006-06-11 18:00:25 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.0</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jacob Kjome">hoju</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>31800</commentid>
    <comment_count>0</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2003-02-22 21:43:03 +0000</bug_when>
    <thetext>Using Tomcat5 that I built from source today.

When I open a new browser and go to my context...
http://localhost:8081/xmlc/

the index.html redirects to this page:
http://localhost:8081/xmlc/ReloadTest?docClass=xmlc.demo.WelcomeHTML

All is fine so far.  However, the URL's in the links of the latter page look
something like this:
http://localhost:8081/xmlc/ReloadTest;jsessionid=FF350A3154EDE9395DA1109ECAB92D82?docClass=xmlc.demo.test01HTML


When I go the latter page I get the following error in the browser....

HTTP Status 500 - No Context configured to process this request

type Status report

message No Context configured to process this request

description The server encountered an internal error (No Context configured to
process this request) that prevented it from fulfilling this request.
Apache Tomcat/5.0


The console looks like this:

30688 [Thread-5] INFO core.ContainerBase  - Mapping contextPath='/xmlc' with
requestURI='/xmlc/ReloadTest' and relativeURI='/ReloadTest'
30688 [Thread-5] INFO core.ContainerBase  -   Trying exact match
30688 [Thread-5] INFO core.ContainerBase  -  Mapped to servlet 'ReloadTest' with
servlet path '/ReloadTest' and path info 'null' and update=true
51110 [Thread-5] ERROR core.StandardHost  - MAPPING configuration error for
request URI


In the access log, I get this:

127.0.0.1 - - [22/Feb/2003:15:27:28 -0600] "GET
/xmlc/ReloadTest?docClass=xmlc.demo.test01HTML HTTP/1.1" 500 842


Seems like a URL parsing problem in the StandardHost where it isn't able to
figure out the context path appropriately so it doesn't know what context to
delegate the request to.

I don't have this problem at all in Tomcat-4.1.19 so it is definitely Tomcat-5
specific.

Jake</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>31801</commentid>
    <comment_count>1</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2003-02-22 21:46:58 +0000</bug_when>
    <thetext>Oh, I forgot to mention that stripping off the
;jsessionid=FF350A3154EDE9395DA1109ECAB92D82 resulting in the following URL
makes things work like normal:

http://localhost:8081/xmlc/ReloadTest?docClass=xmlc.demo.test01HTML


Jake</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>36345</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-04-29 23:13:24 +0000</bug_when>
    <thetext>This was fixed since.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>36993</commentid>
    <comment_count>3</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2003-05-09 16:12:54 +0000</bug_when>
    <thetext>verified fixed!

Jake</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>17387</bug_id>
          
          <creation_ts>2003-02-25 18:29:00 +0000</creation_ts>
          <short_desc>A misleading error message is generated when providing an invalid body to jsp:text</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>31928</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-02-25 18:29:56 +0000</bug_when>
    <thetext>If providing an invalid body to jsp:text (scriplets or actions), a translation
error is properly generated, however, the error message is misleading.

  Unterminated &amp;lt;jsp:text&amp;gt;</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>17390</bug_id>
          
          <creation_ts>2003-02-25 18:42:00 +0000</creation_ts>
          <short_desc>If jsp:text is provided an invalid body in the context of a JSP document, a translation error is not raised.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>31931</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-02-25 18:42:43 +0000</bug_when>
    <thetext>Consider the following examples within a JSP document

&lt;jsp:text&gt;
    &lt;jsp:scriptlet&gt;&lt;![CDATA[out.println("HELLO");]]&gt;&lt;/jsp:scriptlet&gt;
&lt;/jsp:text&gt;

 - or -

&lt;jsp:text&gt;
    &lt;jsp:element name="element1"&gt;body&lt;/jsp:element&gt;
&lt;/jsp:text&gt;

In either of the above cases, a translation error is not generated as required
in JSP.5.15.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>17394</bug_id>
          
          <creation_ts>2003-02-25 20:04:00 +0000</creation_ts>
          <short_desc>Misleading error message generated when jsp:output is used in an invalid context</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>31935</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-02-25 20:04:44 +0000</bug_when>
    <thetext>JSP.5.16 states that jsp:output is only valid for use in JSP documents or Tag
files in XML syntax.

If jsp:output is used in either a JSP or Tag file in standard syntax, a
translation error is generated, but the error message for the cause is misleading:

   JspOutputUsageTag.tag(5,5) Invalid standard action

The action is valid, just the usage is incorrect.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>17395</bug_id>
          
          <creation_ts>2003-02-25 20:31:00 +0000</creation_ts>
          <short_desc>Translation error incorrectly generated when using jsp:output in a Tag file in XML syntax</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>31937</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-02-25 20:31:06 +0000</bug_when>
    <thetext>JSP.5.16 states that jsp:output may be used in JSP documents and in tag files in
XML sytnax.

However, if I use jsp:output in a Tag file in XML syntax, the following
translation-time error is returned:

    JspOutputUsageXMLTag.tagx(6,9) Invalid standard action</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>17397</bug_id>
          
          <creation_ts>2003-02-25 21:19:00 +0000</creation_ts>
          <short_desc>Jasper incorrectly generates a translation error if the omit-xml-declaration attribute of the jsp:output action is not specified.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>31941</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-02-25 21:19:11 +0000</bug_when>
    <thetext>Table JSP.5-11 states that the omit-xml-declaration attribute of the jsp:output
action is optional.

If this attribute is not present within a document translated by Jasper, the
following error is returned:

     jsp:output: Mandatory attribute omit-xml-declaration missing</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>32015</commentid>
    <comment_count>1</comment_count>
      <attachid>5041</attachid>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-02-26 15:37:26 +0000</bug_when>
    <thetext>Created attachment 5041
patch to fix this issue</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>5041</attachid>
            <date>2003-02-26 15:37:00 +0000</date>
            <delta_ts>2003-02-26 15:37:26 +0000</delta_ts>
            <desc>patch to fix this issue</desc>
            <filename>patch.txt</filename>
            <type>text/plain</type>
            <size>630</size>
            <attacher name="Ryan Lubke">Ryan.Lubke</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>17398</bug_id>
          
          <creation_ts>2003-02-25 21:44:00 +0000</creation_ts>
          <short_desc>Jasper incorrectly allows a page author to specify a body for jsp:output in a JSP document.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>31942</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-02-25 21:44:50 +0000</bug_when>
    <thetext>JSP.5.16 states that the jsp:output action may not have a body.  

Consider the following:  

&lt;root xmlns:jsp="http://java.sun.com/JSP/Page"&gt;
    &lt;jsp:directive.page contentType="text/plain" /&gt;
    &lt;jsp:output omit-xml-declaration="yes"&gt;
        Test FAILED
    &lt;/jsp:output&gt;
&lt;/root&gt;

No translation error is generated.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>17399</bug_id>
          
          <creation_ts>2003-02-25 21:51:00 +0000</creation_ts>
          <short_desc>Misleading error message generated when jsp:output, within a Tag file in XML syntax has a body.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>31943</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-02-25 21:51:47 +0000</bug_when>
    <thetext>JSP.5.16 states that the jsp:output action may not have a body.

If jsp:output is specified with a body within a Tag file in XML syntax,
a translation-time error is correctly generated, however the cause of the 
error is incorrect.

    JspOutputBodyTag.tagx(6,9) Invalid standard action

Perhaps it would be more beneficial to end users to have a more descriptive
message about the issue.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>17403</bug_id>
          
          <creation_ts>2003-02-25 23:25:00 +0000</creation_ts>
          <short_desc>NegativeArraySizeException generated when jsp:element action is missing the 'name' attribute.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>31951</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-02-25 23:25:14 +0000</bug_when>
    <thetext>Previously a meaningful error message was generated when jsp:element was used
without the name attribute.

Now when the same JSP is run through a build from cvs HEAD, the following
stacktrace is generated:

&lt;stacktrace&gt;
[java] &lt;/pre&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;root cause&lt;/b&gt; &lt;pre&gt;java.lang.NegativeArraySizeException
     [java]     at
org.apache.jasper.compiler.Validator$ValidateVisitor.visit(Validator.java:901)
     [java]     at org.apache.jasper.compiler.Node$JspElement.accept(Node.java:1067)
     [java]     at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1918)
     [java]     at org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:1960)
     [java]     at
org.apache.jasper.compiler.Validator$ValidateVisitor.visit(Validator.java:670)
     [java]     at
org.apache.jasper.compiler.Node$UninterpretedTag.accept(Node.java:1045)
     [java]     at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1918)
     [java]     at org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:1960)
     [java]     at org.apache.jasper.compiler.Node$Visitor.visit(Node.java:1966)
     [java]     at org.apache.jasper.compiler.Node$Root.accept(Node.java:416)
     [java]     at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1918)
     [java]     at
org.apache.jasper.compiler.Validator.validate(Validator.java:1211)
     [java]     at
org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:253)
&lt;/stacktrace&gt;</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>17404</bug_id>
          
          <creation_ts>2003-02-25 23:28:00 +0000</creation_ts>
          <short_desc>Error message generated when the name attribute is provided with a dynamic value</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>31952</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-02-25 23:28:10 +0000</bug_when>
    <thetext>Given the following:

&lt;jsp:element name="${'element1'}"&gt;body1&lt;/jsp:element&gt;
&lt;jsp:element name='&lt;%= "element2" %&gt;'&gt;body2&lt;/jsp:element&gt;

The following error is returned when the page is translated:

Mandatory XML-style 'name' attribute missing

This worked as expected in previous builds.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>17406</bug_id>
          
          <creation_ts>2003-02-25 23:48:00 +0000</creation_ts>
          <short_desc>Code generation issue when using providing namespaced attributes for jsp:element in a JSP document</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>31955</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-02-25 23:48:56 +0000</bug_when>
    <thetext>Consider the following:
---------------------------------------------------------------------
&lt;root xmlns:jsp="http://java.sun.com/JSP/Page"&gt;
    &lt;jsp:directive.page contentType="text/plain" /&gt;

    &lt;jsp:element name="test"&gt;
        &lt;jsp:attribute name="test:status"&gt;passed&lt;/jsp:attribute&gt;
        &lt;jsp:body&gt;Test PASSED&lt;/jsp:body&gt;
    &lt;/jsp:element&gt;
&lt;/root&gt;
---------------------------------------------------------------------

The result is the following compile error returned from Jasper:

&lt;error&gt;
   [javac]
/files/j2eesrc/j2eepreint1.4fcs/j2ee13/build/unix/web/repository/Standard-Engine/localhost/jsp_core_act_attribute_web/JspAttributeQNameTest3_jspx.java:45:
')' expected
     [java]     [javac]       out.write("&lt;/"null + "&gt;");
     [java]     [javac]                     ^
     [java]     [javac] 1 error
&lt;/error&gt;

This JSP document ran successfully in previous builds.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>17435</bug_id>
          
          <creation_ts>2003-02-26 14:45:00 +0000</creation_ts>
          <short_desc>Request-time attribute values are not properly evaluated when providing values to the name attribute of jsp:element</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>32011</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-02-26 14:45:02 +0000</bug_when>
    <thetext>Consider the following:

 &lt;jsp:element name='%= "element2" %'&gt;body2&lt;/jsp:element&gt;

The following element is generated:

 &lt;%= "element2" %&gt;body2&lt;/%= "element2" %&gt;</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>17438</bug_id>
          
          <creation_ts>2003-02-26 15:58:00 +0000</creation_ts>
          <short_desc>if omit-xml-decl is set to 'no' or 'false' no xml declaration is generated.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>32019</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-02-26 15:58:44 +0000</bug_when>
    <thetext>Consider the following:

&lt;?xml version="1.0"?&gt;
&lt;root xmlns:jsp="http://java.sun.com/JSP/Page"&gt;
    &lt;jsp:output omit-xml-declaration="false" /&gt;
&lt;/root&gt;

Generates the following:

  &lt;root&gt;&lt;/root&gt;</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>17492</bug_id>
          
          <creation_ts>2003-02-27 15:23:00 +0000</creation_ts>
          <short_desc>If the omit-xml-declaration attribute of jsp:output is 'true' or 'yes' in the context of a JSP document, the xml declaration is still generated.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>32089</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-02-27 15:23:12 +0000</bug_when>
    <thetext>Interestingly enough, if the same situation occurs within a Tag file in XML
syntax, the behavior is as expected and no declaration is generated.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>17611</bug_id>
          
          <creation_ts>2003-03-03 17:37:00 +0000</creation_ts>
          <short_desc>Translation error is not raised if an invalid value is provided to the version attribute of the jsp:root element</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>32357</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-03-03 17:37:58 +0000</bug_when>
    <thetext>Table JSP.6-2 states the only valid values for version attribute of jsp:root are
"1.2" and "2.0".  It also states that a translation error must be raised if the
value is not one of the two acceptable values.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>17749</bug_id>
          
          <creation_ts>2003-03-07 00:38:00 +0000</creation_ts>
          <short_desc>Order of &lt;Service&gt; tag in server.xml matters for tomcat 5.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.0</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Rajiv Mordani">rajiv.mordani</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>32620</commentid>
    <comment_count>0</comment_count>
    <who name="Rajiv Mordani">rajiv.mordani</who>
    <bug_when>2003-03-07 00:38:58 +0000</bug_when>
    <thetext>When I have more than one &lt;Service&gt; element in the server.xml if I don't put
localhost as the first one the server comes up with no context initialized.
However if I put localhost first and then the other virtual host second then it
seems to work fine. This works fine with tomcat 4.1.x. It is a regression in
tomcat 5.

For example

&lt;Service name="foo"&gt;

    &lt;Connector className="org.apache.coyote.tomcat5.CoyoteConnector"
               port="8080" minProcessors="5" maxProcessors="100"
               enableLookups="true" redirectPort="8443" acceptCount="100"
               debug="0" connectionTimeout="20000"
               disableUploadTimeout="true" /&gt;
&lt;Engine name="StandAlone" defaultHost="localhost" debug="0"&gt;


      &lt;Realm   className="org.apache.catalina.realm.UserDatabaseRealm"
            resourceName="UserDatabase"
                   debug="0"/&gt;

      &lt;!-- Define the default virtual host --&gt;
      &lt;Host name="localhost" debug="0" appBase="webapps"
       unpackWARs="false" autoDeploy="true"&gt;

      &lt;/Host&gt;

    &lt;/Engine&gt;
&lt;/Service&gt;
&lt;Service name="bar"&gt;

    &lt;Connector className="org.apache.coyote.tomcat5.CoyoteConnector"
               port="8081" minProcessors="5" maxProcessors="100"
               enableLookups="true" redirectPort="8443" acceptCount="100"
               debug="0" connectionTimeout="20000"
               disableUploadTimeout="true" /&gt;

    &lt;Engine name="NewEngine" defaultHost="bar" debug="0"&gt;

      &lt;!-- Define the default virtual host --&gt;
      &lt;Host name="jwsdp-services" debug="0" appBase="foo/webapps"
       unpackWARs="false" autoDeploy="true"&gt;

      &lt;/Host&gt;

    &lt;/Engine&gt;

  &lt;/Service&gt;

This works but if you reverse the order of the &lt;Service&gt; elements it doesn't.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>32622</commentid>
    <comment_count>1</comment_count>
    <who name="Rajiv Mordani">rajiv.mordani</who>
    <bug_when>2003-03-07 00:39:44 +0000</bug_when>
    <thetext>*** Bug 17748 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>32623</commentid>
    <comment_count>2</comment_count>
    <who name="Rajiv Mordani">rajiv.mordani</who>
    <bug_when>2003-03-07 01:09:27 +0000</bug_when>
    <thetext>In addition on switching the order the first service comes up. However with the
second service I get the following error
[WARN] MapperListener - -Error registering Context
Catalina:j2eeType=WebModule,name=//foo/webapps,J2EEApplication=none,J2EEServer=none
&lt;java.lang.ArrayIndexOutOfBoundsException&gt;java.lang.ArrayIndexOutOfBoundsException
        at org.apache.tomcat.util.http.mapper.Mapper.addContext(Mapper.java:192)
       at
org.apache.coyote.tomcat5.MapperListener.registerContext(MapperListener.java:300)
        at
org.apache.coyote.tomcat5.MapperListener.handleNotification(MapperListener.java:192)
        at
com.sun.management.jmx.MBeanServerNotificationListener.handleNotification(MBeanServerNotificationListener.java:48)
        at
javax.management.NotificationBroadcasterSupport.sendNotification(NotificationBroadcasterSupport.java:142)
        at
javax.management.MBeanServerDelegate.sendNotification(MBeanServerDelegate.java:176)
        at
com.sun.management.jmx.MBeanServerImpl.sendNotification(MBeanServerImpl.java:2645)
        at
com.sun.management.jmx.MBeanServerImpl.internal_addObject(MBeanServerImpl.java:2368)
        at
com.sun.management.jmx.MBeanServerImpl.registerMBean(MBeanServerImpl.java:874)
        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:438)
        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:391)
        at
org.apache.catalina.core.StandardContext.registerJMX(StandardContext.java:4667)
        at org.apache.catalina.core.StandardContext.start(StandardContext.java:3964)
        at
org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:831)
        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:817)
        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:632)
       at
org.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:305)
        at org.apache.catalina.core.StandardHost.install(StandardHost.java:825)
        at
org.apache.catalina.startup.HostConfig.deployDirectories(HostConfig.java:631)
        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:471)
        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:814)
        at
org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:428)
        at
org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1235)
       at org.apache.catalina.core.StandardHost.start(StandardHost.java:791)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1227)
       at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:351)
        at org.apache.catalina.core.StandardService.start(StandardService.java:516)
        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2291)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:540)
        at java.lang.reflect.Method.invoke(Native Method)
        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)
        at java.lang.reflect.Method.invoke(Native Method)
        at org.apache.commons.launcher.ChildMain.run(ChildMain.java:269)

[WARN] MapperListener - -Error registering Wrapper
Catalina:j2eeType=Servlet,name=default,WebModule=foo/webapps,J2EEApplication=none,J2EEServer=none
&lt;java.lang.ArrayIndexOutOfBoundsException&gt;java.lang.ArrayIndexOutOfBoundsException
        at org.apache.tomcat.util.http.mapper.Mapper.addWrapper(Mapper.java:245)
       at
org.apache.coyote.tomcat5.MapperListener.registerWrapper(MapperListener.java:375)
        at
org.apache.coyote.tomcat5.MapperListener.handleNotification(MapperListener.java:198)
        at
com.sun.management.jmx.MBeanServerNotificationListener.handleNotification(MBeanServerNotificationListener.java:48)
        at
javax.management.NotificationBroadcasterSupport.sendNotification(NotificationBroadcasterSupport.java:142)
        at
javax.management.MBeanServerDelegate.sendNotification(MBeanServerDelegate.java:176)
        at
com.sun.management.jmx.MBeanServerImpl.sendNotification(MBeanServerImpl.java:2645)
        at
com.sun.management.jmx.MBeanServerImpl.internal_addObject(MBeanServerImpl.java:2368)
        at
com.sun.management.jmx.MBeanServerImpl.registerMBean(MBeanServerImpl.java:874)
        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:438)
        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:391)
        at
org.apache.catalina.core.StandardWrapper.registerJMX(StandardWrapper.java:1516)
        at
org.apache.catalina.core.StandardContext.registerJMX(StandardContext.java:4674)
        at org.apache.catalina.core.StandardContext.start(StandardContext.java:3964)
        at
org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:831)
        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:817)
        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:632)
       at
org.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:305)
        at org.apache.catalina.core.StandardHost.install(StandardHost.java:825)
        at
org.apache.catalina.startup.HostConfig.deployDirectories(HostConfig.java:631)
        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:471)
        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:814)
        at
org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:428)
        at
org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1235)
       at org.apache.catalina.core.StandardHost.start(StandardHost.java:791)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1227)
       at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:351)
        at org.apache.catalina.core.StandardService.start(StandardService.java:516)
        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2291)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:540)
        at java.lang.reflect.Method.invoke(Native Method)
        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)
        at java.lang.reflect.Method.invoke(Native Method)
        at org.apache.commons.launcher.ChildMain.run(ChildMain.java:269)

[WARN] MapperListener - -Error registering Wrapper
Catalina:j2eeType=Servlet,name=invoker,WebModule=jwsdp-services/jaxm-provider,J2EEApplication=none,J2EEServer=none
&lt;java.lang.ArrayIndexOutOfBoundsException&gt;java.lang.ArrayIndexOutOfBoundsException
        at org.apache.tomcat.util.http.mapper.Mapper.addWrapper(Mapper.java:245)
       at
org.apache.coyote.tomcat5.MapperListener.registerWrapper(MapperListener.java:375)
        at
org.apache.coyote.tomcat5.MapperListener.handleNotification(MapperListener.java:198)
        at
com.sun.management.jmx.MBeanServerNotificationListener.handleNotification(MBeanServerNotificationListener.java:48)
        at
javax.management.NotificationBroadcasterSupport.sendNotification(NotificationBroadcasterSupport.java:142)
        at
javax.management.MBeanServerDelegate.sendNotification(MBeanServerDelegate.java:176)
        at
com.sun.management.jmx.MBeanServerImpl.sendNotification(MBeanServerImpl.java:2645)
        at
com.sun.management.jmx.MBeanServerImpl.internal_addObject(MBeanServerImpl.java:2368)
        at
com.sun.management.jmx.MBeanServerImpl.registerMBean(MBeanServerImpl.java:874)
        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:438)
        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:391)
        at
org.apache.catalina.core.StandardWrapper.registerJMX(StandardWrapper.java:1516)
        at
org.apache.catalina.core.StandardContext.registerJMX(StandardContext.java:4674)
        at org.apache.catalina.core.StandardContext.start(StandardContext.java:3964)
        at
org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:831)
        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:817)
        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:632)
       at
org.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:305)
        at org.apache.catalina.core.StandardHost.install(StandardHost.java:825)
        at
org.apache.catalina.startup.HostConfig.deployDirectories(HostConfig.java:631)
        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:471)
        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:814)
        at
org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:428)
        at
org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1235)
       at org.apache.catalina.core.StandardHost.start(StandardHost.java:791)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1227)
       at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:351)
        at org.apache.catalina.core.StandardService.start(StandardService.java:516)
        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2291)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:540)
        at java.lang.reflect.Method.invoke(Native Method)
        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)
        at java.lang.reflect.Method.invoke(Native Method)
        at org.apache.commons.launcher.ChildMain.run(ChildMain.java:269)

[WARN] MapperListener - -Error registering Wrapper
Catalina:j2eeType=Servlet,name=jsp,WebModule=foo/webapps,J2EEApplication=none,J2EEServer=none
&lt;java.lang.ArrayIndexOutOfBoundsException&gt;java.lang.ArrayIndexOutOfBoundsException
        at org.apache.tomcat.util.http.mapper.Mapper.addWrapper(Mapper.java:245)
       at
org.apache.coyote.tomcat5.MapperListener.registerWrapper(MapperListener.java:375)
        at
org.apache.coyote.tomcat5.MapperListener.handleNotification(MapperListener.java:198)
        at
com.sun.management.jmx.MBeanServerNotificationListener.handleNotification(MBeanServerNotificationListener.java:48)
        at
javax.management.NotificationBroadcasterSupport.sendNotification(NotificationBroadcasterSupport.java:142)
        at
javax.management.MBeanServerDelegate.sendNotification(MBeanServerDelegate.java:176)
        at
com.sun.management.jmx.MBeanServerImpl.sendNotification(MBeanServerImpl.java:2645)
        at
com.sun.management.jmx.MBeanServerImpl.internal_addObject(MBeanServerImpl.java:2368)
        at
com.sun.management.jmx.MBeanServerImpl.registerMBean(MBeanServerImpl.java:874)
        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:438)
        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:391)
        at
org.apache.catalina.core.StandardWrapper.registerJMX(StandardWrapper.java:1516)
        at
org.apache.catalina.core.StandardContext.registerJMX(StandardContext.java:4674)
        at org.apache.catalina.core.StandardContext.start(StandardContext.java:3964)
        at
org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:831)
        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:817)
        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:632)
       at
org.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:305)
        at org.apache.catalina.core.StandardHost.install(StandardHost.java:825)
        at
org.apache.catalina.startup.HostConfig.deployDirectories(HostConfig.java:631)
        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:471)
        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:814)
        at
org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:428)
        at
org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1235)
       at org.apache.catalina.core.StandardHost.start(StandardHost.java:791)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1227)
       at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:351)
        at org.apache.catalina.core.StandardService.start(StandardService.java:516)
        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2291)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:540)
        at java.lang.reflect.Method.invoke(Native Method)
        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)
        at java.lang.reflect.Method.invoke(Native Method)
        at org.apache.commons.launcher.ChildMain.run(ChildMain.java:269)

[WARN] MapperListener - -Error registering Wrapper
Catalina:j2eeType=Servlet,name=providerservlet,WebModule=foo/webapps,J2EEApplication=none,J2EEServer=none
&lt;java.lang.ArrayIndexOutOfBoundsException&gt;java.lang.ArrayIndexOutOfBoundsException
        at org.apache.tomcat.util.http.mapper.Mapper.addWrapper(Mapper.java:245)
       at
org.apache.coyote.tomcat5.MapperListener.registerWrapper(MapperListener.java:375)
        at
org.apache.coyote.tomcat5.MapperListener.handleNotification(MapperListener.java:198)
        at
com.sun.management.jmx.MBeanServerNotificationListener.handleNotification(MBeanServerNotificationListener.java:48)
        at
javax.management.NotificationBroadcasterSupport.sendNotification(NotificationBroadcasterSupport.java:142)
        at
javax.management.MBeanServerDelegate.sendNotification(MBeanServerDelegate.java:176)
        at
com.sun.management.jmx.MBeanServerImpl.sendNotification(MBeanServerImpl.java:2645)
        at
com.sun.management.jmx.MBeanServerImpl.internal_addObject(MBeanServerImpl.java:2368)
        at
com.sun.management.jmx.MBeanServerImpl.registerMBean(MBeanServerImpl.java:874)
        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:438)
        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:391)
        at
org.apache.catalina.core.StandardWrapper.registerJMX(StandardWrapper.java:1516)
        at
org.apache.catalina.core.StandardContext.registerJMX(StandardContext.java:4674)
        at org.apache.catalina.core.StandardContext.start(StandardContext.java:3964)
        at
org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:831)
        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:817)
        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:632)
       at
org.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:305)
        at org.apache.catalina.core.StandardHost.install(StandardHost.java:825)
        at
org.apache.catalina.startup.HostConfig.deployDirectories(HostConfig.java:631)
        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:471)
        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:814)
        at
org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:428)
        at
org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1235)
       at org.apache.catalina.core.StandardHost.start(StandardHost.java:791)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1227)
       at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:351)
        at org.apache.catalina.core.StandardService.start(StandardService.java:516)
        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2291)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:540)
        at java.lang.reflect.Method.invoke(Native Method)
        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)
        at java.lang.reflect.Method.invoke(Native Method)
        at org.apache.commons.launcher.ChildMain.run(ChildMain.java:269)

[WARN] MapperListener - -Error registering Wrapper
Catalina:j2eeType=Servlet,name=receiverservlet,WebModule=foo/webapps,J2EEApplication=none,J2EEServer=none
&lt;java.lang.ArrayIndexOutOfBoundsException&gt;java.lang.ArrayIndexOutOfBoundsException
        at org.apache.tomcat.util.http.mapper.Mapper.addWrapper(Mapper.java:245)
       at
org.apache.coyote.tomcat5.MapperListener.registerWrapper(MapperListener.java:375)
        at
org.apache.coyote.tomcat5.MapperListener.handleNotification(MapperListener.java:198)
        at
com.sun.management.jmx.MBeanServerNotificationListener.handleNotification(MBeanServerNotificationListener.java:48)
        at
javax.management.NotificationBroadcasterSupport.sendNotification(NotificationBroadcasterSupport.java:142)
        at
javax.management.MBeanServerDelegate.sendNotification(MBeanServerDelegate.java:176)
        at
com.sun.management.jmx.MBeanServerImpl.sendNotification(MBeanServerImpl.java:2645)
        at
com.sun.management.jmx.MBeanServerImpl.internal_addObject(MBeanServerImpl.java:2368)
        at
com.sun.management.jmx.MBeanServerImpl.registerMBean(MBeanServerImpl.java:874)
        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:438)
        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:391)
        at
org.apache.catalina.core.StandardWrapper.registerJMX(StandardWrapper.java:1516)
        at
org.apache.catalina.core.StandardContext.registerJMX(StandardContext.java:4674)
        at org.apache.catalina.core.StandardContext.start(StandardContext.java:3964)
        at
org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:831)
        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:817)
        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:632)
       at
org.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:305)
        at org.apache.catalina.core.StandardHost.install(StandardHost.java:825)
        at
org.apache.catalina.startup.HostConfig.deployDirectories(HostConfig.java:631)
        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:471)
        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:814)
        at
org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:428)
        at
org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1235)
       at org.apache.catalina.core.StandardHost.start(StandardHost.java:791)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1227)
       at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:351)
        at org.apache.catalina.core.StandardService.start(StandardService.java:516)
        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2291)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:540)
        at java.lang.reflect.Method.invoke(Native Method)
        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)
        at java.lang.reflect.Method.invoke(Native Method)
        at org.apache.commons.launcher.ChildMain.run(ChildMain.java:269)

[WARN] MapperListener - -Error registering Wrapper
Catalina:j2eeType=Servlet,name=digest,WebModule=foo/webapps,J2EEApplication=none,J2EEServer=none
&lt;java.lang.ArrayIndexOutOfBoundsException&gt;java.lang.ArrayIndexOutOfBoundsException
        at org.apache.tomcat.util.http.mapper.Mapper.addWrapper(Mapper.java:245)
       at
org.apache.coyote.tomcat5.MapperListener.registerWrapper(MapperListener.java:375)
        at
org.apache.coyote.tomcat5.MapperListener.handleNotification(MapperListener.java:198)
        at
com.sun.management.jmx.MBeanServerNotificationListener.handleNotification(MBeanServerNotificationListener.java:48)
        at
javax.management.NotificationBroadcasterSupport.sendNotification(NotificationBroadcasterSupport.java:142)
        at
javax.management.MBeanServerDelegate.sendNotification(MBeanServerDelegate.java:176)
        at
com.sun.management.jmx.MBeanServerImpl.sendNotification(MBeanServerImpl.java:2645)
        at
com.sun.management.jmx.MBeanServerImpl.internal_addObject(MBeanServerImpl.java:2368)
        at
com.sun.management.jmx.MBeanServerImpl.registerMBean(MBeanServerImpl.java:874)
        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:438)
        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:391)
        at
org.apache.catalina.core.StandardWrapper.registerJMX(StandardWrapper.java:1516)
        at
org.apache.catalina.core.StandardContext.registerJMX(StandardContext.java:4674)
        at org.apache.catalina.core.StandardContext.start(StandardContext.java:3964)
        at
org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:831)
        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:817)
        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:632)
       at
org.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:305)
        at org.apache.catalina.core.StandardHost.install(StandardHost.java:825)
        at
org.apache.catalina.startup.HostConfig.deployDirectories(HostConfig.java:631)
        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:471)
        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:814)
        at
org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:428)
        at
org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1235)
       at org.apache.catalina.core.StandardHost.start(StandardHost.java:791)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1227)
       at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:351)
        at org.apache.catalina.core.StandardService.start(StandardService.java:516)
        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2291)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:540)
        at java.lang.reflect.Method.invoke(Native Method)
        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)
        at java.lang.reflect.Method.invoke(Native Method)
        at org.apache.commons.launcher.ChildMain.run(ChildMain.java:269)

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33011</commentid>
    <comment_count>3</comment_count>
    <who name="Amy Roh">amyroh</who>
    <bug_when>2003-03-12 09:06:31 +0000</bug_when>
    <thetext>The problem does not occur when non "localhost" service comes but when an engine
other than "Tomcat-Standalone" name comes first due to
MapperListener.registerHost has hardcoded engine object name with
"Tomcat-Standalone".  I believe it's still under development since it has
"FIXME" comment. :-)  </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>35271</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-04-15 22:16:39 +0000</bug_when>
    <thetext>The problems with the mapper should have been resolved now that the relevant
hosts are properly registered with JMX.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>17783</bug_id>
          
          <creation_ts>2003-03-07 19:16:00 +0000</creation_ts>
          <short_desc>filter invoked incorrectly when &lt;dispatcher&gt; value set to FORWARD only</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlet &amp; JSP API</component>
          <version>5.0.1</version>
          <rep_platform>Sun</rep_platform>
          <op_sys>Solaris</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Dianne Jiao">dianne.jiao</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>32683</commentid>
    <comment_count>0</comment_count>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-07 19:16:13 +0000</bug_when>
    <thetext>Filter mapping:

  &lt;filter-mapping&gt;
    &lt;filter-name&gt;ServletMappedTest_Filter&lt;/filter-name&gt;
    &lt;servlet-name&gt;ForwardedServlet&lt;/servlet-name&gt;
    &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;
  &lt;/filter-mapping&gt;

Access ForwardedServlet directly, filter gets invoked.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33350</commentid>
    <comment_count>1</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2003-03-18 16:26:34 +0000</bug_when>
    <thetext>The forward mechanism was broken. Please try an let me know.

Thanks,

-- Jeanfrancois</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34190</commentid>
    <comment_count>2</comment_count>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-31 15:59:39 +0000</bug_when>
    <thetext>Fix verified in today's cvs build.  Thanks.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>17784</bug_id>
          
          <creation_ts>2003-03-07 19:21:00 +0000</creation_ts>
          <short_desc>filter not invoked  when &lt;dispatcher&gt; value set   to FORWARD only</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlet &amp; JSP API</component>
          <version>5.0.1</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Dianne Jiao">dianne.jiao</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>32684</commentid>
    <comment_count>0</comment_count>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-07 19:21:50 +0000</bug_when>
    <thetext>Access ForwardedServlet using forward, the filter configured not get invoked:

public void forwardTest(ServletRequest request, ServletResponse response )
                           throws ServletException, IOException {
        String path = "/forward/ForwardedServlet";
        RequestDispatcher rd = getServletContext().getRequestDispatcher( path );
        rd.forward( request, response );
    }

Filter is configured as follow:
  &lt;filter-mapping&gt;
    &lt;filter-name&gt;ServletMappedTest_Filter&lt;/filter-name&gt;
    &lt;servlet-name&gt;ForwardedServlet&lt;/servlet-name&gt;
    &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;
  &lt;/filter-mapping&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>32685</commentid>
    <comment_count>1</comment_count>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-07 19:24:36 +0000</bug_when>
    <thetext>Filter not invoked when filter is configured using &lt;url-pattern. as well:

  &lt;filter-mapping&gt;
    &lt;filter-name&gt;ServletMappedTest_Filter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/generic/*&lt;/url-pattern&gt;
    &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
    &lt;dispatcher&gt;INCLUDE&lt;/dispatcher&gt;
    &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;
    &lt;dispatcher&gt;ERROR&lt;/dispatcher&gt;
  &lt;/filter-mapping&gt;
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33349</commentid>
    <comment_count>2</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2003-03-18 16:26:19 +0000</bug_when>
    <thetext>The forward mechanism was broken. Please try an let me know.

Thanks,

-- Jeanfrancois</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34188</commentid>
    <comment_count>3</comment_count>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-31 15:58:07 +0000</bug_when>
    <thetext>Fix verified in today's cvs build. Thanks.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>17785</bug_id>
          
          <creation_ts>2003-03-07 19:31:00 +0000</creation_ts>
          <short_desc>filter not invoked at all RequestDispatcher.include actions</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlet &amp; JSP API</component>
          <version>5.0.1</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Dianne Jiao">dianne.jiao</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>32686</commentid>
    <comment_count>0</comment_count>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-07 19:31:18 +0000</bug_when>
    <thetext>All filters configured as follows not invoked when IncludedServlet, 
/generic/dummyServlet, /generic/dummyJSP, /dummy.html is accessed through
RequestDipatcher.include.

  &lt;filter-mapping&gt;
    &lt;filter-name&gt;ServletMappedTest_Filter&lt;/filter-name&gt;
    &lt;servlet-name&gt;IncludedServlet&lt;/servlet-name&gt;
    &lt;dispatcher&gt;INCLUDE&lt;/dispatcher&gt;
  &lt;/filter-mapping&gt;

  &lt;filter-mapping&gt;
    &lt;filter-name&gt;ServletMappedTest_Filter&lt;/filter-name&gt;
    &lt;url-pattern&gt;&lt;/url-pattern&gt;
    &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
    &lt;dispatcher&gt;INCLUDE&lt;/dispatcher&gt;
    &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;
    &lt;dispatcher&gt;ERROR&lt;/dispatcher&gt;
  &lt;/filter-mapping&gt;

  &lt;filter-mapping&gt;
    &lt;filter-name&gt;ServletMappedTest_Filter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/dummy.html&lt;/url-pattern&gt;
    &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
    &lt;dispatcher&gt;INCLUDE&lt;/dispatcher&gt;
    &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;
    &lt;dispatcher&gt;ERROR&lt;/dispatcher&gt;
  &lt;/filter-mapping&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33351</commentid>
    <comment_count>1</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2003-03-18 16:26:57 +0000</bug_when>
    <thetext>The forward mechanism was broken. Please try an let me know.

Thanks,

-- Jeanfrancois</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34189</commentid>
    <comment_count>2</comment_count>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-31 15:58:37 +0000</bug_when>
    <thetext>Fix verified in today's cvs build. Thanks.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>17787</bug_id>
          
          <creation_ts>2003-03-07 19:37:00 +0000</creation_ts>
          <short_desc>filter not invoked when&lt;DISPATCHER&gt; value set to ERROR</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlet &amp; JSP API</component>
          <version>5.0.1</version>
          <rep_platform>Sun</rep_platform>
          <op_sys>Solaris</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Dianne Jiao">dianne.jiao</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>32687</commentid>
    <comment_count>0</comment_count>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-07 19:37:57 +0000</bug_when>
    <thetext>When to access an non-exist file, 404 and Errorpage is returned,  but the filter
configured for the error page didn't get invoked:

ERROR filter is configured:
  &lt;filter-mapping&gt;
    &lt;filter-name&gt;ServletMappedTest_Filter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/generic/*&lt;/url-pattern&gt;
    &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
    &lt;dispatcher&gt;INCLUDE&lt;/dispatcher&gt;
    &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;
    &lt;dispatcher&gt;ERROR&lt;/dispatcher&gt;
  &lt;/filter-mapping&gt;

Errorpage is configured:
&lt;error-page&gt;
    &lt;error-code&gt;404&lt;/error-code&gt;
    &lt;location&gt;/generic/ErrorPage&lt;/location&gt;
  &lt;/error-page&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33352</commentid>
    <comment_count>1</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2003-03-18 16:27:19 +0000</bug_when>
    <thetext>The forward mechanism was broken. Please try an let me know.

Thanks,

-- Jeanfrancois</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>17929</bug_id>
          
          <creation_ts>2003-03-12 19:21:00 +0000</creation_ts>
          <short_desc>EL expression treated as plain text in template data attribute with Jsp Document syntax</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>Nightly Build</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Erik Beijnoff">erik</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>33077</commentid>
    <comment_count>0</comment_count>
    <who name="Erik Beijnoff">erik</who>
    <bug_when>2003-03-12 19:21:29 +0000</bug_when>
    <thetext>When i use the xml syntax for a jsp page with Tomcat 5.0 Alpha and try to 
reference an EL parameter in a template data attribute, the EL expression gets 
output as plain text, i.e. it is treated as quoted plaintext within the 
attribute. The behavior seems a bit strange to me, I'd expect it to output the 
parameter. I've been trying to find a clarification in the JSP 2.0, and JSTL 
1.0 specification but unfonrtunately no luck so far.

Example, please note that the first EL expression is treated as plain text, 
while the second evaluates correctly.:

&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;jsp:root
 xmlns:jsp="http://java.sun.com/JSP/Page"
 xmlns:c="http://java.sun.com/jstl/core"
 version="2.0"&gt;

&lt;jsp:directive.page
 contentType="text/html"
 pageEncoding="ISO-8859-1"/&gt;

&lt;html&gt;
&lt;body&gt;
    &lt;div class="${1+2}"&gt;${1+2}&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
&lt;/jsp:root&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34659</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-04-08 00:10:59 +0000</bug_when>
    <thetext>The attributes for an unterpreted tag in XML syntax are not evaluated.  That
means that any EL or rt expressions are not evaluated.  This is intended.

To get around this problem, instead of

	&lt;div class="${1+2}"&gt;${1+2}&lt;/div&gt;

you can write

	&lt;jsp:element name="div"&gt;
	    &lt;jsp:attribute name="class"&gt;${1+2}&lt;/jsp:attribute&gt;
	    &lt;jsp:body&gt;${1+2}&lt;/jsp:body&gt;
	&lt;/jsp:element&gt;

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34673</commentid>
    <comment_count>2</comment_count>
    <who name="Hans Bergsten">hans</who>
    <bug_when>2003-04-08 06:20:41 +0000</bug_when>
    <thetext>Sorry, but I disagree that EL expressions in XML element attributes are not
evaluated. "JSP.6.3.10 Dynamic Template Content" in PFD2 says this about it:

  In some cases, the dynamic content that is generated can be described as
  simple substitutions on otherwise static templates. JSP documents can have 
  XML templates where EL expressions are used as the values of the body or 
  of attributes. For instance, the next example uses the expression 
  table.indent as the value of an attribute, and the expression table.value 
  as that for the body of an element:

    &lt;table indent="${table.indent}"&gt;
      &lt;row&gt;${table.value}&lt;/row&gt;
    &lt;/table&gt;</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>18199</bug_id>
          
          <creation_ts>2003-03-20 18:54:00 +0000</creation_ts>
          <short_desc>Regression in Tomcat 5: UnavailableException thrown in init() return Status 404 not 503</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlet &amp; JSP API</component>
          <version>5.0.1</version>
          <rep_platform>Sun</rep_platform>
          <op_sys>Solaris</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Dianne Jiao">dianne.jiao</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>Ryan.Lubke</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>33557</commentid>
    <comment_count>0</comment_count>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-20 18:54:24 +0000</bug_when>
    <thetext>UnavailableException thrown in init():

 public void init( ServletConfig sc ) throws ServletException {
        //throw new UnavailableException(this,"Negative Init Test");
        throw new UnavailableException( "Negative Init Test" );
    }

Configuration of the accessed servlet:
&lt;servlet&gt;
    &lt;servlet-name&gt;DoInit1TestLogicalName&lt;/servlet-name&gt;   
&lt;servlet-class&gt;com.sun.ts.tests.servlet.api.javax_servlet.servlet.DoInit1TestServlet&lt;/servlet-class&gt;
  &lt;/servlet&gt;

  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;DoInit1TestLogicalName&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/DoInit1Test&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33559</commentid>
    <comment_count>1</comment_count>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-20 19:05:34 +0000</bug_when>
    <thetext>This is correct behaviour according to spec.  Mark it invalid.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33560</commentid>
    <comment_count>2</comment_count>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-20 19:14:59 +0000</bug_when>
    <thetext>The bug is valid, but the statement needs to be corrected:
Expect 404 but got 500.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33858</commentid>
    <comment_count>3</comment_count>
      <attachid>5519</attachid>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-26 19:48:22 +0000</bug_when>
    <thetext>Created attachment 5519
war file to help reproduce the problem</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33876</commentid>
    <comment_count>4</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2003-03-26 22:01:02 +0000</bug_when>
    <thetext>Fixed. Based on the spec SRV.2.3.3.2 Exceptions During Request Handling:
  
  - 404 will be returned if the servlet is permanently unavailable
  - 503 will be returned if the servlet is unavailable for x time

-- Jeanfrancois</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33926</commentid>
    <comment_count>5</comment_count>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-27 15:03:58 +0000</bug_when>
    <thetext>Fix verified in today's cvs build.  Thanks.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33981</commentid>
    <comment_count>6</comment_count>
      <attachid>5545</attachid>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-27 19:12:50 +0000</bug_when>
    <thetext>Created attachment 5545
updated test case</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>5519</attachid>
            <date>2003-03-26 19:48:00 +0000</date>
            <delta_ts>2003-03-26 19:48:22 +0000</delta_ts>
            <desc>war file to help reproduce the problem</desc>
            <filename>servlet_js_servlet_web.war</filename>
            <type>application/octet-stream</type>
            <size>12996</size>
            <attacher name="Dianne Jiao">dianne.jiao</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>5545</attachid>
            <date>2003-03-27 19:12:00 +0000</date>
            <delta_ts>2003-03-27 19:12:50 +0000</delta_ts>
            <desc>updated test case</desc>
            <filename>servlet_spec_httpservletresponse_web.war</filename>
            <type>application/octet-stream</type>
            <size>8389</size>
            <attacher name="Dianne Jiao">dianne.jiao</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>18200</bug_id>
          
          <creation_ts>2003-03-20 19:00:00 +0000</creation_ts>
          <short_desc>Regression in Tomcat 5:  runtime Exception that cannot be caught by catch block</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.1</version>
          <rep_platform>Sun</rep_platform>
          <op_sys>Solaris</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Dianne Jiao">dianne.jiao</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>33558</commentid>
    <comment_count>0</comment_count>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-20 19:00:38 +0000</bug_when>
    <thetext>The following catch block cannot catch java.net.MalformedURLException:

try {
            URL resourceURL = context.getResource( path );

            passed=false;
            pw.println("GetResource_2Test "+ Data.PASSED);
            pw.println(" Should not be here!!!");
        } catch (java.net.MalformedURLException ex) {
            passed = true;
            pw.println("GetResource_2Test "+ Data.PASSED);
            pw.println("Expected java.net.MalformedURLException is thrown");
        } catch ( Exception e) {
            passed = false;
            pw.println("GetResource_2Test "+ Data.PASSED);
            pw.println("Unexpected Exception is thrown: " + e.toString());
        }

Stacktrace from server:
Mar 20, 2003 1:53:30 PM org.apache.catalina.core.ApplicationContextFacade
doPrivileged
SEVERE: doPrivileged
java.net.MalformedURLException: Path {0} does not start with a "/" character
        at
org.apache.catalina.core.ApplicationContext.getResource(ApplicationContext.java:470)
        at sun.reflect.GeneratedMethodAccessor44.invoke(Unknown Source)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at
org.apache.catalina.core.ApplicationContextFacade.executeMethod(ApplicationContextFacade.java:400)
        at
org.apache.catalina.core.ApplicationContextFacade.doPrivileged(ApplicationContextFacade.java:328)
        at
org.apache.catalina.core.ApplicationContextFacade.doPrivileged(ApplicationContextFacade.java:305)
        at
org.apache.catalina.core.ApplicationContextFacade.getResource(ApplicationContextFacade.java:209)
        at
com.sun.ts.tests.servlet.api.javax_servlet.servletcontext.TestServlet.getResource_2(TestServlet.java:377)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at
com.sun.ts.tests.servlet.common.servlets.GenericTCKServlet.invokeTest(GenericTCKServlet.java:79)
        at
com.sun.ts.tests.servlet.common.servlets.GenericTCKServlet.service(GenericTCKServlet.java:63)
        at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:288)
        at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
        at
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:294)
        at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
        at
org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:490)
        at
org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1025)
        at
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:196)
        at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
        at
org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:490)
        at
org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1025)
        at
org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2658)
        at
org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)
        at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
        at
org.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:171)
        at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)
        at
org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:172)
        at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)
        at
org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:490)
        at
org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1025)
        at
org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:163)
        at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
        at
org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:490)
        at
org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1025)
        at
org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:196)
        at
org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:625)
        at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:430)
        at
org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:567)
        at
org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:623)
        at java.lang.Thread.run(Thread.java:536)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33567</commentid>
    <comment_count>1</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2003-03-20 20:10:07 +0000</bug_when>
    <thetext>Fixed. The original exception will be thrown.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33927</commentid>
    <comment_count>2</comment_count>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-27 15:05:19 +0000</bug_when>
    <thetext>Fix verified in Today's CVS build.  Thanks.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>18201</bug_id>
          
          <creation_ts>2003-03-20 19:46:00 +0000</creation_ts>
          <short_desc>Tomcat 5 regression: getReader() doesnot throw UnsupportedEncodingException when bogus charset is used</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlet &amp; JSP API</component>
          <version>5.0.1</version>
          <rep_platform>Sun</rep_platform>
          <op_sys>Solaris</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Dianne Jiao">dianne.jiao</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>33562</commentid>
    <comment_count>0</comment_count>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-20 19:46:58 +0000</bug_when>
    <thetext>Request:
[REQUEST LINE] -&gt; POST
/servlet_js_servletrequest_web/getReaderUnsupportedEncodingExceptionTest
HTTP/1.1
     [java]        [REQUEST HEADER] -&gt; Content-Length: 49
     [java]        [REQUEST HEADER] -&gt; Host: slappy.east:8080
     [java]        [REQUEST HEADER] -&gt; User-Agent: Jakarta
Commons-HttpClient/2.0M1
     [java]        [REQUEST HEADER] -&gt; Content-Type: text/plain;
charset=DoesNonExist
     [java]        [REQUEST BODY LENGTH] -&gt; 49

Servlet code:
public void service(ServletRequest request, ServletResponse response) throws
ServletException, IOException {
        PrintWriter pw=response.getWriter();
        try {
            BufferedReader br = request.getReader();
            pw.println( "getReader() method did not throw
UnsupportedEncodingException" );
        } catch (Throwable t) {
            if ( !(t instanceof UnsupportedEncodingException) ) {
                pw.println("Exception thrown, but was not an instance of
IllegalStateException.");
                pw.println("instead received: " + t.getClass().getName());
            }
        }
    }</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33862</commentid>
    <comment_count>1</comment_count>
      <attachid>5522</attachid>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-26 20:03:31 +0000</bug_when>
    <thetext>Created attachment 5522
testcase war file</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>36450</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-05-01 15:04:58 +0000</bug_when>
    <thetext>This has been fixed.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>5522</attachid>
            <date>2003-03-26 20:03:00 +0000</date>
            <delta_ts>2003-03-26 20:03:31 +0000</delta_ts>
            <desc>testcase war file</desc>
            <filename>servlet_js_servletrequest_web.war</filename>
            <type>application/octet-stream</type>
            <size>19235</size>
            <attacher name="Dianne Jiao">dianne.jiao</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>18202</bug_id>
          
          <creation_ts>2003-03-20 19:57:00 +0000</creation_ts>
          <short_desc>Tomcat 5 regression: default Content-Type is set to text/plain</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlet &amp; JSP API</component>
          <version>5.0.1</version>
          <rep_platform>Sun</rep_platform>
          <op_sys>Solaris</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Dianne Jiao">dianne.jiao</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>33564</commentid>
    <comment_count>0</comment_count>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-20 19:57:05 +0000</bug_when>
    <thetext>This behaviour is against Servlet spec 2.4 SRV.5.2.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33570</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-03-20 21:12:25 +0000</bug_when>
    <thetext>The statement from the specification contradicts the HTTP spec (and the
paragraph makes a wrong statement about the HTTP spec, which DOES default to a
default encoding when none is specified; whether or not it is explicitely
specified in the request or response does not make any semantic difference).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33616</commentid>
    <comment_count>2</comment_count>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-21 19:32:31 +0000</bug_when>
    <thetext>To be specific, the following call should return null when not set:   
ServletResponse.getContentType()
Now TC5 returns by default:      Content-Type: text/plain

public void service(ServletRequest request, ServletResponse response) throws
ServletException, IOException {
        PrintWriter pw = response.getWriter();
        String actual = response.getContentType();
        if (actual != null) {
            pw.println( "getContentType() did not return a null");
            pw.println( "actual="+actual);
        }
}</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33859</commentid>
    <comment_count>3</comment_count>
      <attachid>5520</attachid>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-26 19:52:21 +0000</bug_when>
    <thetext>Created attachment 5520
test case</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>36437</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-05-01 12:22:18 +0000</bug_when>
    <thetext>This has been fixed.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>5520</attachid>
            <date>2003-03-26 19:52:00 +0000</date>
            <delta_ts>2003-03-26 19:52:21 +0000</delta_ts>
            <desc>test case</desc>
            <filename>servlet_js_servletresponse_web.war</filename>
            <type>application/octet-stream</type>
            <size>14592</size>
            <attacher name="Dianne Jiao">dianne.jiao</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>18204</bug_id>
          
          <creation_ts>2003-03-20 20:35:00 +0000</creation_ts>
          <short_desc>Regression in Tomcat 5: no IllegalArgumentException thrown with new Cookie("$test", "Valueless");</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlet &amp; JSP API</component>
          <version>5.0.1</version>
          <rep_platform>Sun</rep_platform>
          <op_sys>Solaris</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Dianne Jiao">dianne.jiao</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>jfarcand</cc>
    
    <cc>Ryan.Lubke</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>33569</commentid>
    <comment_count>0</comment_count>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-20 20:35:06 +0000</bug_when>
    <thetext>The $ sign that starts cookie's name $test should cause IllegalArgumentException
thrown.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33861</commentid>
    <comment_count>1</comment_count>
      <attachid>5521</attachid>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-26 20:00:34 +0000</bug_when>
    <thetext>Created attachment 5521
testcase</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34972</commentid>
    <comment_count>2</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2003-04-11 15:04:54 +0000</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>5521</attachid>
            <date>2003-03-26 20:00:00 +0000</date>
            <delta_ts>2003-03-26 20:00:34 +0000</delta_ts>
            <desc>testcase</desc>
            <filename>servlet_jsh_cookie_web.war</filename>
            <type>application/octet-stream</type>
            <size>11773</size>
            <attacher name="Dianne Jiao">dianne.jiao</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>18220</bug_id>
          
          <creation_ts>2003-03-21 11:33:00 +0000</creation_ts>
          <short_desc>Copy &amp; Paste doesn't work (Apache Service Monitor)</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Native:Integration</component>
          <version>5.0.9</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Marc Lehmann">marc.lehmann</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>33598</commentid>
    <comment_count>0</comment_count>
    <who name="Marc Lehmann">marc.lehmann</who>
    <bug_when>2003-03-21 11:33:56 +0000</bug_when>
    <thetext>I can't Copy&amp;Paste text strings from the Console Monitor application (Apache 
Service Monitor) to any other application. The Copy&amp;Paste buffer seems to be 
empty.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39690</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2003-06-30 19:11:27 +0000</bug_when>
    <thetext>I just reproduced it on Windows 2000 (Tomcat 5.0.3, JDK 1.4.1_03).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43656</commentid>
    <comment_count>2</comment_count>
    <who name="">william.barker</who>
    <bug_when>2003-09-03 03:48:47 +0000</bug_when>
    <thetext>Fixed now in the CVS and should appear in 5.0.10.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>18225</bug_id>
          
          <creation_ts>2003-03-21 15:37:00 +0000</creation_ts>
          <short_desc>Regression in Tomcat 5: Request failed to match "default" servlet</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlet &amp; JSP API</component>
          <version>5.0.1</version>
          <rep_platform>Sun</rep_platform>
          <op_sys>Solaris</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Dianne Jiao">dianne.jiao</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>33604</commentid>
    <comment_count>0</comment_count>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-21 15:37:23 +0000</bug_when>
    <thetext>Server failed to map the following request: 
GET /servlet_jsh_httpservletrequest_web/getServletPathEmptyStringTest HTTP/1.1
To the default servlet, and return status code 404.

Servlet configuration:
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;getServletPathEmptyStringTest&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;

Test Servlet:
    public void service(PrintWriter pw, HttpServletRequest request,
HttpServletResponse response) throws ServletException, IOException {
        String expectedResult = "";
        String result = request.getServletPath();
        PrintWriter pw = response.getWriter();

        if (result != null) {
            if (!result.equals(expectedResult)) {
                pw.println("getServletPath() returned an incorrect result");
                pw.println("Expected result = ''");
                pw.println("Actual result = |" + result + "|");
            } 
        } else {
            pw.println("getServletPath() returned a null result");
        }
    }</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33614</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-03-21 18:36:00 +0000</bug_when>
    <thetext>Try again with a CVS build, and reopen if it still doesn't work. Note: If it
just doesn't work because getServletPath returns null or "/" instead of "",
please mention it.

In this case, the mapper will map to getServletPathEmptyStringTest.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33765</commentid>
    <comment_count>2</comment_count>
      <attachid>5498</attachid>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-25 15:41:44 +0000</bug_when>
    <thetext>Created attachment 5498
war file for reproducing problem</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33770</commentid>
    <comment_count>3</comment_count>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-25 15:52:09 +0000</bug_when>
    <thetext>Forgot to re-open it last time.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33771</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-03-25 16:07:16 +0000</bug_when>
    <thetext>I'll decline the priviledge to recieve your stuff twice, thanks ;-)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33781</commentid>
    <comment_count>5</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-03-25 19:03:25 +0000</bug_when>
    <thetext>The wildcard mapping had a bug.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33846</commentid>
    <comment_count>6</comment_count>
    <who name="Dianne Jiao">dianne.jiao</who>
    <bug_when>2003-03-26 18:39:07 +0000</bug_when>
    <thetext>Fix verified today.  Thanks.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33856</commentid>
    <comment_count>7</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-03-26 19:35:00 +0000</bug_when>
    <thetext>- Always verify using the CVS code
- Always submit a test case (I did reproduce what you had explained, but there
was no problem with what you described)</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>5498</attachid>
            <date>2003-03-25 15:41:00 +0000</date>
            <delta_ts>2003-03-25 15:41:44 +0000</delta_ts>
            <desc>war file for reproducing problem</desc>
            <filename>servlet_jsh_httpservletrequest_web.war</filename>
            <type>application/octet-stream</type>
            <size>33163</size>
            <attacher name="Dianne Jiao">dianne.jiao</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>18236</bug_id>
          
          <creation_ts>2003-03-21 21:30:00 +0000</creation_ts>
          <short_desc>An xmlns declaration that doesn't denote a tag library causes translation error</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.1</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Hans Bergsten">hans</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>33623</commentid>
    <comment_count>0</comment_count>
    <who name="Hans Bergsten">hans</who>
    <bug_when>2003-03-21 21:30:10 +0000</bug_when>
    <thetext>In a JSP Document, xmlns declarations are used to declare tag libraries, but
xmlns declarations for regular XML namespaces are also allowed. With TC 5.0.1,
however, such a declaration cause a translation error with this root cause message:

org.apache.jasper.JasperException: The absolute uri:
http://www.w3c.org/1999/xhtml cannot be resolved in either web.xml or the jar
files deployed with this application
	at
org.apache.jasper.compiler.DefaultErrorHandler.jspError(DefaultErrorHandler.java:94)

This is the result when accessing a JSP Document such as the one used as an
example in JSP 2.0 PDF2, section JSP.6.4.4, with a root element like this:

  &lt;html
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:jsp="http://java.sun.com/JSP/Page"
    xmlns:c="http://java.sun.com/jstl/core"
    xmlns:u="urn:jsptagdir:/WEB-INF/tags/mylib/"&gt;</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>18251</bug_id>
          
          <creation_ts>2003-03-22 21:02:00 +0000</creation_ts>
          <short_desc>ServletResponse.setLocale() is not implemented as described in the spec</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:HTTP</component>
          <version>5.0.1</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Hans Bergsten">hans</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>33642</commentid>
    <comment_count>0</comment_count>
    <who name="Hans Bergsten">hans</who>
    <bug_when>2003-03-22 21:02:14 +0000</bug_when>
    <thetext>The setLocale() method in org.apache.coyote.tomcat5.CoyoteResponse is not spec
compliant: it doesn't respect a locale setting after setContentType() has been
called, even if the provided content type doesn't specify a charset.

The Javadocs for setLocale() in Servlet 2.4 PDF2 says:

  Sets the locale of the response, setting the Content-Language header, 
  if the response has not been committed yet. It also sets the response's 
  character encoding appropriately for the locale, if the character encoding
  has not been explicitly set using setContentType(String) or 
  setCharacterEncoding(String) , getWriter hasn’t been called yet, and the 
  response hasn’t been committed yet. ...

CoyoteResponse breaks two of these rules:
1) It doesn't set the Content-Language header (by calling Response.setLocale())
   if setContentType() or setCharacterEncoding() has been called. It should
   make this call in all cases, as long as the response has not been committed.
2) It doesn't set the charset attribute of the Content-Type header (by calling
   Response.setCharacterEncoding()) if setContentType() has been called. It
   should make this call even if setContentType() has been called, as long
   as the specified content type doesn't include a charset attribute.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33645</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-03-22 21:26:44 +0000</bug_when>
    <thetext>I do not agree with that. Setting the content-language header is delayed, and
will be set right before the response is committed. I don't see any problem with
doing that.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33646</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-03-22 21:33:36 +0000</bug_when>
    <thetext>Basically, in this case, the specification attempts to force how things are
implemented, although the servlet cannot access the headers. Delaying setting
them will not change anything, so the specification exact wording WILL NOT be
implemented. I am -1 for fixing this, as the container should use special
handling for all special HTTP headers, and restrict access to them.

Some part of the bug seems valid, though (although it should be noted that the
spec is too complex; as usual, why have three ways of doing the same thing ?).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>33647</commentid>
    <comment_count>3</comment_count>
    <who name="Hans Bergsten">hans</who>
    <bug_when>2003-03-22 22:10:27 +0000</bug_when>
    <thetext>Spec complexity concerns should be addressed to the JSR-154 EG. Even though I
agree that the implementation doesn't necessarily have to be changed as I
indicated, the fact is that calling setLocale() after calling setContentType()
(without charset), doesn't work as defined by the spec in TC 5.0.1. 

Delaying setting the headers should be fine, as long as the end result is what's
defined by the extract from the spec I included.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>36460</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-05-01 20:56:21 +0000</bug_when>
    <thetext>This has been fixed. The spec is too complex, though.</thetext>
  </long_desc>
      
      

    <bug_classification class="SPEC">SPEC</bug_classification></bug>
    <bug>
          <bug_id>18465</bug_id>
          
          <creation_ts>2003-03-28 13:20:00 +0000</creation_ts>
          <short_desc>Problem in build file with bad xerces value</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="moliere">jmoliere</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>34047</commentid>
    <comment_count>0</comment_count>
    <who name="moliere">jmoliere</who>
    <bug_when>2003-03-28 13:20:21 +0000</bug_when>
    <thetext>The ANT script tries to download the 2.3 release of Xerces while this one is no
more present on the webserver.
Using the 2.4 instead solves this problem..
could be helpful ...</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34064</commentid>
    <comment_count>1</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2003-03-28 15:03:51 +0000</bug_when>
    <thetext>Fixed. </thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>18479</bug_id>
          
          <creation_ts>2003-03-28 19:08:00 +0000</creation_ts>
          <short_desc>HttpSessionBindingListener.valueUnbound() not called</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.0.19</version>
          <rep_platform>PC</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="David Thielen">dave</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>1</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>34086</commentid>
    <comment_count>0</comment_count>
    <who name="David Thielen">dave</who>
    <bug_when>2003-03-28 19:08:02 +0000</bug_when>
    <thetext>I have an object that implements HttpSessionBindingListener. It calls 
valueBound fine. But it never calls valueUnbound. Not when it times out and not 
when Tomcat is closed.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34144</commentid>
    <comment_count>1</comment_count>
    <who name="David Thielen">dave</who>
    <bug_when>2003-03-31 01:42:20 +0000</bug_when>
    <thetext>With version 4.1.24 it does call it on a timeout. However, it does not call it 
if Tomcat is shut down and if the listener class is not serializable it is not 
brought back when Tomcat restarts.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54690</commentid>
    <comment_count>2</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2004-03-25 22:26:14 +0000</bug_when>
    <thetext>Fixed in CVS for TC4 and TC5.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55636</commentid>
    <comment_count>3</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2004-04-11 06:12:58 +0000</bug_when>
    <thetext>I believe the fix for this issue has caused another one.  The Tomcat-5.0.21
changlog says the following about the fix for this bug report...

18479: Non-serializable sessions attributes should be removed (so valueUnbound
is called) (markt)

I have a session that is perfectly serializable in both 5.0.19 and 5.0.20, but
as of 5.0.21, the value for the session attribute comes back null.  I also
tested in 5.0.22 with the same result.  The test consists of a hit counter that
stays in the session and should pick up right where it left off upon
server/application reload as long as the session hasn't yet timed out.

I have a HttpSessionAttributeListener reporting when objects are
added/removed/replaced in the session.  I get the report of the object in
question being added, but I never see that it has been removed or replaced.  As
such, I must assume that the session attribute is still there, but its value
changed to null somewhere behind the scenes in a way that doesn't report it to
the HttpSessionAttributeListener (at a minimum, attributeReplaced() should be
called, no?).

If this report should be separate from this bug, please say so and I'll do that,
but this one seems suspect as the cause for the issue I am seeing.  Also let me
know if more information is needed or if a test case is needed.  I, obviously,
have a test case, but it not exactly simplified.  I'll do that if what I am
reporting seems non-obvious to the Tomcat gurus.

Jake</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55638</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-04-11 11:28:31 +0000</bug_when>
    <thetext>Please don't bother.

The new code  in writeObject is:
        // Accumulate the names of serializable and non-serializable attributes
        String keys[] = keys();
        ArrayList saveNames = new ArrayList();
        ArrayList saveValues = new ArrayList();
        for (int i = 0; i &lt; keys.length; i++) {
            Object value = null;
            synchronized (attributes) {
                value = attributes.get(keys[i]);
            }
            if (value == null)
                continue;
            else if ( (value instanceof Serializable) 
                    &amp;&amp; (!exclude(keys[i]) )) {
                saveNames.add(keys[i]);
                saveValues.add(value);
            } else {
                removeAttribute(keys[i]);
            }
        }

The change is the added removeAttribute. The patch which "broke" everything is
(this is the only difference between 5.0.20 and 5.0.21):
  diff -u -r1.40 -r1.41
  --- StandardSession.java	12 Mar 2004 22:36:46 -0000	1.40
  +++ StandardSession.java	25 Mar 2004 22:17:54 -0000	1.41
  @@ -1397,6 +1397,8 @@
                       &amp;&amp; (!exclude(keys[i]) )) {
                   saveNames.add(keys[i]);
                   saveValues.add(value);
  +            } else {
  +                removeAttribute(keys[i]);
               }
           }

I doubt your "perfectly serializable" stuff actually is.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55644</commentid>
    <comment_count>5</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2004-04-12 01:06:15 +0000</bug_when>
    <thetext>Hi Remy,

I have to admit, it looks pretty rock solid, but how is it that in 5.0.20 my
session serialized/deserialized *without* error and gave me a non-null attribute
value (exactly as I expected) after reload?  Serialization is pretty straight
forward; either it is serializable and you get no errors or it isn't
serializable and you get errors.  I get no errors.  How is that not the
definition of "perfectly serializable"?  And if removeAttribute() is being
called, why isn't the attributeRemoved() method in my SessionBindingListener
being triggered?  I have println() statements in all methods of my
SessionBindingListener and the only ones I'm seeing are on attributeAdded(). 
You can go ahead and stick to your guns and say that my object is not
serializable (I'm 99.9999% sure it is), but you can't, at the same time, claim
that it is being removed from the session when attributeRemoved() is not being
triggered.... unless there is a bug where the removeAttribute(keys[i]) call is
not notifying listeners of the attributes it is removing.

So, I guess I'll have to investigate some more, but something is wrong here. 
Hopefully we can work together to figure it out.

Jake</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55692</commentid>
    <comment_count>6</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2004-04-13 05:22:22 +0000</bug_when>
    <thetext>You were right, Remy,

After some investigation, I figured out that one of the packages I was using
added a session attribute whose job was to react to cases where it had its
valueUnbound() method called and do some cleanup.  However, it was set as an
anonymous HttpSessionBindingListener which (obviously) doesn't implement
Serializable.  Besides that, the class in which the anonymous class was created
is not serializable and if you do a toString() on the session value that was
created, you get the name of the containing class, so I think the containing
class would have to be serializable here as well.  In any case, the alternative
method would be to just use a SessionListener#sessionDestroyed() method to do
the cleanup.  I think the former method was used because the session is already
destroyed in Jetty by the time sessionDestroyed() is called (I think that's
right?) making cleanup in sessionDestroyed() impossible (That's got to be bad
behavior on Jetty's part, but this needs to work with all containers, hence the
workaround).  Everything worked under Tomcat after I moved to using
sessionDestroyed() to do the cleanup.

However, shouldn't valueUnbound() be called on the non-serializable attribute
value when it is removed from the session HashTable?  Actually, isn't that
exactly what this bug is about?  If so, isn't this bug not really fixed?  At the
very least, some logging should be done to tell me what happening.  I wouldn't
have even have started asking questions here if Tomcat had provided me with some
hint of what it was doing instead of silently removing non-serializable attributes.


Jake</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55695</commentid>
    <comment_count>7</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-04-13 09:44:41 +0000</bug_when>
    <thetext>The sessionDestroyed timing problem is what the 2.3 specification mandated (this
was a mistake obviously), so you cannot have something portable between 2.3 and
2.4 here.

valueUnbound is, as far as I can see, correctly called after the value is no
longer available through getAttribute.

In setAttribute:
        // Replace or add this attribute
        Object unbound = attributes.put(name, value);

        // Call the valueUnbound() method if necessary
        if ((unbound != null) &amp;&amp;
            (unbound instanceof HttpSessionBindingListener)) {
            try {
                ((HttpSessionBindingListener) unbound).valueUnbound
                    (new HttpSessionBindingEvent(this, name));
            } catch (Throwable t) {
                log(sm.getString("standardSession.bindingEvent"), t);
            }
        }

In removeAttribute:
        // Remove this attribute from our collection
        Object value = attributes.remove(name);

        // Do we need to do valueUnbound() and attributeRemoved() notification?
        if (!notify || (value == null)) {
            return;
        }

        // Call the valueUnbound() method if necessary
        HttpSessionBindingEvent event = null;
        if (value instanceof HttpSessionBindingListener) {
            event = new HttpSessionBindingEvent(this, name, value);
            ((HttpSessionBindingListener) value).valueUnbound(event);
        }

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55733</commentid>
    <comment_count>8</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2004-04-14 05:50:17 +0000</bug_when>
    <thetext>Hi Remy,

You are right.  valueUnbound() *is* being called.  The problem is, my registered
SessionAttributeListener isn't being called (and yes, it is registered.  I get
println() output from attributeAdded()).  I added some println() statements to
StandardSession to see what was going on and I found something weird; The
listeners[] array is null.

Here's my debugging output...

Apr 14, 2004 12:23:48 AM org.apache.catalina.core.StandardContext reload
INFO: Reloading this Context has started
JRK... key being removed: KILLER_HELPER
JRK... instance of HttpSessionBindingListener? true
ServletContainerListener.valueUnbound() called!
JRK... listeners are: null
Apr 14, 2004 12:23:48 AM org.apache.catalina.logger.LoggerBase stop
INFO: unregistering logger Catalina:type=Logger,path=/picoservlet,host=localhost


So, it makes sense that I wasn't seeing the println() statements in my
attributeRemoved() method since the following code in
StandardSession.removeAttributeInternal() can't find the listeners...

    Context context = (Context) manager.getContainer();
    Object listeners[] = context.getApplicationEventListeners();


Here's a patch showing where I added the debugging lines resulting in the above
output...

Index: catalina/src/share/org/apache/catalina/session/StandardSession.java
===================================================================
RCS file:
/home/cvspublic/jakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/session/StandardSession.java,v
retrieving revision 1.43
diff -u -r1.43 StandardSession.java
--- catalina/src/share/org/apache/catalina/session/StandardSession.java	1 Apr
2004 20:18:15 -0000	1.43
+++ catalina/src/share/org/apache/catalina/session/StandardSession.java	14 Apr
2004 05:26:23 -0000
@@ -1398,6 +1398,8 @@
                 saveNames.add(keys[i]);
                 saveValues.add(value);
             } else {
+                System.out.println("JRK... key being removed: " + keys[i]);
+                System.out.println("JRK... instance of
HttpSessionBindingListener? " + (value instanceof HttpSessionBindingListener));
                 removeAttribute(keys[i]);
             }
         }
@@ -1568,6 +1570,7 @@
         // Notify interested application event listeners
         Context context = (Context) manager.getContainer();
         Object listeners[] = context.getApplicationEventListeners();
+        System.out.println("JRK... listeners are: " + listeners);
         if (listeners == null)
             return;
         for (int i = 0; i &lt; listeners.length; i++) {


This is a valid bug, no?

Jake</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55873</commentid>
    <comment_count>9</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2004-04-16 01:48:31 +0000</bug_when>
    <thetext>Just to be clear, the listeners are null only when Tomcat is removing
non-serializable attributes.  Listeners exist (as they should) when attributes
are removed during normal session expiration.  And valueUnbound() always works
just fine.  So, the bug here is to make sure HttpSessionAttributeListeners get
called in cases where the attribue is being removed because the attribute's
value isn't serializable.

Jake</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56015</commentid>
    <comment_count>10</comment_count>
    <who name="Marc Baumgartner">moewe</who>
    <bug_when>2004-04-19 12:22:22 +0000</bug_when>
    <thetext>I think Jacob is right cause I have a similiar problem:

Using Tomcat 5.0.19 I call the function invalidate() to destroy the session. 
There is a Listener but the method valueUnbound() is not called.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56352</commentid>
    <comment_count>11</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-04-25 10:39:36 +0000</bug_when>
    <thetext>I committed a change which may fix this. Either this fixes it or it will not be
fixed since (unless you submit a tested patch) I don't see the issue as very
important.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56500</commentid>
    <comment_count>12</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2004-04-27 18:08:08 +0000</bug_when>
    <thetext>Thanks Remy, that sovled the issue!  The listeners are no longer null so the
attributeRemoved() method of my HttpSessionAttributeListener is now successfully
called as expected.

Jake</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>18535</bug_id>
          
          <creation_ts>2003-03-31 22:11:00 +0000</creation_ts>
          <short_desc>Jasper is not generating a translation error if jsp:text contains subelements.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>34200</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-03-31 22:11:34 +0000</bug_when>
    <thetext>Given the following JSP Document:
------------------------------------------
&lt;root xmlns:jsp="http://java.sun.com/JSP/Page&gt;
    &lt;jsp:text&gt;
        &lt;jsp:scriptlet&gt;&lt;![CDATA[out.println("Hello")]]&gt;&lt;/jsp:scriptlet&gt;
    &lt;/jsp:text&gt;
&lt;/root&gt;
------------------------------------------

"Hello" is incorrectly returned to the client.

However, it should be noted that a JSP in standard syntax with a jsp:text
element having a child element of some type does behave as expected.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>18639</bug_id>
          
          <creation_ts>2003-04-03 04:54:00 +0000</creation_ts>
          <short_desc>Manager webapp not working.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Administration</component>
          <version>5.0.0</version>
          <rep_platform>Sun</rep_platform>
          <op_sys>Solaris</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Rajiv Mordani">rajiv.mordani</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>34397</commentid>
    <comment_count>0</comment_count>
    <who name="Rajiv Mordani">rajiv.mordani</who>
    <bug_when>2003-04-03 04:54:18 +0000</bug_when>
    <thetext>When accessing the manager webapp with tomcat 5 as of last night's build I get
the following stack trace and I can't use the manager webapp at all - 
INFO: Marking servlet Manager as unavailable
Apr 2, 2003 4:43:17 PM org.apache.catalina.core.StandardWrapperValve invoke
SEVERE: Allocate exception for servlet Manager
javax.servlet.ServletException: Error instantiating servlet class 
org.apache.catalina.manager.ManagerServlet
    at 
org.apache.catalina.core.StandardWrapper.loadServlet(StandardWrapper.java:995)
    at 
org.apache.catalina.core.StandardWrapper.allocate(StandardWrapper.java:696)
    at 
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:1
93)
    at 
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.ja
va:151)
    at 
org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:552)
    at 
org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1017)
    at 
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:1
96)
    at 
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.ja
va:151)
    at 
org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.jav
a:558)
    at 
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.ja
va:149)
    at 
org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:552)
    at 
org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1017)
    at 
org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2667)
    at 
org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)
    at 
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.ja
va:151)
    at 
org.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java
:171)
    at 
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.ja
va:149)
    at 
org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:172)
    at 
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.ja
va:149)
    at 
org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:552)
    at 
org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1017)
    at 
org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:163
)
    at 
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.ja
va:151)
    at 
org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:512)
    at 
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.ja
va:149)
    at 
org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:552)
    at 
org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1017)
    at 
org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:196)
    at 
org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:630)
    at 
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio
n(Http11Protocol.java:430)
    at 
org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:568)
    at 
org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:62
3)
    at java.lang.Thread.run(Thread.java:536)
-------------%&lt;-----------------------------------------------------------------
--------------</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>34653</commentid>
    <comment_count>1</comment_count>
    <who name="Amy Roh">amyroh</who>
    <bug_when>2003-04-07 23:01:34 +0000</bug_when>
    <thetext>This should be fixed with reloading fix.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>19031</bug_id>
          
          <creation_ts>2003-04-15 14:37:00 +0000</creation_ts>
          <short_desc>Failure in processing TLD files in JAR files included with web application</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>35186</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-04-15 14:37:09 +0000</bug_when>
    <thetext>The following exception is raised when trying to use tag libraries packaged as
JAR files in the web application:

org.apache.jasper.JasperException: Unable to read TLD "META-INF/tlds/multi2.tld"
from JAR file "jndi:/localhost/jsp_tldres_web/WEB-INF/lib/multitaglib.jar":
java.lang.IllegalStateException: zip file closed

the JAR file has two TLDs in the JAR file.  One is in META-INF, and the other is
in META-INF/tlds.

This seems to be a regression in behavior as this worked with previous builds.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>35189</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-04-15 15:01:35 +0000</bug_when>
    <thetext>I made a change for something I saw in TldLocCache, and which looked bad. This 
may cause that problem (however, IMO a) the code looks like a workaround for a 
JDK bug b) that spec feature is bad).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>35191</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-04-15 15:03:12 +0000</bug_when>
    <thetext>*** Bug 19032 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>35266</commentid>
    <comment_count>3</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2003-04-15 21:43:01 +0000</bug_when>
    <thetext>Now that JAR files are closed in the TagLibraryInfoImpl constructor's finally,
we must instruct JarURLConnection not to cache them, that is, disable caching.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>19032</bug_id>
          
          <creation_ts>2003-04-15 14:39:00 +0000</creation_ts>
          <short_desc>MalformedURLException returned by Jasper when attempting to process a tag library packaged in JSP 1.1 fashion.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>35187</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-04-15 14:39:34 +0000</bug_when>
    <thetext>Jasper throws the following:

Unable to read TLD "META-INF/taglib.tld" from JAR file
"/WEB-INF/lib/jsp11taglib.jar": java.net.MalformedURLException: invalid url:
/WEB-INF/lib/jsp11taglib.jar!/ (java.net.MalformedURLException: no protocol:
/WEB-INF/lib/jsp11taglib.jar)


The JAR file contains a single TLD (taglib.tld) in the META-INF directory.

This functionality worked in previous builds.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>35190</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-04-15 15:03:11 +0000</bug_when>
    <thetext>I strongly feel it's the same bug as your other.

*** This bug has been marked as a duplicate of 19031 ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>35260</commentid>
    <comment_count>2</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2003-04-15 19:55:23 +0000</bug_when>
    <thetext>This bug is distinct from 19031, not a duplicate.
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>19071</bug_id>
          
          <creation_ts>2003-04-16 15:00:00 +0000</creation_ts>
          <short_desc>IllegalStateException thrown when attepting to access Tag files packaged in JAR file.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>35328</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-04-16 15:00:51 +0000</bug_when>
    <thetext>The following Exception and Stacktrace is raised when attempting to access Tag
files packaged in a JAR:

----------------------------------------------------------
&lt;/pre&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;root cause&lt;/b&gt; &lt;pre&gt;java.lang.IllegalStateException: zip file closed
     [java]     at java.util.zip.ZipFile.ensureOpen(ZipFile.java:398)
     [java]     at java.util.zip.ZipFile.getEntry(ZipFile.java:145)
     [java]     at java.util.jar.JarFile.getEntry(JarFile.java:184)
     [java]     at sun.net.www.protocol.jar.URLJarFile.getEntry(URLJarFile.java:89)
     [java]     at
org.apache.jasper.compiler.JspUtil.getInputStream(JspUtil.java:857)
     [java]     at
org.apache.jasper.xmlparser.XercesEncodingDetector.getEncodingMethod(XercesEncodingDetector.java:160)
     [java]     at
org.apache.jasper.xmlparser.XMLEncodingDetector.getEncoding(XMLEncodingDetector.java:99)
     [java]     at
org.apache.jasper.compiler.ParserController.determineSyntaxAndEncoding(ParserController.java:349)
     [java]     at
org.apache.jasper.compiler.ParserController.parse(ParserController.java:195)
     [java]     at
org.apache.jasper.compiler.ParserController.parse(ParserController.java:150)
     [java]     at
org.apache.jasper.compiler.ParserController.parse(ParserController.java:137)
     [java]     at
org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:246)
---------------------------------------------------------------------------</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>19076</bug_id>
          
          <creation_ts>2003-04-16 15:50:00 +0000</creation_ts>
          <short_desc>Severe Exception while processing Filter</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlet &amp; JSP API</component>
          <version>Nightly Build</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Lenny Karpel">lkarpel</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>35349</commentid>
    <comment_count>0</comment_count>
    <who name="Lenny Karpel">lkarpel</who>
    <bug_when>2003-04-16 15:50:17 +0000</bug_when>
    <thetext>I am attempting to run the most recent nightly of Tomcat 5 .. when using a 
filter I get the following exception:

--------------------------

Apr 15, 2003 11:25:26 AM org.apache.catalina.core.ApplicationDispatcher 
doForward
SEVERE: Shouldn't happen - old code
java.lang.Throwable
        at org.apache.catalina.core.ApplicationDispatcher.doForward
(ApplicationDispatcher.java:464)
        at org.apache.catalina.core.ApplicationDispatcher.forward
(ApplicationDispatcher.java:361)
        at com.eloquent.ecs.ERequest.forward(ERequest.java:3659)
        at com.eloquent.ecs.ERequest.service(ERequest.java:1499)
        at com.eloquent.ecs.EServlet.doService(EServlet.java:381)
        at com.eloquent.ecs.EServlet.doGet(EServlet.java:344)
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:740)
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter
(ApplicationFilterChain.java:288)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter
(ApplicationFilterChain.java:206)
        at com.eloquent.ecs.filters.ECompressionFilter.doFilter
(ECompressionFilter.java:88)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter
(ApplicationFilterChain.java:235)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter
(ApplicationFilterChain.java:206)
        at org.apache.catalina.core.StandardWrapperValve.invoke
(StandardWrapperValve.java:263)
        at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
        at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:552)
        at org.apache.catalina.core.ContainerBase.invoke
(ContainerBase.java:1017)
        at org.apache.catalina.core.StandardContextValve.invoke
(StandardContextValve.java:196)
        at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
        at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:552)
        at org.apache.catalina.core.ContainerBase.invoke
(ContainerBase.java:1017)
        at org.apache.catalina.core.StandardContext.invoke
(StandardContext.java:2698)
        at org.apache.catalina.core.StandardHostValve.invoke
(StandardHostValve.java:186)
        at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
        at org.apache.catalina.valves.ErrorDispatcherValve.invoke
(ErrorDispatcherValve.java:171)
        at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:149)
        at org.apache.catalina.valves.ErrorReportValve.invoke
(ErrorReportValve.java:172)
        at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:149)
        at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:552)
        at org.apache.catalina.core.ContainerBase.invoke
(ContainerBase.java:1017)
        at org.apache.catalina.core.StandardEngineValve.invoke
(StandardEngineValve.java:163)
        at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
        at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:552)
        at org.apache.catalina.core.ContainerBase.invoke
(ContainerBase.java:1017)
        at org.apache.coyote.tomcat5.CoyoteAdapter.service
(CoyoteAdapter.java:199)
        at org.apache.coyote.http11.Http11Processor.process
(Http11Processor.java:630)
        at 
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio
n(Http11Protocol.java:463)
        at org.apache.tomcat.util.net.TcpWorkerThread.runIt
(PoolTcpEndpoint.java:568)
        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run
(ThreadPool.java:631)
        at java.lang.Thread.run(Thread.java:534)

----------------------------

my filter (a variant of the example compression filter) wraps the current 
servlet request in an class that extends HttpServletResponseWrapper .. for 
example:

     public class ECompressionServletResponseWrapper extends 
HttpServletResponseWrapper

the code in org.apache.catalina.core.ApplicationDispatcher.doForward makes a 
check to make sure the response is an instance of:

    org.apache.catalina.connector.ResponseFacade

could that possibly be correct ?

Len</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>35432</commentid>
    <comment_count>1</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2003-04-17 15:34:29 +0000</bug_when>
    <thetext>Fixed. The exception should no longer be displayed. Let me know if the
functionality is still not working.

Thanks,

-- Jeanfrancois</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>19093</bug_id>
          
          <creation_ts>2003-04-16 20:57:00 +0000</creation_ts>
          <short_desc>IllegalStateException thown during SMAP generation</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>35380</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-04-16 20:57:49 +0000</bug_when>
    <thetext>The issues seems to surface when a JSP contains only a directive.

Stacktrace below
----------------------------------------
/pre&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;root cause&lt;/b&gt; &lt;pre&gt;java.lang.IllegalStateException
     [java]     at
org.apache.jasper.compiler.SmapStratum.getString(SmapStratum.java:272)
     [java]     at
org.apache.jasper.compiler.SmapGenerator.getString(SmapGenerator.java:173)
     [java]     at
org.apache.jasper.compiler.SmapUtil.generateSmap(SmapUtil.java:141)
     [java]     at
org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:302)
     [java]     at org.apache.jasper.compiler.Compiler.compile(Compiler.java:452)
     [java]     at org.apache.jasper.compiler.Compiler.compile(Compiler.java:438)
------------------------------------------------------------------</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>35381</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-04-16 21:54:59 +0000</bug_when>
    <thetext>The problem comes when there is no debug line info for the JSP.  The generation
of the SMAP is suppressed in this case.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>19117</bug_id>
          
          <creation_ts>2003-04-17 16:52:00 +0000</creation_ts>
          <short_desc>Translation error not being raised by Jasper if a JSP document has mismatched encodings specified in the XML prolog and the pageEncoding attribute of the page directive</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Lubke">Ryan.Lubke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>35446</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Lubke">Ryan.Lubke</who>
    <bug_when>2003-04-17 16:52:37 +0000</bug_when>
    <thetext>JSP.4.1 states a translation error must occur of the encoding specified by the
XML prolog and the encoding specified by the pageEncoding attribute of the page
directive do not match.

This worked in the previous nightly build, but is now failing.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>19196</bug_id>
          
          <creation_ts>2003-04-21 17:58:00 +0000</creation_ts>
          <short_desc>Tomcat throws SSLPeerUnverifiedException when I invoke request using HTTPS.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:HTTP</component>
          <version>5.0.0</version>
          <rep_platform>Sun</rep_platform>
          <op_sys>Solaris</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Krishna Meduri">krishna.meduri</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>krishna.meduri</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>35712</commentid>
    <comment_count>0</comment_count>
    <who name="Krishna Meduri">krishna.meduri</who>
    <bug_when>2003-04-21 17:58:26 +0000</bug_when>
    <thetext>Tomcat throws the following exception on the server console when I invoke
request using HTTPS:

WARNING: Exception getting SSL attributes 
javax.net.ssl.SSLPeerUnverifiedException: peer not authenticated
        at
com.sun.net.ssl.internal.ssl.SSLSessionImpl.getPeerCertificateChain(DashoA6275)
        at
org.apache.tomcat.util.net.jsse.JSSESupport.getX509Certificates(JSSESupport.java:113)
        at
org.apache.tomcat.util.net.jsse.JSSESupport.getPeerCertificateChain(JSSESupport.java:161)
        at org.apache.coyote.http11.Http11Processor.action(Http11Processor.java:777)
        at org.apache.coyote.Response.action(Response.java:225)
        at
org.apache.coyote.tomcat5.CoyoteAdapter.postParseRequest(CoyoteAdapter.java:273)
        at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:197)
        at
org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:630)
        at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:463)
        at
org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:568)
        at
org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:631)
        at java.lang.Thread.run(Thread.java:536)

-----------------------------------------------------------------------------

when I run my SSL based test, it throws this exception. A request to
https://localhost:8443/index.html also throws this exception.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>35714</commentid>
    <comment_count>1</comment_count>
    <who name="">william.barker</who>
    <bug_when>2003-04-21 18:09:10 +0000</bug_when>
    <thetext>Please check the nightly before submitting reports for 5.0.</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>19219</bug_id>
          
          <creation_ts>2003-04-22 15:16:00 +0000</creation_ts>
          <short_desc>Exception from java.util.zip.ZipFile after reloading an application</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>PC</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Petr Jiricka">petr.jiricka</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>radim.kubacki</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>35797</commentid>
    <comment_count>0</comment_count>
    <who name="Petr Jiricka">petr.jiricka</who>
    <bug_when>2003-04-22 15:16:48 +0000</bug_when>
    <thetext>I am getting the following exception after after reloading an application which
uses tag libraries. I am using Tomcat 5.0 nightly build 20030421 with JDK 1.4.2
beta (I believe this will be reproducible on 1.4.1 as well, though).

I am attaching only the root cause, not the ServletException which wraps it.
Steps to reproduce are below.


java.lang.InternalError: jzentry == 0,
 jzfile = 406263984,
 total = 4,
 name = E:\software\tomcat50nightly\webapps\taglibtest\WEB-INF\lib\Test1.jar,
 i = 3,
 message = invalid LOC header (bad signature)
	at java.util.zip.ZipFile$2.nextElement(ZipFile.java:321)
	at java.util.jar.JarFile$1.nextElement(JarFile.java:211)
	at
org.apache.jasper.compiler.TldLocationsCache.processTldsInJar(TldLocationsCache.java:320)
	at
org.apache.jasper.compiler.TldLocationsCache.processTldsInGlobalJars(TldLocationsCache.java:455)
	at org.apache.jasper.compiler.TldLocationsCache.init(TldLocationsCache.java:215)
	at
org.apache.jasper.compiler.TldLocationsCache.getLocation(TldLocationsCache.java:188)
	at
org.apache.jasper.JspCompilationContext.getTldLocation(JspCompilationContext.java:557)
	at org.apache.jasper.compiler.Parser.parseTaglibDirective(Parser.java:452)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:514)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1562)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:171)
	at org.apache.jasper.compiler.ParserController.parse(ParserController.java:248)
	at org.apache.jasper.compiler.ParserController.parse(ParserController.java:150)
	at org.apache.jasper.compiler.ParserController.parse(ParserController.java:137)
	at org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:250)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:458)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:444)
	at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:593)
	at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:300)
	at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:293)
	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)
	at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:288)
	at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:263)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:552)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1017)
	at
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:196)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:552)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1017)
	at org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2708)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:186)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at
org.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:171)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:172)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:552)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1017)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:163)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:552)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1017)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:199)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:630)
	at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:463)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:568)
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:631)
	at java.lang.Thread.run(Thread.java:534)


The scenario in which this occurs is basically the following:
1. Create a web application with a tag library and a JSP which uses this taglib
2. Run the application in Tomcat (put it to e.g. webapps/taglibtest) and run the JSP
3. Add a tag to the tag library, use this new tag in the JSP and copy it over to
Tomcat again
4. Reload the application using the manager application:
http://localhost:8080/manager/reload?path=/taglibtest
5. Run the JSP again
This is basically a consequence of JDK bug 4425695/4843994:

http://developer.java.sun.com/developer/bugParade/bugs/4843994.html
http://developer.java.sun.com/developer/bugParade/bugs/4425695.html

I believe it could be fixed by not caching the JarURLConnection in
TldLocationsCache.processTldsInJar(...) by setting connection.setUseCaches(false).

I am attaching two versions of the web module I tested this with, and steps to
reproduce with these:

1. Unzip wm1.zip to webapps/taglibtest
2. Start Tomcat
3. Run http://localhost:8080/taglibtest/UsesTestTL.jsp
4. Unzip wm2.zip to webapps/taglibtest
5. "Touch" the UsesTestTL.jsp file, so Jasper reloads it
6. Reload the application using
http://localhost:8080/manager/reload?path=/taglibtest
7. Run http://localhost:8080/taglibtest/UsesTestTL.jsp again
The exception is displayed in the browser.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>35798</commentid>
    <comment_count>1</comment_count>
      <attachid>5953</attachid>
    <who name="Petr Jiricka">petr.jiricka</who>
    <bug_when>2003-04-22 15:18:02 +0000</bug_when>
    <thetext>Created attachment 5953
The first version of the test web module</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>35799</commentid>
    <comment_count>2</comment_count>
      <attachid>5954</attachid>
    <who name="Petr Jiricka">petr.jiricka</who>
    <bug_when>2003-04-22 15:18:35 +0000</bug_when>
    <thetext>Created attachment 5954
The second version of the test web module</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39395</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-06-25 08:25:09 +0000</bug_when>
    <thetext>Many file locking issues were fixed, and this should make this kind of webapp
update scenario work a lot better.

However, I don't see how the scenario you describe could work reliably (on
Windows, the JAR could be locked if you try to ovewrite it while the webapp is
running). IMO, you should do:
- stop webapp
- update it
- start webapp
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39401</commentid>
    <comment_count>4</comment_count>
    <who name="Petr Jiricka">petr.jiricka</who>
    <bug_when>2003-06-25 09:52:53 +0000</bug_when>
    <thetext>Remy, thanks for all the fixes.

As for whether this scenario can or can not work - I agree it won't work in 100%
of cases. However documentation:

http://jakarta.apache.org/tomcat/tomcat-5.0-doc/appdev/source.html
http://jakarta.apache.org/tomcat/tomcat-5.0-doc/appdev/processes.html

seems to suggest that you should be doing 'compile' and then 'reload'. So do we
want to change the documentation to recommend doing 'undeploy', then 'compile'
and then 'deploy' ?

What should Tomcat recommend to the users so development works reliably and
correctly for them ?</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>5953</attachid>
            <date>2003-04-22 15:18:00 +0000</date>
            <delta_ts>2003-04-22 15:18:02 +0000</delta_ts>
            <desc>The first version of the test web module</desc>
            <filename>wm1.zip</filename>
            <type>application/octet-stream</type>
            <size>3110</size>
            <attacher name="Petr Jiricka">petr.jiricka</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>5954</attachid>
            <date>2003-04-22 15:18:00 +0000</date>
            <delta_ts>2003-04-22 15:18:35 +0000</delta_ts>
            <desc>The second version of the test web module</desc>
            <filename>wm2.zip</filename>
            <type>application/octet-stream</type>
            <size>4279</size>
            <attacher name="Petr Jiricka">petr.jiricka</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>19240</bug_id>
          
          <creation_ts>2003-04-23 00:33:00 +0000</creation_ts>
          <short_desc>Exception - too many files open on mac osx 10.2.5</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>Macintosh</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>blocker</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Rajiv Mordani">rajiv.mordani</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>35839</commentid>
    <comment_count>0</comment_count>
    <who name="Rajiv Mordani">rajiv.mordani</who>
    <bug_when>2003-04-23 00:33:33 +0000</bug_when>
    <thetext>Apr 22, 2003 5:21:50 PM org.apache.catalina.startup.TldConfig tldScanJar
SEVERE: Exception processing JAR at resource path
jndi:/localhost/jstl-examples/WEB-INF/lib/jsp-api.jar in context /jstl-examples
java.io.IOException: Too many open files
        at java.io.UnixFileSystem.createFileExclusively(Native Method)
        at java.io.File.checkAndCreate(File.java:1313)
        at java.io.File.createTempFile(File.java:1401)
        at java.io.File.createTempFile(File.java:1438)
        at sun.net.www.protocol.jar.URLJarFile$1.run(URLJarFile.java:169)
        at java.security.AccessController.doPrivileged(Native Method)
        at sun.net.www.protocol.jar.URLJarFile.retrieve(URLJarFile.java:164)
        at sun.net.www.protocol.jar.URLJarFile.getJarFile(URLJarFile.java:42)
        at sun.net.www.protocol.jar.JarFileFactory.get(JarFileFactory.java:78)
        at
sun.net.www.protocol.jar.JarURLConnection.connect(JarURLConnection.java:85)
        at
sun.net.www.protocol.jar.JarURLConnection.getJarFile(JarURLConnection.java:69)
        at org.apache.catalina.startup.TldConfig.tldScanJar(TldConfig.java:467)
        at org.apache.catalina.startup.TldConfig.tldScanJar(TldConfig.java:449)
        at org.apache.catalina.startup.TldConfig.execute(TldConfig.java:228)
        at org.apache.catalina.core.StandardContext.start(StandardContext.java:4018)
        at
org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:842)
        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:826)
        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:623)
        at
org.apache.catalina.core.StandardHostDeployer.addChild(StandardHostDeployer.java:804)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at
org.apache.commons.beanutils.MethodUtils.invokeMethod(MethodUtils.java:252)
        at org.apache.commons.digester.SetNextRule.end(SetNextRule.java:260)
        at org.apache.commons.digester.Rule.end(Rule.java:276)
        at org.apache.commons.digester.Digester.endElement(Digester.java:1064)
        at
org.apache.xerces.parsers.AbstractSAXParser.endElement(AbstractSAXParser.java:546)
        at
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanEndElement(XMLDocumentFragmentScannerImpl.java:1073)
        at
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(XMLDocumentFragmentScannerImpl.java:1535)
        at
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:348)
        at
org.apache.xerces.parsers.DTDConfiguration.parse(DTDConfiguration.java:539)
        at
org.apache.xerces.parsers.DTDConfiguration.parse(DTDConfiguration.java:595)
        at org.apache.xerces.parsers.XMLParser.parse(XMLParser.java:152)
        at
org.apache.xerces.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1125)
        at org.apache.commons.digester.Digester.parse(Digester.java:1562)
        at
org.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:488)
        at org.apache.catalina.core.StandardHost.install(StandardHost.java:868)
        at
org.apache.catalina.startup.HostConfig.deployDescriptors(HostConfig.java:511)
        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:468)
        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:835)
        at
org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:429)
        at
org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1240)
        at org.apache.catalina.core.StandardHost.start(StandardHost.java:804)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1232)
        at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:520)
        at org.apache.catalina.core.StandardService.start(StandardService.java:519)
        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2313)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:572)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at org.apache.commons.launcher.ChildMain.run(ChildMain.java:269)
Apr 22, 2003 5:21:50 PM org.apache.catalina.startup.TldConfig tldScanJar
SEVERE: Exception processing JAR at resource path
jndi:/localhost/jstl-examples/WEB-INF/lib/xalan.jar in context /jstl-examples
java.io.IOException: Too many open files
        at java.io.UnixFileSystem.createFileExclusively(Native Method)
        at java.io.File.checkAndCreate(File.java:1313)
        at java.io.File.createTempFile(File.java:1401)
        at java.io.File.createTempFile(File.java:1438)
        at sun.net.www.protocol.jar.URLJarFile$1.run(URLJarFile.java:169)
        at java.security.AccessController.doPrivileged(Native Method)
        at sun.net.www.protocol.jar.URLJarFile.retrieve(URLJarFile.java:164)
        at sun.net.www.protocol.jar.URLJarFile.getJarFile(URLJarFile.java:42)
        at sun.net.www.protocol.jar.JarFileFactory.get(JarFileFactory.java:78)
        at
sun.net.www.protocol.jar.JarURLConnection.connect(JarURLConnection.java:85)
        at
sun.net.www.protocol.jar.JarURLConnection.getJarFile(JarURLConnection.java:69)
        at org.apache.catalina.startup.TldConfig.tldScanJar(TldConfig.java:467)
        at org.apache.catalina.startup.TldConfig.tldScanJar(TldConfig.java:449)
        at org.apache.catalina.startup.TldConfig.execute(TldConfig.java:228)
        at org.apache.catalina.core.StandardContext.start(StandardContext.java:4018)
        at
org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:842)
        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:826)
        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:623)
        at
org.apache.catalina.core.StandardHostDeployer.addChild(StandardHostDeployer.java:804)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at
org.apache.commons.beanutils.MethodUtils.invokeMethod(MethodUtils.java:252)
        at org.apache.commons.digester.SetNextRule.end(SetNextRule.java:260)
        at org.apache.commons.digester.Rule.end(Rule.java:276)
        at org.apache.commons.digester.Digester.endElement(Digester.java:1064)
        at
org.apache.xerces.parsers.AbstractSAXParser.endElement(AbstractSAXParser.java:546)
        at
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanEndElement(XMLDocumentFragmentScannerImpl.java:1073)
        at
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(XMLDocumentFragmentScannerImpl.java:1535)
        at
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:348)
        at
org.apache.xerces.parsers.DTDConfiguration.parse(DTDConfiguration.java:539)
        at
org.apache.xerces.parsers.DTDConfiguration.parse(DTDConfiguration.java:595)
        at org.apache.xerces.parsers.XMLParser.parse(XMLParser.java:152)
        at
org.apache.xerces.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1125)
        at org.apache.commons.digester.Digester.parse(Digester.java:1562)
        at
org.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:488)
        at org.apache.catalina.core.StandardHost.install(StandardHost.java:868)
        at
org.apache.catalina.startup.HostConfig.deployDescriptors(HostConfig.java:511)
        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:468)
        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:835)
        at
org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:429)
        at
org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1240)
        at org.apache.catalina.core.StandardHost.start(StandardHost.java:804)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1232)
        at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:520)
        at org.apache.catalina.core.StandardService.start(StandardService.java:519)
        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2313)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:572)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at org.apache.commons.launcher.ChildMain.run(ChildMain.java:269)
Apr 22, 2003 5:21:50 PM org.apache.catalina.startup.TldConfig tldScanJar</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>19265</bug_id>
          
          <creation_ts>2003-04-24 06:35:00 +0000</creation_ts>
          <short_desc>Server dies when I try to access a webapp.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>Sun</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>blocker</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Rajiv Mordani">rajiv.mordani</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>35949</commentid>
    <comment_count>0</comment_count>
    <who name="Rajiv Mordani">rajiv.mordani</who>
    <bug_when>2003-04-24 06:35:49 +0000</bug_when>
    <thetext>When I deploy a webapp and start the server and try to access any webapp the
server dies with the following exception - 

INFO: Starting Coyote HTTP/1.1 on port 8080
java.lang.NegativeArraySizeException
        at
org.apache.naming.resources.ProxyDirContext.cacheUnload(ProxyDirContext.java:1690)
        at
org.apache.naming.resources.ProxyDirContext.cacheLookup(ProxyDirContext.java:1511)
        at
org.apache.naming.resources.ProxyDirContext.getAttributes(ProxyDirContext.java:921)
        at
org.apache.catalina.startup.HostConfig.checkContextLastModified(HostConfig.java:672)
        at org.apache.catalina.startup.HostConfig.run(HostConfig.java:971)
        at java.lang.Thread.run(Thread.java:536)</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>19269</bug_id>
          
          <creation_ts>2003-04-24 08:15:00 +0000</creation_ts>
          <short_desc>procrun, ant fork, JSP compilation failure</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.1</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Marc Lehmann">marc.lehmann</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>35959</commentid>
    <comment_count>0</comment_count>
    <who name="Marc Lehmann">marc.lehmann</who>
    <bug_when>2003-04-24 08:15:45 +0000</bug_when>
    <thetext>Tomcat component: procrun
JVM: 1.4.2 beta (JAVA_HOME set appropriately)

Tomcat fails to compile JSP pages when started via "tomcatw.exe //GT//Tomcat5". 
However, everything works fine if fork is set to false in web.xml.

Tomcat started via startup.bat or Tomcat run as service 
via "tomcat.exe //RS//Tomcat5" doesn't cause any JSP compilation problems with 
fork being set to true.

2003-04-23 23:31:58 StandardWrapperValve[jsp]: Servlet.service() for servlet 
jsp threw exception
org.apache.jasper.JasperException: Unable to compile class for JSP

An error occurred at line: -1 in the jsp file: null

Generated servlet error:
    [javac] Since fork is true, ignoring compiler setting.
    [javac] Compiling 1 source file
    [javac] Since fork is true, ignoring compiler setting.



	at org.apache.jasper.compiler.DefaultErrorHandler.javacError
(DefaultErrorHandler.java:120)
	at org.apache.jasper.compiler.ErrorDispatcher.javacError
(ErrorDispatcher.java:307)
	at org.apache.jasper.compiler.Compiler.generateClass(Compiler.java:410)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:450)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:434)
	at org.apache.jasper.JspCompilationContext.compile
(JspCompilationContext.java:571)
	at org.apache.jasper.servlet.JspServletWrapper.service
(JspServletWrapper.java:303)
	at org.apache.jasper.servlet.JspServlet.serviceJspFile
(JspServlet.java:293)
	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter
(ApplicationFilterChain.java:288)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter
(ApplicationFilterChain.java:206)
	at org.apache.catalina.core.StandardWrapperValve.invoke
(StandardWrapperValve.java:294)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:490)
	at org.apache.catalina.core.ContainerBase.invoke
(ContainerBase.java:1020)
	at org.apache.catalina.core.StandardContextValve.invoke
(StandardContextValve.java:196)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:490)
	at org.apache.catalina.core.ContainerBase.invoke
(ContainerBase.java:1020)
	at org.apache.catalina.core.StandardContext.invoke
(StandardContext.java:2625)
	at org.apache.catalina.core.StandardHostValve.invoke
(StandardHostValve.java:180)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.valves.ErrorDispatcherValve.invoke
(ErrorDispatcherValve.java:171)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:149)
	at org.apache.catalina.valves.ErrorReportValve.invoke
(ErrorReportValve.java:172)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:149)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:490)
	at org.apache.catalina.core.ContainerBase.invoke
(ContainerBase.java:1020)
	at org.apache.catalina.core.StandardEngineValve.invoke
(StandardEngineValve.java:163)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:490)
	at org.apache.catalina.core.ContainerBase.invoke
(ContainerBase.java:1020)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service
(CoyoteAdapter.java:196)
	at org.apache.coyote.http11.Http11Processor.process
(Http11Processor.java:612)
	at 
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio
n(Http11Protocol.java:430)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt
(PoolTcpEndpoint.java:565)
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run
(ThreadPool.java:623)
	at java.lang.Thread.run(Unknown Source)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>36429</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-04-30 23:45:06 +0000</bug_when>
    <thetext>I can reproduce that, but Mladen cannot. Fork is now set to false by default.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>36451</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-05-01 15:06:01 +0000</bug_when>
    <thetext>The cause of the bug has been indentified: the bug occurs when the path to javac
is not in the PATH variable.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>36456</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-05-01 17:59:16 +0000</bug_when>
    <thetext>There's a workaround now implemented in procrun.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>19276</bug_id>
          
          <creation_ts>2003-04-24 15:04:00 +0000</creation_ts>
          <short_desc>Attribute is missing quotes when it contains an EL expression in a document with XML syntax.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Erik Beijnoff">erik</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>35986</commentid>
    <comment_count>0</comment_count>
    <who name="Erik Beijnoff">erik</who>
    <bug_when>2003-04-24 15:04:09 +0000</bug_when>
    <thetext>When an EL expression is used in the value of an attribute in template data, 
the resulting attribute that is output is missing quotes.

I'm using the JSP xml syntax.

This template data:
&lt;a style="border:0px;" href="${ref}"&gt;Link&lt;/a&gt;

Gives this output:
&lt;a style="border:0px;" href=/jsp/projects/common/?skin=default&gt;Link&lt;/a&gt;

Please note that it is only the "href" attribute that's missing quotes. 
The "style" attribute still has them, since it does not contain a EL expression.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>19445</bug_id>
          
          <creation_ts>2003-04-29 22:50:00 +0000</creation_ts>
          <short_desc>tomcat doesn't startup the second time on mac os x 10.2.5</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>Macintosh</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Rajiv Mordani">rajiv.mordani</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>1</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>36340</commentid>
    <comment_count>0</comment_count>
    <who name="Rajiv Mordani">rajiv.mordani</who>
    <bug_when>2003-04-29 22:50:25 +0000</bug_when>
    <thetext>When I install tomcat 5 on mac os x 10.2.5 running jdk 1.4.1_01-14 mixed mode
tomcat comes up the first time. However if I stop the server and restart it then
I get the following exception. The server doesn't stop however I get a "document
 contains no data" error when I try to access any page.
Created Listener
StandardServer.await: create[8005]: java.net.SocketException: Too many open files
java.net.SocketException: Too many open files
        at java.net.ServerSocket.createImpl(ServerSocket.java:245)
        at java.net.ServerSocket.getImpl(ServerSocket.java:203)
        at java.net.ServerSocket.bind(ServerSocket.java:309)
        at java.net.ServerSocket.&lt;init&gt;(ServerSocket.java:183)
        at org.apache.catalina.core.StandardServer.await(StandardServer.java:523)
        at org.apache.catalina.startup.Catalina.await(Catalina.java:625)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:587)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at org.apache.commons.launcher.ChildMain.run(ChildMain.java:269)
java.lang.NullPointerException
        at
org.apache.catalina.startup.HostConfig.deployDescriptors(HostConfig.java:483)
        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:468)
        at org.apache.catalina.startup.HostConfig.run(HostConfig.java:968)
        at java.lang.Thread.run(Thread.java:554)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>37520</commentid>
    <comment_count>1</comment_count>
    <who name="Rajiv Mordani">rajiv.mordani</who>
    <bug_when>2003-05-21 06:59:40 +0000</bug_when>
    <thetext>Note this exception doesn't happen on Mac os only. If you deploy a lot of
wars(about 40 or so) on tomcat 5 then this also happens on solaris 8 and other
platforms as well.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39394</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-06-25 08:16:18 +0000</bug_when>
    <thetext>Tomcat now tries to avoid opening lots of files (without guarantees), and
doesn't leak file descriptor. However, I think this bug is trying to prove that
an OS global shared VM is bad for server environments.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50664</commentid>
    <comment_count>3</comment_count>
    <who name="Jonathan Hess">jonathan</who>
    <bug_when>2004-01-16 20:45:14 +0000</bug_when>
    <thetext>Mac OS X imposes a low limit on the number of open file descriptors a process
may have, specifically 256 by default.  There is no easy way to fix this from
Java, but in the catalina shell script, you should probably add a call to the sh
builtin  ulimit to increase the number of allowed open files. For example:

ulimit -n 1024

This solved the problem in my application and probably would solve the problem
in tomcat.</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>19455</bug_id>
          
          <creation_ts>2003-04-30 00:59:00 +0000</creation_ts>
          <short_desc>session tracking with 'jsessionid' fails when query string parameters present</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Pierre Delisle">pierre.delisle</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>36354</commentid>
    <comment_count>0</comment_count>
    <who name="Pierre Delisle">pierre.delisle</who>
    <bug_when>2003-04-30 00:59:38 +0000</bug_when>
    <thetext>If you try the JSP page included below, (call it test.jsp)
with cookies disabled in your browser, 
you'll get the following links (modulo the context path):

/standard-examples/test.jsp?foo=bar
/standard-examples/test.jsp;jsessionid=2E90D2BBD0180E2D92A9F2EC87E736D9?foo=bar

The first one works fine, the second one gets you to tomcat's default page.
(tested with the nightly of 4-28-2003)
The bug does not exist with tomcat-4.1.24.

---- test.jsp ------
&lt;%
   String context = request.getContextPath();
   String url1 = context + "/test.jsp?foo=bar";
   String url2 = response.encodeURL(url1);
%&gt;

&lt;a href='&lt;%=url1%&gt;'&gt;&lt;%=url1%&gt;&lt;br&gt;
&lt;a href='&lt;%=url2%&gt;'&gt;&lt;%=url2%&gt;&lt;br&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>36360</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-04-30 06:48:40 +0000</bug_when>
    <thetext>This is specific to jsessionid (changing that value to something else won't
work). The code which strips it is very bad anyway, so this will be a good
opportunity to rewrite it efficiently.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>36421</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-04-30 22:51:40 +0000</bug_when>
    <thetext>Monsieur, votre bug a été corrigé.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>19607</bug_id>
          
          <creation_ts>2003-05-02 17:39:00 +0000</creation_ts>
          <short_desc>ant undeploy only stops the Context, but doesn't remove physial files</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Examples</component>
          <version>5.0.3</version>
          <rep_platform>All</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Johannes Fiala">johannes.fiala</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>grenoml</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>36609</commentid>
    <comment_count>0</comment_count>
    <who name="Johannes Fiala">johannes.fiala</who>
    <bug_when>2003-05-02 17:39:00 +0000</bug_when>
    <thetext>CURRENT BEHAVIOUR:
After doing an ant undeploy using the manager app, the manager app acknowledges 
the command with [undeploy] OK.

However, 
*) the /webapps/myapp.xml file doesn't get removed
*) the /work/Standalone/localhost/manager/myapp.WAR and myapp.xml doesn't get 
removed either.

Not having deleted /webapps/myapp.xml causes the application to show up next 
time Tomcat is started.

I also inspected the code, but only found code to stop the app at 
ContainerBase.java, public void removeChild(Container child).

EXPECTED BEHAVIOUR:
The application should be completely removed from the server.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39264</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-06-23 08:45:44 +0000</bug_when>
    <thetext>This is almost fixed in 5.0.3: expanded folders and the WAR will be removed. The
XML will not be removed yet (AFAIK); this will be fixed in 5.0.4.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39301</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-06-23 20:51:19 +0000</bug_when>
    <thetext>This is fixed in CVS, as part of the deployer refactorings.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40657</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-07-14 17:32:02 +0000</bug_when>
    <thetext>*** Bug 21577 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
      

    <bug_classification class="BUILD_SYSTEM">BUILD_SYSTEM</bug_classification></bug>
    <bug>
          <bug_id>19610</bug_id>
          
          <creation_ts>2003-05-02 19:23:00 +0000</creation_ts>
          <short_desc>Tomcat does not support a keystore with multiple keys with different passwords for each key</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.0</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Michael J. Hudson">mike</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>36610</commentid>
    <comment_count>0</comment_count>
    <who name="Michael J. Hudson">mike</who>
    <bug_when>2003-05-02 19:23:35 +0000</bug_when>
    <thetext>Similar to bug 1400 in Tomcat 4.0 bug database...  I strongly disagree with
the "WONT FIX" reason.

I and many others strongly need tomcat to use keystores like they were suppose 
to be used, i.e. have support for keyaliases and a different keypass for each 
key then the password for the actual keystore.   Porting a J2EE web app from 
Weblogic 8 to TomCat/JBoss isn't clean at all... because I have to end up 
creating TWO keystores... one for Tomcat to use to get the SSL
keys... and one for my application to use.

Tomcat should be able to support a keystore with more than one key each key 
differentiated by a keyalias and a seperate keypassword.  Right now, you can 
only have one key... and the alias must be 'tomcat' and the password must be 
the same as the keystore itself.  That is simply not right!

Again refer to bug 1400 for more details</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39457</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">shapira</who>
    <bug_when>2003-06-26 00:54:50 +0000</bug_when>
    <thetext>It seems like the tomcat5 CoyoteServerSocketFactory allows configurable 
keystore file, keystore password, and doesn't have the "tomcat" user hard 
coded.  Am I looking at the wrong place?  Is this bug still relevant?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42583</commentid>
    <comment_count>2</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2003-08-11 22:31:51 +0000</bug_when>
    <thetext>Added "keyAlias" property on CoyoteConnector, which allows specifying the
particular keypair and supporting cert chain to be used by the connector when it
authenticates itself to SSL clients.

Notice that JSSE currently does not support assigning different passwords to
individual keys via its standard APIs. I was told this is being planned for a
future release.
</thetext>
  </long_desc>
      
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>19622</bug_id>
          
          <creation_ts>2003-05-03 09:36:00 +0000</creation_ts>
          <short_desc>Jasper2 has javaEncoding hard coded to UTF-8</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.1</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>http://www.fwd.at/tomcat/build-using-ant-howto.html</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Johannes Fiala">johannes.fiala</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>36621</commentid>
    <comment_count>0</comment_count>
    <who name="Johannes Fiala">johannes.fiala</who>
    <bug_when>2003-05-03 09:36:01 +0000</bug_when>
    <thetext>CURRENT BEHAVIOUR:
Jasper2 has javaEncoding hard coded to UTF-8

DESIRED BEHAVIOUR:
Jasper 2 should allow this parameter to be set using the Jasper2-task 
invocation at build.xml.
Default could still be UTF-8, so no one has to change anything.

I'll attach a suggested patch, maybe other parameters could need soft-coding as 
well (I concentrated on javaEncoding).

Changes:
line 171: String javaEncoding = "UTF-8";

line 319ff:
    /* Patch: allow javaEncoding to be set as ant parameter */
    public String getJavaEncoding() {
	return javaEncoding;
    }

    public void setJavaEncoding(String e) {
     	javaEncoding = e;
    }</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>36622</commentid>
    <comment_count>1</comment_count>
      <attachid>6183</attachid>
    <who name="Johannes Fiala">johannes.fiala</who>
    <bug_when>2003-05-03 09:37:05 +0000</bug_when>
    <thetext>Created attachment 6183
this file contains all the necessary changes, inline docs should maybe be changed (?)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>36623</commentid>
    <comment_count>2</comment_count>
    <who name="Johannes Fiala">johannes.fiala</who>
    <bug_when>2003-05-03 09:47:53 +0000</bug_when>
    <thetext>&lt;p&gt;
Additionally, this makes the usage of Jspc with ant more consistent with the 
Jspc Tomcat compilation, which
allows &lt;code&gt;javaEncoding&lt;/code&gt; to be set in /conf/web.xml: 
&lt;code&gt;
&lt;!--   javaEncoding        Java file encoding to use for generating java  --&gt;
&lt;!--                       source files. [UTF8]                           --&gt;
&lt;/code&gt;

However, there is a small inconsistency in the original source of TC 
4.1.24/5.0.1 compared to /conf/web.xml. 
It is "UTF8" at web.xml, but "UTF-8" at JspC.java. I left this inconsistency, 
as I don't know the reasons.
&lt;/p&gt;
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39460</commentid>
    <comment_count>3</comment_count>
    <who name="Yoav Shapira">shapira</who>
    <bug_when>2003-06-26 01:21:03 +0000</bug_when>
    <thetext>Made javaEncoding configurable per enhancement request.  Default remains at 
UTF-8.  web.xml untouched.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>6183</attachid>
            <date>2003-05-03 09:37:00 +0000</date>
            <delta_ts>2003-05-03 09:37:05 +0000</delta_ts>
            <desc>this file contains all the necessary changes, inline docs should maybe be changed (?)</desc>
            <filename>JspC.java</filename>
            <type>text/plain</type>
            <size>35807</size>
            <attacher name="Johannes Fiala">johannes.fiala</attacher>
            

          </attachment>
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>19713</bug_id>
          
          <creation_ts>2003-05-07 01:01:00 +0000</creation_ts>
          <short_desc>Invalid inline code generated for nested &lt;jsp:forward&gt;</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.2</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Hans Bergsten">hans</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>36794</commentid>
    <comment_count>0</comment_count>
    <who name="Hans Bergsten">hans</who>
    <bug_when>2003-05-07 01:01:44 +0000</bug_when>
    <thetext>When a &lt;jsp:forward&gt; action with &lt;jsp:param&gt; children is nested within the body
of some other action, the generated inline code can't be compiled. The reason is
that the inline code ends up in a generated method where the "request" variable
is not defined.

Example JSP page:

  &lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
  &lt;c:if test="true"&gt;
    &lt;jsp:forward page="bar.jsp"&gt;
      &lt;jsp:param name="foo" value="bar" /&gt;
    &lt;/jsp:forward&gt;
  &lt;/c:if&gt;

Generates inline code for &lt;jsp:forward&gt; in a method like this:

  private boolean _jspx_meth_c_if_0(PageContext pageContext)
          throws Throwable {
    JspWriter out = pageContext.getOut();
    /* ----  c:if ---- */
    org.apache.taglibs.standard.tag.rt.core.IfTag _jspx_th_c_if_0 =
(org.apache.taglibs.standard.tag.rt.core.IfTag)
_jspx_tagPool_c_if_test.get(org.apache.taglibs.standard.tag.rt.core.IfTag.class);
    _jspx_th_c_if_0.setPageContext(pageContext);
    _jspx_th_c_if_0.setParent(null);
    _jspx_th_c_if_0.setTest(true);
    int _jspx_eval_c_if_0 = _jspx_th_c_if_0.doStartTag();
    if (_jspx_eval_c_if_0 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
      do {
        out.write("\r\n  ");
        if (true) {
          pageContext.forward("bar.jsp" + (("bar.jsp").indexOf('?')&gt;0? '&amp;': '?')
+ org.apache.jasper.runtime.JspRuntimeLibrary.URLEncode("foo",
request.getCharacterEncoding())+ "=" +
org.apache.jasper.runtime.JspRuntimeLibrary.URLEncode("bar",
request.getCharacterEncoding()));
          return true;
        }
    ...
    }

The reference to "request", i.e., in "request.getCharacterEncoding()", leads to
compilation errors:

      [javac] Compiling 1 source file
    [javac]
/home/hans/bin/jakarta-tomcat-5.0.2/work/Catalina/localhost/ora/org/apache/jsp/foo_jsp.java:84:
cannot resolve symbol
    [javac] symbol  : variable request 
    [javac] location: class org.apache.jsp.foo_jsp
    [javac]           pageContext.forward("bar.jsp" +
(("bar.jsp").indexOf('?')&gt;0? '&amp;': '?') +
org.apache.jasper.runtime.JspRuntimeLibrary.URLEncode("foo",
request.getCharacterEncoding())+ "=" +
org.apache.jasper.runtime.JspRuntimeLibrary.URLEncode("bar",
request.getCharacterEncoding()));</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>36796</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-05-07 02:11:44 +0000</bug_when>
    <thetext>Fixed.  Thanks for reporting it.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>19910</bug_id>
          
          <creation_ts>2003-05-14 03:20:00 +0000</creation_ts>
          <short_desc>Cleanup for jakarta-tomcat-5/RUNNING.txt</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>Unknown</version>
          <rep_platform>All</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>http://http://</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Chris Pepper">pepper</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>37154</commentid>
    <comment_count>0</comment_count>
    <who name="Chris Pepper">pepper</who>
    <bug_when>2003-05-14 03:20:04 +0000</bug_when>
    <thetext>Grammar cleanup, including subject-verb agreement,
Make $CATALINA_BASE &amp; $CATALINA_HOME consistent.
Remove implication that $CATALINA_BASE files should only include those different than standard files in 
$CATALINA_HOME; I don't believe if a file's not in $CATALINA_BASE the 'default' is picked up from 
$CATALINA_HOME, but am not absolutely certain.

Someone should verify that Windows doesn't restrict listeners &lt;= 1024 (I'm pretty sure Win98 doesn't, 
but don't know about W2k3).

Index: RUNNING.txt
================================================================
===
RCS file: /home/cvspublic/jakarta-tomcat-5/RUNNING.txt,v
retrieving revision 1.1
diff -u -r1.1 RUNNING.txt
--- RUNNING.txt	1 Aug 2002 21:00:18 -0000	1.1
+++ RUNNING.txt	14 May 2003 03:13:40 -0000
@@ -6,7 +6,7 @@
 
 This subproject contains Tomcat 5, a server that implements the Servlet 2.4
 and JSP 2.0 specifications from the Java Community Process
-(http://www.jcp.org).  In order to install and run this container, you must do
+&lt;http://www.jcp.org/&gt;.  In order to install and run this container, you must do
 the following:
 
 
@@ -42,7 +42,7 @@
 * Unpack the binary distribution into a convenient location so that the
   distribution resides in its own directory (conventionally named
   "jakarta-tomcat-5").  For the purposes of the remainder of this document,
-  the symbolic name "&lt;CATALINA_HOME&gt;" is used to refer to the full
+  the symbolic name "$CATALINA_HOME" is used to refer to the full
   pathname of the release directory.
 
 
@@ -50,12 +50,12 @@
 
 Tomcat 5 can be started by executing the following commands:
 
-      &lt;CATALINA_HOME&gt;\bin\startup.bat          (Windows)
+      $CATALINA_HOME\bin\startup.bat          (Windows)
 
-      &lt;CATALINA_HOME&gt;/bin/startup.sh           (Unix)
+      $CATALINA_HOME/bin/startup.sh           (Unix)
 
 After startup, the default web applications included with Tomcat 5 will be
-available by browsing:
+available by visiting:
 
     http://localhost:8080/
 
@@ -69,23 +69,23 @@
 
 Tomcat 5 can be shut down by executing the following command:
 
-      &lt;CATALINA_HOME&gt;\bin\shutdown            (Windows)
+      $CATALINA_HOME\bin\shutdown            (Windows)
 
-      &lt;CATALINA_HOME&gt;/bin/shutdown.sh         (Unix)
+      $CATALINA_HOME/bin/shutdown.sh         (Unix)
 
 
 (4) Advanced Configuration - Multiple Tomcat 5 Instances
 
 In many circumstances, it is desirable to have a single copy of a Tomcat 5
 binary distribution shared among multiple users on the same server.  To make
-this possible, you must pass a "-Dcatalina.base=&lt;CATALINA_BASE&gt;" argument when
-executing the to the startup command (see (2)). In this
-"-Dcatalina.base=&lt;CATALINA_BASE&gt;" argument, replace &lt;CATALINA_BASE&gt; with the
-directory that contains the files unique to your Tomcat 5 instance.
+this possible, you can pass a "-Dcatalina.base=$CATALINA_BASE" argument when
+executing the startup command (see (2)). In this
+"-Dcatalina.base=$CATALINA_BASE" argument, replace $CATALINA_BASE with the
+directory that contains the files for your 'personal' Tomcat 5 instance.
 
-When you use this "-Dcatalina.base=&lt;CATALINA_BASE&gt;" argument, Tomcat 5 will
+When you use this "-Dcatalina.base=$CATALINA_BASE" argument, Tomcat 5 will
 calculate all relative references for files in the following directories based
-on the value of &lt;CATALINA_BASE&gt; instead of &lt;CATALINA_HOME&gt;:
+on the value of $CATALINA_BASE instead of $CATALINA_HOME:
 
 * conf - Server configuration files (including server.xml)
 
@@ -97,24 +97,27 @@
 
 * temp - Directory used by the JVM for temporary files (java.io.tmpdir)
 
-If you do not pass the "-Dcatalina.base=&lt;CATALINA_BASE&gt;" argument to the startup command, 
&lt;CATALINA_BASE&gt; will default to the same value as &lt;CATALINA_HOME&gt; (which means that the same 
directory is used for all relative path resolutions).
+If you do not pass the "-Dcatalina.base=$CATALINA_BASE" argument to the
+startup command, $CATALINA_BASE will default to the same value as
+$CATALINA_HOME (which means that the same directory is used for all
+relative path resolutions).
 
 The administration and manager web applications, which are defined in the
-&lt;CATALINA_BASE&gt;/webapps/admin.xml and &lt;CATALINA_BASE&gt;/webapps/manager.xml will
-not run in that configuration, unless either:
+$CATALINA_BASE/webapps/admin.xml and $CATALINA_BASE/webapps/manager.xml
+files, will not run in that configuration, unless either:
 - The path specified in the docBase attribute of the Context element is made 
-  absolute, and replaced respectively by &lt;CATALINA_HOME&gt;/server/webapps/admin 
-  and &lt;CATALINA_HOME&gt;/server/webapps/manager
-- Copying and linking both web applications in &lt;CATALINA_BASE&gt;, and modify 
-  accordingly the path specified in the docBase attribute of the Context 
-  element
-- Disabling both web applications by removing &lt;CATALINA_BASE&gt;/webapps/admin.xml
-  and &lt;CATALINA_BASE&gt;/webapps/manager.xml
+  absolute, and replaced respectively by $CATALINA_HOME/server/webapps/admin 
+  and $CATALINA_HOME/server/webapps/manager
+- Both web applications are copied or to $CATALINA_BASE, and
+  the path specified in the docBase attribute of the Context 
+  element is modified appropriately
+- Both web applications are disabled by removing
+  $CATALINA_BASE/webapps/admin.xml and $CATALINA_BASE/webapps/manager.xml
 
 
 (5) Troubleshooting:
 
-There are only really 3 things that can go wrong during the stand-alone
+There are only really 3 things likely to go wrong during the stand-alone
 Tomcat 5 install:
 
 1) The most common hiccup is when another web server (or any process for that
@@ -125,26 +128,26 @@
     
    and search for '8080'.  Change it to a port that isn't in use, and is
    greater than 1024, as ports less than or equal to 1024 require superuser
-   access to bind to.
+   access to bind to under UNIX.
    
    Restart Tomcat and you're in business.  Be sure that you replace the "8080"
    in the URL you're using to access Tomcat.  For example, if you change the
-   port to 1977, you would request the URL http://localhost:1977/.
+   port to 1977, you would request the URL http://localhost:1977/ in your browser.
 
 2) An "out of environment space" error when running the batch files in
    Windows 95, 98, or ME operating systems.
 
    Right-click on the STARTUP.BAT and SHUTDOWN.BAT files.  Click on
-   "Properties" then on the "Memory" tab.  For the "Initial environment" field,
+   "Properties", then on the "Memory" tab.  For the "Initial environment" field,
    enter in something like 4096.
    
-   After you click apply, Windows will create shortcuts in the directory with
+   After you click apply, Windows will create shortcuts
    which you can use to start and stop the container.
 
 3) The 'localhost' machine isn't found.  This could happen if you're behind a
    proxy.  If that's the case, make sure the proxy configuration for your
-   browser knows that you shouldn't be going through the proxy to access the
-   "localhost" machine.
+   browser knows that you shouldn't be going through the proxy to access
+   "localhost".
    
    In Netscape, this is under Edit/Preferences -&gt; Advanced/Proxies, and in
    Internet Explorer, Tools -&gt; Internet Options -&gt; Connections -&gt; LAN Settings.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39384</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">shapira</who>
    <bug_when>2003-06-25 02:21:15 +0000</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>19912</bug_id>
          
          <creation_ts>2003-05-14 03:22:00 +0000</creation_ts>
          <short_desc>Cleanup for jakarta-tomcat-5/BUILDING.txt</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Unknown</version>
          <rep_platform>All</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Chris Pepper">pepper</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>37155</commentid>
    <comment_count>0</comment_count>
    <who name="Chris Pepper">pepper</who>
    <bug_when>2003-05-14 03:22:13 +0000</bug_when>
    <thetext>Various grammar nits
URLs should be in angle brackets (not parentheses) in plain text, per the RFC.
Why quote non-literal paths??

Index: BUILDING.txt
================================================================
===
RCS file: /home/cvspublic/jakarta-tomcat-5/BUILDING.txt,v
retrieving revision 1.30
diff -u -r1.30 BUILDING.txt
--- BUILDING.txt	26 Nov 2002 09:09:21 -0000	1.30
+++ BUILDING.txt	14 May 2003 03:19:31 -0000
@@ -5,8 +5,8 @@
                  ===========================================
 
 This subproject contains the source code for Tomcat 5, a container that
-implements the Servlet 2.4 and the JSP 2.0 specifications from the Java
-Community Process (http://www.jcp.org).  In order to build a binary
+implements the Servlet 2.4 and JSP 2.0 specifications from the Java
+Community Process &lt;http://www.jcp.org/&gt;.  In order to build a binary
 distribution version of the container from a source distribution, 
 do the following:
 
@@ -47,28 +47,28 @@
   the symbolic name "${ant.home}" is used to refer to the full pathname of
   the release directory.
 
-* Modify the PATH environment variable to include directory
-  "${ant.home}/bin" in its list.  This makes the "ant" command line script
+* Modify the PATH environment variable to include the directory
+  ${ant.home}/bin in its list.  This makes the "ant" command line script
   available, which will be used to actually perform the build.
 
 
 (1.2) Download and Install the Xalan 2 Distribution
 
-* Download a binary distribution of version 2.x from:
+* Download a binary distribution of Xalan version 2.x from:
 
   http://xml.apache.org/dist/xalan-j/
 
-  On a Windows platform, you will need:
+  On a Windows platform, you probably want:
     Xerces-J-bin.2.x.y.zip
 
-  On a Unix platform, you will need:
+  On a Unix platform, you probably want:
     Xerces-J-bin.2.x.y.tar.gz
 
 * Unpack the binary distribution into a convenient location so that the
   distribution resides in its own directory (conventionally named
   "xalan-2_x_y").
 
-* Copy the xalan.jar file from that distribution to the "${ant.home}/lib"
+* Copy the xalan.jar file from that distribution to the ${ant.home}/lib
   directory.
 
 
@@ -94,8 +94,8 @@
   file to indicate to Ant the proxy configuration. Read below.
 
 * WARNING: Running this command will checkout the Tomcat 5 sources from CVS, as
-  well as download binaries to the "/usr/local" directory. Make sure this is
-  appropriate to do so on your computer. On Windows, this usually corresponds
+  well as download binaries to the /usr/local directory. Make sure this is
+  appropriate to do on your computer. On Windows, this usually corresponds
   to the "C:\usr\local" directory, unless Cygwin is used. Read below to 
   customize the directory used to download the binaries.
 
@@ -116,7 +116,7 @@
 
 (3) Updating sources
 
-It is recommended to regularly update the downloaded Tomcat 5 sources. 
+It is recommended that you regularly update the downloaded Tomcat 5 sources. 
 To do this, execute the following commands:
 
     cd ${tomcat.source}
@@ -131,9 +131,5 @@
     ant build
 
 In addition, "ant build-depends" will build packages that 
-tomcat depends on ( commons-logging for now ), to ease fixes
-and debuging in those packages.
-
-
-
-  
\ No newline at end of file
+tomcat depends on (commons-logging for now), to ease fixes
+and debugging in those packages.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39385</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">shapira</who>
    <bug_when>2003-06-25 02:25:55 +0000</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>19939</bug_id>
          
          <creation_ts>2003-05-15 03:03:00 +0000</creation_ts>
          <short_desc>Cleanup for jakarta-tomcat-5/RELEASE-NOTES</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.2</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Chris Pepper">pepper</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>37240</commentid>
    <comment_count>0</comment_count>
    <who name="Chris Pepper">pepper</who>
    <bug_when>2003-05-15 03:03:53 +0000</bug_when>
    <thetext>Misc grammar cleanup.

Index: RELEASE-NOTES
===================================================================
RCS file: /home/cvspublic/jakarta-tomcat-5/RELEASE-NOTES,v
retrieving revision 1.2
diff -u -r1.2 RELEASE-NOTES
--- RELEASE-NOTES	4 Feb 2003 23:41:01 -0000	1.2
+++ RELEASE-NOTES	15 May 2003 02:52:21 -0000
@@ -69,7 +69,7 @@
 putting unpacked classes into a "classes" directory (not created by default),
 or by placing them in JAR files in the "lib" directory.
 
-Tomcat 5.0 also makes available Xerces 2 to web applications.
+Tomcat 5.0 also makes Xerces 2 available to web applications.
 
 
 --------------------------
@@ -90,12 +90,12 @@
 Some shared libraries (many are part of the JDK) keep references to objects
 instantiated by the web application. To avoid class loading related problems
 (ClassCastExceptions, messages indicating that the classloader 
-is stopped, ...), the shared libraries state should be reinitialized.
+is stopped, etc.), the shared libraries state should be reinitialized.
 
-Something which could help is to avoid putting classes which would be 
+Something which might help is to avoid putting classes which would be 
 referenced by a shared static field in the web application classloader, 
-and put them in the shared classloader instead (the JARs should be put in the 
-"lib" folder, and classes should be put in the "classes" folder).
+and putting them in the shared classloader instead (JARs should be put
+in the "lib" folder, and classes should be put in the "classes" folder).
 
 
 --------------------
@@ -114,13 +114,13 @@
 Linux and Sun JDK 1.2.x - 1.3.x:
 -------------------------------
 
-Virtual machine crashes can be experienced when using certain combinations of
+Virtual machine crashes may be experienced when using certain combinations of
 kernel / glibc under Linux with Sun Hotspot 1.2 to 1.3. The crashes were 
 reported to occur mostly on startup. Sun JDK 1.4 does not exhibit the problems,
 and neither does IBM JDK for Linux.
 
-The problems can be fixed by reducing the default stack size. At bash shell, 
-do "ulimit -s 2048"; use "limit stacksize 2048" for tcsh.
+The problems can be fixed by reducing the default stack size. From a bash shell,
+use "ulimit -s 2048"; use "limit stacksize 2048" for tcsh.
 
 GLIBC 2.2 / Linux 2.4 users should also define an environment variable:
 export LD_ASSUME_KERNEL=2.2.5
@@ -136,24 +136,24 @@
 disabled by default, as our goal is to provide a fully secure default 
 configuration. However, CGI and SSI remain available.
 
-On Windows:
+To enable CGI and SSI on Windows:
 * rename the file %CATALINA_HOME%\server\lib\servlets-cgi.renametojar to
   %CATALINA_HOME%\server\lib\servlets-cgi.jar.
 * rename the file %CATALINA_HOME%\server\lib\servlets-ssi.renametojar to
   %CATALINA_HOME%\server\lib\servlets-ssi.jar.
 * in %CATALINA_HOME%\conf\web.xml, uncomment the servlet declarations starting
-  line 165 and 213, as well as the associated servlet mappings 
-  line 265 and 274. Alternately, these servlet declarations and mappings can
+  on lines 165 and 213, as well as the associated servlet mappings on
+  lines 265 and 274. Alternately, these servlet declarations and mappings can
   be added to your web application deployment descriptor.
 
-On Unix:
+To enable CGI and SSI on Unix:
 * rename the file $CATALINA_HOME/server/lib/servlets-cgi.renametojar to
   $CATALINA_HOME/server/lib/servlets-cgi.jar.
 * rename the file $CATALINA_HOME/server/lib/servlets-ssi.renametojar to
   $CATALINA_HOME/server/lib/servlets-ssi.jar.
 * in $CATALINA_HOME/conf/web.xml, uncomment the servlet declarations starting
-  line 165 and 213, as well as the associated servlet mappings 
-  line 265 and 274. Alternately, these servlet declarations and mappings can
+  on lines 165 and 213, as well as the associated servlet mappings
+  on lines 265 and 274. Alternately, these servlet declarations and mappings can
   be added to your web application deployment descriptor.
 
 
@@ -162,7 +162,7 @@
 ---------------------
 
 The URLs to be used in the policy file to grant permissions to JARs located
-inside the web application repositories have changed in Tomcat 5.0.
+inside the web application repositories have changed as of Tomcat 4.1.
 
 In Tomcat 4.0, codeBase URLs for JARs loaded from web application 
 repositories were:
@@ -176,8 +176,8 @@
 Symlinking static resources:
 ---------------------------
 
-Unix symlinks will not work when used in a web application to link resources 
-located outside the web application root directory.
+By default, Unix symlinks will not work when used in a web application to
+link resources located outside the web application root directory.
 
 This behavior is optional, and the "allowLinking" flag may be used to disable
 the check.
@@ -188,7 +188,7 @@
 ------------------------
 
 Starting with Tomcat 4.1.12, the invoker servlet is no longer available by 
-default in all webapp. Enabling it for all webapps is possible by editing
+default in all webapps. Enabling it for all webapps is possible by editing
 $CATALINA_HOME/conf/web.xml to uncomment the "/servlet/*" servlet-mapping
 definition.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39453</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">shapira</who>
    <bug_when>2003-06-26 00:06:41 +0000</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>19940</bug_id>
          
          <creation_ts>2003-05-15 03:26:00 +0000</creation_ts>
          <short_desc>Cleanup for jakarta-tomcat-5/resources/mbeans/tomcat5-ant.xml</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.2</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Chris Pepper">pepper</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>37241</commentid>
    <comment_count>0</comment_count>
    <who name="Chris Pepper">pepper</who>
    <bug_when>2003-05-15 03:26:52 +0000</bug_when>
    <thetext>Suggested cleanup for resources/mbeans/tomcat5-ant.xml

Index: resources/mbeans/tomcat5-ant.xml
===================================================================
RCS file: /home/cvspublic/jakarta-tomcat-5/resources/mbeans/tomcat5-ant.xml,v
retrieving revision 1.10
diff -u -r1.10 tomcat5-ant.xml
--- resources/mbeans/tomcat5-ant.xml	25 Apr 2003 14:38:50 -0000	1.10
+++ resources/mbeans/tomcat5-ant.xml	15 May 2003 03:22:38 -0000
@@ -4,7 +4,7 @@
   &lt;property file="build.properties"/&gt;
 
   &lt;property name="tomcat.home" location="." /&gt;
-  &lt;!-- That matches the build struct with build and embed at the same level --&gt;
+  &lt;!-- This matches the build struct with build and embed at the same level --&gt;
   &lt;property name="tomcat.webapps" location="${tomcat.home}/../build/webapps" /&gt;
 
   &lt;path id="tomcatCP-extra" /&gt; 
@@ -257,7 +257,7 @@
          &lt;attribute name="privileged" value="true" /&gt;
        &lt;/mbean&gt;
 
-       &lt;!-- The realm must be declared after the web module. ( for now ) --&gt;
+       &lt;!-- The realm must be declared after the web module (for now). --&gt;
        &lt;mbean name="${domain}:type=Realm,host=localhost,path=manager" 
               code="org.apache.catalina.realm.MemoryRealm" modeler="true"&gt;
          &lt;attribute name="pathname"
@@ -409,7 +409,7 @@
   &lt;/target&gt;
 
   &lt;!-- ==================== Await ==================== 
-       Call this target if you want the build file to hung in "await". Tomcat stop or ^C will stop 
+       Call this target if you want the build file to hang in "await". Tomcat stop or ^C will 
stop 
        the ant execution
     --&gt;
   &lt;target name="await" depends="init"</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39454</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">shapira</who>
    <bug_when>2003-06-26 00:11:22 +0000</bug_when>
    <thetext>Fixed</thetext>
  </long_desc>
      
      

    <bug_classification class="CLEANUP">CLEANUP</bug_classification></bug>
    <bug>
          <bug_id>19941</bug_id>
          
          <creation_ts>2003-05-15 03:29:00 +0000</creation_ts>
          <short_desc>Comment cleanup for jakarta-tomcat-5/resources/confinstall/server_1.xml</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.2</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Chris Pepper">pepper</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>37242</commentid>
    <comment_count>0</comment_count>
    <who name="Chris Pepper">pepper</who>
    <bug_when>2003-05-15 03:29:45 +0000</bug_when>
    <thetext>A comment says to uncomment entries that are already uncommented.
Clarify wording on what request.getRemoteHost() does without DNS.

Index: resources/confinstall/server_1.xml
===================================================================
RCS file: /home/cvspublic/jakarta-tomcat-5/resources/confinstall/server_1.xml,v
retrieving revision 1.4
diff -u -r1.4 server_1.xml
--- resources/confinstall/server_1.xml	3 May 2003 21:55:13 -0000	1.4
+++ resources/confinstall/server_1.xml	15 May 2003 03:25:09 -0000
@@ -13,7 +13,7 @@
 &lt;Server port="8005" shutdown="SHUTDOWN" debug="0"&gt;
 
 
-  &lt;!-- Uncomment these entries to enable JMX MBeans support --&gt;
+  &lt;!-- Comment out these entries to disable JMX MBeans support --&gt;
   &lt;Listener className="org.apache.catalina.mbeans.ServerLifecycleListener"
             debug="0"/&gt;
   &lt;Listener className=
"org.apache.catalina.mbeans.GlobalResourcesLifecycleListener"
@@ -78,7 +78,7 @@
          request.getRemoteHost().  This can have an adverse impact on
          performance, so you can disable it by setting the
          "enableLookups" attribute to "false".  When DNS lookups are disabled,
-         request.getRemoteHost() will return the String version of the
+         request.getRemoteHost() will return a String containing the
          IP address of the remote client.
     --&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39455</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">shapira</who>
    <bug_when>2003-06-26 00:14:01 +0000</bug_when>
    <thetext>Fixed</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>19942</bug_id>
          
          <creation_ts>2003-05-15 03:31:00 +0000</creation_ts>
          <short_desc>jakarta-tomcat-5/resources/confinstall/server_2.xml</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.2</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Chris Pepper">pepper</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>37243</commentid>
    <comment_count>0</comment_count>
    <who name="Chris Pepper">pepper</who>
    <bug_when>2003-05-15 03:31:25 +0000</bug_when>
    <thetext>s/will works/will work/
Clarify $CATALINA_HOME/logs (as written, it's confusing).

Index: resources/confinstall/server_2.xml
===================================================================
RCS file: /home/cvspublic/jakarta-tomcat-5/resources/confinstall/server_2.xml,v
retrieving revision 1.9
diff -u -r1.9 server_2.xml
--- resources/confinstall/server_2.xml	3 May 2003 21:55:13 -0000	1.9
+++ resources/confinstall/server_2.xml	15 May 2003 03:25:09 -0000
@@ -116,7 +116,7 @@
       &lt;!-- Add the following attributes if you want to turn XML validation
            on. Remember to comment the Host element above. 
            
-           Note: XML Schema validationn will works with Xerces 2.0.1 or 
+           Note: XML Schema validationn will work with Xerces 2.0.1 or 
            Xerces 2.1. Xerces 2.0.2 and Xerces 2.2 have bugs that prevent 
            their use with Tomcat--&gt;
       &lt;!--
@@ -144,8 +144,8 @@
         --&gt;
 
         &lt;!-- Access log processes all requests for this virtual host.  By
-             default, log files are created in the "logs" directory relative to
-             $CATALINA_HOME.  If you wish, you can specify a different
+             default, log files are created in $CATALINA_HOME/logs.
+             If you wish, you can specify a different
              directory with the "directory" attribute.  Specify either a relative
              (to $CATALINA_HOME) or absolute path to the desired directory.
         --&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39456</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">shapira</who>
    <bug_when>2003-06-26 00:17:26 +0000</bug_when>
    <thetext>Fixed</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>19958</bug_id>
          
          <creation_ts>2003-05-15 16:06:00 +0000</creation_ts>
          <short_desc>Problems reading ServletInputStream</short_desc>
          <delta_ts>2006-06-11 18:00:56 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:HTTP</component>
          <version>5.0.2</version>
          <rep_platform>PC</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Lenny Karpel">lkarpel</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>37258</commentid>
    <comment_count>0</comment_count>
    <who name="Lenny Karpel">lkarpel</who>
    <bug_when>2003-05-15 16:06:39 +0000</bug_when>
    <thetext>We are having problems reading the ServletInputStream in
Tomcat 5.0.2. The data read is not what is expected.

The enclosed webapp example works fine in Tomcat 4.0.6 and
4.1.24 .. but does NOT using 5.0.2 !!

The intent is to continue reading the request's input stream
after Tomcat has read the headers. For example we are having
problems parsing multipart/form-data posts and anything else
that contains data after the headers.

The enclosed zip file contains a webapp that can be used to
duplicable the failure. I have enclosed log output the example
webapp produces from TC4.1 and TC5.0.

I will post the zip file in a moment.

1. unzip the enclised test.zip info c:\ .. that is what the
   server.xml files assume anyway

2. test under TC4.1.24

	a. copy the tc41-server.xml to the tc41 config folder as server.xml
	b. start tc4.1.24
	c. start IE
	d. ping http://server:8080/test/test
	e. a form show be showing
	f. use the browse button and select the enclosed test.jpg file
	g. click submit
	h. exit IE
	i. stop TC
	j. examine the log file (i have enclosed sample output in tc41.log)
	
3. test under TC5.0.2

	a. copy the tc50-server.xml to the tc50 config folder as server.xml
	b. start tc5.0.2
	c. start IE
	d. ping http://server:8080/test/test
	e. a form show be showing
	f. use the browse button and select the enclosed test.jpg file
	g. click submit
	h. exit IE
	i. stop TC
	j. examine the log file (i have enclosed sample output in tc50.log)

4. compare the two log files .. note that the data read using TC5 is bad.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>37259</commentid>
    <comment_count>1</comment_count>
      <attachid>6364</attachid>
    <who name="Lenny Karpel">lkarpel</who>
    <bug_when>2003-05-15 16:09:38 +0000</bug_when>
    <thetext>Created attachment 6364
Example webapp that demontrates the specified problem.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>37264</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-05-15 17:41:45 +0000</bug_when>
    <thetext>I completely rewrote input handling based on the model used for output, and it
is now much faster (and memory efficient). Maybe there are bugs that slipped
through my tests, though (so I'll look into the report).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>37266</commentid>
    <comment_count>3</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2003-05-15 17:56:10 +0000</bug_when>
    <thetext>The workaround I'm using right now is to wrap request.getInputStream() with a
BufferedInputStream. 

I'm also looking at that bug (but I'm not as good as Remy ;-) )

-- Jeanfrancois</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>37281</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-05-15 19:49:02 +0000</bug_when>
    <thetext>I could reproduce the bug. The problem was that the input stream was incorrectly
using read() from the input buffer (instead, it should use readByte(); you can
pretty much imagine what was going on from there).
Note that using readLine with the input stream is very inefficient (what it
actually does is byte by byte reading). I'm not sure this can be optimized,
unless I add marking support to byte reading (not sure if it's worth it).

Ironically, I tested the readLine() method of the reader a lot more (probably
because it looks totally nasty ;-) ).

Thanks for the test case. If all bug reports were like that, maybe there would
be zero open bugs in BZ ...</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>37701</commentid>
    <comment_count>5</comment_count>
    <who name="Lenny Karpel">lkarpel</who>
    <bug_when>2003-05-23 21:55:43 +0000</bug_when>
    <thetext>I have tested against the latest nightlies and all is now ok .. thanks.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>6364</attachid>
            <date>2003-05-15 16:09:00 +0000</date>
            <delta_ts>2003-05-15 16:09:38 +0000</delta_ts>
            <desc>Example webapp that demontrates the specified problem.</desc>
            <filename>test.zip</filename>
            <type>application/zip</type>
            <size>201616</size>
            <attacher name="Lenny Karpel">lkarpel</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>20029</bug_id>
          
          <creation_ts>2003-05-19 08:57:00 +0000</creation_ts>
          <short_desc>catalina.sh - command "stop -force" not working</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Native:Integration</component>
          <version>5.0.2</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Christian Brensing">horombo</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>37418</commentid>
    <comment_count>0</comment_count>
    <who name="Christian Brensing">horombo</who>
    <bug_when>2003-05-19 08:57:40 +0000</bug_when>
    <thetext>The 'if [ "$1" = "-force" ]' branch of the stop command is never called because
of the previous "exec $_RUNJAVA... org.apache.catalina.startup.Bootstrap $@
stop" command (the processing of catalina.sh ends by calling exec). 

Removing the exec command fixes the problem as far as I can see.

Fixed code snippet:

elif [ "$1" = "stop" ] ; then

  shift
  "$_RUNJAVA" $JAVA_OPTS $CATALINA_OPTS \
    -Djava.endorsed.dirs="$JAVA_ENDORSED_DIRS" -classpath "$CLASSPATH" \
    -Dcatalina.base="$CATALINA_BASE" \
    -Dcatalina.home="$CATALINA_HOME" \
    -Djava.io.tmpdir="$CATALINA_TMPDIR" \
    org.apache.catalina.startup.Bootstrap "$@" stop

  if [ "$1" = "-force" ] ; then
    shift
    if [ ! -z "$CATALINA_PID" ]; then
       echo "Killing: `cat $CATALINA_PID`"
       kill -9 `cat $CATALINA_PID`
    fi
  fi


else</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39564</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2003-06-27 22:39:50 +0000</bug_when>
    <thetext>But removing the exec will make shutdown.sh wait until shutdown is complete, 
not return right away like now.  For a large system, this can easily be 
several seconds (or more, depending on custom shutdown code in user webapps).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43596</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-09-02 12:26:06 +0000</bug_when>
    <thetext>Since I don't see how this can work well in all situations (except if we add a
new command which would just kill Tomcat - not that good an idea IMO), I'm
willing to make the change. We'll see how it works in practice ...</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>20086</bug_id>
          
          <creation_ts>2003-05-20 20:28:00 +0000</creation_ts>
          <short_desc>Broken link for JK Documentation</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Documentation</component>
          <version>Unknown</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>http://jakarta.apache.org/tomcat/tomcat-5.0-doc/coyote/jk2/index.html</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Bill Horan">bhoran2</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>37504</commentid>
    <comment_count>0</comment_count>
    <who name="Bill Horan">bhoran2</who>
    <bug_when>2003-05-20 20:28:23 +0000</bug_when>
    <thetext>In the Tomcat 5.0 page, http://jakarta.apache.org/tomcat/tomcat-5.0-doc/, 
clicking on the "JK Documentation" link in the left column wants to go to 
http://jakarta.apache.org/tomcat/tomcat-5.0-doc/coyote/jk2/index.html, but 
nothing is found there.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39500</commentid>
    <comment_count>1</comment_count>
      <attachid>7000</attachid>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2003-06-26 17:40:40 +0000</bug_when>
    <thetext>Created attachment 7000
Test container servlet</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39502</commentid>
    <comment_count>2</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2003-06-26 17:42:36 +0000</bug_when>
    <thetext>Attached test container servlet for the wrong bug, please ignore ;)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40977</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-07-19 16:26:53 +0000</bug_when>
    <thetext>This now links to the online docs.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>7000</attachid>
            <date>2003-06-26 17:40:00 +0000</date>
            <delta_ts>2003-06-26 17:40:40 +0000</delta_ts>
            <desc>Test container servlet</desc>
            <filename>MyContainerServlet.java</filename>
            <type>text/plain</type>
            <size>1637</size>
            <attacher name="Yoav Shapira">yoavs</attacher>
            

          </attachment>
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>20291</bug_id>
          
          <creation_ts>2003-05-28 09:58:00 +0000</creation_ts>
          <short_desc>html wrong</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlet &amp; JSP API</component>
          <version>5.0.0</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>http://http://http://</bug_file_loc>
          <status_whiteboard/>
          <keywords>APIBug</keywords>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>20320</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="EDWIN CHAN">mysign8</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>mysign8</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>37909</commentid>
    <comment_count>0</comment_count>
    <who name="EDWIN CHAN">mysign8</who>
    <bug_when>2003-05-28 09:58:55 +0000</bug_when>
    <thetext>html wrong</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>20320</bug_id>
          
          <creation_ts>2003-05-29 01:58:00 +0000</creation_ts>
          <short_desc>html wrong</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina:Modules</component>
          <version>5.0.0</version>
          <rep_platform>Other</rep_platform>
          <op_sys>HP-UX</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords>APIBug</keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          <dependson>20291</dependson>
          
          <everconfirmed>1</everconfirmed>
          <reporter name="EDWIN CHAN">mysign8</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>mysign8</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>37965</commentid>
    <comment_count>0</comment_count>
    <who name="EDWIN CHAN">mysign8</who>
    <bug_when>2003-05-29 01:58:26 +0000</bug_when>
    <thetext> </thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>20894</bug_id>
          
          <creation_ts>2003-06-18 22:53:00 +0000</creation_ts>
          <short_desc>body-content value of "JSP" should be error if SimpleTag</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Mark Roth">mark.roth</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>39061</commentid>
    <comment_count>0</comment_count>
    <who name="Mark Roth">mark.roth</who>
    <bug_when>2003-06-18 22:53:22 +0000</bug_when>
    <thetext>According to JSP 2.0 PFD3, JSP.7.1.5, "The body of a Simple Tag, if present, is
translated into a JSP Fragment and passed to the setJspBody method."

According to JSP 2.0 PFD3, JSP.7.1.6, "A translation error must occur if a piece
of JSP code that is to be translated into a JSP Fragment contains scriptlets or
scriptlet expressions."

There is nothing that explicitly requires that a &lt;body-content&gt; of "JSP" in the
TLD for a SimpleTag must produce an error.  However, this is technically
invalid, and the JSP 2.0 specification will now say that it such a TLD will be
considered invalid.

It would be very helpful for tag library developers if Tomcat can flag such an
error right away and indicate that the TLD is invalid for that reason.  This can
take the form of a translation error, for example.  This would be symmetrical
with the current treatment of body-content="JSP" in Tag Files (which is
currently explicitly required to produce a translation error).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39119</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-06-19 21:24:37 +0000</bug_when>
    <thetext>The way jasper is structured, no validation is done when TLDs are read. 
Instead, this error is now detected when custom tags are processed.  This is
probably good enough.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>21010</bug_id>
          
          <creation_ts>2003-06-23 13:30:00 +0000</creation_ts>
          <short_desc>Error creating new context</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.3</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Dario Bonino">dario.bonino</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>rajiv.mordani</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>39275</commentid>
    <comment_count>0</comment_count>
    <who name="Dario Bonino">dario.bonino</who>
    <bug_when>2003-06-23 13:30:16 +0000</bug_when>
    <thetext>Error saving ("Commit changes") new context with '/' char
into his name, for example i need to create "/app/bpb" context.

Workaround:
I create "/appbpb" context and then I modify
the path attribute from "/appbpb" to "/app/bpb" 
into the "&lt;HOME&gt;/conf/Catalina/localhost/appbpb.xml"</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39276</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-06-23 13:33:02 +0000</bug_when>
    <thetext>Well, that's a known issue. None of the chars which aren't allowed in a filename
are filtered out at the moment, so ...
I think this is the same behavior as with TC 4.1.x.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39280</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-06-23 14:05:30 +0000</bug_when>
    <thetext>Actually, small correction: this doesn't happen in TC 4.1.x, as it doesn't try
to save the context stuff as separate files.
I'll slightly refactor things and expose a config file base field at the host
level, and add escaping code in StandardContext. This should fix the issue, as
well as bug 19607.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39397</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-06-25 08:26:34 +0000</bug_when>
    <thetext>*** Bug 20217 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39398</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-06-25 08:29:23 +0000</bug_when>
    <thetext>This should have been fixed as part of the deployer refactorings.
The context file name should now be decoupled from the path name. In case a
context file doesn't exist (so it will be created automatically when saving
changes in the admin webapp), '/' will be escaped.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>21045</bug_id>
          
          <creation_ts>2003-06-24 13:29:00 +0000</creation_ts>
          <short_desc>Manager app does find resources</short_desc>
          <delta_ts>2006-06-11 18:01:17 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Administration</component>
          <version>5.0.3</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Radim Kubacki">radim.kubacki</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>39341</commentid>
    <comment_count>0</comment_count>
    <who name="Radim Kubacki">radim.kubacki</who>
    <bug_when>2003-06-24 13:29:35 +0000</bug_when>
    <thetext>JDK1.4.1/Linux/Tomcat5.0.3

Commands like 
http://localhost:8080/manager/remove?path=/build
or 
http://localhost:8080/manager/deploy?path=/build&amp;war=file:/usr/local/home/radim/Projects/wa/output/DebugConfig/build
shows 'Cannot find message associated with key managerServlet.installed' or
Cannot find message associated with key managerServlet.removed' as their output
instead of strings that should come from properties file and begin with 'OK -'</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39348</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-06-24 14:45:40 +0000</bug_when>
    <thetext>I'm happy to report that if you're French, there's no problem :)

The message key should be updated:
- install -&gt; deploy
- remove -&gt; undeploy
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39376</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-06-24 22:25:10 +0000</bug_when>
    <thetext>This will be in 5.0.4.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39402</commentid>
    <comment_count>3</comment_count>
    <who name="Radim Kubacki">radim.kubacki</who>
    <bug_when>2003-06-25 10:14:12 +0000</bug_when>
    <thetext>Noone have contributed czech localization yet so I stick with english as it is
default ;-). Anyway thanks for promt fix, my dev build works OK now.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>21067</bug_id>
          
          <creation_ts>2003-06-24 21:59:00 +0000</creation_ts>
          <short_desc>tag file handler generation with array attributes</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.3</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Crofton">crofton-2003</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>39373</commentid>
    <comment_count>0</comment_count>
    <who name="Crofton">crofton-2003</who>
    <bug_when>2003-06-24 21:59:33 +0000</bug_when>
    <thetext>I have written a tag file with a attribute of string array. just like this:
&lt;%@ attribute name="columns" type="java.lang.String[]"%&gt;

I wrote a JSP file to invoke this tag file. the variable "columns" has been 
set.
1. &lt;tags:test columns="&lt;%= columns %&gt;"/&gt;
When I pass attribute in the JSP file using scriptlet, it's ok.

2. &lt;tags:test columns="{columns}"/&gt;
But when I pass attribute using EL, something will be wrong, The following is 
the error statement reported by japser compiler when compiling the JSP file:
setColumns(([Ljava.lang.String;) 
org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${columns}", 
[Ljava.lang.String;.class, (PageContext)pageContext, null, false));</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39382</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-06-25 01:06:40 +0000</bug_when>
    <thetext>Fixed.  Thanks for reporting the bug.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>21168</bug_id>
          
          <creation_ts>2003-06-29 01:22:00 +0000</creation_ts>
          <short_desc>Incorrect paths in generated SMAP file entries</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.3</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords>PatchAvailable</keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jim Hennessy">jph</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>39583</commentid>
    <comment_count>0</comment_count>
    <who name="Jim Hennessy">jph</who>
    <bug_when>2003-06-29 01:22:29 +0000</bug_when>
    <thetext>One of the new features of Jasper in Tomcat 5 is that it attaches a "Source
Map" attribute to class files to describe the file name and line number
mapping from a JSP source file to the generated Java source file.

The SMAP that I see in the class files generated by Jasper (5.0.3 alpha)
has a couple of small problems:

1. The second line of the SMAP, according to JSR-45, is the name of the
   generated source file.  This name should be without path information,
   but path information appears in the version generated by Jasper.

2. In the "*F" section, there's a pair of lines that defines the JSP file.
   The second line is the source path for the JSP file.  The path created
   by Jasper contains a leading slash, making it an absolute path.  It
   should be relative; the leading slash should not appear.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>41135</commentid>
    <comment_count>1</comment_count>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-07-22 08:40:24 +0000</bug_when>
    <thetext>The second line of the SMAP contains path information on Windows machines 
because SmapUtil.java's generateSmap() method calls unqualify() to remove the 
path information, and unqualify() only works on pathname strings with "/" as 
the name-separator character.  I fixed this by rewriting unqualify().

The leading slash in the source path in the "*F" section originates deep 
within Tomcat (for instance, in a call to HttpServletRequest.getServletPath() 
when the request is first touched), so I chose to remove the leading slash 
just before writing the source path to the SMAP.

I will attach a patch containing these fixes.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>41136</commentid>
    <comment_count>2</comment_count>
      <attachid>7441</attachid>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-07-22 08:41:29 +0000</bug_when>
    <thetext>Created attachment 7441
Proposed patch</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42123</commentid>
    <comment_count>3</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2003-08-05 01:17:54 +0000</bug_when>
    <thetext>Applied patch with slight modification:

Instead of (as suggested in the patch):

  private static String unqualify(String path) {
    File f = new File(path);
    return f.getName();
  }

the impl now does this:

  private static String unqualify(String path) {
    return path.substring(path.lastIndexOf(File.separator) + 1);
  }

which avoids generation of a File object.

</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>7441</attachid>
            <date>2003-07-22 08:41:00 +0000</date>
            <delta_ts>2003-07-22 08:41:29 +0000</delta_ts>
            <desc>Proposed patch</desc>
            <filename>Bug21168patch.txt</filename>
            <type>text/plain</type>
            <size>2151</size>
            <attacher name="Eric Carmichael">ecarmich</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>21206</bug_id>
          
          <creation_ts>2003-06-30 22:14:00 +0000</creation_ts>
          <short_desc>Tomcat 5 - Jetspeed JSP Portlets do not display</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.7</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Gerry Reno">grenoml</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>39699</commentid>
    <comment_count>0</comment_count>
    <who name="Gerry Reno">grenoml</who>
    <bug_when>2003-06-30 22:14:58 +0000</bug_when>
    <thetext>Setup:
RedHat Linux 8.0
J2SE 1.4.2-beta
Tomcat 5.0.3
Jetspeed 1.4-b4(release) and 1.4-b5-dev(from CVS)

  Using Tomcat 5.0.3, Jetspeed will not display the contents of any of the JSP
Portlets just their title bars.  And the only way that I have found to get these
JSP Portlets to display is to select 'Edit account' at the top of the Jetspeed
page and then just cancel on the next page.  Jetspeed JSP Portlets just do not
work right with Tomcat 5.0.3.  

thx,
Gerry Reno</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39700</commentid>
    <comment_count>1</comment_count>
    <who name="Gerry Reno">grenoml</who>
    <bug_when>2003-06-30 22:17:06 +0000</bug_when>
    <thetext>  BTW, I tried this with Tomcat 4.1.24 and the Jetspeed JSP Portlets work fine
in that release.

thx,
Gerry Reno
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39702</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-06-30 22:18:17 +0000</bug_when>
    <thetext>Please investigate this, and point out a TC 5 spec violation causing the wrong
behavior. I will close the report if a cause of this behavior cannot be
identiied, as it could be an application problem.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39707</commentid>
    <comment_count>3</comment_count>
    <who name="Gerry Reno">grenoml</who>
    <bug_when>2003-06-30 23:31:34 +0000</bug_when>
    <thetext>Remy,
  Yes, I am not discounting the possibility that this could be some type of app
problem.  However, the app is working perfectly fine under 4.1.24 and not under
5.0.3.  I would think that the specs that relate to rendering of JSP content
would be the same as the JSP content in question was JSP 1.2 only - nothing was
JSP 2.0.  Therefore it seems as though one or the other of the containers is not
compliant.  The app also appears to work ok under Resin.  I am not a spec expert
that could pinpoint exactly this problem.  Perhaps there is someone else more
familiar with the specs and the Tomcat and/or Jetspeed code that could assist here.

thx,
Gerry Reno
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39711</commentid>
    <comment_count>4</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2003-07-01 00:25:42 +0000</bug_when>
    <thetext>I have tried this on win2k. The war file fails. If you expand the .war to
directory form, then all is OK. 

In .war form --&gt; I get a zip exception. 

So tomcat is OK with respect to running. The unpacking of the war is a different
story.

For thos curious, here is the part of the stack trace that might look important
in case someone might have an immediate "a ha!":
SEVERE: Exception processing JAR at resource path
C:\opt\data\src\TOMCAT5\jakarta-tomcat-5\build\webapps\jetspeed\WEB-INF\lib\jetspeed-1.4-b4.jar
in context /jetspeed
java.util.zip.ZipException: error in opening zip file
	at java.util.zip.ZipFile.open(Native Method)
	at java.util.zip.ZipFile.&lt;init&gt;(ZipFile.java:112)
	at java.util.jar.JarFile.&lt;init&gt;(JarFile.java:117)
	at java.util.jar.JarFile.&lt;init&gt;(JarFile.java:82)
	at org.apache.catalina.startup.TldConfig.tldScanJar(TldConfig.java:469)
	at org.apache.catalina.startup.TldConfig.tldScanJar(TldConfig.java:449)
	at org.apache.catalina.startup.TldConfig.execute(TldConfig.java:228)
	at org.apache.catalina.core.StandardContext.start(StandardContext.java:4037)
	at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:868)
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39714</commentid>
    <comment_count>5</comment_count>
    <who name="Gerry Reno">grenoml</who>
    <bug_when>2003-07-01 00:38:52 +0000</bug_when>
    <thetext>Tim,
  All of the war files in all of my tests with 5.0.3 and 4.1.24 were
fully expanded.  
  What exactly are you saying?  Are you seeing the exact same problem? 
What did you mean when you say 'war file fails'?   If you meant you
just got a zip exception are you thinking this is related to JSP
Portlets not displaying?

????
Gerry Reno</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39717</commentid>
    <comment_count>6</comment_count>
    <who name="Gerry Reno">grenoml</who>
    <bug_when>2003-07-01 01:36:48 +0000</bug_when>
    <thetext>  Let me clarify this a little more.  Once you have installed the jetspeed.war
file go to the jetspeed home page http://localhost:8080/jetspeed .  Login as
user 'turbine', password 'turbine'.  Now, all the default portlets you see on
the page are Velocity Portlets.  You have to actually add JSP Portlets to the
pages before you can even begin to see the problem.   Click on the 'Edit HTML'
link and select Home then select 'Add Portlet' and from the list of portlets
select some of the JSP types such as JSP HelloWorld or JSP Stock Portfolio (on
the next page), save and apply your way out and then you should be able to see
the problem.

thx,
Gerry Reno
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39722</commentid>
    <comment_count>7</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-07-01 06:49:19 +0000</bug_when>
    <thetext>I don't get the exception on the .war.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39724</commentid>
    <comment_count>8</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-07-01 06:58:09 +0000</bug_when>
    <thetext>I can reproduce the behavior, but I don't know if it's caused by an actual
Tomcat or Jasper bug.
If I stop Tomcat and restart it, I can see the portlets. If I then add a new JSP
portlet, none will get displayed (until I restart Tomcat).

I recommend you debug this a bit more. I am not interested in Jetspeed, so
unless you can point out some bad lower level behavior, I'll eventually close
the bug, assuming Jetspeed is doing something wrong at some point.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39740</commentid>
    <comment_count>9</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2003-07-01 13:15:44 +0000</bug_when>
    <thetext>I just tried it (tomcat 5.0.3, JDK 1.4.1_03, Windows 2000, Jetspeed 1.4b4).  
Dropped jetspeed.war in running tomcat webapps directory.  Went to 
http://localhost:8080/jetspeed, browsed around, everything was fine.  Edited a 
few panes, no problems.  Added JSP Portfolio portlet, didn't get an error, but 
didn't see anything in the portlet (am I supposed to?).  Logged out of 
jetspeed, went to tomcat manager, logged in, reloaded jetspeed webapp.  Tried 
to access http://localhost:8080/jetspeed, got following exception:
Horrible Exception: java.lang.Error: Error in BasePeer.initTableSchema
(TURBINE_USER): The database is already in use by another process at 
org.apache.jetspeed.om.security.turbine.BaseTurbineUserPeer.initClass
(BaseTurbineUserPeer.java:154) at 
org.apache.jetspeed.om.security.turbine.BaseTurbineUserPeer.
(BaseTurbineUserPeer.java:128) at 
org.apache.jetspeed.services.security.turbine.TurbineUserManagement.getUser
(TurbineUserManagement.java:166) at 
org.apache.jetspeed.services.JetspeedUserManagement.getUser
(JetspeedUserManagement.java:97) at 
org.apache.jetspeed.services.security.turbine.TurbineAuthentication.getAnonymous
User(TurbineAuthentication.java:212) at 
org.apache.jetspeed.services.JetspeedAuthentication.getAnonymousUser
(JetspeedAuthentication.java:102) at 
org.apache.jetspeed.services.JetspeedSecurity.getAnonymousUser
(JetspeedSecurity.java:174) at 
org.apache.jetspeed.modules.actions.TemplateSessionValidator.doPerform
(TemplateSessionValidator.java:97) at 
org.apache.jetspeed.modules.actions.JetspeedSessionValidator.doPerform
(JetspeedSessionValidator.java:103) at org.apache.turbine.modules.Action.perform
(Action.java:87) at org.apache.turbine.modules.ActionLoader.exec
(ActionLoader.java:122) at org.apache.turbine.Turbine.doGet(Turbine.java:521) 
at javax.servlet.http.HttpServlet.service(HttpServlet.java:743)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39741</commentid>
    <comment_count>10</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2003-07-01 13:19:32 +0000</bug_when>
    <thetext>Following my post above, I restarted the tomcat server (restarting or reloading 
the jetspeed application was insufficient), and logged back in.  I could see 
the pane that I added with the same display (i.e. no data) in the JSP stock 
portfolio portlet.  That makes me think it's more likely a Jetspeed issue.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39742</commentid>
    <comment_count>11</comment_count>
    <who name="Gerry Reno">grenoml</who>
    <bug_when>2003-07-01 13:23:30 +0000</bug_when>
    <thetext>Yoav,
  When you didn't see anything in the JSP Stock Portfolio portlet that is the
problem that needs fixed!!!   I not inclined one way or the other to say whose
issue this is.  It could be either a Tomcat or a Jetspeed issue at this point. 
The behavior doesn't occur in 4.1.24 or Resin so ????   This other exception
that you got by reloading jetspeed I have never seen before (on Linux) and I
have reloaded jetspeed several times.

thx,
Gerry Reno
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39743</commentid>
    <comment_count>12</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-07-01 13:26:35 +0000</bug_when>
    <thetext>I have no idea if it's indeed a Jetspeed bug. I'd like to know if it can be
reproduced using something other than Jetspeed (in which case it could indicate
a buffering or RD bug). At this point, I don't feel like digging into Jetspeed
to get the answer ...</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39760</commentid>
    <comment_count>13</comment_count>
    <who name="Gerry Reno">grenoml</who>
    <bug_when>2003-07-01 15:16:08 +0000</bug_when>
    <thetext>  I also opened a Jetspeed Bugzilla Bug 21232 on this issue and cross-referenced
it to this bug.

thx,
Gerry Reno
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42015</commentid>
    <comment_count>14</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-03 10:32:10 +0000</bug_when>
    <thetext>Since the root cause of this can't be identified yet, I'll have to close the
report soon as I can't do anything useful with it. Please reopen if you have
more information allowing to indentify the root cause of this problem.

I have to add that the JSP is only processed by Jasper once Tomcat is restarted
(and no dynamic changes have any effect), as the generated source and compiled
class for a JSP portlet are only created then. As the logs are empty, I do not
believe Jasper is the cause of this problem.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42026</commentid>
    <comment_count>15</comment_count>
    <who name="Gerry Reno">grenoml</who>
    <bug_when>2003-08-03 17:13:09 +0000</bug_when>
    <thetext>  This is still a problem which completely prevents someone from using Jetspeed
JSP Portlets and Tomcat 5.  I have not been able to find even a clue as to why
this is happening and the logs have been devoid of any information as to the
source of this problem.  I've looked at the portal page source and everything
about the JSP Portlets is created, title bar, colors, name, except for their JSP
content which shows up as a single blank line.  Jetspeed JSP Portlets run
perfectly under Tomcat 3 and 4 but for some reason not under 5.  I did open a
Jetspeed bug on the same issue but the Jetspeed team doesn't want to do anything
about investigating behavior with Tomcat 5 since it is still alpha. I don't
think any of their developers have even installed TC5 yet.  As far as the state
for this bug, I think it should remain open.  The only servlet container that is
exhibiting any problem with JSP Portlets is Tomcat 5.  Other versions of Tomcat
and Resin work just fine.  Perhaps some change from the servlet spec has led to
the problem.

Gerry Reno


</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42099</commentid>
    <comment_count>16</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-04 19:24:58 +0000</bug_when>
    <thetext>Some progress: Jasper does get invoked in both scenarios through an include
(with or without a server restart).
However, in the first case, the processed JSP is:
/portal/media-type/html/user/turbine/page/default.psml/media-type/html (bad)
In the second case, it is: /WEB-INF/templates/jsp/portlets/html/hello.jsp (good)
I added a Thread.dumpStack in JspServlet.service, and the stack trace is
identical, so I don't understand how it could come from a RD dispatcher bug
(which according to the stack trace is the only possible culprit).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42103</commentid>
    <comment_count>17</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-04 20:22:10 +0000</bug_when>
    <thetext>The bug turned out to be a dumb bug in Jasper (after spending one more hour
debugging the RD ...). This will be fixed in 5.0.7 (or in the next nightly;
applying the patch is trivial if you're using the CVS code).
Easy workaround: After editing, you need to click on the "home" link on the
left, or access your portal through a URI which doesn't have a pathInfo. I'm
downgrading the severity of the bug.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42738</commentid>
    <comment_count>18</comment_count>
    <who name="Gerry Reno">grenoml</who>
    <bug_when>2003-08-14 14:16:56 +0000</bug_when>
    <thetext>Re-opening the bug.

Setup:
RedHat Linux 8.0
J2SE 1.4.2
Tomcat 5.0.7-alpha
Jetspeed 1.4-b4(release) and 1.4-b5-dev(from CVS)

  I downloaded the new version of Tomcat 5.0.7-alpha that included the fix for
this bug and began testing it this morning.  There are still problems with the
JSP Portlet compilation:  Here is the error output from a sample jsp portlet:

 Error encountered processing a template:
/portlets/html/hello.jsporg.apache.jasper.JasperException: Unable to compile
class for JSP at
org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:561)
at
org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:300)
at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:293) at
org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240) at
javax.servlet.http.HttpServlet.service(HttpServlet.java:856) at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:286)
at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
at
org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:752)
at
org.apache.catalina.core.ApplicationDispatcher.doInclude(ApplicationDispatcher.java:640)
at
org.apache.catalina.core.ApplicationDispatcher.include(ApplicationDispatcher.java:552)
at
org.apache.turbine.services.jsp.TurbineJspService.handleRequest(TurbineJspService.java:202)
at
org.apache.turbine.services.jsp.TurbineJspService.handleRequest(TurbineJspService.java:163)
at
org.apache.jetspeed.portal.portlets.viewprocessor.JSPViewProcessor.processView(JSPViewProcessor.java:170)
at
org.apache.jetspeed.portal.portlets.GenericMVCPortlet.buildContent(GenericMVCPortlet.java:301)
at
org.apache.jetspeed.portal.portlets.GenericMVCPortlet.getContent(GenericMVCPortlet.java:219)
at
org.apache.jetspeed.portal.security.portlets.PortletWrapper.getContent(PortletWrapper.java:148)
at sun.reflect.GeneratedMethodAccessor194.invoke(Unknown Source) at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:324) at
org.apache.velocity.runtime.parser.node.ASTMethod.execute(ASTMethod.java:260) at
org.apache.velocity.runtime.parser.node.ASTReference.execute(ASTReference.java:207)
at
org.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:250)
at org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94) at
org.apache.velocity.runtime.parser.node.ASTIfStatement.render(ASTIfStatement.java:109)
at org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94) at
org.apache.velocity.runtime.parser.node.ASTIfStatement.render(ASTIfStatement.java:109)
at
org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)
at org.apache.velocity.Template.merge(Template.java:296) at
org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:492) at
org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:461) at
org.apache.turbine.services.velocity.TurbineVelocityService.decodeRequest(TurbineVelocityService.java:494)
at
org.apache.turbine.services.velocity.TurbineVelocityService.handleRequest(TurbineVelocityService.java:336)
at
org.apache.turbine.services.velocity.TurbineVelocity.handleRequest(TurbineVelocity.java:143)
at
org.apache.jetspeed.portal.controls.VelocityPortletControl.getContent(VelocityPortletControl.java:170)
at sun.reflect.GeneratedMethodAccessor190.invoke(Unknown Source) at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:324) at
org.apache.velocity.runtime.parser.node.ASTMethod.execute(ASTMethod.java:260) at
org.apache.velocity.runtime.parser.node.ASTReference.execute(ASTReference.java:207)
at
org.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:250)
at org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94) at
org.apache.velocity.runtime.directive.Foreach.render(Foreach.java:344) at
org.apache.velocity.runtime.parser.node.ASTDirective.render(ASTDirective.java:153)
at org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94) at
org.apache.velocity.runtime.directive.Foreach.render(Foreach.java:344) at
org.apache.velocity.runtime.parser.node.ASTDirective.render(ASTDirective.java:153)
at
org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)
at org.apache.velocity.Template.merge(Template.java:296) at
org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:492) at
org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:461) at
org.apache.turbine.services.velocity.TurbineVelocityService.decodeRequest(TurbineVelocityService.java:494)
at
org.apache.turbine.services.velocity.TurbineVelocityService.handleRequest(TurbineVelocityService.java:336)
at
org.apache.turbine.services.velocity.TurbineVelocity.handleRequest(TurbineVelocity.java:143)
at
org.apache.jetspeed.portal.controllers.VelocityPortletController.getContent(VelocityPortletController.java:136)
at org.apache.jetspeed.portal.BasePortletSet.getContent(BasePortletSet.java:379)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:324) at
org.apache.velocity.runtime.parser.node.ASTMethod.execute(ASTMethod.java:260) at
org.apache.velocity.runtime.parser.node.ASTReference.execute(ASTReference.java:207)
at
org.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:250)
at
org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)
at org.apache.velocity.Template.merge(Template.java:296) at
org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:492) at
org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:461) at
org.apache.turbine.services.velocity.TurbineVelocityService.decodeRequest(TurbineVelocityService.java:494)
at
org.apache.turbine.services.velocity.TurbineVelocityService.handleRequest(TurbineVelocityService.java:336)
at
org.apache.turbine.services.velocity.TurbineVelocity.handleRequest(TurbineVelocity.java:143)
at
org.apache.jetspeed.portal.controllers.VelocityPortletController.getContent(VelocityPortletController.java:136)
at org.apache.jetspeed.portal.BasePortletSet.getContent(BasePortletSet.java:379)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:324) at
org.apache.velocity.runtime.parser.node.ASTMethod.execute(ASTMethod.java:260) at
org.apache.velocity.runtime.parser.node.ASTReference.execute(ASTReference.java:207)
at
org.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:250)
at org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94) at
org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)
at
org.apache.velocity.runtime.parser.node.ASTIfStatement.render(ASTIfStatement.java:128)
at org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94) at
org.apache.velocity.runtime.parser.node.ASTIfStatement.render(ASTIfStatement.java:109)
at
org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)
at org.apache.velocity.Template.merge(Template.java:296) at
org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:492) at
org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:461) at
org.apache.turbine.services.velocity.TurbineVelocityService.decodeRequest(TurbineVelocityService.java:494)
at
org.apache.turbine.services.velocity.TurbineVelocityService.handleRequest(TurbineVelocityService.java:336)
at
org.apache.turbine.services.velocity.TurbineVelocity.handleRequest(TurbineVelocity.java:143)
at
org.apache.jetspeed.portal.controls.VelocityPortletControl.getContent(VelocityPortletControl.java:170)
at org.apache.jetspeed.util.template.JetspeedTool.getPane(JetspeedTool.java:181)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
at java.lang.reflect.Method.invoke(Method.java:324) at
org.apache.velocity.runtime.parser.node.ASTMethod.execute(ASTMethod.java:260) at
org.apache.velocity.runtime.parser.node.ASTReference.execute(ASTReference.java:207)
at
org.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:250)
at org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94) at
org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)
at
org.apache.velocity.runtime.parser.node.ASTIfStatement.render(ASTIfStatement.java:128)
at
org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)
at org.apache.velocity.Template.merge(Template.java:296) at
org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:492) at
org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:461) at
org.apache.turbine.services.velocity.TurbineVelocityService.decodeRequest(TurbineVelocityService.java:494)
at
org.apache.turbine.services.velocity.TurbineVelocityService.handleRequest(TurbineVelocityService.java:336)
at
org.apache.turbine.services.velocity.TurbineVelocity.handleRequest(TurbineVelocity.java:143)
at
org.apache.turbine.modules.screens.VelocityDirectScreen.buildTemplate(VelocityDirectScreen.java:123)
at
org.apache.turbine.modules.screens.TemplateScreen.doBuild(TemplateScreen.java:130)
at org.apache.turbine.modules.Screen.build(Screen.java:99) at
org.apache.turbine.modules.ScreenLoader.eval(ScreenLoader.java:129) at
org.apache.turbine.util.template.TemplateScreen.toString(TemplateScreen.java:126)
at
org.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:321)
at
org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)
at org.apache.velocity.Template.merge(Template.java:296) at
org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:492) at
org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:461) at
org.apache.turbine.services.velocity.TurbineVelocityService.decodeRequest(TurbineVelocityService.java:494)
at
org.apache.turbine.services.velocity.TurbineVelocityService.handleRequest(TurbineVelocityService.java:336)
at
org.apache.turbine.services.velocity.TurbineVelocity.handleRequest(TurbineVelocity.java:143)
at
org.apache.turbine.modules.layouts.VelocityDirectLayout.doBuild(VelocityDirectLayout.java:106)
at org.apache.turbine.modules.Layout.build(Layout.java:91) at
org.apache.turbine.modules.LayoutLoader.exec(LayoutLoader.java:123) at
org.apache.turbine.modules.pages.DefaultPage.doBuild(DefaultPage.java:169) at
org.apache.turbine.modules.Page.build(Page.java:90) at
org.apache.turbine.modules.PageLoader.exec(PageLoader.java:123) at
org.apache.turbine.Turbine.doGet(Turbine.java:563) at
javax.servlet.http.HttpServlet.service(HttpServlet.java:743) at
javax.servlet.http.HttpServlet.service(HttpServlet.java:856) at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:286)
at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
at
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:254)
at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)
at
org.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:256)
at
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:210)
at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)
at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:190)
at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:175)
at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)
at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)
at
org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:156)
at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)
at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:974) at
org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:207) at
org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:647) at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:489)
at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:575) at
org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:649)
at java.lang.Thread.run(Thread.java:534) JSPViewProcessor: Could not include the
following JSP Page: [hello.jsp] : Error encountered processing a
template:/portlets/html/hello.jsp: Unable to compile class for JSP


  So we took our portal back over to Tomcat 4.1.24 just to check and all JSP
Portlets are still working fine there.

  This is only happening for the Jetspeed JSP Portlets.  Everything else in
Jetspeed is working (with the exception of the xml parser which still requires
loading xalan 2.5.1 jars into common/endorsed)

Gerry Reno</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42821</commentid>
    <comment_count>19</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-15 19:49:01 +0000</bug_when>
    <thetext>You likely have a problem compiling JSPs. This works for me. Please don't reopen
the bug, unless you can make a more convincing argument there's a Tomcat flaw.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42836</commentid>
    <comment_count>20</comment_count>
    <who name="Gerry Reno">grenoml</who>
    <bug_when>2003-08-16 02:06:00 +0000</bug_when>
    <thetext>Remy,

  Ok, I'm sure I would have noticed if my normal JSP weren't compiling but just
to be sure about whether JSPs would compile, I just now went through and clicked
on all the JSP examples provided with Tomcat 5.0.7 and every one of them is
working just fine. Granted they're not too complicated but I'm not seeing any
problem at all compiling JSPs so far with 5.0.7.  I went and dropped the
original jetspeed.war into webapps and then added a JSP Portlet and received the
same error as I reported above.  This time I noticed another exception in the
log that may help:

INFO: Server startup in 20610 ms
java.lang.IllegalArgumentException: -82
	at
org.apache.jasper.compiler.SmapStratum$LineInfo.setOutputLineIncrement(SmapStratum.java:124)
	at org.apache.jasper.compiler.SmapStratum.optimizeLineSection(SmapStratum.java:221)
	at org.apache.jasper.compiler.SmapUtil.evaluateNodes(SmapUtil.java:490)
	at org.apache.jasper.compiler.SmapUtil.generateSmap(SmapUtil.java:123)
	at org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:301)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:453)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:439)
	at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:555)
	at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:300)
	at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:293)
	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)
	at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:286)
	at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at
org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:752)
	at
org.apache.catalina.core.ApplicationDispatcher.doInclude(ApplicationDispatcher.java:640)
	at
org.apache.catalina.core.ApplicationDispatcher.include(ApplicationDispatcher.java:552)
	at
org.apache.turbine.services.jsp.TurbineJspService.handleRequest(TurbineJspService.java:202)
	at
org.apache.turbine.services.jsp.TurbineJspService.handleRequest(TurbineJspService.java:163)
	at
org.apache.jetspeed.portal.portlets.viewprocessor.JSPViewProcessor.processView(JSPViewProcessor.java:170)
	at
org.apache.jetspeed.portal.portlets.GenericMVCPortlet.buildContent(GenericMVCPortlet.java:301)
	at
org.apache.jetspeed.portal.portlets.GenericMVCPortlet.getContent(GenericMVCPortlet.java:219)
	at
org.apache.jetspeed.portal.security.portlets.PortletWrapper.getContent(PortletWrapper.java:148)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:324)
	at org.apache.velocity.runtime.parser.node.ASTMethod.execute(ASTMethod.java:260)
	at
org.apache.velocity.runtime.parser.node.ASTReference.execute(ASTReference.java:207)
	at
org.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:250)
	at org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94)
	at
org.apache.velocity.runtime.parser.node.ASTIfStatement.render(ASTIfStatement.java:109)
	at org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94)
	at
org.apache.velocity.runtime.parser.node.ASTIfStatement.render(ASTIfStatement.java:109)
	at org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)
	at org.apache.velocity.Template.merge(Template.java:296)
	at org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:492)
	at org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:461)
	at
org.apache.turbine.services.velocity.TurbineVelocityService.decodeRequest(TurbineVelocityService.java:494)
	at
org.apache.turbine.services.velocity.TurbineVelocityService.handleRequest(TurbineVelocityService.java:336)
	at
org.apache.turbine.services.velocity.TurbineVelocity.handleRequest(TurbineVelocity.java:143)
	at
org.apache.jetspeed.portal.controls.VelocityPortletControl.getContent(VelocityPortletControl.java:170)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:324)
	at org.apache.velocity.runtime.parser.node.ASTMethod.execute(ASTMethod.java:260)
	at
org.apache.velocity.runtime.parser.node.ASTReference.execute(ASTReference.java:207)
	at
org.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:250)
	at org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94)
	at org.apache.velocity.runtime.directive.Foreach.render(Foreach.java:344)
	at
org.apache.velocity.runtime.parser.node.ASTDirective.render(ASTDirective.java:153)
	at org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94)
	at org.apache.velocity.runtime.directive.Foreach.render(Foreach.java:344)
	at
org.apache.velocity.runtime.parser.node.ASTDirective.render(ASTDirective.java:153)
	at org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)
	at org.apache.velocity.Template.merge(Template.java:296)
	at org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:492)
	at org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:461)
	at
org.apache.turbine.services.velocity.TurbineVelocityService.decodeRequest(TurbineVelocityService.java:494)
	at
org.apache.turbine.services.velocity.TurbineVelocityService.handleRequest(TurbineVelocityService.java:336)
	at
org.apache.turbine.services.velocity.TurbineVelocity.handleRequest(TurbineVelocity.java:143)
	at
org.apache.jetspeed.portal.controllers.VelocityPortletController.getContent(VelocityPortletController.java:136)
	at org.apache.jetspeed.portal.BasePortletSet.getContent(BasePortletSet.java:379)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:324)
	at org.apache.velocity.runtime.parser.node.ASTMethod.execute(ASTMethod.java:260)
	at
org.apache.velocity.runtime.parser.node.ASTReference.execute(ASTReference.java:207)
	at
org.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:250)
	at org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)
	at org.apache.velocity.Template.merge(Template.java:296)
	at org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:492)
	at org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:461)
	at
org.apache.turbine.services.velocity.TurbineVelocityService.decodeRequest(TurbineVelocityService.java:494)
	at
org.apache.turbine.services.velocity.TurbineVelocityService.handleRequest(TurbineVelocityService.java:336)
	at
org.apache.turbine.services.velocity.TurbineVelocity.handleRequest(TurbineVelocity.java:143)
	at
org.apache.jetspeed.portal.controllers.VelocityPortletController.getContent(VelocityPortletController.java:136)
	at org.apache.jetspeed.portal.BasePortletSet.getContent(BasePortletSet.java:379)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:324)
	at org.apache.velocity.runtime.parser.node.ASTMethod.execute(ASTMethod.java:260)
	at
org.apache.velocity.runtime.parser.node.ASTReference.execute(ASTReference.java:207)
	at
org.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:250)
	at org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94)
	at org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)
	at
org.apache.velocity.runtime.parser.node.ASTIfStatement.render(ASTIfStatement.java:128)
	at org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94)
	at
org.apache.velocity.runtime.parser.node.ASTIfStatement.render(ASTIfStatement.java:109)
	at org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)
	at org.apache.velocity.Template.merge(Template.java:296)
	at org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:492)
	at org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:461)
	at
org.apache.turbine.services.velocity.TurbineVelocityService.decodeRequest(TurbineVelocityService.java:494)
	at
org.apache.turbine.services.velocity.TurbineVelocityService.handleRequest(TurbineVelocityService.java:336)
	at
org.apache.turbine.services.velocity.TurbineVelocity.handleRequest(TurbineVelocity.java:143)
	at
org.apache.jetspeed.portal.controls.VelocityPortletControl.getContent(VelocityPortletControl.java:170)
	at org.apache.jetspeed.util.template.JetspeedTool.getPane(JetspeedTool.java:181)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:324)
	at org.apache.velocity.runtime.parser.node.ASTMethod.execute(ASTMethod.java:260)
	at
org.apache.velocity.runtime.parser.node.ASTReference.execute(ASTReference.java:207)
	at
org.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:250)
	at org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94)
	at org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)
	at
org.apache.velocity.runtime.parser.node.ASTIfStatement.render(ASTIfStatement.java:128)
	at org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)
	at org.apache.velocity.Template.merge(Template.java:296)
	at org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:492)
	at org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:461)
	at
org.apache.turbine.services.velocity.TurbineVelocityService.decodeRequest(TurbineVelocityService.java:494)
	at
org.apache.turbine.services.velocity.TurbineVelocityService.handleRequest(TurbineVelocityService.java:336)
	at
org.apache.turbine.services.velocity.TurbineVelocity.handleRequest(TurbineVelocity.java:143)
	at
org.apache.turbine.modules.screens.VelocityDirectScreen.buildTemplate(VelocityDirectScreen.java:123)
	at
org.apache.turbine.modules.screens.TemplateScreen.doBuild(TemplateScreen.java:130)
	at org.apache.turbine.modules.Screen.build(Screen.java:99)
	at org.apache.turbine.modules.ScreenLoader.eval(ScreenLoader.java:129)
	at
org.apache.turbine.util.template.TemplateScreen.toString(TemplateScreen.java:126)
	at
org.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:321)
	at org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)
	at org.apache.velocity.Template.merge(Template.java:296)
	at org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:492)
	at org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:461)
	at
org.apache.turbine.services.velocity.TurbineVelocityService.decodeRequest(TurbineVelocityService.java:494)
	at
org.apache.turbine.services.velocity.TurbineVelocityService.handleRequest(TurbineVelocityService.java:336)
	at
org.apache.turbine.services.velocity.TurbineVelocity.handleRequest(TurbineVelocity.java:143)
	at
org.apache.turbine.modules.layouts.VelocityDirectLayout.doBuild(VelocityDirectLayout.java:106)
	at org.apache.turbine.modules.Layout.build(Layout.java:91)
	at org.apache.turbine.modules.LayoutLoader.exec(LayoutLoader.java:123)
	at org.apache.turbine.modules.pages.DefaultPage.doBuild(DefaultPage.java:169)
	at org.apache.turbine.modules.Page.build(Page.java:90)
	at org.apache.turbine.modules.PageLoader.exec(PageLoader.java:123)
	at org.apache.turbine.Turbine.doGet(Turbine.java:563)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:743)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)
	at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:286)
	at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:254)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)
	at
org.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:256)
	at
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:210)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:190)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:175)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)
	at
org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:156)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:974)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:207)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:647)
	at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:489)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:575)
	at
org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:649)
	at java.lang.Thread.run(Thread.java:534)


  This particular exception in catalina.out that shows up when I access a
Jetspeed pane containing a JSP Portlet.  This is with using Tomcat as-is, right
out of the jakarta-tomcat-5.0.7.tar.gz distribution and Jetspeed 1.4b4 as-is. 
Hope this will help shed some light on the issue.

thx,
Gerry Reno

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42837</commentid>
    <comment_count>21</comment_count>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-08-16 02:23:21 +0000</bug_when>
    <thetext>IllegalArgumentException in setOutputLineIncrement() is Bugzilla Bug 22277, 
and is fixed in CVS.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>21279</bug_id>
          
          <creation_ts>2003-07-02 15:08:00 +0000</creation_ts>
          <short_desc>Proc Runner: No Listener Notification on Shutdown</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Native:Packaging</component>
          <version>5.0.5</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Marc Lehmann">marc.lehmann</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>39860</commentid>
    <comment_count>0</comment_count>
    <who name="Marc Lehmann">marc.lehmann</who>
    <bug_when>2003-07-02 15:08:18 +0000</bug_when>
    <thetext>The sample listener (provided with servlet-examples and jsp-examples) are not 
notified on shutdown if TC has been started via proc runner. Starting and 
stopping via startup.bat and shutdown.bat works as expected.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39867</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-07-02 15:23:51 +0000</bug_when>
    <thetext>Ok, I can reproduce that. I find it odd that the shutdown hook of the VM isn't
getting invoked. Maybe the process is abruptly killed at some point.

There are alternative ways to start Tomcat if you need a workaround for now
(including the Java launcher from the Commons, and the plain old .bat scripts).
I hope you like the new .exe wrapper (assuming the bugs are fixed, of course).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39868</commentid>
    <comment_count>2</comment_count>
    <who name="Marc Lehmann">marc.lehmann</who>
    <bug_when>2003-07-02 15:38:13 +0000</bug_when>
    <thetext>Proc runner now comes with the Java Option -Xrs preconfigured (as of TC 5.0.3). 
However, leaving the option out doesn't make a difference.

I do like the new .exe wrapper. It's a very handy tool. </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>39917</commentid>
    <comment_count>3</comment_count>
    <who name="Marc Lehmann">marc.lehmann</who>
    <bug_when>2003-07-03 10:12:34 +0000</bug_when>
    <thetext>Some more observation - hope it helps to pin down the problem:
If I start TC via proc runner and stop TC via shutdown.bat the method 
contextDestroyed() is properly called.

Windows Task-Manager:
Stopping TC via proc runner gives a peak CPU utilization of approx. 6%, the 
extra CPU utilization lasts for approx. 5 seconds.
Stopping TC via shutdown.bat gives a peak CPU utilization of 100%, the extra 
CPU utilization lasts from 15 to 35 seconds.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>41967</commentid>
    <comment_count>4</comment_count>
    <who name="Marc Lehmann">marc.lehmann</who>
    <bug_when>2003-08-01 16:50:52 +0000</bug_when>
    <thetext>I have added some logging to org.apache.catalina.startup.Bootstrap: main() is 
never reached on shutdown via procrun. Looks like procrun just kills the JVM. 
What strikes me here is that no shutdown hook gets activated. If I shutdown TC 
via telnet (port 8005) SessionListener and ContextListener are properly 
notified. I have no tools available to actually look what procrun does on 
shutdown. Any help is much appreciated.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42447</commentid>
    <comment_count>5</comment_count>
    <who name="">william.barker</who>
    <bug_when>2003-08-09 02:35:36 +0000</bug_when>
    <thetext>Fixed now in the CVS, and should appear in 5.0.7.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>21341</bug_id>
          
          <creation_ts>2003-07-04 09:24:00 +0000</creation_ts>
          <short_desc>Error page mechanism not working</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.3</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Kevin Jones">kevinj</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>tfohrer</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>39987</commentid>
    <comment_count>0</comment_count>
    <who name="Kevin Jones">kevinj</who>
    <bug_when>2003-07-04 09:24:53 +0000</bug_when>
    <thetext>I have an error-page entry in my web.xml file like this

    &lt;error-page&gt;
       
&lt;exception-type&gt;com.develop.ejweb.lab.exception.BlogException&lt;/exception-type&gt;
        &lt;location&gt;/WEB-INF/error.jsp&lt;/location&gt;
    &lt;/error-page&gt;


If I throw a BlogException the page does not get displayed

The exact same code works fine under Tomcat 4.1</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40798</commentid>
    <comment_count>1</comment_count>
      <attachid>7325</attachid>
    <who name="Anil Bhatia">banil</who>
    <bug_when>2003-07-16 10:29:57 +0000</bug_when>
    <thetext>Created attachment 7325
Fix for defect 21341</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40800</commentid>
    <comment_count>2</comment_count>
    <who name="Anil Bhatia">banil</who>
    <bug_when>2003-07-16 10:46:31 +0000</bug_when>
    <thetext>Details of above attached fix:
The call to processRequest in ApplicationDispatcher::doForward is replaced with 
the body of processRequest with reversed check, so that in normal case invoke
(outerRequest, response) gets called instead of invoke(request, response).

Need some inputs on the impact if this fix is made *inside* the 
ApplicationDispatcher::processRequest method.

--- src\share\org\apache\catalina\core\ApplicationDispatcher.java
+++ modified\src\share\org\apache\catalina\core\ApplicationDispatcher.java
@@ -509
           ApplicationFilterFactory.DISPATCHER_TYPE_ATTR);
-if (disInt.intValue() != ApplicationFilterFactory.ERROR) {

+if (disInt.intValue() == ApplicationFilterFactory.ERROR) {

Observation: When status code 500 (Internal Serve Error) is returned, IE does 
not show the error-page if the message in the page is less than some number (in 
my case approx 500) of characters. This problem does not occur if Netscape is 
used. Looks like a client side problem.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40801</commentid>
    <comment_count>3</comment_count>
      <attachid>7326</attachid>
    <who name="Anil Bhatia">banil</who>
    <bug_when>2003-07-16 10:47:32 +0000</bug_when>
    <thetext>Created attachment 7326
Re-submitting the same patch in unified diff format...</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40822</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-07-16 13:01:01 +0000</bug_when>
    <thetext>Your patch is likely bad. The problem is likely the same that was causing FORM
auth to cause problems when using a forward (instead of a redirect): because the
request dispatcher was invoked from outside of the filter pipeline, its state
was incorrect.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40901</commentid>
    <comment_count>5</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-07-17 11:59:21 +0000</bug_when>
    <thetext>This is now fixed, and will be in 5.0.5.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>7325</attachid>
            <date>2003-07-16 10:29:00 +0000</date>
            <delta_ts>2003-07-16 10:29:57 +0000</delta_ts>
            <desc>Fix for defect 21341</desc>
            <filename>Fix21341.txt</filename>
            <type>text/plain</type>
            <size>1154</size>
            <attacher name="Anil Bhatia">banil</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>7326</attachid>
            <date>2003-07-16 10:47:00 +0000</date>
            <delta_ts>2003-07-16 10:47:32 +0000</delta_ts>
            <desc>Re-submitting the same patch in unified diff format...</desc>
            <filename>Fix21341.txt</filename>
            <type>text/plain</type>
            <size>1598</size>
            <attacher name="Anil Bhatia">banil</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>21419</bug_id>
          
          <creation_ts>2003-07-08 20:55:00 +0000</creation_ts>
          <short_desc>error on startup - java.lang.NoSuchMethodException: org.apache.catalina.core.StandardHost.getHost()</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jacob Kjome">hoju</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>40218</commentid>
    <comment_count>0</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2003-07-08 20:55:59 +0000</bug_when>
    <thetext>Using the latest CVS build from today (2003/07/08), starting Tomcat5 using
"catalina.bat run" (under Win2k) and using a custom CATALINA_BASE results in the
following error on startup.  This worked just fine with Tomcat-5.0.3....


D:\myclasses\Repository\Enhydra\XMLC_DSF_2003-05-19-2\xmlc\examples\tomcat&gt;run-tomcat
Using CATALINA_BASE:  
D:\myclasses\Repository\Enhydra\XMLC_DSF_2003-05-19-2\xmlc\examples\tomcat\build
Using CATALINA_HOME:   C:\Java\Apache\Jakarta\tomcat-5-20030708
Using CATALINA_TMPDIR:
D:\myclasses\Repository\Enhydra\XMLC_DSF_2003-05-19-2\xmlc\examples\tomcat\build\temp
Using JAVA_HOME:       C:\j2sdk1.4.1_02
log4j:WARN No appenders could be found for logger
(org.apache.catalina.startup.Embedded).
log4j:WARN Please initialize the log4j system properly.
Catalina.start: java.lang.NoSuchMethodException:
org.apache.catalina.core.StandardHost.getHost()
java.lang.NoSuchMethodException: org.apache.catalina.core.StandardHost.getHost()
        at
org.apache.commons.digester.Digester.createSAXException(Digester.java:2540)
        at
org.apache.commons.digester.Digester.createSAXException(Digester.java:2566)
        at org.apache.commons.digester.Digester.startElement(Digester.java:1276)
        at org.apache.xerces.parsers.AbstractSAXParser.startElement(Unknown Source)
        at
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanStartElement(Unknown
Source)
        at
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(Unknown
Source)
        at
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source)
        at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)
        at org.apache.xerces.parsers.DTDConfiguration.parse(Unknown Source)
        at org.apache.xerces.parsers.XMLParser.parse(Unknown Source)
        at org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)
        at org.apache.commons.digester.Digester.parse(Digester.java:1548)
        at org.apache.catalina.startup.Catalina.load(Catalina.java:511)
        at org.apache.catalina.startup.Catalina.load(Catalina.java:549)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at org.apache.catalina.startup.Bootstrap.load(Bootstrap.java:260)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:393)
Catalina.start: java.lang.NoSuchMethodException:
org.apache.catalina.core.StandardHost.getHost()
java.lang.NoSuchMethodException: org.apache.catalina.core.StandardHost.getHost()
        at
org.apache.commons.digester.Digester.createSAXException(Digester.java:2540)
        at
org.apache.commons.digester.Digester.createSAXException(Digester.java:2566)
        at org.apache.commons.digester.Digester.startElement(Digester.java:1276)
        at org.apache.xerces.parsers.AbstractSAXParser.startElement(Unknown Source)
        at
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanStartElement(Unknown
Source)
        at
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(Unknown
Source)
        at
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source)
        at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)
        at org.apache.xerces.parsers.DTDConfiguration.parse(Unknown Source)
        at org.apache.xerces.parsers.XMLParser.parse(Unknown Source)
        at org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)
        at org.apache.commons.digester.Digester.parse(Digester.java:1548)
        at org.apache.catalina.startup.Catalina.load(Catalina.java:511)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:569)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)
java.lang.reflect.InvocationTargetException
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)
Caused by: java.lang.NullPointerException
        at org.apache.catalina.startup.Catalina.await(Catalina.java:633)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:595)
        ... 6 more


After this, Tomcat just exists the JVM.  What changed between Tomcat-5.0.3 and
the current CVS to cause this error?

Jake</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40221</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-07-08 21:17:23 +0000</bug_when>
    <thetext>Jacob, if you could try to substantiate your reports, that would be great. This
doesn't help anyone.
AFAIK, there has never been any getHost method inside StandardHost, and there
hasn't been any change between the StdHost from 5.0.3 and the StdHost from CVS
HEAD. I would appreciate if you could debug a bit your setup, which most of the
time is not exactly clean.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40235</commentid>
    <comment_count>2</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2003-07-08 23:54:22 +0000</bug_when>
    <thetext>Hi Remy,

I don't have the slightest clue of where to look in Tomcat.  Here is what I know
(and thought was clear in the initial report)...

1.  The problem didn't happen when using any previous version of Tomcat.  That
is, everything works just fine from version 5.0.3 all the way back to all recent
versions of 4.1.xx.

2.  The only thing that changed was pointing CATALINA_HOME to the latest version
of Tomcat built from CVS rather than some other version of Tomcat.  Really,
truly, not one other thing is different.  Not a single change was made to the
application; only the value of CATALINA_HOME in the batch script is different.

Given these premises, the conclusion follows that the problem is not my app, but
something in Tomcat. If that conclusion is just way out of line, please describe
your reasoning.

I'm not saying that the issue is necessarily StandardHost.  What I'm saying is,
that is what the stack trace says.  There is also a NullPointerException further
down the stack trace.  There's a lot of runtime reflection going on there and
what is being reported is probably obscuring the real issue.  What I was hoping
was that the stack trace would be more clear to you than to me and that it would
provide a clue to the real source of the issue.

For your information, here is what the "run-tomcat" batch script looks like...

@echo off
set CATALINA_HOME=C:\Java\Apache\Jakarta\tomcat-5-20030708
set
CATALINA_BASE=D:\myclasses\Repository\Enhydra\XMLC_DSF_2003-05-19-2\xmlc\examples\tomcat\build

rem remove the log files
del /Q %CATALINA_BASE%\logs\*

%CATALINA_HOME%\bin\catalina.bat run


Pretty simple stuff.  Again, the only difference between when things work and
when things don't is the value of CATALINA_HOME above.  Specifically, if I
change it to "C:\Java\Apache\Jakarta\tomcat-5.0.3", then Tomcat starts up just fine.

Your criticism of my bug reports notwithstanding, most all of my bug reports
have lead to important modifications allowing Tomcat to work properly where it
may not have if not for my report because you wouldn't be aware of the issue if
not for the report.  So, I'll try to improve the reports but remember, I'm an
interested Tomcat user, but not a Tomcat developer.  Please keep expectations in
line with that fact.

Let me know if you require any other specific types of information to make it
easier to fix this issue.  I can provide instructions on reproducing the
problem, but that would require you to grab the latest source of XMLC.  I'm not
sure if you are willing to do that or not.  If so, let me know and I'll provide
step-by-step instructions.

Jake</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40245</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-07-09 07:05:21 +0000</bug_when>
    <thetext>If something really bad happens during init (which doesn't happen in practice),
then the server instance is null, and you should get a NPE.
There's of course no call to any getHost( method (do a grep if you don't believe
me) anywhere in the source - and there never was one -, except on the request
method.
Don't worry, if this bug is real, it seems obvious enough, and other people will
report it.

Can't you really fix that kind of thing ?
log4j:WARN No appenders could be found for logger
(org.apache.catalina.startup.Embedded).
log4j:WARN Please initialize the log4j system properly.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40252</commentid>
    <comment_count>4</comment_count>
    <who name="Torsten Fohrer">tfohrer</who>
    <bug_when>2003-07-09 11:29:46 +0000</bug_when>
    <thetext>Same problem, here is a small patch from me.

WORKS FOR ME

Index: SetDocBaseRule.java
===================================================================
RCS file: /home/cvspublic/jakarta-tomcat-
catalina/catalina/src/share/org/apache/catalina/startup/SetDocBaseRule.java,v
retrieving revision 1.1
diff -u -w -b -r1.1 SetDocBaseRule.java
--- SetDocBaseRule.java 24 Jun 2003 22:37:05 -0000      1.1
+++ SetDocBaseRule.java 9 Jul 2003 11:24:21 -0000
@@ -118,8 +118,13 @@

         Context child = (Context) digester.peek(0);
         Deployer parent = (Deployer) digester.peek(1);
+        Host host = null;
+        if (!( parent instanceof StandardHost ))  {
         Method method = parent.getClass().getMethod("getHost", null);
-        Host host = (Host) method.invoke(parent, null);
+          host = (Host) method.invoke(parent, null);
+        } else
+          host = (Host)parent;
+
         String appBase = host.getAppBase();

         if (!(host instanceof StandardHost)) {
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40253</commentid>
    <comment_count>5</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-07-09 11:51:58 +0000</bug_when>
    <thetext>Sounds convincing enough to me ;-) It seems you made a mistake trying to reopen
the bug.
This doesn't happen in normal mode for me however. how do you reproduce it ?

About the patch: Maybe it could be cleaner, I'll see what I can do. The addition
of a method somewhere could be needed.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40254</commentid>
    <comment_count>6</comment_count>
    <who name="Torsten Fohrer">tfohrer</who>
    <bug_when>2003-07-09 12:17:48 +0000</bug_when>
    <thetext>Sorry, can't reproduce it in the quick. Seen this exception on my 2 development machines and on my dev-server,after patching SetDocBaseRule to check if its get a StandardHost or other thing, it's work for me. My Setup,dev-server: 1 host + 3 aliases, standalone tomcatdev-machines: 1 host, localhost only</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40255</commentid>
    <comment_count>7</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2003-07-09 13:15:15 +0000</bug_when>
    <thetext>I'm glad someone else is seeing this.  I tried reproducing it by just running
"$CATALINA_HOME/bin/catalina.bat run", but I didn't see the error occur there.

Here is how you can reproduce it for yourself:

1.  Grab the latest XMLC CVS.  See instructions here:
http://forge.objectweb.org/cvs/?group_id=49

2.  cd to the root of the build and follow short instructions in the "README". 
XMLC should now be built.

3.  cd to $XMLC_ROOT/examples/tomcat.  Copy "build.properties.examples" to
"build.properties" and modify the path to "tomcat.home".  Now run "ant".  This
will build the examples and set up an environment for a custom CATALINA_BASE and
use the value you defined for tomcat.home for CATALINA_HOME.  Convenience
scripts "run-tomcat.bat" and "run-tomcat.sh" will be generated for you.

4.  run the appropriate script for your platform.  I run "run-tomcat.bat" on my
win2k platform.  You should now witness the stack trace that I reported if you
are using the latest Tomcat5 CVS.  To test with another version of tomcat,
modify the tomcat.home property in build.properties to, say..., tomcat-5.0.3 and
re-run "ant".  The scripts will be re-generated for you pointing to the
appropriate CATALINA_HOME.  You should not witness the stack trace using
tomcat-5.0.3.

5.  If you care to view the application running under this custom CATALINA_BASE,
point your browser to:
http://localhost:8081/xmlc/

Hopefully those instructions are clear enough.  Let me know if you have
difficulties.


BTW, regarding your comments...

&gt;Can't you really fix that kind of thing ?
&gt;log4j:WARN No appenders could be found for logger
&gt;(org.apache.catalina.startup.Embedded).
&gt;log4j:WARN Please initialize the log4j system properly.

That started happening in recent Tomcat5 builds.  It doesn't occur when using
Tomcat-4.1.xx and actually didn't occur in early builds of Tomcat5 (sorry, not
sure when exactly it started).  I suspect the reason it is happening has more to
do with commons-logging than Log4j.  I put log4j-1.2.8.jar in
CATALINA_HOME/common/lib as a standard practice.  Since commons-logging sees
Log4j in its classpath, it uses it.  The app in question actually uses no
logging whatsoever so this message is coming from something in Tomcat itself (or
its 3rd party libraries) and not the example application.  If you are asking me
to  track down the issue in commons-logging, you are barking up the wrong tree.
 I have nothing to do with commons-logging and, personally, I feel it has caused
way more pain and suffering than it is worth.  The class loading tricks it uses
to proxy other logging api's fails in lots of situations and is incredibly hard
to debug.  If it were up to me, I'd drop commons-logging like a bad habit and
just use Log4j directly.  I know that won't happen, though, so I'm not going to
press the issue.  I can make Log4j work just fine for me in apps using Log4j
directly so the Log4j warning message in question is pretty innocuous to me. 
I'm not sure if the interaction is adversly affecting Tomcat5 logging when
commons-logging finds Log4j in its classpath or not?  As such, I'm not very
worried about it.  If you want to report a bug I'm all for it, but the only
people who will be able to fix it are either Tomcat guys like yourself or
commons-logging guys.  I don't think many people at Log4j will have much
interest or be able to help in any way other than maybe Yoav Shapira who has
more hands-on experience with commons-logging as well as being a Log4j developer.

Jake

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40284</commentid>
    <comment_count>8</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-07-09 18:21:28 +0000</bug_when>
    <thetext>Ok, I reproduced it. You only need to have a Context element defined in server.xml.
So since this is not the preferred way in TC 5, I forgot to test it. Torsten's
patch is correct, and I'll apply it. Thanks for the patch.

Jacob: Thanks for reporting the issue. About the log4j problem: I did change
things in the webapp classloader, but not in the main common classloader.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>21553</bug_id>
          
          <creation_ts>2003-07-14 00:15:00 +0000</creation_ts>
          <short_desc>Host aliases are not mapped correctly</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.3</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Gerry Reno">grenoml</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>40591</commentid>
    <comment_count>0</comment_count>
    <who name="Gerry Reno">grenoml</who>
    <bug_when>2003-07-14 00:15:31 +0000</bug_when>
    <thetext>Using the following server.xml declaration:

&lt;Host 
className="org.apache.catalina.core.StandardHost"
appBase="vhosts/webapps/community-2.com" 
autoDeploy="true" 
backgroundProcessorDelay="-1"
configClass="org.apache.catalina.startup.ContextConfig"
contextClass="org.apache.catalina.core.StandardContext" 
debug="0" 
deployOnStartup="true" 
deployXML="true" 
domain="Catalina"
errorReportValveClass="org.apache.catalina.valves.ErrorReportValve"
liveDeploy="true" 
name="www.community-2.com" 
unpackWARs="true" 
xmlNamespaceAware="false" 
xmlValidation="false"&gt;
  &lt;Alias&gt;community-2.com&lt;/Alias&gt;
  &lt;Context path="/admin"  
   docBase="/usr/local/jakarta-tomcat/server/webapps/admin" 
   debug="0" privileged="true" /&gt;
  &lt;Context path="/manager" 
   docBase="/usr/local/jakarta-tomcat/server/webapps/manager" 
   debug="0" privileged="true" /&gt;
&lt;/Host&gt;

If the /manager context is accessed as http://community-2.com/manager/html it
results in listing the webapps for http://localhost:8080/manager/html which is
the default Host.  It should be showing the webapps for the Host which contains
the alias.

Gerry Reno</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40603</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-07-14 03:01:31 +0000</bug_when>
    <thetext>I think you should look into issues more before filing bugs. The problem here
was that alias mapping  was not implemented in the new mapper. The issue has
nothing to do with the manager webapp.
This has now been implemented, and will be in 5.0.4.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40607</commentid>
    <comment_count>2</comment_count>
    <who name="Gerry Reno">grenoml</who>
    <bug_when>2003-07-14 04:59:12 +0000</bug_when>
    <thetext>Remy,
  Do you expect that everyone knows that alias mapping was not implemented?  I
was just reporting behavior that seemed abnormal.  I hope you don't expect
everyone to sift through the HEAD and every possible discussion on dev where its
often not even clear exactly what things are being implemented.  I did some
searches on the lists for alias and manager and got lots of hits.  I read
through a reasonable number of these without locating any resolution so I opened
a bug.  Please excuse.

Gerry Reno


</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40619</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-07-14 09:40:17 +0000</bug_when>
    <thetext>Why not file the bug as "Host aliases are not mapped correctly" ? It should have
been clear for you too that the bug has nothing to do with the manager. Of
course, the issue here is very simple, so it's not a big issue.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40647</commentid>
    <comment_count>4</comment_count>
    <who name="Gerry Reno">grenoml</who>
    <bug_when>2003-07-14 15:45:02 +0000</bug_when>
    <thetext>Remy,
  Agreed, this bug is about alias mapping.  The manager was just being used to
illustrate the alias problem.  I'll change the summary title if the bug will
allow it.

Gerry Reno
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>21600</bug_id>
          
          <creation_ts>2003-07-15 05:58:00 +0000</creation_ts>
          <short_desc>&lt;Parameter&gt;'s lost after manager stop/start or reload</short_desc>
          <delta_ts>2006-06-11 18:01:39 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.4</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jacob Kjome">hoju</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>40697</commentid>
    <comment_count>0</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2003-07-15 05:58:43 +0000</bug_when>
    <thetext>I believe this was true with Tomcat-4.1.xx, but I'm posting this as a 5.x.x bug
since I doubt the behavior will be changed for 4.x.xx...

If one sets &lt;Parameter&gt; elements in a context configuration file (ccf), they
will be read upon webapp startup, but as soon as one stops/starts or reloads the
webapp via the Tomcat manager app, the prevously configured &lt;Parameter&gt;'s are
not taken into account.

For example, I have the following in my ccf...

&lt;Parameter name="log4j-log-home" value="C:\" override="true"/&gt;
&lt;Parameter name="log4j-sysprop-name" value="MyWebapp.log.home" override="true"/&gt;

Upon first startup, my webapp obtains this configuration information and reports...

Setting system property [ MyWebapp.log.home ] to [ C:\ ]


when I reload the webapp via the Tomcat manager app, I get the following...

No System property name provided. Please set the "log4j-sysprop-name" context
parameter.


I imagine this issue also applies to setting &lt;Environment&gt; and other elements
supported by ccf's as well.

Is this expected behavior?  I can't imagine it is.  I sure didn't expect it and
it makes it difficult to configure webapps and trust that they will continue to
stay configured througout the entirety of their deployment whether they are
reloaded or not.

Jake</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40976</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-07-19 16:17:13 +0000</bug_when>
    <thetext>No, you shouldn't assume anything, the JNDI resource are handled fine. The
ContextConfig was resetting the application parameters, which was wrong.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40985</commentid>
    <comment_count>2</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2003-07-19 18:22:12 +0000</bug_when>
    <thetext>Hi Remy,

Was the fix done for just Tomcat-5 or was it also applied to the Tomcat-4.1.xx
codebase?  Just wondering if I can expect future versions of Tomcat-4.1.xx to
work properly.

thanks,

Jake</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40986</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-07-19 18:30:30 +0000</bug_when>
    <thetext>The fix is currently only in Tomcat 5.
Note: I didn't actually test the fix (but the flaw in the code was evident, and
similar to previous flaws in JNDI resources handling).

If you'd like to experiment with Tomcat development, now would be the right time
to get the sources and test the fix :)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>41087</commentid>
    <comment_count>4</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2003-07-21 15:43:56 +0000</bug_when>
    <thetext>I tested the fix.  It seems to work great!  I'd suggest that this fix also be
added to the next release of Tomcat-4.1.xx since people will be using that as
the stable release of Tomcat for quite a while...especially while Tomcat-5 is
still in alpha state (pre-servlet 2.4 release).

Jake</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>21731</bug_id>
          
          <creation_ts>2003-07-19 16:27:00 +0000</creation_ts>
          <short_desc>Found some bugs at tester (FIX with patch)</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Tester</component>
          <version>Nightly Build</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Peter Rossbach">pr</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>40978</commentid>
    <comment_count>0</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2003-07-19 16:27:59 +0000</bug_when>
    <thetext>I found some bugs at tester modul at current tomcat 5 cvs 19.07.2003 state.

Two are not found:

Include Bug with RequestDesipatcher
TesterClient based on HttpUrlConnection can't read input with Status 500 
Response.
    Check with HttpClient 2.0.0 and it works in a simple env.

S. Dteail Patch and Report (attached)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40979</commentid>
    <comment_count>1</comment_count>
      <attachid>7391</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2003-07-19 16:29:05 +0000</bug_when>
    <thetext>Created attachment 7391
Patch to fix some Bugs at tester</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40980</commentid>
    <comment_count>2</comment_count>
      <attachid>7392</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2003-07-19 16:29:32 +0000</bug_when>
    <thetext>Created attachment 7392
BugReport</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40981</commentid>
    <comment_count>3</comment_count>
      <attachid>7393</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2003-07-19 16:31:16 +0000</bug_when>
    <thetext>Created attachment 7393
Simple Example with HttpClient to access and simulate HttpUrlConnection failure</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40982</commentid>
    <comment_count>4</comment_count>
      <attachid>7394</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2003-07-19 16:31:59 +0000</bug_when>
    <thetext>Created attachment 7394
tester build.properties for tomcat5</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40983</commentid>
    <comment_count>5</comment_count>
      <attachid>7395</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2003-07-19 16:32:38 +0000</bug_when>
    <thetext>Created attachment 7395
tester/bin/build.properties (example)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40984</commentid>
    <comment_count>6</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-07-19 16:41:48 +0000</bug_when>
    <thetext>Ok, thanks, that's useful.

There are mistakes in the patch: the failures in the lifecycle test are real
(but very minor) failures. I believe the JMX registration doesn't happen if the
init of a servlet fails, and so the new mapper (which uses JMX to update itself)
doesn't map the request to the servlet, which gives the 404.
About the include failure: it fails because of the invoker servlet.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40988</commentid>
    <comment_count>7</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-07-19 20:02:19 +0000</bug_when>
    <thetext>I'm in the process of applying your patches. Feel free to contribute more to the
tester: switch to HttpClient, new tests, etc.

Note: There's a socket mode in the current tester to fix the failures with 500
and error pages (use the protocol attribute of the tester task).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40994</commentid>
    <comment_count>8</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2003-07-20 06:58:16 +0000</bug_when>
    <thetext>I start to evaluate anteater with success! I now start to look deeper inside 
TestClient to migrate or getting it working.

OK: I start working at the Tester Module.
     Anteater can produce a XML Report and better Status mail
     I want start to have a active TestSuite with CruiseControl.

---

Analyse Lifecycle again and I see this at 

 org.apache.catalina.core.StandardWrapperFacade
  L.195
            } else if (available == Long.MAX_VALUE) {
                hres.sendError(HttpServletResponse.SC_NOT_FOUND,
                           sm.getString("standardWrapper.notFound",
                                        wrapper.getName()));
Hups! It look like that all permanent Unavailable Servlets send Status 404 !

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>40995</commentid>
    <comment_count>9</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-07-20 07:40:02 +0000</bug_when>
    <thetext>I'm not in favor of using yet another external tool for the tester, as it
currently doesn't justify it in terms of size or complexity (in socket mode, it
works ok). Now if you plan to contribute a lot to it to expand it, then it's
different (as lon as the tool has an appropriate license).

As for the unavailable, I think the 404 is right if it's permanent. It seems
logical. I'll have to check, but I remember there was a subtelty like that
introduced.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>41001</commentid>
    <comment_count>10</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2003-07-20 13:04:50 +0000</bug_when>
    <thetext>Let us write more tests and than we look around to other tools.

Can I help you to wrote more tests ?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>41004</commentid>
    <comment_count>11</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-07-20 15:10:57 +0000</bug_when>
    <thetext>Yes, sure. That kind of work could get you a committer account very fast :)

I fixed the remaining failures (except one, which is JSP related), so I'm
closing this bug.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>7391</attachid>
            <date>2003-07-19 16:29:00 +0000</date>
            <delta_ts>2003-07-19 16:29:05 +0000</delta_ts>
            <desc>Patch to fix some Bugs at tester</desc>
            <filename>tester.patch</filename>
            <type>text/plain</type>
            <size>10313</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>7392</attachid>
            <date>2003-07-19 16:29:00 +0000</date>
            <delta_ts>2003-07-19 16:29:32 +0000</delta_ts>
            <desc>BugReport</desc>
            <filename>Bugreport.txt</filename>
            <type>text/plain</type>
            <size>6984</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>7393</attachid>
            <date>2003-07-19 16:31:00 +0000</date>
            <delta_ts>2003-07-19 16:31:16 +0000</delta_ts>
            <desc>Simple Example with HttpClient to access and simulate HttpUrlConnection failure</desc>
            <filename>httpclient.zip</filename>
            <type>application/octet-stream</type>
            <size>250938</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>7394</attachid>
            <date>2003-07-19 16:31:00 +0000</date>
            <delta_ts>2003-07-19 16:31:59 +0000</delta_ts>
            <desc>tester build.properties for tomcat5</desc>
            <filename>build.properties</filename>
            <type>text/plain</type>
            <size>240</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>7395</attachid>
            <date>2003-07-19 16:32:00 +0000</date>
            <delta_ts>2003-07-19 16:32:38 +0000</delta_ts>
            <desc>tester/bin/build.properties (example)</desc>
            <filename>build.properties</filename>
            <type>text/plain</type>
            <size>48</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>21753</bug_id>
          
          <creation_ts>2003-07-21 00:20:00 +0000</creation_ts>
          <short_desc>Custom tags within multiline comments generate compile error</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords>PatchAvailable</keywords>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Eric Carmichael">ecarmich</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>41037</commentid>
    <comment_count>0</comment_count>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-07-21 00:20:54 +0000</bug_when>
    <thetext>Jasper generates incorrect Java code when compiling a JSP page which contains 
a custom tag inside a multiline comment, such as the following:

&lt;%@ taglib uri="/test" prefix="test" %&gt;

Hello World
&lt;%
/*
%&gt;

&lt;test:test/&gt;

&lt;%
*/
%&gt;

This is the error message return by the Java compiler:

Generated servlet error:
    [javac] Compiling 1 source file

C:\jakarta-tomcat-5
\build\work\Catalina\localhost\webapp\org\apache\jsp\test_jsp.java:76: illegal 
start of expression
*/
^

The problem is that generateCustomStartTag and generateCustomDoTag insert 
multiline comments of their own.  The Java compiler interprets the "*/" at the 
end of the inserted multiline comment as the end of the multiline comment from 
the JSP page, and returns an error when it finds the closing "*/" from the JSP 
page.

I will attach a patch that fixes this.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>41038</commentid>
    <comment_count>1</comment_count>
      <attachid>7411</attachid>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-07-21 00:22:26 +0000</bug_when>
    <thetext>Created attachment 7411
Proposed patch</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>41045</commentid>
    <comment_count>2</comment_count>
    <who name="">william.barker</who>
    <bug_when>2003-07-21 05:38:23 +0000</bug_when>
    <thetext>Now fixed in the CVS HEAD.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>7411</attachid>
            <date>2003-07-21 00:22:00 +0000</date>
            <delta_ts>2003-07-21 00:22:26 +0000</delta_ts>
            <desc>Proposed patch</desc>
            <filename>Bug21753patch.txt</filename>
            <type>text/plain</type>
            <size>1378</size>
            <attacher name="Eric Carmichael">ecarmich</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>21822</bug_id>
          
          <creation_ts>2003-07-23 09:29:00 +0000</creation_ts>
          <short_desc>Placing a Valve inside a Context gives Null Pointer Exception...</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.4</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Anil Bhatia">banil</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>41196</commentid>
    <comment_count>0</comment_count>
    <who name="Anil Bhatia">banil</who>
    <bug_when>2003-07-23 09:29:08 +0000</bug_when>
    <thetext>This was working in Tomcat 4.1.18, but is not working in 5.0.3 and 5.0.4

Placing a Valve inside the Context for admin.xml as follows:
-------------------------------------------------------------------
&lt;Context path="/admin" docBase="../server/webapps/admin"
        debug="0" privileged="true"&gt;
 
  &lt;Logger className="org.apache.catalina.logger.FileLogger"
             prefix="localhost_admin_log." suffix=".txt"
          timestamp="true"/&gt;

  &lt;Valve className="org.apache.catalina.valves.RequestDumperValve"/&gt;

&lt;/Context&gt;
-------------------------------------------------------------------
gives following Null Pointer Exception:

Jul 23, 2003 10:08:42 AM org.apache.catalina.core.StandardHostDeployer install
INFO: Installing web application from Config file URL file:D:\Tomcat5.0.4
\jakarta-tomcat-5\build\conf\Catalina\localhost\admin.xml
Jul 23, 2003 10:08:43 AM org.apache.catalina.core.StandardPipeline registerValve
INFO: Can't register valve RequestDumperValve[/admin]
java.lang.NullPointerException
        at org.apache.catalina.valves.ValveBase.createObjectName
(ValveBase.java:292)
        at org.apache.catalina.core.StandardPipeline.registerValve
(StandardPipeline.java:357)
        at org.apache.catalina.core.StandardPipeline.addValve
(StandardPipeline.java:492)
        at org.apache.catalina.core.ContainerBase.addValve
(ContainerBase.java:1306)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke
(NativeMethodAccessorImpl.java:39)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke
(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at org.apache.commons.beanutils.MethodUtils.invokeMethod
(MethodUtils.java:252)
        at org.apache.commons.digester.SetNextRule.end(SetNextRule.java:256)
        at org.apache.commons.digester.Rule.end(Rule.java:276)
        at org.apache.commons.digester.Digester.endElement(Digester.java:1058)
        at org.apache.crimson.parser.Parser2.maybeElement(Parser2.java:1536)
        at org.apache.crimson.parser.Parser2.content(Parser2.java:1779)
        at org.apache.crimson.parser.Parser2.maybeElement(Parser2.java:1507)
        at org.apache.crimson.parser.Parser2.parseInternal(Parser2.java:500)
        at org.apache.crimson.parser.Parser2.parse(Parser2.java:305)
        at org.apache.crimson.parser.XMLReaderImpl.parse(XMLReaderImpl.java:442)
        at org.apache.commons.digester.Digester.parse(Digester.java:1567)
        at org.apache.catalina.core.StandardHostDeployer.install
(StandardHostDeployer.java:515)
        at org.apache.catalina.core.StandardHost.install(StandardHost.java:869)
        at org.apache.catalina.startup.HostConfig.deployDescriptors
(HostConfig.java:519)
        at org.apache.catalina.startup.HostConfig.deployApps
(HostConfig.java:470)
        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:920)
        at org.apache.catalina.startup.HostConfig.lifecycleEvent
(HostConfig.java:399)
        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent
(LifecycleSupport.java:166)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1135)
        at org.apache.catalina.core.StandardHost.start(StandardHost.java:795)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1127)
        at org.apache.catalina.core.StandardEngine.start
(StandardEngine.java:502)
        at org.apache.catalina.core.StandardService.start
(StandardService.java:519)
        at org.apache.catalina.core.StandardServer.start
(StandardServer.java:2312)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:577)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke
(NativeMethodAccessorImpl.java:39)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke
(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)
Jul 23, 2003 10:08:43 AM org.apache.struts.util.PropertyMessageResources &lt;init&gt;
INFO: Initializing, config='org.apache.struts.util.LocalStrings', 
returnNull=true
-------------------------------------------------------------------------
Got same exception when placed a Context having a Valve inside server.xml.
Placing a Valve inside a Host seems to work fine.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>41204</commentid>
    <comment_count>1</comment_count>
    <who name="Anil Bhatia">banil</who>
    <bug_when>2003-07-23 11:55:27 +0000</bug_when>
    <thetext>Analysis of the problem:
In ValveBase::createObjectName line 292, host is expected to have a non-null 
value. This will happen only if parent has been set for the current Context 
that has a Valve definition.

This call can be traced back to org.apache.catalina.core.ContainerBase.addValve
(ContainerBase.java:1306), which can be further traced back to 
org.apache.commons.digester.SetNextRule.end(SetNextRule.java:256).

If we look at ContextRuleSet::addRuleInstances, (line 248) statement:
digester.addObjectCreate(prefix + "Context/Valve",
                                 null, // MUST be specified in the element
                                 "className");
is setting the corresponding Rule whose later execution (*end*) leads to NPE.

Another statement in same method (line 164):
            digester.addSetNext(prefix + "Context",
                                "addChild",
                                "org.apache.catalina.Container");
is responsible for correctly setting the parent-child relationship between Host 
and the current Context. But before the *end* of this Rule can be called, the 
*end* of the previous Rule gets called leading to NPE.

Hence, if we decide to retain the statement (line 291) 
Host host = (Host) container.getParent(); 
in ValveBase::createObjectName, then we should make sure that this call would 
return a non-null Host reference.

One of the ways to achieve this is the following modification:
--------------------------------------------------------------------
--- Tomcat5.0.4\jakarta-tomcat-
catalina\catalina\src\share\org\apache\catalina\startup\SetDocBaseRule.java
	Mon Jul 14 20:54:26 2003
+++ Modified\Tomcat5.0.4\jakarta-tomcat-
catalina\catalina\src\share\org\apache\catalina\startup\SetDocBaseRule.java
	Wed Jul 23 17:13:10 2003
@@ -127,6 +127,8 @@
         }
         String appBase = host.getAppBase();
 
+        child.setParent(host);
+
         if (!(host instanceof StandardHost)) {
             return;
         }
---------------------------------------------------------------------

An additional call to child.setParent(host) in *begin* will make sure that 
later call to getParent() returns a non-null Host reference.

Of course, there could be other ways to fix this problem.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>41219</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-07-23 13:37:48 +0000</bug_when>
    <thetext>Yes, there was one last bug with discrepancies between the pipeline lifecycle
and the JMX registration of the valves.
Hopefully, that's the last bug of this kind (I had fixed a similar, more serious
bug, in 5.0.3).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>41272</commentid>
    <comment_count>3</comment_count>
    <who name="Anil Bhatia">banil</who>
    <bug_when>2003-07-24 04:39:25 +0000</bug_when>
    <thetext>Verified the fix in StandardPipeline. It works fine.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>21823</bug_id>
          
          <creation_ts>2003-07-23 10:03:00 +0000</creation_ts>
          <short_desc>Compiler uses invoking page's PageInfo for handling tag files</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.4</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords>PatchAvailable</keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Matthias Ernst">ernst.matthias</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>41198</commentid>
    <comment_count>0</comment_count>
    <who name="Matthias Ernst">ernst.matthias</who>
    <bug_when>2003-07-23 10:03:49 +0000</bug_when>
    <thetext>When Jasper finds a tagfile invocation, it'll find its TagInfo through calls to 
ImplicitTagLibraryInfo#getTagFile -&gt; TagFileProcessor#parseTagFileDirectives -&gt; 
ParserController#parseTagFileDirectives -&gt; ... -&gt; ParserController#determineSyntaxAndEncoding 
-&gt; PageInfo#isXmlConfig() and friends. However, the *current* ParserController is used so that the 
PageInfo is that of the *calling* page and not the called tagfile.

Consequently the wrong jsp-property group will be consulted.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>41543</commentid>
    <comment_count>1</comment_count>
      <attachid>7526</attachid>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-07-26 02:22:19 +0000</bug_when>
    <thetext>Created attachment 7526
Proposed patch</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>41544</commentid>
    <comment_count>2</comment_count>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-07-26 02:23:31 +0000</bug_when>
    <thetext>The patch attached above fixes this.  It also removes PageInfo's 
isXmlConfigSpecified and isXmlConfig variables, and all references to them, as 
the fix eliminated the only code that used their values.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>41647</commentid>
    <comment_count>3</comment_count>
    <who name="Matthias Ernst">ernst.matthias</who>
    <bug_when>2003-07-28 12:45:37 +0000</bug_when>
    <thetext>Works like a charm. Thanks a lot. Please incorporate.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>7526</attachid>
            <date>2003-07-26 02:22:00 +0000</date>
            <delta_ts>2003-07-26 02:22:19 +0000</delta_ts>
            <desc>Proposed patch</desc>
            <filename>Bug21823patch.txt</filename>
            <type>text/plain</type>
            <size>4099</size>
            <attacher name="Eric Carmichael">ecarmich</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>21917</bug_id>
          
          <creation_ts>2003-07-27 23:35:00 +0000</creation_ts>
          <short_desc>TldConfig.java does not set SystemId</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.5</version>
          <rep_platform>All</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Dave">apache</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>41611</commentid>
    <comment_count>0</comment_count>
    <who name="Dave">apache</who>
    <bug_when>2003-07-27 23:35:44 +0000</bug_when>
    <thetext>Trying to use entities in tld xml file, XML parser throws:

org.xml.sax.SAXParseException: Relative URI "entities/converter_attributes.xml";
can not be resolved without a base URI.

The problem seems to be caused by calling digester.parse(InputStream) method
instead of digester.parse(InputSource) one. To fix this, must change
TldConfig.tldScanStream to accept InputSource instead of InputStream.
Respectively, tldScanJar() and tldScanTld() need trivial changes to pass
InputSource.

Same bug exists in Tomcat 4.x as well. Should I enter the same bug there?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42019</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-03 11:06:55 +0000</bug_when>
    <thetext>Can you submit a patch to implement this ?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42664</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-13 07:35:24 +0000</bug_when>
    <thetext>This has now been fixed.</thetext>
  </long_desc>
      
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>21970</bug_id>
          
          <creation_ts>2003-07-29 15:10:00 +0000</creation_ts>
          <short_desc>URL's referencing directories without trailing slash redirected to ROOT context</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.5</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jacob Kjome">hoju</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>41719</commentid>
    <comment_count>0</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2003-07-29 15:10:39 +0000</bug_when>
    <thetext>Given a typed URL such as:
http://localhost:8080/tomcat-docs/appdev

Expected redirection:
http://localhost:8080/tomcat-docs/appdev/

Actual redirection:
http://localhost:8080/appdev/

The context is being stripped off upon redirection.

Jake</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>41720</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-07-29 15:16:49 +0000</bug_when>
    <thetext>I suppose it's easier to file the bug after seeing the corresponding commit.

remm        2003/07/29 05:15:47

  Modified:    util/java/org/apache/tomcat/util/http/mapper Mapper.java
  Log:
  - Fix a bug redirecting to a folder: the context path was lost.
    (ex: /tomcat-docs/images -&gt; /tomcat-docs/images/ - previsouly, it would
    get redirected to /images)
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>21978</bug_id>
          
          <creation_ts>2003-07-29 18:43:00 +0000</creation_ts>
          <short_desc>Certain tag file pathnames lead to compile errors</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords>PatchAvailable</keywords>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Eric Carmichael">ecarmich</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>41728</commentid>
    <comment_count>0</comment_count>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-07-29 18:43:35 +0000</bug_when>
    <thetext>Tomcat can't compile certain tag files:

1) Tag files whose relative pathname contains a component (one of the 
directories, or the filename without the ".tag" suffix) which is not a legal 
Java identifier.  Tomcat converts the relative pathname to a fully-qualified 
class name, and if the parts aren't all legal Java identifiers, the Java 
compiler will throw an error.

2) Tag files in /&lt;some_directories&gt;/&lt;immediate_parent_directory&gt;/ when there's 
a tag file in /&lt;some_directories&gt;/ with 
filename "&lt;immediate_parent_directory&gt;.tag".  Here the problem is that the 
package of the tag files in /&lt;some_directories&gt;/&lt;immediate_parent_directory&gt;/ 
clashes with the class of the "&lt;immediate_parent_directory&gt;.tag" tag file.  
For instance, the tag file /WEB-INF/tags/foo/bar.tag will have package name 
org.apache.jsp.tag.web.foo, which conflicts with the fully-qualified class 
name of the tag file /WEB-INF/tags/foo.tag.

I will attach a patch that fixes this.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>41729</commentid>
    <comment_count>1</comment_count>
      <attachid>7563</attachid>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-07-29 18:45:15 +0000</bug_when>
    <thetext>Created attachment 7563
Proposed patch</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>41741</commentid>
    <comment_count>2</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-07-29 23:26:48 +0000</bug_when>
    <thetext>Patch applied.  I also added checks for Java keywords in the package names. 
Thanks.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>41747</commentid>
    <comment_count>3</comment_count>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-07-30 02:51:14 +0000</bug_when>
    <thetext>Good catch on checking for Java keywords.  That also makes it possible to 
refactor getDerivedPackageName and eliminate some duplicate code.  I will 
attach a patch implementing this.

No issues whatsoever with your commit fixing the bug I reported, so if you 
don't think the new patch makes the code cleaner, feel free to change this bug 
ticket back to "Resolved/Fixed".</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>41748</commentid>
    <comment_count>4</comment_count>
      <attachid>7574</attachid>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-07-30 02:52:14 +0000</bug_when>
    <thetext>Created attachment 7574
Refactoring getDerivedPackageName()</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>41795</commentid>
    <comment_count>5</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-07-30 17:38:53 +0000</bug_when>
    <thetext>I thought about refactoring that part, but was too lazy to actually do it.  Glad
that you did though.  Thanks.
</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>7563</attachid>
            <date>2003-07-29 18:45:00 +0000</date>
            <delta_ts>2003-07-29 18:45:15 +0000</delta_ts>
            <desc>Proposed patch</desc>
            <filename>Bug21978patch.txt</filename>
            <type>text/plain</type>
            <size>8636</size>
            <attacher name="Eric Carmichael">ecarmich</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>7574</attachid>
            <date>2003-07-30 02:52:00 +0000</date>
            <delta_ts>2003-07-30 02:52:14 +0000</delta_ts>
            <desc>Refactoring getDerivedPackageName()</desc>
            <filename>Bug21978refactoringpatch.txt</filename>
            <type>text/plain</type>
            <size>4341</size>
            <attacher name="Eric Carmichael">ecarmich</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>22006</bug_id>
          
          <creation_ts>2003-07-31 00:06:00 +0000</creation_ts>
          <short_desc>Invalid SMAP line entries when running with mappedfile=true</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.5</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords>PatchAvailable</keywords>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jason Schulz">jschulz</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>41813</commentid>
    <comment_count>0</comment_count>
    <who name="Jason Schulz">jschulz</who>
    <bug_when>2003-07-31 00:06:17 +0000</bug_when>
    <thetext>I'm running Tomcat5.0.5 with JspServlet options "mappedfile=true" 
and "dumpSmap=true".  The SMAP file appears to be incorrect for HTML sections 
of the servlet.

For example, take the following trivial JSP (shown with line numbers):
1 &lt;head&gt;
2   &lt;title&gt;My Title&lt;/title&gt;
3 
4 &lt;/head&gt;

The corresponding lines in the generated servlet are:
40      out.write("&lt;head&gt;\n");
41      out.write("  ");
42      out.write("&lt;title&gt;My Title");
43      out.write("&lt;/title&gt;\n");
44      out.write("\n");
45            out.write("&lt;/head&gt;");

Actual LineInfo section of the SMAP file:
*L
1:40,2
2:42
2:43,2
4:45

Expected LineInfo section:
*L
1:40
2:41,3
3:44
4:45</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42038</commentid>
    <comment_count>1</comment_count>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-08-04 06:43:38 +0000</bug_when>
    <thetext>There are two reasons the Actual LineInfo differs from the Expected LineInfo:

1) When a TemplateText node spans more than one line in the JSP, Jasper SMAPs 
it as if all of the node's output source was generated by the first line of 
the node's input source, and the other lines in the node's input source 
contributed nothing.

2) Jasper SMAPs each node independently of the others, and makes no attempt to 
consolidate the resulting line section.  I'm not sure consolidation is 
actually required by the spec, but it reduces the size of the class files, so 
it's a good thing to do.

I will attach a patch that fixes both of these.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42039</commentid>
    <comment_count>2</comment_count>
      <attachid>7636</attachid>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-08-04 06:44:49 +0000</bug_when>
    <thetext>Created attachment 7636
Proposed patch</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42472</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-09 19:22:46 +0000</bug_when>
    <thetext>I've applied the patch, thanks.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>7636</attachid>
            <date>2003-08-04 06:44:00 +0000</date>
            <delta_ts>2003-08-04 06:44:49 +0000</delta_ts>
            <desc>Proposed patch</desc>
            <filename>Bug22006patch.txt</filename>
            <type>text/plain</type>
            <size>8267</size>
            <attacher name="Eric Carmichael">ecarmich</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>22032</bug_id>
          
          <creation_ts>2003-07-31 20:24:00 +0000</creation_ts>
          <short_desc>missing security-policy in default-configuration</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.0.5</version>
          <rep_platform>Other</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Matthias Mezger">mezger</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>41903</commentid>
    <comment_count>0</comment_count>
    <who name="Matthias Mezger">mezger</who>
    <bug_when>2003-07-31 20:24:09 +0000</bug_when>
    <thetext>when starting tomcat 5.0.5 with security-manager enabled (standard distribution,
no configuration-changes, just catalina.sh start -security), it throws an
java.security.AccessControlException when accessing any jsp-page (even
index.jsp). Adding the following lines to conf/catalina.policy resolved the
problem for me:

permission java.lang.RuntimePermission
"accessClassInPackage.org.apache.jasper.runtime";
permission java.lang.RuntimePermission
"accessClassInPackage.org.apache.jasper.juntime.*";
permission java.lang.RuntimePermission
"defineClassInPackage.org.apache.jasper.runtime";
permission java.lang.RuntimePermission
"defineClassInPackage.org.apache.jasper.runtime.*";

The stack-trace of the excepion is:

java.security.AccessControlException: access denied (java.lang.RuntimePermission
accessClassInPackage.org.apache.jasper.runtime)
        at
java.security.AccessControlContext.checkPermission(AccessControlContext.java:270)
        at java.security.AccessController.checkPermission(AccessController.java:401)
        at java.lang.SecurityManager.checkPermission(SecurityManager.java:542)
        at java.lang.SecurityManager.checkPackageAccess(SecurityManager.java:1513)
        at java.lang.ClassLoader$1.run(ClassLoader.java:326)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.lang.ClassLoader.checkPackageAccess(ClassLoader.java:324)
        at java.lang.ClassLoader.defineClass0(Native Method)
        at java.lang.ClassLoader.defineClass(ClassLoader.java:502)
        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:123)
        at
org.apache.catalina.loader.WebappClassLoader.findClassInternal(WebappClassLoader.java:1657)
        at
org.apache.catalina.loader.WebappClassLoader.findClass(WebappClassLoader.java:882)
        at
org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1345)
        at
org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1225)
        at org.apache.catalina.core.StandardWrapper$1.run(StandardWrapper.java:951)
        at java.security.AccessController.doPrivileged(Native Method)
        at
org.apache.catalina.core.StandardWrapper.loadServlet(StandardWrapper.java:947)
        at
org.apache.catalina.core.StandardWrapper.allocate(StandardWrapper.java:701)
        at
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:183)
        at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
        at
org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)
        at
org.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:256)
        at
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:210)
        at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
        at
org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)
        at
org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:190)
        at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
        at
org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:175)
        at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)
        at
org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)
        at
org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:156)
        at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
        at
org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)
        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:974)
        at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:207)
        at
org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:637)
        at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:488)
        at
org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:568)
        at
org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:631)
        at java.lang.Thread.run(Thread.java:536)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>41905</commentid>
    <comment_count>1</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2003-07-31 20:46:47 +0000</bug_when>
    <thetext>As a better worksaround, in conf/catalina.properties, remove the jasper package
from the list of protected packages. I will investigate why this exception is
thrown.

Thanks,

-- Jeanfrancois</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>41916</commentid>
    <comment_count>2</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2003-08-01 00:36:23 +0000</bug_when>
    <thetext>Nice catch. The problem occurs only when precompiled JSPs are used (Source JSP
doesn't have the problem). I have modified your patch (we don't need to give
defineClassInPackage permission).

Thanks again.

-- Jeanfrancois</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>41961</commentid>
    <comment_count>3</comment_count>
    <who name="Matthias Mezger">mezger</who>
    <bug_when>2003-08-01 15:07:36 +0000</bug_when>
    <thetext>OK, but the problem occured not only with precompiled JSPs. For me, even the
standard tomcat webapps/index.jsp and all of the jsp-examples threw this
exception. I think this shouldn't be the default behaviour with a fresh
installed tomcat using the security manager.
Thanks for the workaround with removing the jasper-package from the
catalina.properties file. I hope this doesn't open any security holes...</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>22058</bug_id>
          
          <creation_ts>2003-08-01 15:25:00 +0000</creation_ts>
          <short_desc>incorrect JSP compilation</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.5</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Gilles Scokart">gilles.scokart</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>1</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>41964</commentid>
    <comment_count>0</comment_count>
    <who name="Gilles Scokart">gilles.scokart</who>
    <bug_when>2003-08-01 15:25:13 +0000</bug_when>
    <thetext>I have a simple JSP that use a custom tag (file) writen by extending 
SimpleTagSupport.

Here is the JSP :
&lt;%@ taglib uri="c-rt.tld" prefix="b" %&gt;
&lt;%@ taglib uri="templater.tld" prefix="t" %&gt;


&lt;b:forEach begin="0" end="10"&gt;
	&lt;t:file name="t"&gt;
		&lt;b:if test="true"&gt;
		&lt;/b:if&gt;
	&lt;/t:file&gt;
&lt;/b:forEach&gt;

The generated code doesn't compile.  The error is:
_jspx_push_body_count_b_forEach_0 cannot be resolved (in the function invoke_0)

Here is an extract of the generated code:

 private class test_jspHelper
      extends org.apache.jasper.runtime.JspFragmentHelper
  {
    private javax.servlet.jsp.tagext.JspTag parentTag;

    public test_jspHelper( int discriminator, JspContext jspContext, 
javax.servlet.jsp.tagext.JspTag parentTag ) {
      super( discriminator, jspContext, parentTag );
      this.parentTag = parentTag;
    }
    public boolean invoke0( java.io.Writer out ) 
      throws Throwable
    {
      javax.servlet.jsp.tagext.JspTag _jspx_th_t_file_0 = parentTag;
      out.write("\r\n\t\t");
      if (_jspx_meth_b_if_0(_jspx_th_t_file_0, pageContext, 
_jspx_push_body_count_b_forEach_0))
        return true;
      out.write("\r\n\t");
      return false;
    }
    public void invoke( java.io.Writer writer )
      throws javax.servlet.jsp.JspException
    {
      java.io.Writer out = null;
      if( writer != null ) {
        out = this.jspContext.pushBody(writer);
      } else {
        out = this.jspContext.getOut();
      }
      try {
        switch( this.discriminator ) {
          case 0:
            invoke0( out );
            break;
        }
      }
      catch( Throwable e ) {
        if (e instanceof javax.servlet.jsp.SkipPageException)
            throw (javax.servlet.jsp.SkipPageException) e;
        throw new javax.servlet.jsp.JspException( e );
      }
      finally {
        if( writer != null ) {
          this.jspContext.popBody();
        }
      }
    }</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42716</commentid>
    <comment_count>1</comment_count>
      <attachid>7812</attachid>
    <who name="Gilles Scokart">gilles.scokart</who>
    <bug_when>2003-08-14 07:26:50 +0000</bug_when>
    <thetext>Created attachment 7812
Sources</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43486</commentid>
    <comment_count>2</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-08-29 22:01:23 +0000</bug_when>
    <thetext>Hmm... The attached war file does not seem to contain the JSP page you quoted.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43534</commentid>
    <comment_count>3</comment_count>
    <who name="Gilles Scokart">gilles.scokart</who>
    <bug_when>2003-09-01 06:47:28 +0000</bug_when>
    <thetext>It's "test1.jsp" in the .zip</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43625</commentid>
    <comment_count>4</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-09-02 18:23:18 +0000</bug_when>
    <thetext>The codes generated from the latest nightly build does not contain a reference
to _jspx_push_body_count_b_forEach_0 in invoke0, and the page was successfully
compiled, so I consider this bug fixed.  You can verify that with 5.0.9.

However at request tim, I did get a ClassCastException on
templater.jsp.tag.FileTag.doTag(FileTag.java:20)

      TemplatePageContext ctx = (TemplatePageContext) getJspContext();

but that's in your code.

Next time you should provide a war file; that'll let me get to debugging
quicker.

Also, you should use jstl 1.1 instead of jstl 1.0.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43722</commentid>
    <comment_count>5</comment_count>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-09-04 15:12:26 +0000</bug_when>
    <thetext>I'm still seeing this problem, with latest CVS and with 5.0.9.  I will attach 
a .war file that reproduces the problem against 5.0.9.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43723</commentid>
    <comment_count>6</comment_count>
      <attachid>8063</attachid>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-09-04 15:14:03 +0000</bug_when>
    <thetext>Created attachment 8063
.war that reproduces the problem against 5.0.9</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>7812</attachid>
            <date>2003-08-14 07:26:00 +0000</date>
            <delta_ts>2003-08-14 07:26:50 +0000</delta_ts>
            <desc>Sources</desc>
            <filename>test.zip</filename>
            <type>application/octet-stream</type>
            <size>477173</size>
            <attacher name="Gilles Scokart">gilles.scokart</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>8063</attachid>
            <date>2003-09-04 15:14:00 +0000</date>
            <delta_ts>2003-09-04 15:14:03 +0000</delta_ts>
            <desc>.war that reproduces the problem against 5.0.9</desc>
            <filename>Bugzilla22058.war</filename>
            <type>application/octet-stream</type>
            <size>478425</size>
            <attacher name="Eric Carmichael">ecarmich</attacher>
            

          </attachment>
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>22084</bug_id>
          
          <creation_ts>2003-08-02 19:58:00 +0000</creation_ts>
          <short_desc>JSP compiler incorrectly indents code</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords>PatchAvailable</keywords>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Eric Carmichael">ecarmich</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>42008</commentid>
    <comment_count>0</comment_count>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-08-02 19:58:05 +0000</bug_when>
    <thetext>If the text in a TemplateText node ends in "\n", then if the mappedfile init 
parameter is set to true, or the line length exceeds CHUNKSIZE, the first line 
of Java code generated from the succeeding node will be indented too far.

The problem is that when visit(Node.TemplateText n) in Generator.java sees 
the "\n", it finishes the current line, and then calls out.printin() in order 
to properly indent the text that follows.  This works fine if there is text 
that follows, but if there isn't, the effect is to overindent the first line 
in whatever code is generated by the next node to be visited.

I will attach a patch that fixes this.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42009</commentid>
    <comment_count>1</comment_count>
      <attachid>7627</attachid>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-08-02 19:59:36 +0000</bug_when>
    <thetext>Created attachment 7627
Proposed patch</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42013</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-03 09:11:03 +0000</bug_when>
    <thetext>This seems reasonable, and I have applied the patch. Thanks.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>7627</attachid>
            <date>2003-08-02 19:59:00 +0000</date>
            <delta_ts>2003-08-02 19:59:36 +0000</delta_ts>
            <desc>Proposed patch</desc>
            <filename>Bug22084patch.txt</filename>
            <type>text/plain</type>
            <size>943</size>
            <attacher name="Eric Carmichael">ecarmich</attacher>
            

          </attachment>
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>22090</bug_id>
          
          <creation_ts>2003-08-03 10:45:00 +0000</creation_ts>
          <short_desc>EL evaluation should cache parse results</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.5</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Matthias Ernst">ernst.matthias</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>42017</commentid>
    <comment_count>0</comment_count>
    <who name="Matthias Ernst">ernst.matthias</who>
    <bug_when>2003-08-03 10:45:35 +0000</bug_when>
    <thetext>EL expressions are parsed on every evaluation. PageContextImpl uses an ExpressionEvaluator with 
bypassCaches=true. Either the standard caches should be used OR rather, a compiled page should 
hold parsed expressions in static fields. Then contention on the caches could be avoided, too.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42018</commentid>
    <comment_count>1</comment_count>
      <attachid>7630</attachid>
    <who name="Matthias Ernst">ernst.matthias</who>
    <bug_when>2003-08-03 10:47:16 +0000</bug_when>
    <thetext>Created attachment 7630
enable caches</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42045</commentid>
    <comment_count>2</comment_count>
    <who name="Matthias Ernst">ernst.matthias</who>
    <bug_when>2003-08-04 09:24:38 +0000</bug_when>
    <thetext>Evidence (threaddumps) supports that the problem is not the parsing performance
per se, but the allocation of three (8k+16k+16k) buffers per parser invocation:

SimpleCharStream.java:
#245:    buffer = new char[buffersize];
#246:    bufline = new int[buffersize];
#247:    bufcolumn = new int[buffersize];

"tcpConnection-8001-14" daemon prio=1 tid=0x4e102df8 nid=0x33ca waiting for
monitor entry [bbdfe000..bbdff908]
        at
org.apache.commons.el.parser.SimpleCharStream.&lt;init&gt;(SimpleCharStream.java:245)
        at
org.apache.commons.el.parser.SimpleCharStream.&lt;init&gt;(SimpleCharStream.java:253)
        at org.apache.commons.el.parser.ELParser.&lt;init&gt;(ELParser.java:1721)

This is kind of a commons/el problem, not a jasper one. I will try to patch el
to use smaller buffers (which expression is 4k???). If that improves matters, I
might close this report although I still consider it valid.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42046</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-04 09:35:39 +0000</bug_when>
    <thetext>Good findings.

I think those buffers should be owned by another component (Jasper's
PageContextImpl IMO), and passed to commons-el), to allow reuse and avoid the
allocation. This could be optional (commons-el would allocate buffers if none
are passed): a new constructor would simply need to be added.

Buffers bigger than 1K take a significant amount of time to allocate (and making
them too small might impact functionality), so even 4K would be too big IMO.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42049</commentid>
    <comment_count>4</comment_count>
    <who name="Matthias Ernst">ernst.matthias</who>
    <bug_when>2003-08-04 10:53:56 +0000</bug_when>
    <thetext>Some measurements:

1. no el cache, parser default buffers: 40 req/s, 1.8m/s
2. no el cache, small parser buffers: 90req/s, 3.7m/s
3. el cache: 200req/s, 8m/s
4. non-synchronized el-cache (simulates parsed expression trees stored per
tagfile instance): 210req/s, 8.5m/s

linux dual proc, 100mbit ethernet, j2sdk 1.4.2, resin 2.1.9, jasper 5.0.6
page data completely in memory, ~70 simple el evaluations, 40k html

still voting for option 3 or 4.
last post on this subject.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42060</commentid>
    <comment_count>5</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-04 12:30:45 +0000</bug_when>
    <thetext>Well, I thought your second post meant that the benefit of using caching was
offset by some buffer allocation. Looking at the code, the allocation doesn't
seem to happen with the cache, so there's no problem.
Your patch seems good, sorry for the misunderstanding.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>7630</attachid>
            <date>2003-08-03 10:47:00 +0000</date>
            <delta_ts>2003-08-03 10:47:16 +0000</delta_ts>
            <desc>enable caches</desc>
            <filename>patch</filename>
            <type>text/plain</type>
            <size>572</size>
            <attacher name="Matthias Ernst">ernst.matthias</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>22103</bug_id>
          
          <creation_ts>2003-08-04 10:31:00 +0000</creation_ts>
          <short_desc>JspC.execute do not close files</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.6</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Gilles Scokart">gilles.scokart</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>42048</commentid>
    <comment_count>0</comment_count>
    <who name="Gilles Scokart">gilles.scokart</who>
    <bug_when>2003-08-04 10:31:03 +0000</bug_when>
    <thetext>When there is an error in the JSP file, and the JSP compiler is invoked from an 
ANT script via JspC.execute(), the opened files are not closed.

What seems to happen is that the java output files is created and opened, the 
error in the JSP is detected and an exception is trigered without closing the 
opened files.

That raise problems when the ANT script is called from an IDE (like eclipse) 
that does'nt use a separate JVM to execute it.  In that case, the created empty 
file can not be deleted without closing the IDE.

Is it possible to add a finally clause somewhere to always close all opened 
files, even in case of errors ?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42062</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-04 12:43:03 +0000</bug_when>
    <thetext>Since you seem to have looked into the problem in detail, could you submit a
small patch ?
Otherwise, can you give more details on where the leak come from ?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42063</commentid>
    <comment_count>2</comment_count>
    <who name="Gilles Scokart">gilles.scokart</who>
    <bug_when>2003-08-04 13:12:41 +0000</bug_when>
    <thetext>Oups, sorry I can not send you a patch.  But I have look in the source, and I 
think that if you update the org.apache.jasper.compiler.Compiler.compile
(boolean) method by insterting

if (ctx.getWriter()!=null)
{
   ctx.getWriter().close();
   ctx.setWriter(null);
}

in the finally clause.

BTW, how can I give you patch if I don't have a CVS client?
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42079</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-04 15:12:22 +0000</bug_when>
    <thetext>Ok, the proposed change seems reasonable to me. Thanks. I assume you have
verified it fixes your problem.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42080</commentid>
    <comment_count>4</comment_count>
    <who name="Gilles Scokart">gilles.scokart</who>
    <bug_when>2003-08-04 15:22:38 +0000</bug_when>
    <thetext>Unfortunately, no.  I didn't have all the environment (and/or the time) I need 
to recompile and test the fix.  But as you said, it seems reasonable.

Thanks.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>22133</bug_id>
          
          <creation_ts>2003-08-05 12:44:00 +0000</creation_ts>
          <short_desc>Scoping conflict for generated fragment helpers</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.6</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Matthias Ernst">ernst.matthias</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>42148</commentid>
    <comment_count>0</comment_count>
    <who name="Matthias Ernst">ernst.matthias</who>
    <bug_when>2003-08-05 12:44:58 +0000</bug_when>
    <thetext>A JSP Fragment in a tag file that does EL may lead to problematic Java code.

JSP Fragments of tag files are compiled into inner classes:

  public final class com_coremedia_jsp_NewsTicker_body_tag
    extends javax.servlet.jsp.tagext.SimpleTagSupport
  {
    ...

    private class com_coremedia_jsp_NewsTicker_body_tagHelper
      extends org.apache.jasper.runtime.JspFragmentHelper
    {
      ...
      public void invoke0( java.io.Writer out ) 
        throws Throwable
      {
         ...
        
out.write((java.lang.String)org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${rows}",
java.lang.String.class, (PageContext)getJspContext(), null, false)); &lt;&lt;&lt;&lt;&lt;&lt;
         ...
      }
    }

Both javac 1.3 and Eclipse's JDT compiler flag the call to #getJspContext as
invalid as this method is both inherited and defined in the enclosing class: 

  com_coremedia_jsp_NewsTicker_body_tag.java:206: getJspContext() is inherited  
  from org.apache.jasper.runtime.JspFragmentHelper and hides method in outer  
  class org.apache.jsp.tag.web.com_coremedia_jsp_NewsTicker_body_tag.  An  
  explicit 'this' qualifier must be used to select the desired instance.

Javac 1.4.2 accepts this code and calls the inherited method.

From my interpretation of the JLS, 1.4.2's behaviour seems correct and is the
intended one, but the code won't be compilable with javac 1.3.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42149</commentid>
    <comment_count>1</comment_count>
    <who name="Matthias Ernst">ernst.matthias</who>
    <bug_when>2003-08-05 12:50:17 +0000</bug_when>
    <thetext>The following patch resolves _this specific_ problem but there might be other
implicit calls to 'this' lurking around:

====
//coremedia/thirdparty/apache/jakarta-jasper2/src/share/org/apache/jasper/compiler/JspUtil.java#2
-
/home/mernst/p4/main/thirdparty/apache/jasper2/src/share/org/apache/jasper/compiler/JspUtil.java
====
@@ -534,7 +534,7 @@
          */
        String jspCtxt = null;
        if (isTagFile)
-           jspCtxt = "getJspContext()";
+           jspCtxt = "this.getJspContext()";
        else
            jspCtxt = "pageContext";
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42235</commentid>
    <comment_count>2</comment_count>
    <who name="Matthias Ernst">ernst.matthias</who>
    <bug_when>2003-08-06 08:11:59 +0000</bug_when>
    <thetext>You can switch eclipse's compiler's "compliance" to 1.4 (what a multifaced beast !). Then it'll 
compile that code.

The issue with 1.3 remains. How important is Jdk 1.3 compliance rated, by the way ?
 </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42239</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-06 10:23:28 +0000</bug_when>
    <thetext>Ok, so your patch resolves JDK 1.3 compatibility then ?
JDK 1.3 compatibility is important. the whole J2EE requires 1.4 now, but the web
tier can (and should) still attempt to work with 1.3.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42240</commentid>
    <comment_count>4</comment_count>
    <who name="Matthias Ernst">ernst.matthias</who>
    <bug_when>2003-08-06 10:32:18 +0000</bug_when>
    <thetext>Well, my patch resolves the issue for this particular call to #getJspContext(). In general all 
unqualified method calls that resolve to methods in both SimpleTagSupport and 
JspFragmentHelper will be flagged by the 1.3.1 compiler. Looks like 'getParentTag()' might be 
another candidate. Will check out.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42389</commentid>
    <comment_count>5</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-08 10:26:21 +0000</bug_when>
    <thetext>I have applied your patch, and it will be included in 5.0.7. Thanks.
Reopen the bug if you find other occurances of this bug.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>22146</bug_id>
          
          <creation_ts>2003-08-05 20:02:00 +0000</creation_ts>
          <short_desc>TC 5.0.6 problems loading an a persisted session.</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.6</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Lenny Karpel">lkarpel</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>42183</commentid>
    <comment_count>0</comment_count>
    <who name="Lenny Karpel">lkarpel</who>
    <bug_when>2003-08-05 20:02:13 +0000</bug_when>
    <thetext>During TC 5.0.6 startup I (sometimes) get the following exception. 

We run with the the Manager set as follows:

&lt;Manager className="org.apache.catalina.session.StandardManager" 
distributable="true" /&gt; 

and get no errors when creating any session properties. The class 
com.eloquent.ecs.EKey is contained in the web-inf/classes folder.
It looks like TC5 is trying to load an array of the EKey objects
and failing .. 

I am not sure how to put together a duplicable example at this point.
Any help as to what might be going on will help.

Aug 5, 2003 1:45:06 PM org.apache.catalina.session.StandardManager doLoad
SEVERE: ClassNotFoundException while loading persisted sessions: 
java.lang.ClassNotFoundException: [Lcom.eloquent.ecs.EKey;
java.lang.ClassNotFoundException: [Lcom.eloquent.ecs.EKey;
        at org.apache.catalina.loader.WebappClassLoader.loadClass
(WebappClassLoader.java:1378)
        at org.apache.catalina.loader.WebappClassLoader.loadClass
(WebappClassLoader.java:1225)
        at org.apache.catalina.util.CustomObjectInputStream.resolveClass
(CustomObjectInputStream.java:119)
        at java.io.ObjectInputStream.readNonProxyDesc
(ObjectInputStream.java:1513)
        at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1435)
        at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1560)
        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1271)
        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:324)
        at org.apache.catalina.session.StandardSession.readObject
(StandardSession.java:1387)
        at org.apache.catalina.session.StandardSession.readObjectData
(StandardSession.java:881)
        at org.apache.catalina.session.StandardManager.doLoad
(StandardManager.java:450)
        at org.apache.catalina.session.StandardManager.load
(StandardManager.java:377)
        at org.apache.catalina.session.StandardManager.start
(StandardManager.java:691)
        at org.apache.catalina.core.StandardContext.start
(StandardContext.java:3913)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1127)
        at org.apache.catalina.core.StandardHost.start(StandardHost.java:792)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1127)
        at org.apache.catalina.core.StandardEngine.start
(StandardEngine.java:502)
        at org.apache.catalina.core.StandardService.start
(StandardService.java:519)
        at org.apache.catalina.core.StandardServer.start
(StandardServer.java:2311)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:578)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke
(NativeMethodAccessorImpl.java:39)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke
(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)
Aug 5, 2003 1:45:06 PM org.apache.catalina.session.StandardManager start
SEVERE: Exception loading sessions from persistent storage
java.lang.ClassNotFoundException: [Lcom.eloquent.ecs.EKey;
        at org.apache.catalina.loader.WebappClassLoader.loadClass
(WebappClassLoader.java:1378)
        at org.apache.catalina.loader.WebappClassLoader.loadClass
(WebappClassLoader.java:1225)
        at org.apache.catalina.util.CustomObjectInputStream.resolveClass
(CustomObjectInputStream.java:119)
        at java.io.ObjectInputStream.readNonProxyDesc
(ObjectInputStream.java:1513)
        at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1435)
        at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1560)
        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1271)
        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:324)
        at org.apache.catalina.session.StandardSession.readObject
(StandardSession.java:1387)
        at org.apache.catalina.session.StandardSession.readObjectData
(StandardSession.java:881)
        at org.apache.catalina.session.StandardManager.doLoad
(StandardManager.java:450)
        at org.apache.catalina.session.StandardManager.load
(StandardManager.java:377)
        at org.apache.catalina.session.StandardManager.start
(StandardManager.java:691)
        at org.apache.catalina.core.StandardContext.start
(StandardContext.java:3913)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1127)
        at org.apache.catalina.core.StandardHost.start(StandardHost.java:792)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1127)
        at org.apache.catalina.core.StandardEngine.start
(StandardEngine.java:502)
        at org.apache.catalina.core.StandardService.start
(StandardService.java:519)
        at org.apache.catalina.core.StandardServer.start
(StandardServer.java:2311)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:578)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke
(NativeMethodAccessorImpl.java:39)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke
(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)
[main] &lt;EServlet&gt; WebApp Servlet started at: Tue Aug 05 13:45:06 MDT 2003</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42213</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-05 21:45:27 +0000</bug_when>
    <thetext>Submitting a test case would help.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42262</commentid>
    <comment_count>2</comment_count>
      <attachid>7671</attachid>
    <who name="Lenny Karpel">lkarpel</who>
    <bug_when>2003-08-06 14:52:41 +0000</bug_when>
    <thetext>Created attachment 7671
A Webapp that has the problem.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42264</commentid>
    <comment_count>3</comment_count>
    <who name="Lenny Karpel">lkarpel</who>
    <bug_when>2003-08-06 15:00:38 +0000</bug_when>
    <thetext>I have just attached a zip file containing a webapp the demonstates this problem

1. Unzip the attached zip file into C:\
2. Add a Context to the server.xml for example

     &lt;Context path="/test" docBase="C:/testapp" debug="0" reloadable="false" /&gt;

3. Start TC 5.0.6 .. I used startup.bat
4. Ping the servlet: http://server:8080/test/test
5. An HTML page with the word 'done' should be displayed
6. Stop TC .. I used control-C in the command window
7. Start TC again .. I used startup.bat
8. You should see an exception during startup.

It appears as though code in the vicinity of a.o.c.util.CustomObjectInputStream 
has problems loading arrays of objects.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42295</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-06 19:43:22 +0000</bug_when>
    <thetext>I'll look at it. I think I saw that bug reported with 4.1.x, BTW. It's extremely
unlikely to have been introduced in 5.0.x.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42405</commentid>
    <comment_count>5</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-08 14:30:30 +0000</bug_when>
    <thetext>I can reproduce this, but failed to fix the bug.
I added traces in CustomObjectInputStream, and while there's a (normal) CNFE for
[Ltest$EKey;, it loads correctly test$EKey. The behavior is in every way
identical between TC 4.1.x and 5.0.x (at least for what I could see), and yet I
couldn't reproduce the bug with Tomcat 4.1.x.
If someone could help, or has ideas, that would be cool :)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42422</commentid>
    <comment_count>6</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-08 17:00:04 +0000</bug_when>
    <thetext>I finally found a solution to the bug.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42430</commentid>
    <comment_count>7</comment_count>
    <who name="Lenny Karpel">lkarpel</who>
    <bug_when>2003-08-08 17:28:06 +0000</bug_when>
    <thetext>Thanks !!</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>7671</attachid>
            <date>2003-08-06 14:52:00 +0000</date>
            <delta_ts>2003-08-06 14:52:41 +0000</delta_ts>
            <desc>A Webapp that has the problem.</desc>
            <filename>testapp.zip</filename>
            <type>application/octet-stream</type>
            <size>11274</size>
            <attacher name="Lenny Karpel">lkarpel</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>22174</bug_id>
          
          <creation_ts>2003-08-06 13:19:00 +0000</creation_ts>
          <short_desc>tomcat service launcher does not accept path to jvm.dll with spaces</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.0.6</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Dylan Schell">dylans</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>lkarpel</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>42254</commentid>
    <comment_count>0</comment_count>
    <who name="Dylan Schell">dylans</who>
    <bug_when>2003-08-06 13:19:05 +0000</bug_when>
    <thetext>When reconfiguring the with the "Configure Tomcat" Application I try to select a
server\bin\jvm.dll from a directory that as a space in it. This does not work. a
jvm.dll from a directory without spaces works correctly.

This is probably a bug in commons-daemon, but affects tomcat5/windows installs</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42294</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-06 19:42:14 +0000</bug_when>
    <thetext>*** Bug 22187 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42296</commentid>
    <comment_count>2</comment_count>
    <who name="Lenny Karpel">lkarpel</who>
    <bug_when>2003-08-06 20:29:01 +0000</bug_when>
    <thetext>I am not sure that 22187 is really a duplicate or not. In my examples there are 
no blanks .. but the service will still not start unless only the 
keyword 'java' is specified.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42448</commentid>
    <comment_count>3</comment_count>
    <who name="">william.barker</who>
    <bug_when>2003-08-09 02:38:01 +0000</bug_when>
    <thetext>Fixed now in the CVS and should appear in 5.0.7.

As near as I can tell, this is the same issue as #22187.  The problem was with 
the quotes in the parameters, not with the spaces.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57138</commentid>
    <comment_count>4</comment_count>
    <who name="Lars Schouw">schouwla</who>
    <bug_when>2004-05-11 01:03:18 +0000</bug_when>
    <thetext>I still have the same problem under version 5.0.24.

When I try to install from the .exe binary the installation stops at 
c:\j2sdk1.4.2_04\jre\bin\server\jvm.dll

Lars</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58257</commentid>
    <comment_count>5</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-05-27 22:53:43 +0000</bug_when>
    <thetext>Installation from the .exe using c:\j2sdk1.4.2 as the java directory works for 
me.

Installation from the .exe using c:\java test (space in the name) as the java 
directory works for me.

Installation from the .exe using c:\j2sdk1.4.2, and then using the Configure 
Tomcat program to change the JDK to c:\java test\jre\server\bin\jvm.dll also 
works for me.

All these were done on a clean machine (no previous or other tomcat 
installations) with Tomcat 5.0.25, so I'm pretty sure this bug is resolved.</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>22192</bug_id>
          
          <creation_ts>2003-08-06 22:34:00 +0000</creation_ts>
          <short_desc>Dash chararcter in webapp path replaces other deployed webapp</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.6</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Andy Riedel">andy</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>42300</commentid>
    <comment_count>0</comment_count>
    <who name="Andy Riedel">andy</who>
    <bug_when>2003-08-06 22:34:15 +0000</bug_when>
    <thetext>If a dash character is present in a webapp path name, a webapp with the same 
name up to the dash will be rendered inoperable. For example, given 
servlet 'A' deployed at path /test and servlet 'B' deployed at /test-b, 
servlet 'A' will be rendered inoperable after servlet 'B' is deployed.

If servlet 'B' is assigned a path with a dash (e.g. /testb), everything works.

Andy</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42328</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-07 13:59:28 +0000</bug_when>
    <thetext>The fix for this will be in 5.0.7. This was caused by a flaw in the context
mapping algorithm.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>22266</bug_id>
          
          <creation_ts>2003-08-09 01:27:00 +0000</creation_ts>
          <short_desc>Keep template text together with mappedfile="true"</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords>PatchAvailable</keywords>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Eric Carmichael">ecarmich</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>42444</commentid>
    <comment_count>0</comment_count>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-08-09 01:27:36 +0000</bug_when>
    <thetext>Jasper's mappedfile=true option doesn't always generate static content with 
one print statement per input line.  Jasper creates a new Node every time it 
sees a "&lt;" in the input, so when template text contains an HTML tag in the 
middle of an input line, the resulting Java code is split across multiple 
output lines (and in my opinion is therefore harder to read).

This can be fixed by checking the text after the "&lt;" before moving on to the 
next Node.  I will attach a patch that implements this.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42445</commentid>
    <comment_count>1</comment_count>
      <attachid>7704</attachid>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-08-09 01:30:31 +0000</bug_when>
    <thetext>Created attachment 7704
Proposed patch</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42471</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-09 19:22:29 +0000</bug_when>
    <thetext>It looks that was what was originally intended, so it's likely another great
patch :)
I'll apply both of your patches.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42639</commentid>
    <comment_count>3</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-08-12 17:21:39 +0000</bug_when>
    <thetext>I would have preferred that this optimization be done with a separate pass over
the parsed nodes, which combines contiguous template text nodes into one.  The
look-ahead used in this patch duplicates logic used in the other part of the
Parser (it also misses &lt;jsp:text&gt;, for instance), and may have some performance
impact.

I'll leave this patch in for now, but may undo it when the separate optim pass
is implemented later, unless Eric beats me to it!  :-)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42651</commentid>
    <comment_count>4</comment_count>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-08-13 02:09:27 +0000</bug_when>
    <thetext>Unfortunately I've thrown out the actual numbers I got in the performance 
testing I did (all on a 1 GHz Windows XP laptop), but the salient results were 
as follows:
1) The patch made Tomcat faster at compiling and serving pages with a 
preponderance of HTML tags versus JSP tags (the lookahead does take some extra 
time, but is more than made up if the lookahead results in one less node to be 
traversed later).  With the patch in place, Tomcat compiled and served 
index.html from the jsp-examples webapp (renamed to index.jsp, obviously) 
about 9% faster than without the patch.
2) On balance, however, the patch made Tomcat slower at compiling and serving 
pages.  At least, when I tested against the jsp-examples webapp (with 
index.jsp renamed back to index.html so it wasn't part of the test), time to 
compile and serve was about 2% slower.
3) I couldn't find any difference in serving compiled pages with the patch in 
place (I thought there might be a small improvement because the patch shrinks 
the .class files).

Based on those numbers, I decided not to submit the patch as an option 
configurable separately from mappedfile, or as a non-configurable 
enhancement.  But since the mappedfile documentation said it was intended for 
debugging, I thought the performance hit was acceptable.

I didn't test your idea of a separate pass through the parsed nodes, but I did 
test code that, when about to create a new TemplateText node, checked to see 
if the previous node was also a TemplateText node, and if so, just appended 
its text to the previous node's (the ideas being that anything that conserved 
nodes might improve performance, and that I didn't like duplicating logic from 
another part of the Parser, either).  But that was noticeably slower (I've 
forgotten the numbers entirely) than the patch I submitted.

Anyway, I submitted the patch as an enhancement, so I can't complain if it 
gets implemented differently or not at all.  The above is just to help folks 
make an informed decision.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42694</commentid>
    <comment_count>5</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-08-13 18:43:14 +0000</bug_when>
    <thetext>There is no doubt that concatenating contiguous template texts into one improves
the runtime performance and I am not too worry about spending extra time during
compilation, since I believe web applications should be deployed precompiled.

My suggestion for a separate pass was motivated by the design principle to keep
the modules simple and direct.  The current compiler is made up of a number of
passes, driven by the common data structure (Node and PageInof etc).  I'd like
to keep Parser only doing the basic parsing, but leaves the optimizations to
other passes.  Not only will it be easier for debugging and maintenance,
switching on and off such optimizations will also made easier.

Like I said, this no big deal, so I'll leave the patch in for now.  Anyway,
thanks for contributing to improve Jasper, and don't let slight disagreements
like this prevent you from making more contributions in the future.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43075</commentid>
    <comment_count>6</comment_count>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-08-21 06:00:21 +0000</bug_when>
    <thetext>It's just occurred to me that if the consolidation were done in a separate 
pass, it would apply to JSPs in XML format as well.  So provided the 
performance hit during compilation is acceptable (and I take your point that 
webapps should be deployed precompiled), I agree a separate pass is the way to 
go.

But if a performance hit during compilation is acceptable, is there any reason 
not to do this consolidation even when mappedfile="false"?  As you say, it 
should improve runtime performance, and we always have JspUtil.CHUNKSIZE 
(which could be made a configurable parameter) to keep individual lines from 
getting too long.  That was the only other downside that I found when I tested 
with mappedfile="false"-- very long template text sections were arguably even 
harder to follow all crammed into one output line than they were split at 
every HTML tag.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>7704</attachid>
            <date>2003-08-09 01:30:00 +0000</date>
            <delta_ts>2003-08-09 01:30:31 +0000</delta_ts>
            <desc>Proposed patch</desc>
            <filename>Bug22266patch.txt</filename>
            <type>text/plain</type>
            <size>2971</size>
            <attacher name="Eric Carmichael">ecarmich</attacher>
            

          </attachment>
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>22273</bug_id>
          
          <creation_ts>2003-08-09 18:12:00 +0000</creation_ts>
          <short_desc>[PATCH] Typo in jndi-resources-howto.html</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Documentation</component>
          <version>Unknown</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>http://jakarta.apache.org//tomcat/tomcat-4.0-doc/jndi-resources-howto.html</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Yann Cébron">yannc76</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>42467</commentid>
    <comment_count>0</comment_count>
    <who name="Yann Cébron">yannc76</who>
    <bug_when>2003-08-09 18:12:27 +0000</bug_when>
    <thetext>Sample configuration for JDBC Data Sources says 'jdbc/Employ*e*DB' (par 2) 
instead of 'jdbc/Employ*ee*DB' (par 3)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42468</commentid>
    <comment_count>1</comment_count>
      <attachid>7713</attachid>
    <who name="Yann Cébron">yannc76</who>
    <bug_when>2003-08-09 18:13:02 +0000</bug_when>
    <thetext>Created attachment 7713
Simple patch to fix typo for JDBC sample configuration</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42470</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-09 19:02:17 +0000</bug_when>
    <thetext>Fixed, thanks.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>7713</attachid>
            <date>2003-08-09 18:13:00 +0000</date>
            <delta_ts>2003-08-09 18:13:02 +0000</delta_ts>
            <desc>Simple patch to fix typo for JDBC sample configuration</desc>
            <filename>jndi-resources-howto_typofix.txt</filename>
            <type>text/plain</type>
            <size>619</size>
            <attacher name="Yann Cébron">yannc76</attacher>
            

          </attachment>
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>22277</bug_id>
          
          <creation_ts>2003-08-10 08:31:00 +0000</creation_ts>
          <short_desc>IllegalArgumentException in setOutputLineIncrement()</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Eric Carmichael">ecarmich</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>doh</cc>
    
    <cc>thanuj_sc</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>42479</commentid>
    <comment_count>0</comment_count>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-08-10 08:31:50 +0000</bug_when>
    <thetext>Jasper sometimes generates SMAP LineInfo entries with an outputStartLine of 
0.  These LineInfo entries are incorrect, and also can cause a fatal error in 
SmapStratum.java's optimizeLineSection(), making it impossible for Jasper to 
compile the JSP.

Note that the incorrect entries predate optimizeLineSection (they were present 
in Tomcat 5.0.4, and possibly earlier), but optimizeLineSection does blow the 
problem out of proportion, turning a flawed SMAP into a failed compilation.  I 
will attach a patch that fixes the blowing-out-of-proportion problem, at 
least, in order to make Tomcat more usable until I (or anyone else who wants 
to try their hand) can fix the underlying outputStartLine=0 problem.  Another 
workaround is to set suppressSmap=true.

The problem can be reproduced by compiling xml/xml.jsp from the jsp-examples 
webapp that ships with Tomcat 5.  The SMAP generated for that JSP is as 
follows:

C:\Program Files\jakarta-tomcat-5.0.4
\work\Catalina\localhost\test\org\apache\jsp\xml\xml_jsp.java
JSP
*S JSP
*F
+ 0 xml.jsp
/xml/xml.jsp
*L
8:0
15:0,0
16:0,0
17:0,0
17:47
20:0,0
21:51
22:0,0
24:0,0
24:54
25:56
39:57
42:0,0
43:59
44:60
48:0,0
49:64
49:65
49:66
49:67
49:68
49:69
49:70
*E</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42480</commentid>
    <comment_count>1</comment_count>
      <attachid>7716</attachid>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-08-10 08:33:06 +0000</bug_when>
    <thetext>Created attachment 7716
Proposed patch</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42481</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-10 08:41:29 +0000</bug_when>
    <thetext>I have applied your workaround.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42596</commentid>
    <comment_count>3</comment_count>
    <who name="Yann Cébron">yannc76</who>
    <bug_when>2003-08-12 06:05:46 +0000</bug_when>
    <thetext>I'm not sure, but I think I have a related (same?) problem here:

My JSPs compiled with TC5.0.5/6, but fail all with TC5.0.7

Ofcourse numbers vary, but all are negative (?!). I can provide sample JSPs on 
request, but I don't have anything special going on there (Struts/JSTL-tags).

Sample Stacktrace (always the same):

2003-08-12 07:57:15 StandardWrapperValve[jsp]: Servlet.service() for servlet 
jsp threw exception
java.lang.IllegalArgumentException: -41
	at 
org.apache.jasper.compiler.SmapStratum$LineInfo.setOutputLineIncrement
(SmapStratum.java:124)
	at org.apache.jasper.compiler.SmapStratum.optimizeLineSection
(SmapStratum.java:221)
	at org.apache.jasper.compiler.SmapUtil.evaluateNodes(SmapUtil.java:490)
	at org.apache.jasper.compiler.SmapUtil.generateSmap(SmapUtil.java:123)
	at org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:301)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:453)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:439)
	at org.apache.jasper.JspCompilationContext.compile
(JspCompilationContext.java:555)
	at org.apache.jasper.servlet.JspServletWrapper.service
(JspServletWrapper.java:300)
	at org.apache.jasper.servlet.JspServlet.serviceJspFile
(JspServlet.java:293)
	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter
(ApplicationFilterChain.java:286)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter
(ApplicationFilterChain.java:206)
	at org.apache.catalina.core.StandardWrapperValve.invoke
(StandardWrapperValve.java:254)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:564)
	at org.apache.catalina.core.StandardContextValve.invokeInternal
(StandardContextValve.java:256)
	at org.apache.catalina.core.StandardContextValve.invoke
(StandardContextValve.java:210)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke
(AuthenticatorBase.java:501)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:149)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:564)
	at org.apache.catalina.core.StandardHostValve.invoke
(StandardHostValve.java:190)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.valves.ErrorReportValve.invoke
(ErrorReportValve.java:175)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:149)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:564)
	at org.apache.catalina.core.StandardEngineValve.invoke
(StandardEngineValve.java:156)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:564)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:974)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service
(CoyoteAdapter.java:207)
	at org.apache.coyote.http11.Http11Processor.process
(Http11Processor.java:647)
	at 
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio
n(Http11Protocol.java:489)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt
(PoolTcpEndpoint.java:575)
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run
(ThreadPool.java:649)
	at java.lang.Thread.run(Thread.java:534)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42598</commentid>
    <comment_count>4</comment_count>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-08-12 07:08:04 +0000</bug_when>
    <thetext>That's the same problem.  No need to provide sample JSPs (although I 
appreciate the offer); a patch fixing the crashing problem is already attached 
to this ticket and incorporated into CVS, and I'm looking into the best way to 
eliminate the root cause.

To make it easier for other people having this problem to find this ticket, 
I'm changing the summary from "SMAP LineInfo entries with an outputStartLine 
of 0" (the root cause) to "IllegalArgumentException in setOutputLineIncrement
()" (the error people actually see).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42603</commentid>
    <comment_count>5</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-12 07:43:32 +0000</bug_when>
    <thetext>Wrokaround: set "supressSmap" to "true" in "conf/web.xml".</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42661</commentid>
    <comment_count>6</comment_count>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-08-13 07:15:24 +0000</bug_when>
    <thetext>I believe Remy's commit from earlier today ("Don't merge SMAP entries in the 
outptStartLines aren't consecutive") fixes the IllegalArgumentException 
problem (thanks, Remy!).  If that's right (I've tested it, but then I tested 
my original patch as well, so I'm not taking that as a guarantee), it means my 
workaround patch can be removed without IllegalArgumentException recurring.  
On the other hand the workaround patch also keeps the outputStartLine=0 
LineInfos out of the SMAP, so taking it out before we've fixed the root cause 
of outputStartLine=0 could be considered a regression, on the grounds that an 
incorrect SMAP is worse than an incomplete one.

Also, if Jasper were to start SMAPping page directives, then

	TemplateText&lt;page import="org.foo.*"&gt;

would generate an IllegalArgumentException if it weren't for Remy's fix.  This 
means that IllegalArgumentException is a bug in its own right, and not just a 
side effect of the outputStartLine=0 problem.  So to keep things clear, I 
think we should use this ticket to track IllegalArgumentException only, and 
open new tickets as needed to track outputStartLine=0.

I'll close this ticket in a few days if there are no objections to this 
approach, and no reason to doubt Remy's commit.  If someone else wants to 
close it sooner, that's fine with me.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42663</commentid>
    <comment_count>7</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-13 07:22:27 +0000</bug_when>
    <thetext>There's a side problem that causes the mappings to be incorrect for tags
invocations which are done in separate methods, rather than inside _jspService.
That's what really did cause the bug. I agree that this is fixed, and the other
issues are other bugs.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42919</commentid>
    <comment_count>8</comment_count>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-08-18 14:13:32 +0000</bug_when>
    <thetext>*** Bug 22508 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43208</commentid>
    <comment_count>9</comment_count>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-08-24 02:48:11 +0000</bug_when>
    <thetext>*** Bug 22678 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>7716</attachid>
            <date>2003-08-10 08:33:00 +0000</date>
            <delta_ts>2003-08-10 08:33:06 +0000</delta_ts>
            <desc>Proposed patch</desc>
            <filename>Bug22277patch.txt</filename>
            <type>text/plain</type>
            <size>1270</size>
            <attacher name="Eric Carmichael">ecarmich</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>22291</bug_id>
          
          <creation_ts>2003-08-11 07:00:00 +0000</creation_ts>
          <short_desc>Missing ant tasks for JMX proxy functionality</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.0.0</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Vivek Chopra">vivekchopra</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>42514</commentid>
    <comment_count>0</comment_count>
    <who name="Vivek Chopra">vivekchopra</who>
    <bug_when>2003-08-11 07:00:57 +0000</bug_when>
    <thetext>The JMX proxy functionality in the Tomcat manager doesn't have ant tasks.

These are a bit awkward to use with the HTTP request format, so I wrote these 
and will be attaching the code to the bugzilla entry.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42515</commentid>
    <comment_count>1</comment_count>
      <attachid>7735</attachid>
    <who name="Vivek Chopra">vivekchopra</who>
    <bug_when>2003-08-11 07:02:56 +0000</bug_when>
    <thetext>Created attachment 7735
The JMX Query task code</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42516</commentid>
    <comment_count>2</comment_count>
      <attachid>7736</attachid>
    <who name="Vivek Chopra">vivekchopra</who>
    <bug_when>2003-08-11 07:03:14 +0000</bug_when>
    <thetext>Created attachment 7736
The JMX Set task code</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42522</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-11 09:07:47 +0000</bug_when>
    <thetext>Thanks. The advantage of this is that it works without additional stuff. The
preffered way to interact with Tomcat through JMX is right now the various MX4J
connectors. Tomcat 5.0.x will be updated to JMX 1.2 and the remote JMX as soon
as they are available.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>7735</attachid>
            <date>2003-08-11 07:02:00 +0000</date>
            <delta_ts>2003-08-11 07:02:56 +0000</delta_ts>
            <desc>The JMX Query task code</desc>
            <filename>JMXQueryTask.java</filename>
            <type>text/plain</type>
            <size>4318</size>
            <attacher name="Vivek Chopra">vivekchopra</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>7736</attachid>
            <date>2003-08-11 07:03:00 +0000</date>
            <delta_ts>2003-08-11 07:03:14 +0000</delta_ts>
            <desc>The JMX Set task code</desc>
            <filename>JMXSetTask.java</filename>
            <type>text/plain</type>
            <size>5202</size>
            <attacher name="Vivek Chopra">vivekchopra</attacher>
            

          </attachment>
      

    <bug_classification class="BUILD_SYSTEM">BUILD_SYSTEM</bug_classification></bug>
    <bug>
          <bug_id>22439</bug_id>
          
          <creation_ts>2003-08-14 21:50:00 +0000</creation_ts>
          <short_desc>NPE compiling JSP Document</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.7</version>
          <rep_platform>Other</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Hans Bergsten">hans</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>svanleent</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>42780</commentid>
    <comment_count>0</comment_count>
    <who name="Hans Bergsten">hans</who>
    <bug_when>2003-08-14 21:50:21 +0000</bug_when>
    <thetext>The following JSP Document doesn't compile:

&lt;!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3c.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;
&lt;html 
  xmlns="http://www.w3c.org/1999/xhtml" 
  xmlns:jsp="http://java.sun.com/JSP/Page" 
  xml:lang="en" lang="en"&gt;

  &lt;jsp:directive.page contentType="text/html" /&gt; 
 
  &lt;head&gt;
    &lt;title&gt;A JSP Document&lt;/title&gt;
  &lt;/head&gt;
  &lt;body bgcolor="white"&gt;
    &lt;h1&gt;All Request Parameters&lt;/h1&gt;

    &lt;ul&gt; 
      &lt;c:forEach xmlns:c="http://java.sun.com/jsp/jstl/core"
        items="${paramValues}" var="current"&gt; 
        &lt;li&gt; 
          ${current.key}:
          &lt;c:forEach items="${current.value}" var="parValue"&gt;
            &lt;br/&gt;${parValue} 
          &lt;/c:forEach&gt;
        &lt;/li&gt; 
      &lt;/c:forEach&gt; 
    &lt;/ul&gt; 

    &lt;jsp:element name="${param.element}"&gt;
      &lt;jsp:attribute name="style"&gt;${param.style}&lt;/jsp:attribute&gt;
      &lt;jsp:body&gt;${param.body}&lt;/jsp:body&gt;
    &lt;/jsp:element&gt;

  &lt;/body&gt;
&lt;/html&gt;

The root cause for the exception is:

java.lang.NullPointerException
	org.apache.jasper.compiler.PageInfo.popPrefixMapping(PageInfo.java:339)
	org.apache.jasper.compiler.JspDocumentParser.endPrefixMapping(JspDocumentParser.java:574)
	org.apache.xerces.parsers.AbstractSAXParser.endNamespaceMapping(Unknown Source)
	org.apache.xerces.parsers.AbstractSAXParser.endElement(Unknown Source)
	org.apache.xerces.impl.XMLNamespaceBinder.handleEndElement(Unknown Source)
	org.apache.xerces.impl.XMLNamespaceBinder.endElement(Unknown Source)
	org.apache.xerces.impl.dtd.XMLDTDValidator.endNamespaceScope(Unknown Source)
	org.apache.xerces.impl.dtd.XMLDTDValidator.handleEndElement(Unknown Source)
	org.apache.xerces.impl.dtd.XMLDTDValidator.endElement(Unknown Source)
	org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanEndElement(Unknown
Source)
	org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(Unknown Source)
	org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source)
	org.apache.xerces.parsers.DTDConfiguration.parse(Unknown Source)
	org.apache.xerces.parsers.DTDConfiguration.parse(Unknown Source)
	org.apache.xerces.parsers.XMLParser.parse(Unknown Source)
	org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)
	javax.xml.parsers.SAXParser.parse(Unknown Source)
	org.apache.jasper.compiler.JspDocumentParser.parse(JspDocumentParser.java:195)
	org.apache.jasper.compiler.ParserController.parse(ParserController.java:223)
	org.apache.jasper.compiler.ParserController.parse(ParserController.java:146)
	org.apache.jasper.compiler.ParserController.parse(ParserController.java:132)
	org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:245)
	org.apache.jasper.compiler.Compiler.compile(Compiler.java:453)
	org.apache.jasper.compiler.Compiler.compile(Compiler.java:439)
	org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:555)
	org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:300)
	org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:293)
	org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:856)

It works fine with TC 5.0.4</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42781</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-08-14 22:16:18 +0000</bug_when>
    <thetext>This is a regression from 5.0.6, and has been fixed in the head branch.  To
getaround it, either use 5.0.6 or the nightly build.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42952</commentid>
    <comment_count>2</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-08-18 22:36:09 +0000</bug_when>
    <thetext>*** Bug 22535 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>22478</bug_id>
          
          <creation_ts>2003-08-16 04:10:00 +0000</creation_ts>
          <short_desc>Ant manager deploy causing webapp to initialize twice</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Administration</component>
          <version>5.0.7</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jacob Kjome">hoju</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>ceki</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>42842</commentid>
    <comment_count>0</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2003-08-16 04:10:20 +0000</bug_when>
    <thetext>If have my webapp sitting in CATALINA_HOME/webapps and my context configuration
file in conf/Catalina/localhost before Tomcat starts, initialization is done
once.  If, however, I do a deploy using the Ant manager deploy task,
initialization is performed twice.  Actually, this happens more clearly after an
Ant manager deploy + html manager undeploy + Ant manager deploy.  The first time
it is deployed, I get an exception from digester which seems to prevent the
duplicate initialization.  I'll be attaching text file showing the log output
from stdout.log (I run Tomcat as a WinXP service) and localhost_log that shows
the stack traces.

Like I said, it is more clear the duplicate initialization is happening after a
deploy + undeploy + deploy.  Here is what it looks like beginning with the
undeploy...


3124297 [http8080-Processor25] INFO  org.apache.catalina.core.ContainerBase  -
Removing web application at context path /Barracuda
3125031 [http8080-Processor25] INFO  org.apache.catalina.logger.LoggerBase  -
unregistering logger Catalina:type=Logger,path=/Barracuda,host=localhost
3192547 [http8080-Processor24] INFO 
org.apache.catalina.core.StandardHostDeployer  - Installing web application from
Config file URL
file:/D:/Java/Apache/Jakarta/tomcat-5.0.7/conf/Catalina/localhost/Barracuda.xml
3192547 [http8080-Processor24] INFO 
org.apache.catalina.core.StandardHostDeployer  - Installing web application from
URL jar:file:/D:/Java/Apache/Jakarta/tomcat-5.0.7/webapps/Barracuda.war!/
Aug 15, 2003 8:33:25 PM org.apache.catalina.loader.WebappClassLoader
findResourceInternal
INFO: Lifecycle error : CL stopped
java.lang.IncompatibleClassChangeError:
org.apache.xerces.jaxp.DocumentBuilderFactoryImpl
	at
org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1251)
	at
org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1211)
	at javax.xml.parsers.FactoryFinder.newInstance(FactoryFinder.java:93)
	at javax.xml.parsers.FactoryFinder.find(FactoryFinder.java:174)
	at
javax.xml.parsers.DocumentBuilderFactory.newInstance(DocumentBuilderFactory.java:93)
	at org.apache.log4j.xml.DOMConfigurator.doConfigure(DOMConfigurator.java:644)
	at org.apache.log4j.xml.DOMConfigurator.doConfigure(DOMConfigurator.java:616)
	at org.apache.log4j.xml.DOMConfigurator.doConfigure(DOMConfigurator.java:584)
	at org.apache.log4j.xml.XMLWatchdog.doOnChange(DOMConfigurator.java:815)
	at org.apache.log4j.helpers.FileWatchdog.checkAndConfigure(FileWatchdog.java:80)
	at org.apache.log4j.helpers.FileWatchdog.run(FileWatchdog.java:99)
Aug 15, 2003 8:33:26 PM org.apache.catalina.loader.WebappClassLoader
findResourceInternal
INFO: Lifecycle error : CL stopped
java.lang.IncompatibleClassChangeError:
org.apache.xerces.jaxp.DocumentBuilderFactoryImpl
	at
org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1251)
	at
org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1211)
	at javax.xml.parsers.FactoryFinder.newInstance(FactoryFinder.java:93)
	at javax.xml.parsers.FactoryFinder.find(FactoryFinder.java:174)
	at
javax.xml.parsers.DocumentBuilderFactory.newInstance(DocumentBuilderFactory.java:93)
	at org.apache.log4j.xml.DOMConfigurator.doConfigure(DOMConfigurator.java:644)
	at org.apache.log4j.xml.DOMConfigurator.doConfigure(DOMConfigurator.java:616)
	at org.apache.log4j.xml.DOMConfigurator.doConfigure(DOMConfigurator.java:584)
	at org.apache.log4j.xml.XMLWatchdog.doOnChange(DOMConfigurator.java:815)
	at org.apache.log4j.helpers.FileWatchdog.checkAndConfigure(FileWatchdog.java:80)
	at org.apache.log4j.helpers.FileWatchdog.run(FileWatchdog.java:99)

[webapp specific initialization logging happens here.....]

3216172 [ContainerBackgroundProcessor[StandardEngine[Catalina]]] INFO 
org.apache.catalina.startup.HostConfig  - restartContext(/Barracuda)
3216672 [ContainerBackgroundProcessor[StandardEngine[Catalina]]] INFO 
org.apache.catalina.logger.LoggerBase  - unregistering logger
Catalina:type=Logger,path=/Barracuda,host=localhost

[webapp specific initialization logging happens...again...here.....]


Note that after this happens, the webapp actually works fine.  It most certainly
shouldn't be initializing twice, though.  I won't speculate as to the cause. 
I'll wait for some more inciteful interpretation from Remy, Bill Barker, or
someone else more attuned to the workings of the Tomcat internals.

Jake</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42843</commentid>
    <comment_count>1</comment_count>
      <attachid>7843</attachid>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2003-08-16 04:12:20 +0000</bug_when>
    <thetext>Created attachment 7843
log of Digester exception upon first Ant manager deployment</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42851</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-16 14:18:11 +0000</bug_when>
    <thetext>The bug, if there's one, is maybe that your context XML should be removed on
undeploy. This works fine for me (the WAR, expanded dir, and expanded XML are
all removed on undeploy, as long as their names match).
As for the "CL stopped" exception, well, log4j shouldn't have watchdog threads
or similar stuff (or you should destroy your loggers manually when your
application is stopped).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42852</commentid>
    <comment_count>3</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2003-08-16 15:24:23 +0000</bug_when>
    <thetext>&gt;The bug, if there's one, is maybe that your context XML should be removed on
&gt;undeploy. This works fine for me (the WAR, expanded dir, and expanded XML are
&gt;all removed on undeploy, as long as their names match).

My context configuration file (ccf) and everything else is removed just fine
upon undeploy.  I've verified this many times.  Also, Tomcat creates the ccf
from the one I supply in the .war file; META-INF/context.xml.  I assume that is
still correct to do with Tomcat5, right?  That's the way Tomcat4.1.xx worked. 
It must be right because it seems to extract it to the appropriate place and use it.

Besides, given that with a virgin Tomcat server and my app never having been
deployed there before, I still get exceptions upon the first deploy shown in the
stacktrace in the log file I attached.  Did you have a look at that yet?
http://nagoya.apache.org/bugzilla/showattachment.cgi?attach_id=7843

This doesn't happen if I physically place the application there before Tomcat
has ever been started.  It only happens upon a manager app deployment, so I
think that pretty clearly implicates the manager application or some process it
uses.

&gt;As for the "CL stopped" exception, well, log4j shouldn't have watchdog threads
&gt;or similar stuff (or you should destroy your loggers manually when your
&gt;application is stopped).

I actually do manually shutdown Log4j when the application is stopped...

See for yourself here...
http://cvs.apache.org/viewcvs/jakarta-log4j-sandbox/src/java/org/apache/log4j/servlet/InitContextListener.java?rev=1.7&amp;content-type=text/vnd.viewcvs-markup

Here's the relevant code from there...

public void contextDestroyed(ServletContextEvent sce) {
    ServletContext context = sce.getServletContext();

    cleanupLog4j(context);
}

private void cleanupLog4j(ServletContext context) {
    //shutdown this webapp's logger repository
    context.log(
      "Cleaning up Log4j resources for context: "
      + context.getServletContextName() + "...");
    context.log("Shutting down all loggers and appenders...");
    org.apache.log4j.LogManager.shutdown();
    context.log("Log4j cleaned up.");
}

Either way, the watchdog is in the process of configuring itself at startup. 
How is this a shutdown issue?  Additionally, although Log4j involved in the
stack trace, it doesn't seem to be the cause of the issue.  These are the lines
of significance...

java.lang.IncompatibleClassChangeError:
org.apache.xerces.jaxp.DocumentBuilderFactoryImpl
	at
org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1251)

Please explain to me how the Log4j watchdog is responsible for an
IncompatibleClassChangeError in org.apache.xerces.jaxp.DocumentBuilderFactoryImpl?

And then, of course, there is the issue which I don't believe you addressed at
all which is the fact that the contextInitialized() in my servlet context
listener is running twice every time I do a deploy after an undeploy.


I'll leave this bug invalid for now, but I don't believe that is the case.  I
don't see where I am doing anything wrong?  Tomcat should be able to deal with
this deployment just fine, but it isn't.

Jake</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42853</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-16 15:39:00 +0000</bug_when>
    <thetext>I'll look at the first part, but this worked fine for me when I tried it; the
second part is invalid, and won't be resolved or looked into (this is bug 3888,
which I am tired to discuss, and is invalid).
log4j has no buisness accessing anything from a thread outside of the control of
the container after the web application shutdown.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42854</commentid>
    <comment_count>5</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2003-08-16 15:56:28 +0000</bug_when>
    <thetext>Ok, I just tested with a completely fresh copy of Tomcat-4.1.27 and not only do
I not get exceptions upon the first deploy (
http://nagoya.apache.org/bugzilla/showattachment.cgi?attach_id=7843 ), future
undeploys and deploys work perectly as well with no classloader errors or double
initialization.

Am I not making a pretty good case that there is something wrong with Tomcat5
and not my application if it works perfectly in a previous version of Tomcat? 
Its the same webapp, the only difference is Tomcat.

Reopening...

Jake</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42855</commentid>
    <comment_count>6</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2003-08-16 16:00:25 +0000</bug_when>
    <thetext>&gt;log4j has no buisness accessing anything from a thread outside of the control of
&gt;the container after the web application shutdown.

Like I said before, Log4j is completely and utterly shut down.  All thread are
stopped.  So, I agree with you about Log4j having no business continuing threads
after application shutdown, but it just not the case that Log4j is actually
keeping any open threads after application shutdown, so that argument is
completely moot.

Jake</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42856</commentid>
    <comment_count>7</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-16 16:02:15 +0000</bug_when>
    <thetext>As I said, I will consider the deployment bug, not the classloader errors. Do
not bother reopening the bug.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42857</commentid>
    <comment_count>8</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-16 16:04:37 +0000</bug_when>
    <thetext>Well, I see a log4j owned thread accessing a stopped classloader. The stack
trace is obvious enough. BTW, if you don't believe me, sorry, I don't care ;-)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42869</commentid>
    <comment_count>9</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-17 08:43:26 +0000</bug_when>
    <thetext>Your bug is misleading (not too surprising), but has merit: I knew about the
extra restarts which were occurring after a manager deploy, but they have
nothing to do with a double deployment of the webapp (what actually happens is
that the webapp gets deployed, then restarted right away - because of the
web.xml tracking code). I found a way to improve that code to avoid this
scenario, so the issue will be fixed in 5.0.8.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42883</commentid>
    <comment_count>10</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2003-08-18 03:21:58 +0000</bug_when>
    <thetext>Remy,

I've tested your fix and it seems to have solved the duplicate initialization. 
I will look into how it is that Log4j seems to be accessing a stopped class
classloader even when I call LogManager.shutdown() in the contextDestroyed()
method of my servlet context listener.  Maybe shutdown() is not doing everything
it should be doing?  Anyway, I'll look into it.

I am still seeing the Digester error upon initial deploy.  Here is how it looks
now..

82437 [http8080-Processor25] INFO  org.apache.catalina.core.StandardHostDeployer
 - Processing Context configuration file URL
file:/D:/Java/Apache/Jakarta/tomcat-5-20030817/conf/Catalina/localhost/Barracuda.xml
82437 [http8080-Processor25] INFO  org.apache.catalina.core.StandardHostDeployer
 - Installing web application from URL
jar:file:/D:/Java/Apache/Jakarta/tomcat-5-20030817/webapps/Barracuda.war!/
104078 [ContainerBackgroundProcessor[StandardEngine[Catalina]]] INFO 
org.apache.catalina.core.StandardHostDeployer  - Processing Context
configuration file URL
file:D:\Java\Apache\Jakarta\tomcat-5-20030817\conf\Catalina\localhost\Barracuda.xml
104093 [ContainerBackgroundProcessor[StandardEngine[Catalina]]] ERROR
org.apache.commons.digester.Digester  - End event threw exception

Notice how Tomcat processes the context configuration file after the context has
already been installed?


I also see the following in the log for my particular webapp after an undeploy,
then deploy...

2003-08-17 17:48:50 createObjectName with
StandardEngine[Catalina].StandardHost[localhost].StandardContext[/Barracuda]
2003-08-17 17:50:35 createObjectName with
StandardEngine[Catalina].StandardHost[localhost].StandardContext[/Barracuda]

The first line was logged at the end of an undeploy and the second at the
beginning of a deploy.  It seems fishy to me that it would do a
"createObjectName" after an undeploy when the very same thing is done again upon
a deploy.  I don't know if this is significant or not.  If it isn't, just say so.


Jake</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42942</commentid>
    <comment_count>11</comment_count>
    <who name="Ceki Gulcu">ceki</who>
    <bug_when>2003-08-18 20:17:55 +0000</bug_when>
    <thetext>
I have not studied the bug report. By the looks of it it seems that it is due 
to a problem with the log4j configurator watchdog thread using a dead 
classloader. The watchdog code in log4j 1.2.x does not have a notion of a 
lifecycle. In particular, LogManager.shutdown does not stop the watchdog thread.
Atually, I don't think there is a way to stop a watchdog thread which is 
definetely a serious shortcoming of log4j watchdogs.

Please let me know if the above does not clarify the issue.

--
Ceki</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>7843</attachid>
            <date>2003-08-16 04:12:00 +0000</date>
            <delta_ts>2003-08-16 04:12:20 +0000</delta_ts>
            <desc>log of Digester exception upon first Ant manager deployment</desc>
            <filename>manager_1st_deploy.txt</filename>
            <type>text/plain</type>
            <size>15736</size>
            <attacher name="Jacob Kjome">hoju</attacher>
            

          </attachment>
      

    <bug_classification class="BUILD_SYSTEM">BUILD_SYSTEM</bug_classification></bug>
    <bug>
          <bug_id>22494</bug_id>
          
          <creation_ts>2003-08-17 23:21:00 +0000</creation_ts>
          <short_desc>logVerbosityLevel not used anymore</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords>PatchAvailable</keywords>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Eric Carmichael">ecarmich</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>42877</commentid>
    <comment_count>0</comment_count>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-08-17 23:21:09 +0000</bug_when>
    <thetext>I don't believe Jasper's logVerbosityLevel initialization parameter is used 
anymore.  At least, I note the following:

1) Jasper's logging is configurable via a log4j.properties file
2) Changing logVerbosityLevel doesn't have any effect that I can see
3) I can't find any reference to logVerbosityLevel in the code

If logVerbosityLevel really isn't used anymore, it should be taken out of 
Tomcat's web.xml and jasper-howto.xml.

I will attach a patch that implements this, and corrects some minor spelling 
mistakes in both files.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42878</commentid>
    <comment_count>1</comment_count>
      <attachid>7861</attachid>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-08-17 23:24:05 +0000</bug_when>
    <thetext>Created attachment 7861
Proposed patch</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>42955</commentid>
    <comment_count>2</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2003-08-19 00:23:06 +0000</bug_when>
    <thetext>logVerbosityLevel indeed seems unused -- patch done.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>7861</attachid>
            <date>2003-08-17 23:24:00 +0000</date>
            <delta_ts>2003-08-17 23:24:05 +0000</delta_ts>
            <desc>Proposed patch</desc>
            <filename>Bug22494patch.txt</filename>
            <type>text/plain</type>
            <size>6683</size>
            <attacher name="Eric Carmichael">ecarmich</attacher>
            

          </attachment>
      

    <bug_classification class="CLEANUP">CLEANUP</bug_classification></bug>
    <bug>
          <bug_id>22571</bug_id>
          
          <creation_ts>2003-08-20 06:06:00 +0000</creation_ts>
          <short_desc>NPE when using custom extends class</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter>william.barker</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>43027</commentid>
    <comment_count>0</comment_count>
    <who name="">william.barker</who>
    <bug_when>2003-08-20 06:06:48 +0000</bug_when>
    <thetext>Jasper currently relies on the non-standard methods "_jspInit" 
and "_jspDestroy".  Since these methods are found nowhere in either the Servlet 
or Jsp specs, there is no reason that a custom "extends" class should either 
implement them or call them.  The result is that all of the tag-pools remain un-
initialized, so the first access to a tag causes an NPE.

Initialization is easy to solve (i.e. it could be moved to the constructor, you 
could have a flag that is checked in _jspService, etc.).  Releasing is the hard 
part.  About all that I can see (without majorly changing the current 
implementation) is to add a finalize method, which is just too ugly for 
words :).

The other solution I can see would be to add code to the JSP page like:

  private Tag getTag(org.apache.jasper.runtime.TagHandlerPool pool, Class tagC){
    Tag result = null;
    if(pool == null) {
      try {
        result = tagC.newInstance();
      } catch(Exception ex) {
      }
    } else {
      result = pool.get(tagC);
    }
    return result;
   }
   private void putTag(org.apache.jasper.runtime.TagHandlerPool pool, Tag tag) {
    if( pool == null ) {
      tag.release();
    } else {
      pool.reuse(tag);
    }
   }</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43028</commentid>
    <comment_count>1</comment_count>
      <attachid>7895</attachid>
    <who name="">william.barker</who>
    <bug_when>2003-08-20 06:08:56 +0000</bug_when>
    <thetext>Created attachment 7895
War file that exibits the bug</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43137</commentid>
    <comment_count>2</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2003-08-21 23:39:59 +0000</bug_when>
    <thetext>All generated servlets will override javax.servlet.Servlet.init(). The overriden
init() first calls super.init(), followed by the initialization currently done
in _jspInit().
</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>7895</attachid>
            <date>2003-08-20 06:08:00 +0000</date>
            <delta_ts>2003-08-20 06:08:56 +0000</delta_ts>
            <desc>War file that exibits the bug</desc>
            <filename>extends.war</filename>
            <type>application/octet-stream</type>
            <size>475923</size>
            <attacher>william.barker</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>22602</bug_id>
          
          <creation_ts>2003-08-20 20:51:00 +0000</creation_ts>
          <short_desc>Missing ant tasks for serverinfo and sessions</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Administration</component>
          <version>5.0.6</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Vivek Chopra">vivekchopra</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>43055</commentid>
    <comment_count>0</comment_count>
    <who name="Vivek Chopra">vivekchopra</who>
    <bug_when>2003-08-20 20:51:15 +0000</bug_when>
    <thetext>Ant tasks missing for two manager tasks- /serverinfo and /sessions. I have 
implemented these, and will be uploading the files.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43056</commentid>
    <comment_count>1</comment_count>
      <attachid>7905</attachid>
    <who name="Vivek Chopra">vivekchopra</who>
    <bug_when>2003-08-20 20:51:53 +0000</bug_when>
    <thetext>Created attachment 7905
Implementation of /serverinfo manager task</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43057</commentid>
    <comment_count>2</comment_count>
      <attachid>7906</attachid>
    <who name="Vivek Chopra">vivekchopra</who>
    <bug_when>2003-08-20 20:52:32 +0000</bug_when>
    <thetext>Created attachment 7906
Implementation of /sessions manager task</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43147</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-22 06:50:10 +0000</bug_when>
    <thetext>Thanks for the patch. This will be integrated in 5.0.10.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>7905</attachid>
            <date>2003-08-20 20:51:00 +0000</date>
            <delta_ts>2003-08-20 20:51:53 +0000</delta_ts>
            <desc>Implementation of /serverinfo manager task</desc>
            <filename>ServerinfoTask.java</filename>
            <type>text/plain</type>
            <size>3394</size>
            <attacher name="Vivek Chopra">vivekchopra</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>7906</attachid>
            <date>2003-08-20 20:52:00 +0000</date>
            <delta_ts>2003-08-20 20:52:32 +0000</delta_ts>
            <desc>Implementation of /sessions manager task</desc>
            <filename>SessionsTask.java</filename>
            <type>text/plain</type>
            <size>3861</size>
            <attacher name="Vivek Chopra">vivekchopra</attacher>
            

          </attachment>
      

    <bug_classification class="BUILD_SYSTEM">BUILD_SYSTEM</bug_classification></bug>
    <bug>
          <bug_id>22681</bug_id>
          
          <creation_ts>2003-08-24 14:45:00 +0000</creation_ts>
          <short_desc>AttributeNotFoundException in Host(localhost) icon</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Administration</component>
          <version>5.0.9</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="TANAKA Yoshihiro">bugzilla</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>43214</commentid>
    <comment_count>0</comment_count>
    <who name="TANAKA Yoshihiro">bugzilla</who>
    <bug_when>2003-08-24 14:45:22 +0000</bug_when>
    <thetext>When "Host(localhost)" icon on the Administration Tool is clicked,
javax.management.AttributeNotFoundException is thrown each time as follows.
I haven't seen this exception on TC5.0.7.

[localhost_admin_log]
javax.management.AttributeNotFoundException:  Cannot find attribute liveDeploy
	at org.apache.commons.modeler.BaseModelMBean.getAttribute
(BaseModelMBean.java:306)
	at mx4j.server.interceptor.InvokerMBeanServerInterceptor.getAttribute
(InvokerMBeanServerInterceptor.java:242)
	at mx4j.server.interceptor.DefaultMBeanServerInterceptor.getAttribute
(DefaultMBeanServerInterceptor.java:138)
	at mx4j.server.interceptor.SecurityMBeanServerInterceptor.getAttribute
(SecurityMBeanServerInterceptor.java:101)
	at mx4j.server.interceptor.DefaultMBeanServerInterceptor.getAttribute
(DefaultMBeanServerInterceptor.java:138)
	at mx4j.server.interceptor.DefaultMBeanServerInterceptor.getAttribute
(DefaultMBeanServerInterceptor.java:138)
	at 
mx4j.server.interceptor.ContextClassLoaderMBeanServerInterceptor.getAttribute
(ContextClassLoaderMBeanServerInterceptor.java:198)
	at mx4j.server.MBeanServerImpl.getAttribute(MBeanServerImpl.java:1237)
	at org.apache.webapp.admin.host.EditHostAction.perform
(EditHostAction.java:213)
	at org.apache.struts.action.Action.execute(Action.java:420)
	at org.apache.struts.action.RequestProcessor.processActionPerform
(RequestProcessor.java:484)
	at org.apache.struts.action.RequestProcessor.process
(RequestProcessor.java:274)
	at org.apache.struts.action.ActionServlet.process
(ActionServlet.java:1482)
	at org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:743)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter
(ApplicationFilterChain.java:286)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter
(ApplicationFilterChain.java:206)
	at org.apache.catalina.core.StandardWrapperValve.invoke
(StandardWrapperValve.java:258)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:564)
	at org.apache.catalina.core.StandardContextValve.invokeInternal
(StandardContextValve.java:256)
	at org.apache.catalina.core.StandardContextValve.invoke
(StandardContextValve.java:210)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke
(AuthenticatorBase.java:577)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:149)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:564)
	at org.apache.catalina.core.StandardHostValve.invoke
(StandardHostValve.java:196)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.valves.ErrorReportValve.invoke
(ErrorReportValve.java:175)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:149)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:564)
	at org.apache.catalina.core.StandardEngineValve.invoke
(StandardEngineValve.java:156)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:564)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:974)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service
(CoyoteAdapter.java:207)
	at org.apache.coyote.http11.Http11Processor.process
(Http11Processor.java:647)
	at 
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio
n(Http11Protocol.java:497)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt
(PoolTcpEndpoint.java:575)
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run
(ThreadPool.java:649)
	at java.lang.Thread.run(Thread.java:536)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43222</commentid>
    <comment_count>1</comment_count>
    <who name="Amy Roh">amyroh</who>
    <bug_when>2003-08-24 22:57:05 +0000</bug_when>
    <thetext>The host properties are updated in admin.  The fix will be available in the 
next release.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43231</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-25 07:34:57 +0000</bug_when>
    <thetext>There are also similar updates needed to the Connector element (more things
changed on that one).</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>22691</bug_id>
          
          <creation_ts>2003-08-25 09:59:00 +0000</creation_ts>
          <short_desc>TldConfig.getGlobalJarPath() throws an IOException which is not really catched</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.6</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Thorsten Schmidt">thorsten_schmidt</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>43234</commentid>
    <comment_count>0</comment_count>
    <who name="Thorsten Schmidt">thorsten_schmidt</who>
    <bug_when>2003-08-25 09:59:17 +0000</bug_when>
    <thetext>For a special integration support I extended the commonLoader in 
org.apache.catalina.startup.Bootstrap with a specia parent class loader 
(normaly the system classloader is used). In this case 
org.apache.catalina.startup.TldConfig.getGlobalJarPath() will throw an 
IOException at getCononicalFile() (take a look at the JavaDoc of 
File.getCanoncialFile()) which is never really catched. To fix this problem I 
wrapped this part in a try-catch-expression locally.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43312</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-26 07:20:30 +0000</bug_when>
    <thetext>This will be finxed in 5.0.10.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>22698</bug_id>
          
          <creation_ts>2003-08-25 15:35:00 +0000</creation_ts>
          <short_desc>org.apache.catalina.realm.RealmBase missing main()</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.9</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Michael Kearney">mkearney</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>43244</commentid>
    <comment_count>0</comment_count>
    <who name="Michael Kearney">mkearney</who>
    <bug_when>2003-08-25 15:35:33 +0000</bug_when>
    <thetext>In the "Digested Passwords" section of the documentation is states:
    * If you want to execute a command line utility to calculate the digested
password, simply execute

java org.apache.catalina.realm.RealmBase \
    -a {algorithm} {cleartext-password}

      and the digested version of this cleartext password will be returned to
standard output.

However, RealmBase no longer has a main() method as was the case in Tomcat 3 and 4.

The proposed fix would be simply to copy the code from the previous release into
the release 5 codebase but I wouldn't presume to do so.   Thanks.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43321</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-08-26 08:49:19 +0000</bug_when>
    <thetext>The fix will be in 5.0.10.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>22833</bug_id>
          
          <creation_ts>2003-08-30 14:12:00 +0000</creation_ts>
          <short_desc>Generated SMAP looks wrong</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.9</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Marcus Nylander">marcus.nylander</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>43497</commentid>
    <comment_count>0</comment_count>
    <who name="Marcus Nylander">marcus.nylander</who>
    <bug_when>2003-08-30 14:12:33 +0000</bug_when>
    <thetext>In some cases the genereted SMAP seems wrong. If one looks at the JSR-45 and 
compare it with the example below the SMAP seems wrong.

The Example is the same as in JSR-45. 

File: Hello.jsp

&lt;HTML&gt;
&lt;HEAD&gt;
&lt;TITLE&gt;Hello Example&lt;/TITLE&gt;
&lt;/HEAD&gt;
&lt;BODY&gt;
&lt;%@ include file="greeting.jsp" %&gt;
&lt;/BODY&gt;
&lt;/HTML&gt; 

File 2: greeting.jsp

Hello There!&lt;P&gt;
Goodbye on &lt;%= new java.util.Date() %&gt;


The output SMAP becomes:

Hello_jsp.java
JSP
*S JSP
*F
+ 0 /Hello.jsp
Hello.jsp
+ 1 /greeting.jsp
greeting.jsp
*L
1,2:45   
3:47,2
4,2:49
1#1:51,2
2:52,2      &lt;= seems wrong.. Should't it be 2#1:52,2
6#0,3:54    
*E

In all examples in JSR-45 they always use the file-id in the line info, 
shouldn't Jasper do the same? Like the following
1#0,2:45   
3#0:47,2
4#0,2:49
1#1:51,2
2#1:52,2      
6#0,3:54


It also looks like SMAP for JSP-declarations does not work. If I add a 
&lt;%!
	void test() {
		System.out.print("Hello there..");
	}
%&gt;

first to Hello.jsp. The first SMAP-line mapping the declaration becomes 2,4:1 
when should be 2,4:9 looking at the generated jsp.




First example of generated JSP:

package org.apache.jsp;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;

public final class Hello_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static java.util.Vector _jspx_dependants;

  static {
    _jspx_dependants = new java.util.Vector(1);
    _jspx_dependants.add("/greeting.jsp");
  }

  public java.util.List getDependants() {
    return _jspx_dependants;
  }

  public void _jspService(HttpServletRequest request, HttpServletResponse 
response)
        throws java.io.IOException, ServletException {

    JspFactory _jspxFactory = null;
    PageContext pageContext = null;
    HttpSession session = null;
    ServletContext application = null;
    ServletConfig config = null;
    JspWriter out = null;
    Object page = this;
    JspWriter _jspx_out = null;


    try {
      _jspxFactory = JspFactory.getDefaultFactory();
      response.setContentType("text/html");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("&lt;HTML&gt;\r\n");
      out.write("&lt;HEAD&gt;\r\n");
      out.write("&lt;TITLE&gt;Hello Example");
      out.write("&lt;/TITLE&gt;\r\n");
      out.write("&lt;/HEAD&gt;\r\n");
      out.write("&lt;BODY&gt;\r\n");
      out.write("Hello There!");
      out.write("&lt;P&gt;\r\nGoodbye on ");
      out.write(String.valueOf( new java.util.Date() ));
      out.write("\r\n");
      out.write("&lt;/BODY&gt;\r\n");
      out.write("&lt;/HTML&gt;  ");
    } catch (Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null &amp;&amp; out.getBufferSize() != 0)
          out.clearBuffer();
        if (pageContext != null) pageContext.handlePageException(t);
      }
    } finally {
      if (_jspxFactory != null) _jspxFactory.releasePageContext(pageContext);
    }
  }
}</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43578</commentid>
    <comment_count>1</comment_count>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-09-02 03:50:41 +0000</bug_when>
    <thetext>The JSR-45 spec says:

"Each LineInfo has the form: 'InputStartLine # LineFileID , RepeatCount : 
OutputStartLine , OutputLineIncrement' where all but 'InputStartLine : 
OutputStartLine' are optional.... If absent LineFileID defaults to the most 
recent value (initially zero)."

In other words LineFileID is only required when it differs from the LineFileID 
of the previous LineInfo.  To the best of my knowledge Jasper is consistent 
with that.

You're absolutely right that Jasper should SMAP JSP declarations, but doesn't.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44368</commentid>
    <comment_count>2</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-09-19 23:43:49 +0000</bug_when>
    <thetext>Declaration are now properly mapped.  Thanks for reporting.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>22848</bug_id>
          
          <creation_ts>2003-08-31 12:33:00 +0000</creation_ts>
          <short_desc>[PATCH] Fix typos/grammar in changelog.html</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Documentation</component>
          <version>5.0.10</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>http://jakarta.apache.org/tomcat/tomcat-5.0-doc/changelog.html</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Yann Cébron">yannc76</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>43514</commentid>
    <comment_count>0</comment_count>
    <who name="Yann Cébron">yannc76</who>
    <bug_when>2003-08-31 12:33:02 +0000</bug_when>
    <thetext>Various minor grammar/spelling fixes, no content changes.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43515</commentid>
    <comment_count>1</comment_count>
      <attachid>8013</attachid>
    <who name="Yann Cébron">yannc76</who>
    <bug_when>2003-08-31 12:33:54 +0000</bug_when>
    <thetext>Created attachment 8013
Fix some typos in changelog.html</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43603</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-09-02 13:41:34 +0000</bug_when>
    <thetext>I have applied you patch. Thanks.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43808</commentid>
    <comment_count>3</comment_count>
    <who name="Yann Cébron">yannc76</who>
    <bug_when>2003-09-07 11:57:03 +0000</bug_when>
    <thetext>Adding small new patch for 5.0.10 to this ticket.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43809</commentid>
    <comment_count>4</comment_count>
      <attachid>8087</attachid>
    <who name="Yann Cébron">yannc76</who>
    <bug_when>2003-09-07 11:58:08 +0000</bug_when>
    <thetext>Created attachment 8087
Fix some typos in changelog.html for paragraph "5.0.10"</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43818</commentid>
    <comment_count>5</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-09-07 19:11:21 +0000</bug_when>
    <thetext>Thanks.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>8013</attachid>
            <date>2003-08-31 12:33:00 +0000</date>
            <delta_ts>2003-08-31 12:33:54 +0000</delta_ts>
            <desc>Fix some typos in changelog.html</desc>
            <filename>changelog_xml_typofix.txt</filename>
            <type>text/plain</type>
            <size>11877</size>
            <attacher name="Yann Cébron">yannc76</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>8087</attachid>
            <date>2003-09-07 11:58:00 +0000</date>
            <delta_ts>2003-09-07 11:58:08 +0000</delta_ts>
            <desc>Fix some typos in changelog.html for paragraph "5.0.10"</desc>
            <filename>changelog_xml_5.0.10.typofix.txt</filename>
            <type>text/plain</type>
            <size>1676</size>
            <attacher name="Yann Cébron">yannc76</attacher>
            

          </attachment>
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>22857</bug_id>
          
          <creation_ts>2003-09-01 09:10:00 +0000</creation_ts>
          <short_desc>Spaces in Tomcat install directory name causes CGI failure</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlets:CGI</component>
          <version>Nightly Build</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Gordon DeGrandis">gordon.degrandis</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>43537</commentid>
    <comment_count>0</comment_count>
    <who name="Gordon DeGrandis">gordon.degrandis</who>
    <bug_when>2003-09-01 09:10:40 +0000</bug_when>
    <thetext>If the Tomcat default install directory is used on Windows (NT/W2k/XP) the 
default name causes CGI scripts not to function. 
The default install name for Tomcat is:
&lt;drive&gt;:\Program Files\Apache Tomcat 4.0\
In our case the install name is:
&lt;drive&gt;:\soft\AR2\Apache Tomcat 4.0\

If a CGI script that uses Perl is used within this installation the result from 
the CGI is output on the web page. The result on the web page is:
Can't open perl script "&lt;drive&gt;:\soft\AR2\Apache": No such file or directory

The message contains the installation directory name for Tomcat up to the first 
blank character. 
The CGI path name once evaluated by Tomcat is:
&lt;drive&gt;:\soft\AR2\Apache Tomcat 4.0\webapps\adaptive\WEB-INF\Cgi\exp.cgi

There does not seem to be a way to change this behaviour in the standard Tomcat 
product.

Other information is available on request. I have the CGI script and all the 
log files.

Thank you</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43637</commentid>
    <comment_count>1</comment_count>
    <who name="Mark Thomas">medthomas</who>
    <bug_when>2003-09-02 21:16:54 +0000</bug_when>
    <thetext>Confirmed. This is also an issue with TC5.

The problem is that the space character is used to delimit parameters passed 
to the perl interpreter. If the path to the perl script includes a space then 
the interpreter assumes the path is shorter than it really is.

I have posted proposed patches for TC4 and TC5 that work with Windows XP and 
should work with NT and 2000 to the tomcat-dev list.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43672</commentid>
    <comment_count>2</comment_count>
    <who name="Mark Thomas">medthomas</who>
    <bug_when>2003-09-03 17:26:09 +0000</bug_when>
    <thetext>The patch has been applied to CVS for TC4 and TC5. It will be available in the 
next release.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>22858</bug_id>
          
          <creation_ts>2003-09-01 09:22:00 +0000</creation_ts>
          <short_desc>CGI scripts without a file suffix causes Error=193</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlets:CGI</component>
          <version>Nightly Build</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Gordon DeGrandis">gordon.degrandis</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>1</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>43538</commentid>
    <comment_count>0</comment_count>
    <who name="Gordon DeGrandis">gordon.degrandis</who>
    <bug_when>2003-09-01 09:22:49 +0000</bug_when>
    <thetext>If you create or use a Perl CGI script that does not use a file suffix 
(IE. ".cgi") then the CGI servlet within Tomcat generates error=193. 

The solution is to rename the CGI with a ".cgi" file extension. Making this 
change though requires that all HTML pages that refer to the CGI must be 
changed to reference the new CGI file name. 

The CGI script without a file extension works correctly in Apache.

The path references have been modified.
The error log output is:
In the log file localhost_log.&lt;date&gt;.txt:
2003-08-14 11:42:23 cgi: findCGI: path=/xml-mg-search, &lt;drive&gt;:\soft\AR2\Apache 
Tomcat 4.0\webapps\ROOT\WEB-INF/cgi
2003-08-14 11:42:23 cgi: findCGI: currentLoc=&lt;drive&gt;:\soft\AR2\Apache Tomcat 4.0
\webapps\ROOT\WEB-INF\cgi
2003-08-14 11:42:23 cgi: findCGI: currentLoc=&lt;drive&gt;:\soft\AR2\Apache Tomcat 4.0
\webapps\ROOT\WEB-INF\cgi
2003-08-14 11:42:23 cgi: findCGI: FOUND cgi at &lt;Drive&gt;:\soft\AR2\Apache Tomcat 
4.0\webapps\ROOT\WEB-INF\cgi\xml-mg-search
2003-08-14 11:42:23 cgi: findCGI calc: name=xml-mg-search, 
path=&lt;Drive&gt;:\soft\AR2\Apache Tomcat 4.0\webapps\ROOT\WEB-INF\cgi\xml-mg-
search, scriptname=/cgi-bin\xml-mg-search, cginame=\xml-mg-search
2003-08-14 11:42:23 cgi: runCGI(envp=[{HTTP_USER_AGENT=Java1.3.1_05, 
REQUEST_METHOD=GET, AUTH_TYPE=, SERVER_NAME=localhost, SERVER_SOFTWARE=TOMCAT, 
HTTP_HOST=localhost, GATEWAY_INTERFACE=CGI/1.1, 
X_TOMCAT_SCRIPT_PATH=&lt;Drive&gt;:\soft\AR2\Apache Tomcat 4.0\webapps\ROOT\WEB-
INF\cgi\xml-mg-search, REMOTE_ADDR=127.0.0.1, SERVER_PROTOCOL=HTTP/1.1, 
PATH_INFO=, REMOTE_HOST=localhost, QUERY_STRING=cgi=http%3A%2F%2Flocalhost%
2Fcgi-bin%2Fxml-mg-search&amp;sid=0&amp;app=%2Fadaptive&amp;laf=%
2FBBL&amp;xsl=search.xsl&amp;clslist=&amp;vc=Gu006UREP40d013CodingSchemess003RSMr010RSM_Obje
ct%
3AV000002aa3d&amp;query=visa&amp;y=0&amp;x=0&amp;pa=Gu006UREP40d013CodingSchemess003RSMr010RSM_O
bject%3AV000002aa69&amp;attrlist=&amp;rid=CodingSchemes&amp;bs=10&amp;mgdb=CodingSchemes, 
HTTP_CONNECTION=keep-alive, SERVER_PORT=80, CONTENT_TYPE=, CONTENT_LENGTH=, 
HTTP_ACCEPT=text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2, 
SCRIPT_NAME=/cgi-bin\xml-mg-search, REMOTE_USER=, REMOTE_IDENT=}], 
command=&lt;Drive&gt;:\soft\AR2\Apache Tomcat 4.0\webapps\ROOT\WEB-INF\cgi\xml-mg-
search)
2003-08-14 11:42:23 StandardWrapperValve[cgi]: Servlet.service() for servlet 
cgi threw exception
java.io.IOException: CreateProcess: &lt;Drive&gt;:\soft\AR2\Apache Tomcat 4.0
\webapps\ROOT\WEB-INF\cgi\xml-mg-search cgi=http%253A%252F%252Flocalhost%
252Fcgi-bin%252Fxml-mg-search sid=0 app=%252Fadaptive laf=%252FBBL 
xsl=search.xsl clslist= vc=Gu006UREP40d013CodingSchemess003RSMr010RSM_Object%
253AV000002aa3d query=visa y=0 x=0 
pa=Gu006UREP40d013CodingSchemess003RSMr010RSM_Object%253AV000002aa69 attrlist= 
rid=CodingSchemes bs=10 mgdb=CodingSchemes error=193
	at java.lang.Win32Process.create(Native Method)
	at java.lang.Win32Process.&lt;init&gt;(Win32Process.java:61)
	at java.lang.Runtime.execInternal(Native Method)
	at java.lang.Runtime.exec(Runtime.java:546)
	at java.lang.Runtime.exec(Runtime.java:413)
	at org.apache.catalina.servlets.CGIServlet$CGIRunner.run
(CGIServlet.java:1585)
	at org.apache.catalina.servlets.CGIServlet.doGet(CGIServlet.java:635)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:740)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter
(ApplicationFilterChain.java:247)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter
(ApplicationFilterChain.java:193)
	at org.apache.catalina.core.StandardWrapperValve.invoke
(StandardWrapperValve.java:243)
	at org.apache.catalina.core.StandardPipeline.invokeNext
(StandardPipeline.java:566)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:472)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)
	at org.apache.catalina.core.StandardContextValve.invoke
(StandardContextValve.java:190)
	at org.apache.catalina.core.StandardPipeline.invokeNext
(StandardPipeline.java:566)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:472)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)
	at org.apache.catalina.core.StandardContext.invoke
(StandardContext.java:2347)
	at org.apache.catalina.core.StandardHostValve.invoke
(StandardHostValve.java:180)
	at org.apache.catalina.core.StandardPipeline.invokeNext
(StandardPipeline.java:566)
	at org.apache.catalina.valves.ErrorDispatcherValve.invoke
(ErrorDispatcherValve.java:170)
	at org.apache.catalina.core.StandardPipeline.invokeNext
(StandardPipeline.java:564)
	at org.apache.catalina.valves.ErrorReportValve.invoke
(ErrorReportValve.java:170)
	at org.apache.catalina.core.StandardPipeline.invokeNext
(StandardPipeline.java:564)
	at org.apache.catalina.valves.AccessLogValve.invoke
(AccessLogValve.java:468)
	at org.apache.catalina.core.StandardPipeline.invokeNext
(StandardPipeline.java:564)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:472)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)
	at org.apache.catalina.core.StandardEngineValve.invoke
(StandardEngineValve.java:174)
	at org.apache.catalina.core.StandardPipeline.invokeNext
(StandardPipeline.java:566)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:472)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)
	at org.apache.catalina.connector.http.HttpProcessor.process
(HttpProcessor.java:1027)
	at org.apache.catalina.connector.http.HttpProcessor.run
(HttpProcessor.java:1125)
	at java.lang.Thread.run(Thread.java:479)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43639</commentid>
    <comment_count>1</comment_count>
    <who name="Mark Thomas">medthomas</who>
    <bug_when>2003-09-02 21:20:01 +0000</bug_when>
    <thetext>Confirmed. This is also an issue with TC5.

The CGI servlet includes a test for ".pl" and ".cgi". Any other suffix 
(including none) will fail.

I have posted patches for TC4 and TC5 to the tomcat-dev list. The patches are 
tested with XP and should work with NT/2000.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43673</commentid>
    <comment_count>2</comment_count>
    <who name="Mark Thomas">medthomas</who>
    <bug_when>2003-09-03 17:26:36 +0000</bug_when>
    <thetext>The patch has been applied to CVS for TC4 and TC5. It will be available in the 
next release.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>22867</bug_id>
          
          <creation_ts>2003-09-01 22:01:00 +0000</creation_ts>
          <short_desc>Tag handlers can't be inner/nested classes</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.9</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Gunnlaugur Thor Briem">gthb</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>43573</commentid>
    <comment_count>0</comment_count>
    <who name="Gunnlaugur Thor Briem">gthb</who>
    <bug_when>2003-09-01 22:01:39 +0000</bug_when>
    <thetext>When I try to use a nested class such as com.foo.MyTag$Bar as a tag handler,
the JSP-generated class fails compilation due to the use of names containing $
in source code. It says something like "perchance you meant com.foo.MyTag.Bar".
When I try replacing the $ with a . in the TLD file, it gives me this:

o.a.j.JasperException: /headlines.jsp(11,2) Unable to load class generator
  at o.a.j.compiler.DefaultErrorHandler.jspError(DefaultErrorHandler.java:94)
  at o.a.j.compiler.ErrorDispatcher.dispatch(ErrorDispatcher.java:428)
  at o.a.j.compiler.ErrorDispatcher.jspError(ErrorDispatcher.java:219)
  at o.a.j.compiler.Parser.parseCustomTag(Parser.java:712)
  at o.a.j.compiler.Parser.parseElements(Parser.java:804)
  ...

(where I replaced org.apache.jasper with o.a.j to make the stack trace readable
in Bugzilla)

My exact same classes are working fine as tag handlers in the version of Tomcat
integrated into Borland Enterprise Server 5.2 (don't know what version that is,
nor which modifications they may have made, but it's certainly somewhat older
than Tomcat 4.1.24), but I'm seeing this failure in Tomcat 4.1.24 integrated
into JBoss 3.2.1. Thus I do not know for sure whether this problem is a result
of a classloader bug introduced by the JBoss integration (or one fixed by the
BES integration) or simply a Tomcat/Jasper bug that cropped up sometime between
these two versions.

I also don't know whether this should go to the Jasper component or the Jasper2
component (no version info in the jasper-compiler.jar and jasper-runtime.jar
manifest files)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43574</commentid>
    <comment_count>1</comment_count>
    <who name="Gunnlaugur Thor Briem">gthb</who>
    <bug_when>2003-09-01 22:47:55 +0000</bug_when>
    <thetext>It's Jasper2, apparently.

The second error message I got is presumably from this code in
org.apache.jasper.compiler.Parser:

try {
    tagHandlerClass
	= ctxt.getClassLoader().loadClass(tagInfo.getTagClassName());
} catch (Exception e) {
    err.jspError(start, "jsp.error.unable.loadclass", shortTagName,
		 prefix);
}

so "generator" is just the name of my custom tag (which explains why I didn't
find a single hit for "unable to load class generator" in Google or the Apache
Bugzilla :) ... and it makes perfect sense that the classloader didn't find
this nested class by the nonstandard name syntax OuterClass.NestedClass
(instead of the standard OuterClass$NestedClass syntax).

So the point remains that a nested class breaks JSP compilation if given with
the $ syntax, and breaks classloader lookup if given with the . syntax. So
nested classes are not usable as tag handlers, at least as of version 4.1.24.

The root of this problem is that nested classes in Java have different names
at compile time and at runtime. The fix is presumably to add logic to the JSP
source file generation, replacing all dollar signs in tag-handler classnames
with dots.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43586</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-09-02 09:57:45 +0000</bug_when>
    <thetext>You're not giving enough details on the original error. Obviously declaring
OuterClass.NestedClass in the TLD is wrong: the actual classname is
OuterClass$NestedClass. So you shouldn't do that, that won't get you anywhere.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43590</commentid>
    <comment_count>3</comment_count>
      <attachid>8031</attachid>
    <who name="Gunnlaugur Thor Briem">gthb</who>
    <bug_when>2003-09-02 10:43:52 +0000</bug_when>
    <thetext>Created attachment 8031
Log snippet showing the error message from JSP compilation</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43591</commentid>
    <comment_count>4</comment_count>
    <who name="Gunnlaugur Thor Briem">gthb</who>
    <bug_when>2003-09-02 10:50:44 +0000</bug_when>
    <thetext>I've attached a logfile taken from JBoss server.log, showing the error.

I do know that A.B is not the (runtime) classname of the class :) but it is a
valid compile-time name (and A$B isn't). My JSP page was breaking at compile
time because of the A$B syntax in source code. So it wasn't a very dumb attempt.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43594</commentid>
    <comment_count>5</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-09-02 12:12:07 +0000</bug_when>
    <thetext>The bug is with the code generator (I assume doing a replace('$', '.') on the
tag classname would solve the problem there; I can't see any side effect), as
the error log indicates.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43604</commentid>
    <comment_count>6</comment_count>
    <who name="Gunnlaugur Thor Briem">gthb</who>
    <bug_when>2003-09-02 13:43:30 +0000</bug_when>
    <thetext>Even though this bug's product/version designation has been changed to Tomcat5,
it is still present in the Tomcat 4.1 branch, and should be fixed there as well
... assuming there are any more releases on that branch.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43636</commentid>
    <comment_count>7</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-09-02 20:48:54 +0000</bug_when>
    <thetext>This probably needs clarification from the spec.

By doing a replace('$', '.'), we are assuming that any class name containing a
'$' is reference to an inner class, but this is not necessarily so.  I can
certainly define $foo to be my (non-inner) tag handler class.

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43642</commentid>
    <comment_count>8</comment_count>
    <who name="Gunnlaugur Thor Briem">gthb</who>
    <bug_when>2003-09-02 22:00:47 +0000</bug_when>
    <thetext>You certainly can, but if you did that, you would pretty much have only yourself
to blame when tools give you a hard time about it, because of this clause in the
Java Language Specification (Section 3.8, Java Identifiers):

    The Java letters include uppercase and lowercase ASCII Latin letters A-Z
    (\u0041-\u005a), and a-z (\u0061-\u007a), and, for historical reasons,
    the ASCII underscore (_, or \u005f) and dollar sign ($, or \u0024). The $
    character should be used only in mechanically generated source code or,
    rarely, to access preexisting names on legacy systems.
    
http://java.sun.com/docs/books/jls/second_edition/html/lexical.doc.html#40625

Given that, I think it would be fair to assume that '$' means a nested class
... especially since doing that repairs a common use case that is currently
broken, perhaps at the cost of breaking an arcane one which is probably *also*
currently broken :)

But this section of the JLS does beg the question: why is the JSP compiler
rejecting an identifier with a '$' in it? Since it is legal (apparently in
source code as well -- I thought it wasn't), there shouldn't be a problem
resolving a classname like A$B when there is an import declaration for A
and A contains a static nested class called B -- should there? Is Sun's
javac breaking the JLS by rejecting this?
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43644</commentid>
    <comment_count>9</comment_count>
    <who name="Gunnlaugur Thor Briem">gthb</who>
    <bug_when>2003-09-02 22:11:18 +0000</bug_when>
    <thetext>Yes, apparently it is breaking it, and not by accident.

http://developer.java.sun.com/developer/bugParade/bugs/4887861.html says:

    jdk 1.4.2 does not allow the use of "$" to refer to inner classes anymore.
    We have fixed the code generator to address this.

http://developer.java.sun.com/developer/bugParade/bugs/4894381.html says:

    JDK 1.4.2 does not allow to generate field type for setters and getters
    for the inner classes as user-defined serializable CMP field types with
    '$' as returned from getClass().getName(). Added code that replaces '$'
    with '.' for the user-defined serializable CMP field types (blob but not
    byte[]).

So apparently they have made this decision consciously in JDK 1.4.2, even
though it seems to contradict the JLS.

Sun's own workaround in Sun ONE app server was to replace '$' with '.' ...
I would move for Tomcat to do the same.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43649</commentid>
    <comment_count>10</comment_count>
    <who name="Gunnlaugur Thor Briem">gthb</who>
    <bug_when>2003-09-02 22:32:25 +0000</bug_when>
    <thetext>Ah, I'm probably wrong there ... the JLS does allow identifiers to contain '$',
and javac still allows that. But javac no longer allows you to work with the
assumption that a compiled nested class B in a top-level class A will be called
A$B ... and the JLS never allowed us to make that assumption in the first place.

So I shouldn't be attempting to refer to this class with the A$B syntax. What,
then, is the correct way to refer to it? Must I use A.B syntax? I guess so,
according to JLS Section 6.7, Fully Qualified Names and Canonical Names:

    A member class or member interface M of another class C has a fully
    qualified name if and only if C has a fully qualified name. In that
    case, the fully qualified name of M consists of the fully qualified
    name of C, followed by ".", followed by the simple name of M.

But presumably the only bug here is that using this correct A.B syntax is
failing with the abovementioned error: "Unable to load class generator"
(where "generator" is just the tagname, which is placed in this error
message instead of the classname registered for that tag, probably by
mistake -- I guess that's a little "extra bug" here :) )
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43650</commentid>
    <comment_count>11</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-09-02 22:41:55 +0000</bug_when>
    <thetext>Personally, I would choose to do a replace '$' -&gt; '.' in the generated source. I
don't see anyone willingly using '$' in a tagfile classname, except if it's an
inner class ;-)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44010</commentid>
    <comment_count>12</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-09-11 00:04:58 +0000</bug_when>
    <thetext>Yeah, I also prefer binary names ("outter$inner") instead of canonical names
("outter.inner").  However, the J2EE folks still have not made a offical
decision yet.

There is simple algirithm that can let one compute the canonical name from a
Class object, without the restriction that the top-level class name not
continaing '$'.  The following is based on an algorithm by Mark Roth, the JSP
spec lead:

String getCanonicalName(Class c) {

    Class outer = c.getDeclaringClass(c);
    if (outer == null) {
        return c.getName();
    } else {
        String innerName = c.getName().substring(outer.getName().length()+1);
        return getCanonicalName(outer) + "." + innerName; 
    }
}

This is slightly more compilicated than replacing '$' with '.', but it covers
all cases.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44363</commentid>
    <comment_count>13</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-09-19 18:50:53 +0000</bug_when>
    <thetext>The decision is to use binary names, e.g. Outer$Inner.  I have fixed Jasper in
Tomcat 5 to accept that.  Let me know if it does not work for you.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48688</commentid>
    <comment_count>14</comment_count>
    <who name="Robert Flaherty">Robert_Flaherty</who>
    <bug_when>2003-12-08 19:07:55 +0000</bug_when>
    <thetext>Can someone clarify what will happen now.  Will &lt;tagclass&gt;A$B&lt;/tagclass&gt; be 
converted to A.B in the generated .java file (if not, then javac 1.4.2+ will 
fail)?  Also, will this fix be in Tomcat 4.x branch?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65367</commentid>
    <comment_count>15</comment_count>
    <who name="Firepica">vspa</who>
    <bug_when>2004-10-20 16:34:46 +0000</bug_when>
    <thetext>Sorry, wrong url...</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>8031</attachid>
            <date>2003-09-02 10:43:00 +0000</date>
            <delta_ts>2003-09-02 10:43:52 +0000</delta_ts>
            <desc>Log snippet showing the error message from JSP compilation</desc>
            <filename>log-snippet.log</filename>
            <type>text/plain</type>
            <size>6917</size>
            <attacher name="Gunnlaugur Thor Briem">gthb</attacher>
            

          </attachment>
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>22986</bug_id>
          
          <creation_ts>2003-09-08 13:13:00 +0000</creation_ts>
          <short_desc>Web apps with context XML file don't start if CATALINA_BASE is set and absolute path is used for appBase</short_desc>
          <delta_ts>2006-06-11 18:01:54 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.9</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Radim Kubacki">radim.kubacki</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>43834</commentid>
    <comment_count>0</comment_count>
    <who name="Radim Kubacki">radim.kubacki</who>
    <bug_when>2003-09-08 13:13:57 +0000</bug_when>
    <thetext>I'd like to run my own instance of Tomcat and use admin &amp; manager apps. To avoid
coying of these apps I tried to setup CATALINA_BASE dir with conf, logs, work,
and temp dirs and set appBase to $CATALINA_HOME/webapps (the actual path - not
with the variable). This works well on Linux but fails on WinXP with following
exception:
java.io.IOException: The filename, directory name, or volume label syntax is
incorrect
	at org.apache.commons.digester.Digester.createSAXException(Digester.java:2540)
	at org.apache.commons.digester.Digester.createSAXException(Digester.java:2566)
	at org.apache.commons.digester.Digester.startElement(Digester.java:1276)
	at org.apache.xerces.parsers.AbstractSAXParser.startElement(Unknown Source)
	at org.apache.xerces.impl.dtd.XMLDTDValidator.startElement(Unknown Source)
	at
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanStartElement(Unknown
Source)
	at
org.apache.xerces.impl.XMLDocumentScannerImpl$ContentDispatcher.scanRootElementHook(Unknown
Source)
	at
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(Unknown
Source)
	at org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown
Source)
	at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)
	at org.apache.xerces.parsers.DTDConfiguration.parse(Unknown Source)
	at org.apache.xerces.parsers.XMLParser.parse(Unknown Source)
	at org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)
	at org.apache.commons.digester.Digester.parse(Digester.java:1567)
	at
org.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:515)
	at org.apache.catalina.core.StandardHost.install(StandardHost.java:866)
	at org.apache.catalina.startup.HostConfig.deployDescriptors(HostConfig.java:529)
	at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:474)
	at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1008)
	at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:399)
	at
org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)
	at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1135)
	at org.apache.catalina.core.StandardHost.start(StandardHost.java:792)
	at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1127)
	at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:502)
	at org.apache.catalina.core.StandardService.start(StandardService.java:519)
	at org.apache.catalina.core.StandardServer.start(StandardServer.java:2311)
	at org.apache.catalina.startup.Catalina.start(Catalina.java:578)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)

the problem is that 
new File(&lt;anything&gt;,
"D:\\path\\to\\my\\catalina_home\\webapps").getCannonicalFile()) always throws
an exception. More accurately it fails when the child argument is absolute path.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43835</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-09-08 13:51:11 +0000</bug_when>
    <thetext>This is an obvious mistake in SetDocBaseRule. A few lines after that bad
canonicalization, there was the same call, with the right isAbsolute check. This
is now fixed.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44430</commentid>
    <comment_count>2</comment_count>
    <who name="Radim Kubacki">radim.kubacki</who>
    <bug_when>2003-09-22 09:18:23 +0000</bug_when>
    <thetext>Confirmed that it is OK (tested with 5.0.12).</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>22995</bug_id>
          
          <creation_ts>2003-09-08 15:36:00 +0000</creation_ts>
          <short_desc>[PATCH] add a new item to faq</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter>tagunov</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>43841</commentid>
    <comment_count>0</comment_count>
    <who name="">tagunov</who>
    <bug_when>2003-09-08 15:36:46 +0000</bug_when>
    <thetext>--- connectors.orig	2003-07-11 14:57:20.000000000 +0400
+++ connectors.xml	2003-09-08 
19:32:04.000000000 +0400
@@ -122,6 +122,13 @@
      what's wrong?
       &lt;/a&gt;
     &lt;/li&gt;
+    &lt;li&gt;
+      &lt;a 
href="#generated"&gt;
+      Is there any way to control the content of automatically generated 
+      
&lt;code&gt;mod_jk.conf-auto&lt;/code&gt;? I need my own specific commands added
+      to it.
+      &lt;/a&gt;
+    
&lt;/li&gt;
   &lt;/ul&gt;
 &lt;/p&gt;
 &lt;/section&gt;
@@ -288,10 +295,19 @@
     &lt;/a&gt;
   &lt;/answer&gt;
 
-
-
-
-
+  
&lt;question&gt;
+    &lt;a name="generated"&gt;
+    Is there any way to control the content of automatically 
generated 
+    &lt;code&gt;mod_jk.conf-auto&lt;/code&gt;? I need my own specific commands added
+    to 
it.
+    &lt;/a&gt;
+  &lt;/question&gt;
+  &lt;answer&gt;
+    There really is no need to. Just copy the 
automatically generated
+    &lt;code&gt;mod_jk.conf-auto&lt;/code&gt; and edit it manually to your 
preference.
+    None of production tomcat installations really use &lt;code&gt;mod_jk.conf-
auto&lt;/code&gt;
+    as it is.
+  &lt;/answer&gt;
 &lt;/section&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43842</commentid>
    <comment_count>1</comment_count>
      <attachid>8100</attachid>
    <who name="">tagunov</who>
    <bug_when>2003-09-08 15:37:44 +0000</bug_when>
    <thetext>Created attachment 8100
same patch as an attachment</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>43858</commentid>
    <comment_count>2</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2003-09-09 01:24:52 +0000</bug_when>
    <thetext>Patch made. Thanks!</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>8100</attachid>
            <date>2003-09-08 15:37:00 +0000</date>
            <delta_ts>2003-09-08 15:37:44 +0000</delta_ts>
            <desc>same patch as an attachment</desc>
            <filename>connectors.diff</filename>
            <type>text/plain</type>
            <size>1037</size>
            <attacher>tagunov</attacher>
            

          </attachment>
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>23290</bug_id>
          
          <creation_ts>2003-09-20 13:39:00 +0000</creation_ts>
          <short_desc>Documentation Typo</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Documentation</component>
          <version>5.0.0</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="T.Takahashi">ta_takaha</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>44379</commentid>
    <comment_count>0</comment_count>
    <who name="T.Takahashi">ta_takaha</who>
    <bug_when>2003-09-20 13:39:11 +0000</bug_when>
    <thetext>In tomcat-docs/building.xml, 
"Ealier releases would also work, ..."
should be
"Earlier releases would also work, ..."</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44401</commentid>
    <comment_count>1</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2003-09-21 15:40:03 +0000</bug_when>
    <thetext>fixed</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>23312</bug_id>
          
          <creation_ts>2003-09-22 01:32:00 +0000</creation_ts>
          <short_desc>Bug in setclasspath.sh startup script</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.0.12</version>
          <rep_platform>Other</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Alan Moffet">amoffet</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>44420</commentid>
    <comment_count>0</comment_count>
    <who name="Alan Moffet">amoffet</who>
    <bug_when>2003-09-22 01:32:32 +0000</bug_when>
    <thetext>Changes were made to introduce specialized behavior for os400.  In catalina.sh,
the variable os400 is set to either "true" or "false".  Thereafter, tests are
made in this fashion:

if $os400; then

The same variable is also used in setclasspath.sh.  However, the test there is

if [ ! "$os400" ]; then

which will always evaluate to false, given that the variable is set.

The setclasspath.sh script can be modified to correct this faulty behavior by 
using this form instead:

if ! "$os400"; then

At the moment this problem prevents a user from starting Tomcat in debug mode.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44435</commentid>
    <comment_count>1</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2003-09-22 11:01:06 +0000</bug_when>
    <thetext>The 'if ! "$os400"; then' breaks on other OS's (solaris?) which was why this was
made the current way. 

Any crossplatform *nix gurus know the correct syntax to keep sh on all os's happy?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44443</commentid>
    <comment_count>2</comment_count>
    <who name="Christoph Seibert">seibert</who>
    <bug_when>2003-09-22 12:11:41 +0000</bug_when>
    <thetext>Maybe test explicitly for "false"?

if [ "$os400" = "false" ]; then

This depends on having the 'test' utility (which '[' is an alias for), however, but I guess that's 
common enough.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44971</commentid>
    <comment_count>3</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2003-10-02 01:13:47 +0000</bug_when>
    <thetext>Fixed for 5.0.13</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>23344</bug_id>
          
          <creation_ts>2003-09-23 08:21:00 +0000</creation_ts>
          <short_desc>catalina.properties don't allow to add one jar file</short_desc>
          <delta_ts>2005-07-22 08:18:28 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.12</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Dario Bonino">dario.bonino</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>44491</commentid>
    <comment_count>0</comment_count>
    <who name="Dario Bonino">dario.bonino</who>
    <bug_when>2003-09-23 08:21:45 +0000</bug_when>
    <thetext>My directory "/X" contains 4 jar files:
- /X/jdbcOracle.jar
- /X/jdbcMySQL.jar
- /X/Xerces.jar
- /X/Xalan.jar

I updated shared.loader in catalina.properties (or common.loader, it's the same)
value to see jdbc driver:

- shared.loader=...default...,/X/jdbcOracle.jar,/X/jdbcMySQL.jar
  =&gt; ClassNotFoundException: oracle.jdbc.driver.OracleDriver

- shared.loader=...default...,/X/*.jar
  =&gt; OK!</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44496</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-09-23 10:36:25 +0000</bug_when>
    <thetext>This sounds reasonable. Can you submit a tested fix ?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44562</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-09-24 05:22:30 +0000</bug_when>
    <thetext>I've added the possibility to add URLs to the list. This can be local or remote
folders, or single local or remote JARs.
Actually, you could probably use that to run Tomcat with the binary on a remote
server, using only the bootstrap stuff (this is similar to webstart, I guess).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44569</commentid>
    <comment_count>3</comment_count>
    <who name="Dario Bonino">dario.bonino</who>
    <bug_when>2003-09-24 07:02:06 +0000</bug_when>
    <thetext>&gt; This sounds reasonable. Can you submit a tested fix ?

I was trying ... 
Don't throw the challenge and solve the problem the day after! :-)
Thanks.

&gt; Actually, you could probably use that to run Tomcat with the binary on a remote
&gt; server, using only the bootstrap stuff (this is similar to webstart, I guess).

We working on one huge application deployable on different application server.
We use Tomcat in the development environment, here we don't deploy anything:
we set tomcat classloaders to load classes from the IDE projects directories.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>76413</commentid>
    <comment_count>4</comment_count>
    <who name="Alexandre Akoulov">alexandre.akoulov</who>
    <bug_when>2005-06-15 02:48:42 +0000</bug_when>
    <thetext>While working on building tomcat-5.0.28 and testing web apps I came across the
same problem. I dived into the source code and fixed the actual problem (rather
than using url, eg, file:///&lt;path&gt;/&lt;file&gt;.jar). Please refer to the explanation
below.

When adding a jar file (eg, "foo/bar.jar") to the class loader's repository it
treats as a directory and therefore it cannot load any classes from this jar.
The following explains why it happens.
	
--org.apache.catalina.startup.ClassLoaderFactory-- is responsible for creating
class loader instances. Each instance is of
org.apache.catalina.loader.StandardClassLoader type, which in its turn extends
java.net.URLClassLoader:

java.net.URLClassLoader
       / | \
         |
         |
org.apache.catalina.loader.StandardClassLoader
		
	
--ClassLoaderFactory#createClassLoader(File unpacked[], File packed[], URL
urls[], ClassLoader parent)-- is the actual method that creates class loaders.
First argument (ie unpacked) contains jar files or directories ( that is where
the name "unpacked" comes from ). 
Second argument (ie packed) is a directory packed with jar files
	
ClassLoaderFactory#createClassLoader method adds File.separator to the end of
the jar file path ( file.getCanonicalPath() + File.separator ) when constructing
a URL instance to represent a jar file and then adds a string representation of
a newly created URL to its list of repositories ( list.add(url.toString()) ) :
			-----------------------------------------------------------------------------
if (unpacked != null) {
  for (int i = 0; i &lt; unpacked.length; i++)  {
	File file = unpacked[i];
	if (!file.exists() || !file.canRead())
	    continue;
	    if (debug &gt;= 1)
	         log("  Including directory or JAR " 
	                        + file.getAbsolutePath());
	    URL url = new URL("file", null, 
	                       file.getCanonicalPath() + File.separator);
	    list.add(url.toString());
  }
}
	       
-----------------------------------------------------------------------------
	        
For instance, if "unpacked" argument contains '/home/aa/lib/velocity.jar' then a
URL object is 'file:/home/aa/lib/velocity.jar/' - a forward slash / (which is a
Unix file separator) has been added to the url.
	
After ClassLoaderFactory#createClassLoader adds all repositories to its
repository list it converts this list to array and constructs
StandardClassLoader with it:
	
		-----------------------------------------------------------------------------
String array[] = (String[]) list.toArray(new String[list.size()]);
StandardClassLoader classLoader = null;
if (parent == null)
  classLoader = new StandardClassLoader(array);
	    -----------------------------------------------------------------------------
	    
StandardClassLoader( String[] ) constructor converts each repository found in
the given array argument to a URL object:
		-----------------------------------------------------------------------------
protected static URL[] convert(String input[], URLStreamHandlerFactory factory) {
  .....
  url[i] = new URL(null, input[i], streamHandler);
  .....
}
		-----------------------------------------------------------------------------
                                   
For instance, if the repositories array of String type contains
'file:/home/aa/lib/velocity.jar/' then a URL object is
'file:/home/aa/lib/velocity.jar/'. If the repository holds a path on Windows
machine then the URL object would have all backslashes  replaced all  with
forward slashes ( URL object crated with new URL(null,
"file:I:\lib\velocity.jar\", streamHandler) would have
"file:I:/lib/velocity.jar/" string representation ).
    
Once StandardClassLoader( String[] ) converts repository array of a String type
into a URL type it calls its super constructor, which in fact is a
URLClassLoader( URL[] ).
    
However, the contract for URLClassLoader( URL[] ) constructor indicates that
"Any URL that ends with a '/' is assumed to refer to a directory. " and
therefore a jar file gets ignored by the loader.
    
For instance, if the repositories array contains
'file:/home/aa/lib/velocity.jar/' url object the URLClassLoader( URL[] )
constructor treats this url as a directory and therefore a jar file is never
properly loaded.
    
Therefore, a File.separator that got added to a jar file in
ClassLoaderFactory#createClassLoader method made it invalid because the actual
class loader assumes that this jar file is a directory.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>76415</commentid>
    <comment_count>5</comment_count>
      <attachid>15410</attachid>
    <who name="Alexandre Akoulov">alexandre.akoulov</who>
    <bug_when>2005-06-15 02:58:52 +0000</bug_when>
    <thetext>Created attachment 15410
ClassLoaderFactoryWithTheFix</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>76417</commentid>
    <comment_count>6</comment_count>
    <who name="Alexandre Akoulov">alexandre.akoulov</who>
    <bug_when>2005-06-15 02:59:50 +0000</bug_when>
    <thetext>The following illustrates the proposed solution (i've also attached two files:
"ClassLoaderFactoryWithTheFix" and a junit test "ClassLoaderFactoryTest")

--ClassLoaderFactory#createClassLoader(File unpacked[], File packed[], URL
urls[], ClassLoader parent)-- is to be modified so that it does not add
File.separator to the end of jar files found in the unpacked argument:
     
     	-----------------------------------------------------------------------------
if (unpacked != null) {
  for (int i = 0; i &lt; unpacked.length; i++)  {
	File file = unpacked[i];
	if (!file.exists() || !file.canRead())
	  continue;
	if (debug &gt;= 1)
	  log("  Including directory or JAR " 
	                        + file.getAbsolutePath());
	                
	  // THE FIX
	  StringBuffer filePath = new StringBuffer(file.getCanonicalPath());
	  if ( file.isDirectory() ) { 
	    // Only add a file separator if a file represents a directory
	    filePath.append(File.separator);
	  }
	                                
	  URL url = new URL("file", null, filePath.toString());
	  list.add(url.toString());
  }
}	
	    -----------------------------------------------------------------------------</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>76418</commentid>
    <comment_count>7</comment_count>
      <attachid>15411</attachid>
    <who name="Alexandre Akoulov">alexandre.akoulov</who>
    <bug_when>2005-06-15 03:00:49 +0000</bug_when>
    <thetext>Created attachment 15411
JUnit test case for the ClassLoaderFactory fix</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>77567</commentid>
    <comment_count>8</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2005-07-22 16:18:28 +0000</bug_when>
    <thetext>Someone else submitted a fix (for 5.5) that's simply to put file: in front of
single jars, but keep *.jar as-is.  That works for me, and seems a lot simpler.
 Does it work for you as well?  BTW, the version for this bug seems to be
5.0.12, which is really old.  Please try at least 5.0.28, but preferably 5.5.9.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>15410</attachid>
            <date>2005-06-15 02:58:00 +0000</date>
            <delta_ts>2005-06-15 02:58:52 +0000</delta_ts>
            <desc>ClassLoaderFactoryWithTheFix</desc>
            <filename>ClassLoaderFactoryWithTheFix.java</filename>
            <type>text/plain</type>
            <size>8259</size>
            <attacher name="Alexandre Akoulov">alexandre.akoulov</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>15411</attachid>
            <date>2005-06-15 03:00:00 +0000</date>
            <delta_ts>2005-06-15 03:00:49 +0000</delta_ts>
            <desc>JUnit test case for the ClassLoaderFactory fix</desc>
            <filename>ClassLoaderFactoryTest.java</filename>
            <type>text/plain</type>
            <size>9017</size>
            <attacher name="Alexandre Akoulov">alexandre.akoulov</attacher>
            

          </attachment>
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>23349</bug_id>
          
          <creation_ts>2003-09-23 13:49:00 +0000</creation_ts>
          <short_desc>Jakarta FAQ-o-matic link is dead.</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Documentation</component>
          <version>Unknown</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="T.Takahashi">ta_takaha</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>44500</commentid>
    <comment_count>0</comment_count>
    <who name="T.Takahashi">ta_takaha</who>
    <bug_when>2003-09-23 13:49:36 +0000</bug_when>
    <thetext>In introduction.html, Jakarta FAQ-o-matic link is dead.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44774</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-09-27 18:53:38 +0000</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>23373</bug_id>
          
          <creation_ts>2003-09-23 22:07:00 +0000</creation_ts>
          <short_desc>Servlet destroy() methods not being called at shutdown</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.12</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter>Dave</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>44538</commentid>
    <comment_count>0</comment_count>
    <who name="">Dave</who>
    <bug_when>2003-09-23 22:07:16 +0000</bug_when>
    <thetext>No servlet destroy() methods are being called at shutdown.
The problem is that the stopServer method in Catalina.java constructs a new 
StandardServer and the digester.parse(is); on line 423 results in a call back 
to setServer which means that when the SHUTDOWN command is sent to the server, 
it actually goes to the new !started server.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44539</commentid>
    <comment_count>1</comment_count>
      <attachid>8322</attachid>
    <who name="">Dave</who>
    <bug_when>2003-09-23 22:08:16 +0000</bug_when>
    <thetext>Created attachment 8322
There are several ways to fix this. IMO this is probably the tidiest!</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44561</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-09-24 05:19:19 +0000</bug_when>
    <thetext>This obviously works fine for me (I did test it again just to be sure). The
stopServer method is run in a separate JVM, so there can't be any side effect ;-)
Please reopen if you can submit a ready to test WAR (with source for the
servlet, so that it can be debugged if needed). Thanks.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44574</commentid>
    <comment_count>3</comment_count>
    <who name="">Dave</who>
    <bug_when>2003-09-24 09:53:37 +0000</bug_when>
    <thetext>Sorry Remy. It was late last night. This happens when run with procrun 
(tomcat.exe) as a service. It runs in the same JVM. I haven't tested the patch 
but it should do the trick.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44581</commentid>
    <comment_count>4</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2003-09-24 11:25:46 +0000</bug_when>
    <thetext>Bookkeeping, the previous comment looked loike an inadvertnet reopen</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44582</commentid>
    <comment_count>5</comment_count>
    <who name="">Dave</who>
    <bug_when>2003-09-24 11:36:44 +0000</bug_when>
    <thetext>Ok. I'll try to be a bit more clear.
This is a bug. I did mean to re-open.
When running TC5 as a service with procrun (tomcat.exe) it calls stopServer 
within the same JVM that is currently awaiting resulting in the server object 
in Catalina being replaced with one that isn't started and therefore when stop 
is called it is called on the wrong object.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44604</commentid>
    <comment_count>6</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-09-24 17:46:09 +0000</bug_when>
    <thetext>Sorry, nothing of what you say is true. Please do not reopen the report, it is 
bogus. I wasted about 1 hour on this, but there fixes which are needed to the
shutdown routines (which could cause what you see, because the VM could die
before completing the shutdown procedure properly), so it's good in some ways :)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44608</commentid>
    <comment_count>7</comment_count>
    <who name="">Dave</who>
    <bug_when>2003-09-24 19:51:20 +0000</bug_when>
    <thetext>Remy,
I won't reopen it because you said not to, but I've debugged this. How can I 
prove it to you? Look at procrun_destroy_jvm in procrun.c. It calls jni_attach 
which:
    err = (*jvm)-&gt;AttachCurrentThread(jvm,
                                      (void **)&amp;env,
                                      NULL);
Stepping over line 423 in Catalina.java results in a callback to setServer and 
the Server object that stop gets called on is the same object.
Just the fact that I can hit a break point at main in Bootstrap.java when I 
try to stop the service proves it. Because I'm attached to the JVM that the 
service started.

I created the service with:
C:\Tomcat\Home\bin\tomcatw.exe //IS//TomcatDebugServer --DisplayName "Apache 
Tomcat Debug Server" --Description "Apache Tomcat 5.0.12 Server - 
http://jakarta.apache.org/tomcat/ - Debug Server"  --
Install "C:\Tomcat\Home\bin\tomcat.exe" --
ImagePath "C:\Tomcat\Home\bin\bootstrap.jar" --StartupClass 
org.apache.catalina.startup.Bootstrap;main;start --ShutdownClass 
org.apache.catalina.startup.Bootstrap;main;stop --Java 
C:\Tomcat\J2SDK\jre\bin\server\jvm.dll --JavaOptions -server#-Xdebug#-
Xrunjdwp:transport=dt_socket,suspend=n,server=y,address=53006#-Xms512m#-
Xmx512m#-Xrs#-Dsp.log.suffix="_server1"#-
Djava.endorsed.dirs="C:\Tomcat\Home\bin;C:\Tomcat\Home\common\endorsed"#-
Dcatalina.base="C:\Tomcat\BaseServer1"#-Dcatalina.home="C:\Tomcat\Home"#-
Djava.io.tmpdir="C:\Tomcat\BaseServer1\temp" --Startup manual --StdOutputFile 
C:\Tomcat\BaseServer1\logs\stdout.log --StdErrorFile C:\Tomcat\BaseServer1
\logs\stderr.log --Arguments "-config C:\Tomcat\BaseServer1\conf\server.xml"

My problem is not that the JVM stops too early, it's that our webapp has some 
daemon threads that are running. They don't get interupted because destroy 
never gets called, therefore the service never stops.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44634</commentid>
    <comment_count>8</comment_count>
    <who name="">william.barker</who>
    <bug_when>2003-09-25 03:12:20 +0000</bug_when>
    <thetext>Reopening to change status.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44635</commentid>
    <comment_count>9</comment_count>
    <who name="">william.barker</who>
    <bug_when>2003-09-25 03:13:54 +0000</bug_when>
    <thetext>Your analysis is correct.  That is exactly what is happening.  

This is fixed now in the CVS, and should appear in 5.0.13.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44656</commentid>
    <comment_count>10</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-09-25 11:05:54 +0000</bug_when>
    <thetext>I couldn't reproduce the issue during testing with TC 5.0.12, and I couldn't
find any issues affecting the shutdown code either.

The only one is that apparently JDK 1.4 logging doesn't log reliably when called
from a shutdown hook thread, for some reason. That made me think the proper
shutdown didn't occur, but this isn't the case.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44752</commentid>
    <comment_count>11</comment_count>
    <who name="">Dave</who>
    <bug_when>2003-09-26 18:16:40 +0000</bug_when>
    <thetext>Tested as Fixed in nightly build. Cheers.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>8322</attachid>
            <date>2003-09-23 22:08:00 +0000</date>
            <delta_ts>2003-09-23 22:08:16 +0000</delta_ts>
            <desc>There are several ways to fix this. IMO this is probably the tidiest!</desc>
            <filename>stop.diff</filename>
            <type>text/plain</type>
            <size>1393</size>
            <attacher>Dave</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>23463</bug_id>
          
          <creation_ts>2003-09-28 11:37:00 +0000</creation_ts>
          <short_desc>Deployer ValidationTask not work! Missing Classes...</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.0.12</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Peter Rossbach">pr</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>44792</commentid>
    <comment_count>0</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2003-09-28 11:37:02 +0000</bug_when>
    <thetext>I have used client deployer bundle. 
But compile fail with following message:
BUILD FAILED
java.lang.NoClassDefFoundError: org/apache/catalina/Manager
        at org.apache.catalina.ant.ValidatorTask.execute
(ValidatorTask.java:137)

        at org.apache.tools.ant.Task.perform(Task.java:341)
        at org.apache.tools.ant.Target.execute(Target.java:309)
        at org.apache.tools.ant.Target.performTasks(Target.java:336)
        at org.apache.tools.ant.Project.executeTarget(Project.java:1339)
        at org.apache.tools.ant.Project.executeTargets(Project.java:1255)
        at org.apache.tools.ant.Main.runBuild(Main.java:609)
        at org.apache.tools.ant.Main.start(Main.java:196)
        at org.apache.tools.ant.Main.main(Main.java:235)

Total time: 3 seconds

OK: ContextConfig use more classes as at deployer lib exists. 
I add server/lib/catalina.jar and catalina-cluster.jar

but after this following error ocurred:


[validator] 28.09.2003 13:32:46 org.apache.commons.digester.Digester error
[validator] SCHWERWIEGEND: Parse Error at line 4 column 10: cvc-elt.1: Cannot 
fi
nd the declaration of element 'web-app'.
[validator] org.xml.sax.SAXParseException: cvc-elt.1: Cannot find the 
declaratio
n of element 'web-app'.
[validator]     at 
org.apache.xerces.util.ErrorHandlerWrapper.createSAXParseExce
ption(Unknown Source)
[validator]     at org.apache.xerces.util.ErrorHandlerWrapper.error(Unknown 
Sour
ce)
[validator]     at org.apache.xerces.impl.XMLErrorReporter.reportError(Unknown 
S
ource)
....

but the jsp translation is successful!

Peter</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44793</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-09-28 12:26:42 +0000</bug_when>
    <thetext>For some unexplainable reason, the JDK tries to load this class, which is wrong
(it is not used in any way; commenting out the contents of the
ContextConfig.managerConfig method - which is neither called nor static - fixes
it, which proves my point).

As for the second part of the bug, well, sorry, validation doesn't actually work
with Xerces in the release (at least it doesn't for me; try Xerces 2.1 if you
want to validate with a DTD, but schema validation won't work). This is
supposedly fixed now.</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>23525</bug_id>
          
          <creation_ts>2003-09-30 16:08:00 +0000</creation_ts>
          <short_desc>HttpSessionListener implementors are called to late according to Servlet Specification 2.4 Final Draft 3</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlet &amp; JSP API</component>
          <version>5.0.12</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Thorsten Möller">ThorstenMoeller</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>44891</commentid>
    <comment_count>0</comment_count>
    <who name="Thorsten Möller">ThorstenMoeller</who>
    <bug_when>2003-09-30 16:08:34 +0000</bug_when>
    <thetext>The Servlet Specification 2.4 Final Draft 3 says on chapter SRV.15.1.14.1 
(page 284 in PDF document) when the method "sessionDestroyed" of an 
implementor of HttpSessionListener should be invoked:

public void sessionDestroyed(HttpSessionEvent se)
--&gt; Notification that a session is about to be invalidated. &lt;--
                                ^^^^^^^^^^^^^^^^^^^^^^^^^^

This is new and completely different comparing to the Servlet 2.3 specification
(!) and means to me that the container first invokes 
HttpSessionListener.sessionDestroyed() and after that invalidate (destroy) the 
session.
At the moment Tomcat 5 behaves like the Servlet 2.3 specification, which means 
that the container invalidates the session and after that invoke 
HttpSessionListener.sessionDestroyed().

I think Tomcat's behaviour must be changed according to the 2.4 specification!

Btw: I found this because I implemented an HttpSessionListener which needs to 
access the session to get an attribute stored in the session. At the moment I 
get an IllegalState exception because the container already invalidated the 
session (Tomcat 5.0.12).

See also: http://nagoya.apache.org/eyebrowse/BrowseList?
listId=88&amp;by=thread&amp;from=503705


Regards,
Thorsten</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44959</commentid>
    <comment_count>1</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2003-10-01 16:39:03 +0000</bug_when>
    <thetext>This is a regression. I've already implemented the behaviour (see
StandardSession v.1.6) but it seems something has changed.

-- Jeanfrancois</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44978</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-10-02 05:13:10 +0000</bug_when>
    <thetext>StandardSession 1.20 seems to have caused this. isValid() is used everywhere
now, and it returns false when the session is expiring (which seems wrong).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44993</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-10-02 10:26:54 +0000</bug_when>
    <thetext>I'm considering this patch (which I don't have time to test). Jean-Francois, can
you test if it actually works ?

RCS file:
/home/cvs/jakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/session/StandardSession.java,v
retrieving revision 1.22
diff -r1.22 StandardSession.java
578c578
&lt;         if (!this.isValid || this.expiring) {
---
&gt;         if (!this.isValid) {
579a580,582
&gt;         }
&gt;         if (this.expiring) {
&gt;             return true;
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>45014</commentid>
    <comment_count>4</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2003-10-02 14:14:10 +0000</bug_when>
    <thetext>Yes, will do it right now.

-- Jeanfrancois</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>45025</commentid>
    <comment_count>5</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2003-10-02 17:15:06 +0000</bug_when>
    <thetext>Applied &amp; modified Remy's patche. Now it works as expected.

Thanks,

-- Jeanfrancois</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>23547</bug_id>
          
          <creation_ts>2003-10-01 15:39:00 +0000</creation_ts>
          <short_desc>documentation for the JAASRealm to go on the end of the Realms docs</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Documentation</component>
          <version>5.0.0</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Adam Hardy">adam.hardy</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>44954</commentid>
    <comment_count>0</comment_count>
    <who name="Adam Hardy">adam.hardy</who>
    <bug_when>2003-10-01 15:39:13 +0000</bug_when>
    <thetext> </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44955</commentid>
    <comment_count>1</comment_count>
      <attachid>8421</attachid>
    <who name="Adam Hardy">adam.hardy</who>
    <bug_when>2003-10-01 15:42:14 +0000</bug_when>
    <thetext>Created attachment 8421
I'm not on the tomcat-dev list but I am on the tomcat users if u have suggestions to improve this.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>44958</commentid>
    <comment_count>2</comment_count>
    <who name="Adam Hardy">adam.hardy</who>
    <bug_when>2003-10-01 16:35:35 +0000</bug_when>
    <thetext>In org.apache.catalina.realm.JAASRealm, it would make debugging an immense
amount easier if the log.debug calls on lines 315, 317, 350 and 353, i.e.
wherever the catch is a throwable or bad exception, were changed to error() calls. 

Just took me a couple of hours of debugging to work out that my LoginModule was
not being found. Under debug level logging, the actual exception message gets
lost in literally 500 lines of other debug stuff.

Thanks
Adam</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>45126</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-10-06 09:46:46 +0000</bug_when>
    <thetext>Thanks. It helps if the docs submission is in XML, though.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>8421</attachid>
            <date>2003-10-01 15:42:00 +0000</date>
            <delta_ts>2003-10-01 15:42:14 +0000</delta_ts>
            <desc>I'm not on the tomcat-dev list but I am on the tomcat users if u have suggestions to improve this.</desc>
            <filename>JAASRealm.html</filename>
            <type>text/html</type>
            <size>10053</size>
            <attacher name="Adam Hardy">adam.hardy</attacher>
            

          </attachment>
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>23610</bug_id>
          
          <creation_ts>2003-10-05 11:42:00 +0000</creation_ts>
          <short_desc>unknown SSI directives</short_desc>
          <delta_ts>2007-06-16 07:21:26 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlets:SSI</component>
          <version>5.0.12</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Thorsten Möller">ThorstenMoeller</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>carlows</cc>
    
    <cc>pspeed</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>45083</commentid>
    <comment_count>0</comment_count>
    <who name="Thorsten Möller">ThorstenMoeller</who>
    <bug_when>2003-10-05 11:42:29 +0000</bug_when>
    <thetext>It seems that the following SSI directives are not implemented yet:

&lt;!--#if expr="..."--&gt;
&lt;!--#else  --&gt;
&lt;!--#endif --&gt;

When using these directives in an .shtml file I get messages:

12:20:44,038 INFO  [Engine] ssi: Unknown command: if
12:20:44,038 INFO  [Engine] ssi: Unknown command: else
12:20:44,038 INFO  [Engine] ssi: Unknown command: endif

Regards,
Thorsten</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51503</commentid>
    <comment_count>1</comment_count>
    <who name="Carlows">carlows</who>
    <bug_when>2004-01-30 20:15:10 +0000</bug_when>
    <thetext>Yes, that's true... I'll provide a few patches soon. Is anybody already 
working on it? </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51505</commentid>
    <comment_count>2</comment_count>
    <who name="Paul Speed">pspeed</who>
    <bug_when>2004-01-30 21:28:55 +0000</bug_when>
    <thetext>I implemented them at one point and then they were blown away by someone that 
hadn't noticed they were using an older version.  Supposedly my code was later 
folded in but I guess that didn't really happen.

You make check back through the older version and find it.  It was back when the 
SSI stuff used to be in a different package.  I can track the code down if 
needed.

Actually, I had implemented and verified every SSI directive in apache 
mod_include except the perl directive.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51506</commentid>
    <comment_count>3</comment_count>
    <who name="Carlows">carlows</who>
    <bug_when>2004-01-30 21:50:37 +0000</bug_when>
    <thetext>Nice. So it's just a matter of getting that code back to the repository ;) </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53157</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-27 18:43:27 +0000</bug_when>
    <thetext>Some patches were indeed not ported to the Tomcat 5 branch, and would now need
to be merged (which I'm not going to do so a volunteer is needed).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58490</commentid>
    <comment_count>5</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-06-01 19:05:33 +0000</bug_when>
    <thetext>Point out the patches to me, I'll take a look.  The best thing would be to 
attach the patches (as .diff files) to this Bugzilla item, the diffs being 
against the current HEAD rather than an older version.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59245</commentid>
    <comment_count>6</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-06-15 18:06:27 +0000</bug_when>
    <thetext>Two weeks, no action, I'm closing this item for the tomcat 5.0.27 release and 
TOMCAT_5_0 branching, under the assumption no one cares enough about it.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>104458</commentid>
    <comment_count>7</comment_count>
    <who name="ajTreece">aj.treece</who>
    <bug_when>2007-06-16 06:59:24 +0000</bug_when>
    <thetext>The Tomcat and Apache documentation states that these directives are
available.... It is my opinion that this should be fixed -or- the documentation
amended. </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>104459</commentid>
    <comment_count>8</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2007-06-16 07:21:26 +0000</bug_when>
    <thetext>The files were ported to 5.0.x back in September 2004. You need to use 5.0.29
onwards or 5.5.1 onwards.</thetext>
  </long_desc>
      
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>23691</bug_id>
          
          <creation_ts>2003-10-09 05:43:00 +0000</creation_ts>
          <short_desc>Incorrect custom tag SMAPping</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.13</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Eric Carmichael">ecarmich</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>45268</commentid>
    <comment_count>0</comment_count>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-10-09 05:43:01 +0000</bug_when>
    <thetext>The java servlet Jasper generates from jsp-examples/cal/cal1.jsp has 137 
lines.  But the SMAP includes the LineInfo "19:167,6", which SMAPs line 19 of 
the JSP to lines that don't exist in the generated servlet.

Taking out the "doVisit(n);" line in Generator.java's 
GenBuffer.adjustJavaLines function seems to fix this, but I'm not going to 
commit that change, as I don't understand the surrounding code fully.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>45314</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-10-09 18:57:55 +0000</bug_when>
    <thetext>Hmm... cal1.jsp does not contain any custom tags and I didn't see the "19:167,6"
part.  Maybe you meant simpletag/foo.jsp?  But I didn't see anything obviously
wrong about its smap either.  Puzzled.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>45328</commentid>
    <comment_count>2</comment_count>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-10-10 01:11:30 +0000</bug_when>
    <thetext>Oops.  I meant jsp-examples/jsp2/simpletag/repeat.jsp.  Sorry for the 
confusion.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>45955</commentid>
    <comment_count>3</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-10-20 21:13:10 +0000</bug_when>
    <thetext>This is now fixed.  Boy, the SMAP tracking code can get complicated, especially
if you mix fragments with classic custom tags!</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>23751</bug_id>
          
          <creation_ts>2003-10-12 15:21:00 +0000</creation_ts>
          <short_desc>Error with Saving Configuration</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Administration</component>
          <version>5.0.13</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Hirotaka HONMA">manhole</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>lkarpel</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>45435</commentid>
    <comment_count>0</comment_count>
    <who name="Hirotaka HONMA">manhole</who>
    <bug_when>2003-10-12 15:21:51 +0000</bug_when>
    <thetext>When I "Commit Changes" button clicked, HTTP 500 Error occured
and my configurations aren't saved.

Caused by: java.io.FileNotFoundException:
..\..\conf\Catalina\localhost\jsp-examples.xml (The system cannot find the path
specified)
	at java.io.FileOutputStream.open(Native Method)
	at java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:179)
	at java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:131)
	at java.io.FileWriter.&lt;init&gt;(FileWriter.java:73)
	at org.apache.catalina.core.StandardServer.storeContext(StandardServer.java:1205)
	at org.apache.catalina.core.StandardServer.storeHost(StandardServer.java:1669)
	at org.apache.catalina.core.StandardServer.storeEngine(StandardServer.java:1551)
	at org.apache.catalina.core.StandardServer.storeService(StandardServer.java:2151)
	at org.apache.catalina.core.StandardServer.storeServer(StandardServer.java:2107)
	at org.apache.catalina.core.StandardServer.storeConfig(StandardServer.java:798)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:324)
	at org.apache.commons.modeler.BaseModelMBean.invoke(BaseModelMBean.java:503)
	... 41 more

following is a patch to fix this issue.

Index: StandardServer.java
===================================================================
RCS file:
/home/cvspublic/jakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/core/StandardServer.java,v
retrieving revision 1.22
diff -u -r1.22 StandardServer.java
--- StandardServer.java	2 Sep 2003 21:22:04 -0000	1.22
+++ StandardServer.java	12 Oct 2003 10:51:30 -0000
@@ -855,10 +855,6 @@
 
         if (configFile != null) {
             File config = new File(configFile);
-            if (!config.isAbsolute()) {
-                config = new File(System.getProperty("catalina.base"),
-                                        configFile);
-            }
 
             // Open an output writer for the new configuration file
             PrintWriter writer = null;
@@ -1194,10 +1190,6 @@
         if (configFile != null) {
 
             File config = new File(configFile);
-            if (!config.isAbsolute()) {
-                config = new File(System.getProperty("catalina.base"),
-                                        configFile);
-            }
 
             // Open an output writer for the new configuration file
             writer = null;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>45508</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-10-13 13:39:48 +0000</bug_when>
    <thetext>I thought about it, and I think you can only get that if catalina.base is
something like "..". I'll have to double check, but it would seem best to fix
setting the two system properties in Bootstrap (and always replace it with a
canonical path).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>45539</commentid>
    <comment_count>2</comment_count>
    <who name="Hirotaka HONMA">manhole</who>
    <bug_when>2003-10-13 16:29:38 +0000</bug_when>
    <thetext>Thank you for a reply.
I found, when I execute startup.bat direct (ex. double-click), catalina.base
will be "..".
Because of it, FileNotFoundException occured.

And The following patched are also solvable.
Please confirm, if it is not trouble.

Index: startup.bat
===================================================================
RCS file: /home/cvspublic/jakarta-tomcat-catalina/catalina/src/bin/startup.bat,v
retrieving revision 1.4
diff -u -r1.4 startup.bat
--- startup.bat	4 Aug 2002 18:19:43 -0000	1.4
+++ startup.bat	13 Oct 2003 15:10:14 -0000
@@ -10,7 +10,7 @@
 if not "%CATALINA_HOME%" == "" goto gotHome
 set CATALINA_HOME=.
 if exist "%CATALINA_HOME%\bin\catalina.bat" goto okHome
-set CATALINA_HOME=..
+cd ..
 :gotHome
 if exist "%CATALINA_HOME%\bin\catalina.bat" goto okHome
 echo The CATALINA_HOME environment variable is not defined correctly

Index: catalina.bat
===================================================================
RCS file: /home/cvspublic/jakarta-tomcat-catalina/catalina/src/bin/catalina.bat,v
retrieving revision 1.5
diff -u -r1.5 catalina.bat
--- catalina.bat	2 Oct 2003 17:07:40 -0000	1.5
+++ catalina.bat	13 Oct 2003 16:22:52 -0000
@@ -42,7 +42,7 @@
 if not "%CATALINA_HOME%" == "" goto gotHome
 set CATALINA_HOME=.
 if exist "%CATALINA_HOME%\bin\catalina.bat" goto okHome
-set CATALINA_HOME=..
+cd ..
 :gotHome
 if exist "%CATALINA_HOME%\bin\catalina.bat" goto okHome
 echo The CATALINA_HOME environment variable is not defined correctly</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>45682</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-10-14 21:31:44 +0000</bug_when>
    <thetext>*** Bug 23818 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>45684</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-10-14 21:40:21 +0000</bug_when>
    <thetext>I have fixed the issue.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>23764</bug_id>
          
          <creation_ts>2003-10-13 10:00:00 +0000</creation_ts>
          <short_desc>logout in SSO from sessions in 2 or more webapps not working</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.0.12</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Adam Hardy">adam.hardy</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>45483</commentid>
    <comment_count>0</comment_count>
    <who name="Adam Hardy">adam.hardy</who>
    <bug_when>2003-10-13 10:00:54 +0000</bug_when>
    <thetext>If I have SSO enabled, and I log on to my webapp, and also visit a second webapp
on my localhost, I can't logout anymore.

If I go to the page which has the following JSP:

remote user &lt;%=request.getRemoteUser() %&gt; in
session &lt;%= session.getId() %&gt;
&lt;%
session.invalidate();
%&gt;

and refresh over and over always showed the following:

remote user adam in session EB2543D909D52551EA58C77E963CDD17
remote user adam in session EA33F35CCB3D1205A88226029C65939C
remote user adam in session 8814C0365D3F0BDD97B1DE9B7EAECD17
remote user adam in session 1B7F0424190985F24A294EA2344888C5

The only way to logout is to close my browser or delete the JSESSIONIDSSO cookie
in mozilla. 

But logout does work for just one app - if I only visit &amp; login to one webapp,
when I invalidate the session, I immediately get a login request.

NB: The logout functions correctly when all my sessions expire. 

NB2: When some but not all of my sessions in one SSO time out, I can re-access
the timed-out webapps without seeing a login request. 

Hope that describes it clearly,

Adam</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>45489</commentid>
    <comment_count>1</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2003-10-13 11:08:14 +0000</bug_when>
    <thetext>There is a difference in SingleSignOn.java between 4.1 and 5.0. But the diff
doesn't make sense to me: what follows is the diff from 4.1 to 5 for what I
*guess* is the cause:
-        // Deregister this single session id, invalidating associated sessions
-        deregister(ssoId);
+        if ( event.getData() != null 
+             &amp;&amp; "logout".equals( event.getData().toString() )) {
+            // logout of all applications
+            deregister(ssoId);
+        } else {
+            // invalidate just one session
+            deregister(ssoId, session);
+        }

Doing a grep for "logout" - I could not find one  - so I have no idea when the
true part of the conditional gets executed. Any ideas?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>45501</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-10-13 13:29:47 +0000</bug_when>
    <thetext>This could have been added for more control, so I would leave the feature in and
try to understand why. This is from a Patrick and Bob patch, so I don't think we
can get an explanation as to why it is the right thing to do from them.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>45517</commentid>
    <comment_count>3</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2003-10-13 13:59:23 +0000</bug_when>
    <thetext>Logout has been removed from the Servlet spec (I did remove the method) and
probably forgot (wasn't aware of such behavour) that part. I will also take to look.

-- Jeanfrancois</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>47393</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-11-15 09:43:05 +0000</bug_when>
    <thetext>In the absence of a better solution, I've reverted the change to SSO.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>23767</bug_id>
          
          <creation_ts>2003-10-13 11:12:00 +0000</creation_ts>
          <short_desc>initial location of manager.xml context file not documented</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Documentation</component>
          <version>5.0.12</version>
          <rep_platform>All</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Adam Hardy">adam.hardy</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>45490</commentid>
    <comment_count>0</comment_count>
    <who name="Adam Hardy">adam.hardy</who>
    <bug_when>2003-10-13 11:12:52 +0000</bug_when>
    <thetext>On line 91 in src/jakarta-tomcat-catalina/webapps/docs/manager-howto.xml it
should say something about finding the initial effective manager.xml context
config file in $CATALINA_HOME/conf/Catalina/localhost/ 

This manager.xml is installed by the initial tomcat-5.0.12 installation, at
least in the linux tarball, and it overrides any manager.xml which I put in
appBase, at least for localhost.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>45492</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-10-13 12:20:30 +0000</bug_when>
    <thetext>The documentation is accurate. Where did you find you could put XML files in the
host appBase exactly ?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>45496</commentid>
    <comment_count>2</comment_count>
    <who name="Adam Hardy">adam.hardy</who>
    <bug_when>2003-10-13 13:12:04 +0000</bug_when>
    <thetext>In my first paragraph in the bug description, I stated exactly where I found the
instruction on where to place the manager app's context configuration xml file.
This is the line (from tomcat 5.0.12):

"Install the manager.xml context configuration file in the appBase for your Host."

Your question "where did I find ....?" therefore indicates that we are either
talking about different documentation or interpreting the documentation
completely differently. 

I am not entering bugs in bugzilla for fun or as a means of getting support. I
have already raised this issue on the tomcat-user list:

http://www.mail-archive.com/tomcat-user@jakarta.apache.org/msg106090.html

and was therefore fairly certain that this is an issue. Please would you provide
some more indication as to why this is not an issue, or otherwise re-open this. 

Further explanation will ultimately be of benefit to you as well, since others
facing the same situation as myself may well then read it here and learn from
it, rather than opening another bug or generating more traffic on the lists.

Thanks
Adam</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>45497</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-10-13 13:24:28 +0000</bug_when>
    <thetext>Your sentence was too convoluted for me, so I misunderstood it.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>45498</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-10-13 13:25:04 +0000</bug_when>
    <thetext>Fixed. Thanks for the patch.</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>23881</bug_id>
          
          <creation_ts>2003-10-17 06:25:00 +0000</creation_ts>
          <short_desc>SingleSignOn and FormAuthenticator in embedded tomcat</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.14</version>
          <rep_platform>All</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="viorel mitache">viorel</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>kar_yeow</cc>
          <votes>1</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>45813</commentid>
    <comment_count>0</comment_count>
    <who name="viorel mitache">viorel</who>
    <bug_when>2003-10-17 06:25:54 +0000</bug_when>
    <thetext>SingleSignOn valve and FormAuthenticator fail to authenticate correctly when 
Tomcat works as embedded engine using a jaas realm (jboss). SingleSignOn code 
wrongly sets the principal inside request based on his cookie and 
FormAuthenticator just thinks everything is ok. In fact FormAuthenticator has 
to call authenticate again using the 'username' and 'password' stored inside 
the entry for that ssoId (value of the cookie). One way to fix it is to set 
only the request REQ_SSOID_NOTE (not the principal too) inside SingleSignOn 
valve. FormAuthenticator has to make a SingleSignOn lookup, retrieve the 
username and password and call authenticate. This should happen after checking 
(unsuccessfully) the credentials stored inside the session. This kind of fix 
made it working for me , although the code is still somewhat not optimal - 
(associate is called way to often, and the same for register , which will reset 
the cookie)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>45821</commentid>
    <comment_count>1</comment_count>
    <who name="viorel mitache">viorel</who>
    <bug_when>2003-10-17 09:08:35 +0000</bug_when>
    <thetext>also the register method in AuthenticatorBase creates a new cookie for 
SingleSignOn - i guess should check against an already existing cookie (using 
lookup) - and just call method associate in case this one exists. this solves a 
potential memory leak and the logout issue (register is called after every 
successful authenticate with the container realm). </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>47940</commentid>
    <comment_count>2</comment_count>
      <attachid>9247</attachid>
    <who name="Brian Stansberry">bstansberry</who>
    <bug_when>2003-11-23 00:01:06 +0000</bug_when>
    <thetext>Created attachment 9247
Patch w/ diff and one new class</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>47941</commentid>
    <comment_count>3</comment_count>
    <who name="Brian Stansberry">bstansberry</who>
    <bug_when>2003-11-23 00:18:29 +0000</bug_when>
    <thetext>Attached is a proposed patch.  It adds a configurable 
attribute "requiresReauthentication" to SingleSignOn.  If "false" (the 
default), applications will behave as they do now.  If "true", each incoming 
request will need to be reauthenticated to the Realm.  The various 
authenticators have been modified to handle this.  In this case the 
SingleSignOnEntry serves as a store of authentication credentials.

If the 1st webapp a user visits uses FORM or BASIC auth, and then they visit 
another app that requires DIGEST, the cached username/password from the 
FORM/BASIC authentication will not be sufficient information to do a digest 
authentication, so the user will be prompted for a digest login.  Possibly we 
could add a config option to allow a username/password authentication to 
override the DIGEST auth specified in the web.xml.

Similarly, if the user first visits a webapp with DIGEST auth, and then visits 
one that uses FORM or BASIC, again the cached credentials will not be 
sufficient (no cached password from the digest auth), so they will have to be 
prompted for their username/password.

The attached patch includes logic that deals with all this and ensures that a 
single SSO session is maintained throughout.

Of course, if webapps in a deployment don't mix their authentication schemes, 
none of the above details are an issue.

This bug was raised against TC 4; sorry the patch is against TC 5.  I can very 
easily pull together a TC4.1 version if desired.

This patch also addresses bug 10040.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>47961</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-11-23 17:45:49 +0000</bug_when>
    <thetext>I think I'm going to apply this patch. Esp since it has been tested in JB land
first (otherwise, I wouldn't want to commit it so close to a release).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48023</commentid>
    <comment_count>5</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-11-24 16:53:11 +0000</bug_when>
    <thetext>I have applied your patch, thanks.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48134</commentid>
    <comment_count>6</comment_count>
      <attachid>9288</attachid>
    <who name="Brian Stansberry">bstansberry</who>
    <bug_when>2003-11-26 04:53:11 +0000</bug_when>
    <thetext>Created attachment 9288
Port of the TC5 patch to TC 4.1; includes related fix to 9077 and 10040</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48640</commentid>
    <comment_count>7</comment_count>
    <who name="Mark Thomas">medthomas</who>
    <bug_when>2003-12-07 19:27:50 +0000</bug_when>
    <thetext>*** Bug 4350 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49659</commentid>
    <comment_count>8</comment_count>
      <attachid>9694</attachid>
    <who name="Brian Stansberry">bstansberry</who>
    <bug_when>2003-12-24 06:44:21 +0000</bug_when>
    <thetext>Created attachment 9694
Previous patch to 4.1 updated to avoid conflict with patch applied today by Mark Thomas</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49660</commentid>
    <comment_count>9</comment_count>
    <who name="Brian Stansberry">bstansberry</who>
    <bug_when>2003-12-24 06:48:03 +0000</bug_when>
    <thetext>Patch attached a moment ago is a zip file which includes a diff plus a new 
class.  The new class is just the existing SingleSignOnEntry inner class 
extracted out of SingleSignOn.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49680</commentid>
    <comment_count>10</comment_count>
    <who name="Mark Thomas">medthomas</who>
    <bug_when>2003-12-24 20:42:42 +0000</bug_when>
    <thetext>I have applied you patch to TC4.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>9247</attachid>
            <date>2003-11-23 00:01:00 +0000</date>
            <delta_ts>2003-11-23 00:01:06 +0000</delta_ts>
            <desc>Patch w/ diff and one new class</desc>
            <filename>patch.zip</filename>
            <type>application/zip</type>
            <size>9570</size>
            <attacher name="Brian Stansberry">bstansberry</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>9288</attachid>
            <date>2003-11-26 04:53:00 +0000</date>
            <delta_ts>2003-11-26 04:53:11 +0000</delta_ts>
            <desc>Port of the TC5 patch to TC 4.1; includes related fix to 9077 and 10040</desc>
            <filename>patch.zip</filename>
            <type>application/zip</type>
            <size>9885</size>
            <attacher name="Brian Stansberry">bstansberry</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>9694</attachid>
            <date>2003-12-24 06:44:00 +0000</date>
            <delta_ts>2003-12-24 06:44:21 +0000</delta_ts>
            <desc>Previous patch to 4.1 updated to avoid conflict with patch applied today by Mark Thomas</desc>
            <filename>patch.zip</filename>
            <type>application/zip</type>
            <size>10478</size>
            <attacher name="Brian Stansberry">bstansberry</attacher>
            

          </attachment>
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>23953</bug_id>
          
          <creation_ts>2003-10-20 18:57:00 +0000</creation_ts>
          <short_desc>JAVA_HOME defined incorrectly breaks startup.bat</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.12</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jacek Laskowski">jacek.laskowski</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>45945</commentid>
    <comment_count>0</comment_count>
    <who name="Jacek Laskowski">jacek.laskowski</who>
    <bug_when>2003-10-20 18:57:51 +0000</bug_when>
    <thetext>When JAVA_HOME is defined incorrectly startup.bat doesn't start up Catalina 
even though setclasspath.bat (invoked from within the batch) warns about the 
wrong variable and ends. That's where the problem is. The setclasspath.bat ends 
nor exits. The last line of setclasspath.bat should look like the following:

   :end
   exit

With the change, when JAVA_HOME is wrong, the startup.bat returns quietly (it 
really should print out a message about it).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>45946</commentid>
    <comment_count>1</comment_count>
    <who name="Jacek Laskowski">jacek.laskowski</who>
    <bug_when>2003-10-20 19:05:33 +0000</bug_when>
    <thetext>Unfortunatelly, I make a mistake :-(

The script - setclasspath.bat - should have every 'goto end' changed to 'goto 
exit', and the last entries of setclasspath.bat should look as follows:

:exit
exit

:end</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>46213</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-10-24 08:00:47 +0000</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61106</commentid>
    <comment_count>3</comment_count>
    <who name="Geoffrey Robichaux">geoffrey</who>
    <bug_when>2004-07-25 18:48:29 +0000</bug_when>
    <thetext>This is still a bug, please fix...</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61247</commentid>
    <comment_count>4</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-07-28 15:44:15 +0000</bug_when>
    <thetext>It looks fixed and works for me, so either submit a test case that shows it 
broken in Tomcat 5.0.27 or leave this bug closed.  Thanks.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>24085</bug_id>
          
          <creation_ts>2003-10-24 05:42:00 +0000</creation_ts>
          <short_desc>[Administration] The group and role list disappear! When "Create New User", "save" directly without filling in form.</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Administration</component>
          <version>5.0.12</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="WebC Team">webc</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>46201</commentid>
    <comment_count>0</comment_count>
    <who name="WebC Team">webc</who>
    <bug_when>2003-10-24 05:42:59 +0000</bug_when>
    <thetext>Hi, 
   In the "Create New User" page, click the "save" button directly without 
filling the form. Then there will be a validate error, return to this page 
agian. But the "Group" and "Role" list disappear! Why?
   This error also exists in the "Edit a Exited User" and "Create New Group".

Good Luck!

tigerlet.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53760</commentid>
    <comment_count>1</comment_count>
    <who name="Amy Roh">amyroh</who>
    <bug_when>2004-03-09 21:50:14 +0000</bug_when>
    <thetext>Fixed in TC 5 &amp; 4.  Thanks for the report.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>24186</bug_id>
          
          <creation_ts>2003-10-28 17:45:00 +0000</creation_ts>
          <short_desc>Jasper SystemLogHandler memory leak</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.14</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Matthias Ernst">ernst.matthias</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>46378</commentid>
    <comment_count>0</comment_count>
    <who name="Matthias Ernst">ernst.matthias</who>
    <bug_when>2003-10-28 17:45:35 +0000</bug_when>
    <thetext>In an embedded setting it may be desirable to load and unload Jasper in an own
classloader. This is impossible with Jasper right now without a memory leak.
o.a.j.c.Compiler sets System.err to an instance of o.a.j.u.SystemLogHandler in
its static initializer and never reset it. A new instance of Jasper will pick up
this instance as its 'wrapped' PrintStream and so on ...

This way, System.err retains a reference chain to each incarnation of
SystemLogHandler and the whole classloader cannot be unloaded. 

I propose to move the redirection to the JspRuntimeContext constructor and to
undo it in JspRuntimeContext#destroy. With that change, Jasper can be unloaded
without memory leak. Actually, since Jasper uses Ant for compilation which seems
to support System.{out,err} redirect, it is not clear to me why the
SystemLogHandler is in there (legacy?).

Workaround: manually reset System.err on unload.

patch against current CVS:

===================================================================
RCS file:
/home/cvspublic/jakarta-tomcat-jasper/jasper2/src/share/org/apache/jasper/compiler/Compiler.java,v
retrieving revision 1.71
diff -u -r1.71 Compiler.java
--- compiler/Compiler.java      1 Oct 2003 22:44:02 -0000       1.71
+++ compiler/Compiler.java      28 Oct 2003 17:38:06 -0000
@@ -98,12 +98,6 @@
     // ----------------------------------------------------------------- Static
 
 
-    static {
-
-        System.setErr(new SystemLogHandler(System.err));
-
-    }
-
     // Some javac are not thread safe; use a lock to serialize compilation, 
     static Object javacLock = new Object();

===================================================================
RCS file:
/home/cvspublic/jakarta-tomcat-jasper/jasper2/src/share/org/apache/jasper/compiler/JspRuntimeContext.java,v
retrieving revision 1.16
diff -u -r1.16 JspRuntimeContext.java
--- compiler/JspRuntimeContext.java     2 Sep 2003 21:39:58 -0000       1.16
+++ compiler/JspRuntimeContext.java     28 Oct 2003 17:38:06 -0000
@@ -82,6 +82,7 @@
 import org.apache.jasper.Constants;
 import org.apache.jasper.JspCompilationContext;
 import org.apache.jasper.Options;
+import org.apache.jasper.util.SystemLogHandler;
 import org.apache.jasper.runtime.JspFactoryImpl;
 import org.apache.jasper.security.SecurityClassLoad;
 import org.apache.jasper.servlet.JspServletWrapper;
@@ -125,6 +126,8 @@
      */
     public JspRuntimeContext(ServletContext context, Options options) {
 
+        System.setErr(new SystemLogHandler(System.err));
+
         this.context = context;
         this.options = options;
 
@@ -271,7 +274,10 @@
     /**
      * Process a "destory" event for this web application context.
      */                                                        
-    public void destroy() {                                    
+    public void destroy() {
+
+        if(System.err instanceof SystemLogHandler)
+            System.setErr(((SystemLogHandler)System.err).getWrapped());
 
         threadStop();


===================================================================
RCS file:
/home/cvspublic/jakarta-tomcat-jasper/jasper2/src/share/org/apache/jasper/util/SystemLogHandler.java,v
retrieving revision 1.2
diff -u -r1.2 SystemLogHandler.java
--- util/SystemLogHandler.java  2 Sep 2003 21:40:00 -0000       1.2
+++ util/SystemLogHandler.java  28 Oct 2003 17:38:06 -0000
@@ -79,7 +79,7 @@
      */
     public SystemLogHandler(PrintStream wrapped) {
         super(wrapped);
-        out = wrapped;
+        this.wrapped = wrapped;
     }
 
 
@@ -89,7 +89,7 @@
     /**
      * Wrapped PrintStream.
      */
-    protected PrintStream out = null;
+    protected PrintStream wrapped = null;
 
 
     /**
@@ -107,6 +107,10 @@
     // --------------------------------------------------------- Public Methods
 
 
+    public PrintStream getWrapped() {
+      return wrapped;
+    }
+
     /**
      * Start capturing thread's output.
      */
@@ -142,7 +146,7 @@
     protected PrintStream findStream() {
         PrintStream ps = (PrintStream) streams.get(Thread.currentThread());
         if (ps == null) {
-            ps = out;
+            ps = wrapped;
         }
         return ps;
     }</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>46380</commentid>
    <comment_count>1</comment_count>
      <attachid>8777</attachid>
    <who name="Matthias Ernst">ernst.matthias</who>
    <bug_when>2003-10-28 17:49:02 +0000</bug_when>
    <thetext>Created attachment 8777
patch as attachment</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>46389</commentid>
    <comment_count>2</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-10-28 19:23:30 +0000</bug_when>
    <thetext>Thanks for the patch.  Applied.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>8777</attachid>
            <date>2003-10-28 17:49:00 +0000</date>
            <delta_ts>2003-10-28 17:49:02 +0000</delta_ts>
            <desc>patch as attachment</desc>
            <filename>patch</filename>
            <type>text/plain</type>
            <size>3242</size>
            <attacher name="Matthias Ernst">ernst.matthias</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>24270</bug_id>
          
          <creation_ts>2003-10-30 23:19:00 +0000</creation_ts>
          <short_desc>NoClassDefFoundError when running in security mode</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>Sun</rep_platform>
          <op_sys>Solaris</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Cheng Fang">cheng.fang</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>jeanfrancois.arcand</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>46552</commentid>
    <comment_count>0</comment_count>
    <who name="Cheng Fang">cheng.fang</who>
    <bug_when>2003-10-30 23:19:25 +0000</bug_when>
    <thetext>I ran standalone tomcat nightly (10/29/2003) build with -security option, and
default catlina.policy. When executing a jsp that uses reflection, internal
error occurred:  It happened on both Windows 200 pro and Solaris 9 Sparc, with
j2se 1.4.2_01/_02

javax.servlet.ServletException: java.lang.NoClassDefFoundError:
org/apache/tomcat/util/http/FastHttpDateFormat
	at com.sun.ts.tests.jsp.common.util.JspTestUtil.invokeTest(JspTestUtil.java:78)
	at org.apache.jsp.JspWriterTest_jsp._jspService(JspWriterTest_jsp.java:510)
	at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:133)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)
	at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:311)
	at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:301)
	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:248)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:324)
	at org.apache.catalina.security.SecurityUtil$1.run(SecurityUtil.java:284)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAsPrivileged(Subject.java:500)
	at org.apache.catalina.security.SecurityUtil.execute(SecurityUtil.java:306)
	at org.apache.catalina.security.SecurityUtil.doAsPrivilege(SecurityUtil.java:200)
	at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:278)
	at
org.apache.catalina.core.ApplicationFilterChain.access$000(ApplicationFilterChain.java:97)
	at
org.apache.catalina.core.ApplicationFilterChain$1.run(ApplicationFilterChain.java:187)
	at java.security.AccessController.doPrivileged(Native Method)
	at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:183)
	at
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:256)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:563)
	at
org.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:245)
	at
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:199)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:563)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:195)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:164)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:563)
	at
org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:156)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:563)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:209)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:781)
	at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:549)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:589)
	at
org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:666)
	at java.lang.Thread.run(Thread.java:534)

The offending lines are just simple use of reflection, and the page does not
directly reference any server internal classes:
74:        try {
75:            Method method = testObject.getClass().getMethod(test, TEST_ARGS);
76:            method.invoke(testObject, new Object[]{req, res, out});
77:        } catch (InvocationTargetException ite) {
78:            throw new ServletException(ite.getTargetException().toString());</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>46554</commentid>
    <comment_count>1</comment_count>
      <attachid>8840</attachid>
    <who name="Cheng Fang">cheng.fang</who>
    <bug_when>2003-10-30 23:34:24 +0000</bug_when>
    <thetext>Created attachment 8840
war file to reproduce</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>46555</commentid>
    <comment_count>2</comment_count>
    <who name="Cheng Fang">cheng.fang</who>
    <bug_when>2003-10-30 23:36:11 +0000</bug_when>
    <thetext>http://localhost:8080/jsp_jspwriter_web/JspWriterTest.jsp?testname=jspWriterClearIOExceptionTest
is the url that triggered the error with attached war.

The following is from catalina.out on Solaris:
Security Violation, attempt to use Restricted Class:
org.apache.jasper.compiler.Localizer
java.security.AccessControlException: access denied (java.lang.RuntimePermission
accessClassInPackage.org.apache.jasper.compiler)
        at
java.security.AccessControlContext.checkPermission(AccessControlContext.java:269)
        at java.security.AccessController.checkPermission(AccessController.java:401)
        at java.lang.SecurityManager.checkPermission(SecurityManager.java:524)
        at java.lang.SecurityManager.checkPackageAccess(SecurityManager.java:1491)
        at
org.apache.catalina.loader.StandardClassLoader.loadClass(StandardClassLoader.java:820)
        at
org.apache.catalina.loader.StandardClassLoader.loadClass(StandardClassLoader.java:756)
        at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:302)
        at org.apache.jasper.runtime.JspWriterImpl.clear(JspWriterImpl.java:178)
        at
org.apache.jsp.JspWriterTest_jsp.jspWriterClearIOExceptionTest(JspWriterTest_jsp.java:231)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at
com.sun.ts.tests.jsp.common.util.JspTestUtil.invokeTest(JspTestUtil.java:76)
        at org.apache.jsp.JspWriterTest_jsp._jspService(JspWriterTest_jsp.java:510)
        at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:133)
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)
        at
org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:311)
        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:301)
        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:248)
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at org.apache.catalina.security.SecurityUtil$1.run(SecurityUtil.java:284)
        at java.security.AccessController.doPrivileged(Native Method)
        at javax.security.auth.Subject.doAsPrivileged(Subject.java:500)
        at org.apache.catalina.security.SecurityUtil.execute(SecurityUtil.java:306)
        at
org.apache.catalina.security.SecurityUtil.doAsPrivilege(SecurityUtil.java:200)
        at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:278)
        at
org.apache.catalina.core.ApplicationFilterChain.access$000(ApplicationFilterChain.java:97)
        at
org.apache.catalina.core.ApplicationFilterChain$1.run(ApplicationFilterChain.java:187)
        at java.security.AccessController.doPrivileged(Native Method)
        at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:183)
        at
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:256)
        at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
        at
org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:563)
        at
org.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:245)
        at
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:199)
        at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
        at
org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:563)
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>46559</commentid>
    <comment_count>3</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2003-10-31 01:35:34 +0000</bug_when>
    <thetext>Fixed.

Thanks

-- Jeanfrancois</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>8840</attachid>
            <date>2003-10-30 23:34:00 +0000</date>
            <delta_ts>2003-10-30 23:34:24 +0000</delta_ts>
            <desc>war file to reproduce</desc>
            <filename>jsp_jspwriter_web.war</filename>
            <type>application/octet-stream</type>
            <size>7180</size>
            <attacher name="Cheng Fang">cheng.fang</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>24349</bug_id>
          
          <creation_ts>2003-11-03 10:35:00 +0000</creation_ts>
          <short_desc>NullPointerException</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina:Modules</component>
          <version>5.0.14</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ferenc Dobi">franc_ois78</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>iainmcgin</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>46658</commentid>
    <comment_count>0</comment_count>
    <who name="Ferenc Dobi">franc_ois78</who>
    <bug_when>2003-11-03 10:35:00 +0000</bug_when>
    <thetext>When deploying a web-app with bad URL, with the Tomcat Manager, NullPointerException
is thrown at org.apache.catalina.manager.HTMLManagerServlet.java:423 (method list)
(
The code is:
args[4] = new Integer(context.getManager().findSessions().length);
                                      ^ null for mistyped directory
)
After this no application can be deployed, because this exception is rethrown.
(Tomcat must be restarted)
I have made some test:
The manager for the context of the mistyped URL does not exist.
So I modified the enclosing if statement's condition
if (context != null &amp;&amp; context.getManager() != null) 
This version works, but does not report an error, at least I can try
again by correcting the web app location, without restarting tomcat.

I hope it is enough.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>46666</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-11-03 11:41:25 +0000</bug_when>
    <thetext>This seems to make sense. Maybe the context shouldn't be added in the first
place, though. I'll review this.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>46696</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-11-03 22:02:49 +0000</bug_when>
    <thetext>Thanks. I've applied the patch you were suggesting.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>47963</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-11-23 17:52:32 +0000</bug_when>
    <thetext>*** Bug 24927 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>24482</bug_id>
          
          <creation_ts>2003-11-07 00:27:00 +0000</creation_ts>
          <short_desc>DOC "creating a patch" example doesn't work</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:AJP</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>http://jakarta.apache.org/tomcat/tomcat-4.1-doc/jk2/common/doccontrib.html</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Kyle VanderBeek">kylev</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>46964</commentid>
    <comment_count>0</comment_count>
    <who name="Kyle VanderBeek">kylev</who>
    <bug_when>2003-11-07 00:27:04 +0000</bug_when>
    <thetext>The example command to create doco patch doesn't work, it lacks redirection (&gt;).
 It also doesn't quite look like the other examples on the page.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>46965</commentid>
    <comment_count>1</comment_count>
      <attachid>8970</attachid>
    <who name="Kyle VanderBeek">kylev</who>
    <bug_when>2003-11-07 00:28:29 +0000</bug_when>
    <thetext>Created attachment 8970
fix create patch example, CVS head</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49220</commentid>
    <comment_count>2</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2003-12-17 02:51:16 +0000</bug_when>
    <thetext>Fixed as suggested for 5.0.17.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>8970</attachid>
            <date>2003-11-07 00:28:00 +0000</date>
            <delta_ts>2003-11-07 00:28:29 +0000</delta_ts>
            <desc>fix create patch example, CVS head</desc>
            <filename>docs-cvs-example.patch</filename>
            <type>text/plain</type>
            <size>763</size>
            <attacher name="Kyle VanderBeek">kylev</attacher>
            

          </attachment>
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>24708</bug_id>
          
          <creation_ts>2003-11-14 11:57:00 +0000</creation_ts>
          <short_desc>Tomcat documentation is incorrect with regards to Tyrex and has broken links to Tyrex's web site.</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Documentation</component>
          <version>5.0.0</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>http://jakarta.apache.org/tomcat/tomcat-5.0-doc/jndi-datasource-examples-howto.html#Tyrex%20Connection%20Pool</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Rost Vashevnik">metaboss</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>47345</commentid>
    <comment_count>0</comment_count>
    <who name="Rost Vashevnik">metaboss</who>
    <bug_when>2003-11-14 11:57:18 +0000</bug_when>
    <thetext>Hi there !

My name is Rost Vashevnik and I am Tyrex project admin. It has been brought to 
my attention that links from Tomcat's documentation to Tyrex site are broken (I 
believe this is the case for all versions of Tomcat). Tyrex has moved from 
http://tyrex.exolab.org to http://tyrex.sourceforge.net some time ago. More 
importantly (and embarassingly for us all) http://tyrex.exolab.org does not 
respond properly any more. So your (and potentially our) user is at a loss what 
to do. 

I hope you coud fix it quikly to our common benefit.

Also we have just released another version of Tyrex, which uses latest third 
party libraries. Please let me know if you would like me to review 
Tomcat's "How to counfigure Tyrex" documentation and submit updated 
instructions. 

Thank you for your time

Kind regards

Rost Vashevnik</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>47396</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-11-15 09:55:44 +0000</bug_when>
    <thetext>Actually, the Tyrex object factory has been removed from Tomcat, so I'll have to
remove the documentation, since Tyrex is now no longer supported (at least not
until you ship a JNDI object factory for the connection pools - I couldn't find
one in the Tyrex repository).</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>24723</bug_id>
          
          <creation_ts>2003-11-15 00:19:00 +0000</creation_ts>
          <short_desc>JNDI Datasource HOWTO instructions incorrect - Name jdbc is not bound in this Context</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Administration</component>
          <version>5.0.12</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P1</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Graham Leggett">minfrin</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>bogdan</cc>
    
    <cc>pjohlie</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>47382</commentid>
    <comment_count>0</comment_count>
    <who name="Graham Leggett">minfrin</who>
    <bug_when>2003-11-15 00:19:46 +0000</bug_when>
    <thetext>If the instructions are followed to configure a JNDI DataSource pointing at a
postgresql database that are posted at
http://jakarta.apache.org/tomcat/tomcat-4.1-doc/jndi-datasource-examples-howto.html,
the result is the following exception:

javax.naming.NameNotFoundException: Name jdbc is not bound in this Context
	at org.apache.naming.NamingContext.lookup(NamingContext.java:811)
	at org.apache.naming.NamingContext.lookup(NamingContext.java:194)
	at org.apache.catalina.realm.DataSourceRealm.open(DataSourceRealm.java:467)
	at org.apache.catalina.realm.DataSourceRealm.authenticate(DataSourceRealm.java:315)
	at
org.apache.catalina.authenticator.BasicAuthenticator.authenticate(BasicAuthenticator.java:161)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>47388</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-11-15 07:45:27 +0000</bug_when>
    <thetext>This functionality works fine (maybe you simply disabled naming). Please post
about that on tomcat-user.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>47398</commentid>
    <comment_count>2</comment_count>
    <who name="Graham Leggett">minfrin</who>
    <bug_when>2003-11-15 11:14:42 +0000</bug_when>
    <thetext>Not for me it doesn't, and tomcat-user has been of no help so far. :(

How does one "disable naming"? Nothing like this is mentioned in the HOWTO.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>47400</commentid>
    <comment_count>3</comment_count>
    <who name="Graham Leggett">minfrin</who>
    <bug_when>2003-11-15 16:35:52 +0000</bug_when>
    <thetext>Success at last.

Turns out the HOWTO documentation is incomplete and incorrect.

- The HOWTO claims that the &lt;resource&gt; section should go under the context. This
does not work - a Google search has revealed a number of people with this
problem, and there is at least one bug report open.

The correct place (as in "the place where it works") to put &lt;resources&gt; is in
the &lt;GlobalNamingResources&gt; section, which goes under &lt;Server&gt;.

A further problem with the HOWTO is consistency with regards to datasource
naming. Under the postgres section, the datasource is first named
"jdbc/postgres", then it is named "jdbc/mydb" under web.xml. This is confusing
to first time users.

In order to get Realms to work, the realm must refer to the datasource as
defined in the &lt;globalnamingresources&gt; section, not a datasource as renamed
using &lt;resourcelink&gt;. This is not made clear in the HOWTO.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>47957</commentid>
    <comment_count>4</comment_count>
    <who name="Mark Thomas">medthomas</who>
    <bug_when>2003-11-23 16:41:43 +0000</bug_when>
    <thetext>*** Bug 24836 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48013</commentid>
    <comment_count>5</comment_count>
    <who name="pete johlie">pjohlie</who>
    <bug_when>2003-11-24 15:16:43 +0000</bug_when>
    <thetext>I actually got the DataSource working as per the example, but only if i used 
the admin interface to add the resource. I added it under the context for my 
app, not in the global.
However, this was almost a catch-22 because the admin interface would 
dump "cannot find driverName" if there wasn't a resource already defined.
So I went directly to the server.xml file and added a "dummy" resource, then 
the admin interface would allow me to modify the url, login, etc.
Then it worked.
For awhile.
Now it seems that when i have ant pop the war file for my app into the tomcat 
webapps dir, and delete the folder for my app under the  webapps dir, i get the 
naming problem after restart.

Do i have to be locked into the admin interface?
whatever
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52720</commentid>
    <comment_count>6</comment_count>
    <who name="Dirk Verbeeck">dirk.verbeeck</who>
    <bug_when>2004-02-21 14:20:15 +0000</bug_when>
    <thetext>DBCP can be configured in &lt;GlobalNamingResources&gt; and &lt;Context&gt;
(ask configuration question on commons-user or tomcat-user)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52725</commentid>
    <comment_count>7</comment_count>
    <who name="Graham Leggett">minfrin</who>
    <bug_when>2004-02-21 14:30:30 +0000</bug_when>
    <thetext>Have you gone through the howto step by step and confirmed that the problems
described in this report are not still present in the latest version of tomcat?
If not, then the bug is not fixed.

Remember the bug is with the documentation. It should not be necessary to ask on
tomcat user for clarity on usage when the docs are wrong.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57788</commentid>
    <comment_count>8</comment_count>
    <who name="Bogdan Klosek">bogdan</who>
    <bug_when>2004-05-21 11:24:30 +0000</bug_when>
    <thetext>Tomcat 5.0.12: Error: Cannot load JDBC driver class 'null'
Toncat 5.0.19: Error: Cannot create JDBC driver of class '' for connect URL 'null'
- This not work! END!
Parameters:
JAVA:
java version "1.4.1_02"
Java(TM) 2 Runtime Environment, Standard Edition (build 1.4.1_02-b06)
Java HotSpot(TM) Client VM (build 1.4.1_02-b06, mixed mode)
Tomcat-Config:
server.xml:
&lt;?xml version='1.0' encoding='utf-8'?&gt;
&lt;Server&gt;
 ...
  &lt;GlobalNamingResources&gt;
    &lt;Resource name="jdbc/PoolDB" type="javax.sql.DataSource"/&gt;
    &lt;ResourceParams name="jdbc/PoolDB"&gt;
      &lt;parameter&gt;
        &lt;name&gt;validationQuery&lt;/name&gt;
        &lt;value&gt;select count(IdxAnb) from Anbieter&lt;/value&gt;
      &lt;/parameter&gt;
      &lt;parameter&gt;
        &lt;name&gt;maxWait&lt;/name&gt;
        &lt;value&gt;5000&lt;/value&gt;
      &lt;/parameter&gt;
      &lt;parameter&gt;
        &lt;name&gt;maxActive&lt;/name&gt;
        &lt;value&gt;30&lt;/value&gt;
      &lt;/parameter&gt;
      &lt;parameter&gt;
        &lt;name&gt;password&lt;/name&gt;
        &lt;value&gt;...&lt;/value&gt;
      &lt;/parameter&gt;
      &lt;parameter&gt;
        &lt;name&gt;url&lt;/name&gt;
    
&lt;value&gt;jdbc:mysql://toshi554:3306/SysReserv2?useUnicode=true&amp;amp;characterEncoding=ISO-8859-1&lt;/value&gt;
      &lt;/parameter&gt;
      &lt;parameter&gt;
        &lt;name&gt;driverClassName&lt;/name&gt;
        &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;
      &lt;/parameter&gt;
      &lt;parameter&gt;
        &lt;name&gt;maxIdle&lt;/name&gt;
        &lt;value&gt;10&lt;/value&gt;
      &lt;/parameter&gt;
      &lt;parameter&gt;
        &lt;name&gt;username&lt;/name&gt;
        &lt;value&gt;xyz&lt;/value&gt;
      &lt;/parameter&gt;
    &lt;/ResourceParams&gt;
    ...
  &lt;/GlobalNamingResources&gt;
  ...
&lt;/Server&gt;

WEB-Application:
web.xml:
                                                                                
&lt;!DOCTYPE web-app
    PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
    "http://java.sun.com/dtd/web-app_2_3.dtd"&gt;
                                                                                
&lt;web-app&gt;
 ...
  &lt;resource-ref&gt;
      &lt;description&gt;DB SysReserv2 Connection&lt;/description&gt;
      &lt;res-ref-name&gt;jdbc/PoolDB&lt;/res-ref-name&gt;
      &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
      &lt;res-auth&gt;Container&lt;/res-auth&gt;
  &lt;/resource-ref&gt;
 ...                                                                               
&lt;/web-app&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58155</commentid>
    <comment_count>9</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-05-26 19:40:11 +0000</bug_when>
    <thetext>You're missing the &lt;factory&gt; element, which is essential. 

Bugzilla is a sub-optimal forum for discussing problems.  Bogdan, post your 
issue to tomcat-user and you will receive corrections, don't hijack this 
unrelated Bugzilla issue.

Graham: please submit patches to correct any documentation problems you see to 
the tomcat-dev list and I will gladly review and commit them as needed.

This particular item I'm closing again, hopefully for good.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58226</commentid>
    <comment_count>10</comment_count>
    <who name="Graham Leggett">minfrin</who>
    <bug_when>2004-05-27 17:44:37 +0000</bug_when>
    <thetext>A bug should only get closed when it is fixed or found to be invalid, and at no
other time.

Has the documentation been updated to reflect the correct behaviour? Has someone
actually taken the time to verify this? I see no comment against this bug to
show it's been verified, nor do I see any patches logged against it for a
proposed fix. Looking at the docs again, I see that the problems in the docs
that I posted are still there, so I can only conclude there has been no change.

I (as in minfrin@apache.org) am reopening this bug until someone can actually
verify that this bug is still present. Unfortunately I do not have the time to
do so now, as my time is focused on getting mod_ldap out of httpd experimental.
Closing bugs arbitrarily that have not yet been fixed or verified (bug denial)
is a waste of everybody's time, please don't do it.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58232</commentid>
    <comment_count>11</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-05-27 18:39:15 +0000</bug_when>
    <thetext>OK.  I've modified the document to address the issues you raised.  You can see 
it in CVS at http://cvs.apache.org/viewcvs.cgi/jakarta-tomcat-
catalina/webapps/docs/jndi-datasource-examples-howto.xml and it will of course 
be part of future tomcat 5 releases.  It will be visible on the website with 
the next tomcat 5 release.

In addition, I've verified the how-to works exactly as specified when following 
the document to the letter, against Oracle and MySQL, on tomcat 5.0.25 (the 
latest stable release at the time of this writing).  I did this verification 
putting the data source declarations both inside a Context and inside the 
GlobalNamingResources: both work equally well.

I have not tested admin webapp editing of these data sources.  If a bug exists 
there, feel free to submit another issue in bugzilla: this issue is for the 
documentation flaws.

Finally, if you feel like the documentation is still lacking / misleading / 
wrong, I restate my earlier invitation for you to submit the text changes you'd 
like to see, and my earlier promise to quickly review and commit them.

This bug is not invalid: it's valid, and it's now fixed.</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>24779</bug_id>
          
          <creation_ts>2003-11-18 12:09:00 +0000</creation_ts>
          <short_desc>Jasper fails to parse correct XML syntax JSP page with certain EL expressions.</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.14</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Alexey Naidyonov">growler</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>47540</commentid>
    <comment_count>0</comment_count>
    <who name="Alexey Naidyonov">growler</who>
    <bug_when>2003-11-18 12:09:07 +0000</bug_when>
    <thetext>It appears that certain JSP 2.0 EL expressions may or may not work
depending on choosen JSP syntax. E.g., jsp page in standard syntax

&lt;html&gt;
  &lt;head&gt;
  &lt;/head&gt;
  &lt;body&gt;
    ${header["user-agent"]}&lt;br/&gt;
    \${header["user-agent"]}&lt;br/&gt;  
  &lt;/body&gt;
&lt;/html&gt;

is ok, but jsp page in xml syntax 

&lt;?xml version="1.0" encoding="iso-8859-1"?&gt;
&lt;jsp:root xmlns:jsp="http://java.sun.com/JSP/Page" version="2.0"&gt;
&lt;jsp:directive.page contentType="text/html"/&gt;
&lt;html&gt;
  &lt;head&gt;
  &lt;/head&gt;
  &lt;body&gt;
    ${header["user-agent"]}&lt;br/&gt;
    \${header["user-agent"]}&lt;br/&gt;  
  &lt;/body&gt;
&lt;/html&gt;
&lt;/jsp:root&gt;

will result into "org.apache.jasper.JasperException: /test.jsp() Unterminated ${
tag" exception.

I believe the problem is withing JspDocumentParser.java code. The
characters() function assumes that the parser always passes the content
of a text node with a single call which is not always the case.
Actually, org.xml.sax.ContentHandler API specifies that "SAX parsers may
return all contiguous character data in a single chunk, or they may
split it into several chunks". Moreover, it splits text nodes content
into several chunks whenever it meets '[' or ']' within the node, so the
code fails to parse any correct EL expression using array access syntax.

Also please note that escaping EL expression with '\' character also doesn't
work with XML syntax.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48062</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-11-25 01:03:08 +0000</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>24787</bug_id>
          
          <creation_ts>2003-11-18 15:25:00 +0000</creation_ts>
          <short_desc>Alias Name field Limited to 24 characters</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Administration</component>
          <version>5.0.14</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="George Sexton">gsexton</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>47553</commentid>
    <comment_count>0</comment_count>
    <who name="George Sexton">gsexton</who>
    <bug_when>2003-11-18 15:25:21 +0000</bug_when>
    <thetext>Using the administration application, if you change to a virtual host and select
"Create New Aliases" from the "Host Actions" dropdown, the "Alias Name" text box
has a maxlength value of 24.

This is too short for all but the most trivial cases.

The length limitation should be increased to at least 128, or eliminated entirely.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>47554</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-11-18 15:31:23 +0000</bug_when>
    <thetext>Fixed. The max is now 128.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>24829</bug_id>
          
          <creation_ts>2003-11-19 17:06:00 +0000</creation_ts>
          <short_desc>The startup option "-config" doesnt work</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.14</version>
          <rep_platform>HP</rep_platform>
          <op_sys>HP-UX</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ravi Boppe">rboppe</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>p_samson</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>47635</commentid>
    <comment_count>0</comment_count>
    <who name="Ravi Boppe">rboppe</who>
    <bug_when>2003-11-19 17:06:01 +0000</bug_when>
    <thetext>When I start Catalina (Tomcat 5.0.14) using
$ $CATALINA_HOME/bin/startup.sh -config $PATH_TO_MY_CONFIG/server.xml

The server does not start up. There are no error messges shown on stdout.
When I use the debug option, and run from the jdb debugger, I get
-----------
&gt; run
Set uncaught java.lang.Throwable
Set deferred uncaught java.lang.Throwable


and then the application exits.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>47642</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-11-19 18:19:41 +0000</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>47702</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-11-20 15:32:25 +0000</bug_when>
    <thetext>*** Bug 24858 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>24832</bug_id>
          
          <creation_ts>2003-11-19 18:18:00 +0000</creation_ts>
          <short_desc>JDBCAccessLogValve not working after database restart</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Peter Rossbach">pr</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>47640</commentid>
    <comment_count>0</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2003-11-19 18:18:08 +0000</bug_when>
    <thetext>The JDBCAccessLogValve not working after Database restart.
I have ported the JDBCRealm connection handling. (s. patch)
I added the also the user,password attributes to get it working with hsql 
1.7.1, 1.7.2 alpha and mysql 3.23.52

with hsql I used following table layout:

drop ts column 
delete not null column to support common log pattern.

drop table tomcat_access IF EXISTS;
-- drop INDEX i_access_ts ; 
-- drop INDEX i_access_remoteHost ; 
-- drop INDEX i_access_virtualHost  ; 
-- drop INDEX i_access_query  ; 
-- drop INDEX i_access_userAgent  ; 


CREATE TABLE tomcat_access (
 id INTEGER IDENTITY,
 remoteHost VARCHAR(60) ,
 user VARCHAR(30),
 timestamp TIMESTAMP NOT NULL,
 virtualHost VARCHAR(64),
 method VARCHAR(8),
 query VARCHAR(255) NOT NULL,
 status SMALLINT  NOT NULL,
 bytes INTEGER NOT NULL,
 referer VARCHAR(128),
 userAgent VARCHAR(128)
 );
CREATE INDEX i_access_timestamp ON  tomcat_access (timestamp) ; 
CREATE INDEX i_access_remoteHost ON  tomcat_access (remoteHost) ; 
CREATE INDEX i_access_virtualHost ON  tomcat_access (virtualHost) ; 
CREATE INDEX i_access_query ON  tomcat_access (query) ; 
CREATE INDEX i_access_userAgent ON  tomcat_access (userAgent) ; 

More ToDO:
Error handling is not really good . Log all Exceptions after Database gone.
With a datasouce support we can have parallel insert handling.

Peter</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>47641</commentid>
    <comment_count>1</comment_count>
      <attachid>9193</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2003-11-19 18:19:08 +0000</bug_when>
    <thetext>Created attachment 9193
Patch to JDBCAccessLogValve connection restart handling</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>47661</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-11-19 23:56:24 +0000</bug_when>
    <thetext>Since there's basically nobody to maintain this component, I will apply your
patch (it seems ok).</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>9193</attachid>
            <date>2003-11-19 18:19:00 +0000</date>
            <delta_ts>2003-11-19 18:19:08 +0000</delta_ts>
            <desc>Patch to JDBCAccessLogValve connection restart handling</desc>
            <filename>jdbc.patch</filename>
            <type>text/plain</type>
            <size>14057</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>24904</bug_id>
          
          <creation_ts>2003-11-21 19:29:00 +0000</creation_ts>
          <short_desc>Namespace Resolution in XML View Fails</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.14</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Scott Corley">scorley</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>47857</commentid>
    <comment_count>0</comment_count>
    <who name="Scott Corley">scorley</who>
    <bug_when>2003-11-21 19:29:37 +0000</bug_when>
    <thetext>Nesting custom tags with name "text" fail due to namespace resolution 
problems.  See sample.war - http://localhost/sample/xml/xml.jsp.

org.apache.jasper.JasperException: /xml/xml.jsp(14,37) &lt;jsp:text&gt; must not 
have any subelements
	org.apache.jasper.compiler.DefaultErrorHandler.jspError
(DefaultErrorHandler.java:83)
	org.apache.jasper.compiler.ErrorDispatcher.dispatch
(ErrorDispatcher.java:402)
	org.apache.jasper.compiler.ErrorDispatcher.jspError
(ErrorDispatcher.java:126)
	org.apache.jasper.compiler.JspDocumentParser.parse
(JspDocumentParser.java:231)
	org.apache.jasper.compiler.ParserController.parse
(ParserController.java:224)
	org.apache.jasper.compiler.ParserController.parse
(ParserController.java:149)
	org.apache.jasper.compiler.ParserController.parse
(ParserController.java:135)
	org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:243)
	org.apache.jasper.compiler.Compiler.compile(Compiler.java:459)
	org.apache.jasper.compiler.Compiler.compile(Compiler.java:442)
	org.apache.jasper.JspCompilationContext.compile
(JspCompilationContext.java:552)
	org.apache.jasper.servlet.JspServletWrapper.service
(JspServletWrapper.java:291)
	org.apache.jasper.servlet.JspServlet.serviceJspFile
(JspServlet.java:301)
	org.apache.jasper.servlet.JspServlet.service(JspServlet.java:248)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:856)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>47858</commentid>
    <comment_count>1</comment_count>
      <attachid>9230</attachid>
    <who name="Scott Corley">scorley</who>
    <bug_when>2003-11-21 19:30:20 +0000</bug_when>
    <thetext>Created attachment 9230
sample war file</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>47912</commentid>
    <comment_count>2</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-11-22 02:12:59 +0000</bug_when>
    <thetext>This problem is not what you think it is, but it is a bug alright.  If you have
used any tag name other than "text", it would have worked.  :)

Anyway, thanks for reporting the bug.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>9230</attachid>
            <date>2003-11-21 19:30:00 +0000</date>
            <delta_ts>2003-11-21 19:30:20 +0000</delta_ts>
            <desc>sample war file</desc>
            <filename>sample.war</filename>
            <type>application/octet-stream</type>
            <size>6443</size>
            <attacher name="Scott Corley">scorley</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>24957</bug_id>
          
          <creation_ts>2003-11-24 23:49:00 +0000</creation_ts>
          <short_desc>EL treates operators as functions</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.14</version>
          <rep_platform>Sun</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Bryan Basham">b_basham</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>48056</commentid>
    <comment_count>0</comment_count>
    <who name="Bryan Basham">b_basham</who>
    <bug_when>2003-11-24 23:49:30 +0000</bug_when>
    <thetext>The JSP/EL language is incorrectly treating operator keywords (such as 'and'
'or' 'mod' and so on) as functions when the expression on the right of the
operator is a parenthetical expression. 

For example: ${7 div (3 + 2)}   gives a translation error because it thinks
that 'div' should be treated as a function (but it cannot find the declaration
of that function).

I have a test webapp that I will submit.

-Bryan Basham</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48057</commentid>
    <comment_count>1</comment_count>
      <attachid>9272</attachid>
    <who name="Bryan Basham">b_basham</who>
    <bug_when>2003-11-24 23:54:37 +0000</bug_when>
    <thetext>Created attachment 9272
test webapp for failure of EL operators</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48064</commentid>
    <comment_count>2</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-11-25 01:41:12 +0000</bug_when>
    <thetext>Fixed.

Thanks for reporting the bug, and for providing the test.  If every bug has test
as good as this, they'd all have been fixed!</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>9272</attachid>
            <date>2003-11-24 23:54:00 +0000</date>
            <delta_ts>2003-11-24 23:54:37 +0000</delta_ts>
            <desc>test webapp for failure of EL operators</desc>
            <filename>TestEL.war</filename>
            <type>application/octet-stream</type>
            <size>4908</size>
            <attacher name="Bryan Basham">b_basham</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>24968</bug_id>
          
          <creation_ts>2003-11-25 11:39:00 +0000</creation_ts>
          <short_desc>RELEASE-NOTES states wrong version of commons-dbcp</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Documentation</component>
          <version>5.0.14</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Adam Hardy">adam.hardy</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>48080</commentid>
    <comment_count>0</comment_count>
    <who name="Adam Hardy">adam.hardy</who>
    <bug_when>2003-11-25 11:39:15 +0000</bug_when>
    <thetext>RELEASE-NOTES says commons-dbcp 1.0 is provided. Version 1.1 is actually
present. Would have saved me a download.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48083</commentid>
    <comment_count>1</comment_count>
    <who name="Adam Hardy">adam.hardy</who>
    <bug_when>2003-11-25 11:53:04 +0000</bug_when>
    <thetext>While I'm at it, you could also note what version of xercesImpl.jar is included,
i.e. v2.5, since it is not immediately obvious from the jar which version it is
and since it is subject of a bug in the server.xml xml validation. </thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>24972</bug_id>
          
          <creation_ts>2003-11-25 14:27:00 +0000</creation_ts>
          <short_desc>Some *.sh scripts in tar not executable.</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Native:Packaging</component>
          <version>5.0.14</version>
          <rep_platform>All</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Andreas Krüger">andreas.krueger</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>48096</commentid>
    <comment_count>0</comment_count>
    <who name="Andreas Krüger">andreas.krueger</who>
    <bug_when>2003-11-25 14:27:16 +0000</bug_when>
    <thetext>In my opinion, the *.sh scripts in jakarta-tomcat-5.0.14.tar.gz
should all have the executalbe bit set, consistently, but not all do:

$ tar tvzf jakarta-tomcat-5.0.14.tar.gz '*.sh' |
   perl -wane 'print $F[0], "  ", $F[5], "\n"'
-rwxr-xr-x  jakarta-tomcat-5.0.14/bin/digest.sh
-rwxr-xr-x  jakarta-tomcat-5.0.14/bin/startup.sh
-rwxr-xr-x  jakarta-tomcat-5.0.14/bin/tool-wrapper.sh
-rwxr-xr-x  jakarta-tomcat-5.0.14/bin/catalina.sh
-rwxr-xr-x  jakarta-tomcat-5.0.14/bin/shutdown.sh
-rwxr-xr-x  jakarta-tomcat-5.0.14/bin/setclasspath.sh
-rw-r--r--  jakarta-tomcat-5.0.14/bin/tool-wrapper-using-launcher.sh
-rw-r--r--  jakarta-tomcat-5.0.14/bin/shutdown-using-launcher.sh
-rw-r--r--  jakarta-tomcat-5.0.14/bin/startup-using-launcher.sh</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48097</commentid>
    <comment_count>1</comment_count>
    <who name="Andreas Krüger">andreas.krueger</who>
    <bug_when>2003-11-25 14:43:44 +0000</bug_when>
    <thetext>Come to think of it, setclasspath.sh should probably not be marked
executable, as it needs to be sourced in.</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>25010</bug_id>
          
          <creation_ts>2003-11-26 11:36:00 +0000</creation_ts>
          <short_desc>Symbolic links should be supported through &lt;DefaultContext&gt;</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina:Modules</component>
          <version>5.0.14</version>
          <rep_platform>Other</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Andreas Krüger">andreas.krueger</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>48145</commentid>
    <comment_count>0</comment_count>
    <who name="Andreas Krüger">andreas.krueger</who>
    <bug_when>2003-11-26 11:36:06 +0000</bug_when>
    <thetext>I would like to allow symbolic links for the entirety of my Tomcat installation.

The only way I know of allowing them is through


   &lt;Context ... &gt;
      &lt;Resources
         className="org.apache.naming.resources.FileDirContext"
         allowLinking="true"
      /&gt;
   &lt;/Context&gt;

I propose the same functionality should also be available through
&lt;DefaultContext&gt;.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48183</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-11-26 19:35:13 +0000</bug_when>
    <thetext>I think you're smart. Now look at the changelog for TC 5.0.15.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48281</commentid>
    <comment_count>2</comment_count>
    <who name="Andreas Krüger">andreas.krueger</who>
    <bug_when>2003-11-28 12:26:30 +0000</bug_when>
    <thetext>I have found something to this respect in
http://nagoya.apache.org/bugzilla/show_bug.cgi?id=25010

Appearently, this bug, which I have reported for 5.0.14,
has been fixed in the present development.

So, there is a small bookkeeping error here:
This bug should have been RESOLVED/FIXED, but presently is RESOLVED/INVALID.

I will reopen it to be able to correct this bookkeeping error.</thetext>
  </long_desc>
      
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>25011</bug_id>
          
          <creation_ts>2003-11-26 11:40:00 +0000</creation_ts>
          <short_desc>Flag allowLinking should be documented for &lt;Resources&gt; .</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina:Modules</component>
          <version>5.0.14</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Andreas Krüger">andreas.krueger</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>48147</commentid>
    <comment_count>0</comment_count>
    <who name="Andreas Krüger">andreas.krueger</who>
    <bug_when>2003-11-26 11:40:23 +0000</bug_when>
    <thetext>There is no documentation for the flag allowLinking, that enables
symbolic linking, at, e.g.,

http://jakarta.apache.org/tomcat/tomcat-5.0-doc/config/resources.html</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48191</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-11-26 20:26:17 +0000</bug_when>
    <thetext>Done. It is already documented for DefaultContext.</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>25033</bug_id>
          
          <creation_ts>2003-11-26 20:52:00 +0000</creation_ts>
          <short_desc>After install,remove and install application the app is not available</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.15</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Peter Rossbach">pr</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>manhole</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>48194</commentid>
    <comment_count>0</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2003-11-26 20:52:46 +0000</bug_when>
    <thetext>Sorry,

I have installed a directory deployment with install ant task.

Application wotk OK

Than I remove the App an installed again and I got 503 with every request.

But the Ant list taks say apllication is running.
C:\Dokumente\tomcatKolumne\2004-02\example\examples\access&gt;ant -f tomadmin.xml 
l
ist
Buildfile: tomadmin.xml

list:
     [list] OK - Auflistung der Webanwendungen f³r virtuellen Server localhost

     [list] /admin:running:0:c:\develop\tomcat5\jakarta-tomcat-5
\build/server/we
bapps/admin

     [list] /myapps:running:0:C:/Dokumente/tomcatKolumne/2004-
02/example/example
s/access/myapps

     [list] /:running:0:C:\Dokumente\tomcatKolumne\2004-02\example\logger-
server
\webapps\ROOT

     [list] /manager:running:0:c:\develop\tomcat5\jakarta-tomcat-5
\build/server/
webapps/manager


BUILD SUCCESSFUL
Total time: 1 second

after restart the application myapps work fine.

See example configuration.

The same catalina.base config work fine with 5.0.14 release.

Peter</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48195</commentid>
    <comment_count>1</comment_count>
      <attachid>9311</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2003-11-26 20:53:54 +0000</bug_when>
    <thetext>Created attachment 9311
Example Application with catalina.base configuration</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48196</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-11-26 20:55:03 +0000</bug_when>
    <thetext>Use deploy and undeploy rather than these deprecated tasks.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48197</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-11-26 21:25:28 +0000</bug_when>
    <thetext>I tested and the bug is not related to install. However, reloading the
application, which is very easy to do, fixes the problem.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48198</commentid>
    <comment_count>4</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2003-11-26 21:29:02 +0000</bug_when>
    <thetext>Hello,

something with deregister AccessLog Valve goes wrong....

Logger-Webdev:type=Valve,name=Access
LogValve,seq=2,path=/myapps,host=localhost

I thing the name is ObjectName wrong : What means the seq2

Peter

PS: OK I test with deploy/undeploy!


see following console output:

INFO: Removing web application at context path /myapps
26.11.2003 22:20:41 org.apache.catalina.core.StandardPipeline unregisterValve
INFO: Can't unregister valve org.apache.catalina.valves.AccessLogValve@1ce85c4
javax.management.InstanceNotFoundException: Logger-
Webdev:type=Valve,name=Access
LogValve,seq=2,path=/myapps,host=localhost
        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getMBean
(Defaul
tMBeanServerInterceptor.java:1015)
        at 
com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.unregisterMBean
(DefaultMBeanServerInterceptor.java:361)
        at com.sun.jmx.mbeanserver.JmxMBeanServer.unregisterMBean
(JmxMBeanServer
.java:535)
        at org.apache.catalina.core.StandardPipeline.unregisterValve
(StandardPip
eline.java:379)
        at org.apache.catalina.core.StandardPipeline.stop
(StandardPipeline.java:
334)
        at org.apache.catalina.core.StandardContext.stop
(StandardContext.java:44
40)
        at org.apache.catalina.core.ContainerBase.removeChild
(ContainerBase.java
:995)
        at org.apache.catalina.core.StandardHostDeployer.remove
(StandardHostDepl
oyer.java:652)
        at org.apache.catalina.core.StandardHost.remove(StandardHost.java:964)
        at org.apache.catalina.manager.ManagerServlet.remove
(ManagerServlet.java
:1062)
        at org.apache.catalina.manager.ManagerServlet.doGet
(ManagerServlet.java:
380)
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:743)
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter
(Appl
icationFilterChain.java:284)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter
(ApplicationF
ilterChain.java:204)
        at org.apache.catalina.core.StandardWrapperValve.invoke
(StandardWrapperV
alve.java:256)
        at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValv
eContext.java:151)
        at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.jav
a:564)
        at org.apache.catalina.core.StandardContextValve.invokeInternal
(Standard
ContextValve.java:245)
        at org.apache.catalina.core.StandardContextValve.invoke
(StandardContextV
alve.java:199)
        at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValv
eContext.java:151)
        at org.apache.catalina.authenticator.AuthenticatorBase.invoke
(Authentica
torBase.java:594)
        at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValv
eContext.java:149)
        at org.apache.catalina.valves.RequestFilterValve.process
(RequestFilterVa
lve.java:323)
        at org.apache.catalina.valves.RemoteAddrValve.invoke
(RemoteAddrValve.jav
a:131)
        at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValv
eContext.java:149)
        at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.jav
a:564)
        at org.apache.catalina.core.StandardHostValve.invoke
(StandardHostValve.j
ava:195)
        at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValv
eContext.java:151)
        at org.apache.catalina.valves.ErrorReportValve.invoke
(ErrorReportValve.j
ava:164)
        at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValv
eContext.java:149)
        at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.jav
a:564)
        at org.apache.catalina.core.StandardEngineValve.invoke
(StandardEngineVal
ve.java:156)
        at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValv
eContext.java:151)
        at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.jav
a:564)
        at org.apache.catalina.core.ContainerBase.invoke
(ContainerBase.java:972)

        at org.apache.coyote.tomcat5.CoyoteAdapter.service
(CoyoteAdapter.java:21
1)
        at org.apache.coyote.http11.Http11Processor.process
(Http11Processor.java
:805)
        at 
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.proce
ssConnection(Http11Protocol.java:696)
        at org.apache.tomcat.util.net.TcpWorkerThread.runIt
(PoolTcpEndpoint.java
:605)
        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run
(ThreadP
ool.java:677)
        at java.lang.Thread.run(Thread.java:536)
26.11.2003 22:20:41 org.apache.catalina.core.StandardPipeline unregisterValve
INFO: Can't unregister valve org.apache.catalina.valves.AccessLogValve@139e351
javax.management.InstanceNotFoundException: Logger-
Webdev:type=Valve,name=Access
LogValve,seq=2,path=/myapps,host=localhost
        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getMBean
(Defaul
tMBeanServerInterceptor.java:1015)
        at 
com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.unregisterMBean
(DefaultMBeanServerInterceptor.java:361)
        at com.sun.jmx.mbeanserver.JmxMBeanServer.unregisterMBean
(JmxMBeanServer
.java:535)
        at org.apache.catalina.core.StandardPipeline.unregisterValve
(StandardPip
eline.java:379)
        at org.apache.catalina.core.StandardPipeline.stop
(StandardPipeline.java:
334)
        at org.apache.catalina.core.StandardContext.stop
(StandardContext.java:44
40)
        at org.apache.catalina.core.ContainerBase.removeChild
(ContainerBase.java
:995)
        at org.apache.catalina.core.StandardHostDeployer.remove
(StandardHostDepl
oyer.java:652)
        at org.apache.catalina.core.StandardHost.remove(StandardHost.java:964)
        at org.apache.catalina.manager.ManagerServlet.remove
(ManagerServlet.java
:1062)
        at org.apache.catalina.manager.ManagerServlet.doGet
(ManagerServlet.java:
380)
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:743)
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter
(Appl
icationFilterChain.java:284)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter
(ApplicationF
ilterChain.java:204)
        at org.apache.catalina.core.StandardWrapperValve.invoke
(StandardWrapperV
alve.java:256)
        at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValv
eContext.java:151)
        at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.jav
a:564)
        at org.apache.catalina.core.StandardContextValve.invokeInternal
(Standard
ContextValve.java:245)
        at org.apache.catalina.core.StandardContextValve.invoke
(StandardContextV
alve.java:199)
        at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValv
eContext.java:151)
        at org.apache.catalina.authenticator.AuthenticatorBase.invoke
(Authentica
torBase.java:594)
        at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValv
eContext.java:149)
        at org.apache.catalina.valves.RequestFilterValve.process
(RequestFilterVa
lve.java:323)
        at org.apache.catalina.valves.RemoteAddrValve.invoke
(RemoteAddrValve.jav
a:131)
        at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValv
eContext.java:149)
        at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.jav
a:564)
        at org.apache.catalina.core.StandardHostValve.invoke
(StandardHostValve.j
ava:195)
        at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValv
eContext.java:151)
        at org.apache.catalina.valves.ErrorReportValve.invoke
(ErrorReportValve.j
ava:164)
        at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValv
eContext.java:149)
        at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.jav
a:564)
        at org.apache.catalina.core.StandardEngineValve.invoke
(StandardEngineVal
ve.java:156)
        at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValv
eContext.java:151)
        at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.jav
a:564)
        at org.apache.catalina.core.ContainerBase.invoke
(ContainerBase.java:972)

        at org.apache.coyote.tomcat5.CoyoteAdapter.service
(CoyoteAdapter.java:21
1)
        at org.apache.coyote.http11.Http11Processor.process
(Http11Processor.java
:805)
        at 
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.proce
ssConnection(Http11Protocol.java:696)
        at org.apache.tomcat.util.net.TcpWorkerThread.runIt
(PoolTcpEndpoint.java
:605)
        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run
(ThreadP
ool.java:677)
        at java.lang.Thread.run(Thread.java:536)
26.11.2003 22:20:41 org.apache.catalina.logger.LoggerBase stop
INFO: unregistering logger Logger-
Webdev:type=Logger,path=/myapps,host=localhost

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48199</commentid>
    <comment_count>5</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-11-26 21:35:13 +0000</bug_when>
    <thetext>Fixing it was rather trivial, also.
Understanding your reports is quite a challenge, sometimes.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48218</commentid>
    <comment_count>6</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-11-26 23:31:16 +0000</bug_when>
    <thetext>The valve related trouble works for me (with a META-INF/context.xml).

OTOH, you have to put the path of the context in context.xml, which is not clean
(and should be infered from the context resource name). But this can be saved
for a future release.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48222</commentid>
    <comment_count>7</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2003-11-27 00:09:21 +0000</bug_when>
    <thetext>Hello,

In my example I have installed a directory app myapps with a separate 
myapps.xml
context file. In my context I have configured three AccessLogValves. Ohh, this 
example is a demo  .

With one AccessLogValve the install,remove, install cycle work correct. 

I look at the VavleBase.createObjectName() and the see following

L 278ff
        Pipeline pipe=containerBase.getPipeline();
        Valve valves[]=pipe.getValves();

and
L311

    int seq=0;
        for( int i=0; i&lt;valves.length; i++ ) {
            // Find other valves with the same name
            if( valves[i]!=null &amp;&amp;
                    valves[i].getClass() == this.getClass() &amp;&amp;
                    valves[i] != this ) {
                log.debug("Duplicate " + valves[i] + " " + this + " " + 
container);
                seq++;
            }
        }
        String ext="";
        if( seq &gt; 0 ) {
            ext=",seq=" + seq;
        }

I thing the StandardPipeline has all valves at startup. This means that all 
valves registered with the seq=2 part.

With stop the StandardPipeLine the first Valve is unregistered and the next 
AccessLogValve has a probleme as reported.

Peter


</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48224</commentid>
    <comment_count>8</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-11-27 00:30:14 +0000</bug_when>
    <thetext>Ah, ok, I didn't think about this case. So I guess I can't always understand
you, but it's a good catch, the sequence alg was indeed bad (it is now fixed).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48302</commentid>
    <comment_count>9</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-11-29 13:44:46 +0000</bug_when>
    <thetext>*** Bug 25082 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>9311</attachid>
            <date>2003-11-26 20:53:00 +0000</date>
            <delta_ts>2003-11-26 20:53:54 +0000</delta_ts>
            <desc>Example Application with catalina.base configuration</desc>
            <filename>example.zip</filename>
            <type>application/octet-stream</type>
            <size>48260</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>25079</bug_id>
          
          <creation_ts>2003-11-29 07:49:00 +0000</creation_ts>
          <short_desc>Tomcat 5.0.14 classloader bug</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.14</version>
          <rep_platform>Other</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Geert Bevin">gbevin</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>olsok</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>48294</commentid>
    <comment_count>0</comment_count>
    <who name="Geert Bevin">gbevin</who>
    <bug_when>2003-11-29 07:49:50 +0000</bug_when>
    <thetext>I think I've stumbled into a bug in the webapp classloader in Tomcat 5.0.14.

Consider the following servlet, which I mapped to /* for testing convenience.

import java.io.*;
import java.net.URL;
import javax.servlet.ServletException;
import javax.servlet.http.*;

public class Test extends HttpServlet
{
    public void service(HttpServletRequest req, HttpServletResponse res)
    throws ServletException, IOException
    {
        PrintWriter out = res.getWriter();
        URL rsrc = getClass().getResource("Test.class");
        String tst = rsrc.toString()+" : "+
            rsrc.openStream()+" : "+
            getClass().getResourceAsStream("Test.class");
        out.println(tst);
        out.close();
    }
}


When I put the compiled class file in ROOT/WEB-INF/classes
and visit http://localhost:8080/ after a server startup, I get the following page:

file:/jakarta-tomcat-5.0.14/webapps/ROOT/WEB-INF/classes/Test.class :
java.io.BufferedInputStream@6a3960 : java.io.ByteArrayInputStream@1dccedd


When I create a jar file with just that class inside, put it in ROOT/WEB-INF/lib
(after removing everything from ROOT/WEB-INF/classes before) and visit
http://localhost:8080/ after a server restart, I get the following page:

HTTP Status 500 -
type Exception report
message
description The server encountered an internal error () that prevented it from
fulfilling this request.
exception
java.io.FileNotFoundException:
/jakarta-tomcat-5.0.14/work/Catalina/localhost/_/loader/Test.class
(No such file or directory)
java.io.FileInputStream.open(Native Method)
java.io.FileInputStream.(FileInputStream.java:106)
java.io.FileInputStream.(FileInputStream.java:66)
sun.net.www.protocol.file.FileURLConnection.connect(FileURLConnection.java:69)
sun.net.www.protocol.file.FileURLConnection.getInputStream(FileURLConnection.java:156)
java.net.URL.openStream(URL.java:913)
Test.service(Test.java:13)
javax.servlet.http.HttpServlet.service(HttpServlet.java:856)

The openStream() method has thrown this exception, and the
getResourceAsStream("Test.class") method returns null.

There's clearly something wrong here, since the file is indeed not available on
that location. The work directory
"/jakarta-tomcat-5.0.14/work/Catalina/localhost/_" just contains one file:
"tldCache.ser" and no directory "loader" at all.

I've looked through the sources and found some things in
org.apache.catalina.loader.WebappClassLoader.

On line 552, the following is done:

public void setWorkDir(File workDir) {
    this.loaderDir = new File(workDir, "loader");
}

Which is where the "loader" directory comes from.

On line 1085, the following is done:

if (repository.endsWith(".jar")) {
    // Copy binary content to the work directory if not present
    File resourceFile = new File(loaderDir, name);
    url = resourceFile.toURL();
}

On line 1814, I found this:

// Extract resources contained in JAR to the workdir
if (!(path.endsWith(".class"))) {
    byte[] buf = new byte[1024];
    File resourceFile = new File
        (loaderDir, jarEntry.getName());
    if (!resourceFile.exists()) {
    ...

To me it seems that the code on line 1085 assumes that the code on line 1814 has
already been executed before, somehow this isn't the case which leads to
unretrieval resources when they are stored in jar files.

I hope I identified this issue correctly and that it can be fixed for the next
release.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48297</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-11-29 09:09:15 +0000</bug_when>
    <thetext>Fixed. This report is bad, however, so if the fox wasn't trivial, it would have
been a WONTFIX: whatever you are trying to do is likely very wrong. I wonder how
you didn't come up with a patch. Mine was:

diff -r1.26 WebappClassLoader.java
1085c1085,1086
&lt;                 if (repository.endsWith(".jar")) {
---
&gt;                 if ((repository.endsWith(".jar")) 
&gt;                     &amp;&amp; (!(name.endsWith(".class")))) {
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48305</commentid>
    <comment_count>2</comment_count>
    <who name="Geert Bevin">gbevin</who>
    <bug_when>2003-11-29 17:12:49 +0000</bug_when>
    <thetext>Thanks for the fix. I didn't submit any patch since it's the first time I look
at tomcat's source code and have no idea of the global scope.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48308</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-11-29 18:53:24 +0000</bug_when>
    <thetext>*** Bug 25088 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>25138</bug_id>
          
          <creation_ts>2003-12-02 13:41:00 +0000</creation_ts>
          <short_desc>[PATCH] Can't store web application context with admintool.</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter>toraneko</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>bugzilla</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>48383</commentid>
    <comment_count>0</comment_count>
    <who name="">toraneko</who>
    <bug_when>2003-12-02 13:41:37 +0000</bug_when>
    <thetext>Admin tools have a following problem. When I change Application Context and
store it's configuration with other than iso-8859-1, the configuration file
($CATALINA_HOME/conf/Catalina/localhost/*) would be broken. The cause is
StandardServer don't open file with utf-8 neither write xml header encoding.

I wrote patch for this problem. Please took following patch and fix problem
until tomcat5 final release.

http://yamaguch.sytes.net/~tora/tmp/StandardServer.java.1.22.diff


regards,

Takashi Okamoto</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48388</commentid>
    <comment_count>1</comment_count>
    <who name="TANAKA Yoshihiro">bugzilla</who>
    <bug_when>2003-12-02 15:17:44 +0000</bug_when>
    <thetext>I also encountered this issue.
When I describe &lt;display-name&gt; in web.xml by UTF-8(or our native encoding),
the admin tool copies it to $CATALINA_HOME/conf/Catalina/localhost/*.xml
without the encoding specification.
Finally, Tomcat fails to startup the context. 

Regards.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48406</commentid>
    <comment_count>2</comment_count>
    <who name="Kazuhiro Kazama">kazama</who>
    <bug_when>2003-12-03 05:44:14 +0000</bug_when>
    <thetext>In StandardServer.java, storeResources method has already been fixed as changes that Okamoto-
san proposed. The storeContext method should also be fixed ASAP.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48435</commentid>
    <comment_count>3</comment_count>
    <who name="Amy Roh">amyroh</who>
    <bug_when>2003-12-03 18:54:28 +0000</bug_when>
    <thetext>The patch is applied.  Thanks for the report and patch.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>25160</bug_id>
          
          <creation_ts>2003-12-03 12:41:00 +0000</creation_ts>
          <short_desc>[PATCH] improve I18N for admintool</short_desc>
          <delta_ts>2005-03-05 04:39:54 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Administration</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter>toraneko</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>9</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>48414</commentid>
    <comment_count>0</comment_count>
    <who name="">toraneko</who>
    <bug_when>2003-12-03 12:41:58 +0000</bug_when>
    <thetext>I send admintools I18N improve patch for tomcat4.1.x. This patch
improve more about I18N. This patch improve following problem:

   + The left frame wasn't internationalized.
   + Some of the word in right frame weren't internationalized.
   + Some one miss understand
       MessageResource.getString(java.lang.Locale locale, java.lang.String
		                 key ..)
     API. ex. resources.getString("mssage", locale);

I modified English and Japanese ApplicationResources property
files. However I don't know how can I tranlate for Esperanto. So I
added TODO comment in ApplicationResources_es.properties.


Please take following patch.

  http://yamaguch.sytes.net/~tora/tmp/tomcat5-admin-i18n.patch

and 

 + add ApplicationResources.properties

  http://yamaguch.sytes.net/~tora/tmp/ApplicationResources.properties

  * this file is delived from ApplicationResources_en.properties.

 + remove ApplicationResources_en.properties.

One more ask here. SetCharacterEncodingFilter is commented. This means
other than English people must modify web.xml for input thier own
character. I would like to uncommend SetCharacterEncodingFilter and
set default encoding to utf-8. utf-8 is upper compatible with
iso-8859-1 and most of people won't be affected by utf-8. I would like
to recommend it to conviniency for non English user.

regards,

Takashi Okamoto</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53454</commentid>
    <comment_count>1</comment_count>
    <who name="Amy Roh">amyroh</who>
    <bug_when>2004-03-04 18:47:16 +0000</bug_when>
    <thetext>Thanks for the patch.  Let me know if I missed anything.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>71862</commentid>
    <comment_count>2</comment_count>
    <who name="Santiago Gala">sgala</who>
    <bug_when>2005-03-05 13:39:54 +0000</bug_when>
    <thetext>FYI, es is Spanish, (Español), not esperanto.

Just comment that I'm seeing tomcat-5.0.28 fail on a utf-8 filesystem due to ant
being unable to move .properties files around. it is due to ISO-8859 files for
_es.properties and _fr.properties being unreadable
(sun.in.MalformedInputException) when locale is *.UTF-8</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>25193</bug_id>
          
          <creation_ts>2003-12-04 09:52:00 +0000</creation_ts>
          <short_desc>Wrong Content-Length in POST could cause information leakage / misbehaviour</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Tester</component>
          <version>5.0.16</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Christian Hufgard">christian.hufgard</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>48466</commentid>
    <comment_count>0</comment_count>
    <who name="Christian Hufgard">christian.hufgard</who>
    <bug_when>2003-12-04 09:52:34 +0000</bug_when>
    <thetext>Hi, since we had some strange behaviour according to some parts of our software, 
we found something in Tomcat 4.1.18, 4.2.25 and 5.0.16 (guess so, also on lot of 
other versions..)
If a POST-request sends a wrong Content-length (too large), Tomcat does not send 
a HTTP 400 Code but continues to process the request. This is no really problem 
so far, since all parameters whith the POST-request are still read in a correct 
matter.

But if the client cuts the connection (presses the abort-button, goes offline, 
anyway..) Tomcat uses data from previous request to get the given 
content-length. (Seems the buffer is not cleared correctly). This could lead to 
some critical information leakage on client side, if paramters are bounced back 
to client (e.g. preview-functions in guestbooks, forums, ...) and can also some 
really strange behaviour if you use this information to generate and send an 
email. So content from other "mails" is taken and filled into a new mail.

Is there any workaround known?


Greetz

Christian</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48467</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-12-04 10:10:21 +0000</bug_when>
    <thetext>I don't agree with this report. All the fields will be properly cleared at the
end of the request processing, including the content length. There's also now a
limitation on the content length which is accepted by Tomcat when parsing
parameters using getParameter.
If you want to reopen this, please submit a sequence of requests producing the
bug (using za telnet).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48469</commentid>
    <comment_count>2</comment_count>
    <who name="Christian Hufgard">christian.hufgard</who>
    <bug_when>2003-12-04 10:50:04 +0000</bug_when>
    <thetext>Have to correct me: Since this only occurs if the connection is closed, no 
information from other requests can leak to the client directly.

Here the steps to reproduce this behaviour:

whith this jsp the problem can be prepared, just fill in some values and call it 
a few times...
[code]
&lt;HTML&gt;
&lt;BODY&gt;
&lt;FORM action="showIt.jsp" method="post"&gt;
&lt;BR&gt;&lt;BR&gt;
&lt;%
  for (int i = 0; i &lt; 10; i++) {
%&gt;
  value &lt;%=i%&gt; &lt;input type="text" name="&lt;%=i%&gt;" length="30"&gt; &lt;br&gt;
&lt;%
  }
%&gt;
&lt;INPUT TYPE="SUBMIT" NAME="Submit" VALUE="Submit"&gt;
&lt;/FORM&gt;
&lt;/BODY&gt;
&lt;/HTML&gt;
[/code]


showIt.jsp simply writes all parameter set in the request to System.out:
[code]
&lt;%@page import="java.util.Enumeration"%&gt;
&lt;%
  Enumeration names = request.getParameterNames();
  String name;
  String value;
  System.out.println("====================");
  while (names.hasMoreElements()) {
    name = (String)names.nextElement();
    value = request.getParameter(name);
    System.out.println("showIt.jsp\t"+name+"="+value);
  }
  System.out.println("====================");
%&gt;
[/code]



Finally the java-Class that has to be run to show the problem: Just call it 
several times and look at catalina.out.
[code]
import java.net.*;
import java.io.*;

public class DamagedPostRequest {

  public DamagedPostRequest(String servername, int port, String webapps, int 
length) throws Exception {
    String request = "POST "+webapps+"showIt.jsp HTTP/1.1\n"
                    +"Host: "+servername, +"n"
                    +"Content-type: application/x-www-form-urlencoded\n"
                    +"Content-length: "+length+"\n"
                    +"\n";

    Socket s = new Socket(InetAddress.getByName(servername), port);
    OutputStream out = s.getOutputStream();
    out.write(request.getBytes());
    out.close();
  }

  public static void main(String[] args) throws Exception  {
    DamagedPostRequest damagedPostRequest2 = new DamagedPostRequest("localhost", 
8080, "/", 1000);
  }
}
[/code]</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48483</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-12-04 13:56:59 +0000</bug_when>
    <thetext>There's a basic defect in the code which reads the request body. If there's a
disconnect, then the full array could be parsed, although some of its data is
bad. This will occur only for small posts (&lt; 8KB).
I suggest trying out this patch for a possible fix (if a bad read occurs, no
parameters will be parsed, which is the most reliable behavior; I think the
asumption of the alg is that there would be an IOE being thrown if there's a
client disconnect):

RCS file:
/home/cvs/jakarta-tomcat-catalina/catalina/src/share/org/apache/coyote/tomcat5/CoyoteRequest.java,v
retrieving revision 1.25
diff -r1.25 CoyoteRequest.java
2371,2372c2371,2374
&lt;                 readPostBody(formData, len);
&lt;                 parameters.processParameters(formData, 0, len);
---
&gt;                 int actualLen = readPostBody(formData, len);
&gt;                 if (actualLen == len) {
&gt;                     parameters.processParameters(formData, 0, len);
&gt;                 }
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>25199</bug_id>
          
          <creation_ts>2003-12-04 13:29:00 +0000</creation_ts>
          <short_desc>Mapper throws NullPointerException, if no DefaultServlet is defined</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:HTTP</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P5</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Torsten Fohrer">tfohrer</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>48480</commentid>
    <comment_count>0</comment_count>
    <who name="Torsten Fohrer">tfohrer</who>
    <bug_when>2003-12-04 13:29:20 +0000</bug_when>
    <thetext>TestCase:
 1. remove DefaultServlet from conf/web.xml 
 2. create/deploy a context with welcome-resources
 3. try to access this context


Index: Mapper.java
===================================================================
RCS file:
/home/cvspublic/jakarta-tomcat-connectors/util/java/org/apache/tomcat/util/http/mapper/Mapper.java,v
retrieving revision 1.30
diff -u -w -b -r1.30 Mapper.java
--- Mapper.java 21 Aug 2003 01:20:39 -0000      1.30
+++ Mapper.java 4 Dec 2003 13:22:03 -0000
@@ -708,7 +708,7 @@
                         if (file != null &amp;&amp; !(file instanceof DirContext) ) {
                             internalMapExtensionWrapper(extensionWrappers,
                                                         path, mappingData);
-                            if (mappingData.wrapper == null) {
+                            if (mappingData.wrapper == null &amp;&amp;
context.defaultWrapper != null) {
                                 mappingData.wrapper =
                                     context.defaultWrapper.object;
                                 mappingData.requestPath.setChars</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48481</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-12-04 13:39:33 +0000</bug_when>
    <thetext>You should never remove the default servlet: it has the lowest priority, so
whether it is there or not should not have any impact on your application. A
default servlet defined in your application will also override Tomcat's default
servlet.
I am willing to apply your fix for cosmetic reasons.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48491</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-12-04 14:38:55 +0000</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>25234</bug_id>
          
          <creation_ts>2003-12-05 08:44:00 +0000</creation_ts>
          <short_desc>HttpSessionListener called twice on session expiration</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.16</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Paul Harvey">Paul.Harvey</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>alex_verk</cc>
    
    <cc>rpr</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>48549</commentid>
    <comment_count>0</comment_count>
    <who name="Paul Harvey">Paul.Harvey</who>
    <bug_when>2003-12-05 08:44:52 +0000</bug_when>
    <thetext>HttpSessionListener called twice on session expiration.

After a (quick!) look at the source it seems to be being caused as 
processExpires (StandardManager.java) loops through the sessions calling 
isValid (StandardSession.java) on each.  Then isValid itself looks for timed 
out sessions and calls expires (StandardSession.java) where relevant which 
calls the listeners.  However then isValid returns (false) back to 
processExpires which then itself calls expire and so the listeners are fired a 
second time.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48554</commentid>
    <comment_count>1</comment_count>
    <who name="Paul Harvey">Paul.Harvey</who>
    <bug_when>2003-12-05 09:23:00 +0000</bug_when>
    <thetext>I've just commented out the call to session.expire() in 
processExpires() - the listeners are now only called once.  However this is 
pretty naive - I have not traced things through to see if this will have any 
other undesirable side effects.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48555</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-12-05 09:29:57 +0000</bug_when>
    <thetext>This sounds reasonable. The session expiration code hadn't been changed from
Tomcat 4.1, while isValid actually expires sessions when it is called (in TC
4.1, it didn't). This is obviously very easy to fix, and your fix seems logical.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49285</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-12-17 21:56:35 +0000</bug_when>
    <thetext>*** Bug 25600 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53071</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-26 22:54:15 +0000</bug_when>
    <thetext>*** Bug 27273 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>25263</bug_id>
          
          <creation_ts>2003-12-06 22:44:00 +0000</creation_ts>
          <short_desc>Incorrect SMAP generated for JSP</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.16</version>
          <rep_platform>Other</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Todd Williams">todd</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>48625</commentid>
    <comment_count>0</comment_count>
    <who name="Todd Williams">todd</who>
    <bug_when>2003-12-06 22:44:16 +0000</bug_when>
    <thetext>Below is an example SMAP, JSP, and generated Java file that demonstrate an 
error in the SMAP generation.

The test JSP (with line numbers) looks like this:

01  &lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
02  &lt;%@ page language="java" import="java.lang.*,java.util.*" %&gt;
03  &lt;%
04  String path = request.getContextPath();
05  String basePath = "http://"+request.getServerName()
06  +":"+request.getServerPort()+path+"/";
07  %&gt;
08  &lt;HTML&gt;
09    &lt;HEAD&gt;
10      &lt;BASE HREF="&lt;%=basePath%&gt;"&gt;     
11      &lt;TITLE&gt;My JSP 'TestJSP.jsp' starting page&lt;/TITLE&gt;
12    &lt;/HEAD&gt;
13
14      &lt;BODY&gt;
15        &lt;% 
16          Date date = new Date(); 
17          out.println("Current time is: " + date);
18          out.println(".  ");
19          date = new Date(); 
20          out.println("Now the time is " + date);
21          out.println(".  ");
22        %&gt;
23        &lt;BR&gt;This is my test JSP page. &lt;BR&gt;
24      &lt;/BODY&gt;
25  &lt;/HTML&gt;

The SMAP generated is as follows:

SMAP
TomcatTestJSP_jsp.java
JSP
*S JSP
*F
+ 0 TomcatTestJSP.jsp
TomcatTestJSP.jsp
*L
1,3:42
4,3:44
6,4:47
9:48,2
10,5:50
15,7:51
21,5:58
*E

The mapping of 10,5:50 is erroneous. It is both the wrong area within the 
generated java file, and it overlaps with the subsequent correct mapping of the 
embedded java scriptlet at 15,7:51.

Here's the generated java file to which I added line number comments for 
illustration:

package org.apache.jsp;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import java.lang.*;
import java.util.*;

public final class TomcatTestJSP_jsp extends 
org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static java.util.Vector _jspx_dependants;

  public java.util.List getDependants() {
    return _jspx_dependants;
  }

  public void _jspService(HttpServletRequest request, HttpServletResponse 
response)
        throws java.io.IOException, ServletException {

    JspFactory _jspxFactory = null;
    PageContext pageContext = null;
    HttpSession session = null;
    ServletContext application = null;
    ServletConfig config = null;
    JspWriter out = null;
    Object page = this;
    JspWriter _jspx_out = null;


    try {
      _jspxFactory = JspFactory.getDefaultFactory();
      response.setContentType("text/html");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("&lt;!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 
Transitional//EN\"&gt;\r\n\r\n"); // line number 42

String path = request.getContextPath(); // line 44
String basePath = "http://"+request.getServerName()+":"+request.getServerPort()
+path+"/"; // line 45

      out.write("\r\n&lt;HTML&gt;\r\n\t&lt;HEAD&gt;\r\n\t\t&lt;BASE HREF=\""); //line 47
      out.print(basePath); // line 48
      out.write("\"&gt;\t\t\r\n\t\t&lt;TITLE&gt;My JSP 'TestJSP.jsp' starting 
page&lt;/TITLE&gt;\r\n\t&lt;/HEAD&gt;\r\n\r\n\t&lt;BODY&gt;\r\n\t  "); // line 49
 
	  	Date date = new Date(); // line 51
	  	out.println("Current time is: " + date); // line 52
      out.println(".  "); // line 53
      date = new Date();  // line 54
      out.println("Now the time is " + date); // line 55
      out.println(".  "); // line 56
	  
      out.write("\r\n\t\t&lt;BR&gt;This is my test JSP page. 
&lt;BR&gt;\r\n\t&lt;/BODY&gt;\r\n&lt;/HTML&gt;\r\n");
    } catch (Throwable t) {
      if (!(t instanceof SkipPageException)){
        out = _jspx_out;
        if (out != null &amp;&amp; out.getBufferSize() != 0)
          out.clearBuffer();
        if (pageContext != null) pageContext.handlePageException(t);
      }
    } finally {
      if (_jspxFactory != null) _jspxFactory.releasePageContext(pageContext);
    }
  }
}

From this code, the lines 10-14 in the JSP should be mapped only to line 49 
(like 10,5:49,0), but not to 50-54 as the 10,5:50 mapping dictates.  This is 
certainly not the only time we've seen problems with this latest release, but 
this is one of the smallest test cases we could produce.

For the record, the mappings in the previous version we tested, 5.0.12 were 
correct and are reproduced below. 

SMAP
TomcatTestJSP_jsp.java
JSP
*S JSP
*F
+ 0 /TomcatTestJSP.jsp
TomcatTestJSP.jsp
*L
1,2:42
4,3:45
6,2:48
8:49,2
9:50,4
10:53,3
11:55,2
12:56
13:56,2
14:57
15,7:59
21:66
22:66,3
23:68,2
24:70
*E

Although the output lines are different, due to changes in the JSP to Java 
translation, you'll note that the lines prior to line 15 are properly generated 
to previous lines in the java file in a non-overlapping manner with the 15,7:59 
mapping, which is where the next java block begins.  This problem with the SMAP 
currently prevents IDE's from properly supporting source-level JSP debugging.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48654</commentid>
    <comment_count>1</comment_count>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-12-08 00:11:38 +0000</bug_when>
    <thetext>I think the problem is that when Jasper SMAPs a TemplateText node, it assumes 
that when the input source line advances, the output source line advances as 
well.  In 5.0.12, Jasper advanced the input source line and the output source 
line independently, and so SMAPped TemplateText nodes correctly.  I've been 
meaning to fix this regression since it was introduced, but I've been slammed 
with work, and so haven't had time.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48703</commentid>
    <comment_count>2</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-12-09 00:03:06 +0000</bug_when>
    <thetext>Argh!  When I concatenated adjecent template text strings, I forgot to update
the smap too!  I'll try to fix this.  In the meantime, use the compiler option
'mappedfile' as a workaround, which you may want to do anyway when debugging.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48704</commentid>
    <comment_count>3</comment_count>
    <who name="Todd Williams">todd</who>
    <bug_when>2003-12-09 00:54:06 +0000</bug_when>
    <thetext>The suggested workaround of setting mappedfile to true works perfectly, once 
all the previously compiled JSP state is removed from the Tomcat work 
directory.  Thank you very much for the suggestion.

By the way, the default Tomcat settings are basically set up for debugging, 
except for mappedfile.  For example, checkInterval, classdebuginfo, 
development, keepgenerated, reloading are all set to development/debug settings 
by default.  Is there some special reason that mappedfile is not set 
accordingly?  Should it be?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48708</commentid>
    <comment_count>4</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-12-09 02:54:31 +0000</bug_when>
    <thetext>Maybe it should.  Come to think of it, we should just set a single flag, such as
'development', to turn on/off debugging.  So setting development would set some
reasbable default for checkInterval, classdebuginfo, development, keepgenerated,
reloading, and mappedfile.  What do you think?

Anyway, this bug is fixed now.

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48709</commentid>
    <comment_count>5</comment_count>
    <who name="Todd Williams">todd</who>
    <bug_when>2003-12-09 03:23:45 +0000</bug_when>
    <thetext>I think a global flag that set some reasonable debug settings would be 
fantastic and make configuration much simpler.

And, thanks for fixing the bug. :-)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48724</commentid>
    <comment_count>6</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-12-09 10:03:06 +0000</bug_when>
    <thetext>I don't agree with merging the debug parameters, as they impact different
things. For instance, to use mappedfile, you had to remove the old generated
JSPs. The development flag OTOH will be used right away.

For production, the only real setting is to precompile the JSPs. Everything else
is not relevant and you can use the defaults (avoid enabling the background
compilation thread, of course ;-) ).

I think the defaults should be tweaked a bit:
- mappedfile should be true by default in the "normal" Jasper (as development is
true)
- mappedfile should be false by default when precompiling
Other defaults could be adjusted like this, with the general intent being what
you want (but without a super "dev" flag).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48733</commentid>
    <comment_count>7</comment_count>
    <who name="Todd Williams">todd</who>
    <bug_when>2003-12-09 15:08:20 +0000</bug_when>
    <thetext>That sounds reasonable.  Just getting mappedfile to default true, since 
debugging is on anyway would be great.  I agree that the additional flexibility 
of the current model certainly has its place.  Nice compromise. +1 (as if I get 
to vote here ;-)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48739</commentid>
    <comment_count>8</comment_count>
    <who name="Eric Carmichael">ecarmich</who>
    <bug_when>2003-12-09 16:23:19 +0000</bug_when>
    <thetext>Just from looking at the code for the fix, I think it will still give the 
wrong SMAP for TemplateText nodes longer than JspUtil.CHUNKSIZE.  
Generator.java advances the output line when JspUtil.CHUNKSIZE is exceeded, so 
the SMAPping code should too.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>25415</bug_id>
          
          <creation_ts>2003-12-10 17:54:00 +0000</creation_ts>
          <short_desc>in JSTL fmt Multiple setLocale work is not compatible JSTL 1.1 specif</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.16</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="William Wang">william</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>pierre.delisle</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>48838</commentid>
    <comment_count>0</comment_count>
    <who name="William Wang">william</who>
    <bug_when>2003-12-10 17:54:08 +0000</bug_when>
    <thetext>in JSTL 1.1 spec 8.3.2 about multiple setlocale work explain.
but in tomcat 5.0.16.in one jsp multiple setlocale ,the output html page is not 
work in purpose.

same jsp work in tomcat 4.x ,work fine.so this is a critical bug.

produce steps:
1.create two properties one is:Directory.properties,other is 
Directory_zh_CN.properties.
2.write a jsp with follow code:
 &lt;f:setLocale value="en"/&gt;
&lt;f:setBundle basename="Directory"/&gt;
Name:&lt;f:message key="name"/&gt;
Sex:&lt;f:message key="sex"/&gt;
&lt;hr&gt;follow is chinese
&lt;f:setLocale value="zh_CN"/&gt;
&lt;f:setBundle basename="Directory" /&gt;
Name:&lt;f:message key="name"/&gt;
Sex:&lt;f:message key="sex"/&gt;

3.see output .</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48839</commentid>
    <comment_count>1</comment_count>
      <attachid>9501</attachid>
    <who name="William Wang">william</who>
    <bug_when>2003-12-10 18:01:34 +0000</bug_when>
    <thetext>Created attachment 9501
Whole test war.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48840</commentid>
    <comment_count>2</comment_count>
      <attachid>9502</attachid>
    <who name="William Wang">william</who>
    <bug_when>2003-12-10 18:02:44 +0000</bug_when>
    <thetext>Created attachment 9502
Work Correctly in Tomcat 4.1.3 snapshot</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48849</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-12-10 18:52:56 +0000</bug_when>
    <thetext>Thanks for the test case. Seeing what it does, I expect it is a JSTL bug (or
maybe this is not allowed, and worked by accident rather than by design).
Disabling tag pooling makes this work (unsurprisingly), so you have an easy
workaround.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48880</commentid>
    <comment_count>4</comment_count>
    <who name="William Wang">william</who>
    <bug_when>2003-12-11 03:04:46 +0000</bug_when>
    <thetext>Disabled tag pooling,no effect.still same before.
modifyed %TOMCAT_HOME%\conf\web.xml
   &lt;servlet&gt;
        &lt;servlet-name&gt;jsp&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.apache.jasper.servlet.JspServlet&lt;/servlet-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;fork&lt;/param-name&gt;
            &lt;param-value&gt;false&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;xpoweredBy&lt;/param-name&gt;
            &lt;param-value&gt;false&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;enablePooling&lt;/param-name&gt;
            &lt;param-value&gt;false&lt;/param-value&gt;
        &lt;/init-param&gt;        
        &lt;load-on-startup&gt;3&lt;/load-on-startup&gt;
    &lt;/servlet&gt;

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48885</commentid>
    <comment_count>5</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-12-11 09:41:42 +0000</bug_when>
    <thetext>This does work. However, you need to remove your work directory (or only the
generated JSP if you know what you're doing) to force a recompilation of the JSP.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48940</commentid>
    <comment_count>6</comment_count>
    <who name="Pierre Delisle">pierre.delisle</who>
    <bug_when>2003-12-11 23:07:28 +0000</bug_when>
    <thetext>William,

If you are working with a JSP 2.0 container (which Tomcat 5.x is), I suggest you
use a JSTL 1.1 implementation. I have tested your page with Tomcat 5.0.16 and
standard-1.1.0-B1, and everything worked fine.

Here is what you'll have to do:

  1. Modify the JSTL URIs:

       from: &lt;%@ taglib uri="http://java.sun.com/jstl/fmt" prefix="f" %&gt;
         to: &lt;%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="f" %&gt;

  2. Change your web.xml so it is servlet 2.4 based:

       from:
&lt;!DOCTYPE web-app
    PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
    "http://java.sun.com/dtd/web-app_2_3.dtd"&gt;
         to:
&lt;web-app xmlns="http://java.sun.com/xml/ns/j2ee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee web-app_2_4.xsd"
    version="2.4"&gt;

      from:
  &lt;context-param&gt;
    &lt;param-name&gt;javax.servlet. jsp.jstl.fmt.localizationContext&lt;/param-name&gt;
    &lt;param-value&gt;Directory&lt;/param-value&gt;
    &lt;description&gt;èµ„æº&#144;æ–‡ä»¶&lt;/description&gt;
  &lt;/context-param&gt;
      to:
  &lt;context-param&gt;
    &lt;description&gt;èµ„æº&#144;æ–‡ä»¶&lt;/description&gt;
    &lt;param-name&gt;javax.servlet. jsp.jstl.fmt.localizationContext&lt;/param-name&gt;
    &lt;param-value&gt;Directory&lt;/param-value&gt;
  &lt;/context-param&gt;
       
  3. Use the standard-1.1-B1 jars

     get rid of the jar files in your WEB-INF/lib directory, and copy
     standard.jar and jstl.jar from stardard-1.1-B1.

If you could confirm that this works for you, and then close the bug, that would
be great.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48957</commentid>
    <comment_count>7</comment_count>
    <who name="William Wang">william</who>
    <bug_when>2003-12-12 05:49:51 +0000</bug_when>
    <thetext>yes.test ok.
close this bug.
</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>9501</attachid>
            <date>2003-12-10 18:01:00 +0000</date>
            <delta_ts>2003-12-10 18:01:34 +0000</delta_ts>
            <desc>Whole test war.</desc>
            <filename>utf.war</filename>
            <type>application/octet-stream</type>
            <size>661574</size>
            <attacher name="William Wang">william</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>9502</attachid>
            <date>2003-12-10 18:02:00 +0000</date>
            <delta_ts>2003-12-10 18:02:44 +0000</delta_ts>
            <desc>Work Correctly in Tomcat 4.1.3 snapshot</desc>
            <filename>tomcat4.jpg</filename>
            <type>image/jpeg</type>
            <size>169996</size>
            <attacher name="William Wang">william</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>25419</bug_id>
          
          <creation_ts>2003-12-10 18:31:00 +0000</creation_ts>
          <short_desc>property string "standardContext.resourcesStart" is missing</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.16</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jochen Schwoerer">j.schwoerer</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>j.schwoerer</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>48848</commentid>
    <comment_count>0</comment_count>
    <who name="Jochen Schwoerer">j.schwoerer</who>
    <bug_when>2003-12-10 18:31:00 +0000</bug_when>
    <thetext>The property string "standardContext.resourcesStart" is missing in the
org/apache/catalina/core/LocalStrings.properties file.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48920</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-12-11 17:28:43 +0000</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>25452</bug_id>
          
          <creation_ts>2003-12-11 18:48:00 +0000</creation_ts>
          <short_desc>JSP compile failure does not stop Ant build</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.16</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Larry Karnowski">larry</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>48923</commentid>
    <comment_count>0</comment_count>
    <who name="Larry Karnowski">larry</who>
    <bug_when>2003-12-11 18:48:17 +0000</bug_when>
    <thetext>When using Tomcat 5.0.16's org.apache.jasper.JspC class as a taskdef Ant tag, if
there is a failure in compiling a JSP file into a Java file, Ant does not know
about it.  Ant will continue the rest of the build regardless of any JSP compile
failures.  It might even report success depending on the rest of the build.

I would think that a failed JSP compile should halt the build similar to a
failed Java compile.  (Or at least have a failOnError option.)  What I see
instead is that any JSPs that fail to compile will cause JspC to write an error
message to the logging API and write out a zero-length Java file.  Ant, however,
just continues building after the JspC task is done.

I've seen JSPs not compile for the following reasons: bug #25488, a taglib or
JSP action tag is unbalanced, or because an include directive tries to include a
file that does not exist.  There are probably many other reasons a JSP would
fail to be parsed.

Workarounds include having a human check the log output of the JspC tag for
error messages or do a "find . -empty" to find zero-length Java files.

To solve this issue I recommend having JspC.execute() throw an
org.apache.tools.ant.BuildException on build errors.  This will work for both
the Ant build and when running from the commandline.  When running from the
command line the main() method can catch and handle the exception appropriately.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>48924</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2003-12-11 19:08:43 +0000</bug_when>
    <thetext>JspC has been modified to rethrow any exception raised during compilation, so
that should address your problem.  Please try the nightly build for Tomcat 5 to
see if that's good enough for you.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUILD_SYSTEM">BUILD_SYSTEM</bug_classification></bug>
    <bug>
          <bug_id>25493</bug_id>
          
          <creation_ts>2003-12-13 00:18:00 +0000</creation_ts>
          <short_desc>Need to have true RPC in the comm channel over cluster</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina:Cluster</component>
          <version>5.0.16</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Filip Hanik">fhanik</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>49041</commentid>
    <comment_count>0</comment_count>
    <who name="Filip Hanik">fhanik</who>
    <bug_when>2003-12-13 00:18:32 +0000</bug_when>
    <thetext>Need to send an ACK when a session is received</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49154</commentid>
    <comment_count>1</comment_count>
    <who name="Filip Hanik">fhanik</who>
    <bug_when>2003-12-15 21:34:09 +0000</bug_when>
    <thetext>Fixed on 12/15/2003, will be included in the next release of tomcat 5</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>25555</bug_id>
          
          <creation_ts>2003-12-16 05:41:00 +0000</creation_ts>
          <short_desc>SingleSignOn valve config doc missing 'requireReauthentication' attribute</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Documentation</component>
          <version>5.0.16</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Brian Stansberry">bstansberry</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>49175</commentid>
    <comment_count>0</comment_count>
    <who name="Brian Stansberry">bstansberry</who>
    <bug_when>2003-12-16 05:41:09 +0000</bug_when>
    <thetext>The configuration doc page does not include the new "requireReauthentication" 
attribute recently added to the SingleSignOn valve.  The attribute was added 
as part of a patch to bug 23881 that I wrote.

I'm embarrassed to file a bug report for this, as I should have included the 
docs in the original patch.  I just now figured out where the docs pages are 
in the source tree.

Patch to follow</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49176</commentid>
    <comment_count>1</comment_count>
      <attachid>9597</attachid>
    <who name="Brian Stansberry">bstansberry</who>
    <bug_when>2003-12-16 05:42:36 +0000</bug_when>
    <thetext>Created attachment 9597
Patch to /webapps/docs/config/valve.html</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49177</commentid>
    <comment_count>2</comment_count>
    <who name="">william.barker</who>
    <bug_when>2003-12-16 07:23:07 +0000</bug_when>
    <thetext>Patch committed. Thanks much!</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>9597</attachid>
            <date>2003-12-16 05:42:00 +0000</date>
            <delta_ts>2003-12-16 05:42:36 +0000</delta_ts>
            <desc>Patch to /webapps/docs/config/valve.html</desc>
            <filename>requireReauthentication-attrib.txt</filename>
            <type>text/plain</type>
            <size>1160</size>
            <attacher name="Brian Stansberry">bstansberry</attacher>
            

          </attachment>
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>25593</bug_id>
          
          <creation_ts>2003-12-17 15:31:00 +0000</creation_ts>
          <short_desc>allowLinking attribute value is not preserved or ignored after context is reloaded</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.16</version>
          <rep_platform>Sun</rep_platform>
          <op_sys>Solaris</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Vlad Ilyushchenko">vladislavi</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>49254</commentid>
    <comment_count>0</comment_count>
    <who name="Vlad Ilyushchenko">vladislavi</who>
    <bug_when>2003-12-17 15:31:03 +0000</bug_when>
    <thetext>&lt;Context path="/myapp" docBase="myapp" debug="0" privileged="true" 
crossContext="true" reloadable="true" allowLinking="true" &gt;

I have a link in "myapp/WEB-INF/classes/com" that points to a directory 
located on an NFS share. After tomcat starts up "myapp" works perfectly fine. 
After the application gets reloaded (either my the manager or because of the 
class file change) tomcat stops floowing the links for the application 
generating ClassNotFound exceptions.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49281</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-12-17 21:51:54 +0000</bug_when>
    <thetext>I'll try to look into it, but I'd like to point out this is not a major issue
even if it's valid. As a workaround, simply redeploy the webapp, which is not
very different from a reload anyway.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49289</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-12-17 22:39:42 +0000</bug_when>
    <thetext>This is now fixed.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>25599</bug_id>
          
          <creation_ts>2003-12-17 19:54:00 +0000</creation_ts>
          <short_desc>Cannot change the Java VM option in the Configure Tomcat utility</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Native:Integration</component>
          <version>5.0.16</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="John Curtin">curtinjt</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>49269</commentid>
    <comment_count>0</comment_count>
    <who name="John Curtin">curtinjt</who>
    <bug_when>2003-12-17 19:54:07 +0000</bug_when>
    <thetext>I'm running Tomcat 5 on a Windows XP system with at least 6 different JDKs.  I
have my JAVA_HOME environment variable set to reference the default instance,
the one I use most often.  During the initial installation, the Tomcat installer
asked me to point to the location of the JDK I wanted Tomcat to use, and it
pre-populated the field with the value of the JAVA_HOME variable.  This was
fine, so I left the value alone and continued the installation.  When I checked
the values in the Configure Tomcat tool, I saw that the Java VM option read
simply "java" rather than the value I had seen during installation.  If I try to
change this value, and point to a specific Java executable from a specific JDK
version, Tomcat will not start up.  The process dies almost as soon as I run it,
and it will not come back until I go into the Windows Registry and return the
Java VM value to just "java".   I can find no other way to specify which Java
version Tomcat uses after installation, and I can't verify that it is using the
one I selected during installation.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49274</commentid>
    <comment_count>1</comment_count>
    <who name="John Curtin">curtinjt</who>
    <bug_when>2003-12-17 20:25:42 +0000</bug_when>
    <thetext>Further testing reveals that Tomcat will always use the JVM referenced in the
Windows registry, regardless of the choice made during installation.  In my
case, this was C:\Program Files\Java\j2re1.4.2_02 -- it was installed along with
the Java 1.4.2 SDK.  If this JVM instance does not exist on the Windows
filesystem, the installer will still act like everything is okay -- asking if
you want Tomcat to use the JDK referenced by your JAVA_HOME environment variable
-- but when installation is complete, Tomcat *will not run*.  Tomcat needs to
actually use the JDK that the user specifies during or after installation, and
it needs to be able to run even if the silly JRE is not installed under
C:\Program Files.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49922</commentid>
    <comment_count>2</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-01-01 01:50:05 +0000</bug_when>
    <thetext>This is fixed now in the CVS, and will appear in 5.0.17.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>25603</bug_id>
          
          <creation_ts>2003-12-17 21:40:00 +0000</creation_ts>
          <short_desc>HTTPS Connector ignores truststoreFile attribute</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:Coyote</component>
          <version>5.0.16</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="John Curtin">curtinjt</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>49277</commentid>
    <comment_count>0</comment_count>
    <who name="John Curtin">curtinjt</who>
    <bug_when>2003-12-17 21:40:03 +0000</bug_when>
    <thetext>When setting up a Connector to create an SSL listen socket over HTTPS, the
truststoreFile attribute of the Connector element is ignored by Tomcat 5. 
Regardless of the file path set in the attribute, Tomcat will only recognize the
certificate authority trust store located in
%JAVA_HOME%\jre\lib\security\cacerts.  Setting an alternate location for the
trust store, as suggested in the Tomcat 5 documentation, has no effect.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49291</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-12-17 22:50:01 +0000</bug_when>
    <thetext>I think the implementation for configuring the truststore is missing, except for
is type.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49304</commentid>
    <comment_count>2</comment_count>
    <who name="">william.barker</who>
    <bug_when>2003-12-18 05:27:40 +0000</bug_when>
    <thetext>I'm marking as FIXED, since now the code matches the docs.  However, it should 
work fine in 5.0.16 as long as you explicity configure the truststorePass on 
the Connector.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>25610</bug_id>
          
          <creation_ts>2003-12-18 03:23:00 +0000</creation_ts>
          <short_desc>javadocs of TLV.validate() need</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlet &amp; JSP API</component>
          <version>5.0.16</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>http://java.sun.com/j2ee/1.4/docs/api/javax/servlet/jsp/tagext/TagLibraryValidator.html#validate(java.lang.String,%20java.lang.String,%20javax.servlet.jsp.tagext.PageData)</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>15703</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Felipe Leme">t5jtjj502</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>jan.luehe</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>49302</commentid>
    <comment_count>0</comment_count>
    <who name="Felipe Leme">t5jtjj502</who>
    <bug_when>2003-12-18 03:23:30 +0000</bug_when>
    <thetext>Excerpts from http://nagoya.apache.org/bugzilla/show_bug.cgi?id=15703 : 


------- Additional Comments From Jan Luehe 2003-12-15 17:54 -------

JSP.13.9.6 mentions that the "uri" parameter in TLV.validate()
corresponds to the taglib's uri in the XML view.

The javadocs of TLV.validate() describe the "uri" param as follows:

 @param uri the tag library's unique identifier
 
The JSP spec lead confirmed that the javadocs of TLV.validate() need
to be clarified to match the spec.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50379</commentid>
    <comment_count>1</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-01-12 00:15:01 +0000</bug_when>
    <thetext>This appears to be fixed.  Note that since the 2.0 spec is already final, 
reopening will simply result in closing it as WONTFIX.</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>25681</bug_id>
          
          <creation_ts>2003-12-21 22:06:00 +0000</creation_ts>
          <short_desc>HTTP request params lost when sent with a URL ending with a folder w/o '/' at the end of URL</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlet &amp; JSP API</component>
          <version>5.0.16</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Reshat Sabiq">sabiq</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>sabiq</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>49501</commentid>
    <comment_count>0</comment_count>
    <who name="Reshat Sabiq">sabiq</who>
    <bug_when>2003-12-21 22:06:59 +0000</bug_when>
    <thetext>Given a URL like:
http://www.ultranet.tv/site/web_hosting?l=tr
the request logged in J2EE 1.4 DR (Tomcat 5) is:
64.219.140.49 - - [21/Dec/2003:15:43:05 -0600] "GET /site/web_hosting/ 
HTTP/1.1" 200 7912
This apparently means that the request parameters have been lost while 
resolving the URL. 
If the request URL is modifed to http://www.ultranet.tv/site/web_hosting/?
l=tr, the log shows:
64.219.140.49 - - [21/Dec/2003:15:36:35 -0600] "GET /site/web_hosting/?l=tr 
HTTP /1.1" 200 7842
Thus, the request parameters are apparently preserved.
Unless the HTTP standards dictate that the request params in the first request 
should be lost, which i can't imagine to be the case, this is a bug.

P.S. In J2EE 1.4 Beta 2, the first request gets logged as follows:
64.219.140.49 - - [21/Dec/2003:15:47:00 -0600] "GET /site/web_hosting?l=tr 
HTTP/1.1" 302 -
64.219.140.49 - - [21/Dec/2003:15:47:00 -0600] "GET /site/web_hosting/?l=tr 
HTTP/1.1" 302 -
64.219.140.49 - - [21/Dec/2003:15:47:03 -
0600] "GET /site/web_hosting/index.jsp?l=tr HTTP/1.1" 200 7842
P.P.S. It appears that there has been an attempt to make processing of these 
URLs more efficient by avoiding 302 responses, and resolving to the final 
location internally. However, this bug was introduced in doing so. The fix is 
likely to be trivial for someone who is familiar with Tomcat architecture.

Thanks,
rs.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49513</commentid>
    <comment_count>1</comment_count>
    <who name="">william.barker</who>
    <bug_when>2003-12-22 03:22:24 +0000</bug_when>
    <thetext>This has already been fixed in the CVS.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>25703</bug_id>
          
          <creation_ts>2003-12-22 16:25:00 +0000</creation_ts>
          <short_desc>ExtendedLogValve use wrong filename after rotate or checkexits case</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.16</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Peter Rossbach">pr</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>49548</commentid>
    <comment_count>0</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2003-12-22 16:25:33 +0000</bug_when>
    <thetext>ExtendedLogValve use wrong dateFormater after rotate or checkexists
when used with fileDateFormat="yyyy-MM-dd-HH".

Example:
&lt;Valve className="org.apache.catalina.valves.ExtendedAccessLogValve"
                        directory="logs"
                        prefix="myapps_ext_access_log."
                        suffix=".txt"
                        pattern="date time c-ip x-H(remoteUser) cs-method cs-
uri-stem sc-status bytes c-dns cs(User-Agent) cs(Referer) x-S(Hello)" 
                        resolveHosts="false"
                        fileDateFormat="yyyy-MM-dd-HH"
            		condition="nolog" /&gt; 

I look at code base and found that the wrong formatter are used.
I switch to fileDateFormatter and it works (s. patch).

Peter</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49549</commentid>
    <comment_count>1</comment_count>
      <attachid>9663</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2003-12-22 16:26:35 +0000</bug_when>
    <thetext>Created attachment 9663
Fix wrong ExtendedAccessLogValve</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49570</commentid>
    <comment_count>2</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2003-12-22 20:36:14 +0000</bug_when>
    <thetext>Fixed thanks!</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>9663</attachid>
            <date>2003-12-22 16:26:00 +0000</date>
            <delta_ts>2003-12-22 16:26:35 +0000</delta_ts>
            <desc>Fix wrong ExtendedAccessLogValve</desc>
            <filename>ExtendedAccessLogValve.patch</filename>
            <type>text/plain</type>
            <size>1379</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>25774</bug_id>
          
          <creation_ts>2003-12-27 17:16:00 +0000</creation_ts>
          <short_desc>Documentation change needed for making unix daemon</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>Unknown</version>
          <rep_platform>PC</rep_platform>
          <op_sys>FreeBSD</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>http://jakarta.apache.org/tomcat/tomcat-5.0-doc/setup.html</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Lucas Holt">luke</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>49740</commentid>
    <comment_count>0</comment_count>
    <who name="Lucas Holt">luke</who>
    <bug_when>2003-12-27 17:16:25 +0000</bug_when>
    <thetext>The documentation tells users to run make for bulding the unix daemon, connectors, and other C/
C++ code throughout the tomcat project.

It would be helpful to point out that they must run the gnu make (gmake) command to get the 
compile to work instead of the native bsd make on freebsd systems.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49854</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2003-12-30 16:55:07 +0000</bug_when>
    <thetext>Added note to setup instructions as suggested.  Change will be reflected in 
next release and next web site update.</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>25787</bug_id>
          
          <creation_ts>2003-12-28 22:46:00 +0000</creation_ts>
          <short_desc>adding &lt;%@ attribute name="xxx" fragment="true" %&gt; won't be declared</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.16</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Kjeld Ingemann Poulsen">kip</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>49778</commentid>
    <comment_count>0</comment_count>
    <who name="Kjeld Ingemann Poulsen">kip</who>
    <bug_when>2003-12-28 22:46:20 +0000</bug_when>
    <thetext>When adding a new fragment to an existing tag-file, it will not apear in
the generated java class in org.apache....tag.web.name_tag.java file
until the server has been restarted.

My source===&gt;
&lt;?xml version='1.0' encoding='iso-8859-1' ?&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 
Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;

&lt;%@ attribute name="body"     fragment="true" %&gt;
&lt;%@ attribute name="leftmenu" fragment="true" %&gt;
&lt;%@ attribute name="topmenu"  fragment="true" %&gt;
========!

Last one has been added after testing the first two. But it can not be
used until i have restartede tomcat5.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49781</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-12-29 08:19:44 +0000</bug_when>
    <thetext>Since it's a tag, I have to assume you have to restart the webapp (use the manager).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50096</commentid>
    <comment_count>2</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-01-05 19:45:04 +0000</bug_when>
    <thetext>This actually works for me.

In Tomcat 5, any changes in a tagfile will trigger a recompilation of all the
.jsp pages that reference it, as well as the tagfile itself, so I don't see why
you need to restart TC.  Please include a test case if you still have problems.

Note also that the addition of &lt;%@ attribute name="xxx" fragment="true" %&gt; to
the tag file will not have any effect on the generated .class file, unless the
fragment is also used in the tagfile, with an &lt;jsp:invoke fragment="xxx"/&gt;. 
This is just an optimization.

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50097</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-05 19:51:11 +0000</bug_when>
    <thetext>Really ?
Since the tag is a webapp wide resource, I would have thought a restart of the
webapp would be needed (and desired for performance reasons).
If I put "development" to "false", are those checks still made ? Hopefully not
;-) (of course, it's still much better to precompile)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50101</commentid>
    <comment_count>4</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-01-05 20:30:15 +0000</bug_when>
    <thetext>Really, Remy.  :-)

TC5 uses the same mechanism for tracking depdendencies on (statically) included
files, tag files, and tld's.  It would be very inconvenient during development
to have to redeploy the webapp every time an included file or a tagfile is
modified.

The dependencies are considered only when a JSP page is referenced and we are
deciding whether the page needs to be recompiled, so when development is false,
they are totally out of the picture.  At least I hope they are.  ;)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50141</commentid>
    <comment_count>5</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-01-06 19:44:17 +0000</bug_when>
    <thetext>Reopen to change status</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50142</commentid>
    <comment_count>6</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-01-06 19:48:44 +0000</bug_when>
    <thetext>Upon a closer look, there is a bug after all.  Apologies to kip@kipon.dk (Kjeld
Ingemann Poulsen)

When compiling a tagfile, the cached TagInfo object was passed, even when the
tagfile has been modified.  This is now fixed.  Thanks for reporting.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>25792</bug_id>
          
          <creation_ts>2003-12-29 10:27:00 +0000</creation_ts>
          <short_desc>Session timeout implemented incorrectly</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.16</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ran Levy">ranlevy</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>ranlevy</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>49783</commentid>
    <comment_count>0</comment_count>
    <who name="Ran Levy">ranlevy</who>
    <bug_when>2003-12-29 10:27:32 +0000</bug_when>
    <thetext>Sessions expire even if they are accessed within the specified timeout
interval.  In our application it breaks application logic. I think that
bug report #20083 refers to this problem and offers a fix.

To reproduce:  Use the two files SessionTimeoutBug.java and web.xml to create
and deploy the bug-reproduction webapp, than direct browser to 
http://yourserver:8080/bug/SessionBugDemo, hit the URL on the page and wait for
timeouts.  The "interval" context parameter in web.xml defines an activity
interval in seconds and is set to 120 (every 120 seconds the browser sends a
"get" request to the server). The "session-timeout" config parameter is set to
3 minutes. Setting "interval" to 60 or lower shows a situation where the bug
has no effect.  

Actual result:  The first refresh behaves correctly (as the 120-second
interval falls within the 3 minutes timeout period) and the resulting history
page shows that the session is alive. The second refresh causes start of a new
session, and the webapp start-page is displayed instead of the session history 
page.  When "interval" is set to 60, however, the history page is displayed 
repeatedly, meaning that in this case the session never times out.

Expected result:  that the session would never time out for any "interval" which
is lower or equal to "session-timeout" (in this example - any interval up to
180 seconds). The history page should continue to be displayed and evolve, and
the start-page should not be displayed after the demo app has begun.

I used the downloaded binaries of 5.0.16.

---------------------------- SessionTimeoutBug.java ----------------------

import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;
import java.util.*;


public class SessionTimeoutBug extends HttpServlet {
  private int interval = 0;

  public void init (ServletConfig config) throws ServletException {
    ServletContext context = config.getServletContext ();
    String str = context.getInitParameter ("interval");

    try {
      if (str != null) {
        interval = Integer.parseInt (str);
      }

      if (interval &lt; 0) {
        interval = 0;
      }
    } catch (NumberFormatException e) {
      interval = 0;     // no refresh
    }
  }


  public void doGet (HttpServletRequest request, HttpServletResponse response)
  throws IOException, ServletException {

    HttpSession session = request.getSession (true);
    String history = (String) session.getAttribute ("history");
    String url = response.encodeURL (request.getRequestURI ());

    if (history == null) {
      genFirstPage (response, session, url);
    } else {
      genPage (response, session, url);
    }
  }


  private void genFirstPage (HttpServletResponse response,
                                         HttpSession session, String url)
  throws IOException, ServletException {

    session.setAttribute ("history", "");

    PrintWriter out = response.getWriter ();
    out.println ("&lt;html&gt;");
    out.println ("&lt;head&gt;");
    out.println ("&lt;title&gt;Session Timeout Bug Demonstration&lt;/title&gt;");
    out.println ("&lt;/head&gt;");
    out.println ("&lt;body&gt;");
    out.println ("To start demo click &lt;a href=\"" + url + "\"&gt;here&lt;/a&gt;.");
    out.println ("&lt;/body&gt;");
    out.println ("&lt;/html&gt;");
    out.close ();
  }




  private void genPage (HttpServletResponse response,
                                         HttpSession session, String url)
  throws IOException, ServletException {

    String history = (String) session.getAttribute ("history");
    history = history + "&lt;BR&gt;Time = " + (new Date ());
    session.setAttribute ("history", history);

    PrintWriter out = response.getWriter ();
    out.println ("&lt;html&gt;");
    out.println ("&lt;head&gt;");
    out.println ("&lt;title&gt;Session Timeout Bug Demonstration&lt;/title&gt;");

    out.println ("&lt;meta http-equiv=\"refresh\" content=\"" + interval + ";" + 
url + "\"&gt;");

    out.println ("&lt;/head&gt;");
    out.println ("&lt;body&gt;");
    out.println ("&lt;B&gt;Refresh history: &lt;/B&gt;" + history);
    out.println ("&lt;br&gt;");
    out.println ("&lt;br&gt;&lt;b&gt;Session timeout is: &lt;/b&gt;" + 
session.getMaxInactiveInterval() + " seconds.");
    out.println ("&lt;br&gt;&lt;b&gt;Next refresh in: &lt;/b&gt;" + interval + " seconds.");
    out.println ("&lt;/body&gt;");
    out.println ("&lt;/html&gt;");
    out.close ();
  }

}


---------------------------- web.xml ----------------------

&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;!DOCTYPE web-app PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 
2.3//EN" "http://java.sun.com/dtd/web-app_2_3.dtd"&gt;

&lt;web-app&gt;

    &lt;!-- General Description of the web application --&gt;

    &lt;display-name&gt;
        Session Timeout Bug Demonstration Web Application
    &lt;/display-name&gt;
    &lt;description&gt;
        Session Timeout Bug Demonstration Web Application
    &lt;/description&gt;


    &lt;!-- Context Parameters --&gt;

    &lt;context-param&gt;
        &lt;param-name&gt;interval&lt;/param-name&gt;
        &lt;param-value&gt;120&lt;/param-value&gt;
    &lt;/context-param&gt;



    &lt;!-- Servlet Definitions --&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;SessionTimeoutBugDemonstration&lt;/servlet-name&gt;
        &lt;servlet-class&gt;SessionTimeoutBug&lt;/servlet-class&gt;
    &lt;/servlet&gt;


    &lt;!-- Servlet Mapping --&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;SessionTimeoutBugDemonstration&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/SessionBugDemo&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;


    &lt;!-- Session Timeout Definition --&gt;

    &lt;session-config&gt;
        &lt;session-timeout&gt;3&lt;/session-timeout&gt;
    &lt;/session-config&gt;

&lt;/web-app&gt;


------------------------------------ END ------------------------------------</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49784</commentid>
    <comment_count>1</comment_count>
      <attachid>9725</attachid>
    <who name="Ran Levy">ranlevy</who>
    <bug_when>2003-12-29 10:32:12 +0000</bug_when>
    <thetext>Created attachment 9725
webapp to reproduce the bug</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49847</commentid>
    <comment_count>2</comment_count>
    <who name="Jarno Peltoniemi">jarno.peltoniemi</who>
    <bug_when>2003-12-30 14:29:13 +0000</bug_when>
    <thetext>The session timeout in Tomcat seems to be implemented in a way that doesn't take
the background clean-up thread into account.

StandardSession has two variables:
thisAccessedTime - the time for current request
lastAccessedTime - the time for last request (needed by
HttpSession.getLastAccessedTime)

The times are updated only once per request by the container so that
HttpSession.getLastAccessedTime() returns the time of the previous request. The
same variable is later used by the background thread to determine if the session
should be invalidated. Therefore the background cleanup thread checks the access
time of the _second_ latest request. This explains why 1 min refresh period
works with 3 min timeout while 2min refresh period does not. Isn't it possible
that the session could even be invalidated while processing a request?

Quick'n'dirty fix would be as follows:
======
diff -u -b -r1.26 StandardSession.java
--- StandardSession.java        29 Nov 2003 18:06:35 -0000      1.26
+++ StandardSession.java        30 Dec 2003 12:52:44 -0000
@@ -584,7 +584,7 @@

         if (maxInactiveInterval &gt;= 0) {
             long timeNow = System.currentTimeMillis();
-            int timeIdle = (int) ((timeNow - lastAccessedTime) / 1000L);
+            int timeIdle = (int) ((timeNow - thisAccessedTime) / 1000L);
             if (timeIdle &gt;= maxInactiveInterval) {
                 expire(true);
             }
======

More elaborate way would be to cache the lastAccessedTime in the
httpsessionfacade and update the StandardSession.lastAccessedTime directly w/o
the thisAccessedTime in between. I could write the more elaborate
patch if someone is willing to commit it.

Please comment.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49917</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-12-31 21:25:38 +0000</bug_when>
    <thetext>I have applied the patch, since I couldn't see any problem with it.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>9725</attachid>
            <date>2003-12-29 10:32:00 +0000</date>
            <delta_ts>2003-12-29 10:32:12 +0000</delta_ts>
            <desc>webapp to reproduce the bug</desc>
            <filename>bug.tar.gz</filename>
            <type>application/octet-stream</type>
            <size>2913</size>
            <attacher name="Ran Levy">ranlevy</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>25796</bug_id>
          
          <creation_ts>2003-12-29 12:06:00 +0000</creation_ts>
          <short_desc>Multiple security-contraint entries in web.xml lead to too-restrictive behaviour</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.16</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Darren Hague">darren.hague</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>49787</commentid>
    <comment_count>0</comment_count>
    <who name="Darren Hague">darren.hague</who>
    <bug_when>2003-12-29 12:06:22 +0000</bug_when>
    <thetext>I have a web.xml containing two security constraints:
    &lt;security-constraint&gt;
        &lt;web-resource-collection&gt;
            &lt;web-resource-name&gt;PublicPages&lt;/web-resource-name&gt;
            &lt;url-pattern&gt;/AccountMan.do&lt;/url-pattern&gt;
            &lt;http-method&gt;GET&lt;/http-method&gt;
            &lt;http-method&gt;POST&lt;/http-method&gt;
        &lt;/web-resource-collection&gt;
        &lt;user-data-constraint&gt;
            &lt;transport-guarantee&gt;NONE&lt;/transport-guarantee&gt;
        &lt;/user-data-constraint&gt;
    &lt;/security-constraint&gt;
    
    &lt;security-constraint&gt;
        &lt;web-resource-collection&gt;
            &lt;web-resource-name&gt;UserPages&lt;/web-resource-name&gt;
            &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;
            &lt;http-method&gt;GET&lt;/http-method&gt;
            &lt;http-method&gt;POST&lt;/http-method&gt;
        &lt;/web-resource-collection&gt;
        &lt;auth-constraint&gt;
            &lt;role-name&gt;xsap_ebiz_user&lt;/role-name&gt;
        &lt;/auth-constraint&gt;
        &lt;user-data-constraint&gt;
            &lt;transport-guarantee&gt;NONE&lt;/transport-guarantee&gt;
        &lt;/user-data-constraint&gt;
    &lt;/security-constraint&gt;

The idea is that all *.do URLs are protected, with the exception of 
AccountMan.do which is publicly visible (no auth-constraint). 

This works fine on Tomcat 4.1-29 and on SAP J2EE Engine 6.20. 

In Tomcat 5.0-16 and 5.0-14 (the only releases I have tested), attempting to 
access AccountMan.do brings up the login page instead of going straight to the 
page itself (a Struts forward to a Tiles definition).

This behaviour contradicts the Servlet 2.4 spec, SRV.12.8.1 Combining 
Constraints:
"A security constraint that does not contain an authorization constraint shall 
combine with authorization constraints that name or imply roles to allow 
unauthenticated access."

Cheers,
Darren Hague

P.S. This is my first bugzilla report - please let me know if I could have done 
anything better.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49807</commentid>
    <comment_count>1</comment_count>
    <who name="">william.barker</who>
    <bug_when>2003-12-29 19:25:18 +0000</bug_when>
    <thetext>This has already been fixed in the CVS, and will show up in 5.0.17.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>25805</bug_id>
          
          <creation_ts>2003-12-29 19:52:00 +0000</creation_ts>
          <short_desc>DataSourceRealm cannot find the JNDI DataSource</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.16</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ahmad Khayyat">akhayyat</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>neil+apachebugzilla</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>49811</commentid>
    <comment_count>0</comment_count>
    <who name="Ahmad Khayyat">akhayyat</who>
    <bug_when>2003-12-29 19:52:52 +0000</bug_when>
    <thetext>Hi there,

I am trying to use DataSourceRealm for my application to authenticate users 
according to a mysql database as instructed in the HOW-TOs, but it does not 
seem to work although the DataSource Resource alone can be accessed and data 
queried.
When using the DataSourceRealm I get the following in the application log:
Exception performing authenticati
on
javax.naming.NameNotFoundException: Name java:comp is not bound in this Context
        at org.apache.naming.NamingContext.lookup(NamingContext.java:814)
        at org.apache.naming.NamingContext.lookup(NamingContext.java:197)
        at org.apache.catalina.realm.DataSourceRealm.open(DataSourceRealm.java:4
51)
        at org.apache.catalina.realm.DataSourceRealm.authenticate(DataSourceReal
m.java:299)
        at org.apache.catalina.authenticator.FormAuthenticator.authenticate(Form
Authenticator.java:274)
        at org.apache.catalina.authenticator.AuthenticatorBase.invoke(Authentica
torBase.java:493)
        at org.apache.catalina.core.StandardValveContext.invokeNext(StandardValv
eContext.java:149)
        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav
a:564)
        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.j
ava:195)
        at org.apache.catalina.core.StandardValveContext.invokeNext(StandardValv
eContext.java:151)
        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.j
ava:164)
        at org.apache.catalina.core.StandardValveContext.invokeNext(StandardValv
eContext.java:149)
        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav
a:564)
        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineVal
ve.java:156)
        at org.apache.catalina.core.StandardValveContext.invokeNext(StandardValv
eContext.java:151)
        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav
a:564)
        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)
        at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:21
1)
        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java
:805)
        at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.proce
ssConnection(Http11Protocol.java:696)
        at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java
:605)
        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadP
ool.java:677)


I am defining all my application context, i.e. the datasource and the 
DataSourceRealm in a context xml file rather than server.xml, althouth I tried 
both initially.

Here is my application context xml related configuration:

&lt;Context ...&gt;
  &lt;Logger../&gt;
  &lt;Realm className="org.apache.catalina.realm.DataSourceRealm"
         dataSourceName="java:comp/env/jdbc/datasourcename" 
               &lt;!-- I tried also "jdbc/datasourcename" only, still no luck --&gt;
         .../&gt;

  &lt;Resource auth="Container" name=jdbc/datasourcename"
    type="javax.sql.DataSource"/&gt;
  &lt;ResourceParams name="jdbc/datasourcename"&gt;
    &lt;parameter&gt;
      &lt;name&gt;factory&lt;/name&gt;
      &lt;value&gt;org.apache.commons.dbcp.BasicDataSourceFactory&lt;/value&gt;
    &lt;/parameter&gt;
    &lt;parameter&gt;
      &lt;name&gt;driverClassName&lt;/name&gt;
      &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;
    &lt;/parameter&gt;
    &lt;parameter&gt;
      &lt;name&gt;url&lt;/name&gt;
      &lt;value&gt;jdbc:mysql://localhost:port/dbname?autoReconnect=true&lt;/value&gt;
    &lt;/parameter&gt;
    &lt;parameter&gt;
      &lt;name&gt;username&lt;/name&gt;
      &lt;value&gt;username&lt;/value&gt;
    &lt;/parameter&gt;
    &lt;parameter&gt;
      &lt;name&gt;password&lt;/name&gt;
      &lt;value&gt;password&lt;/value&gt;
    &lt;/parameter&gt;
  &lt;/ResourceParams&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49848</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-12-30 15:50:43 +0000</bug_when>
    <thetext>The datasource must be a global resource. Please do not reopen this report.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51380</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-29 08:23:54 +0000</bug_when>
    <thetext>*** Bug 26509 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51394</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-29 14:00:44 +0000</bug_when>
    <thetext>.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51395</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-29 14:01:31 +0000</bug_when>
    <thetext>Neil Katin provided a clean patch for this, so this has been implemented using a
simple flag on the realm.</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>25807</bug_id>
          
          <creation_ts>2003-12-29 20:30:00 +0000</creation_ts>
          <short_desc>CGI, Can't open perl script, No such file or directory bug</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlets:CGI</component>
          <version>5.0.16</version>
          <rep_platform>Sun</rep_platform>
          <op_sys>Solaris</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>blocker</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter>jemiller</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>49816</commentid>
    <comment_count>0</comment_count>
    <who name="">jemiller</who>
    <bug_when>2003-12-29 20:30:51 +0000</bug_when>
    <thetext>I am able to use CGI without a problem using Tomcat 4. However, I can't get it 
to work with Tomcat. I uncommented the CGI related lines in conf/web.xml and 
Tomcat appears to be attempting to execute my CGI Perl script. However, I keep 
receiving the following error. Note, I know the path to the file is correct as 
I'm able to view the file using less by pasting the path from the log into the 
command line.

2003-12-29 14:24:01 StandardContext[]cgi: runCGI (stderr):Can't open perl 
script ""/opt/jakarta-tomcat-5.0.16/webapps/ROOT/WEB-INF/cgi/awstats.pl"": No 
such file or directory
2003-12-29 14:24:01 StandardContext[]cgi: runCGI: 1 lines received on stderr

Also, I just noticed that if I copy server/lib/servlets-cgi.jar from my Tomcat 
4 installation to my Tomcat 5 installation it works just fine, so, it appears 
to be a newly introduced bug.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49829</commentid>
    <comment_count>1</comment_count>
    <who name="Mark Thomas">medthomas</who>
    <bug_when>2003-12-29 23:01:55 +0000</bug_when>
    <thetext>This has been fixed in CVS and will be included in the next release.</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>25819</bug_id>
          
          <creation_ts>2003-12-30 09:08:00 +0000</creation_ts>
          <short_desc>java.lang.NoClassDefFoundError: org/apache/tomcat/util/buf/C2BConverter</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:Coyote</component>
          <version>5.0.16</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Dario Bonino">dario.bonino</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>49841</commentid>
    <comment_count>0</comment_count>
    <who name="Dario Bonino">dario.bonino</who>
    <bug_when>2003-12-30 09:08:37 +0000</bug_when>
    <thetext>Exception on first http request. (Low priority)
    If I push the "reload button" the html page is OK.
    If I send more request this Exception never happen.
    
    In attachment:
    1) Stack trace
    2) Piece on source in stack trace
"it.rgi.webapp.admin.htmlwriter.HtmlWriter.printConclusione(HtmlWriter.java:194)"
    3) My catalina.policy (Enabled!)

    thank you,
    bye.


############################################################################################################
############################################################################################################

java.lang.NoClassDefFoundError: org/apache/tomcat/util/buf/C2BConverter
	at org.apache.jk.server.JkCoyoteHandler.appendHead(JkCoyoteHandler.java:333)
	at org.apache.jk.server.JkCoyoteHandler.action(JkCoyoteHandler.java:402)
	at org.apache.coyote.Response.action(Response.java:226)
	at org.apache.coyote.Response.sendHeaders(Response.java:418)
	at org.apache.jk.server.JkCoyoteHandler.doWrite(JkCoyoteHandler.java:240)
	at org.apache.coyote.Response.doWrite(Response.java:586)
	at org.apache.coyote.tomcat5.OutputBuffer.realWriteBytes(OutputBuffer.java:405)
	at org.apache.tomcat.util.buf.ByteChunk.flushBuffer(ByteChunk.java:428)
	at org.apache.tomcat.util.buf.ByteChunk.append(ByteChunk.java:348)
	at org.apache.coyote.tomcat5.OutputBuffer.writeBytes(OutputBuffer.java:438)
	at org.apache.coyote.tomcat5.OutputBuffer.write(OutputBuffer.java:425)
	at org.apache.coyote.tomcat5.CoyoteOutputStream.write(CoyoteOutputStream.java:108)
	at java.io.PrintStream.write(Unknown Source)
	at sun.nio.cs.StreamEncoder$CharsetSE.writeBytes(Unknown Source)
	at sun.nio.cs.StreamEncoder$CharsetSE.implFlushBuffer(Unknown Source)
	at sun.nio.cs.StreamEncoder.flushBuffer(Unknown Source)
	at java.io.OutputStreamWriter.flushBuffer(Unknown Source)
	at java.io.PrintStream.write(Unknown Source)
	at java.io.PrintStream.print(Unknown Source)
	at java.io.PrintStream.println(Unknown Source)
	at it.rgi.webapp.admin.htmlwriter.HtmlWriter.printConclusione(HtmlWriter.java:194)
	at it.rgi.webapp.admin.utility.RgiWebAdminLogin.doLogout(RgiWebAdminLogin.java:231)
	at
it.rgi.webapp.admin.utility.RgiWebAdminLogin.testIfAuthenticationRequiredAdSendLoginPage(RgiWebAdminLogin.java:152)
	at it.rgi.webapp.admin.ServletAdmin.doGet(ServletAdmin.java:109)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:743)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)
	at java.lang.reflect.Method.invoke(Unknown Source)
	at org.apache.catalina.security.SecurityUtil$1.run(SecurityUtil.java:284)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAsPrivileged(Unknown Source)
	at org.apache.catalina.security.SecurityUtil.execute(SecurityUtil.java:306)
	at org.apache.catalina.security.SecurityUtil.doAsPrivilege(SecurityUtil.java:200)
	at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:278)
	at
org.apache.catalina.core.ApplicationFilterChain.access$000(ApplicationFilterChain.java:97)
	at
org.apache.catalina.core.ApplicationFilterChain$1.run(ApplicationFilterChain.java:187)
	at java.security.AccessController.doPrivileged(Native Method)
	at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:183)
	at
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:256)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)
	at
org.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:245)
	at
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:199)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:195)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:164)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)
	at
org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:156)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:211)
	at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:309)
	at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:387)
	at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:673)
	at org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:615)
	at org.apache.jk.common.SocketConnection.runIt(ChannelSocket.java:786)
	at
org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:677)
	at java.lang.Thread.run(Unknown Source)



############################################################################################################
############################################################################################################

package it.rgi.webapp.admin.htmlwriter;

 ......

public class HtmlWriter {

public static void printConclusione(...) throws IOException {
    final PrintStream out = new PrintStream(response.getOutputStream());
    ....
    out.println("&lt;TR&gt;&lt;TD nowrap width=\"100%\"&gt;&lt;Font "+FSTYLE_NORMAL+"&gt;"+CR);
/*LINE 194 */ out.println("&amp;nbsp; &lt;A
HREF=\"javascript:window.resizeTo(800,720);\"&gt;&lt;IMG
src=\""+RgiIcon.URLNAME+"?duke\" ALIGN=\"bottom\" BORDER=0 ALT=\"Resize browser
to 800x720 pixel.\"&gt;&lt;/A&gt; 100% pure Java technology.");
    out.println("&amp;nbsp; Copyright © 2001 &lt;B&gt;RGI SpA&lt;/B&gt;");
    ....
    } // printConclusione
    
.......

############################################################################################################
############################################################################################################

// ============================================================================
// catalina.corepolicy - Security Policy Permissions for Tomcat 5
//
// This file contains a default set of security policies to be enforced (by the
// JVM) when Catalina is executed with the "-security" option.  In addition
// to the permissions granted here, the following additional permissions are
// granted to the codebase specific to each web application:
//
// * Read access to the document root directory
//
// $Id: catalina.policy,v 1.10 2003/09/10 18:47:18 remm Exp $
// ============================================================================


// ========== SYSTEM CODE PERMISSIONS =========================================


// These permissions apply to javac
grant codeBase "file:${java.home}/lib/-" {
        permission java.security.AllPermission;
};

// These permissions apply to all shared system extensions
grant codeBase "file:${java.home}/jre/lib/ext/-" {
        permission java.security.AllPermission;
};

// These permissions apply to javac when ${java.home] points at $JAVA_HOME/jre
grant codeBase "file:${java.home}/../lib/-" {
        permission java.security.AllPermission;
};

// These permissions apply to all shared system extensions when
// ${java.home} points at $JAVA_HOME/jre
grant codeBase "file:${java.home}/lib/ext/-" {
        permission java.security.AllPermission;
};


// ========== CATALINA CODE PERMISSIONS =======================================


// These permissions apply to the launcher code
grant codeBase "file:${catalina.home}/bin/commons-launcher.jar" {
        permission java.security.AllPermission;
};

// These permissions apply to the daemon code
grant codeBase "file:${catalina.home}/bin/commons-daemon.jar" {
        permission java.security.AllPermission;
};

// These permissions apply to the commons-logging API
grant codeBase "file:${catalina.home}/bin/commons-logging-api.jar" {
        permission java.security.AllPermission;
};

// These permissions apply to the server startup code
grant codeBase "file:${catalina.home}/bin/bootstrap.jar" {
        permission java.security.AllPermission;
};

// These permissions apply to the servlet API classes
// and those that are shared across all class loaders
// located in the "common" directory
grant codeBase "file:${catalina.home}/common/-" {
        permission java.security.AllPermission;
};

// These permissions apply to the container's core code, plus any additional
// libraries installed in the "server" directory
grant codeBase "file:${catalina.home}/server/-" {
        permission java.security.AllPermission;
};

// ========== WEB APPLICATION PERMISSIONS =====================================


// These permissions are granted by default to all web applications
// In addition, a web application will be given a read FilePermission
// and JndiPermission for all files and directories in its document root.
grant { 
    // Required for JNDI lookup of named JDBC DataSource's and
    // javamail named MimePart DataSource used to send mail
    permission java.util.PropertyPermission "java.home", "read";
    permission java.util.PropertyPermission "java.naming.*", "read";
    permission java.util.PropertyPermission "javax.sql.*", "read";

    // OS Specific properties to allow read access
    permission java.util.PropertyPermission "os.name", "read";
    permission java.util.PropertyPermission "os.version", "read";
    permission java.util.PropertyPermission "os.arch", "read";
    permission java.util.PropertyPermission "file.separator", "read";
    permission java.util.PropertyPermission "path.separator", "read";
    permission java.util.PropertyPermission "line.separator", "read";

    // JVM properties to allow read access
    permission java.util.PropertyPermission "java.version", "read";
    permission java.util.PropertyPermission "java.vendor", "read";
    permission java.util.PropertyPermission "java.vendor.url", "read";
    permission java.util.PropertyPermission "java.class.version", "read";
	permission java.util.PropertyPermission "java.specification.version", "read";
	permission java.util.PropertyPermission "java.specification.vendor", "read";
	permission java.util.PropertyPermission "java.specification.name", "read";

	permission java.util.PropertyPermission "java.vm.specification.version", "read";
	permission java.util.PropertyPermission "java.vm.specification.vendor", "read";
	permission java.util.PropertyPermission "java.vm.specification.name", "read";
	permission java.util.PropertyPermission "java.vm.version", "read";
	permission java.util.PropertyPermission "java.vm.vendor", "read";
	permission java.util.PropertyPermission "java.vm.name", "read";

    // Required for OpenJMX
    permission java.lang.RuntimePermission "getAttribute";

	// Allow read of JAXP compliant XML parser debug
	permission java.util.PropertyPermission "jaxp.debug", "read";

    // Precompiled JSPs need access to this package.
    permission java.lang.RuntimePermission
"accessClassInPackage.org.apache.jasper.runtime";
    permission java.lang.RuntimePermission
"accessClassInPackage.org.apache.jasper.runtime.*";
    
};


// You can assign additional permissions to particular web applications by
// adding additional "grant" entries here, based on the code base for that
// application, /WEB-INF/classes/, or /WEB-INF/lib/ jar files.
//
// Different permissions can be granted to JSP pages, classes loaded from
// the /WEB-INF/classes/ directory, all jar files in the /WEB-INF/lib/
// directory, or even to individual jar files in the /WEB-INF/lib/ directory.
//
// For instance, assume that the standard "examples" application
// included a JDBC driver that needed to establish a network connection to the
// corresponding database and used the scrape taglib to get the weather from
// the NOAA web server.  You might create a "grant" entries like this:
//
// The permissions granted to the context root directory apply to JSP pages.
// grant codeBase "file:${catalina.home}/webapps/examples/-" {
//      permission java.net.SocketPermission "dbhost.mycompany.com:5432", "connect";
//      permission java.net.SocketPermission "*.noaa.gov:80", "connect";
// };
//
// The permissions granted to the context WEB-INF/classes directory
// grant codeBase "file:${catalina.home}/webapps/examples/WEB-INF/classes/-" {
// };
//
// The permission granted to your JDBC driver
// grant codeBase
"jar:file:${catalina.home}/webapps/examples/WEB-INF/lib/driver.jar!/-" {
//      permission java.net.SocketPermission "dbhost.mycompany.com:5432", "connect";
// };
// The permission granted to the scrape taglib
// grant codeBase
"jar:file:${catalina.home}/webapps/examples/WEB-INF/lib/scrape.jar!/-" {
//      permission java.net.SocketPermission "*.noaa.gov:80", "connect";
// };

// ##################### AGGIUNTE MANUALI EFFETTUATE DA BONINO DARIO
#####################

// These permissions apply to the servlet API classes and those that are shared
across
// all class loaders located in the "RGI/lib/common" OR "RGI/lib/shared" directory
grant codeBase "file:${catalina.home}/RGI/lib/-" {
    permission java.security.AllPermission;
    };

// Web applications permission, J2EE Specification 1.4
// Minimum set of permissions that Web Components components can expect. 
grant {
	permission java.lang.RuntimePermission  "loadLibrary.*";
	permission java.lang.RuntimePermission  "queuePrintJob";
	permission java.net.SocketPermission    "*", "connect";
	permission java.io.FilePermission       "&lt;&lt;ALL FILES&gt;&gt;", "read,write";
	permission java.util.PropertyPermission "*", "read";
    };

// RGI JBasis and PassCompagnia requirements
grant {
    permission java.util.PropertyPermission "user.language", "write"; //
OPTIONAL, per poter cambiare i "Regional Settings"
    permission java.net.SocketPermission "*:1024-65535", "connect,accept,listen";
    // permission java.lang.RuntimePermission "accessDeclaredMembers"; // REFLECTION
    // permission java.security.AllPermission; // DEBUG
    };



############################################################################################################
############################################################################################################</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49910</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-12-31 17:36:33 +0000</bug_when>
    <thetext>For now, the security manager support in TC 5 has been developed and tested with
the HTTP connector. The AJP connector may need additional permissions to work
for the time being (volunteers needed to add the missing PAs).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50076</commentid>
    <comment_count>2</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2004-01-05 15:09:40 +0000</bug_when>
    <thetext>A missing doPrivileged block is missing and the real exception is hidden for a
reason I can't explain (I don't know how jk works...I will take a look). Just
edit your catalina.properties and clean the following two properties:

package.access=
package.definition=

or just remove org.apache.tomcat. 

It should work.

-- Jeanfrancois</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50125</commentid>
    <comment_count>3</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-01-06 04:41:50 +0000</bug_when>
    <thetext>Based on the description of the bug, I believe that the patch I've checked in 
will fix the problem.  However, it will be a couple of days before I can free 
up a server to test Tomcat 5/Apache, so I can't really test it.  

I'd appreciate it if someone could test the Nightly so I could know if I could 
mark this as FIXED.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50164</commentid>
    <comment_count>4</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-01-07 05:36:51 +0000</bug_when>
    <thetext>I got a chance to take-down one of my servers sooner than I thought :).

This is fixed now in the CVS, and will appear in 5.0.17.</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>25822</bug_id>
          
          <creation_ts>2003-12-30 12:38:00 +0000</creation_ts>
          <short_desc>tomcat shouldn't write tomcat-users.xml at startup</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.16</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Xavier Poinsard">xpoinsard</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>49845</commentid>
    <comment_count>0</comment_count>
    <who name="Xavier Poinsard">xpoinsard</who>
    <bug_when>2003-12-30 12:38:14 +0000</bug_when>
    <thetext>I am trying to start tomcat as normal user and carefully adding only required
permissions and I found that during startup tomcat is writing the file
tomcat-users.xml. I think it should only write this file when users are
added/modified/deleted and I think it would be a bad thing to have to make the
entire conf directory writeable since it writes a tomcat-users.xml.new and then
renames it.
I am using the standard binaries.
For info :
30 déc. 2003 13:27:34 org.apache.naming.NamingContext lookup
ATTENTION: Une erreur s est produite durant la résolution de la référence
java.io.FileNotFoundException:
/usr/local/jakarta-tomcat-5.0.16/conf/tomcat-users.xml.new (Permission denied)
        at java.io.FileOutputStream.open(Native Method)
        at java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:179)
        at java.io.FileOutputStream.&lt;init&gt;(FileOutputStream.java:131)
        at
org.apache.catalina.users.MemoryUserDatabase.save(MemoryUserDatabase.java:508)
        at
org.apache.catalina.users.MemoryUserDatabaseFactory.getObjectInstance(MemoryUserDatabaseFactory.java:144)
        at
org.apache.naming.factory.ResourceFactory.getObjectInstance(ResourceFactory.java:176)
        at javax.naming.spi.NamingManager.getObjectInstance(NamingManager.java:301)
        at org.apache.naming.NamingContext.lookup(NamingContext.java:837)
        at org.apache.naming.NamingContext.lookup(NamingContext.java:197)
        at
org.apache.catalina.mbeans.GlobalResourcesLifecycleListener.createMBeans(GlobalResourcesLifecycleListener.java:202)
        at
org.apache.catalina.mbeans.GlobalResourcesLifecycleListener.createMBeans(GlobalResourcesLifecycleListener.java:172)
        at
org.apache.catalina.mbeans.GlobalResourcesLifecycleListener.lifecycleEvent(GlobalResourcesLifecycleListener.java:144)
        at
org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)
        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2336)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:581)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:398)
30 déc. 2003 13:27:34
org.apache.catalina.mbeans.GlobalResourcesLifecycleListener createMBeans
GRAVE: Exception processing Global JNDI Resources
javax.naming.NamingException:
/usr/local/jakarta-tomcat-5.0.16/conf/tomcat-users.xml.new (Permission denied)
        at org.apache.naming.NamingContext.lookup(NamingContext.java:849)
        at org.apache.naming.NamingContext.lookup(NamingContext.java:197)
        at
org.apache.catalina.mbeans.GlobalResourcesLifecycleListener.createMBeans(GlobalResourcesLifecycleListener.java:202)
        at
org.apache.catalina.mbeans.GlobalResourcesLifecycleListener.createMBeans(GlobalResourcesLifecycleListener.java:172)
        at
org.apache.catalina.mbeans.GlobalResourcesLifecycleListener.lifecycleEvent(GlobalResourcesLifecycleListener.java:144)
        at
org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)
        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2336)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:581)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:398)
30 déc. 2003 13:27:34 org.apache.catalina.core.StandardService start</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49850</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-12-30 15:52:54 +0000</bug_when>
    <thetext>Then use a realm which doesn't do that ...</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49896</commentid>
    <comment_count>2</comment_count>
      <attachid>9763</attachid>
    <who name="Xavier Poinsard">xpoinsard</who>
    <bug_when>2003-12-31 13:45:48 +0000</bug_when>
    <thetext>Created attachment 9763
patch to save only when user database is modified</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49897</commentid>
    <comment_count>3</comment_count>
    <who name="Xavier Poinsard">xpoinsard</who>
    <bug_when>2003-12-31 13:51:34 +0000</bug_when>
    <thetext>Here is a simple patch that should prevent unnecessary file modifications.
Could it be applied or is the "always write file" a feature ?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49898</commentid>
    <comment_count>4</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2003-12-31 13:54:28 +0000</bug_when>
    <thetext>How does this patch help?  If modified, you still have to write the file and 
therefore still require the same directory/security permissions.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49899</commentid>
    <comment_count>5</comment_count>
    <who name="Xavier Poinsard">xpoinsard</who>
    <bug_when>2003-12-31 14:07:17 +0000</bug_when>
    <thetext>If you don't plan to add users using the web interface, with this patch you can
disallow any write in the conf directory and add users only "by hand".
We could perhaps go further by writing the tempory files tomcat-users.xml.old
and tomcat-users.xml.new in the temporary directory. Then only write right on
the file tomcat-users.xml would be required.
But since I am completely ingorant of tomcat internals, I don't where we can get
the tomcat temporary directory.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49900</commentid>
    <comment_count>6</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2003-12-31 14:09:29 +0000</bug_when>
    <thetext>You could use java.io.tmpdir.  I wish you had discussed this on the mailing 
list before posting a bug (which I've now modified to an enhancement request).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49904</commentid>
    <comment_count>7</comment_count>
    <who name="Xavier Poinsard">xpoinsard</who>
    <bug_when>2003-12-31 14:42:23 +0000</bug_when>
    <thetext>Sorry, but I really thought it was a bug since the default configuration was
implying a lower security.
Is java.io.tmpdir better than something like System.getProperty("catalina.base")
+ File.separator+ "temp" ?
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50077</commentid>
    <comment_count>8</comment_count>
      <attachid>9814</attachid>
    <who name="Xavier Poinsard">xpoinsard</who>
    <bug_when>2004-01-05 15:56:57 +0000</bug_when>
    <thetext>Created attachment 9814
replacement for previous buggy patch</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50078</commentid>
    <comment_count>9</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-05 15:59:59 +0000</bug_when>
    <thetext>-1 for your revised patch, sorry. Please do not reopen the bug.
If you do not agree, write your own custom realm, or use the older memory realm.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50080</commentid>
    <comment_count>10</comment_count>
    <who name="Xavier Poinsard">xpoinsard</who>
    <bug_when>2004-01-05 16:02:24 +0000</bug_when>
    <thetext>My previous patch wasn't able to detect any user modification.
Since it seems to have been applied to cvs, here is a patch that remove it and
uses another method.
Like discussed before, it uses a temporary file to save the file before
overwriting the file in conf directory.
With this patch, write permission is only necessary for the file
tomcat-users.xml and not for the entire directory.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50081</commentid>
    <comment_count>11</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-05 16:08:06 +0000</bug_when>
    <thetext>Sorry, but I'm not interested. Either something simple works (like your first
patch), or it doesn't. If it doesn't then since the "issue" is not significant,
then the patch will be reverted.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50082</commentid>
    <comment_count>12</comment_count>
    <who name="Xavier Poinsard">xpoinsard</who>
    <bug_when>2004-01-05 16:19:24 +0000</bug_when>
    <thetext>My first patch doesn't work since it doesn't detect user modification.
My second remove the first patch and implements the following :
- use a temporary file for write instead of conf/tomcat-users.xml.new
- check wether conf/tomcat-users.xml is writable (if it exists)
- rename the temporary files to conf/tomcat-users.xml
It removes the need to write in the directory.

By the way the old code had a very little bug :

        File fileOld = new File(pathnameNew);
        if (!fileOld.isAbsolute()) {
            fileOld =
                new File(System.getProperty("catalina.base"), pathnameOld);
        }

when I expected 

        File fileOld = new File(pathnameOld);
        if (!fileOld.isAbsolute()) {
            fileOld =
                new File(System.getProperty("catalina.base"), pathnameOld);
        }


</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50083</commentid>
    <comment_count>13</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-05 16:21:33 +0000</bug_when>
    <thetext>Your first patch works fine (at least it does what I wanted): the users are no
longer saved on startup, while updates using the admin webapp cause the file to
be saved.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50084</commentid>
    <comment_count>14</comment_count>
    <who name="Xavier Poinsard">xpoinsard</who>
    <bug_when>2004-01-05 16:28:04 +0000</bug_when>
    <thetext>If you only modify an existing user, the change isn't detected and won't be
saved unless you add/remove another user.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50133</commentid>
    <comment_count>15</comment_count>
      <attachid>9829</attachid>
    <who name="Xavier Poinsard">xpoinsard</who>
    <bug_when>2004-01-06 15:41:40 +0000</bug_when>
    <thetext>Created attachment 9829
complete the first patch to correctly detect all modifications</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50134</commentid>
    <comment_count>16</comment_count>
    <who name="Xavier Poinsard">xpoinsard</who>
    <bug_when>2004-01-06 15:43:51 +0000</bug_when>
    <thetext>Since you liked my first patch tentative, I completed it by detecting every
modifications made to the UserDatabase.
I hope this could be accepted since it remains simple.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50551</commentid>
    <comment_count>17</comment_count>
      <attachid>9948</attachid>
    <who name="Xavier Poinsard">xpoinsard</who>
    <bug_when>2004-01-14 16:44:20 +0000</bug_when>
    <thetext>Created attachment 9948
patch containing fix for pathnameOld</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50552</commentid>
    <comment_count>18</comment_count>
    <who name="Xavier Poinsard">xpoinsard</who>
    <bug_when>2004-01-14 16:46:42 +0000</bug_when>
    <thetext>If this solution doesn't fit, I could provide a ReadOnlyMemoryUserDatabase
implementation.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>9763</attachid>
            <date>2003-12-31 13:45:00 +0000</date>
            <delta_ts>2003-12-31 13:45:48 +0000</delta_ts>
            <desc>patch to save only when user database is modified</desc>
            <filename>patchUserDB</filename>
            <type>text/plain</type>
            <size>8374</size>
            <attacher name="Xavier Poinsard">xpoinsard</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>9814</attachid>
            <date>2004-01-05 15:56:00 +0000</date>
            <delta_ts>2004-01-05 15:56:57 +0000</delta_ts>
            <desc>replacement for previous buggy patch</desc>
            <filename>patchTomcat</filename>
            <type>text/plain</type>
            <size>3684</size>
            <attacher name="Xavier Poinsard">xpoinsard</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>9829</attachid>
            <date>2004-01-06 15:41:00 +0000</date>
            <delta_ts>2004-01-06 15:41:40 +0000</delta_ts>
            <desc>complete the first patch to correctly detect all modifications</desc>
            <filename>patchTomcatUserDB</filename>
            <type>text/plain</type>
            <size>4549</size>
            <attacher name="Xavier Poinsard">xpoinsard</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>9948</attachid>
            <date>2004-01-14 16:44:00 +0000</date>
            <delta_ts>2004-01-14 16:44:20 +0000</delta_ts>
            <desc>patch containing fix for pathnameOld</desc>
            <filename>completePatch</filename>
            <type>text/plain</type>
            <size>4889</size>
            <attacher name="Xavier Poinsard">xpoinsard</attacher>
            

          </attachment>
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>25838</bug_id>
          
          <creation_ts>2003-12-31 16:01:00 +0000</creation_ts>
          <short_desc>tomcat-jk.jar is missing all ajp classess</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:AJP</component>
          <version>5.0.16</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jack Shieh">shiehj</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>49905</commentid>
    <comment_count>0</comment_count>
    <who name="Jack Shieh">shiehj</who>
    <bug_when>2003-12-31 16:01:08 +0000</bug_when>
    <thetext>I donwloaded a win32 binary version of Tomcat and installed on my PC. During 
setting up JK connector to Apache, I got "ClassNotFound" exception when using 
org.apache.ajp.tomcat4.config.ApacheConfig". Turned out that the whole tomcat-
jk.jar didn't have all the AJP classes. Copying a jar file from 4.1.24 with the 
same name fixed the problem.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49908</commentid>
    <comment_count>1</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2003-12-31 16:05:30 +0000</bug_when>
    <thetext>*** Bug 25839 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49913</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2003-12-31 18:31:38 +0000</bug_when>
    <thetext>org.apache.ajp.* is deprecated, and will not be available in Tomcat 5. Someone
could be interested in porting the functionality.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50105</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-05 21:28:12 +0000</bug_when>
    <thetext>The classes have been moved to the org.apache.jk.config package, and are now
bundled, thanks to Bill.</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>25878</bug_id>
          
          <creation_ts>2004-01-03 16:58:00 +0000</creation_ts>
          <short_desc>Host created with Admin Application only ready, after complete tomcat restart</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.16</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Peter Rossbach">pr</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>49988</commentid>
    <comment_count>0</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-01-03 16:58:17 +0000</bug_when>
    <thetext>The HostConfig are not create with MBeanFactory.createStandardHost, like the 
HostRuleSet do for every Host. The MBeanFactory.createStandardContext create a 
ContextConfig. Only with the HostConfig Listener the automatic restart logic 
works.

Also fix: After restart StandardHost (stop/start) a second ErrorValve exist. 
Not nice. 

Another thing: Admin Application can't reflect automatic changes.
   I thing we must add a refresh button and build the tree again....

Peter</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49989</commentid>
    <comment_count>1</comment_count>
      <attachid>9783</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-01-03 16:58:56 +0000</bug_when>
    <thetext>Created attachment 9783
MBeanFactory hostconfig patch</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>49990</commentid>
    <comment_count>2</comment_count>
      <attachid>9784</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-01-03 16:59:28 +0000</bug_when>
    <thetext>Created attachment 9784
Standard Host only one ErrorValve after restart patch</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50229</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-08 10:35:01 +0000</bug_when>
    <thetext>Your patch has been committed. Thanks.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>9783</attachid>
            <date>2004-01-03 16:58:00 +0000</date>
            <delta_ts>2004-01-03 16:58:56 +0000</delta_ts>
            <desc>MBeanFactory hostconfig patch</desc>
            <filename>MBeansFactory20040103.patch</filename>
            <type>text/plain</type>
            <size>703</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>9784</attachid>
            <date>2004-01-03 16:59:00 +0000</date>
            <delta_ts>2004-01-03 16:59:28 +0000</delta_ts>
            <desc>Standard Host only one ErrorValve after restart patch</desc>
            <filename>StandardHost20040103.patch</filename>
            <type>text/plain</type>
            <size>1880</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>25885</bug_id>
          
          <creation_ts>2004-01-04 12:07:00 +0000</creation_ts>
          <short_desc>ApplicationParameter override  test with wrong value at StandardContext</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.16</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Peter Rossbach">pr</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>50005</commentid>
    <comment_count>0</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-01-04 12:07:36 +0000</bug_when>
    <thetext>StandardContext

1724:ff
    public void addApplicationParameter(ApplicationParameter parameter) {

        synchronized (applicationParameters) {
            String newName = parameter.getName();
                   ######
            for (int i = 0; i &lt; applicationParameters.length; i++) {
                if (name.equals(applicationParameters[i].getName()) &amp;&amp;
                    #######
                    !applicationParameters[i].getOverride())
                    return;
            }

The overide existing parameter test must be newName and not the Context name:

    public void addApplicationParameter(ApplicationParameter parameter) {

        synchronized (applicationParameters) {
            String newName = parameter.getName();
            for (int i = 0; i &lt; applicationParameters.length; i++) {
                if (newName.equals(applicationParameters[i].getName()) &amp;&amp;
                    !applicationParameters[i].getOverride())
                    return;
            }

Peter</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50047</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-05 08:46:37 +0000</bug_when>
    <thetext>Fixed. Thanks.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>25886</bug_id>
          
          <creation_ts>2004-01-04 15:38:00 +0000</creation_ts>
          <short_desc>Feature: PersistenceManager less restrictive at createSession with maxActiveSessions</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.16</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Peter Rossbach">pr</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>50008</commentid>
    <comment_count>0</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-01-04 15:38:28 +0000</bug_when>
    <thetext>When I set maxActiveSessions &gt; 0 the createSession() throw a 
IllegalStateException as more Session are used. Opps. I thing the 
processMaxActiveSwaps() sawp better idle sessions out after intervall.

I have implemented a more less restrictive flag..

s. patch and testcase. I also correct small cast and doc warnings.

Peter</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50009</commentid>
    <comment_count>1</comment_count>
      <attachid>9791</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-01-04 15:38:58 +0000</bug_when>
    <thetext>Created attachment 9791
PersistenceManagerBase</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50010</commentid>
    <comment_count>2</comment_count>
      <attachid>9792</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-01-04 15:39:43 +0000</bug_when>
    <thetext>Created attachment 9792
PersistenceManagerBaseTest</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50049</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-05 08:51:18 +0000</bug_when>
    <thetext>Fixed. The check is gone, I don't see the point of enforcing the active session
value with a persistent manager.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50052</commentid>
    <comment_count>4</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-01-05 09:49:56 +0000</bug_when>
    <thetext>Good desicion !

Now we can remove the rejectedSession Property also ....

thanx
Peter
</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>9791</attachid>
            <date>2004-01-04 15:38:00 +0000</date>
            <delta_ts>2004-01-04 15:38:58 +0000</delta_ts>
            <desc>PersistenceManagerBase</desc>
            <filename>PersistenceManagerBase20040401.patch</filename>
            <type>text/plain</type>
            <size>2257</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>9792</attachid>
            <date>2004-01-04 15:39:00 +0000</date>
            <delta_ts>2004-01-04 15:39:43 +0000</delta_ts>
            <desc>PersistenceManagerBaseTest</desc>
            <filename>PersistenceManagerBaseTest.java</filename>
            <type>text/plain</type>
            <size>2395</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>25889</bug_id>
          
          <creation_ts>2004-01-04 21:32:00 +0000</creation_ts>
          <short_desc>JDBCStore hsqldb 1.7.1 connection faild and no connection reconnect after failed</short_desc>
          <delta_ts>2010-12-13 17:31:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.16</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Peter Rossbach">pr</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>thomas2.maesing</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>50025</commentid>
    <comment_count>0</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-01-04 21:32:07 +0000</bug_when>
    <thetext>Add following feature:

1) The JDBC Store have no connection user and password arguments. Only with 
connectionURL hsql 1.7.1 not work.

2) after connection failed no auto reconnet.

s. patches

Peter</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50026</commentid>
    <comment_count>1</comment_count>
      <attachid>9794</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-01-04 21:35:28 +0000</bug_when>
    <thetext>Created attachment 9794
JDBCStore Patch</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50027</commentid>
    <comment_count>2</comment_count>
      <attachid>9795</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-01-04 21:35:55 +0000</bug_when>
    <thetext>Created attachment 9795
LocalProperties</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50311</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-09 11:35:47 +0000</bug_when>
    <thetext>I've applied your patch, which looked ok, but couldn't test it. Thanks.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>68776</commentid>
    <comment_count>4</comment_count>
      <attachid>13815</attachid>
    <who name="Tom Anderson">tom</who>
    <bug_when>2004-12-21 22:45:47 +0000</bug_when>
    <thetext>Created attachment 13815
JDBCStore patch

I recently upgraded to TC5.   But to my dismay, it started hammering my
database so hard that it was 
crashing periodically.	 Looking at the code for JDBCStore I noticed that it is
now running every single 
query twice even when it succeeds the first time.   I believe the intent was to
try to reconnect on a 
database error but the side effect is to create twice as many queries as needed
when the database is up.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>68777</commentid>
    <comment_count>5</comment_count>
    <who name="Tom Anderson">tom</who>
    <bug_when>2004-12-21 22:47:45 +0000</bug_when>
    <thetext>I have reopened this bug because of the problem introduced by it.   Specifically, each query is now 
being run twice even when the first one is successful.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>68778</commentid>
    <comment_count>6</comment_count>
      <attachid>13815</attachid>
    <who name="Tom Anderson">tom</who>
    <bug_when>2004-12-21 22:50:01 +0000</bug_when>
    <thetext>Comment on attachment 13815
JDBCStore patch

note: this patch should fix the bug introduced by the previous patch</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>69363</commentid>
    <comment_count>7</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2005-01-07 16:18:11 +0000</bug_when>
    <thetext>I have applied the patch. Thanks.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>142662</commentid>
    <comment_count>8</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2010-12-13 17:31:46 +0000</bug_when>
    <thetext>*** Bug 7043 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>9794</attachid>
            <date>2004-01-04 21:35:00 +0000</date>
            <delta_ts>2004-01-04 21:35:28 +0000</delta_ts>
            <desc>JDBCStore Patch</desc>
            <filename>JDBCStore20040104.patch</filename>
            <type>text/plain</type>
            <size>33684</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>9795</attachid>
            <date>2004-01-04 21:35:00 +0000</date>
            <delta_ts>2004-01-04 21:35:55 +0000</delta_ts>
            <desc>LocalProperties</desc>
            <filename>sessionLocalProperties20040104.patch</filename>
            <type>text/plain</type>
            <size>401</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>13815</attachid>
            <date>2004-12-21 22:45:00 +0000</date>
            <delta_ts>2004-12-21 22:45:47 +0000</delta_ts>
            <desc>JDBCStore patch</desc>
            <filename>JDBCStore.patch</filename>
            <type>text/plain</type>
            <size>928</size>
            <attacher name="Tom Anderson">tom</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>25980</bug_id>
          
          <creation_ts>2004-01-08 12:20:00 +0000</creation_ts>
          <short_desc>Documentation relating to where jsp examples are needs update</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Documentation</component>
          <version>5.0.16</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Nickolas A Gray">nagray</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>50238</commentid>
    <comment_count>0</comment_count>
    <who name="Nickolas A Gray">nagray</who>
    <bug_when>2004-01-08 12:20:11 +0000</bug_when>
    <thetext>The documentation needs to be updated to point to 

http://localhost:8080/jsp-examples/security/protected/

Instead of the current

http://localhost:8080/examples/jsp/security/protected/</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50248</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-08 13:25:03 +0000</bug_when>
    <thetext>Thanks.
That page isn't really up to date anyway, so many more updates are needed.</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>26010</bug_id>
          
          <creation_ts>2004-01-09 03:28:00 +0000</creation_ts>
          <short_desc>&lt;context&gt; path in server.xml doesn't like "_" (underscore) character.</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Julius Davies">juliusdavies</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>50299</commentid>
    <comment_count>0</comment_count>
    <who name="Julius Davies">juliusdavies</who>
    <bug_when>2004-01-09 03:28:10 +0000</bug_when>
    <thetext>stdout and logs/localhost_log.[date].txt complain when a &lt;context&gt; path
attribute contains a "_" (underscore) character.

The webapp still deploys fine.  The error messages are annoying, that's all!  :-)

This generates error messages (in server.xml):
&lt;Context path="/test_" debug="0" docBase="/stuff/empty"/&gt;

This doesn't:
&lt;Context path="/test" debug="0" docBase="/stuff/empty"/&gt;

stdout:
==============================
INFO: Processing Context configuration file URL
file:/home/juliusdavies/jakarta-tomcat-5/conf/Catalina/localhost/test_.xml
8-Jan-2004 7:06:23 PM org.apache.commons.digester.Digester endElement
SEVERE: End event threw exception
java.lang.reflect.InvocationTargetException
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
[...]
Caused by: java.lang.IllegalStateException: Context path /test_ is already in use
        at
org.apache.catalina.core.StandardHostDeployer.addChild(StandardHostDeployer.java:833)
        ... 38 more


logs/localhost_log.[date].txt:
==============================
2004-01-08 19:06:23 StandardHost[localhost]: Error deploying application at
context path null
java.lang.IllegalStateException: Context path /test_ is already in use
        at
org.apache.commons.digester.Digester.createSAXException(Digester.java:2540)


*  Version
jakarta-tomcat-5-bin-20040107

* Tomcat component
org.apache.catalina.core.StandardHostDeployer.addChild

* Platform
PC (Intel Pentium III)

* OS
Linux 2.4.18 (Debian)

* JVM
Java HotSpot(TM) Server VM (build 1.4.2-b28, mixed mode)

* Web Server
Tomcat 5.0 listening on port 8080

* Configuration
No change to default except single line:
&lt;Context path="/test_" debug="0" docBase="/stuff/empty"/&gt;


ps.  Am I seeing things?  I noticed that deleting a &lt;Context&gt; from "server.xml"
doesn't actually remove the webapp from service!  The webapp will still deploy
on Tomcat's next run.  Tomcat seems to use the conf/Catalina/**/*.xml files it
creates to accomplish this.

I get a feeling that &lt;context&gt; inside "server.xml" is sort of deprecated, and
that I should just create individual "context" xml files inside conf/Catalina/
instead.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50310</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-09 10:05:06 +0000</bug_when>
    <thetext>Yes, for now, '_' can't be freely used in a context path, sorry. This will not
be fixed for a while. Use '-' instead.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51085</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-23 22:39:39 +0000</bug_when>
    <thetext>.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51086</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-23 22:42:34 +0000</bug_when>
    <thetext>I have experimented with using '#' as a replacement character. If this doesn't
work well, I will revert the changes and set the bug back to LATER.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51087</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-23 22:49:20 +0000</bug_when>
    <thetext>My fix seems to be working. '#' should never end up being the first character,
so it should work in all cases.</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>26039</bug_id>
          
          <creation_ts>2004-01-10 14:42:00 +0000</creation_ts>
          <short_desc>spanish translations</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.16</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jesus Marin">jesus</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>50357</commentid>
    <comment_count>0</comment_count>
    <who name="Jesus Marin">jesus</who>
    <bug_when>2004-01-10 14:42:33 +0000</bug_when>
    <thetext>I have made some spanish translations. Where do I send them?.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50358</commentid>
    <comment_count>1</comment_count>
      <attachid>9895</attachid>
    <who name="Jesus Marin">jesus</who>
    <bug_when>2004-01-10 15:45:37 +0000</bug_when>
    <thetext>Created attachment 9895
extended spanish translations</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50380</commentid>
    <comment_count>2</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-01-12 00:22:15 +0000</bug_when>
    <thetext>The attachment looks like a jar file.  You need to submit your patch as 
a 'diff' file (preferably using 'cvs diff') if you want it to be considered.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50426</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-12 20:01:03 +0000</bug_when>
    <thetext>Fixed. Thanks. Indeed, submitting a diff is a lot better.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50674</commentid>
    <comment_count>4</comment_count>
      <attachid>9991</attachid>
    <who name="Larry Isaacs">Larry.Isaacs</who>
    <bug_when>2004-01-17 03:20:37 +0000</bug_when>
    <thetext>Created attachment 9991
New file for jakarta-servletapi-5 jsr154</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50675</commentid>
    <comment_count>5</comment_count>
      <attachid>9992</attachid>
    <who name="Larry Isaacs">Larry.Isaacs</who>
    <bug_when>2004-01-17 03:21:18 +0000</bug_when>
    <thetext>Created attachment 9992
Patch for jakarta-servletapi-5 jsr154</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>9895</attachid>
            <date>2004-01-10 15:45:00 +0000</date>
            <delta_ts>2004-01-10 15:45:37 +0000</delta_ts>
            <desc>extended spanish translations</desc>
            <filename>catalina-i18n-es.jar</filename>
            <type>text/plain</type>
            <size>10690</size>
            <attacher name="Jesus Marin">jesus</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>9991</attachid>
            <date>2004-01-17 03:20:00 +0000</date>
            <delta_ts>2004-01-17 03:20:37 +0000</delta_ts>
            <desc>New file for jakarta-servletapi-5 jsr154</desc>
            <filename>LocalStrings_es.properties</filename>
            <type>text/plain</type>
            <size>161</size>
            <attacher name="Larry Isaacs">Larry.Isaacs</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>9992</attachid>
            <date>2004-01-17 03:21:00 +0000</date>
            <delta_ts>2004-01-17 03:21:18 +0000</delta_ts>
            <desc>Patch for jakarta-servletapi-5 jsr154</desc>
            <filename>LocalStrings_es.properties.diff</filename>
            <type>text/plain</type>
            <size>1626</size>
            <attacher name="Larry Isaacs">Larry.Isaacs</attacher>
            

          </attachment>
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>26051</bug_id>
          
          <creation_ts>2004-01-12 07:42:00 +0000</creation_ts>
          <short_desc>HttpSession gets invalidated during service()</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.16</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P5</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jarno Peltoniemi">jarno.peltoniemi</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>promine</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>50384</commentid>
    <comment_count>0</comment_count>
    <who name="Jarno Peltoniemi">jarno.peltoniemi</who>
    <bug_when>2004-01-12 07:42:40 +0000</bug_when>
    <thetext>According to the SRV.7.5 in the Servlet spec v2.4:
"The session invalidation will not take effect until all servlets using that
session have exited the service method."

Tomcat doesn't try to ensure this in any way.

To reproduce, use a servlet with session-timeout 1 and put the following code to
the service method:

HttpSession session = request.getSession();
Thread.sleep(120);
session.getLastAccessedTime(); // InvalidStateException gets thrown</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50397</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-12 10:12:49 +0000</bug_when>
    <thetext>Indeed. As I don't see how to implement this (trying to keep a state flag would
be a nightmare, and there's no real way to know the state since it is
multithreaded), this will not be fixed. Session expiration was calculated wrong,
and this was fixed. This could help a lot for this case.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50402</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-12 13:10:47 +0000</bug_when>
    <thetext>I should assume we will find a way to fix this, somehow.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50886</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-21 15:46:26 +0000</bug_when>
    <thetext>.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50888</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-21 15:48:33 +0000</bug_when>
    <thetext>I have attempted to fix this, using the algorithm you suggested. It could cause
regressions, so it might be reverted. For now, this should be fixed in the CVS code.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50915</commentid>
    <comment_count>5</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-21 21:34:56 +0000</bug_when>
    <thetext>*** Bug 26324 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>26106</bug_id>
          
          <creation_ts>2004-01-13 19:38:00 +0000</creation_ts>
          <short_desc>server.xml: setting Manager/pathname="" disable session persistence</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Documentation</component>
          <version>5.0.16</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>http://http://</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Gilles Levreau">gilles</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>50491</commentid>
    <comment_count>0</comment_count>
    <who name="Gilles Levreau">gilles</who>
    <bug_when>2004-01-13 19:38:20 +0000</bug_when>
    <thetext>Documentation page to enhance: tomcat-docs/config/manager.html

By default tomcat 5 standard session manager enforces session persistence
through tomcat shutdown/restart, which means all session attributes have to be
serialisable.

It would be nice to mention that by defining a Manager element inside a Context
element, and setting the pathname attribute to an empty string disable session
persistence.

I guess this could be mentioned in the section 'Restart Persistence' at the end
of the page.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50531</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-14 09:59:18 +0000</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>26135</bug_id>
          
          <creation_ts>2004-01-14 17:27:00 +0000</creation_ts>
          <short_desc>Tomcat 5.0.16 leaks memory when a webapp is reloaded or stopped/started</short_desc>
          <delta_ts>2005-10-18 03:24:59 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.16</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Joe Porcheddu">jporche</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>james.norman</cc>
    
    <cc>jqs</cc>
    
    <cc>rflament</cc>
          <votes>1</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>50555</commentid>
    <comment_count>0</comment_count>
    <who name="Joe Porcheddu">jporche</who>
    <bug_when>2004-01-14 17:27:47 +0000</bug_when>
    <thetext>Tomcat 5.0.16 leaks a lot of memory when a webapp is reloaded. To duplicate, 
start Tomcat.

Open Windows Task manager and view memory information for the java.exe process.

Go to Tomcat Manager.

Reload Tomcat Admin webapp.

Memory will increase for each reload request.  Memory also leaks when 
stopping/starting a webapp, but not as much as reload.  I lost about 15 
megabytes of memory after about 10 reload requests.  I waited about 10 to 15 
minutes to see if memory ever went back down, but it never did.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50556</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-14 17:34:10 +0000</bug_when>
    <thetext>Please post on tomcat-user about this. This is a recurrent non issue.
If you want to reopen this bug, please use a profiler and point out leaked
references (under Tomcat's control, obviously).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51357</commentid>
    <comment_count>2</comment_count>
    <who name="Jeffrey Steele">jqs</who>
    <bug_when>2004-01-28 23:54:21 +0000</bug_when>
    <thetext>I believe this is a bug within Tomcat...

Here is a way to replicate it:

Use the Struts blank war.
Available here:
http://mirrors.isc.org/pub/apache/jakarta/struts/binaries/jakarta-struts-1.1.zip

Load that webapp, and open two browser windows, one to the Tomcat Manager and
one to the Tomcat Status page.  View the available memory.  You will see it
cycle within a meg as garbage collection is run.  Then use Tomcat Manager to
reload the struts webapp.  The free memory should now be a meg less.  This will
continue until you reach 0, when a major garbage collection will occur, but it
just looks like memory is released, as the Total Memory usage has now increased.
 You can continue this cycle until the memory reaches the total allocated, and
Tomcat will fall over.

If this is truly a "non issue", then I feel the Tomcat developers need to answer
this issue more directly (like the release notes).

We have customers that run multiple occurrences of our webapp under a single
Tomcat, and need to reload... With the leak... they end up having to restart
Tomcat to free the memory... causing support issues.

I look forward to become more educated on why this is (not) an issue...</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51382</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-29 08:35:20 +0000</bug_when>
    <thetext>I looked into that already. While the classloader is not being garbage collected
(this is the only object not being GCed) due to an unknown reason, no references
are kept to it (as seen in a profiler), so from the Tomcat programming
perspective, there's nothing to fix. Many "simple" webapps reload without
leaking memory, but Struts webapps seem to pose a problem. Of course, there are
also ways for a shared library to cause GC trouble when reloading, and this
cannot be fixed, so you cannot assume a webapp reload will never leak memory.

There's nothing in the release notes, because there's no conclusive information
available.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>68542</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-12-15 00:40:43 +0000</bug_when>
    <thetext>*** Bug 32709 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>68582</commentid>
    <comment_count>5</comment_count>
    <who name="James Norman">james.norman</who>
    <bug_when>2004-12-15 17:46:44 +0000</bug_when>
    <thetext>I would have to agree, a memory leak of this magnitude renders the Manager
application useless.  If this is something that the Tomcat team will not
address, it should be noted in the release notes, or in the Manager App HOW-TO.
 Our organization made number of decisions based on the functionality of the
Manager app that were thrown out once we observed this memory leak.  Although
there may be no conclusive evidence showing this is a problem in Tomcat, a
number of people have consistently observed this behavior in the Manager
application, and would agree that it is not desired behavior.  To save other
organizations from going through the problems we did, a simple blurb about this
known behavior would be more that appreciated.

Thanks,
James Norman</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>70064</commentid>
    <comment_count>6</comment_count>
    <who name="Tobias L">tobias</who>
    <bug_when>2005-01-25 13:21:02 +0000</bug_when>
    <thetext>After seaching the net I found that there indeed exists a problem with Struts 
that prevents web app class loaders from beeing garbage collected. The problem 
is that java beans information used by Struts is cached by 
java.beans.Introspector and never removed. A call to one of the methods 
java.beans.Introspector.flushCaches(), java.beans.Introspector.flushCaches
(Class) or org.apache.commons.beanutils.PropertyUtilsBean.clearDescriptors() 
would solve this.

After doing a bit more searching I found that the Spring framework solves this 
problem by providing a servlet context listener class 
(http://www.springframework.org/docs/api/org/springframework/web/util/Introspec
torCleanupListener.html) that calls Introspector.flushCaches() when a context 
is destroyed. 

To test this, I modified the web.xml of the struts-examples web app to include 
a listener definition using IntrospectorCleanupListener. After that I ran the 
WebPageConnector test program posted by James Norman on bug 32709. The program 
ran over 1500 redeploys before i turned it off, at which time the memory 
consumed by Tomcat (5.5) was about 30MB. Before the modification the program 
could only run about 110 redeploys before an OutOfMemoryError occurred.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>70065</commentid>
    <comment_count>7</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2005-01-25 14:13:38 +0000</bug_when>
    <thetext>Very good finding !
I think I will add that to the stop method of the classloader, like there is a
method to clear the classloader in commons-logging.

This is a very sneaky issue as the references to the classloader are never
displayed by profilers ... Any other cool features like this in the JDK ?

The comment in the JDK source is hilarious:

    /**
     * Flush all of the Introspector's internal caches.  This method is
     * not normally required.  It is normally only needed by advanced
     * tools that update existing "Class" objects in-place and need
     * to make the Introspector re-analyze existing Class objects.
     */
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>70124</commentid>
    <comment_count>8</comment_count>
    <who name="James Norman">james.norman</who>
    <bug_when>2005-01-26 22:31:57 +0000</bug_when>
    <thetext>That got it.  Thanks to all who resolved this, we can now run multiple apps
inside of 1 tomcat.

&lt;snip&gt;
  Any other cool features like this in the JDK ?
&lt;/snip&gt;

Just that super cool System.getProperties()

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>70547</commentid>
    <comment_count>9</comment_count>
    <who name="Jacob Kjome">hoju</who>
    <bug_when>2005-02-05 19:05:04 +0000</bug_when>
    <thetext>This is the same solution as was found previously in the following two bugs...
http://issues.apache.org/bugzilla/show_bug.cgi?id=26372
http://issues.apache.org/bugzilla/show_bug.cgi?id=27371

The solution was originally (as far as I know) found here...
http://marc.theaimsgroup.com/?t=109578393000004&amp;r=1&amp;w=2


It would have been nice to have recognized this information back in September
'04 when Yoav posted references to the solution rather than having to re-figure
it out independently in January '05 and finaly take action.  In any case, I'm
glad it is finally fixed!


Jake</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>78823</commentid>
    <comment_count>10</comment_count>
    <who name="Gili">cowwoc</who>
    <bug_when>2005-08-22 17:57:58 +0000</bug_when>
    <thetext>This issue is incorrectly closed as WON'T FIX even though the 5.5.8 changelog
marks it as fixed. Please reclose it as fixed.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>78826</commentid>
    <comment_count>11</comment_count>
    <who name="Gili">cowwoc</who>
    <bug_when>2005-08-22 18:18:42 +0000</bug_when>
    <thetext>Oops, I can do this myself :)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>81303</commentid>
    <comment_count>12</comment_count>
    <who name="Robert Longson">robert_longson</who>
    <bug_when>2005-10-18 11:24:59 +0000</bug_when>
    <thetext>*** Bug 36548 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>26147</bug_id>
          
          <creation_ts>2004-01-15 01:45:00 +0000</creation_ts>
          <short_desc>xsi:schemaLocation</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Examples</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="T.V. Raju">rajutv</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>50576</commentid>
    <comment_count>0</comment_count>
    <who name="T.V. Raju">rajutv</who>
    <bug_when>2004-01-15 01:45:03 +0000</bug_when>
    <thetext>Hi

I had verified xsi:schemaLocation in web.xml file under '/webapps/jsp-
examples/WEB-INF/' folder, it shows
   xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee web-app_2_4.xsd"

correct location is
xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"


And also same in all web.xml files.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50600</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-15 13:24:51 +0000</bug_when>
    <thetext>Fixed. Thanks.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50604</commentid>
    <comment_count>2</comment_count>
    <who name="Ias">iasandcb</who>
    <bug_when>2004-01-15 16:58:38 +0000</bug_when>
    <thetext>According to XML Schema 1.0 spec at http://www.w3.org/TR/xmlschema-
0/#schemaLocation,

The schemaLocation attribute contains pairs of values: The first member of 
each pair is the namespace for which the second member is the hint describing 
where to find to an appropriate schema document.

Here's an excerpt from Sun's J2EE 1.4 RI samples:

&lt;web-app version="2.4" xmlns="http://java.sun.com/xml/ns/j2ee" 
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee 
http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"&gt;

I guess 

xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee web-app_2_4.xsd"

can be validly used by some catalog system (equipped in Tomcat).

In conclusion, 
http://marc.theaimsgroup.com/?l=tomcat-dev&amp;m=107417121117386&amp;w=2
should be rolled back or 

xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee 
http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"

can be another alternative.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50606</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-15 17:19:43 +0000</bug_when>
    <thetext>Thanks for the comments. I checked in the specification this time.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>26162</bug_id>
          
          <creation_ts>2004-01-15 11:59:00 +0000</creation_ts>
          <short_desc>Typo in conf/server-minimal.xml</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.0.17</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Yann Cébron">yannc76</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>50591</commentid>
    <comment_count>0</comment_count>
    <who name="Yann Cébron">yannc76</who>
    <bug_when>2004-01-15 11:59:09 +0000</bug_when>
    <thetext>Line 14 has a typo which prevents the MemoryUserDatabaseFactory to work:

&lt;name&gt;pathaame&lt;/name&gt;
          ^ 

should be changed to

&lt;name&gt;pathname&lt;/name&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50597</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-15 12:58:00 +0000</bug_when>
    <thetext>Fixed. Thanks.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>26171</bug_id>
          
          <creation_ts>2004-01-15 16:09:00 +0000</creation_ts>
          <short_desc>NullPointerException in AccessLogValve</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina:Modules</component>
          <version>5.0.16</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Stefan Armbruster">sarmbruster</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>50601</commentid>
    <comment_count>0</comment_count>
    <who name="Stefan Armbruster">sarmbruster</who>
    <bug_when>2004-01-15 16:09:49 +0000</bug_when>
    <thetext>context.xml contains a AccessLogValve. After "install" (via ant task) everything
works. A subsequent "remove" and "install" of the same webapp cause the error
below after pressing the reload button  in an existing session in the client
browser:

15.01.2004 16:39:50 org.apache.coyote.tomcat5.CoyoteAdapter service
SCHWERWIEGEND: An exception or error occurred in the container during the
request processing
java.lang.NullPointerException
        at
org.apache.catalina.valves.AccessLogValve.getDate(AccessLogValve.java:1030)
        at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:589)
        at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)
        at
org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)
        at
org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:195)
        at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
        at
org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:164)
        at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)
        at
org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)
        at
org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:156)
        at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
        at
org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)
        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)
        at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:211)
        at
org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:805)
        at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:696)
        at
org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:605)
        at
org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:677)
        at java.lang.Thread.run(Thread.java:534)

Looks like currentDate is not initialized under certain circumstances.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50602</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-01-15 16:20:59 +0000</bug_when>
    <thetext>Added a null check in the relevant method, which will generate a new date 
object only if needed.  I wonder why the lifecycle start wasn't taking care of 
this.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>26191</bug_id>
          
          <creation_ts>2004-01-16 11:37:00 +0000</creation_ts>
          <short_desc>ClassCastException in JspDocumentParser</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.16</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Trond Aasan">trond</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>50641</commentid>
    <comment_count>0</comment_count>
    <who name="Trond Aasan">trond</who>
    <bug_when>2004-01-16 11:37:07 +0000</bug_when>
    <thetext>from JspDocumentParser.java Revision: 1.74
lines 233-240
        } catch (Exception e) {
            jspDocParser.err.jspError(
                new Mark(
                    path,
                    ((SAXParseException)e).getLineNumber(),
                    ((SAXParseException)e).getColumnNumber()),
                e.getMessage());
        }


SAXException thrown at line 1057 of JspDocumentParser.java results in
ClassCastException</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50642</commentid>
    <comment_count>1</comment_count>
      <attachid>9976</attachid>
    <who name="Trond Aasan">trond</who>
    <bug_when>2004-01-16 11:42:17 +0000</bug_when>
    <thetext>Created attachment 9976
Proposed patch</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50643</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-16 11:45:38 +0000</bug_when>
    <thetext>I have to agree the code is usafe. It probably should be:
} catch (SAXParseException e) {
  // Do what we currently do
} catch (SAXException e) {
  // Reduced functionality (no line info)
} catch (Exception e) {
  // Unexpected error
}</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50723</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-19 10:34:47 +0000</bug_when>
    <thetext>Fixed. Thanks.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>9976</attachid>
            <date>2004-01-16 11:42:00 +0000</date>
            <delta_ts>2004-01-16 11:42:17 +0000</delta_ts>
            <desc>Proposed patch</desc>
            <filename>patchfile.txt</filename>
            <type>text/plain</type>
            <size>797</size>
            <attacher name="Trond Aasan">trond</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>26229</bug_id>
          
          <creation_ts>2004-01-18 12:22:00 +0000</creation_ts>
          <short_desc>request.getRemoteUser() = null</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:AJP</component>
          <version>Nightly Build</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Søren Blidorf">soren</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>mramshaw</cc>
    
    <cc>soren</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>50692</commentid>
    <comment_count>0</comment_count>
    <who name="Søren Blidorf">soren</who>
    <bug_when>2004-01-18 12:22:09 +0000</bug_when>
    <thetext>I have made a new installation of Tomcat 4.1.29 on my new DELL laptop running 
XP.

I have copied the project to the new laptop and try set it up to work as on my 
work machine.

I am not able to get the login to work. I am using the &lt;security-constraint&gt; in 
my web.xml.

At first I could not get the FORM login to work only BASIC. Then I changed the 
FORM action to &lt;%= response.encodeURL("j_security_check") %&gt;, and I was able 
use FORM login.

The next problem is that the auth is only accepted for the page that activated 
the FORM page. For example &lt;url-pattern&gt;/public/*&lt;/url-pattern&gt; contains 
test.jsp and test2.jsp and when I link to test.jsp the FORM page is called. 
When succesfully logged in the request.getRemoteUser() is correct. But when I 
then link from there to test2.jsp the request.getRemoteUser() is NULL and the 
FORM page is called again.

Please let me know if I sould send more info.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50693</commentid>
    <comment_count>1</comment_count>
    <who name="Søren Blidorf">soren</who>
    <bug_when>2004-01-18 13:20:18 +0000</bug_when>
    <thetext>Also when I have logged on to a page and press F5 (refresh) the FORM page is 
called and remoteUser is NULL.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50696</commentid>
    <comment_count>2</comment_count>
    <who name="Søren Blidorf">soren</who>
    <bug_when>2004-01-18 15:53:55 +0000</bug_when>
    <thetext>Sorry. The following is a mistake:
******************************************
"Also when I have logged on to a page and press F5 (refresh) the FORM page is 
called and remoteUser is NULL."
******************************************</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50897</commentid>
    <comment_count>3</comment_count>
    <who name="Søren Blidorf">soren</who>
    <bug_when>2004-01-21 17:45:07 +0000</bug_when>
    <thetext>I know what is causing the problem now. It is one of the newest "important 
updates" from Microsoft Update for XP.

More specificly:

824145 Internet Explorer 6.0 security update.

When uninstalling, it works again!</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52226</commentid>
    <comment_count>4</comment_count>
    <who name="Paul Boddie">paul</who>
    <bug_when>2004-02-13 08:34:50 +0000</bug_when>
    <thetext>This isn't a browser-specific thing as far as I can see - I've tested with
Mozilla and IE.

Apache 1.3.29, JK2 2.0.2, Tomcat 4.1.29 all conspire (even with the
request.tomcatAuthentication=false setting in jk2.properties) to somehow pass on
the appropriate headers, yet the remoteUser just isn't available to applications
- in my case, that's a Cocoon 2.1.3 application, but the Cocoon stuff doesn't
seem to be at fault.

However, it all works fine in Tomcat 4.1.27, so I should imagine that something
changed between Tomcat releases and it all stopped working. Either that or the
Cocoon developers misunderstood some subtle aspect of the servlet specification,
but that doesn't seem likely to me.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57060</commentid>
    <comment_count>5</comment_count>
    <who name="Martin Ramshaw">mramshaw</who>
    <bug_when>2004-05-09 21:02:39 +0000</bug_when>
    <thetext>I've experienced this as well. Ths solution seems to be to disable the native 
Tomcat authentication on the connector as follows: 
 
    &lt;!-- Define a Coyote/JK2 AJP 1.3 Connector on port 8009 --&gt; 
    &lt;Connector className="org.apache.coyote.tomcat4.CoyoteConnector" 
               port="8009" minProcessors="5" maxProcessors="75" 
               enableLookups="true" redirectPort="8443" 
               acceptCount="10" debug="0" connectionTimeout="0" 
               useURIValidationHack="false" tomcatAuthentication="false" 
 
(The important part of the above being &lt;b&gt;tomcatAuthentication="false"&lt;/b&gt;.) 
 
I will follow up on this and let you know if it fixes my problem. Are the rest 
of you able to verify that this is indeed the solution (in which case I will 
close this bug) ? </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59575</commentid>
    <comment_count>6</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2004-06-19 12:24:13 +0000</bug_when>
    <thetext>This bug report has been transferred to Tomcat 5 because TC4 and TC5 share the 
connectors and TC5 is now the focus of development effort</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60927</commentid>
    <comment_count>7</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-07-21 18:42:45 +0000</bug_when>
    <thetext>Yup, you need to turn that off.  In Tomcat 5, it's called clientAuth instead of 
tomcatAuthentication, and the Connector and SSL documentation pages have been 
updated to reflect the attribute name change.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>26237</bug_id>
          
          <creation_ts>2004-01-19 10:27:00 +0000</creation_ts>
          <short_desc>Use of absolute path for MemoryUserDatabase file may cause problem</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.16</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Xavier Poinsard">xpoinsard</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>50721</commentid>
    <comment_count>0</comment_count>
    <who name="Xavier Poinsard">xpoinsard</who>
    <bug_when>2004-01-19 10:27:58 +0000</bug_when>
    <thetext>I found a typo in MemoryUserDatabase.java line 555 with handling of absolute path</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50722</commentid>
    <comment_count>1</comment_count>
      <attachid>10005</attachid>
    <who name="Xavier Poinsard">xpoinsard</who>
    <bug_when>2004-01-19 10:28:36 +0000</bug_when>
    <thetext>Created attachment 10005
patch to correct typo</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50724</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-19 10:39:15 +0000</bug_when>
    <thetext>Fixed. Thanks.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>10005</attachid>
            <date>2004-01-19 10:28:00 +0000</date>
            <delta_ts>2004-01-19 10:28:36 +0000</delta_ts>
            <desc>patch to correct typo</desc>
            <filename>patchFileOldAbsolute</filename>
            <type>text/plain</type>
            <size>731</size>
            <attacher name="Xavier Poinsard">xpoinsard</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>26242</bug_id>
          
          <creation_ts>2004-01-19 13:31:00 +0000</creation_ts>
          <short_desc>Changes in jasper command line break ant's &lt;jspc&gt; task</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.16</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Steve Loughran">stevel</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>notifications</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>50734</commentid>
    <comment_count>0</comment_count>
    <who name="Steve Loughran">stevel</who>
    <bug_when>2004-01-19 13:31:50 +0000</bug_when>
    <thetext>Hi,

We are getting reports coming in that the latest releases of jasper are breaking
Ant's &lt;jspc&gt; task, because that sets the verbosity option for output control,
and changes in the args are breaking things. See bugrep #25345 for details.

I think the immediate fix for ant1.6.1 would be to not pass on verbosity info,
but   we are bound to keep getting many reports about the same break with 1.6.0
and 1.5; so please can you bring back the old -v0 style of option, and make
changes to the command mechanism in a more backwards compatible way in future
-where possible.

Ta,</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50738</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-19 15:11:55 +0000</bug_when>
    <thetext>I don't see the point of Ant documenting this, or having the pre declared task.
Any reason for this ? Forward compatibility is one thing, but given other
changes in jspc behavior, I doubt it would still work.

Tomcat now properly documents the task and how to use it.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50742</commentid>
    <comment_count>2</comment_count>
    <who name="Steve Loughran">stevel</who>
    <bug_when>2004-01-19 16:03:43 +0000</bug_when>
    <thetext>Remy,

It is not so much that we document the Jasper task, but that we ship with our
own task which 
is meant to support different back ends:
http://ant.apache.org/manual/OptionalTasks/jspc.html

In theory that is, in practise we have left WebLogic alone until someone was
prepared to write the adapter, so instead it supports various Tomcat 4.x
releases, handling name mapping appropriately.

Given it is therefore purely Jasper-centric (as far as we know), there is a lot
to be said for killing the task and saying 'use the Tomcat supplied one'; I'd be
happy with that as it eliminates all version issues and makes bug hunting
easier. This is something we can discuss for the 1.7 release. 

But in the meantime, there are people out there using the Ant project's jasper
adapter, and that one builds a java command with the -vN option, where N is a
verbosity metric. If that is all that has changed, can we please, please, please
have it back :)

BTW, what other changes have there been that would break stuff? Just so we know
what to expect in bugreps?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50885</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-21 15:45:55 +0000</bug_when>
    <thetext>I've added back the setter.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUILD_SYSTEM">BUILD_SYSTEM</bug_classification></bug>
    <bug>
          <bug_id>26261</bug_id>
          
          <creation_ts>2004-01-19 23:03:00 +0000</creation_ts>
          <short_desc>Another session timeout problem (similar to 25234)</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.16</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Paul Harvey">Paul.Harvey</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>50789</commentid>
    <comment_count>0</comment_count>
    <who name="Paul Harvey">Paul.Harvey</who>
    <bug_when>2004-01-19 23:03:39 +0000</bug_when>
    <thetext>HttpSessionListener called twice on session expiration.

The problem seems to be very similar to 25234.

This time the extra expires() is being called from evaluateIfValid() in
StandardSession (the call to isValid() in evaluateIfValid() also calls 
expires())

I have commented out the extra call to expires() in my version which seems to 
fix the problem.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50791</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-19 23:39:20 +0000</bug_when>
    <thetext>This will happen rarely, though. Thanks.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>26276</bug_id>
          
          <creation_ts>2004-01-20 11:50:00 +0000</creation_ts>
          <short_desc>Generated TLD inconsistent after tagfile changes</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.18</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Robert Krüger">krueger</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>50805</commentid>
    <comment_count>0</comment_count>
    <who name="Robert Krüger">krueger</who>
    <bug_when>2004-01-20 11:50:02 +0000</bug_when>
    <thetext>It seems that the generated TLD is not updated for tagfiles after certain
modifications (e.g. changing attribute names of the tag) and therefore the
generate source code is incorrect. Can easily be reproduced by changing an
attribute's name of a tag in a tag file (the source code is regenerated after
the modification but does not contain the corresponding setter). This indicated
that the generated TLD is not updated to reflect the modification and therfore
the source code is generated on old metadata. See attached webapp for a test
case. Instructions for reproduction are on the startpage of the webapp.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50806</commentid>
    <comment_count>1</comment_count>
      <attachid>10022</attachid>
    <who name="Robert Krüger">krueger</who>
    <bug_when>2004-01-20 11:51:34 +0000</bug_when>
    <thetext>Created attachment 10022
zip file containing test webapp with instructions</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50878</commentid>
    <comment_count>2</comment_count>
    <who name="Robert Krüger">krueger</who>
    <bug_when>2004-01-21 13:50:21 +0000</bug_when>
    <thetext>I did some more research. This is actually what happens: If both the jsp using
the tag and the tagfile have been modified, the tag class is generated but with
an outdated TagInfo, thus the source code contains the old state (e.g. attributes).

This is because the old wrapper is not removed from the wrapperCache in
JspRuntimeContext and the associated CompilationContext containing the outdated
TagInfo is used for generating the tag's source code. After that it's a real
mess because the timestamp of the tag of coures has changed and therefore jasper
thinks the generated tag is up to date.

To fix this I put the following lines in the method Compiler.isOutDated(boolean)

        targetLastModified = targetFile.lastModified();
        if (targetLastModified &lt; jspRealLastModified) {
+            if(ctxt.isTagFile()){
+               ctxt.getRuntimeContext().removeWrapper(ctxt.getJspFile());
+            }
            if (log.isDebugEnabled())
                log.debug("Compiler: outdated: " + targetFile + " " +
targetLastModified);
            return true;
        }

I'm new to jasper and anything but sure that this is a valid solution or if it
has negative side effects but as far as I can see it seems to work. I'm not sure
why removeWrapper is currently only called when a tag file is found to be
modified as part of the dependents list of a jsp (which is why it does not work
now if the jsp was modified as well because isOutDated returns before it gets to
that check).   

 </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51003</commentid>
    <comment_count>3</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-01-22 19:38:14 +0000</bug_when>
    <thetext>Fixed.

You proposed is not quite right, but thanks for reporting, and for taking time
looking for a fix.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>10022</attachid>
            <date>2004-01-20 11:51:00 +0000</date>
            <delta_ts>2004-01-20 11:51:34 +0000</delta_ts>
            <desc>zip file containing test webapp with instructions</desc>
            <filename>tldcache_testapp.zip</filename>
            <type>application/zip</type>
            <size>1718</size>
            <attacher name="Robert Krüger">krueger</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>26335</bug_id>
          
          <creation_ts>2004-01-22 07:52:00 +0000</creation_ts>
          <short_desc>Modification check for tagfiles does not work recursively</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.18</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Robert Krüger">krueger</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>50942</commentid>
    <comment_count>0</comment_count>
    <who name="Robert Krüger">krueger</who>
    <bug_when>2004-01-22 07:52:47 +0000</bug_when>
    <thetext>Example: 
tag1 defined in a tagfile
tag2 defined in a tagfile which uses tag1
tag3 defined in a tagfile which uses tag2
index.jsp uses tag3
tagfile for tag1 is modified, reload of index.jsp does not reflect the changes
despite of development mode. see attached web application for a test case.
instructions to reproduce are on the welcome page.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50943</commentid>
    <comment_count>1</comment_count>
      <attachid>10050</attachid>
    <who name="Robert Krüger">krueger</who>
    <bug_when>2004-01-22 07:53:58 +0000</bug_when>
    <thetext>Created attachment 10050
web application with test case</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51026</commentid>
    <comment_count>2</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-01-23 01:51:51 +0000</bug_when>
    <thetext>Fixed.  Thanks for providing good test case.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>10050</attachid>
            <date>2004-01-22 07:53:00 +0000</date>
            <delta_ts>2004-01-22 07:53:58 +0000</delta_ts>
            <desc>web application with test case</desc>
            <filename>tagfile_modificationcheck_testapp.zip</filename>
            <type>application/zip</type>
            <size>2578</size>
            <attacher name="Robert Krüger">krueger</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>26341</bug_id>
          
          <creation_ts>2004-01-22 09:55:00 +0000</creation_ts>
          <short_desc>It's possible to call getAttribute() while session is invalidated without IAE</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlet &amp; JSP API</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Lars Beuster">lbe.tech</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>jessh</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>50957</commentid>
    <comment_count>0</comment_count>
    <who name="Lars Beuster">lbe.tech</who>
    <bug_when>2004-01-22 09:55:56 +0000</bug_when>
    <thetext>While the session is invalidated all SessionBindingListener are notified with
valueUnbound(). In valueUnbound() it's possible to call e.g. getAttribute() on
the invalidating session without getting an IllegalArgumentException (which
wasn't possible in Tomcat 4.1.29). And according to the servlet-spec (2.3 or
2.4) it shouldn't be possible:

Except from HttpSession-API
...
For session that are invalidated or expire, notifications are sent after the
session has been invalidatd or expired.
...

I would interpret this as: The valueUnbound() should be called AFTER the session
is invalidated and so I have to get an IAE when calling session.getAttribute()
in valueUnbound().

Thanks Lars</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50958</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-22 10:39:36 +0000</bug_when>
    <thetext>I have this big urge about reverting the fix for "bug" 26051, and classify it as
a "this will never be fixed" issue. It would definitely avoid lots of problems.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50967</commentid>
    <comment_count>2</comment_count>
    <who name="Lars Beuster">lbe.tech</who>
    <bug_when>2004-01-22 11:08:37 +0000</bug_when>
    <thetext>If I understand you right, you want to set this bug to "will never be fixed" and
not the other (26051), right?
If this bug won't be fixed, it's not possible for bound objects to determine if
they are unbound because of a normal removeAttribute()-call or a
session-invalidation.
The following scenario is not possible with tomcat 5:
The bound object has to do nothing if the value is simply removed from the
session (e.g. it is replaced by a proxy object and later restored again) and has
to free some resources if the session is invalidated. 
With tomcat 4 I could call session.getAttribute() and catch the IAE to know the
session is invalid (session.isValid() would be a nice method) - this doesn't
work with tomcat 5.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50968</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-22 11:17:14 +0000</bug_when>
    <thetext>I was obviously talking about 26051 (additional fixes are also needed in quite a
few places to really adress it).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50969</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-22 11:23:47 +0000</bug_when>
    <thetext>BTW, this works with 5.0.18, but not with the nightly (because of the new
accessCount check in isValid()), right ? If it doesn't work, I don't understand
how it can be, and recommend you add debug in the StandardSession.expire and
isValid to see what's going on.
I recommend not using the nightlies for now: a few features will be added and
they will not be as stable as what they used to be.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50970</commentid>
    <comment_count>5</comment_count>
    <who name="Lars Beuster">lbe.tech</who>
    <bug_when>2004-01-22 12:17:40 +0000</bug_when>
    <thetext>BTW: In my earlier submits I said IllegalArgumentException but meant
IllegalStateException.

My problem occurs in 5.0.16, 5.0.18, nightly build (01/21/2004) because of the
following code in catalina.session.StandardSession (the implementation-excerpts
below haven't changed since 5.0.16):

invalidate () { expire(); }
expire () { expire(true); }
expire(boolean)
{
this.expiring=true;
//invalidate session
this.expiring=false;
}

getAttribute()
{
if (! isValid()) throw IllegalStateException ();
...
}

isValid()
{
if (this.expiring) return true;
...
}

So while the invalidation the session is always valid.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>50973</commentid>
    <comment_count>6</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-22 13:39:21 +0000</bug_when>
    <thetext>I forgot about the flag. This is contradicting the new policy about the session
being still useable when the expiration notification is sent. I think
confirmation this is as intended is needed, otherwise, notification for
attributes will have to be handled as yet another special case (or we'll have to
decide we don't care).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51075</commentid>
    <comment_count>7</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-01-23 18:56:02 +0000</bug_when>
    <thetext>How about setting "expiring" to FALSE *before* removing any attributes,
and adding a "backdoor" into removeAttribute() that by-passes the validity
check, as follows:

Index: StandardSession.java
===================================================================
RCS file:
/home/cvs/jakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/session/StandardSession.java,v
retrieving revision 1.29
diff -u -r1.29 StandardSession.java
--- StandardSession.java        19 Jan 2004 23:39:05 -0000      1.29
+++ StandardSession.java        22 Jan 2004 22:44:30 -0000
@@ -706,19 +706,24 @@
             if (manager != null)
                 manager.remove(this);

+            /*
+             * Mark session as expired *before* removing its attributes, so
+             * that its HttpSessionBindingListener objects will get an
+             * IllegalStateException when accessing the session attributes
+             * from within their valueUnbound() method
+             */
+            expiring = false;
+
             // Unbind any objects associated with this session
             String keys[] = keys();
             for (int i = 0; i &lt; keys.length; i++)
-                removeAttribute(keys[i], notify);
+                removeAttribute(keys[i], notify, false);

             // Notify interested session event listeners
             if (notify) {
                 fireSessionEvent(Session.SESSION_DESTROYED_EVENT, null);
             }

-            // We have completed expire of this session
-            expiring = false;
-
         }

     }
@@ -1133,7 +1138,7 @@
      */
     public void removeAttribute(String name) {

-        removeAttribute(name, true);
+        removeAttribute(name, true, true);

     }

@@ -1150,14 +1155,17 @@
      * @param name Name of the object to remove from this session.
      * @param notify Should we notify interested listeners that this
      *  attribute is being removed?
+     * @param checkValid Indicates whether IllegalStateException must be
+     * thrown if session has already been invalidated
      *
      * @exception IllegalStateException if this method is called on an
      *  invalidated session
      */
-    public void removeAttribute(String name, boolean notify) {
+    public void removeAttribute(String name, boolean notify,
+                                boolean checkValid) {

         // Validate our current state
-        if (!isValid())
+        if (checkValid &amp;&amp; !isValid())
             throw new IllegalStateException
                 (sm.getString("standardSession.removeAttribute.ise"));
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51080</commentid>
    <comment_count>8</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-23 20:59:03 +0000</bug_when>
    <thetext>Yes, I know how to fix this. Howerver, this is weird when compared to how
sessionDestroyed is handled, so I was wondering if it was valid.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51082</commentid>
    <comment_count>9</comment_count>
    <who name="Jess Holle">jessh</who>
    <bug_when>2004-01-23 21:05:14 +0000</bug_when>
    <thetext>Just a comment:

I have a hard need to be able to getAttribute() from within an
HttpSessionListener's sessionDestroyed() method.  I believe I should be able to
access any/all attributes for the duration of this call, i.e. that attribute
removal and/or invalid-state settings should be after sessionDestroyed() calls.

[The reason I need the attributes is that HttpSessionListener knows/receives
*nothing* apart from the HttpSession.  Oddly enough my listener needs to know
*something* else.]</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51083</commentid>
    <comment_count>10</comment_count>
    <who name="Jess Holle">jessh</who>
    <bug_when>2004-01-23 21:06:04 +0000</bug_when>
    <thetext>To finish my last vague comment:

I put the "something else" my listener needs to know into the session via a filter.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51084</commentid>
    <comment_count>11</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-23 22:29:52 +0000</bug_when>
    <thetext>Yes, inside sessionDestroyed, you should still have all access to the session.
This is new in Servlet 2.4, AFAIK. This should stay in, and I think this is a
problem with Jan's patch. I simply intend to move the remove attribute call
after the expiring = false (and add a protected removeAttributeInternal method,
of course).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51201</commentid>
    <comment_count>12</comment_count>
    <who name="Jess Holle">jessh</who>
    <bug_when>2004-01-26 18:13:04 +0000</bug_when>
    <thetext>Thanks for the heads-up.  My code did indeed fail in Tomcat 4.1 but work fine in
Tomcat 5.0.18.  [I've since fixed it for 4.1 as well.]</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>26373</bug_id>
          
          <creation_ts>2004-01-23 11:56:00 +0000</creation_ts>
          <short_desc>getServletContext().getRequestDispatcher() fails</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlet &amp; JSP API</component>
          <version>5.0.18</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Marc Guillemot">mguillemot</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>51048</commentid>
    <comment_count>0</comment_count>
    <who name="Marc Guillemot">mguillemot</who>
    <bug_when>2004-01-23 11:56:19 +0000</bug_when>
    <thetext>In the init() method of a servlet, I've got the followin code:

rd_ = getServletContext().getRequestDispatcher("/internal/router.do");

with Tomcat 5.0.16, I become null!!!

In Tomcat 4.1.29, this works correctly.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51049</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-23 12:00:53 +0000</bug_when>
    <thetext>I believe this works correctly (many test cases are based on this). Please
submit a ready to use test case (packaged as a minimal .war) if you want to
reopen this.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51261</commentid>
    <comment_count>2</comment_count>
      <attachid>10101</attachid>
    <who name="Marc Guillemot">mguillemot</who>
    <bug_when>2004-01-27 20:11:52 +0000</bug_when>
    <thetext>Created attachment 10101
Web app with a single servlet trying to get a request dispatcher</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51262</commentid>
    <comment_count>3</comment_count>
    <who name="Marc Guillemot">mguillemot</who>
    <bug_when>2004-01-27 20:13:50 +0000</bug_when>
    <thetext>In the attachment 10101 is a mini Webapp working under Tomcat 4.1.29 and failing
under Tomcat 5.0.16 with the following log:

2004-01-27 21:04:11 StandardContext[/TestWebApp2]testServlet: Getting request
dispatcher for path: /toto.jsp
2004-01-27 21:04:11 StandardContext[/TestWebApp2]Error during mapping
java.lang.NullPointerException
        at
org.apache.tomcat.util.http.mapper.Mapper.internalMapWrapper(Mapper.java:644)
        at org.apache.tomcat.util.http.mapper.Mapper.map(Mapper.java:536)
        at
org.apache.catalina.core.ApplicationContext.getRequestDispatcher(ApplicationContext.java:462)
        at
org.apache.catalina.core.ApplicationContextFacade.getRequestDispatcher(ApplicationContextFacade.java:243)
        at de.internetzky.test.TestServlet.init(TestServlet.java:62)
        at javax.servlet.GenericServlet.init(GenericServlet.java:256)
        at
org.apache.catalina.core.StandardWrapper.loadServlet(StandardWrapper.java:1044)
        at org.apache.catalina.core.StandardWrapper.load(StandardWrapper.java:887)
        at
org.apache.catalina.core.StandardContext.loadOnStartup(StandardContext.java:3948)
        at org.apache.catalina.core.StandardContext.start(StandardContext.java:4271)
        at
org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:866)
        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:850)
        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:633)
        at
org.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:316)
        at org.apache.catalina.core.StandardHost.install(StandardHost.java:859)
        at org.apache.catalina.startup.HostConfig.deployWARs(HostConfig.java:653)
        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:472)
        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1002)
        at
org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:393)
        at
org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1133)
        at org.apache.catalina.core.StandardHost.start(StandardHost.java:816)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1125)
        at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:518)
        at org.apache.catalina.core.StandardService.start(StandardService.java:519)
        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2343)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:581)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:398)

2004-01-27 21:04:11 StandardContext[/TestWebApp2]testServlet: rd: null
2004-01-27 21:04:11 StandardContext[/TestWebApp2]Servlet /TestWebApp2 threw
load() exception
javax.servlet.ServletException: Failed initialization of request dispatcher for
path &gt;/toto.jsp&lt;
        at de.internetzky.test.TestServlet.init(TestServlet.java:70)
        at javax.servlet.GenericServlet.init(GenericServlet.java:256)
        at
org.apache.catalina.core.StandardWrapper.loadServlet(StandardWrapper.java:1044)
        at org.apache.catalina.core.StandardWrapper.load(StandardWrapper.java:887)
        at
org.apache.catalina.core.StandardContext.loadOnStartup(StandardContext.java:3948)
        at org.apache.catalina.core.StandardContext.start(StandardContext.java:4271)
        at
org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:866)
        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:850)
        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:633)
        at
org.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:316)
        at org.apache.catalina.core.StandardHost.install(StandardHost.java:859)
        at org.apache.catalina.startup.HostConfig.deployWARs(HostConfig.java:653)
        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:472)
        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1002)
        at
org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:393)
        at
org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1133)
        at org.apache.catalina.core.StandardHost.start(StandardHost.java:816)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1125)
        at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:518)
        at org.apache.catalina.core.StandardService.start(StandardService.java:519)
        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2343)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:581)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:398)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51269</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-27 23:19:38 +0000</bug_when>
    <thetext>Ah, ok, it was only with a load on startup servlet.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51305</commentid>
    <comment_count>5</comment_count>
    <who name="Marc Guillemot">mguillemot</who>
    <bug_when>2004-01-28 18:35:57 +0000</bug_when>
    <thetext>Yes it was "only" with a load on startup servlet. 
Why FIXED? I don't see any mention of such a fix in the changelog of 5.0.17 or
5.0.18. Can you be a bit more explicit. Thanks.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51338</commentid>
    <comment_count>6</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-28 22:09:19 +0000</bug_when>
    <thetext>FIXED = fixed in CVS, will be in the next release.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>10101</attachid>
            <date>2004-01-27 20:11:00 +0000</date>
            <delta_ts>2004-01-27 20:11:52 +0000</delta_ts>
            <desc>Web app with a single servlet trying to get a request dispatcher</desc>
            <filename>TestWebApp2.war</filename>
            <type>application/octet-stream</type>
            <size>4437</size>
            <attacher name="Marc Guillemot">mguillemot</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>26414</bug_id>
          
          <creation_ts>2004-01-25 13:22:00 +0000</creation_ts>
          <short_desc>UserTransaction bound in comp/env Context when using ResourceLink</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.18</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P5</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Robert Krüger">krueger</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>51122</commentid>
    <comment_count>0</comment_count>
    <who name="Robert Krüger">krueger</who>
    <bug_when>2004-01-25 13:22:39 +0000</bug_when>
    <thetext>currently it is not possible to use ResourceLinks to bind a UserTransaction in
the java:comp context of a web application because the way it is implemented
ResourceLinks are always bound in the java:comp/env context. I stumbled across
this because I thought it would make sense to configure my transaction manager
only in one place and have all my webapps access it via ResourceLinks instead of
copying the configuration for each webapp but that did not work. The current
behaviour is a little hard to understand and IMHO it doesn't hurt to treat
ResourceLinks pointing to a UserTransaction differently. I have attached a patch
that does this. Testing the patch I found that the Context implementation does
not seem to throw NameAlreadyBoundException when a name already exists and a
bind fails (therefore after applying the patch you get a warning whenever a
UserTransaction is bound via a ResourceLink). Shall I file this as a separate
report?

Thanks in advance</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51123</commentid>
    <comment_count>1</comment_count>
      <attachid>10082</attachid>
    <who name="Robert Krüger">krueger</who>
    <bug_when>2004-01-25 13:23:49 +0000</bug_when>
    <thetext>Created attachment 10082
Patch for proposed enhancement</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51124</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-25 13:27:56 +0000</bug_when>
    <thetext>I think I'm ok with your patch. However I have a question: did you try to add
the needed resource for the transaction in a DefaultContext ?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51129</commentid>
    <comment_count>3</comment_count>
    <who name="Robert Krüger">krueger</who>
    <bug_when>2004-01-25 15:03:36 +0000</bug_when>
    <thetext>No, I didn't, since in my case I have the webapps sharing the transactionmanager
deployed in separate services. 

BTW I'll attach a patch for the wrong Exception type thrown in
org.apache.naming.NamingContext implementation. Then my other patch will not
create a warning anymore.

 </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51130</commentid>
    <comment_count>4</comment_count>
      <attachid>10083</attachid>
    <who name="Robert Krüger">krueger</who>
    <bug_when>2004-01-25 15:05:00 +0000</bug_when>
    <thetext>Created attachment 10083
Fixes Exception thrown when bind fails because the name is already bound</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51240</commentid>
    <comment_count>5</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-27 12:02:08 +0000</bug_when>
    <thetext>Fixed, thanks.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>10082</attachid>
            <date>2004-01-25 13:23:00 +0000</date>
            <delta_ts>2004-01-25 13:23:49 +0000</delta_ts>
            <desc>Patch for proposed enhancement</desc>
            <filename>usertransaction_jndi.patch</filename>
            <type>text/plain</type>
            <size>1905</size>
            <attacher name="Robert Krüger">krueger</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>10083</attachid>
            <date>2004-01-25 15:05:00 +0000</date>
            <delta_ts>2004-01-25 15:05:00 +0000</delta_ts>
            <desc>Fixes Exception thrown when bind fails because the name is already bound</desc>
            <filename>namingcontext.patch</filename>
            <type>text/plain</type>
            <size>1160</size>
            <attacher name="Robert Krüger">krueger</attacher>
            

          </attachment>
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>26432</bug_id>
          
          <creation_ts>2004-01-26 09:31:00 +0000</creation_ts>
          <short_desc>jsp-property-group url-pattern does not map correctly for paths</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.16</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Vit Timchishin">tivv</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>1</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>51178</commentid>
    <comment_count>0</comment_count>
    <who name="Vit Timchishin">tivv</who>
    <bug_when>2004-01-26 09:31:44 +0000</bug_when>
    <thetext>Currently jsp-property-group url-pattern does not maps correctly for pathes. It
thinks that path url-pattern /xxx/* maps for /xxx/my.jsp but not for
/xxx/yyy/map.jsp.
So, now it is impossible (at least I can't find a way) to map some property
group to all jsp pages: "/" does not go trough validate process (btw:should not
it point to "all" according to specs? specs say that url-pattern is mathes same
as for servlets and for servlets "/" means default servlet - it would be logical
for "/" working as "all") and "/*" means only "pages in the root folder".</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51219</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-01-27 01:25:39 +0000</bug_when>
    <thetext>This is now fixed.  /xxx/* maps /xxx/yyy/map.jsp correctly now.

The url pattern "/" is meaningless in this context, since it is mapped to the
default servlet, so it is ignored.  I'll need to talk with JSP spec lead on this.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>26487</bug_id>
          
          <creation_ts>2004-01-28 10:02:00 +0000</creation_ts>
          <short_desc>JNDIRealm not working - using incorrect filter</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina:Modules</component>
          <version>5.0.18</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>blocker</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jimmi Dyson">jimmidyson</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>ivan.jr</cc>
    
    <cc>sp</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>51289</commentid>
    <comment_count>0</comment_count>
    <who name="Jimmi Dyson">jimmidyson</who>
    <bug_when>2004-01-28 10:02:51 +0000</bug_when>
    <thetext>When using the JNDIRealm, no role checking succeeds. Looking at the debug, this 
is due to an incorrect search filter being created, prepending and appending 
invalid characters (\28 and \29) to the filter. The server.xml works fine on 
previous versions. This occurs on both Windows and Linux. Log output:

2004-01-27 14:48:02 JNDIRealm[Catalina]: Username tomcat successfully 
authenticated
2004-01-27 14:48:02 JNDIRealm[Catalina]:   getRoles(uid=tomcat,dc=test,dc=com)
2004-01-27 14:48:02 JNDIRealm[Catalina]:   Searching role base 'dc=test,dc=com' 
for attribute 'cn'
2004-01-27 14:48:02 JNDIRealm[Catalina]:   With filter expression 
'\28uniqueMember=uid=tomcat,dc=test,dc=com\29'</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51488</commentid>
    <comment_count>1</comment_count>
    <who name="Jeff Tulley">jtulley</who>
    <bug_when>2004-01-30 16:48:39 +0000</bug_when>
    <thetext>I'll look at this and see if it has to do with my recent patch for an encoding 
issue.  Could you please post your realm tag from server.xml, exactly as it 
appears?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51522</commentid>
    <comment_count>2</comment_count>
    <who name="Jimmi Dyson">jimmidyson</who>
    <bug_when>2004-01-31 11:22:01 +0000</bug_when>
    <thetext>Here's my server.xml:

&lt;Server port="8005" shutdown="SHUTDOWN"&gt;
  &lt;Service name="Catalina"&gt;
    &lt;Connector port="8080" /&gt;

    &lt;!-- This is here for compatibility only, not required --&gt;
    &lt;Connector port="8009" protocol="AJP/1.3" /&gt;

    &lt;Engine name="Catalina" defaultHost="localhost"&gt;
      &lt;Logger className="org.apache.catalina.logger.FileLogger" /&gt;

      &lt;Realm	className="org.apache.catalina.realm.JNDIRealm"
                connectionURL="ldap://lldapv.ldn.bzwint.com:389"
      		debug="99" 
      		roleBase="ou=intranet,dc=barcapint,dc=com"
      		roleName="cn" 
      		roleSearch="(uniqueMember={0})" 
      		roleSubtree="true" 
      		userBase="ou=intranet,dc=barcapint,dc=com" 
      		userSearch="uid={0}" 
      		userSubtree="true"
    	/&gt;

      &lt;Host name="localhost" appBase="webapps" /&gt;
    &lt;/Engine&gt;
  &lt;/Service&gt;
&lt;/Server&gt;
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51791</commentid>
    <comment_count>3</comment_count>
    <who name="Jeff Tulley">jtulley</who>
    <bug_when>2004-02-05 23:52:27 +0000</bug_when>
    <thetext>Ahh, I see the problem.  I did the RFC 2254 encoding on the whole search string 
we were using, whereas it should only be done on the DN that the user enters, 
so you would go from a DN of  "some(Strange)Username" to a role search string 
of (uniqueMember=some\28Strange\29Username), not 
\28uniqueMember=some\28Strange\29Username\29
I'll post the simple patch to make the encoding more focused.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51792</commentid>
    <comment_count>4</comment_count>
      <attachid>10244</attachid>
    <who name="Jeff Tulley">jtulley</who>
    <bug_when>2004-02-05 23:54:35 +0000</bug_when>
    <thetext>Created attachment 10244
Simple fix in JNDIRealm for this problem against 5.x source</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51793</commentid>
    <comment_count>5</comment_count>
    <who name="Jeff Tulley">jtulley</who>
    <bug_when>2004-02-06 00:08:12 +0000</bug_when>
    <thetext>If somebody could commit this to Tomcat 5, and back port it (very very simple 
in this case since the JNDIRealm code is nearly identical in the two branches) 
to Tomcat 4, I would be much obliged.  Thanks.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51796</commentid>
    <comment_count>6</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2004-02-06 01:51:21 +0000</bug_when>
    <thetext>Patch applied to tomcat 4.1 and tomcat 5. Thanks Jeff!</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52070</commentid>
    <comment_count>7</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-10 17:59:15 +0000</bug_when>
    <thetext>*** Bug 26834 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52186</commentid>
    <comment_count>8</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-12 13:30:37 +0000</bug_when>
    <thetext>*** Bug 26888 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56543</commentid>
    <comment_count>9</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-04-28 11:21:56 +0000</bug_when>
    <thetext>*** Bug 26834 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>10244</attachid>
            <date>2004-02-05 23:54:00 +0000</date>
            <delta_ts>2004-02-05 23:54:35 +0000</delta_ts>
            <desc>Simple fix in JNDIRealm for this problem against 5.x source</desc>
            <filename>patch.txt</filename>
            <type>text/plain</type>
            <size>823</size>
            <attacher name="Jeff Tulley">jtulley</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>26492</bug_id>
          
          <creation_ts>2004-01-28 14:31:00 +0000</creation_ts>
          <short_desc>Strange Session id behavior</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.0.18</version>
          <rep_platform>Other</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Gretar">grelli</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>51291</commentid>
    <comment_count>0</comment_count>
    <who name="Gretar">grelli</who>
    <bug_when>2004-01-28 14:31:33 +0000</bug_when>
    <thetext>I'm maintaining a JSP/servlet web using SSL, running on Apache 2.0.48 and Tomcat
5.0.18.
Cookies are used for session identifier communication (not url rewriting).

Some users using the web are experiencing very strange session id behaviour, the
behaviour is like this:
When these users make their first request to the web, they already have an
session id that is invalid, i.e. request.getRequestedSessionId() is not null and
the id is not a session id that has been recently created by Tomcat (I've a
session listener in Tomcat that logs session creation and destruction).
As expected, Tomcat creates a new session id for the users (because the session
id is invalid) but the next requests from the users do not use that session id
but instead continue to use the session id that they used in the first request.
 So Tomcat continues to create new session ids for each request, example:

request.getRequestedSessionId()	request.getSession(false).getId()
request.getRequestURI()
01A960C22480CE9F445CDE48DE333F31	451BA13F85AE631148022C93DFDD2811	/first_request.jsp
01A960C22480CE9F445CDE48DE333F31	CBF44C3C065502D6397BC44A7AB659F9
/second_request.jsp
01A960C22480CE9F445CDE48DE333F31	6453C03AF5DD2B9EA1F27D225589E8B2	/third_request.jsp
01A960C22480CE9F445CDE48DE333F31	93F173966F28A972A2E70C32CC8E848B
/fourth_request.jsp

If the users close their browser and try again - they (most often) continue to
have the same problem but request.getRequestedSessionId() is not the same as it
was at last time...

What could be the reason for this behaviour?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51300</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-28 17:37:24 +0000</bug_when>
    <thetext>This works reasonably well. However, if the client submits more that one session
cookie, only the first one is takes into account right now. I think there's a
bug or enhancement about that for 4.1.x.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51301</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-01-28 18:18:20 +0000</bug_when>
    <thetext>I've fixed this.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51396</commentid>
    <comment_count>3</comment_count>
    <who name="Gretar">grelli</who>
    <bug_when>2004-01-29 14:18:06 +0000</bug_when>
    <thetext>Thanks Remy for your reply's to this "bug" if is a bug in TomCat. 

As I understand from your reply's there are some fix to this problem. Is the fix
in the nightly build ore ca I get it by other ways?</thetext>
  </long_desc>
      
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>26567</bug_id>
          
          <creation_ts>2004-01-31 18:30:00 +0000</creation_ts>
          <short_desc>defaultHost='' incorrect causes no error</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.18</version>
          <rep_platform>All</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Alex Milowski">alex</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>51526</commentid>
    <comment_count>0</comment_count>
    <who name="Alex Milowski">alex</who>
    <bug_when>2004-01-31 18:30:12 +0000</bug_when>
    <thetext>When the defaultHost attribute on Engine is not correctly pointing to a Host
element's name, there are no errors generated and no error documents are returned
to the web browser.  This can cause, in my case, many hours of "debugging" until
you realize this.  In fact, no log entries are generated for access, etc.

This is a big "useability" issue for setting up new servers.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51601</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-02 17:36:32 +0000</bug_when>
    <thetext>Fixed. A warning message will now be logged during initialization.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>26611</bug_id>
          
          <creation_ts>2004-02-02 18:36:00 +0000</creation_ts>
          <short_desc>Improper handling of javax.servlet.forward.request_uri during a forward and then an include</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.18</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Kris Schneider">kschneider</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>kschneider</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>51609</commentid>
    <comment_count>0</comment_count>
    <who name="Kris Schneider">kschneider</who>
    <bug_when>2004-02-02 18:36:06 +0000</bug_when>
    <thetext>Basically, it looks like "javax.servlet.forward.request_uri" is part of the
enumeration returned by request.getAttributeNames even though
request.getAttribute("javax.servlet.forward.request_uri") returns null. Here's a
simple test setup:

forward.jsp:
------------
&lt;jsp:forward page="${param.forward}"/&gt;

include.jsp:
------------
&lt;%@ page contentType="text/plain" %&gt;
&lt;jsp:include page="${param.include}"/&gt;

process.jsp:
------------
&lt;%@ page contentType="text/plain" %&gt;
&lt;%@ page import="java.util.*" %&gt;

&lt;%
ArrayList attrNames = Collections.list(request.getAttributeNames());
pageContext.setAttribute("include.request_uri.name",
                        
Boolean.valueOf(attrNames.contains("javax.servlet.include.request_uri")));
pageContext.setAttribute("forward.request_uri.name",
                        
Boolean.valueOf(attrNames.contains("javax.servlet.forward.request_uri")));
%&gt;

include.request_uri name: ${pageScope['include.request_uri.name']}
include.request_uri value: ${requestScope['javax.servlet.include.request_uri']}
forward.request_uri name: ${pageScope['forward.request_uri.name']}
forward.request_uri value: ${requestScope['javax.servlet.forward.request_uri']}

So, if you request:

forward.jsp?forward=include.jsp&amp;include=process.jsp

You'll get the following:

include.request_uri name: true
include.request_uri value: /process.jsp
forward.request_uri name: true
forward.request_uri value:</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51613</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-02 19:39:06 +0000</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>26628</bug_id>
          
          <creation_ts>2004-02-03 11:11:00 +0000</creation_ts>
          <short_desc>Function without parameters never found</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.18</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ronald Wildenberg">ronald</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>krueger</cc>
    
    <cc>tivv</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>51652</commentid>
    <comment_count>0</comment_count>
    <who name="Ronald Wildenberg">ronald</who>
    <bug_when>2004-02-03 11:11:57 +0000</bug_when>
    <thetext>I have a very simple function call in a JSP page:

   ${test:foo()}

This function is defined in my taglib as:

   &lt;function&gt;
      &lt;name&gt;foo&lt;/name&gt;
      &lt;function-class&gt;functions.Foo&lt;/function-class&gt;
      &lt;function-signature&gt;java.lang.String foo()&lt;/function-signature&gt;
   &lt;/function&gt;

No parameters are to be provided. However, the method

   org.apache.jasper.compiler.Validator#getParameters(ELNode.Function)

assumes that parameters are always present. In the abscence of
parameters, an attempt is made to load a class ".class", which is
of course not found by any classloader.

I will attach a simple test case for this bug as a war file.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51653</commentid>
    <comment_count>1</comment_count>
      <attachid>10201</attachid>
    <who name="Ronald Wildenberg">ronald</who>
    <bug_when>2004-02-03 11:13:23 +0000</bug_when>
    <thetext>Created attachment 10201
Test case for this bug (scwcd/jsp/test.jsp).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51655</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-03 12:17:24 +0000</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52350</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-16 15:42:30 +0000</bug_when>
    <thetext>*** Bug 26974 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56014</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-04-19 11:53:38 +0000</bug_when>
    <thetext>*** Bug 28466 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>10201</attachid>
            <date>2004-02-03 11:13:00 +0000</date>
            <delta_ts>2004-02-03 11:13:23 +0000</delta_ts>
            <desc>Test case for this bug (scwcd/jsp/test.jsp).</desc>
            <filename>scwcd.war</filename>
            <type>application/octet-stream</type>
            <size>2933</size>
            <attacher name="Ronald Wildenberg">ronald</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>26662</bug_id>
          
          <creation_ts>2004-02-04 15:53:00 +0000</creation_ts>
          <short_desc>ClassCastException in GzipOutputFilter</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:Coyote</component>
          <version>5.0.18</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="John Trollinger">jakarta</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>tidoublemy</cc>
          <votes>1</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>51704</commentid>
    <comment_count>0</comment_count>
    <who name="John Trollinger">jakarta</who>
    <bug_when>2004-02-04 15:53:14 +0000</bug_when>
    <thetext>When using the compression filter included with the coyote connector I get 
ClassCastException's when navigating our site.  It is at line 165 in the 
GzipOutputFilter

159     public long end()
160        throws IOException {
161        if (compressionStream == null) {
162            compressionStream = new GZIPOutputStream(fakeOutputStream);
163        }
164        compressionStream.finish();
165        return ((OutputFilter) buffer).end();
166    }

the buffer being cast into an OutputFilter is not always an OutputFilter as 
show in InternalOutputBuffer line 309 

306    public void addActiveFilter(OutputFilter filter) {
307
308        if (lastActiveFilter == -1) {
309            filter.setBuffer(outputStreamOutputBuffer);
310        } else {
311            for (int i = 0; i &lt;= lastActiveFilter; i++) {
312                if (activeFilters[i] == filter)
313                    return;
314            }
315            filter.setBuffer(activeFilters[lastActiveFilter]);
316        }
317
318        activeFilters[++lastActiveFilter] = filter;
319
320        filter.setResponse(response);
321
322    } 

as you can see if lastActiveFilter = -1 then the buffer is set to 
outputStreamOutputBuffer which is an OutputStreamOutputBuffer which inherits 
from OutputBuffer not OutputFilter so the cast fails.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51705</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-04 15:59:12 +0000</bug_when>
    <thetext>Long time since I last heard about your reports. Now you'll see that this must
be wrapped with another filter for content delimitation (either identity or
chunked), which can be safely cast. If this doesn't happen, then you have a bug,
but quite frankly I really doubt it.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51706</commentid>
    <comment_count>2</comment_count>
    <who name="John Trollinger">jakarta</who>
    <bug_when>2004-02-04 16:09:18 +0000</bug_when>
    <thetext>Remy,

I did not think you read my bug reports, I though you would have filtered them 
by now.. :-)

I understand what you are saying, but I keep getting the following stacktrace...

ava.lang.ClassCastException
	at org.apache.coyote.http11.filters.GzipOutputFilter.end
(GzipOutputFilter.java:165)
	at org.apache.coyote.http11.InternalOutputBuffer.endRequest
(InternalOutputBuffer.java:439)
	at org.apache.coyote.http11.Http11Processor.action
(Http11Processor.java:968)
	at org.apache.coyote.Response.action(Response.java:226)
	at org.apache.coyote.Response.finish(Response.java:348)
	at org.apache.coyote.tomcat5.OutputBuffer.close(OutputBuffer.java:328)
	at org.apache.coyote.tomcat5.CoyoteResponse.finishResponse
(CoyoteResponse.java:497)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service
(CoyoteAdapter.java:209)
	at org.apache.coyote.http11.Http11Processor.process
(Http11Processor.java:828)
	at 
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio
n(Http11Protocol.java:700)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt
(PoolTcpEndpoint.java:584)
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run
(ThreadPool.java:683)
	at java.lang.Thread.run(Thread.java:536)

This would indicate to me that it is a bug..


</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51711</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-04 16:23:51 +0000</bug_when>
    <thetext>So basically, you are complining about stacktraces in your logs, right ?
"I get ClassCastException's when navigating our site" would be translated by a
normal guy as: I see the stacktrace in my browser.
Maybe it could happen when finishing an error request.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51713</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-04 16:39:25 +0000</bug_when>
    <thetext>I added a filter for the only branch of the if which wasn't adding a filter. I
don't quite understand when this branch code was being run; possibly in the case
of an error. So this is fixed.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51722</commentid>
    <comment_count>5</comment_count>
    <who name="John Trollinger">jakarta</who>
    <bug_when>2004-02-04 17:34:44 +0000</bug_when>
    <thetext>I know it seems silly (believe me I know!!) but I just do as management tells 
me to and they wanted me to see if I could get it fixed.. </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51729</commentid>
    <comment_count>6</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-04 19:44:08 +0000</bug_when>
    <thetext>Okidoki. Feel free to test the patch.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51764</commentid>
    <comment_count>7</comment_count>
    <who name="John Trollinger">jakarta</who>
    <bug_when>2004-02-05 13:47:35 +0000</bug_when>
    <thetext>Remy,

The fix did not work.. I still get the classcastexception.  The stacktrace is 
the same..

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51770</commentid>
    <comment_count>8</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-05 17:10:04 +0000</bug_when>
    <thetext>Sure. Please provide a test case (test telnet request + servlet or JSP if needed).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52896</commentid>
    <comment_count>9</comment_count>
    <who name="Tim Shirley">tidoublemy</who>
    <bug_when>2004-02-24 23:16:20 +0000</bug_when>
    <thetext>*** Bug 27197 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54180</commentid>
    <comment_count>10</comment_count>
    <who name="John Trollinger">jakarta</who>
    <bug_when>2004-03-17 19:23:49 +0000</bug_when>
    <thetext>
I found what was causing the class cast exception.  The maxKeepAliveRequests is 
set to 100.  If more than 100 requests are sent to that connection then the 
Http11Processor.process() sets keepAlive to false (which is the correct 
behavior) but when Http11Processor.processResponse() is called the following 
code 

1485        if (contentLength != -1) {
1486            response.getMimeHeaders().setValue("Content-Length")
1487                .setInt(contentLength);
1488            outputBuffer.addActiveFilter
1489                (outputFilters[Constants.IDENTITY_FILTER]);
1490            contentDelimitation = true;
1491        } else {
1492            if (entityBody &amp;&amp; http11 &amp;&amp; keepAlive) {
1493                outputBuffer.addActiveFilter
1494                    (outputFilters[Constants.CHUNKED_FILTER]);
1495                contentDelimitation = true;
1496                response.addHeader("Transfer-Encoding", "chunked");
1497            }
1498        }

does not add a filter there for causing the compression filter to be the only 
one added.  

I am attaching a patch that checks to see if there are any filters added before 
the compression filter is and if not added the identityFilter.

All line numbers and the patch are for 5.0.18

John</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54181</commentid>
    <comment_count>11</comment_count>
      <attachid>10835</attachid>
    <who name="John Trollinger">jakarta</who>
    <bug_when>2004-03-17 19:24:48 +0000</bug_when>
    <thetext>Created attachment 10835
Patch for the HttpProcessor, fixes classCastException</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54186</commentid>
    <comment_count>12</comment_count>
      <attachid>10836</attachid>
    <who name="John Trollinger">jakarta</who>
    <bug_when>2004-03-17 20:00:56 +0000</bug_when>
    <thetext>Created attachment 10836
fixed the patch.. had a extra char in it. sorry remy</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54195</commentid>
    <comment_count>13</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-17 23:16:56 +0000</bug_when>
    <thetext>The current code reads:

        if (contentLength != -1) {
            response.getMimeHeaders().setValue("Content-Length")
                .setInt(contentLength);
            outputBuffer.addActiveFilter
                (outputFilters[Constants.IDENTITY_FILTER]);
            contentDelimitation = true;
        } else {
            if (entityBody &amp;&amp; http11 &amp;&amp; keepAlive) {
                outputBuffer.addActiveFilter
                    (outputFilters[Constants.CHUNKED_FILTER]);
                contentDelimitation = true;
                response.addHeader("Transfer-Encoding", "chunked");
            } else {
                outputBuffer.addActiveFilter
                    (outputFilters[Constants.IDENTITY_FILTER]);
            }
        }
</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>10835</attachid>
            <date>2004-03-17 19:24:00 +0000</date>
            <delta_ts>2004-03-17 19:24:48 +0000</delta_ts>
            <desc>Patch for the HttpProcessor, fixes classCastException</desc>
            <filename>Http11Processor.txt</filename>
            <type>text/plain</type>
            <size>697</size>
            <attacher name="John Trollinger">jakarta</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>10836</attachid>
            <date>2004-03-17 20:00:00 +0000</date>
            <delta_ts>2004-03-17 20:00:56 +0000</delta_ts>
            <desc>fixed the patch.. had a extra char in it. sorry remy</desc>
            <filename>Http11Processor.txt</filename>
            <type>text/plain</type>
            <size>695</size>
            <attacher name="John Trollinger">jakarta</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>26715</bug_id>
          
          <creation_ts>2004-02-06 11:25:00 +0000</creation_ts>
          <short_desc>Sessions that have been persisted during a server restart never time out.</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.18</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jochen Strunk">strunk</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>51815</commentid>
    <comment_count>0</comment_count>
    <who name="Jochen Strunk">strunk</who>
    <bug_when>2004-02-06 11:25:25 +0000</bug_when>
    <thetext>This can easily be reproduced.
1. create a session via request.getSession(true).
2. restart the server so the session will be persisted and loaded again.
3. wait until the session has timed out according to the value specified in web.xml.
4. the session can still be accessed by the client and stays accessible if not
explicitly invalidated by a call to session.invalidate().

Looking at the codebase I think the reason for this is the accessCount field in
StandardSession being in an inconsistent state after sessions have been reloaded
from file. The attached patch solves it for me.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51816</commentid>
    <comment_count>1</comment_count>
      <attachid>10249</attachid>
    <who name="Jochen Strunk">strunk</who>
    <bug_when>2004-02-06 11:32:48 +0000</bug_when>
    <thetext>Created attachment 10249
see description</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51819</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-06 11:51:43 +0000</bug_when>
    <thetext>Fixed. Thanks.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>10249</attachid>
            <date>2004-02-06 11:32:00 +0000</date>
            <delta_ts>2004-02-06 11:32:48 +0000</delta_ts>
            <desc>see description</desc>
            <filename>StandardManager.patch</filename>
            <type>text/plain</type>
            <size>778</size>
            <attacher name="Jochen Strunk">strunk</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>26796</bug_id>
          
          <creation_ts>2004-02-09 16:38:00 +0000</creation_ts>
          <short_desc>Using taglibs with tag files seem to break includes</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.18</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Robert Krüger">krueger</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>seth</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>51996</commentid>
    <comment_count>0</comment_count>
    <who name="Robert Krüger">krueger</who>
    <bug_when>2004-02-09 16:38:24 +0000</bug_when>
    <thetext>It seems that a taglib directive which refers to a taglib using tag files breaks
subsequent include directives in the jsp page (they are not processed). It
sounds weird but we verified that in a real-world app, that it seems to be the
tag files that caused the problem. A taglib with only functions worked fine. I
attached a simplified case that demonstrates the problem.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>51997</commentid>
    <comment_count>1</comment_count>
      <attachid>10282</attachid>
    <who name="Robert Krüger">krueger</who>
    <bug_when>2004-02-09 16:40:04 +0000</bug_when>
    <thetext>Created attachment 10282
web application with test case</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52011</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-09 19:58:53 +0000</bug_when>
    <thetext>The code for the include isn't generated, so the reason nothing gets included
isn't that mysterious.

&lt;%@ page contentType="text/html; charset=UTF-8" %&gt;
&lt;%@ taglib prefix="test" uri="test" %&gt;

&lt;html&gt;
  &lt;h1&gt;Included text goes here:&lt;/h1&gt;
  &lt;table border="1"&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;%@ include file="included.jsp" %&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/table&gt;
&lt;/html&gt;

=&gt;

      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("&lt;html&gt;\r\n");
      out.write("  &lt;h1&gt;Included text goes here:&lt;/h1&gt;\r\n");
      out.write("  &lt;table border=\"1\"&gt;\r\n");
      out.write("    &lt;tr&gt;\r\n");
      out.write("      &lt;td&gt;");
      out.write("&lt;/td&gt;\r\n");
      out.write("    &lt;/tr&gt;\r\n");
      out.write("  &lt;/table&gt;\r\n");
      out.write("&lt;/html&gt;\r\n");
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52025</commentid>
    <comment_count>3</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-02-09 23:14:43 +0000</bug_when>
    <thetext>Fixed.  Thanks for reporting.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54209</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-18 09:38:20 +0000</bug_when>
    <thetext>*** Bug 27762 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>10282</attachid>
            <date>2004-02-09 16:40:00 +0000</date>
            <delta_ts>2004-02-09 16:40:04 +0000</delta_ts>
            <desc>web application with test case</desc>
            <filename>tagfile_include_testapp.zip</filename>
            <type>application/zip</type>
            <size>2412</size>
            <attacher name="Robert Krüger">krueger</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>26805</bug_id>
          
          <creation_ts>2004-02-09 22:31:00 +0000</creation_ts>
          <short_desc>tomcat.exe --WorkingPath does not set current directory</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Native:Integration</component>
          <version>5.0.18</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Robert Herold">herold</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>52018</commentid>
    <comment_count>0</comment_count>
    <who name="Robert Herold">herold</who>
    <bug_when>2004-02-09 22:31:41 +0000</bug_when>
    <thetext>When using tomcat.exe to install tomcat as a service (on Window XP, if it 
matters), the --WorkingPath option appears to have no effect.

I used to do this in tomcat 4, using the (different) version of tomcat.exe 
included therein, and it worked.  I have some context xml files that have 
relative references to entity includes.

When the service is installed with the tomcat5 version of tomcat.exe, the 
current working directory is set to &lt;windows&gt;/system32.

The full command line I use is:

tomcat.exe //IS//Tomcat \
--Java
c:\install\3rdparty\java1.4.2-win\bin\server\jvm.dll --JavaOptions -Dcotageso
ft.home=c:/install#-Djava.endorsed.dirs=c:/install/3rdparty/jakarta-tomcat
-5.0.18/common/endorsed#-Djava.class.path=c:/install/3rdparty/java1.4.2-win/l
ib/tools.jar;c:/install/3rdparty/jakarta-tomcat-5.0.18/bin/bootstrap.jar#-Dca
talina.base=c:/install/3rdparty/jakarta-tomcat-5.0.18#-Dcatalina.home=c:/cota
gesoft/3rdparty/jakarta-tomcat-5.0.18#-Djava.io.tmpdir=c:/install/3rdparty/ja
karta-tomcat-5.0.18/tmp --ImagePath c:/install/3rdparty/jakarta-tomcat-5.0.18
/bin/bootstrap.jar --StartupClass 
org.apache.catalina.startup.Bootstrap;main;sta
rt --ShutdownClass org.apache.catalina.startup.Bootstrap;main;stop --
StdOutputFi
le c:\install\logs\stdout.log --StdErrorFile c:\install\logs\stderr.log --
WorkingPath c:/install</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52020</commentid>
    <comment_count>1</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2004-02-09 22:52:40 +0000</bug_when>
    <thetext>

*** This bug has been marked as a duplicate of 26806 ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63648</commentid>
    <comment_count>2</comment_count>
    <who name="Shankar Unni">shankarunni</who>
    <bug_when>2004-09-15 23:29:58 +0000</bug_when>
    <thetext>With Tomcat 5.0.28, this problem still exists. The actual bug to set the
WorkingPath for JNI didn't go into procrun until 6/25/2004. I'm not sure what
version of the sources you have used to build tomcat5.exe for 5.0.28, but it's
apparently from before that..

I install it the way Bob described, and I can see the WorkingPath value set in
the registry for the Stop and Start subkeys, but the working path is completely
ignored.

However, if I build procrun from top-of-tree sources for Commons Daemon and
replace tomcat5.exe with a copy of the prunsrvd.exe, workingpath works fine.

Can you please pick up the latest prunsrvd and prunmgrd from Commons Daemon
Procrun for the next release (5.0.29)? Thanks!</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63653</commentid>
    <comment_count>3</comment_count>
    <who name="Mladen Turk">mturk</who>
    <bug_when>2004-09-16 05:55:27 +0000</bug_when>
    <thetext>You are correct. It was a problem with CVS branch.
Right now I allways backport the binaries to TOMCAT_5_0 branch,
and it will be picked up by the build.  </thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>26838</bug_id>
          
          <creation_ts>2004-02-10 19:27:00 +0000</creation_ts>
          <short_desc>Improper handling of javax.servlet.include.query_string during a nested include with parameters</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Kris Schneider">kschneider</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>kschneider</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>52075</commentid>
    <comment_count>0</comment_count>
    <who name="Kris Schneider">kschneider</who>
    <bug_when>2004-02-10 19:27:56 +0000</bug_when>
    <thetext>Example setup:

include1.jsp:
-------------
&lt;jsp:include page="/include2.jsp"&gt;
    &lt;jsp:param name="foo" value="bar"/&gt;
&lt;/jsp:include&gt;

include2.jsp:
-------------
&lt;jsp:include page="/process.jsp"/&gt;

process.jsp:
------------
&lt;%@ page contentType="text/plain" %&gt;
&lt;%@ page import="java.io.*" %&gt;
&lt;%@ page import="java.util.*" %&gt;

&lt;%!
private boolean areSomeVarsNull(PageContext pageContext,
                                int scope,
                                JspWriter out) throws IOException {
    boolean someAreNull = false;
    for (Enumeration names = pageContext.getAttributeNamesInScope(scope);
         names.hasMoreElements();) {
        String name = (String)names.nextElement();
        if (pageContext.getAttribute(name, scope) == null) {
            out.println(name + " is null");
            someAreNull = true;
        }
    }
    return someAreNull;
}
%&gt;

&lt;%
areSomeVarsNull(pageContext, PageContext.PAGE_SCOPE, out);
areSomeVarsNull(pageContext, PageContext.REQUEST_SCOPE, out);
areSomeVarsNull(pageContext, PageContext.SESSION_SCOPE, out);
areSomeVarsNull(pageContext, PageContext.APPLICATION_SCOPE, out);
%&gt;

Which results in:

javax.servlet.include.query_string is null

In other words, "javax.servlet.include.query_string" was part of the attribute
names enumeration but it's value was null when accessed through getAttribute.
This is somewhat similar to Bug #26611.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52106</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-11 12:10:46 +0000</bug_when>
    <thetext>This is now fixed.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>26906</bug_id>
          
          <creation_ts>2004-02-13 08:41:00 +0000</creation_ts>
          <short_desc>Unable to do operations like Rename/Move, Copy, Paste etc.</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlets:WebDAV</component>
          <version>5.0.18</version>
          <rep_platform>PC</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Sudhan">rsudharsan</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>joan.codina</cc>
    
    <cc>miroslav.zhorelicky</cc>
    
    <cc>rmf</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>52227</commentid>
    <comment_count>0</comment_count>
    <who name="Sudhan">rsudharsan</who>
    <bug_when>2004-02-13 08:41:25 +0000</bug_when>
    <thetext>Could not do common operations like Rename/Move, Copy, Paste from Windows 2000 /
NT with IE 6.0.2600
Tried to do similar operations from DAVExplorer-0.90 and failed.
When probing further, I found some problem with identifying the destination
location for the operations.
Applied the attached patch to the src code (from the src tar not the CVS) and it
now works on both tools.

&lt;PATCH&gt;
--- WebdavServlet.java.orig	Thu Jan 15 22:59:32 2004
+++ WebdavServlet.java	Fri Feb 13 11:10:41 2004
@@ -1506,8 +1506,15 @@
 
         destinationPath = 
             normalize(RequestUtil.URLDecode(destinationPath, "UTF8"));
-
-        int protocolIndex = destinationPath.indexOf("://");
+        int protocolIndex = destinationPath.indexOf(":/");
+        if( protocolIndex &gt;= 0 ) {
+            if( destinationPath.charAt(protocolIndex+2) != '/' ) {
+                // add a / to make it look good
+                destinationPath = destinationPath.substring(0,
protocolIndex)+"://"+
+                destinationPath.substring(protocolIndex+2);
+            }
+        }
+        protocolIndex = destinationPath.indexOf("://");
         if (protocolIndex &gt;= 0) {
             // if the Destination URL contains the protocol, we can safely
             // trim everything upto the first "/" character after "://"
&lt;/PATCH&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52228</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-13 09:01:25 +0000</bug_when>
    <thetext>I don't think I can agree to this change: it looks to me like a very ugly hack.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52258</commentid>
    <comment_count>2</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2004-02-13 20:12:13 +0000</bug_when>
    <thetext>I have just committed an alternative patch to CVS that fixes this issue. This 
will be included in the next release.

Many thanks.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53889</commentid>
    <comment_count>3</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2004-03-11 18:58:35 +0000</bug_when>
    <thetext>*** Bug 27595 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55845</commentid>
    <comment_count>4</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2004-04-15 18:18:45 +0000</bug_when>
    <thetext>*** Bug 28399 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56442</commentid>
    <comment_count>5</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2004-04-26 22:39:46 +0000</bug_when>
    <thetext>*** Bug 28591 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>26979</bug_id>
          
          <creation_ts>2004-02-16 16:47:00 +0000</creation_ts>
          <short_desc>StandardServer don't save cluster config</short_desc>
          <delta_ts>2005-10-20 00:14:52 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina:Cluster</component>
          <version>5.0.19</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Peter Rossbach">pr</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>52361</commentid>
    <comment_count>0</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-02-16 16:47:28 +0000</bug_when>
    <thetext>The new cluster configuration and the DeltaManager are very great.
Now it is really nice to talk about cluster configurations. Thanx Flilip!

After I have reconfigure my cluster to Tomcat 5.0.19 it works,
but I missing the save support and edit support at admin app.

Ok. I have made some changes and now the StandardServer implementation can 
save also the new cluster configuration. :-) 

But one problem I can't solve. The cluster is a module and the StandardServer
class is a core class. With my cluster config patch the compiling dependency
between core classes and the later compile module classes are 
wrong!  :-(  
  Only chance : comment it out the first compiling run !!!

I hope one you have a good idea to solve these modules configuration issue.

Peter

PS: When you need help to add cluster config to Admin application
    I can do the job.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52362</commentid>
    <comment_count>1</comment_count>
      <attachid>10379</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-02-16 16:48:44 +0000</bug_when>
    <thetext>Created attachment 10379
McastService.patch</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52363</commentid>
    <comment_count>2</comment_count>
      <attachid>10380</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-02-16 16:49:10 +0000</bug_when>
    <thetext>Created attachment 10380
CatalinaCluster.patch</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52364</commentid>
    <comment_count>3</comment_count>
      <attachid>10381</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-02-16 16:49:37 +0000</bug_when>
    <thetext>Created attachment 10381
add filter getter</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52365</commentid>
    <comment_count>4</comment_count>
      <attachid>10382</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-02-16 16:50:00 +0000</bug_when>
    <thetext>Created attachment 10382
SimpleTcpCluster.patch</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52366</commentid>
    <comment_count>5</comment_count>
      <attachid>10383</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-02-16 16:50:33 +0000</bug_when>
    <thetext>Created attachment 10383
Add Cluster Config support to 5.0.19 and higher format</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52368</commentid>
    <comment_count>6</comment_count>
    <who name="Filip Hanik">fhanik</who>
    <bug_when>2004-02-16 17:02:27 +0000</bug_when>
    <thetext>thanks for the info, I will work on this.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52378</commentid>
    <comment_count>7</comment_count>
      <attachid>10385</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-02-16 19:23:17 +0000</bug_when>
    <thetext>Created attachment 10385
Hups, drop DeltaManager and SimpleTcpReplicationManager for Cluster</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52379</commentid>
    <comment_count>8</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-02-16 19:30:13 +0000</bug_when>
    <thetext>I have some questions:

a) Why we used the properties at McastService ?
I find direct attributes instead the Properties are simpler

b) Can we add MBean support to the new Cluster implementation ?

c) Why we drop the persistence serialize support from StandardManager ?
     The SimpleTcpReplicationManager call support at start/stop
     I thing when we drop the complete cluster, we loose all....

Peter
PS: Can I help to add some off this features ? 
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>81450</commentid>
    <comment_count>9</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2005-10-20 08:14:52 +0000</bug_when>
    <thetext>New StoreConfig module at Tomcat 5.5 can save cluster config. Backport
to tomcat 5.0 is not planed.
</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>10379</attachid>
            <date>2004-02-16 16:48:00 +0000</date>
            <delta_ts>2004-02-16 16:48:44 +0000</delta_ts>
            <desc>McastService.patch</desc>
            <filename>McastService.patch</filename>
            <type>text/plain</type>
            <size>1304</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>10380</attachid>
            <date>2004-02-16 16:49:00 +0000</date>
            <delta_ts>2004-02-16 16:49:10 +0000</delta_ts>
            <desc>CatalinaCluster.patch</desc>
            <filename>CatalinaCluster.patch</filename>
            <type>text/plain</type>
            <size>325</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>10381</attachid>
            <date>2004-02-16 16:49:00 +0000</date>
            <delta_ts>2004-02-16 16:49:37 +0000</delta_ts>
            <desc>add filter getter</desc>
            <filename>ReplicationValve.patch</filename>
            <type>text/plain</type>
            <size>806</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>10382</attachid>
            <date>2004-02-16 16:50:00 +0000</date>
            <delta_ts>2004-02-16 16:50:00 +0000</delta_ts>
            <desc>SimpleTcpCluster.patch</desc>
            <filename>SimpleTcpCluster.patch</filename>
            <type>text/plain</type>
            <size>1031</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>10383</attachid>
            <date>2004-02-16 16:50:00 +0000</date>
            <delta_ts>2004-02-16 16:50:33 +0000</delta_ts>
            <desc>Add Cluster Config support to 5.0.19 and higher format</desc>
            <filename>StandardServer.patch</filename>
            <type>text/plain</type>
            <size>6409</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>10385</attachid>
            <date>2004-02-16 19:23:00 +0000</date>
            <delta_ts>2004-02-16 19:23:17 +0000</delta_ts>
            <desc>Hups, drop DeltaManager and SimpleTcpReplicationManager for Cluster</desc>
            <filename>StandardServer01.patch</filename>
            <type>text/plain</type>
            <size>6666</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>26988</bug_id>
          
          <creation_ts>2004-02-16 20:07:00 +0000</creation_ts>
          <short_desc>Error during POST via CGI</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlets:CGI</component>
          <version>5.0.19</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Kevin Schantz">kws</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>kws</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>52384</commentid>
    <comment_count>0</comment_count>
    <who name="Kevin Schantz">kws</who>
    <bug_when>2004-02-16 20:07:52 +0000</bug_when>
    <thetext>The CGIServlet.java is erroneously adding 2 line feeds to the stdin stream of 
of a CGI process. The problem happens in the getPostInput() method. Even if no 
request parameters are present it will return a line feed. The calling method 
checks for null, but based on the getPostInput method this can never occur. 
Adding the following code fixes the problem.

protected String getPostInput(Hashtable params) {
...
return qs.length() &gt; 0 ? qs.append(lineSeparator).append(postInput).toString
() : null;
}

This only adds a line separator if parameters exist. I've also looked at the 
ouput string which is formated as follows (example using 2 params):

"param1=value1&amp;parma2=value2&amp;
param1=value1
param2=value2

"

Is this the expected output format? The problematic code also exists for 
version 5.0.19.

Kevin</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52390</commentid>
    <comment_count>1</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2004-02-16 23:42:33 +0000</bug_when>
    <thetext>This has been fixed in CVS and will be included in the next release. It has 
also been fixed in the 4.1.x branch.

I have applied a modified version of your patch.

I agree the output format looks a little odd but I propose to leave it as 
changing it may well break existing scripts and no-one has actually complained 
that the format is invalid.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27050</bug_id>
          
          <creation_ts>2004-02-18 21:51:00 +0000</creation_ts>
          <short_desc>keystoreFile parameter, when specified as relative, is not treated relative to $CATALINA_BASE or catalina.base property</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:Coyote</component>
          <version>5.0.19</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Dominik Drzewiecki">drzewo</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>52510</commentid>
    <comment_count>0</comment_count>
    <who name="Dominik Drzewiecki">drzewo</who>
    <bug_when>2004-02-18 21:51:47 +0000</bug_when>
    <thetext>Tomcat docs on configuring SSL says (on keystoreFile attribute of http
Connector): "You can specify an absolute pathname, or a relative pathname that
is resolved against the $CATALINA_BASE environment variable." 

However, specifying relative keystoreFile does not make tomcat resolve this file
against $CATALINA_BASE (or -Dcatalina.base property). It seems it is resolved
against current working directory.

How to reproduce this error:
1. install tomcat (as nt service)
2. create separate (striped down) base (say &lt;BASE&gt;) somewhere on your disk
(conf, logs, work, temp, webapps(empty) directories)
3. create keystore &lt;BASE&gt;/conf/catalina.keystore
4. update &lt;BASE&gt;/conf/server.xml to enable https connector as 
    &lt;Connector port="9443" 
     maxThreads="50" minSpareThreads="5" maxSpareThreads="25"
     enableLookups="false" disableUploadTimeout="true"
     acceptCount="100" debug="0" scheme="https" secure="true"
     clientAuth="false" sslProtocol="TLS" 
     keystoreFile="conf/catalina.keystore"
    /&gt;
5. using tomcatw.exe" //ES//Tomcat5 update "java options" so they reference new
base, particularly append -Dcatalina.base="&lt;BASE&gt;" to "Java Options"
6. net start tomcat5
7. observe stdout.log
2004-02-18 22:25:42 org.apache.coyote.http11.Http11Protocol init
SEVERE: Error initializing endpoint
java.io.FileNotFoundException: conf\catalina.keystore (The system cannot find
the file specified)
8. now, use tomcatw.exe" //ES//Tomcat5 in order to update Service "Work Path" to
refer to the new base
9. Now tomcat DOES start https and finds conf/catalina.keystore relative to the
new work dir

How to obtain this error (the easier way):
1. unpack/install tomcat
2. create separate (striped down) base (say &lt;BASE&gt;) somewhere on your disk (bin,
conf, logs, work, temp, webapps(empty) directories)
3. create keystore &lt;BASE&gt;/conf/catalina.keystore
4. update &lt;BASE&gt;/conf/server.xml to enable https connector as 
    &lt;Connector port="9443" 
     maxThreads="50" minSpareThreads="5" maxSpareThreads="25"
     enableLookups="false" disableUploadTimeout="true"
     acceptCount="100" debug="0" scheme="https" secure="true"
     clientAuth="false" sslProtocol="TLS" 
     keystoreFile="conf/catalina.keystore"
    /&gt;
5. open cmd
6. set CATALINA_BASE=&lt;BASE&gt; (dir containing conf subdir)
7. cd %CATALINA_BASE%\bin
8. catalina.bat start
9. oops, we're still getting 
2004-02-18 22:25:42 org.apache.coyote.http11.Http11Protocol init
SEVERE: Error initializing endpoint
java.io.FileNotFoundException: conf\catalina.keystore (The system cannot find
the file specified)
10. cd ..
11. bin\catalina.bat start
12. NO java.io.FNFE this time

All this leads me to the conclusion that keystoreFile attribute value is
resolved against current working directory instaed of $CATALINA_BASE
Probably truststoreFile attribute suffers from the same problem.

Tested on both j2sdk1.4.2_03 as well on j2sdk1.5.0-beta1</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52518</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-02-18 22:40:41 +0000</bug_when>
    <thetext>Fixed.

DIFFS:

Index: JSSESocketFactory.java
===================================================================
RCS file:
/home/cvs/jakarta-tomcat-connectors/util/java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java,v
retrieving revision 1.13
diff -u -r1.13 JSSESocketFactory.java
--- JSSESocketFactory.java      24 Jan 2004 04:56:32 -0000      1.13
+++ JSSESocketFactory.java      18 Feb 2004 22:39:36 -0000
@@ -58,6 +58,7 @@
  */ 
 package org.apache.tomcat.util.net.jsse;
 
+import java.io.File;
 import java.io.FileInputStream;
 import java.io.FileNotFoundException;
 import java.io.IOException;
@@ -309,7 +310,13 @@
         InputStream istream = null;
         try {
             ks = KeyStore.getInstance(type);
-            istream = new FileInputStream(path);
+            File keyStoreFile = new File(path);
+            if (!keyStoreFile.isAbsolute()) {
+                keyStoreFile = new File(System.getProperty("catalina.base"),
+                                        path);
+            }
+            istream = new FileInputStream(keyStoreFile);
+
             ks.load(istream, pass.toCharArray());
             istream.close();
             istream = null;</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27077</bug_id>
          
          <creation_ts>2004-02-19 12:55:00 +0000</creation_ts>
          <short_desc>DataSourceRealm throws NullPointerException when auth is tried and user has null password</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.18</version>
          <rep_platform>Other</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Graham Leggett">minfrin</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>52557</commentid>
    <comment_count>0</comment_count>
    <who name="Graham Leggett">minfrin</who>
    <bug_when>2004-02-19 12:55:38 +0000</bug_when>
    <thetext>I have a web application that is password protected against a postgres database,
defined like so:

&lt;Realm className="org.apache.catalina.realm.DataSourceRealm" debug="0"
  dataSourceName="jdbc/GlobalPatricia"
  userTable="person" userNameCol="uid" userCredCol="user_password"
  userRoleTable="company_person" roleNameCol="serial"/&gt;

For normal users logging in, this works fine.

If however, a user in the postgres database has their password field set to
"null", and an attempt is made to log in as this user using any password, the
exception below is thrown by tomcat.

Tomcat then returns a 200 OK to the browser, along with a blank page.

2004/02/19 01:42:10 org.apache.coyote.tomcat5.CoyoteAdapter service
SEVERE: An exception or error occurred in the container during the request
processing
java.lang.NullPointerException
    at
org.apache.catalina.realm.DataSourceRealm.authenticate(DataSourceRealm.java:369)
    at
org.apache.catalina.realm.DataSourceRealm.authenticate(DataSourceRealm.java:306)
    at
org.apache.catalina.authenticator.BasicAuthenticator.authenticate(BasicAuthenticator.java:182)
    at
org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:551)
    at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)
    at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)
    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:195)
    at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:164)
    at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)
    at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)
    at
org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:156)
    at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
    at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)
    at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)
    at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:206)
    at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:828)
    at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:700)
    at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:584)
    at
org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:683)
    at java.lang.Thread.run(Thread.java:534)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52572</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-19 15:06:56 +0000</bug_when>
    <thetext>This realm could use some code merges from the regular JDBC realm.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52575</commentid>
    <comment_count>2</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2004-02-19 15:34:04 +0000</bug_when>
    <thetext>Would it be better to have DataSourceRealm realm extend JDBCRealm ? (Or vice versa)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52576</commentid>
    <comment_count>3</comment_count>
    <who name="Graham Leggett">minfrin</who>
    <bug_when>2004-02-19 15:43:49 +0000</bug_when>
    <thetext>That would exclude a realm based on LDAP would it not?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52847</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-24 12:01:55 +0000</bug_when>
    <thetext>I agree on the usefulness of trying to merge the two realms.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52848</commentid>
    <comment_count>5</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-24 12:09:52 +0000</bug_when>
    <thetext>This should be fixed now, but I didn't test it.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27090</bug_id>
          
          <creation_ts>2004-02-19 19:36:00 +0000</creation_ts>
          <short_desc>CGI parameters use default encoding instead of UTF-8</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlets:CGI</component>
          <version>5.0.18</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Kevin Schantz">kws</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>kws</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>52597</commentid>
    <comment_count>0</comment_count>
    <who name="Kevin Schantz">kws</who>
    <bug_when>2004-02-19 19:36:24 +0000</bug_when>
    <thetext>The URLEncode.encode("") API has been deprecated because it uses the default 
system encoding. All application/x-www-form-urlencoded encoding should be done 
in UTF-8.

Code: CGIServlet.java

Fix:  URLEncode.encode("","UTF-8")</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52600</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-19 19:42:32 +0000</bug_when>
    <thetext>This depends on your script. At most it should be configurable, but I'd say
using platform encoding is not so bad.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52602</commentid>
    <comment_count>2</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2004-02-19 19:46:28 +0000</bug_when>
    <thetext>I'll make this configurable, with the default as is rather than UTF-8 as I 
don't want to risk breaking any existing scripts. I'll try and do this tonight.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52616</commentid>
    <comment_count>3</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2004-02-19 21:40:37 +0000</bug_when>
    <thetext>The new parameter has been added to the CGI servlet. The fix has also been 
ported to TC4.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64352</commentid>
    <comment_count>4</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2004-09-28 22:22:16 +0000</bug_when>
    <thetext>Note that this has been reverted in 4.1.x and 5.0.x as it introduced a JDK 1.4 
dependency. It remains in 5.5.x</thetext>
  </long_desc>
      
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>27100</bug_id>
          
          <creation_ts>2004-02-20 04:20:00 +0000</creation_ts>
          <short_desc>WebDAV locking implementation incompatible with some clients.</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlets:WebDAV</component>
          <version>5.0.19</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ryan Dewell">ryan</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>fredrikv</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>52628</commentid>
    <comment_count>0</comment_count>
    <who name="Ryan Dewell">ryan</who>
    <bug_when>2004-02-20 04:20:29 +0000</bug_when>
    <thetext>Tested WebDAV servlet with Dreamweaver MX and DAVExplorer.  

Problem: After either client obtains a lock, they are unable to perform any 
other operations on the locked resource.  All further operations on a locked 
resource return the SC_LOCKED status.  

This is particularly troublesome for Dreamweaver because it only works by 
acquiring locks -- i.e. there is no way to use Dreamweaver + webdav without 
locking.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52646</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-20 10:23:08 +0000</bug_when>
    <thetext>I think the "problem" is that the servlet obsfucates lock tokens, which it has
every right to do (this is from memory).
Anyway, the servlet supports WebDAV level 1, which doesn't include locking
(which is very complex to implement completely, so is only partially implemented).
I'll let Mark resolve this report.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52669</commentid>
    <comment_count>2</comment_count>
    <who name="Ryan Dewell">ryan</who>
    <bug_when>2004-02-20 15:23:30 +0000</bug_when>
    <thetext>A couple of suggestions based on the recent comment.  

- If only Level 1 is supported, and locking is not supported fully, then 
perhaps a configuration option would be warranted that:
  - Keeps the servlet from reporting that it supports: level 2 and lock 
methods.
  - Makes lock operations a no-op for clients that still try to lock no matter 
what.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52775</commentid>
    <comment_count>3</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2004-02-22 22:36:21 +0000</bug_when>
    <thetext>Having had a good look through the spec I don't think that it does allow the 
lock token to be obsfucated. I am basing this opinion on the following quotes:
- 6.3 &lt;quote&gt;Anyone can find out anyone else's lock token by performing lock 
discovery.&lt;/quote&gt;
- 17.3 Security through Obscurity
&lt;quote&gt;
   WebDAV provides, through the PROPFIND method, a mechanism for listing
   the member resources of a collection.  This greatly diminishes the
   effectiveness of security or privacy techniques that rely only on the
   difficulty of discovering the names of network resources.  Users of
   WebDAV servers are encouraged to use access control techniques to
   prevent unwanted access to resources, rather than depending on the
   relative obscurity of their resource names.
&lt;/quote&gt;

I have just committed a patch to CVS that removes the lock obsfucation 
functionality. This will be included in the next release.
It has also been ported to TC4.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59543</commentid>
    <comment_count>4</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2004-06-18 23:54:07 +0000</bug_when>
    <thetext>*** Bug 10539 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>27104</bug_id>
          
          <creation_ts>2004-02-20 10:01:00 +0000</creation_ts>
          <short_desc>got an exception when testing a simple cluster app</short_desc>
          <delta_ts>2005-10-16 00:55:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina:Cluster</component>
          <version>5.0.18</version>
          <rep_platform>Sun</rep_platform>
          <op_sys>Solaris</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Robert Starzer">rstarzer</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>52642</commentid>
    <comment_count>0</comment_count>
    <who name="Robert Starzer">rstarzer</who>
    <bug_when>2004-02-20 10:01:36 +0000</bug_when>
    <thetext>hi,

this occured only once (so far)-&gt;

fault:

java.util.NoSuchElementException
	at java.util.LinkedList.remove(LinkedList.java:579)
	at java.util.LinkedList.removeFirst(LinkedList.java:131)
	at org.apache.catalina.cluster.session.DeltaRequest.addAction
(DeltaRequest.java:149)
	at org.apache.catalina.cluster.session.DeltaRequest.setAttribute
(DeltaRequest.java:116)
	at org.apache.catalina.cluster.session.DeltaSession.setAttribute
(DeltaSession.java:1330)
	at org.apache.catalina.cluster.session.DeltaSession.setAttribute
(DeltaSession.java:1311)
	at org.apache.catalina.cluster.session.DeltaSessionFacade.setAttribute
(DeltaSessionFacade.java:177)
	at org.apache.jsp.index_jsp._jspService(index_jsp.java:50)
	at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:133)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)
	at org.apache.jasper.servlet.JspServletWrapper.service
(JspServletWrapper.java:311)
	at org.apache.jasper.servlet.JspServlet.serviceJspFile
(JspServlet.java:301)
	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:248)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter
(ApplicationFilterChain.java:284)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter
(ApplicationFilterChain.java:204)
	at org.apache.catalina.core.StandardWrapperValve.invoke
(StandardWrapperValve.java:257)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:564)
	at org.apache.catalina.core.StandardContextValve.invokeInternal
(StandardContextValve.java:245)
	at org.apache.catalina.core.StandardContextValve.invoke
(StandardContextValve.java:199)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:564)
	at org.apache.catalina.core.StandardHostValve.invoke
(StandardHostValve.java:195)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.valves.ErrorReportValve.invoke
(ErrorReportValve.java:164)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:149)
	at org.apache.catalina.cluster.tcp.ReplicationValve.invoke
(ReplicationValve.java:182)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:149)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:564)
	at org.apache.catalina.core.StandardEngineValve.invoke
(StandardEngineValve.java:156)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:564)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service
(CoyoteAdapter.java:206)
	at org.apache.coyote.http11.Http11Processor.process
(Http11Processor.java:828)
	at 
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio
n(Http11Protocol.java:700)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt
(PoolTcpEndpoint.java:584)
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run
(ThreadPool.java:683)
	at java.lang.Thread.run(Thread.java:534)


index.jsp:

&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Session Text&lt;/title&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"&gt;
&lt;/head&gt;
&lt;%
	String rep = new String("Replicated");
	out.print(session.getId());
	session.setAttribute("replicate",rep);
%&gt;
&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;

multicast config:

 &lt;Cluster  className="org.apache.catalina.cluster.tcp.SimpleTcpCluster"

                  name="xxxx"

                  debug="99"

                  serviceclass="org.apache.catalina.cluster.mcast.McastService"

                  mcastAddr="239.192.16.5"

                  mcastPort="45564"

                  mcastFrequency="500"

                  mcastDropTime="3000"

                  tcpThreadCount="12"

                  tcpListenAddress="auto"

                  tcpListenPort="4001"

                  tcpSelectorTimeout="100"

                  printToScreen="false"

                  expireSessionsOnShutdown="false"

                  useDirtyFlag="true"

                  replicationMode="pooled"

        /&gt;

synchronization problem or should this be caught and logged with lower 
priority ?

thanks !</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52884</commentid>
    <comment_count>1</comment_count>
    <who name="Filip Hanik">fhanik</who>
    <bug_when>2004-02-24 20:20:03 +0000</bug_when>
    <thetext>I haven't been able to reproduce this, if you have a scenario where this 
happens again, let me know and we will work it out</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>67265</commentid>
    <comment_count>2</comment_count>
    <who name="Filip Hanik">fhanik</who>
    <bug_when>2004-11-19 21:24:16 +0000</bug_when>
    <thetext>I put in sync around the code that would cause this</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>78963</commentid>
    <comment_count>3</comment_count>
    <who name="Steve Mactaggart">steve</who>
    <bug_when>2005-08-25 08:12:25 +0000</bug_when>
    <thetext>We are getting this issue on our servers at the moment.
We are using Tomcat 5.0.28 and I have seen this issue under Linux and Windows.

Our site is constantly causing this issue, and the only solution is to get the
customer to shutdown all of their browsers to disconnect from the session then
start again.

It seems that the DeltaSession gets lost and then when the replication happens
it has some sort of internal error.

Any ideas on a solution for this one? </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>81195</commentid>
    <comment_count>4</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2005-10-16 08:55:40 +0000</bug_when>
    <thetext>Filip fixed it on November 19, and Tomcat 5.0.30 was tagged 5 days later.  Your
options are to get 5.0.30, upgrade to 5.5.12, or sync the methods yourself.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27122</bug_id>
          
          <creation_ts>2004-02-20 21:09:00 +0000</creation_ts>
          <short_desc>IE plugins cannot access components through Tomcat 5 over SSL</short_desc>
          <delta_ts>2011-05-22 22:55:04 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:HTTP</component>
          <version>5.0.18</version>
          <rep_platform>Sun</rep_platform>
          <op_sys>Solaris</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Daniel Potter">dpotter</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>burn</cc>
    
    <cc>ingo</cc>
    
    <cc>reconway</cc>
    
    <cc>tomcat</cc>
    
    <cc>wolfgang.hoheisel</cc>
    
    <cc>wtff</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>52689</commentid>
    <comment_count>0</comment_count>
    <who name="Daniel Potter">dpotter</who>
    <bug_when>2004-02-20 21:09:17 +0000</bug_when>
    <thetext>SSL seems to be failing when the Content-Type header is set to "image/svg+xml".

I've only seen this failure when SSL was running on a Solaris machine.  (uname
-a: SunOS [hostname removed] 5.8 Generic_108528-18 sun4u sparc SUNW,Ultra-60) 
When attempted on Windows, we were unable to duplicate the error.  This reliably
fails when attempted on this specific Solaris machine.  If I get a chance, I'll
try to create a test-case and see if I can reproduce this on other Solaris
machines.  Unfortunately, this was a show-stopper for a release that's being
made today so I'm pressed for time.

Basically, what happens is that we're using a JSP page to create an SVG file. 
Because of this, we have to set the Content-Type header to "image/svg+xml". 
When the MIME type is set to this value, the page fails to load in Internet
Explorer 6 (SP1) with a message of "connection failed" or something similar. 
When an attempt was made in Opera, Opera responded by crashing.  Mozilla
successfully downloaded the file, though.

However, when resetting the MIME type in the page to "text/plain" all three
browsers can access the page without failure.  By back-revving Tomcat to version
4.1.29, we were able to resolve this issue and access the page in all three
browsers.

I'll try and create a test-case later today and verify that it isn't just our
SVG JSP that's failing but any that creates SVG but I'm currently pressed for
time - sorry.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52690</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-20 21:14:26 +0000</bug_when>
    <thetext>How about trying with a telnet ? Either the content is sent or it is not.
There's nothing to investigate here, as there is nothing in Tomcat which is
related to the content-type, so I urge posting on tomcat-user instead.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52691</commentid>
    <comment_count>2</comment_count>
    <who name="Daniel Potter">dpotter</who>
    <bug_when>2004-02-20 21:24:11 +0000</bug_when>
    <thetext>Of course I haven't tried telnet, it's only happening over SSL.  I'm not very
good at doing 128-bit encryption in my head and I doubt anyone else is either. 
If I could find something that would do SSL and dump the actual HTTP transaction
I would do that - I haven't yet (especially because form security is in place on
the webapp).

However, considering that it *only* failed with the latest Tomcat 5 and works
just fine in Tomcat 4 I find it hard to believe that there isn't something wrong
with Tomcat 5.  If it failed when back-revving the version, I might blame
something else.  But this is 100% reproducable among multiple clients and only
when connecting to the Tomcat 5 server using SSL.

This *only* fails when using SSL through Tomcat 5.  It works with Tomcat 4,
using the same JDK and the same configuration.  It also works in Tomcat 5 if I
use the standard HTTP connector.  I can't figure out how to begin to debug this,
but if anyone can offer any suggestions on utilities to debug SSL connections
I'll take a stab at it next week.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52694</commentid>
    <comment_count>3</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-02-20 21:40:33 +0000</bug_when>
    <thetext>Try 'openssl s_client'.  It's my first stop when debugging SSL problems.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52702</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-20 23:33:08 +0000</bug_when>
    <thetext>Well, I understand, but the behavior you describe would be extremely strange. I
don't see how it can be a Jasper or container issue, and I don't see how it can
be a connector issue either (the connector doesn't have content-type specific at
all either, except when HTTP compression is used). Tomcat 4.1.29 uses the same
connectors as 5.0.14, and similarly 4.1.30 uses the same as 5.0.18, so again I
don't understand a difference in behavior between the two "branches".</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52965</commentid>
    <comment_count>5</comment_count>
    <who name="Daniel Potter">dpotter</who>
    <bug_when>2004-02-25 21:50:01 +0000</bug_when>
    <thetext>OK, I finally got a chance to use "openssl" to try and manually run a couple of
HTTP transactions.  I found one header I thought may be a problem that's
included in Tomcat 5 but not Tomcat 4: "Expires: Wed, 31 Dec 1969 19:00:00 EST".
 Unfortunately, updating it to a more realistic "expires" date didn't allow IE
to work.

I'm as stumped as everyone else is as to what might be causing this.  I think I
need to actually find a way to sniff out what IE is doing, but this definitely
isn't working with IE 6 SP1 and Tomcat 5.0.18 on this one SVG page.  (I'm
wondering if it has to do with the form authentication - when I created a test
JSP with no security constraints it worked through IE 6.)

As far as I can tell, though, Tomcat is generating the headers correctly... 
Although I can't figure out why IE would only not work with this page and work
fine on all the others and why back-revving to Tomcat 4 would solve the problem.

And now it appears that Opera 7.23 is working just fine on the page, as well as
Mozilla.  This is probably an Internet Explorer issue, not a Tomcat 5 issue, but
it still is *weird*.  Anyone who has any ideas to help debug what Internet
Explorer is doing would be appreciated - it always indicates that the "Action
was canceled" and says that the site was unavailable.

For reference:

TOMCAT 4.1.29 HEADERS:

HTTP/1.1 200 OK
Content-Type: image/svg+xml;charset=ISO-8859-1
Date: Wed, 25 Feb 2004 21:28:16 GMT
Server: Apache-Coyote/1.1
Connection: close

TOMCAT 5.0.18 HEADERS:

HTTP/1.1 200 OK
Pragma: No-cache
Cache-Control: no-cache
Expires: Wed, 31 Dec 1969 19:00:00 EST
Content-Type: image/svg+xml
Date: Wed, 25 Feb 2004 21:21:46 GMT
Server: Apache-Coyote/1.1
Connection: close</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52967</commentid>
    <comment_count>6</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-02-25 22:07:26 +0000</bug_when>
    <thetext>And we have finally found the problem.  In an attempt to try and work around 
some broken client (I can't be bothered to go back and see which one), Tomcat5 
started adding adding the "don't cache" headers even for SSL requests.  I'm in 
a very small minority of disliking this "feature", so it is unlikely to change.

The work-around is to configure the Authenticator yourself:
&lt;Context path="/myapp" docBase="myapp"&gt;
  &lt;Valve className="org.apache.catalina.authenticator.FormAuthenticator"
          disableProxyCaching="false" /&gt;
&lt;/Context&gt;

Of course, if you're not using Form auth, then substitute the correct class in 
the example above.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52970</commentid>
    <comment_count>7</comment_count>
    <who name="Daniel Potter">dpotter</who>
    <bug_when>2004-02-25 22:40:26 +0000</bug_when>
    <thetext>Yep - that solved it.  Thanks!

(Also, I see that Tomcat 5.0.19 was released, so I tested it against that
version and got the same problem on Solaris.)

This is a bug with the way Internet Explorer handles plugins, then.  My guess is
that the file isn't cached so that when the plugin attempts to access it, it
doesn't receive anything causing it to silently fail.

I just tried uploading the Badgers-Badgers SWF and seeing if it would fail in
the same way, and it does.  So this happens with any IE plugin.

Mind you, the way Internet Explorer fails with this is weird.  It just indicates
that the resource is not available, despite all other indications being that it
is.  It also happens when you attempt to directly access the resource through
IE, it asks you to download the file and then tells you that it isn't available.
 It might be worth re-openning this bug and removing the "no-cache" behavior if
"MSIE" appears in the User-agent header.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56593</commentid>
    <comment_count>8</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-04-28 23:21:34 +0000</bug_when>
    <thetext>*** Bug 28662 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58561</commentid>
    <comment_count>9</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-06-02 16:06:10 +0000</bug_when>
    <thetext>*** Bug 29336 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60320</commentid>
    <comment_count>10</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-07-08 19:42:44 +0000</bug_when>
    <thetext>*** Bug 29975 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60466</commentid>
    <comment_count>11</comment_count>
    <who name="Sascha C.">wtff</who>
    <bug_when>2004-07-12 11:58:22 +0000</bug_when>
    <thetext>Microsoft describes the exact behaviour of their bug on this webpage:

http://support.microsoft.com/?id=316431

Microsoft says that this bug is "by design" and that they will not ifx it. This 
is just SOOO arrogant!!

--

Tomcat adds the respective caching headers to the HTTP header automatically if 
and only if a resource of a webapp is being accessed for which a user data 
constraint of CONFIDENTIAL has been set.

I PROPOSE TO HAVE A SPECIAL ATTRIBUTE WITHIN THE CONNECTOR CONFIGURATION BY 
WHICH TOMCAT CAN BE FORCED NOT TO SET CACHING HEADERS ITSELF.

*** PLUS ***

I DON'T LIKE THAT THIS BUG HAS BEEN MARKED AS INVALID!
SEVERAL PEOPLE HAVE REPORTED THIS BEHAVIOUR AND a FIX IS POSSIBLE AND 
STRAIGHTFORWARD TO APPLY.
(Search for 'no-cache' within the connector codebase and put an if(doCaching) 
bracket around it. That's all there is to it.)

I leave it to the tomcat developers to reopen this bug as I regard it as 
somehow impolite to do this myself. However, I strongly recommend you people to 
do so. This bug is reproducible on every InternetExplorer. A lot of people will 
get headaches and spend days on investigation unless you add the proposed 
attribute to the connector configuration or at least place a comment on the 
webpage which informs developers of the effect in question.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61895</commentid>
    <comment_count>12</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-08-12 15:13:53 +0000</bug_when>
    <thetext>*** Bug 30618 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63126</commentid>
    <comment_count>13</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2004-09-06 12:09:42 +0000</bug_when>
    <thetext>*** Bug 30618 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>80202</commentid>
    <comment_count>14</comment_count>
    <who name="">william.barker</who>
    <bug_when>2005-09-20 19:13:29 +0000</bug_when>
    <thetext>*** Bug 36735 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>86251</commentid>
    <comment_count>15</comment_count>
    <who name="Chris Lott">apache7</who>
    <bug_when>2006-02-27 15:24:45 +0000</bug_when>
    <thetext>I would like to add my support for the previous request to make the caching
headers (Pragma and Cache-Control) configurable in Tomcat 5.0.x.  

Brief history: I use Tomcat 5.0.28 for a small webapp.  It sits behind Apache,
which does SSL and forwards requests to Tomcat via mod_jk.  Users access the
webapp stricly with SSL.  The webapp's doc area has a few static power-point
files, and that's where this problem bit me: IE users could not get power-point
files.

To figure out what headers Tomcat sets in responses, I turned on the
RequestDumperValve in the server.xml file.  Then I saw that every single request
-- whether .gif, .html, .css, .ppt, or .jsp -- gets "Cache-Control: no-cache"
and "Pragma: no cache" in the response headers.

While these headers are absolutely appropriate for JSP pages, they are wholly
unnecessary for static content.  I want my users' browsers to cache static
content like CSS sheets, images, etc. and thereby make fewer requests to my
server.  Everybody wins.

This thread helped me understand the problem:
http://forum.java.sun.com/thread.jspa?threadID=233446&amp;start=0&amp;tstart=0 

I finally used the solution from here, with one modification:
http://www.jspinsider.com/content/dev/afessh/another-filter-every-site-should-have.html
Jayson Falkner explains servlet filters that set response headers; this means 
web browsers will cache items like pictures and other static content.  Note that
his code does "addHeader" but that does NOT work; you have to do "setHeader" to
overrride the cache-control that Tomcat adds.

I am of the strong opinion that Tomcat needs some configuration setting so users
like me can tell the container what caching policy to apply by default.  Maybe
something along the lines of a mime-types file would allow the caching policy to
be set based on file suffixes or file-name patterns. 

Please consider this request seriously.  I am not a Tomcat dev and don't want to
reopen this bug myself.  Thanks.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>103129</commentid>
    <comment_count>16</comment_count>
    <who name="John Holman">j.g.holman</who>
    <bug_when>2007-05-12 09:51:00 +0000</bug_when>
    <thetext>Reopening this bug - even though strictly speaking Tomcat's behaviour is not
incorrect - because it seems to be a significant and common source of problems,
and is not that easy for the user to diagnose. It occurs with or without SSL,
and in a wider set of circumstances than invoking IE plugins. (My own variation
is that download to a file in IE fails if a content-disposition header is set
and the resource is subject to a security constraint).

The workaround given by Bill Barker is to configure each context:

&lt;Context path="/myapp" docBase="myapp"&gt;
  &lt;Valve className="org.apache.catalina.authenticator.FormAuthenticator"
          disableProxyCaching="false" /&gt;
&lt;/Context&gt;

This works but reduces security more than is necessary, as it causes no cache
control headers to be issued at all.

An alternative workaround

&lt;Context path="/myapp" docBase="myapp"&gt;
  &lt;Valve className="org.apache.catalina.authenticator.FormAuthenticator"
          securePagesWithPragma="false" /&gt;
&lt;/Context&gt;

is better. It causes a header Cache-Control: private to be issued in place of
the default Cache-Control: none and Pragma: no-cache headers. This tells shared
caches not to cache the response, which I think is all that is necessary, while
still allowing downloads to work in IE.

However, neither workaround is a good solution because it makes configuration
more difficult and because it duplicates knowledge of which authenticator is
required between the web.xml and context.xml files.

Therefore I suggest that AuthenticatorBase be changed to put out the
Cache-Control: private header by default. I think this is simply a matter of
changing the securePagesWithPragma field from true to false:

    /**
     * Flag to determine if we disable proxy caching with headers incompatible
     * with IE 
     */
    protected boolean securePagesWithPragma = true;
    
Other comments in this source file suggest that IE-incompatible headers are
being issued because there is some unspecified problem with Mozilla when
cache-control: private is used. However I can find no such problem at least with
current versions of Firefox. Since the choice therefore seems to be between
working around a known bug in all versions of IE, and working around a possible
bug in some previous versions of Mozilla that does not affect current Firefox
users, I'd argue that the former is the better thing to do. 
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>103989</commentid>
    <comment_count>17</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2007-06-01 18:09:56 +0000</bug_when>
    <thetext>The current behaviour is unlikely to change. I am marking this as an enhancement
rather than WONTFIX in case someone cares enough to come up with a proposed patch.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>118203</commentid>
    <comment_count>18</comment_count>
    <who name="Dave">tomcat</who>
    <bug_when>2008-07-02 14:41:50 +0000</bug_when>
    <thetext>We just found that adding:

&lt;security-constraint&gt;
  &lt;web-resource-collection&gt;
    &lt;web-resource-name&gt;Automatic SLL Forwarding&lt;/web-resource-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/web-resource-collection&gt;
  &lt;user-data-constraint&gt;
    &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
  &lt;/user-data-constraint&gt;
&lt;/security-constraint&gt;

also adds the headers that creates this issue.  Any ideas?  Using tomcat 5.5.25</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>118224</commentid>
    <comment_count>19</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2008-07-02 23:34:43 +0000</bug_when>
    <thetext>&lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt; means SSL will be used so yes, you will hit this bug in IE. Workarounds as described above.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>118241</commentid>
    <comment_count>20</comment_count>
    <who name="Dave">tomcat</who>
    <bug_when>2008-07-03 12:04:44 +0000</bug_when>
    <thetext>We've added the following to context.xml as a work-around:

&lt;Valve className="org.apache.catalina.authenticator.NonLoginAuthenticator" disableProxyCaching="true" securePagesWithPragma="false" /&gt;

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>146526</commentid>
    <comment_count>21</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2011-05-22 22:49:32 +0000</bug_when>
    <thetext>For reference, the original Mozilla issue described in bug 23887. I have confirmed that this bug no longer exists in the latest version of Firefox. I suspect it was fixed some time ago although I couldn't find it when I tried searching the Mozilla bug database.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>146527</commentid>
    <comment_count>22</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2011-05-22 22:55:04 +0000</bug_when>
    <thetext>I have removed the Mozilla bug workaround in 7.0.x and changed the default of securePagesWithPragma to false. Both of these changes will be included in 7.0.15 onwards.

I do not intend proposing these changes for back-port.</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>27127</bug_id>
          
          <creation_ts>2004-02-21 02:19:00 +0000</creation_ts>
          <short_desc>Shutdown doesn't work with custom server port + non-default config file;</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.18</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Debbie Utley">debbie.utley</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>1</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>52704</commentid>
    <comment_count>0</comment_count>
    <who name="Debbie Utley">debbie.utley</who>
    <bug_when>2004-02-21 02:19:50 +0000</bug_when>
    <thetext>If I change the server port in a custom config file, stopping the server using 
the shutdown batch file does not work.

Steps:
1. Create a file (say C:\myserver.xml) with the following contents:
------------
&lt;Server port="8081" shutdown="SHUTDOWN" debug="4"&gt;
  &lt;Service name="Catalina"&gt;
    &lt;Connector debug="4" port="8080"/&gt;
    &lt;Engine name="Catalina" defaultHost="localhost" debug="0"&gt;
      &lt;Host name="localhost" debug="4" appBase="webapps"
       unpackWARs="true" autoDeploy="true"&gt;
      &lt;/Host&gt;
    &lt;/Engine&gt;
  &lt;/Service&gt;
&lt;/Server&gt;
------------

2. execute
   &lt;tomcathome&gt;\bin\startup -config C:\myserver.xml

3.  execute
&lt;tomcathome&gt;\bin\shutdown -config C:\myserver.xml

4. This causes 
java.net.ConnectException: Connection refused: connect
        at java.net.PlainSocketImpl.socketConnect(Native Method)
        at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:305)
        at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:171)
        at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:158)
        at java.net.Socket.connect(Socket.java:452)
        at java.net.Socket.connect(Socket.java:402)
        at java.net.Socket.&lt;init&gt;(Socket.java:309)
        at java.net.Socket.&lt;init&gt;(Socket.java:124)
        at org.apache.catalina.startup.Catalina.stopServer(Catalina.java:453)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke
(NativeMethodAccessorImpl.java:39)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke
(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at org.apache.catalina.startup.Bootstrap.stopServer(Bootstrap.java:322)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:400)

5. In the config file myserver.xml, change 8081 to the default value 8005.   
Now steps 2 and 3 work as expected.

The problem appears to be that Bootstrap.main() ignores the -config argument if 
the command is "stop".  Thus the server is listening on port 8081, but shutdown 
is using port 8005 as specified by the default server.xml.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52966</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-25 22:06:49 +0000</bug_when>
    <thetext>This is now fixed.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27156</bug_id>
          
          <creation_ts>2004-02-23 12:49:00 +0000</creation_ts>
          <short_desc>minSpareThreads / maxSpareThreads do not work with AJP connector</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:AJP</component>
          <version>5.0.18</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Rüdiger Plüm">ruediger.pluem</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>52792</commentid>
    <comment_count>0</comment_count>
    <who name="Rüdiger Plüm">ruediger.pluem</who>
    <bug_when>2004-02-23 12:49:15 +0000</bug_when>
    <thetext>Hi,

I noticed that the minSpareThreads / maxSpareThreads settings do not work with
the AJP connector. To be more precise settings these values in the connector
element has no effect at all. Instead the default values for minSpareThreads /
maxSpareThreads are used for the ThreadPool. I had a look at the sources and
noticed that the appropriate setters are missing in
org.apache.jk.common.ChannelSocket. As I do not have that in depth knowledge of
the code I am not sure if it was simply forgotten to implement or if having the
possibiliy to change these settings via the configuration creates other
problems. But as the default values are used in the current situation I do not
think so.
So I created a small patch for this, which works fine for me. I will attach it
to this report.

Best regards

Rüdiger Plüm</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52793</commentid>
    <comment_count>1</comment_count>
      <attachid>10490</attachid>
    <who name="Rüdiger Plüm">ruediger.pluem</who>
    <bug_when>2004-02-23 12:50:57 +0000</bug_when>
    <thetext>Created attachment 10490
Enable minSpareThreads / maxSpareThreads for AJP Connector</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52794</commentid>
    <comment_count>2</comment_count>
    <who name="Henri Gomez">hgomez</who>
    <bug_when>2004-02-23 13:09:05 +0000</bug_when>
    <thetext>Commited thanks</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>10490</attachid>
            <date>2004-02-23 12:50:00 +0000</date>
            <delta_ts>2004-02-23 12:50:57 +0000</delta_ts>
            <desc>Enable minSpareThreads / maxSpareThreads for AJP Connector</desc>
            <filename>jakarta-tomcat-5.0.18.thread-fix.diff</filename>
            <type>text/plain</type>
            <size>2239</size>
            <attacher name="Rüdiger Plüm">ruediger.pluem</attacher>
            

          </attachment>
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>27190</bug_id>
          
          <creation_ts>2004-02-24 15:15:00 +0000</creation_ts>
          <short_desc>Redirect problem with the COPY / MOVE request handling in the WebDAV servlet</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlets:WebDAV</component>
          <version>5.0.18</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Rüdiger Plüm">ruediger.pluem</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>52860</commentid>
    <comment_count>0</comment_count>
    <who name="Rüdiger Plüm">ruediger.pluem</who>
    <bug_when>2004-02-24 15:15:19 +0000</bug_when>
    <thetext>Hi,

there is a redirect problem with the COPY / MOVE request handling in the WebDAV
servlet of
Tomcat.

Environment:

I created the webdav application with the following web.xml file in
webapps/webdav/WEB-INF:

&lt;!DOCTYPE web-app
    PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
    "http://java.sun.com/dtd/web-app_2_3.dtd"&gt;
 
&lt;web-app&gt;
 
  &lt;servlet&gt;
    &lt;servlet-name&gt;webdav&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.apache.catalina.servlets.WebdavServlet&lt;/servlet-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;debug&lt;/param-name&gt;
      &lt;param-value&gt;10&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;listings&lt;/param-name&gt;
      &lt;param-value&gt;true&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;!-- Uncomment this to enable read and write access --&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;readonly&lt;/param-name&gt;
      &lt;param-value&gt;false&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;!--load-on-startup&gt;1&lt;/load-on-startup--&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;webdav&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;

&lt;/web-app&gt;

The directory webapps/webdav/ is writable by the Tomcat jvm.

I created the collection col  with cadaver (which worked fine).

So this is our starting point:

dav:/webdav/&gt; ls
Listing collection `/webdav/': succeeded.
Coll:  col                                     0  Jan  1  1970

If you try to move the collection col to col1 which results in the following request

MOVE /webdav/col HTTP/1.1
User-Agent: neon/0.23.0 cadaver/0.20.5
Connection: TE
TE: trailers
Destination: http://127.0.0.1:8080/webdav/col1
Overwrite: T

you get a 302 as response:

HTTP/1.1 302 Moved Temporarily
Location: http://127.0.0.1:8080/webdav/col/
Transfer-Encoding: chunked
Date: Tue, 24 Feb 2004 13:37:41 GMT
Server: Apache-Coyote/1.1

The reason for this behaviour is caused by the fact that MOVE /webdav/col is used
instead of MOVE /webdav/col/. If you use MOVE /webdav/col/ everything works fine.

This is the reason why there is the redirect-carefully special environment
variable within Apache
as this problem is known with many webdav clients (see also
http://httpd.apache.org/docs-2.0/env.html#special).

The actual redirect is created in the lines 753 - 767 of

org/apache/tomcat/util/http/mapper/Mapper.java

which creates this redirect long before the WebDAVServlet has a chance to handle
this situation on its own.
And now I am a little helpless how to fix this :-).


Regards

Rüdiger Plüm</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52861</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-24 15:23:27 +0000</bug_when>
    <thetext>This is really painful. If this is my decision, then this will not be fixed.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52862</commentid>
    <comment_count>2</comment_count>
    <who name="Rüdiger Plüm">ruediger.pluem</who>
    <bug_when>2004-02-24 15:32:03 +0000</bug_when>
    <thetext>But this makes the webdav servlet inusable for the most used and most hated (at
least on the side of the people who implement webdav servers) webdav client: MS
webfolders. So I hope there will be a fix for this within Tomcat.

Regards

Rüdiger
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52867</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-24 16:29:17 +0000</bug_when>
    <thetext>Yes, but then you will complain that redirect will always occur for the root
path of a context (ex: a request to "/webdav") and that it also breaks broken
clients. I think there's no point, and I recommend looking for other servers
which would be more complex and legacy friendly (such as mod_dav, or Slide -
although Slide won't help for the root path problem).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52869</commentid>
    <comment_count>4</comment_count>
    <who name="Rüdiger Plüm">ruediger.pluem</who>
    <bug_when>2004-02-24 16:50:52 +0000</bug_when>
    <thetext>You know the typical requester: If you give him a small finger he wants your
whole hand! :-).

But back to the problem: The problem with the root path of the context can be
fixed by using the correct URL within MS Webfolders, but the other problems with
MOVE and copy cannot be fixed this way.

I admit that this problem is difficult to fix. Maybe there could be a check for
the request method in CoyoteAdapter.postParseRequest to prevent the redirect for
COPY and MOVE methods. Maybe there is the possibility of creating an xml
attribute for the coyote connector which lets you specify which methods should
not do redirects with a default value to "". But I am not sure if it is easy to
get the configuration settings for the coyote connector from this method.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52897</commentid>
    <comment_count>5</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2004-02-24 23:16:36 +0000</bug_when>
    <thetext>What happens if you use a url-pattern of /* for the servlet mapping? I have 
stepped though this using telnet and I don't see the 302. That being said, it 
still doesn't work and I am looking into why.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52898</commentid>
    <comment_count>6</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2004-02-24 23:34:56 +0000</bug_when>
    <thetext>OK, I have looked at this further (using a url-pattern of /*) and it does 
work. The errors I was seeing were as a result of an invalid cache due to 
previous testing.

There is a minor issue in that the status code returned will always be 204. 
This is not 100% compliant with para 8.9.4 of the servlet spec.

Note I am using the latest code from CVS.

I'l leave this open until I fix the status code issue but I am dropping the 
severity.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52902</commentid>
    <comment_count>7</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-25 00:55:59 +0000</bug_when>
    <thetext>Yes, this is a good workaround (and is the mapping used in the webdav example
webapp): no welcome file processing (or folder redirection) will occur in that case.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52914</commentid>
    <comment_count>8</comment_count>
    <who name="Rüdiger Plüm">ruediger.pluem</who>
    <bug_when>2004-02-25 09:48:51 +0000</bug_when>
    <thetext>I can confirm that the change in the servlet mapping makes it work for me too
(even with MS Webfolders :-)).
Thank you for looking into this and for your quick help.
BTW: I noticed that the webdav webapp delivered with Tomcat 5.0.19 already uses
the /* and thus correct servlet mapping. Maybe a comment should be added to the
web.xml file that setting the mapping to / will break things with MS Webfolders.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>52973</commentid>
    <comment_count>9</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2004-02-25 22:54:01 +0000</bug_when>
    <thetext>The status code issue has now been fixed in CVS for TC5 and TC4. I have also 
improved the comment in the web.xml for TC5.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27276</bug_id>
          
          <creation_ts>2004-02-26 23:41:00 +0000</creation_ts>
          <short_desc>JAASCallbackHandler gives erroneous warning due to buggy implementation</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.18</version>
          <rep_platform>All</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Rohan Lenard">rlenard</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>53074</commentid>
    <comment_count>0</comment_count>
    <who name="Rohan Lenard">rlenard</who>
    <bug_when>2004-02-26 23:41:18 +0000</bug_when>
    <thetext>If there is a null password set (the default for a PasswordCallback) then 
JAASCallbackHandler.handle() gets a NullPointerException at line 156 (trying to 
set the password).  This is just completely spurious.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53118</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-27 13:09:28 +0000</bug_when>
    <thetext>Any patch to propose ?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53206</commentid>
    <comment_count>2</comment_count>
    <who name="Rohan Lenard">rlenard</who>
    <bug_when>2004-02-29 02:45:50 +0000</bug_when>
    <thetext>Something like this should do it.
$ diff JAASCallbackHandler.java{.orig,}
156,157c156,161
&lt;                 ((PasswordCallback) callbacks[i]).setPassword
&lt;                     (password.toCharArray());
---
&gt;                 final char[] passwordcontents;
&gt;                 if (password != null)
&gt;                     passwordcontents = passowrd.toCharArray();
&gt;                 else
&gt;                     passwordcontents = new char[0];
&gt;                 ((PasswordCallback) callbacks[i]).setPassword(passwordcontents
);</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53216</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-29 12:39:30 +0000</bug_when>
    <thetext>The proposed patch looks ok.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27296</bug_id>
          
          <creation_ts>2004-02-27 17:13:00 +0000</creation_ts>
          <short_desc>Session may be used before being declared valid</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina:Cluster</component>
          <version>5.0.19</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Aadi Deshpande">adeshpande</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>53146</commentid>
    <comment_count>0</comment_count>
    <who name="Aadi Deshpande">adeshpande</who>
    <bug_when>2004-02-27 17:13:23 +0000</bug_when>
    <thetext>taken from my email : 

it seems that DeltaSession.setId() fires the
sessionCreated events to registered listeners, but this happens before a
session is declared valid ( i.e. setValid(true) has not been called ).

so when a  registered listener tries to utilize ( what it seems to
believe is ) a newly created session, the setAttribute method throws the
IllegalStateException..</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53147</commentid>
    <comment_count>1</comment_count>
      <attachid>10594</attachid>
    <who name="Aadi Deshpande">adeshpande</who>
    <bug_when>2004-02-27 17:14:26 +0000</bug_when>
    <thetext>Created attachment 10594
patch for issue . n.b. patch is against HEAD, but bug was reported against 5.0.19</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53431</commentid>
    <comment_count>2</comment_count>
    <who name="Filip Hanik">fhanik</who>
    <bug_when>2004-03-04 15:49:22 +0000</bug_when>
    <thetext>Fixed, thanks for the tip</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>10594</attachid>
            <date>2004-02-27 17:14:00 +0000</date>
            <delta_ts>2004-02-27 17:14:26 +0000</delta_ts>
            <desc>patch for issue . n.b. patch is against HEAD, but bug was reported against 5.0.19</desc>
            <filename>cluster.patch</filename>
            <type>text/plain</type>
            <size>1537</size>
            <attacher name="Aadi Deshpande">adeshpande</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27299</bug_id>
          
          <creation_ts>2004-02-27 17:37:00 +0000</creation_ts>
          <short_desc>Using -security and port 80 causes crash</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.19</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="William Brogden">wbrogden</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>53152</commentid>
    <comment_count>0</comment_count>
    <who name="William Brogden">wbrogden</who>
    <bug_when>2004-02-27 17:37:51 +0000</bug_when>
    <thetext>download and install jakarta-tomcat5.19.zip - feb 27 version
Set environment CATALINA_HOME=C:\Servers\Tomcat-5.0.19
  with port 8080 and no use of -security  - ok
  with 8080 and -security in commandline - ok
  
  change server.xml to port 80 regular startup.bat
  http://localhost/    - works fine

  continue with server.xml port 80 with -security in startup.bat command line
  
 try for  http://localhost/
  no response, extended bunch of errors in command prompt window, 
  the total log is:

2004-02-27 11:20:49 StandardContext[/balancer]org.apache.webapp.balancer.
BalancerFilter: init(): ruleChain: [org.apache.webapp.balancer.RuleChain: [org.
apache.webapp.balancer.rules.URLStringMatchRule: Target string: News / Redirect 
URL: http://www.cnn.com], [org.apache.webapp.balancer.rules.
RequestParameterRule: Target param name: paramName / Target param value: 
paramValue / Redirect URL: http://www.yahoo.com], [org.apache.webapp.balancer.
rules.AcceptEverythingRule: Redirect URL: http://jakarta.apache.org]]
2004-02-27 11:20:50 StandardContext[/jsp-examples]ContextListener: 
contextInitialized()
2004-02-27 11:20:50 StandardContext[/jsp-examples]SessionListener: 
contextInitialized()
2004-02-27 11:20:50 StandardContext[/servlets-examples]ContextListener: 
contextInitialized()
2004-02-27 11:20:50 StandardContext[/servlets-examples]SessionListener: 
contextInitialized()
2004-02-27 11:21:04 StandardWrapperValve[org.apache.jsp.index_jsp]: Servlet.
service() for servlet org.apache.jsp.index_jsp threw exception
java.lang.NoClassDefFoundError: org/apache/tomcat/util/buf/HexUtils
	at org.apache.coyote.http11.filters.ChunkedOutputFilter.
doWrite(ChunkedOutputFilter.java:163)
	at org.apache.coyote.http11.InternalOutputBuffer.
doWrite(InternalOutputBuffer.java:612)
	at org.apache.coyote.Response.doWrite(Response.java:586)
	at org.apache.coyote.tomcat5.OutputBuffer.realWriteBytes(OutputBuffer.java:
411)
	at org.apache.tomcat.util.buf.ByteChunk.append(ByteChunk.java:332)
	at org.apache.tomcat.util.buf.IntermediateOutputStream.write(C2BConverter.
java:274)
	at sun.nio.cs.StreamEncoder$CharsetSE.writeBytes(StreamEncoder.java:336)
	at sun.nio.cs.StreamEncoder$CharsetSE.implFlushBuffer(StreamEncoder.java:
404)
	at sun.nio.cs.StreamEncoder$CharsetSE.implFlush(StreamEncoder.java:408)
	at sun.nio.cs.StreamEncoder.flush(StreamEncoder.java:152)
	at java.io.OutputStreamWriter.flush(OutputStreamWriter.java:213)
	at org.apache.tomcat.util.buf.WriteConvertor.flush(C2BConverter.java:223)
	at org.apache.tomcat.util.buf.C2BConverter.flushBuffer(C2BConverter.java:
166)
	at org.apache.coyote.tomcat5.OutputBuffer.realWriteChars(OutputBuffer.java:
613)
	at org.apache.tomcat.util.buf.CharChunk.append(CharChunk.java:298)
	at org.apache.coyote.tomcat5.OutputBuffer.write(OutputBuffer.java:518)
	at org.apache.coyote.tomcat5.CoyoteWriter.write(CoyoteWriter.java:165)
	at org.apache.jasper.runtime.JspWriterImpl.flushBuffer(JspWriterImpl.java:
161)
	at org.apache.jasper.runtime.JspWriterImpl.write(JspWriterImpl.java:368)
	at org.apache.jasper.runtime.JspWriterImpl.write(JspWriterImpl.java:379)
	at org.apache.jsp.index_jsp._jspService(index_jsp.java:50)
	at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:133)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.
java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.
invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:324)
	at org.apache.catalina.security.SecurityUtil$1.run(SecurityUtil.java:284)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAsPrivileged(Subject.java:500)
	at org.apache.catalina.security.SecurityUtil.execute(SecurityUtil.java:306)
	at org.apache.catalina.security.SecurityUtil.doAsPrivilege(SecurityUtil.
java:200)
	at org.apache.catalina.core.ApplicationFilterChain.
internalDoFilter(ApplicationFilterChain.java:278)
	at org.apache.catalina.core.ApplicationFilterChain.
access$000(ApplicationFilterChain.java:97)
	at org.apache.catalina.core.ApplicationFilterChain$1.
run(ApplicationFilterChain.java:187)
	at java.security.AccessController.doPrivileged(Native Method)
	at org.apache.catalina.core.ApplicationFilterChain.
doFilter(ApplicationFilterChain.java:183)
	at org.apache.catalina.core.StandardWrapperValve.
invoke(StandardWrapperValve.java:257)
	at org.apache.catalina.core.StandardValveContext.
invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:
567)
	at org.apache.catalina.core.StandardContextValve.
invokeInternal(StandardContextValve.java:245)
	at org.apache.catalina.core.StandardContextValve.
invoke(StandardContextValve.java:199)
	at org.apache.catalina.core.StandardValveContext.
invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:
567)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.
java:184)
	at org.apache.catalina.core.StandardValveContext.
invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.
java:164)
	at org.apache.catalina.core.StandardValveContext.
invokeNext(StandardValveContext.java:149)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:
567)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.
java:156)
	at org.apache.catalina.core.StandardValveContext.
invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:
567)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:206)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:
833)
	at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.
processConnection(Http11Protocol.java:732)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:
619)
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.
run(ThreadPool.java:688)
	at java.lang.Thread.run(Thread.java:534)
------------------------
I also observed this with release 5.0.18</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53154</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-27 17:53:46 +0000</bug_when>
    <thetext>This is indeed 100% specific to port 80. Other ports don't do that.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53238</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-29 22:53:35 +0000</bug_when>
    <thetext>I committed an ugly fix for this issue (which, BTW, has a 100% rational
explanation: try http://localhost:80/).</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27300</bug_id>
          
          <creation_ts>2004-02-27 17:59:00 +0000</creation_ts>
          <short_desc>SMAP line numbers incorrect when JSP comments are present</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.19</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="rob ward">robw</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>53155</commentid>
    <comment_count>0</comment_count>
    <who name="rob ward">robw</who>
    <bug_when>2004-02-27 17:59:50 +0000</bug_when>
    <thetext>If a JSP contains JSP comments, the generated servlet does not contain the JSP 
comments. Consequently, the SMAP line mappings are incorrect. 

For example, given a JSP:

&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Untitled Document&lt;/title&gt;
  &lt;/head&gt;
  &lt;%--
  JSP comment
  --%&gt;
  &lt;body&gt;
  &lt;/body&gt;
&lt;/html&gt;

The relevant section of the generated servlet (lines 42 to 49, inclusive) is:

      out.write("&lt;html&gt;\n");
      out.write("  &lt;head&gt;\n");
      out.write("    &lt;title&gt;Untitled Document&lt;/title&gt;\n");
      out.write("  &lt;/head&gt;\n");
      out.write("  \n");
      out.write("  &lt;body&gt;\n");
      out.write("  &lt;/body&gt;\n");
      out.write("&lt;/html&gt;");

And the Generated SMAP is:

SMAP
test_jsp.java
JSP
*S JSP
*F
+ 0 test.jsp
test.jsp
*L
1,8:42
*E

The fix requires the following two modications:

1) In the class org.apache.jasper.compiler.TextOptimizer, the overriden method 
visit(Node.Comment n) must be removed.


2) The inner class org.apache.jasper.compiler.Generator.GenerateVisitor must
override the method visit(Node.Comment n). I tested this, using the following 
code, which works correctly:

    public void visit(Node.Comment n) throws JasperException {
            n.setBeginJavaLine(out.getJavaLine());
            out.printin("out.write(\"&lt;%--");
            String text = n.getText();
            boolean newLine = false;

            if (text != null) {
              for (int i = 0; i &lt; text.toCharArray().length; i++)
              {
                if (newLine) {
                  out.printin("out.write(\"");
                }

                char ch = text.charAt(i);

                if (ch == '\n') {
                  out.println("\\n\");");
                  newLine = true;
                }
                else {
                  out.print(ch);
                  newLine = false;
                }
              }
            }

            // @todo: should the closing tag have a newline appended to it?
            if (newLine) {
              out.printil("out.write(\"--%&gt;\");");
            }
            else {
              out.println("--%&gt;\");");
            }

            n.setEndJavaLine(out.getJavaLine());
        }</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53158</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-02-27 19:01:00 +0000</bug_when>
    <thetext>Applying the first step in you suggestion seems to fix the line mapping problem.
 I don't think it is necessary, or even correct, to generate the jsp comments in
the response.  

Thanks for reporting and the patch.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53164</commentid>
    <comment_count>2</comment_count>
    <who name="rob ward">robw</who>
    <bug_when>2004-02-27 23:45:01 +0000</bug_when>
    <thetext>Kim-Man, you are indeed correct - I forgot that JSP comments should not be 
emitted. I've verified independently that the first patch alone is sufficient. 

Thanks for the fast response. </thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27307</bug_id>
          
          <creation_ts>2004-02-28 01:50:00 +0000</creation_ts>
          <short_desc>Suggestions to improve JNDI/DataSource Howto</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Documentation</component>
          <version>5.0.19</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>http://localhost:8080/tomcat-docs/jndi-datasource-examples-howto.html</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Felipe Leme">nagoya</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>53172</commentid>
    <comment_count>0</comment_count>
    <who name="Felipe Leme">nagoya</who>
    <bug_when>2004-02-28 01:50:21 +0000</bug_when>
    <thetext>Hi all,

I've been reading the Howto and have some suggestions (specially regarding the
MySQL example):

- it's necessary to copy the JDBC driver jar on TOMCAT_HOME/common/lib

- you say: Please let us know if you have tested the new MySQL mm.mysql 3.0 driver. 

Well, I did (version 3.0.11-stable). It works the way it is, but I'd suggest you
update the howto to use the new driver. So, instead of :

    &lt;!-- Class name for mm.mysql JDBC driver --&gt;
    &lt;parameter&gt;
       &lt;name&gt;driverClassName&lt;/name&gt;
       &lt;value&gt;org.gjt.mm.mysql.Driver&lt;/value&gt;
    &lt;/parameter&gt;

It should be:

    &lt;!-- Class name for MySQL Connector/J driver --&gt;
    &lt;parameter&gt;
       &lt;name&gt;driverClassName&lt;/name&gt;
       &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;
    &lt;/parameter&gt;


- section 3 (web.xml configuration) uses the old web.xml format (Servlet 2.3):

&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
    &lt;!DOCTYPE web-app PUBLIC
    "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
    "http://java.sun.com/dtd/web-app_2_3.dtd"&gt;
&lt;web-app&gt;
  &lt;description&gt;MySQL Test App&lt;/description&gt;
  &lt;resource-ref&gt;
      &lt;description&gt;DB Connection&lt;/description&gt;
      &lt;res-ref-name&gt;jdbc/TestDB&lt;/res-ref-name&gt;
      &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
      &lt;res-auth&gt;Container&lt;/res-auth&gt;
  &lt;/resource-ref&gt;
&lt;/web-app&gt;

I know Tomcat 5 accepts both formats, but we should be "incentiving" people to
use the new one. So, it should be:

&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
 
&lt;web-app xmlns="http://java.sun.com/xml/ns/j2ee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee
http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"
    version="2.4"&gt;
    
  &lt;description&gt;MySQL Test App&lt;/description&gt;
  &lt;resource-ref&gt;
      &lt;description&gt;DB Connection&lt;/description&gt;
      &lt;res-ref-name&gt;jdbc/TestDB&lt;/res-ref-name&gt;
      &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
      &lt;res-auth&gt;Container&lt;/res-auth&gt;
  &lt;/resource-ref&gt;

&lt;/web-app&gt;

- section 4 (Test code). It would be nicer/simpler a JSTL/SQL example, like this:

&lt;%@ taglib uri="http://java.sun.com/jsp/jstl/sql" prefix="sql" %&gt;
&lt;%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %&gt;

&lt;sql:query var="rs" dataSource="jdbc/TestDB"&gt;
select id, foo, bar from testdata
&lt;/sql:query&gt;

&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;DB Test&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;

  &lt;h2&gt;Results&lt;/h2&gt;
  
&lt;c:forEach var="row" items="${rs.rows}"&gt;
    Foo ${row.foo}&lt;br/&gt;
    Bar ${row.bar}&lt;br/&gt;
&lt;/c:forEach&gt;

  &lt;/body&gt;
&lt;/html&gt;



I can create a patch with these changes, if someone is willing to apply it (I'm
a committer on other projects, so I know how painful the process is :-).

Regards,

Felipe</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53184</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-28 11:06:39 +0000</bug_when>
    <thetext>Yes, please submit a patch.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53202</commentid>
    <comment_count>2</comment_count>
      <attachid>10612</attachid>
    <who name="Felipe Leme">nagoya</who>
    <bug_when>2004-02-29 02:02:07 +0000</bug_when>
    <thetext>Created attachment 10612
Result of 'cvs diff -u' on directory jakarta-tomcat-catalina/webapps/docs</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53203</commentid>
    <comment_count>3</comment_count>
      <attachid>10613</attachid>
    <who name="Felipe Leme">nagoya</who>
    <bug_when>2004-02-29 02:07:21 +0000</bug_when>
    <thetext>Created attachment 10613
New patch with a warning about copying the JDBC driver jar</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53204</commentid>
    <comment_count>4</comment_count>
      <attachid>10614</attachid>
    <who name="Felipe Leme">nagoya</who>
    <bug_when>2004-02-29 02:08:41 +0000</bug_when>
    <thetext>Created attachment 10614
New howto after running ant</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53205</commentid>
    <comment_count>5</comment_count>
    <who name="Felipe Leme">nagoya</who>
    <bug_when>2004-02-29 02:10:39 +0000</bug_when>
    <thetext>Ok, patch added:

http://nagoya.apache.org/bugzilla/showattachment.cgi?attach_id=10613

And also a "screenshot" of the results:

http://nagoya.apache.org/bugzilla/showattachment.cgi?attach_id=10614

-- Felipe
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53217</commentid>
    <comment_count>6</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-29 12:48:11 +0000</bug_when>
    <thetext>Fixed. Thanks.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>10612</attachid>
            <date>2004-02-29 02:02:00 +0000</date>
            <delta_ts>2004-02-29 02:02:07 +0000</delta_ts>
            <desc>Result of 'cvs diff -u' on directory jakarta-tomcat-catalina/webapps/docs</desc>
            <filename>diff2</filename>
            <type>text/plain</type>
            <size>5713</size>
            <attacher name="Felipe Leme">nagoya</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>10613</attachid>
            <date>2004-02-29 02:07:00 +0000</date>
            <delta_ts>2004-02-29 02:07:21 +0000</delta_ts>
            <desc>New patch with a warning about copying the JDBC driver jar</desc>
            <filename>diff</filename>
            <type>text/plain</type>
            <size>5913</size>
            <attacher name="Felipe Leme">nagoya</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>10614</attachid>
            <date>2004-02-29 02:08:00 +0000</date>
            <delta_ts>2004-02-29 02:08:41 +0000</delta_ts>
            <desc>New howto after running ant</desc>
            <filename>jndi-datasource-examples-howto.html</filename>
            <type>text/html</type>
            <size>47195</size>
            <attacher name="Felipe Leme">nagoya</attacher>
            

          </attachment>
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>27309</bug_id>
          
          <creation_ts>2004-02-28 02:55:00 +0000</creation_ts>
          <short_desc>NPE in ApplicationHttpRequest.java:546</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.19</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Alexey Lef">alef</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>jdane</cc>
    
    <cc>rickkw</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>53174</commentid>
    <comment_count>0</comment_count>
    <who name="Alexey Lef">alef</who>
    <bug_when>2004-02-28 02:55:10 +0000</bug_when>
    <thetext>If localSession comes back as null, localSession.access() throws a 
NullPointerException. There is a check for null but it is after the 
localSession.access() call.
Suggested solution: put an if (localSession == null) around localSession.access
() or move localSession.access() down after the existing null check.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53183</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-02-28 11:04:00 +0000</bug_when>
    <thetext>Sorry for the trouble. This is fixed now.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54426</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-22 21:41:09 +0000</bug_when>
    <thetext>*** Bug 27859 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54726</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-26 11:39:39 +0000</bug_when>
    <thetext>*** Bug 27969 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27330</bug_id>
          
          <creation_ts>2004-03-01 12:15:00 +0000</creation_ts>
          <short_desc>[TagPlugins] Invalid generated JAVA code when nesting tags</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.19</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Yann Cébron">yannc76</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>53264</commentid>
    <comment_count>0</comment_count>
    <who name="Yann Cébron">yannc76</who>
    <bug_when>2004-03-01 12:15:59 +0000</bug_when>
    <thetext>Jasper in 5.0.19 generates invalid JAVA code when using the 
provided 'tagPlugins.xml' to replace JSTL1.1 tags w/ custom JAVA code.

Same application/JSP pages compile and work fine w/ 5.0.16 and previous 
versions.

As far as I understand the problem, the code replacement for the &lt;c:forEach&gt; 
tag references "pageContext" inside its while()-loop, whereas it should use the 
provided argument "_jspx_page_context" (the &lt;c:forEach&gt; tag is nested in other 
tags).

Note: exactly the same problem could as well appear with the other tag 
replacements since they're all referencing "pageContext" in their JAVA-code.

I suppose the name of the PageContext parameter must have changed recently and 
has not been updated in the TagPlugins yet?!</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53288</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-03-01 18:54:22 +0000</bug_when>
    <thetext>The bug is not in the tag plugins, but you are right that it worked in 5.0.16.
The problem is in fixing another bug, page_context is no longer defined
if the codes for a nested tag is generated in a separate method, which is
wrong since page_context should be defined, as required by the spec.

I'll check with Jan to fix this problem.  Thanks for reporting.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53291</commentid>
    <comment_count>2</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-03-01 21:09:55 +0000</bug_when>
    <thetext>Fix in CVS by defining pageContext (not page_context) in the body of the method
for nested tag.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27336</bug_id>
          
          <creation_ts>2004-03-01 14:06:00 +0000</creation_ts>
          <short_desc>digest.bat throws ClassNotFoundException</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.18</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Florian Ebeling">florian.ebeling</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>53272</commentid>
    <comment_count>0</comment_count>
    <who name="Florian Ebeling">florian.ebeling</who>
    <bug_when>2004-03-01 14:06:12 +0000</bug_when>
    <thetext>The windows batch script digest.bat throws a ClassNotFoundException for 

javax.management.MBeanRegistration

As a workaround we included the jmx.jar in the tool-wrapper.bat, but I doubt 
that this really fits well with the tool-wrapper.bat idea. Still, this fixes the
mentioned problem. 

The problem persists in 5.0.19.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53279</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-01 16:01:31 +0000</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27338</bug_id>
          
          <creation_ts>2004-03-01 15:36:00 +0000</creation_ts>
          <short_desc>Wrong mappings for JSP Documents (.jspx)</short_desc>
          <delta_ts>2006-06-11 18:03:48 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.19</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Martin Grebac">martin.grebac</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>53275</commentid>
    <comment_count>0</comment_count>
    <who name="Martin Grebac">martin.grebac</who>
    <bug_when>2004-03-01 15:36:43 +0000</bug_when>
    <thetext>See attached basic.jspx file translated to attached basic_jspx.java file.
The mapping for the file is:

SMAP
basic_jspx.java
JSP
*S JSP
*F
+ 0 basic.jspx
jsp2/jspx/basic.jspx
*L
2:42
3,2:44
5:46,2
9,5:49
19,4:56
*E

 So, there's a mapping between lines 19 -&gt; 56 and 20-&gt;57 but it actually should
be 20 -&gt; 56 and 21 -&gt; 57 (seems like CDATA is not handled properly). 
 The result is weird, because we are looping between 'CDATA' and 'for (..)'
lines , not through the loop itself. There are other problems in the first
scriptlet, too (again CDATA?).
 This prevents debugging of JSP Documents.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53277</commentid>
    <comment_count>1</comment_count>
      <attachid>10620</attachid>
    <who name="Martin Grebac">martin.grebac</who>
    <bug_when>2004-03-01 15:37:26 +0000</bug_when>
    <thetext>Created attachment 10620
generated servlet</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53278</commentid>
    <comment_count>2</comment_count>
      <attachid>10621</attachid>
    <who name="Martin Grebac">martin.grebac</who>
    <bug_when>2004-03-01 15:37:54 +0000</bug_when>
    <thetext>Created attachment 10621
jsp</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53296</commentid>
    <comment_count>3</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-03-01 22:52:31 +0000</bug_when>
    <thetext>Fixed in CVS.  Thanks for reporting this bug and providing the test case.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53323</commentid>
    <comment_count>4</comment_count>
    <who name="Martin Grebac">martin.grebac</who>
    <bug_when>2004-03-02 13:44:11 +0000</bug_when>
    <thetext>Thanks a lot - I really appreciate your really fast response. Will the fix get
to 5.0.next release? 

Seems like I'll submit more bugs against some additional little problems with
xml mappings, though ;O)</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>10620</attachid>
            <date>2004-03-01 15:37:00 +0000</date>
            <delta_ts>2004-03-01 15:37:26 +0000</delta_ts>
            <desc>generated servlet</desc>
            <filename>basic_jspx.java</filename>
            <type>text/plain</type>
            <size>2087</size>
            <attacher name="Martin Grebac">martin.grebac</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>10621</attachid>
            <date>2004-03-01 15:37:00 +0000</date>
            <delta_ts>2004-03-01 15:37:54 +0000</delta_ts>
            <desc>jsp</desc>
            <filename>basic.jspx</filename>
            <type>text/plain</type>
            <size>429</size>
            <attacher name="Martin Grebac">martin.grebac</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27368</bug_id>
          
          <creation_ts>2004-03-02 14:21:00 +0000</creation_ts>
          <short_desc>Incorrect smap mappings for text in JSP Documents</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>PC</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Martin Grebac">martin.grebac</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>53326</commentid>
    <comment_count>0</comment_count>
    <who name="Martin Grebac">martin.grebac</who>
    <bug_when>2004-03-02 14:21:46 +0000</bug_when>
    <thetext>There are missing mappings for some text in XML Documents. See attached jsp +
servlet. 

SMAP is:

SMAP
index_jspx.java
JSP
*S JSP
*F
+ 0 index.jspx
index.jspx
*L
4:42
7:46,3
9:52
*E

Lines 5,6,8 do not have any corresponding mappings - should be 43, 44, 50
Line 7 is mapped to 46,3 - should be 45,5</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53327</commentid>
    <comment_count>1</comment_count>
      <attachid>10634</attachid>
    <who name="Martin Grebac">martin.grebac</who>
    <bug_when>2004-03-02 14:23:45 +0000</bug_when>
    <thetext>Created attachment 10634
JSP</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53328</commentid>
    <comment_count>2</comment_count>
      <attachid>10635</attachid>
    <who name="Martin Grebac">martin.grebac</who>
    <bug_when>2004-03-02 14:24:09 +0000</bug_when>
    <thetext>Created attachment 10635
generated servlet</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53342</commentid>
    <comment_count>3</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-03-02 19:41:34 +0000</bug_when>
    <thetext>This is now fixed in CVS, and will be included in the next Tomcat 5 release.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>10634</attachid>
            <date>2004-03-02 14:23:00 +0000</date>
            <delta_ts>2004-03-02 14:23:45 +0000</delta_ts>
            <desc>JSP</desc>
            <filename>index.jspx</filename>
            <type>text/plain</type>
            <size>149</size>
            <attacher name="Martin Grebac">martin.grebac</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>10635</attachid>
            <date>2004-03-02 14:24:00 +0000</date>
            <delta_ts>2004-03-02 14:24:09 +0000</delta_ts>
            <desc>generated servlet</desc>
            <filename>index_jspx.java</filename>
            <type>text/plain</type>
            <size>1949</size>
            <attacher name="Martin Grebac">martin.grebac</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27447</bug_id>
          
          <creation_ts>2004-03-04 18:09:00 +0000</creation_ts>
          <short_desc>CoyoteReader.readLine() read ahead problems</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.19</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Robert D. Birch">rbirch</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>53448</commentid>
    <comment_count>0</comment_count>
    <who name="Robert D. Birch">rbirch</who>
    <bug_when>2004-03-04 18:09:10 +0000</bug_when>
    <thetext>When posting utf-8 data with either \r\n or \n and that data exceeds the 
MAX_LINE_LENGTH the following I/O exception occurs:
Servlet threw exception
java.io.IOException
	at org.apache.coyote.tomcat5.InputBuffer.reset(InputBuffer.java:463)
	at org.apache.coyote.tomcat5.CoyoteReader.reset(CoyoteReader.java:153)
	at org.apache.coyote.tomcat5.CoyoteReader.readLine
(CoyoteReader.java:207)
	at symhttp.DBRActivationServlet.doPost(DBRActivationServlet.java:31)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:763)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter
(ApplicationFilterChain.java:284)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter
(ApplicationFilterChain.java:204)
	at org.apache.catalina.core.StandardWrapperValve.invoke
(StandardWrapperValve.java:257)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:567)
	at org.apache.catalina.core.StandardContextValve.invokeInternal
(StandardContextValve.java:245)
	at org.apache.catalina.core.StandardContextValve.invoke
(StandardContextValve.java:199)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:567)
	at org.apache.catalina.core.StandardHostValve.invoke
(StandardHostValve.java:184)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.valves.ErrorReportValve.invoke
(ErrorReportValve.java:164)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:149)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:567)
	at org.apache.catalina.core.StandardEngineValve.invoke
(StandardEngineValve.java:156)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:567)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service
(CoyoteAdapter.java:206)
	at org.apache.coyote.http11.Http11Processor.process
(Http11Processor.java:833)
	at 
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio
n(Http11Protocol.java:732)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt
(PoolTcpEndpoint.java:619)
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run
(ThreadPool.java:688)
	at java.lang.Thread.run(Thread.java:536)

If there are NO \r\n or \n then there is no problem sending data greater than 
MAX_LINE_LENGTH. 

Here is my servlet test code:public void doPost(HttpServletRequest request, 
HttpServletResponse response)
throws ServletException, IOException {
    response.setContentType(CONTENT_TYPE);

    System.out.println("Reading body data\n");
    String contentLen = request.getHeader("Content-Length");
    if ( contentLen != null ) {
      System.out.println("String Content-Length: " + contentLen);
      BufferedReader br = request.getReader();
      String in = null;
      while ( (in = br.readLine()) != null ){
        System.out.println(in);
      }
    } else {
      System.out.println("Null content-length");
    }
    PrintWriter out = response.getWriter();
    sendStuff(out);
  }
  //Clean up resources
  public void destroy() {
  }

I think the problem area is in CoyoteReader.readLine() and the handling of \n 
and \r\n. This seems to be around lines  178 - 194 of  
org.apache.coyote.tomcat5.CoyoteReader.java. 

Problem occurred first in 5.0.16, did an upgrade and still had the problem in 
5.0.19, tried it in some version of Tomcat 4 and had no problems.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53451</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-04 18:23:03 +0000</bug_when>
    <thetext>I will try to fix this.
I recommend however that you attempt to design stuff more efficiently. Your web
application is very likely slow.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53506</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-05 13:09:30 +0000</bug_when>
    <thetext>The bug is likely fixed, but this could cause regressions. Please test it.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53680</commentid>
    <comment_count>3</comment_count>
    <who name="Robert D. Birch">rbirch</who>
    <bug_when>2004-03-08 21:16:27 +0000</bug_when>
    <thetext>Thanks for the speedy work, but the problem still exists. I have attached 6 
test files and a simple test servlet. If I send these test files using our http 
client or the curl http client the results are the same. The curl command line 
I use is:

curl -F "name=@postBigLine.txt" http://localhost:8082/Test/TestServlet

Thanks</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53681</commentid>
    <comment_count>4</comment_count>
      <attachid>10712</attachid>
    <who name="Robert D. Birch">rbirch</who>
    <bug_when>2004-03-08 21:22:35 +0000</bug_when>
    <thetext>Created attachment 10712
These are some files with text to test. We actually use XML, but these should suffice</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>10712</attachid>
            <date>2004-03-08 21:22:00 +0000</date>
            <delta_ts>2004-03-08 21:22:35 +0000</delta_ts>
            <desc>These are some files with text to test. We actually use XML, but these should suffice</desc>
            <filename>testfiles.zip</filename>
            <type>application/x-zip-compressed</type>
            <size>842</size>
            <attacher name="Robert D. Birch">rbirch</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27458</bug_id>
          
          <creation_ts>2004-03-04 23:23:00 +0000</creation_ts>
          <short_desc>Tomcat Online Documentation: Missing links to search for tomcat5 bugs</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Documentation</component>
          <version>5.0.0</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>http://jakarta.apache.org/tomcat/faq/bugs.html</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Will Budreau">wbudreau</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>53466</commentid>
    <comment_count>0</comment_count>
    <who name="Will Budreau">wbudreau</who>
    <bug_when>2004-03-04 23:23:31 +0000</bug_when>
    <thetext>The page above should have better links to bugzilla.

Also, on page I was indirectly referenced to, there should be a link to 
 Search the Tomcat 5 bug database &lt;a
href="http://nagoya.apache.org/bugzilla/query.cgi?product=Tomcat%205"here.&lt;/a&gt;
Currently there are only links to tomcat 3 and 4 categories.


I apologize for posting this to this Tomcat bug database, but there is no mail
address for submitting these web page requests without joining a mailing list,
nor is there a component of the tomcat/apache bugzilla database (I could
discover) which allows for this type of request.</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>27469</bug_id>
          
          <creation_ts>2004-03-05 10:28:00 +0000</creation_ts>
          <short_desc>SourceDebugExtension attribute not present in inner-class classfile</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.19</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Martin Grebac">martin.grebac</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>53498</commentid>
    <comment_count>0</comment_count>
    <who name="Martin Grebac">martin.grebac</who>
    <bug_when>2004-03-05 10:28:51 +0000</bug_when>
    <thetext>See attached application and attached translated class files. There's an inner
class defined in the JSP - it's class file does not contain the
SourceDebugExtension attribute. The mappings are defined in the outer class
file, but it's not correct and cannot be used through JDI - it's not possible to
retrieve the mappings for the inner class in this case.
I wouldn't consider this a very big problem for JSPs at all, but it is a problem
for tag files that do generate some inner classes and it's not possible to debug
tag files at all on JSP level.

I'm enclosing a snippet of email discussion with Robert Field (I actually
considered this to be a JDK bug at first):

"Someone should verify that there is no SourceDebugExtension on the inner class
first.  If there is and we aren't using it that would be our problem."

"If there is no JSP stratum (no SourceDebugExtension in the class file) that
sounds like a JSP bug."

-Robert</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53500</commentid>
    <comment_count>1</comment_count>
      <attachid>10674</attachid>
    <who name="Martin Grebac">martin.grebac</who>
    <bug_when>2004-03-05 10:29:37 +0000</bug_when>
    <thetext>Created attachment 10674
Translated source</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53501</commentid>
    <comment_count>2</comment_count>
      <attachid>10675</attachid>
    <who name="Martin Grebac">martin.grebac</who>
    <bug_when>2004-03-05 10:30:02 +0000</bug_when>
    <thetext>Created attachment 10675
Web app</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53538</commentid>
    <comment_count>3</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-03-05 21:22:14 +0000</bug_when>
    <thetext>Arrgh!  The orginal JSR45 support implementation in Jasper never include inner
class!  :-(

Note that in general, Jasper does not know about what's inside scriptlets, so it
does not know about any inner classes that are defined in them.  This is likely
a WONTFIX for providing smaps for inner classes in scriptlets.  Glad you agree
this is not a big problem in practice.

Jasper does know about the inner classes it generates.  I'll see if smaps can be
provided for them.  Stay tuned.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53682</commentid>
    <comment_count>4</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-03-08 21:32:15 +0000</bug_when>
    <thetext>This fixed for jasper generated class files, but not for user defined inner classes.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>10674</attachid>
            <date>2004-03-05 10:29:00 +0000</date>
            <delta_ts>2004-03-05 10:29:37 +0000</delta_ts>
            <desc>Translated source</desc>
            <filename>translated.zip</filename>
            <type>application/octet-stream</type>
            <size>3158</size>
            <attacher name="Martin Grebac">martin.grebac</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>10675</attachid>
            <date>2004-03-05 10:30:00 +0000</date>
            <delta_ts>2004-03-05 10:30:02 +0000</delta_ts>
            <desc>Web app</desc>
            <filename>webapp.zip</filename>
            <type>application/octet-stream</type>
            <size>3775</size>
            <attacher name="Martin Grebac">martin.grebac</attacher>
            

          </attachment>
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>27478</bug_id>
          
          <creation_ts>2004-03-05 18:05:00 +0000</creation_ts>
          <short_desc>cross context redirects don't reference correct session info when imported context redirects back to original context :</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.19</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Aadi Deshpande">adeshpande</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>53522</commentid>
    <comment_count>0</comment_count>
    <who name="Aadi Deshpande">adeshpande</who>
    <bug_when>2004-03-05 18:05:33 +0000</bug_when>
    <thetext>I have discovered another problem, that somehow sessions are either getting lost
or mixed up when you do cross context imports  in at least one advanced scenario :

1) page Z in context 'a' import a page X from context 'b'
2) page X in context 'b' imports a page Y in context 'a'

in this case, the session that was created when you import page X in context b
is the session that's available in page Y in context a.

here's my test case  ---

test_page1.jsp ( context '/profile' ) :

   &lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
   Test of cross context imports :
   &lt;% request.getSession().setAttribute("test_attrib", "12345"); %&gt;
   &lt;% out.println("test_attrib in ( test_page1.jsp ) is " +
   session.getAttribute("test_attrib") ); %&gt;&lt;br/&gt;
   &lt;% out.println("session id (  in test_page1.jsp) is : " +
   request.getSession().getId() ); %&gt; &lt;br/&gt;
   &lt;c:import url="/test_other.jsp" context="/" /&gt;

test_other.jsp ( context '/' ) :

   &lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
   &lt;% request.getSession().setAttribute("test_other_attrib", "54321" );
%&gt;
   &lt;% out.println("test attrib ( in test_other.jsp ) is : " +
   request.getSession().getAttribute("test_attrib") ); %&gt;&lt;br/&gt;
   &lt;% out.println("test other attrib ( in test_other.jsp) is : " +
   request.getSession().getAttribute("test_other_attrib") ); %&gt;&lt;br/&gt;
   &lt;% out.println("session id (  in test_other.jsp) is : " +
   request.getSession().getId() ); %&gt; &lt;br/&gt;
   &lt;c:import url="/test_page2.jsp" context="/profile"/&gt;

test_page2.jsp ( context '/profile' ) :

   &lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
   &lt;% out.println("test_attrib ( in test_page2.jsp ) is " +
   session.getAttribute("test_attrib") ); %&gt; &lt;br/&gt;
   &lt;% out.println("test other attrib ( in test_page2.jsp) is : " +
   request.getSession().getAttribute("test_other_attrib") ); %&gt; &lt;br/&gt;
   &lt;% out.println("session id (  in test_page2.jsp) is : " +
   request.getSession().getId() ); %&gt; &lt;br/&gt;



The output i get when I hit test_page1.jsp is :


Test of cross context imports : test_attrib in ( test_page1.jsp ) is
12345
session id ( in test_page1.jsp) is : 2796EBFF6C413841B7B2D496D7E8FD3F
test attrib ( in test_other.jsp ) is : null
test other attrib ( in test_other.jsp) is : 54321
session id ( in test_other.jsp) is : 2796EBFF6C413841B7B2D496D7E8FD3F
test_attrib ( in test_page2.jsp ) is null
test other attrib ( in test_page2.jsp) is : 54321
session id ( in test_page2.jsp) is : 2796EBFF6C413841B7B2D496D7E8FD3F


The output I get when i hit test_other.jsp is :


test attrib ( in test_other.jsp ) is : null
test other attrib ( in test_other.jsp) is : 54321
session id ( in test_other.jsp) is : 55B2068D3011D727DF15068ADAD713E2
test_attrib ( in test_page2.jsp ) is null
test other attrib ( in test_page2.jsp) is : null
session id ( in test_page2.jsp) is : 55B2068D3011D727DF15068ADAD713E2


the output that i get when i hit test_page2.jsp :

test_attrib ( in test_page2.jsp ) is 12345
test other attrib ( in test_page2.jsp) is : null
session id ( in test_page2.jsp) is : 2796EBFF6C413841B7B2D496D7E8FD3F</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53523</commentid>
    <comment_count>1</comment_count>
    <who name="Aadi Deshpande">adeshpande</who>
    <bug_when>2004-03-05 18:12:08 +0000</bug_when>
    <thetext>2 fixes are necessary --

1)  StandardContext.getContext(String path) does a check for  context==null when
it should be checking for child==null (  a context==null would never fail, and
if it was null, there'd be an NPE long before )

2) The other issue is that cross context requests are set crossContext  by
checking the current context vs. the originating request, instead of the
preceding request, which means that when you import from context A to context B,
then from  B  back to A,  the second import is not considered cross context and
the session information is retrieved from the local session in the (wrong) context. 

I hope this is somewhat explanatory.  Please feel to contact me for clarification.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53545</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-05 23:54:03 +0000</bug_when>
    <thetext>This should be fixed now.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27513</bug_id>
          
          <creation_ts>2004-03-08 10:55:00 +0000</creation_ts>
          <short_desc>When ThreadPool is shutdown one idle thread is left behind</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.0.19</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Sergei Zhirikov">sfzhi</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>53651</commentid>
    <comment_count>0</comment_count>
    <who name="Sergei Zhirikov">sfzhi</who>
    <bug_when>2004-03-08 10:55:21 +0000</bug_when>
    <thetext>When org.apache.tomcat.util.threads.ThreadPool.shutdown() is called it
terminates all the idle threads except one (the last one that became idle). The
problem is that the mentioned method explicitly leaves that thread behind. That
can be easily seen (using a debugger) when tomcat is shutting down. In order to
solve the problem a very small correction is needed. In the mentioned method the
line:

    for(int i = 0 ; i &lt; (currentThreadCount - currentThreadsBusy - 1) ; i++) {

should become:

    for(int i = 0 ; i &lt; (currentThreadCount - currentThreadsBusy) ; i++) {

so that the loop would iterate over all the idle thread without exception.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53659</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-08 14:49:13 +0000</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27517</bug_id>
          
          <creation_ts>2004-03-08 15:21:00 +0000</creation_ts>
          <short_desc>The pageEncoding attribute is not used, when charset value is set.</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.19</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Petr Pisl">petr.pisl</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>mario.winterer</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>53661</commentid>
    <comment_count>0</comment_count>
    <who name="Petr Pisl">petr.pisl</who>
    <bug_when>2004-03-08 15:21:31 +0000</bug_when>
    <thetext>When you have jsp page saved in encoding UTF-8:

&lt;%@page contentType="text/html;charset=ISO-8859-2"%&gt;
&lt;%@page pageEncoding="UTF-8"%&gt;
&lt;html&gt;
&lt;head&gt;&lt;title&gt;JSP Page&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
?šš???ž?ž?ýýáýžýí
&lt;br&gt;&lt;hr&gt;
&lt;/body&gt;
&lt;/html&gt;

then the jsp file is read with ISO-8859-2 encoding. There are wrong Czech
characters in the generated servlet.  But according to the JSP 2.0 specification
the file should be read with encoding from pageEncodintg (UTF-8 in my case) and
the responds has to be in charset value encoding ( ISO-8859-2).

We used the jasper-compiler.jar as jsp parser in NetBeans and we use the result
of the parsing for saving and loading jsp files into the editor, where the wrong
value of encoding causes problems.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53662</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-08 15:24:58 +0000</bug_when>
    <thetext>I don't agree with that interpretation.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53663</commentid>
    <comment_count>2</comment_count>
    <who name="Petr Pisl">petr.pisl</who>
    <bug_when>2004-03-08 15:33:11 +0000</bug_when>
    <thetext>What do you exectly think?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53664</commentid>
    <comment_count>3</comment_count>
    <who name="Petr Pisl">petr.pisl</who>
    <bug_when>2004-03-08 15:42:25 +0000</bug_when>
    <thetext>There is part of the specification:

JSP.4.1
...
For JSP pages in standard syntax, the page character encoding is determined from
the following sources:
-A JSP configuration element page-encoding value whose URL pattern matches the page.
-The pageEncoding attribute of the page directive of the page. It is a
translation- time error to name different encodings in the pageEncoding
attribute of the page directive of a JSP page and in a JSP configuration element
whose URL pattern matches the page.
- The charset value of the contentType attribute of the page directive. This is
used to determine the page character encoding if neither a JSP configuration
element page-encoding nor the pageEncoding attribute are provided.
- If none of the above is provided, ISO-8859-1 is used as the default character
encoding.




Appendix JSP.D
Page Encoding Detection
....

3. If the file is a JSP page in standard syntax, use these steps. 

a. Check whether there is a JSP configuration element &lt;page-encoding&gt; whose URL
pattern matches this file. 

b. Read the file using the initial encoding and search for a pageEncoding
attribute in a page declaration. The specification requires the attribute to be
found only if it is not preceded by non-ASCII characters, so simplified
implementations are allowed. 

c. Report an error if there are a &lt;page-encoding&gt; configuration element whose
URL pattern matches this file and a pageEncoding attribute, and the two name
different encodings. 

d. If there is a &lt;page-encoding&gt; configuration element whose URL pattern matches
this file, the page character encoding is the one named in this element. 

e. Otherwise, if there is a pageEncoding attribute, the page character encoding
is the one named in this attribute. 

f. Otherwise, read the file using the initial encoding and search for a charset
value within a contentType attribute in a page declaration. If it exists, the
page character encoding is the one named in this charset value. The
specification requires the attribute to be found only if it is not preceded by
non-ASCII characters, so simplified implementations are allowed. 

g. Otherwise, the page character encoding is ISO-8859-1.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53665</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-08 16:05:02 +0000</bug_when>
    <thetext>I think that:
- you have way too much time on your hands
- charset and pageEncoding define the same thing, so this is at best an issue of
priority</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53666</commentid>
    <comment_count>5</comment_count>
    <who name="Petr Pisl">petr.pisl</who>
    <bug_when>2004-03-08 17:19:40 +0000</bug_when>
    <thetext>I don't think so, that pageEncoding and charset define the same thing.

According to chapter "JSP.4.1 Page Character Encoding" the pageEncoding is for
encoding the page file itself. And according to chapter "JSP.4.2 Response
Character Encoding" the charset encoding is used for responds. When both
encoding are defined, then they are used for different things.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53667</commentid>
    <comment_count>6</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-08 17:39:05 +0000</bug_when>
    <thetext>Yes, of course. We have a disagreement then (sec 1.10.1). If nobody fixes this
horrible "bug" for a while, then I will resolve it appropriately.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53668</commentid>
    <comment_count>7</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-03-08 17:55:29 +0000</bug_when>
    <thetext>Hi Petr,

you're right, this is a bug. I'll commit a patch shortly.

For the time being, as a workaround, you may want to collapse the 2 page
directives into a single page directive, like this:

&lt;%@page contentType="text/html;charset=ISO-8859-2" pageEncoding="UTF-8"%&gt;

Jan</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53669</commentid>
    <comment_count>8</comment_count>
    <who name="Petr Pisl">petr.pisl</who>
    <bug_when>2004-03-08 18:27:10 +0000</bug_when>
    <thetext>Hi Jan,

yes, it's workaround, but people can have some problems during saving or opening
jsp files in the jsp editor in NetBeans IDE. We use jasper-compiler.jar for
obtaining information about a jsp and the encoding is one of them. I'm
appreciate the  promiss of  fixing it.

thanks

Petr </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53710</commentid>
    <comment_count>9</comment_count>
    <who name="Petr Pisl">petr.pisl</who>
    <bug_when>2004-03-09 10:26:50 +0000</bug_when>
    <thetext>Thanks for the quick fix. 
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58650</commentid>
    <comment_count>10</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-06-03 16:43:14 +0000</bug_when>
    <thetext>*** Bug 29342 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27520</bug_id>
          
          <creation_ts>2004-03-08 18:38:00 +0000</creation_ts>
          <short_desc>NullPointerException when using JspC on webapp tree containing unreadable dir</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.16</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter>seth.leger</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>53670</commentid>
    <comment_count>0</comment_count>
    <who name="">seth.leger</who>
    <bug_when>2004-03-08 18:38:02 +0000</bug_when>
    <thetext>When using JspC, it is possible to get a null pointer exception if the webapp
tree you are attempting to compile contains an unreadable directory. Here are
the lines that cause the stack trace from JspC.java, CVS version 1.61:

 806                             if (f.exists() &amp;&amp; f.isDirectory()) {
 807                                 String[] files = f.list();
 808                                 String ext;
 809                                 for (int i = 0; i &lt; files.length; i++) {
 810                                     File f2 = new File(s, files[i]);

There is no check before line 809 to see if File.list() returned a null value.
Therefore, we get the following stack trace from the jspc Ant task:

   [jasper2] java.lang.NullPointerException
  [jasper2]     at org.apache.jasper.JspC.scanFiles(JspC.java:809)
  [jasper2]     at org.apache.jasper.JspC.execute(JspC.java:856)
  [jasper2]     at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
  [jasper2]     at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
  [jasper2]     at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
  [jasper2]     at java.lang.reflect.Method.invoke(Method.java:324)
  [jasper2]     at org.apache.tools.ant.TaskAdapter.execute(TaskAdapter.java:157)
  [jasper2]     at
org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:306)
  [jasper2]     at org.apache.tools.ant.Task.perform(Task.java:401)
  [jasper2]     at
org.apache.tools.ant.taskdefs.Sequential.execute(Sequential.java:102)
  [jasper2]     at
org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:306)
  [jasper2]     at org.apache.tools.ant.Task.perform(Task.java:401)
  [jasper2]     at
org.apache.tools.ant.taskdefs.Parallel$TaskRunnable.run(Parallel.java:457)
  [jasper2]     at java.lang.Thread.run(Thread.java:536)

It would be much nicer if the task simply logged a warning or ignored the
unreadable directory.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27553</bug_id>
          
          <creation_ts>2004-03-09 23:12:00 +0000</creation_ts>
          <short_desc>Bad cookie in request logged as error</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:Coyote</component>
          <version>5.0.19</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter>sam</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>53771</commentid>
    <comment_count>0</comment_count>
    <who name="">sam</who>
    <bug_when>2004-03-09 23:12:03 +0000</bug_when>
    <thetext>Very minor issue but requests with badly formatted cookies 
generate log messages at severity level error.

Im not sure what the general rule is for logging badly formatted requests
is but a warning in the logs at most seems adequate.

The code below also seems to catch Exception rather than just
java.lang.IllegalArgumentException

Sorry if I should have raised this as "enhancement" rather than "minor".

I think this is the relevant code:

jakarta-tomcat-catalina/catalina/src/share/org/apache/coyote/tomcat5/CoyoteAdapter.java
Line 430 onwards:
            try {
                Cookie cookie = new Cookie(scookie.getName().toString(),
                                           scookie.getValue().toString());
                cookie.setPath(scookie.getPath().toString());
                cookie.setVersion(scookie.getVersion());
                String domain = scookie.getDomain().toString();
                if (domain != null) {
                    cookie.setDomain(scookie.getDomain().toString());
                }
                cookies[idx++] = cookie;
            } catch(Exception ex) {
                log.error("Bad Cookie Name: " + scookie.getName() + 
                    " /Value: " + scookie.getValue(),ex);
            }

This is one of the stack traces I got in the mail :

2004-03-09 16:21:51,390[CoyoteAdapteri ] Bad Cookie Name: Path /Value: /
 java.lang.IllegalArgumentException: Cookie name "Path" is a reserved token at
javax.servlet.http.Cookie.&lt;init&gt;(Cookie.java:185) at
org.apache.coyote.tomcat5.CoyoteAdapter.parseCookies(CoyoteAdapter.java:424) at
org.apache.coyote.tomcat5.CoyoteAdapter.postParseRequest(CoyoteAdapter.java:332)
at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:204) at
org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:828) at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:700)
at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:584) at
org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:683)
at java.lang.Thread.run(Thread.java:536)

Cheers

Sam</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>27617</bug_id>
          
          <creation_ts>2004-03-12 01:49:00 +0000</creation_ts>
          <short_desc>ppt and vsd MIME types should be included in web.xml</short_desc>
          <delta_ts>2007-11-29 04:12:50 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.0.19</version>
          <rep_platform>All</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Scott Pontillo">pontillo</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>53901</commentid>
    <comment_count>0</comment_count>
    <who name="Scott Pontillo">pontillo</who>
    <bug_when>2004-03-12 01:49:54 +0000</bug_when>
    <thetext>Having the following MIME types represented in the default Tomcat web.xml would
be useful:

    &lt;mime-mapping&gt;
        &lt;extension&gt;ppt&lt;/extension&gt;
        &lt;mime-type&gt;application/powerpoint&lt;/mime-type&gt;
    &lt;/mime-mapping&gt;
    &lt;mime-mapping&gt;
        &lt;extension&gt;vsd&lt;/extension&gt;
        &lt;mime-type&gt;application/x-visio&lt;/mime-type&gt;
    &lt;/mime-mapping&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53921</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-12 10:55:08 +0000</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>86252</commentid>
    <comment_count>2</comment_count>
    <who name="Chris Lott">apache7</who>
    <bug_when>2006-02-27 15:41:17 +0000</bug_when>
    <thetext>The lines in web.xml currently distributed with Tomcat 5.0.28 do not work for
Internet Exploder.  Further, the web.xml file omits an entry for "PPS"
(power-point show) files.

Details: I hit problems while attempting to provide access to powerpoint files
using Tomcat 5.0.28.  That version is distributed with these lines in web.xml:

    &lt;mime-mapping&gt;
        &lt;extension&gt;ppt&lt;/extension&gt;
        &lt;mime-type&gt;application/powerpoint&lt;/mime-type&gt;
    &lt;/mime-mapping&gt;

I compared the mime-types with entries in Apache 2.20 mime.types file,
where I find only this:

    application/vnd.ms-powerpoint        ppt

Based on my tests, Firefox works fine with the application/powerpoint
entry, but IE does not.  IE seems to require the
application/vnd.ms-powerpoint variation, and Firefox accepts that as
well.  I used the following to replace what is shown above with good results:

    &lt;mime-mapping&gt;
        &lt;extension&gt;ppt&lt;/extension&gt;
        &lt;mime-type&gt;application/vnd.ms-powerpoint&lt;/mime-type&gt;
    &lt;/mime-mapping&gt;
    &lt;mime-mapping&gt;
        &lt;extension&gt;pps&lt;/extension&gt;
        &lt;mime-type&gt;application/vnd.ms-powerpoint&lt;/mime-type&gt;
    &lt;/mime-mapping&gt;

Please consider using these entries in the web.xml distributed with Tomcat.

I do not have Visio, so could not test the behavior of IE on a Visio file, but
that probably should be checked as well.

I contacted Scott Pontillo, the original reporter of this bug, and he made the
following suggestion:

&gt;    As a longer-term solution to this problem, maybe it would be good to
&gt;establish a process for importing the entries from the native Apache
&gt;server periodically? It seems they are kept more up-to-date for that
&gt;product...

I've taken it upon myself to reopen the bug since it is easily reproducible and
seems like such a minor issue.  I apologize if this was premature.  Thanks for
listening. </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>86806</commentid>
    <comment_count>3</comment_count>
    <who name="Keith Wannamaker">Keith</who>
    <bug_when>2006-03-14 20:15:00 +0000</bug_when>
    <thetext>Fixed in head, thanks.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>27629</bug_id>
          
          <creation_ts>2004-03-12 11:52:00 +0000</creation_ts>
          <short_desc>Memory problem with GZIPOutputFilter</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:Coyote</component>
          <version>5.0.19</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Christian Nester">Christian.Nester</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>53926</commentid>
    <comment_count>0</comment_count>
    <who name="Christian Nester">Christian.Nester</who>
    <bug_when>2004-03-12 11:52:38 +0000</bug_when>
    <thetext>Hi,

the Deflater object, that is used inside the GZIPStream uses native memory. 
This memory will only be free, when the Deflater's finializer runs. See also 
Sun's Bugparades. If the memory is not free, an OutOfMemoryError is created 
sooner or later.
In an enviroment with a lot of memory the java GC might be invoked too late. I 
was able to crash tomcat with a lot of memory and some test load in a few 
seconds.
The solution is to explizitly close the Deflater Objekt to free the native 
memory. This can be done by closing the GZIP stream.
My propose solution to fix the problem in GZIPOutputFilter is included below.
After that change, I was not able to reproduce the crash.
Please verify my solution.

Regards,
Christian


    public long end()
        throws IOException {
        if (compressionStream == null) {
            compressionStream = new GZIPOutputStream(fakeOutputStream);
        }
        compressionStream.finish();
	  long result = ((OutputFilter) buffer).end();
        compressionStream.close(); // frees the deflater memory!
        return result;
    }</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53929</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-12 12:16:55 +0000</bug_when>
    <thetext>And this wouldn't work ?
    public long end()
        throws IOException {
        if (compressionStream == null) {
            compressionStream = new GZIPOutputStream(fakeOutputStream);
        }
        compressionStream.finish();
        compressionStream.close(); // frees the deflater memory!
        return ((OutputFilter) buffer).end();
    }</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53930</commentid>
    <comment_count>2</comment_count>
    <who name="Christian Nester">Christian.Nester</who>
    <bug_when>2004-03-12 12:25:04 +0000</bug_when>
    <thetext>Hi,

I assume, that this would also work. I am not very familiar with the 
architecture of the filtering, so I wanted to place the close() call as 
conservative as possible (after the buffer.end() call). It was just to be on 
the save side.

Regards,
Christian
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>53931</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-12 12:29:31 +0000</bug_when>
    <thetext>As I understand it, only finish will output data. close is supposed to release
memory, so there shouldn't be any problem.
We really need to use a byte array based Java implementation for compression.
All the native code and fake streams make the code really bad.</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>27642</bug_id>
          
          <creation_ts>2004-03-13 20:59:00 +0000</creation_ts>
          <short_desc>trimSpaces property not settable via command-line options</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.19</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Vahur Sinijärv">vahur.sinijarv</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>53955</commentid>
    <comment_count>0</comment_count>
    <who name="Vahur Sinijärv">vahur.sinijarv</who>
    <bug_when>2004-03-13 20:59:50 +0000</bug_when>
    <thetext>There is no command-line option to turn on 'trimSpaces' while 
precompiling .jsp-s.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54026</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-03-15 18:14:44 +0000</bug_when>
    <thetext>Added "-trimSpaces" option to JspC</thetext>
  </long_desc>
      
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>27664</bug_id>
          
          <creation_ts>2004-03-15 14:31:00 +0000</creation_ts>
          <short_desc>Welcome files not found in combination with jsp-property-group</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.0.19</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ronald Wildenberg">ronald</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>53999</commentid>
    <comment_count>0</comment_count>
    <who name="Ronald Wildenberg">ronald</who>
    <bug_when>2004-03-15 14:31:35 +0000</bug_when>
    <thetext>My web.xml contains the following fragment:

   &lt;welcome-file-list&gt;
      &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;
   &lt;/welcome-file-list&gt;
   &lt;jsp-config&gt;
      &lt;jsp-property-group&gt;
         &lt;url-pattern&gt;/notwelcome/*&lt;/url-pattern&gt;
      &lt;/jsp-property-group&gt;
   &lt;/jsp-config&gt;

The URL's '&lt;contextRoot&gt;/notwelcome/' and '&lt;contextRoot&gt;/notwelcome' both do not
deliver the file 'index.html' that is located in the directory /notwelcome.
Instead they result in a 404. If I remove the jsp-property-group, the welcome
file is delivered.

I will attach a test war to demonstrate this behavior.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54000</commentid>
    <comment_count>1</comment_count>
      <attachid>10787</attachid>
    <who name="Ronald Wildenberg">ronald</who>
    <bug_when>2004-03-15 14:35:25 +0000</bug_when>
    <thetext>Created attachment 10787
Demonstrates described behavior.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54001</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-15 14:37:09 +0000</bug_when>
    <thetext>I think we are not going to fix that.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54003</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-15 14:43:46 +0000</bug_when>
    <thetext>I can conform this: the JSP servlet (which will handle all /notwelcome/* URLs)
will not handle welcome files.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54004</commentid>
    <comment_count>4</comment_count>
    <who name="Ronald Wildenberg">ronald</who>
    <bug_when>2004-03-15 15:02:52 +0000</bug_when>
    <thetext>That is not according to the JSP specification.

Nowhere in the spec it is stated that welcome files suddenly should not work any
longer if they happen to be inside a jsp-property-group. Specifying a
jsp-property-group with url-pattern '/*' now effectively disables all welcome
files in the application.

An example from the JSP spec (1-90):

&lt;jsp-property-group&gt;
   &lt;url-pattern&gt;/ja/*&lt;/url-pattern&gt;
   &lt;page-encoding&gt;Shift_JIS&lt;/page-encoding&gt;
&lt;/jsp-property-group&gt;

The Japanese target audience would probably not be very happy with the fact that
any welcome files below '/ja/*' stopped functioning. I'm reopening this bug.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54005</commentid>
    <comment_count>5</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-15 15:07:46 +0000</bug_when>
    <thetext>Developers know how to reopen bugs if somehow I'm wrong. Please don't waste my
time and yours for now.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54043</commentid>
    <comment_count>6</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-03-16 01:42:24 +0000</bug_when>
    <thetext>I'm working on a fix - stay tuned.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54060</commentid>
    <comment_count>7</comment_count>
    <who name="Ronald Wildenberg">ronald</who>
    <bug_when>2004-03-16 12:55:11 +0000</bug_when>
    <thetext>I found another problem with respect to jsp-property-groups and url-mappings.
See bug 27704.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54125</commentid>
    <comment_count>8</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-03-17 00:16:09 +0000</bug_when>
    <thetext>Fixed (I'll let the community decide if they want to go with this fix).

Notice that in your example, /notwelcome/index.html will be interpreted as a
JSP, as it matches the url-pattern of the jsp-property-group.

</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>10787</attachid>
            <date>2004-03-15 14:35:00 +0000</date>
            <delta_ts>2004-03-15 14:35:25 +0000</delta_ts>
            <desc>Demonstrates described behavior.</desc>
            <filename>test.war</filename>
            <type>application/java-archive</type>
            <size>1424</size>
            <attacher name="Ronald Wildenberg">ronald</attacher>
            

          </attachment>
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>27665</bug_id>
          
          <creation_ts>2004-03-15 14:40:00 +0000</creation_ts>
          <short_desc>Nested tags with scripting variables generates invalid code</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.19</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Clemens Wagner">clemens.wagner</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>1</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>54002</commentid>
    <comment_count>0</comment_count>
    <who name="Clemens Wagner">clemens.wagner</who>
    <bug_when>2004-03-15 14:40:10 +0000</bug_when>
    <thetext>Using nested custom tags that create scripting variables leads Jasper to create invalid code. Example:

&lt;my:bean name="outer"&gt;
        &lt;%-- outer is null iff pageContext.findAttribute("outer") is null --%&gt;
        &lt;my:bean name="inner"/&gt;
        &lt;%-- inner is always null even if pageContext.findAttribute("inner") is not  --%&gt;
 &lt;/my:bean&gt;
&lt;%-- outer is null iff pageContext.findAttribute("outer") is null --%&gt;

where the bean-tag sets a value in the pageContext with the given name and any value.
This bug is known since tomcat version 4.1 (see bug 19361).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54439</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-03-23 00:21:22 +0000</bug_when>
    <thetext>Please include a deployable test case in war file.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54467</commentid>
    <comment_count>2</comment_count>
      <attachid>10919</attachid>
    <who name="Clemens Wagner">clemens.wagner</who>
    <bug_when>2004-03-23 11:39:18 +0000</bug_when>
    <thetext>Created attachment 10919
WAR and complete source which demonstrate the bug.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54768</commentid>
    <comment_count>3</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-03-27 01:07:03 +0000</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>10919</attachid>
            <date>2004-03-23 11:39:00 +0000</date>
            <delta_ts>2004-03-23 11:39:18 +0000</delta_ts>
            <desc>WAR and complete source which demonstrate the bug.</desc>
            <filename>27665.war</filename>
            <type>application/octet-stream</type>
            <size>4792</size>
            <attacher name="Clemens Wagner">clemens.wagner</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27704</bug_id>
          
          <creation_ts>2004-03-16 12:52:00 +0000</creation_ts>
          <short_desc>Result of request.getServletPath() wrong in case JSP inside jsp-property-group</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.19</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ronald Wildenberg">ronald</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>54058</commentid>
    <comment_count>0</comment_count>
    <who name="Ronald Wildenberg">ronald</who>
    <bug_when>2004-03-16 12:52:50 +0000</bug_when>
    <thetext>A JSP that maps to a url-pattern in a jsp-property-group does not return the
correct result on calling request.getServletPath(). Instead, this call will
always return the property group url pattern minus the trailing '/*'.

Example:
&lt;url-pattern&gt;/level1/*&lt;/url-pattern&gt;

A JSP in the directory '/level1/level2/test.jsp' calls request.getServletPath().
The result is '/level1' i.o. '/level1/level2/test.jsp'. This may be related to
bug 27664.

I will attach a test.war file that demonstrates the described behavior.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54059</commentid>
    <comment_count>1</comment_count>
      <attachid>10803</attachid>
    <who name="Ronald Wildenberg">ronald</who>
    <bug_when>2004-03-16 12:53:51 +0000</bug_when>
    <thetext>Created attachment 10803
Test case for the described behavior.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54061</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-16 12:58:11 +0000</bug_when>
    <thetext>Well, again, this is normal: the JSP servlet is mapped to the
jsp-property-group. Again, very little chance of being fixed for now ;)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54063</commentid>
    <comment_count>3</comment_count>
    <who name="Ronald Wildenberg">ronald</who>
    <bug_when>2004-03-16 13:10:22 +0000</bug_when>
    <thetext>Ok, this may be perfectly normal from a code perspective, but it is unexpected
behavior that has by now caused me to replace my Servlet2.4/JSP2.0 application
for a Servlet2.3/JSP1.2 application.

Of course everything will also work using the older specs but I'm looking
forward to these issues being fixed in a (hopefully not to remote) future version.

And thanks for not closing my bug this time so I'd have to reopen it again ;)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54065</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-16 13:32:16 +0000</bug_when>
    <thetext>I completely disagree with your two bug reports. Either they are invalid or the
specification is broken. The main problem is this sentence: "If at least one
&lt;jsp-propertygroup&gt; contains the most specific matching URL pattern, the
resource is considered to be a JSP file". This is clearly extremely bad behavior
when using wildcard patterns.
I am going to veto any attempt to fix these last two "bugs" (with bug 27664)
until I am explained why the specification is not broken.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54067</commentid>
    <comment_count>5</comment_count>
    <who name="Ronald Wildenberg">ronald</who>
    <bug_when>2004-03-16 14:40:41 +0000</bug_when>
    <thetext>I do not understand the badness of this behavior. If a resource is matched by a
jsp-property-group, it should be considered a JSP file. If a resource has the
extension .jsp it should be considered a JSP file. What's the difference between
these two?

If you include directories with the resources that match a url-pattern, this
explains bug 27664: a directory is then served as a JSP file, which can not be
found, resulting in a 404.

However, JSP3.3 states: "A JSP property group is a collection of properties that
apply to a set of files that represent JSP pages." Directories are apparently
not included in this definition.

SRV9.10 states: "The purpose of this mechanism is to allow the deployer to
specify an ordered list of partial URIs for the container to use for appending
to URIs when there is a request for a URI that corresponds to a directory entry
in the WAR not mapped to a Web component." Requests for a directory should
result in an attempt to append welcome files to this directory.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54068</commentid>
    <comment_count>6</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-16 14:48:15 +0000</bug_when>
    <thetext>The problem is that this jsp-property-group feature is that it conflicts with
servlet mapping rules, and forces the JSP implementation to be a mini servlet
container in itslef.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54071</commentid>
    <comment_count>7</comment_count>
    <who name="Ronald Wildenberg">ronald</who>
    <bug_when>2004-03-16 15:14:59 +0000</bug_when>
    <thetext>Ok, I agree with the fact that this will probably make a mini servlet container
of the JSP implementation and that this is undesired. But not fixing this also
means that Tomcat is not fully compliant with the spec. This may become a
problem when products that Tomcat is integrated into attempt to become J2EE 1.4
compatible.

You'll probably be happy to know this is the last thing I will say about this issue.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54074</commentid>
    <comment_count>8</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-16 15:25:24 +0000</bug_when>
    <thetext>As I said, I contend that this was not what was intended by the spec authors.
Due to the "servlet mapping"-like effect of jsp-property-group, and yet the need
to have web server like features and a JSP container (I'm sure in 5 minutes
you'll be complaining that directory listings do not work), you need special JSP
specific processing in your servlet container (and this processing is relatively
complex).
To implement jsp-property-group properly, you probably would have to do some
mapping hacks, and assign some requests to the JSP servlet (after regular
mapping), which is relatively complex (jsp-property-group/url-mapping is not
trivial, and you have to do it during request dispatching as well), has a
performance cost (similar to filter mapping), and introduces obvious
dependencies with JSP.
That violates the original design idea of the independence of the servlet and
JSP specs.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54232</commentid>
    <comment_count>9</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-03-18 17:25:59 +0000</bug_when>
    <thetext>Reopening so that I can close it as FIXED.
</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>10803</attachid>
            <date>2004-03-16 12:53:00 +0000</date>
            <delta_ts>2004-03-16 12:53:51 +0000</delta_ts>
            <desc>Test case for the described behavior.</desc>
            <filename>test.war</filename>
            <type>application/java-archive</type>
            <size>1148</size>
            <attacher name="Ronald Wildenberg">ronald</attacher>
            

          </attachment>
      

    <bug_classification class="SPEC">SPEC</bug_classification></bug>
    <bug>
          <bug_id>27752</bug_id>
          
          <creation_ts>2004-03-17 17:49:00 +0000</creation_ts>
          <short_desc>context fails if the path contains subdirectories</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Administration</component>
          <version>5.0.19</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>http://localhost:8080/admin/frameset.jsp (web admin GUI)</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ivan Dunn">I.Dunn</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>54171</commentid>
    <comment_count>0</comment_count>
    <who name="Ivan Dunn">I.Dunn</who>
    <bug_when>2004-03-17 17:49:39 +0000</bug_when>
    <thetext>The context works OK until I try to 'commit changes' on any setting in the GUI
web admin or reboot the server.

eg context path for the webapp is
  /courseCode/startDate

the directory URL is 
  file:/public/htmldocs/courseCode/startDate

If I press save, commit changes then log out, when I log back in again admin
returns the following error:
   type Status report

   message Error retrieving attribute debug

   description The server encountered an internal error (Error retrieving
   attribute debug) that prevented it from fulfilling this request.

Manager then does not show that the context exists. Any requests to the page
show This application is not currently available

If I reboot the server the context has gone as well.

If I use a flat context (eg /courseCode_startDate) it works.

This was not a problem in previous versions.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54174</commentid>
    <comment_count>1</comment_count>
    <who name="Amy Roh">amyroh</who>
    <bug_when>2004-03-17 18:29:43 +0000</bug_when>
    <thetext>What does your localhost_admin.log say when you log back into admin and get
"message Error retrieving attribute debug" error on your browser?  Exception
trace detail would be helpful to see what's going on.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54380</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-22 11:51:04 +0000</bug_when>
    <thetext>This should be fixed now.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54384</commentid>
    <comment_count>3</comment_count>
    <who name="Ivan Dunn">I.Dunn</who>
    <bug_when>2004-03-22 13:56:25 +0000</bug_when>
    <thetext>As I missed the message to post the log, 
     and just in case you're still interested ;-)

(I've left the server restart log - just in case the problem was earlier)
- hope this matches what you've just fixed :-)

**** restart server ****

2004-03-22 13:25:02 StandardContext[/admin]action: Entered
TreeControlTestAction:perform()
2004-03-22 13:25:02 StandardContext[/admin]action: Tree expand/contract on
Catalina:type=Service,serviceName=Catalina
2004-03-22 13:25:02 StandardContext[/admin]action: Found Node:
Catalina:type=Service,serviceName=Catalina
2004-03-22 13:25:04 StandardContext[/admin]action: Entered
TreeControlTestAction:perform()
2004-03-22 13:25:04 StandardContext[/admin]action: Tree expand/contract on
Catalina:type=Host,host=localhost
2004-03-22 13:25:04 StandardContext[/admin]action: Found Node:
Catalina:type=Host,host=localhost
2004-03-22 13:25:20 StandardContext[/admin]action: Entered
TreeControlTestAction:perform()
2004-03-22 13:25:20 StandardContext[/admin]action: tree param is null
2004-03-22 13:25:20 StandardContext[/admin]action: Select event on
Catalina:j2eeType=WebModule,name=//localhost/m877/E,J2EEApplication=none,J2EEServer=none
2004-03-22 13:25:20 StandardContext[/admin]action: Error retrieving attribute debug
javax.management.InstanceNotFoundException:
Catalina:type=Manager,path=/m877/E,host=localhost
	at
com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getMBean(DefaultMBeanServerInterceptor.java:1015)
	at
com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getAttribute(DefaultMBeanServerInterceptor.java:634)
	at com.sun.jmx.mbeanserver.JmxMBeanServer.getAttribute(JmxMBeanServer.java:667)
	at
org.apache.webapp.admin.context.EditContextAction.perform(EditContextAction.java:269)
	at org.apache.struts.action.Action.execute(Action.java:420)
	at
org.apache.struts.action.RequestProcessor.processActionPerform(RequestProcessor.java:484)
	at org.apache.struts.action.RequestProcessor.process(RequestProcessor.java:274)
	at org.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)
	at org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:743)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)
	at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:284)
at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:567)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:206)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:833)
	at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:732)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:619)
	at
org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:688)
	at java.lang.Thread.run(Thread.java:536)


thanks,
   &lt;Ivan.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27790</bug_id>
          
          <creation_ts>2004-03-18 22:19:00 +0000</creation_ts>
          <short_desc>Exception during shutdown of 5.0.19 on JDK 1.3.1</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:Coyote</component>
          <version>5.0.19</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Chuck Caldarale">chuck.caldarale</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>54243</commentid>
    <comment_count>0</comment_count>
    <who name="Chuck Caldarale">chuck.caldarale</who>
    <bug_when>2004-03-18 22:19:30 +0000</bug_when>
    <thetext>It appears that a dependency on JDK 1.4 may have crept into the latest Tomcat 
release build. With 5.0.16, I'm able to shut down Tomcat successfully when it's 
running on either 1.3 or 1.4; with the 5.0.19 release, shutdown requests on 1.4 
operate correctly, but fail with an exception on 1.3:

[INFO] Http11Protocol - -http11protocol.pause
[ERROR] Catalina - -Catalina.stop &lt;LifecycleException:  Cannot find message 
associated with key 
coyoteConnector.protocolHandlerPauseFailed&gt;LifecycleException:Cannot find 
message associated with key coyoteConnector.protocolHandlerPauseFailed
        at org.apache.coyote.tomcat5.CoyoteConnector.pause
(CoyoteConnector.java:1462)
        at org.apache.catalina.core.StandardService.stop
(StandardService.java:560)
        at org.apache.catalina.core.StandardServer.stop
(StandardServer.java:2379)
        at org.apache.catalina.startup.Catalina.stop(Catalina.java:643)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:618)
        at java.lang.reflect.Method.invoke(Native Method)
        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:398)

The server then hangs, but can be terminated with platform-specific kills.

The above came from a Win2K box, but was first observed on a non-Windows 
platform as well - our mainframe JVM, which is stuck on 1.3 for a while.

The real exception has unfortunately been masked by the LifecycleException, 
since the pause() method caught the original one and threw the Lifecycle error.

This is 100% reproducible in a JDK 1.3 environment.

Thanks for taking a look.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54253</commentid>
    <comment_count>1</comment_count>
    <who name="Chuck Caldarale">chuck.caldarale</who>
    <bug_when>2004-03-19 05:51:09 +0000</bug_when>
    <thetext>Found a bit more information about the problem: the original exception that 
triggered the error was java/util/MissingResourceException, with a detail 
message of "Can't find resource for bundle java.util.PropertyResourceBundle, 
key http11protocol.pause". I don't have a walkback yet.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54335</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-21 15:20:59 +0000</bug_when>
    <thetext>Tomcat 5 supports the new servlet &amp; JSP specifications, which require JDK 1.4
(although it might work to some extent with JDK 1.3).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54339</commentid>
    <comment_count>3</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-03-21 17:40:15 +0000</bug_when>
    <thetext>Tomcat is not a JSSE container, so there is no requirement in the spec as to 
which JVM versions are supported.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54340</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-03-21 17:44:09 +0000</bug_when>
    <thetext>Well, then go ahead and fix this. I certainly will not.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54349</commentid>
    <comment_count>5</comment_count>
    <who name="Chuck Caldarale">chuck.caldarale</who>
    <bug_when>2004-03-21 21:28:57 +0000</bug_when>
    <thetext>I think I found the problem. One of the recent changes to Http11Protocol.java 
added pause() and resume() methods which call log.info() to record the actions. 
However, the corresponding messages were not placed in LocalStrings.properties, 
so errors occur when attempting to fetch the text. Under JDK 1.4, using the 
java.util.logging.Logger class, a message is printed, and no exception is 
thrown for the missing text. However, under 1.3, using the commons SimpleLog 
class, an exception is thrown, which kills the main thread, resulting in the 
hang.

I've added the following to the properties file:

http11protocol.endpoint.pauseerror=Error pausing endpoint
http11protocol.pause=Pausing Coyote HTTP/1.1 on port {0}
http11protocol.endpoint.resumeerror=Error resuming endpoint
http11protocol.resume=Resuming Coyote HTTP/1.1 on port {0}

I suspect that there may be other missing message strings, since the 
LifeCycleException seems to be complaining about a similar problem. This may 
also explain the recent spate of e-mails on the tomcat-user list about missing 
messages in the 1.4 log.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54357</commentid>
    <comment_count>6</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-03-21 23:53:56 +0000</bug_when>
    <thetext>As I remembered, Remy added two of the missing messages long ago, and just 
added the other two (at least if you're not using localized messages :).</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27830</bug_id>
          
          <creation_ts>2004-03-22 07:14:00 +0000</creation_ts>
          <short_desc>'null' string in output for JSP documents when EL variable not set</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.19</version>
          <rep_platform>Other</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Magnus Melin">mkmelin+apache</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>54366</commentid>
    <comment_count>0</comment_count>
    <who name="Magnus Melin">mkmelin+apache</who>
    <bug_when>2004-03-22 07:14:56 +0000</bug_when>
    <thetext>correct: When e.g. ${param.test} is not set, for jsp pages the attribute value
is an empty string if printed to output.

wrong: When using jspx (jsp document) the string "null" is in the output instead.
If the param.test is set but null, the empty string is printed in jspx also (as
should be). 

So, when using normal jsp pages, an empthy string is outputted both in case the
${param.test} is in the document text or as an attribute value of some element.
I expect jsp documents to behave the same way.


Testcase:

&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;!-- 
  - JSPX Testcase.
  --&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:jsp="http://java.sun.com/JSP/Page"
      xmlns:c="http://java.sun.com/jsp/jstl/core"&gt; 

  &lt;head&gt;
    &lt;title&gt;Test&lt;/title&gt;
  &lt;/head&gt;

  &lt;body&gt;
    &lt;p&gt;
    When param.test is not set, for jsp pages the attribute value is an empty 
    string if printed to output. &lt;br /&gt;
    When using jspx (jsp document) the string"null" is in the output instead.
    If the param.test is set but null, the empty string is printed in jspx also.
    
    &lt;br /&gt;

    Observe the difference:&lt;br /&gt;
    Not printed: \${param.test} = ${param.test} &lt;br /&gt;

    but displayed as "null" here:&lt;br /&gt;

    &lt;input type="text" value="${param.test}" /&gt;  

    &lt;/p&gt;

  &lt;/body&gt;
&lt;/html&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54438</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-03-23 00:07:59 +0000</bug_when>
    <thetext>Fixed in CVS.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27948</bug_id>
          
          <creation_ts>2004-03-25 16:05:00 +0000</creation_ts>
          <short_desc>NPE with null fragment</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.19</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="David Holscher">David.Holscher</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>54663</commentid>
    <comment_count>0</comment_count>
    <who name="David Holscher">David.Holscher</who>
    <bug_when>2004-03-25 16:05:07 +0000</bug_when>
    <thetext>jsp:invoke throws an NPE when the fragment is null. The spec clearly states 
that null fragments should result in empty output.

JSP.5.12 &lt;jsp:invoke&gt;
... If the fragment identified by the given name is null,
&lt;jsp:invoke&gt; will behave as though a fragment was passed in that produces no
output.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54684</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-03-25 21:45:56 +0000</bug_when>
    <thetext>Fixed in CVS</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>27988</bug_id>
          
          <creation_ts>2004-03-26 17:01:00 +0000</creation_ts>
          <short_desc>Unhelpful FileNotFoundException raised</short_desc>
          <delta_ts>2011-04-10 06:46:35 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.5.33</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter>richard.beton</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>54749</commentid>
    <comment_count>0</comment_count>
    <who name="">richard.beton</who>
    <bug_when>2004-03-26 17:01:25 +0000</bug_when>
    <thetext>org.apache.naming.resources.DirContextURLConnection raises FileNotFoundException
on lines 311, 344, 382 and 396.  It would be more helpful if these provided a
message string.

For example, change line 344 to
        throw new FileNotFoundException(getURL().getFile());

This would make it easier to diagnose mistakes in server configurations.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54750</commentid>
    <comment_count>1</comment_count>
    <who name="">richard.beton</who>
    <bug_when>2004-03-26 17:04:32 +0000</bug_when>
    <thetext>Here's my stack trace that left me baffled at first:

javax.servlet.ServletException: Exception processing JAR at resource path
/WEB-INF/lib/log4j-1.2.8.jar
	at org.apache.catalina.startup.ContextConfig.tldScanJar(ContextConfig.java:930)
	at org.apache.catalina.startup.ContextConfig.tldScan(ContextConfig.java:868)
	at org.apache.catalina.startup.ContextConfig.start(ContextConfig.java:647)
	at org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:243)
	at
org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)
	at org.apache.catalina.core.StandardContext.start(StandardContext.java:3582)
	at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1188)
	at org.apache.catalina.core.StandardHost.start(StandardHost.java:754)
	at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1188)
	at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:363)
	at org.apache.catalina.core.StandardService.start(StandardService.java:497)
	at org.apache.catalina.core.StandardServer.start(StandardServer.java:2190)
	at org.apache.catalina.startup.Catalina.start(Catalina.java:512)
	at org.apache.catalina.startup.Catalina.execute(Catalina.java:400)
	at org.apache.catalina.startup.Catalina.process(Catalina.java:180)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:324)
	at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:203)
----- Root Cause -----
java.io.FileNotFoundException
	at
org.apache.naming.resources.DirContextURLConnection.getInputStream(DirContextURLConnection.java:344)
	at sun.net.www.protocol.jar.URLJarFile.retrieve(URLJarFile.java:161)
	at sun.net.www.protocol.jar.URLJarFile.getJarFile(URLJarFile.java:42)
	at sun.net.www.protocol.jar.JarFileFactory.get(JarFileFactory.java:78)
	at sun.net.www.protocol.jar.JarURLConnection.connect(JarURLConnection.java:85)
	at sun.net.www.protocol.jar.JarURLConnection.getJarFile(JarURLConnection.java:69)
	at org.apache.catalina.startup.ContextConfig.tldScanJar(ContextConfig.java:906)
	at org.apache.catalina.startup.ContextConfig.tldScan(ContextConfig.java:868)
	at org.apache.catalina.startup.ContextConfig.start(ContextConfig.java:647)
	at org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:243)
	at
org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)
	at org.apache.catalina.core.StandardContext.start(StandardContext.java:3582)
	at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1188)
	at org.apache.catalina.core.StandardHost.start(StandardHost.java:754)
	at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1188)
	at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:363)
	at org.apache.catalina.core.StandardService.start(StandardService.java:497)
	at org.apache.catalina.core.StandardServer.start(StandardServer.java:2190)
	at org.apache.catalina.startup.Catalina.start(Catalina.java:512)
	at org.apache.catalina.startup.Catalina.execute(Catalina.java:400)
	at org.apache.catalina.startup.Catalina.process(Catalina.java:180)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:324)
	at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:203)
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>144667</commentid>
    <comment_count>2</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2011-03-02 08:30:41 +0000</bug_when>
    <thetext>The TLD scanning was completely re-written for Tomcat 7 so the error messages there should be a lot better.

I have added the URL (where it isn't null) to the Exception message so it is available for any other code paths that may trigger it. This change has been made to 7.0.x and will be included in 7.0.9 onwards.

I have also proposed the same change for 6.0.x and 5.5.x.

Since 5.5.x is the oldest currently supported version, I am moving this bug to that version.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>145483</commentid>
    <comment_count>3</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2011-04-01 11:12:27 +0000</bug_when>
    <thetext>Fixed in 6.0.x and will be included in 6.0.33 onwards.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>145673</commentid>
    <comment_count>4</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2011-04-10 06:46:35 +0000</bug_when>
    <thetext>Fixed in 5.5.x, will be included in 5.5.34 onwards.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>28058</bug_id>
          
          <creation_ts>2004-03-30 18:17:00 +0000</creation_ts>
          <short_desc>JspRuntimeLibrary.getContextRelativePath() can throw StringIndexOutOfBoundsException</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.19</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Brett Prucha">pruchaba_bah</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>54889</commentid>
    <comment_count>0</comment_count>
    <who name="Brett Prucha">pruchaba_bah</who>
    <bug_when>2004-03-30 18:17:25 +0000</bug_when>
    <thetext>A program I am working on is throwing an exception 
java.lang.StringIndexOutOfBoundsException: String index out of range: -1
from within
org.apache.jasper.runtime.JspRuntimeLibrary.getContextRelativePath
(JspRuntimeLibrary.java:963)

According to the docs http://jakarta.apache.org/tomcat/tomcat-5.0-
doc/servletapi/javax/servlet/http/HttpServletRequest.html#getServletPath(), 
getServletPath() can return an empty string which is what is happening in my 
app.  The line in question:

    uri.substring(0, uri.lastIndexOf('/')) + '/' + relativePath

where uri is an empty string is what is causing this exception to be thrown.  
As you can see uri.lastIndexOf is going to return -1 and uri.substring(0, -1) 
just does not work.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54893</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-03-30 19:21:38 +0000</bug_when>
    <thetext>I was able to reproduce your problem w/ TC 5.0.19.

I assume you have a chain of jsp:include, and have the following jsp-config
element in your web.xml:

    &lt;jsp-config&gt;
      &lt;jsp-property-group&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
      &lt;/jsp-property-group&gt;
    &lt;/jsp-config&gt;

If so, this bug has already been fixed - it is a duplicate of Bugzilla 27704
("Result of request.getServletPath() wrong in case JSP inside
jsp-property-group").

The fix is in CVS, and will be available in TC 5.0.21.

Please confirm that your problem is being caused by the above jsp-config, and I
will go ahead and close this bug as a duplicate of Bugzilla 27704.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54896</commentid>
    <comment_count>2</comment_count>
    <who name="Brett Prucha">pruchaba_bah</who>
    <bug_when>2004-03-30 19:29:16 +0000</bug_when>
    <thetext>Thats my problem.  Though it's not a chain of jsp includes.  I have a servlet 
that forwards a request to a JSP using the "jsp" named dispatcher.  The JSP 
then has an include in it.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54897</commentid>
    <comment_count>3</comment_count>
    <who name="Brett Prucha">pruchaba_bah</who>
    <bug_when>2004-03-30 19:32:26 +0000</bug_when>
    <thetext>The servlet is at

  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;foo&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54900</commentid>
    <comment_count>4</comment_count>
      <attachid>11064</attachid>
    <who name="Brett Prucha">pruchaba_bah</who>
    <bug_when>2004-03-30 20:25:33 +0000</bug_when>
    <thetext>Created attachment 11064
Test Case</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54901</commentid>
    <comment_count>5</comment_count>
    <who name="Brett Prucha">pruchaba_bah</who>
    <bug_when>2004-03-30 20:26:13 +0000</bug_when>
    <thetext>I have attached a test case.

/test/jsp/test.jsp displays "This is a test"
/test/jsp/include.jsp throws java.lang.StringIndexOutOfBoundsException</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54903</commentid>
    <comment_count>6</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-03-30 20:41:17 +0000</bug_when>
    <thetext>I was able to reproduce this bug using the servlet wildcard mapping.

Bugzilla 27704 fixes the problem where the including JSP was mapped to by
a "/*" jsp-config mapping (and getServletPath() used to be empty), but it does
not address the case where a servlet mapped to by "/*" is the entry point.

Kin-Man committed a fix earlier that fixes this problem.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54912</commentid>
    <comment_count>7</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-03-30 23:59:55 +0000</bug_when>
    <thetext>I think your test case has a problem unrelated to the
StringIndexOutOfBoundsException issue it uncovered.

Not only the initial request, but also the target of your &lt;jsp:include&gt; will be
routed through your "test" servlet (due to the "/*" mapping), which means you
end up doing a request dispatcher forward (from your servlet) inside an include.

As a result of this, you'll see this warning in the logs:

  WARNING: Internal error flushing the buffer in release(): java.io.IOException:
Stream closed

when releasing the page context of the including JSP.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>54984</commentid>
    <comment_count>8</comment_count>
    <who name="Brett Prucha">pruchaba_bah</who>
    <bug_when>2004-03-31 17:35:37 +0000</bug_when>
    <thetext>You are right.  I ended up stripping out the code to handle that because I 
never got that far.  Here is the code:

import java.io.IOException;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * Example servlet
 *
 */

public class Test extends HttpServlet {

	public void service(HttpServletRequest req, HttpServletResponse resp)
		throws ServletException, IOException {
	
		ServletContext sc = getServletContext();
		RequestDispatcher rd = sc.getNamedDispatcher("jsp");

		Object attr = req.getAttribute					
	            ("javax.servlet.include.request_uri");
		
		if (attr != null) {
			rd.include(req, resp);
			req.setAttribute("javax.servlet.include.request_uri", 
                            attr);
		} else {
			try {
				rd.forward(req, resp);
			} catch (IllegalStateException e) {
				rd.include(req, resp);
			}
		}
	}
}

</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>11064</attachid>
            <date>2004-03-30 20:25:00 +0000</date>
            <delta_ts>2004-03-30 20:25:33 +0000</delta_ts>
            <desc>Test Case</desc>
            <filename>servlet-test.zip</filename>
            <type>application/zip</type>
            <size>11640</size>
            <attacher name="Brett Prucha">pruchaba_bah</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>28107</bug_id>
          
          <creation_ts>2004-03-31 20:36:00 +0000</creation_ts>
          <short_desc>Enhance Tomcat's Ant tasks for easy build.xml configuration</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>Unknown</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Matt Raible">mraible</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>54994</commentid>
    <comment_count>0</comment_count>
    <who name="Matt Raible">mraible</who>
    <bug_when>2004-03-31 20:36:52 +0000</bug_when>
    <thetext>Cactus has a pretty slick feature in that its tasks can be defined very simply in your build.xml file.  
Here's an example:

        &lt;taskdef resource="cactus.tasks"
            classpathref="cactus.classpath"/&gt;

This is because there is a "cactus.tasks" text file in its JAR file that defines all the tasks.  I've done 
something similar in my Tomcat Ant Tasks HowTo (http://raibledesigns.com/wiki/Wiki.jsp?
page=TomcatAntTasks) - but it'd be much cleaner (and easier) if there was a tomcat.tasks file in 
catalina-ant.jar.  

This bug is to (hopefully) inspire to make Tomcat's Ant integration easier and simpler.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55580</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-04-09 20:22:31 +0000</bug_when>
    <thetext>I'm not convinced by the usefulness of it. It is a little smaller in the user's
build script, but there are still things to add.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55596</commentid>
    <comment_count>2</comment_count>
    <who name="Matt Raible">mraible</who>
    <bug_when>2004-04-09 22:00:33 +0000</bug_when>
    <thetext>2 lines of XML vs. 15 is a big difference IMO. ;-)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55617</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-04-10 15:35:08 +0000</bug_when>
    <thetext>It's an improvement. Thanks.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUILD_SYSTEM">BUILD_SYSTEM</bug_classification></bug>
    <bug>
          <bug_id>28131</bug_id>
          
          <creation_ts>2004-04-01 16:38:00 +0000</creation_ts>
          <short_desc>DeltaManager lost session expiration code line</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina:Cluster</component>
          <version>5.0.21</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Rainer Jung">rainer.jung</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>rainer.jung</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>55071</commentid>
    <comment_count>0</comment_count>
    <who name="Rainer Jung">rainer.jung</who>
    <bug_when>2004-04-01 16:38:39 +0000</bug_when>
    <thetext>In DeltaManager.java in method processExpired from CVS version 1.15 until now 
the line

session.expire();

is lost (line number 918 in CVS version 1.18 resp. line 961 in 1.14).

This leads to no session in the cluster ever expires. Please insert the line 
again.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55072</commentid>
    <comment_count>1</comment_count>
    <who name="Filip Hanik">fhanik</who>
    <bug_when>2004-04-01 16:48:24 +0000</bug_when>
    <thetext>The manager calls isValid() on the session, the isValid() in return expires 
the session if the idle time has been too long.

are you seeing the sessions never disappearing?

filip</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55086</commentid>
    <comment_count>2</comment_count>
    <who name="Rainer Jung">rainer.jung</who>
    <bug_when>2004-04-01 18:05:50 +0000</bug_when>
    <thetext>Sorry, I just realized that isValid is supposed to expire the session. But in 
fact I can't see it expiring. I added some debug code to DeltaSession and will 
provide additional information soon.

Sorry about the wrong first assumption about session.expire, but for me it 
looks like there is an expiration problem.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55089</commentid>
    <comment_count>3</comment_count>
    <who name="Rainer Jung">rainer.jung</who>
    <bug_when>2004-04-01 18:30:23 +0000</bug_when>
    <thetext>Sorry, I just realized that isValid is supposed to expire the session. But in 
fact I can't see it expiring. I added some debug code to DeltaSession and I can 
see the following: Every time the session is checked for expiration the value 
of "accessCount" is 1. session.access increases it to 2 and session.Endaccess 
decreases is to 1. So it looks like the default value of access after creation 
of a new session object should be 0 instead of 1? If this is true, the same may 
apply to recycle.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55090</commentid>
    <comment_count>4</comment_count>
    <who name="Rainer Jung">rainer.jung</who>
    <bug_when>2004-04-01 18:32:00 +0000</bug_when>
    <thetext>Also: session/StandardSession.java uses accessCount=0 in initialization of a 
new session and in recycle.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55099</commentid>
    <comment_count>5</comment_count>
    <who name="Rainer Jung">rainer.jung</who>
    <bug_when>2004-04-01 19:29:03 +0000</bug_when>
    <thetext>I verified, that session expiration works, if you use accessCount=0 in creation 
and recycling of sessions in DeltaSession.java. Please correct.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55109</commentid>
    <comment_count>6</comment_count>
    <who name="Filip Hanik">fhanik</who>
    <bug_when>2004-04-01 21:08:53 +0000</bug_when>
    <thetext>This has been fixed! Thanks Rainer for the detailed explanation</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55145</commentid>
    <comment_count>7</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-04-02 11:16:43 +0000</bug_when>
    <thetext>*** Bug 28156 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>28147</bug_id>
          
          <creation_ts>2004-04-02 01:23:00 +0000</creation_ts>
          <short_desc>JasperException for jsp files that are symbolic links</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.19</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Rick Wong">rickkw</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>55126</commentid>
    <comment_count>0</comment_count>
    <who name="Rick Wong">rickkw</who>
    <bug_when>2004-04-02 01:23:44 +0000</bug_when>
    <thetext>Hi,

I got the following exception when one of my JSP file in my webapp is actually a
symlink to a file in another directory location.  I verified that the symlink is
valid.  The file in question is chError.jsp.  Package name is
com.loudcloud.owm.shared.  Note that Jasper created extra directories
(/soft/lco/occ/channels/shared/rsrc) for chError.jsp.

generate
generate/jsp
generate/jsp/jsp.web.xml
generate/jsp/com
generate/jsp/com/loudcloud
generate/jsp/com/loudcloud/owm
generate/jsp/com/loudcloud/owm/shared
generate/jsp/com/loudcloud/owm/shared/error_jsp.java
generate/jsp/com/loudcloud/owm/shared/logout_jsp.java
generate/jsp/com/loudcloud/owm/shared/soft
generate/jsp/com/loudcloud/owm/shared/soft/lco
generate/jsp/com/loudcloud/owm/shared/soft/lco/occ
generate/jsp/com/loudcloud/owm/shared/soft/lco/occ/channels
generate/jsp/com/loudcloud/owm/shared/soft/lco/occ/channels/shared
generate/jsp/com/loudcloud/owm/shared/soft/lco/occ/channels/shared/rsrc
generate/jsp/com/loudcloud/owm/shared/soft/lco/occ/channels/shared/rsrc/chError_jsp.java


-----------------------------------------

  [jasper2] (jasper.JspC                         762 ) ERROR-the file
'/soft/lco/occ/channels/shared/rsrc/chError.jsp' generated the following general
exception:
  [jasper2] org.apache.jasper.JasperException: File
"/soft/lco/occ/channels/shared/rsrc/chError.jsp" not found
  [jasper2]     at
org.apache.jasper.compiler.DefaultErrorHandler.jspError(DefaultErrorHandler.java:94)
  [jasper2]     at
org.apache.jasper.compiler.ErrorDispatcher.dispatch(ErrorDispatcher.java:404)
  [jasper2]     at
org.apache.jasper.compiler.ErrorDispatcher.jspError(ErrorDispatcher.java:154)
  [jasper2]     at
org.apache.jasper.compiler.JspUtil.getInputStream(JspUtil.java:882)
  [jasper2]     at
org.apache.jasper.xmlparser.XercesEncodingDetector.getEncodingMethod(XercesEncodingDetector.java:160)
  [jasper2]     at
org.apache.jasper.xmlparser.XMLEncodingDetector.getEncoding(XMLEncodingDetector.java:98)
  [jasper2]     at
org.apache.jasper.compiler.ParserController.determineSyntaxAndEncoding(ParserController.java:351)
  [jasper2]     at
org.apache.jasper.compiler.ParserController.doParse(ParserController.java:208)
  [jasper2]     at
org.apache.jasper.compiler.ParserController.parse(ParserController.java:139)
  [jasper2]     at
org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:237)
  [jasper2]     at org.apache.jasper.compiler.Compiler.compile(Compiler.java:456)
  [jasper2]     at org.apache.jasper.JspC.processFile(JspC.java:747)
  [jasper2]     at org.apache.jasper.JspC.execute(JspC.java:882)
  [jasper2]     at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
  [jasper2]     at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
  [jasper2]     at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
  [jasper2]     at java.lang.reflect.Method.invoke(Method.java:324)
  [jasper2]     at org.apache.tools.ant.TaskAdapter.execute(TaskAdapter.java:124)
  [jasper2]     at
org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:269)
  [jasper2]     at org.apache.tools.ant.Task.perform(Task.java:364)
  [jasper2]     at org.apache.tools.ant.Target.execute(Target.java:301)
  [jasper2]     at org.apache.tools.ant.Target.performTasks(Target.java:328)
  [jasper2]     at org.apache.tools.ant.Project.executeTarget(Project.java:1215)
  [jasper2]     at org.apache.tools.ant.Project.executeTargets(Project.java:1063)
  [jasper2]     at org.apache.tools.ant.Main.runBuild(Main.java:632)
  [jasper2]     at org.apache.tools.ant.Main.startAnt(Main.java:183)
  [jasper2]     at org.apache.tools.ant.launch.Launcher.run(Launcher.java:197)
  [jasper2]     at org.apache.tools.ant.launch.Launcher.main(Launcher.java:56)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55171</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-04-02 15:50:32 +0000</bug_when>
    <thetext>I do not understand the issue. If linking to resources outside of the webapp
root, use allowLinking. If it still does not work, I think this is not going to
be fixed.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55178</commentid>
    <comment_count>2</comment_count>
    <who name="Rick Wong">rickkw</who>
    <bug_when>2004-04-02 18:23:49 +0000</bug_when>
    <thetext>No, no, no.

There resource, chError.jsp is local.  Except that when compiling this project,
this file is physically located in a different location, and referenced by a
symlink.

for example:

&gt; ls -l 
index.jsp
chError.jsp --&gt; ../common_files/chError.jsp

For some reasons, Jasper treats a symbolic link file differently then a regular
file.  I have a good number of applications and all of them contain chError.jsp.
 I do not want to make copies of this file so I use symbolic link in each
application to link chError.jsp to a common location.  Jasper seems to have
trouble with that.   Once again, this is meant to be a local resource, not
something outside of the application.

I also don't know what you were referring to when you mentioned "allowLinking".
 I am using JspC with Jasper2.  I don't see such an option documented.

Thanks,</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55417</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-04-06 17:28:30 +0000</bug_when>
    <thetext>This will not be fixed. If you care, please submit a fix.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55533</commentid>
    <comment_count>4</comment_count>
    <who name="Rick Wong">rickkw</who>
    <bug_when>2004-04-08 17:55:41 +0000</bug_when>
    <thetext>Hi Remy,

I have tested a fix locally, and it takes just a minor change in JspC.execute()
by replacing

    String s = fjsp.getCanonicalPath();

with

    String s = fjsp.getAbsolutePath();

It seems pretty harmless.  I don't have cvs submission permission yet, and I am
in the process of figuring it out.  If you would be so kind, could you
incorporate the fix in?

Thanks,
--
Rick

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55569</commentid>
    <comment_count>5</comment_count>
    <who name="Rick Wong">rickkw</who>
    <bug_when>2004-04-09 18:01:25 +0000</bug_when>
    <thetext>Hi, 
Please consider patching this.  
Thanks,
Rick
--


Index: JspC.java
===================================================================
RCS file:
/home/cvspublic/jakarta-tomcat-jasper/jasper2/src/share/org/apache/jasper/JspC.java,v
retrieving revision 1.69
diff -u -r1.69 JspC.java
--- JspC.java	6 Apr 2004 17:58:59 -0000	1.69
+++ JspC.java	8 Apr 2004 20:39:59 -0000
@@ -830,7 +830,7 @@
             Enumeration e = pages.elements();
             while (e.hasMoreElements()) {
                 String nextjsp = e.nextElement().toString();
-                try {
+                // try {
                     File fjsp = new File(nextjsp);
                     if (!fjsp.exists()) {
                         if (log.isWarnEnabled()) {
@@ -839,14 +839,21 @@
                         }
                         continue;
                     }
-                    String s = fjsp.getCanonicalPath();
+                    // BZ#28147 getCanonicalPath() dereferences symbolic links.
 If the file
+                    //          is a symbolic link to a file in a different
directory, 
+                    //          getCanonicalPath() will cause the following
s.startWith()
+                    //          to fail to match the uriRoot, resulting in
file-not-found
+                    //          error.  Changing to getAbsolutePath() will
allow files that
+                    //          are symbolic links to be found correctly.
+                    // String s = fjsp.getCanonicalPath();
+                    String s = fjsp.getAbsolutePath();
                     //System.out.println("**" + s);
                     if (s.startsWith(uriRoot)) {
                         nextjsp = s.substring(uriRoot.length());
                     }
-                } catch (IOException ioe) {
+                // } catch (IOException ioe) {
                     // if we got problems dont change the file name
-                }
+                // }
 
                 if (nextjsp.startsWith("." + File.separatorChar)) {
                     nextjsp = nextjsp.substring(2);
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56358</commentid>
    <comment_count>6</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-04-25 11:55:31 +0000</bug_when>
    <thetext>If this is the only place where a change is needed, then it seems ok.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>28156</bug_id>
          
          <creation_ts>2004-04-02 11:13:00 +0000</creation_ts>
          <short_desc>Session Expiration in Cluster broken after stopping one node</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina:Cluster</component>
          <version>5.0.21</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Rainer Jung">rainer.jung</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>rainer.jung</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>55143</commentid>
    <comment_count>0</comment_count>
    <who name="Rainer Jung">rainer.jung</who>
    <bug_when>2004-04-02 11:13:28 +0000</bug_when>
    <thetext>After stopping one cluster node, expiration of the sessions replicated from 
this node to the other nodes is broken. This is due to a bug in 
DeltaManager.java. In line 882 there is a call to session.access(), which 
increases accessCount by 1. Since there is no call to session.endAccess, this 
session will never expire.

The same seems to be true in line 870. If it is necessary to update timestamps 
with session.access, you should also call session.setAccessCount(0) directly 
after. In line 870 this might be appropriate, in line 882 there is dreq.execute 
directly before and dreq.execute already calls session.access and 
session.endAccess, so I think one could drop line 882.

The Bug was first introduced in Version 1.8 of DeltaManager (TC 5.0.18).

Since there was already another bug relating to accessCount&gt;0 it seems to be a 
good idea to check other uses of accessCount or session.access() as well.

Thanks for correcting.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55144</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-04-02 11:16:41 +0000</bug_when>
    <thetext>

*** This bug has been marked as a duplicate of 28131 ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55146</commentid>
    <comment_count>2</comment_count>
    <who name="Rainer Jung">rainer.jung</who>
    <bug_when>2004-04-02 11:19:57 +0000</bug_when>
    <thetext>It is not a duplicate of 28131, which was also found by me.

28131 prevented any expiration in a cluster. This bug here only applies if one 
cluster node is shutdown. Then the replicated sessions will no longer expire.

28131 is resolved in DeltaSession.java, this bug here must be resolved in 
DeltaManager.java. Please leave open for comment by Filip Hanik.

Thanks.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55165</commentid>
    <comment_count>3</comment_count>
    <who name="Filip Hanik">fhanik</who>
    <bug_when>2004-04-02 14:43:38 +0000</bug_when>
    <thetext>Thanks for the info, I haven't had time to play around with all this since we 
just moved from California to Texas. Thanks for your help!!</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>28161</bug_id>
          
          <creation_ts>2004-04-02 15:47:00 +0000</creation_ts>
          <short_desc>Replication messages get lost with AsyncSocketSender</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina:Cluster</component>
          <version>5.0.21</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Rainer Jung">rainer.jung</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>rainer.jung</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>55169</commentid>
    <comment_count>0</comment_count>
    <who name="Rainer Jung">rainer.jung</who>
    <bug_when>2004-04-02 15:47:48 +0000</bug_when>
    <thetext>Using AsyncSocketSender we see, that under heavy load some session get not 
replicated.

We added a lot of debug output statements, so we can see, that in 
AsyncSocketSender Method sendMessage(data) is reached and we finally end at the 
line, where the data is written to the socket.

Unfortunately on the remote side we miss the incoming messages corresponding to 
the missing session, although most sessions are replicated and we can see 
accordingly debugging output.

We use a 2 node Cluster using apache/mod_jk with load balancing/routing to both 
cluster nodes. We create app. 1500 sessions in a few seconds. Nearly 5% of the 
sessions are missing. Some of the sessions of node 1 are missing on node 2, but 
also some of the sessions from node 2 are missing on node 1. We couldn't 
observe the problems under low load.

Cluster-Config: useDirtyFlag=true, mcastFrequency=500, mcastDropTime=3000, 
tcpSelectorTimeout=1000, tcpThreadCount=2, TC 5.0.21, OS is Solaris 9, JVM is 
1.4.2_03.

Any help is highly appreciated, we are able to produce debugging output. Please 
give hints.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55172</commentid>
    <comment_count>1</comment_count>
    <who name="Filip Hanik">fhanik</who>
    <bug_when>2004-04-02 15:57:54 +0000</bug_when>
    <thetext>Async data send means that there is not time guarantee for when the session is 
delivered. The session should not get lost without any error trace in the logs.
I am still debating whether to remove this feature all together, but I left it 
in for people to play with. I have not found a case where async is useful, but 
I am sure there is which is why it is still there. Most of the time people 
want to be ensured that the session gets replicated, that is when pooled mode 
comes in.

also, from experience, using mod_jk in high load can result in "lost" 
sessions, cause it sometimes messes up the request and looses the session id.
from my experience, pen (siag.nu/pen) works better as a load balancer

I strongly suggest to retry the same test with replicationMode="pooled" and 
see if you get better results. 
Pooled means that replication is synchronous, but on concurrent channels.

Filip</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55175</commentid>
    <comment_count>2</comment_count>
    <who name="Rainer Jung">rainer.jung</who>
    <bug_when>2004-04-02 16:45:39 +0000</bug_when>
    <thetext>I respect your sugestion to not use asynchronous, although it looked to me like
the right way to do it.

Just for your information: The messages really get lost, even after we stop load
the missing messages don't get replicated. So it's not just a problem of
messages getting replicated too late.

There are definitely only debug log stetments all the time, except for a few
info messages giving mean values for replication data size. No other non debug
log statements on any cluster node. Also from what I see I'm pretty sure, that
the replication data is written to the Socket.

Concerning mod_jk: For this test case we used each session only once. So the
correctness of the response through mod_jk somehow didn't matter. We could
easily reproduce the same situation using build in Tomcat HTTP Connector
(although we didn't do so until now).

We will retry using pooled, although I don't like the idea of having up to 25
connections (code constant) and threads for each pair of nodes in the cluster.
Also I had the impression, that in pooled mode TCP conections are only used a
very short time (I think I remember for only 100 messages? This application will
be under heavy load in production). 

Why do I think asynchronous fits better?

In any synchronous situation if the replication is not fast enough I immediately
get negative consequences for the application from the user point of view,
because the request blocks ressources needed for accepting new requests as long
as the replication hasn't finished. So if replication is slow for a few seconds
I'm in danger of loosing all free Apache-Slots resp. Tomcat worker threads for
incoming requests.

When I do asynchronous replication I only loose timely replication of the sesion
changes. If I route my request to the primary container, then I still profit
from the cluster with respect to availability and servicability (I can shutdown
one of the containers without users loosing sessions). For these features it
doesn't really matter, if all request are replicated within milliseconds all the
time.

I'm sorry to bother you, but I think it's an important discussion.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55176</commentid>
    <comment_count>3</comment_count>
    <who name="Filip Hanik">fhanik</who>
    <bug_when>2004-04-02 17:01:28 +0000</bug_when>
    <thetext>&gt;We will retry using pooled, although I don't like the idea of having up to 25

this is not really a big resource issue, since no threads are holding on to 
these connections, they just grab one from the queue when it is available, 
then return it.

lets reopen this bug re:/ async, once I get all moved in and have my computers 
set up I can start testing this again

Filip</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55177</commentid>
    <comment_count>4</comment_count>
    <who name="Filip Hanik">fhanik</who>
    <bug_when>2004-04-02 17:04:15 +0000</bug_when>
    <thetext>also, the problem with Async, is that it is using only one channel, hence 
during heavy load, you will not get milli seconds throughput, cause it queues 
all the messages

the solution would be to make an async pooled mode,</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55331</commentid>
    <comment_count>5</comment_count>
    <who name="Rainer Jung">rainer.jung</who>
    <bug_when>2004-04-05 16:39:42 +0000</bug_when>
    <thetext>Maybe interesting: a simple "Hello World" JSP does NOT trigger the problem. But 
once I add a scriptlet &lt;%session.setAttribute("COUNT",new Integer(10));%&gt;
the problem arises.

I can now reproduce without any apache or mod_jk involvement. I just start a 2 
node cluster and call the JSP via direct HTTP connections to node #1 200 times 
with a delay between calls of 100ms.

After calling 200 times, I can find 200 sessions on node #1, but only between 
170 and 195 sessions on node 2. I check session count via /manager/html, but I 
also added debug output to see, that some sessions are indeed missing.

I try to go deeper into cluster messages and the queue handling.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55337</commentid>
    <comment_count>6</comment_count>
    <who name="Rainer Jung">rainer.jung</who>
    <bug_when>2004-04-05 17:26:27 +0000</bug_when>
    <thetext>Next info: If I use this JSP, then synchronous and pooled are both EXTREMELY 
slow, response times between 1000ms and 5000ms. As soon as I reduce 
tcpSelectorTimeout from 1000 to 10, I get more reasonable response times (10-
50ms). Any idea, why tcpSelectorTimeout show such a tremendous effect?

Then when I use multiple parallel clients, synchronous again gets too slow, so 
only pooled is an alternative. Synchronous once showed a freeze (getting no 
more anserws) for 15 seconds.

Both, synchronous and pooled do not show the problem of missing sessions.

Nevertheless I like the idea of having one or few dedicated replication 
connections fed by a queue of work load and not directly coupled to the 
finishing of the original response (asynchronous) much more.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55346</commentid>
    <comment_count>7</comment_count>
    <who name="Rainer Jung">rainer.jung</who>
    <bug_when>2004-04-05 19:11:02 +0000</bug_when>
    <thetext>First: there are app. 6 System.out.print/ln in the cluster code. One of these 
(line 71 in the SmartQueue.java) prevented me from finding the solution earlier.

Here is the SOLUTION: What happens is, that the "smart" feature of the smart 
queue gets us into trouble. For my JSP two session messages are being send. One 
is of type 1 (EVT_SESSION_CREATED), and the second one is of type 13 
(EVT_SESSION_DELTA). Both are being send very close to each other during the 
only request in a session.

Most of the time the system is fast enough to handle each message individually, 
before the next message is put into the queue. Every now and then the message 
of type 1 is not read from the queue before type 13 is generated. Then the 
queue replaces the type 1 message in the queue by the type 13 message, and only 
the type 13 message is send out. Then the receiving side seems to not create 
the session, since the type 1 message is missing. I didn't check this last 
point, because I think this is much clearer for you.

Isn't there a general problem in using the Delta manager together with the 
smart queue? Since you only send out delta messages, it doesn't look like a 
good idea to replace pending messages with newer ones. In fact isn't it 
necessary to send all deltas and to furthermore make sure, that they are send 
in the original order?

At least this makes clear, why the problem will only show up in asynchronous 
mode. In synchronous mode you will allways send all messages (and in the right 
order).

Maybe it suffices to strip off the "smart" feature of the smart queue?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55497</commentid>
    <comment_count>8</comment_count>
    <who name="Filip Hanik">fhanik</who>
    <bug_when>2004-04-07 20:41:42 +0000</bug_when>
    <thetext>The Deltamanager now uses a different Id to assign to its messages, that will 
make them unique. This all the messages will get through.

However, the async could be pooled in the same way the the synchronous is in 
pooled mode, would increase performance alot :)</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>28178</bug_id>
          
          <creation_ts>2004-04-03 19:19:00 +0000</creation_ts>
          <short_desc>SSL Mutual Authentication Does Not Work with UserDatabaseRealm</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.19</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Kevin Jones">kevinj</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>55225</commentid>
    <comment_count>0</comment_count>
    <who name="Kevin Jones">kevinj</who>
    <bug_when>2004-04-03 19:19:00 +0000</bug_when>
    <thetext>Enable CLIENT-CERT.
Set tomcat-users.xml to look like this:
  &lt;user username="CN=Kevin Jones, OU=DMUK, O=DevelopMentor, 
L=Cheltenham, ST=Glos, C=GB, 
EMAILADDRESS=kevinj@develop.com" password="null" roles="Kevin"/&gt;
Enable UserDatabaseRealm (which is now the default realm) 

the following exception occurs.

SEVERE: Exception creating UserDatabase MBeans for UserDatabase
javax.management.MalformedObjectNameException: Invalid character '=' in value
part of property
        at javax.management.ObjectName.construct(ObjectName.java:563)
        at javax.management.ObjectName.&lt;init&gt;(ObjectName.java:1300)
        at
org.apache.catalina.mbeans.MBeanUtils.createObjectName(MBeanUtils.java:1520)
        at org.apache.catalina.mbeans.MBeanUtils.createMBean(MBeanUtils.java:783)
        at
org.apache.catalina.mbeans.GlobalResourcesLifecycleListener.createMBeans(GlobalResourcesLifecycleListener.jav
a:280)
        at
org.apache.catalina.mbeans.GlobalResourcesLifecycleListener.createMBeans(GlobalResourcesLifecycleListener.jav
a:210)
        at
org.apache.catalina.mbeans.GlobalResourcesLifecycleListener.createMBeans(GlobalResourcesLifecycleListener.jav
a:172)
        at
org.apache.catalina.mbeans.GlobalResourcesLifecycleListener.lifecycleEvent(GlobalResourcesLifecycleListener.j
ava:144)
        at
org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)
        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2338)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:594)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:398)

Not sure if this is a problem in the MX beans handling of the = signs in the DN
name used for the user.

Assigned to Mark Thomas after an email exchange</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55264</commentid>
    <comment_count>1</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2004-04-04 17:39:16 +0000</bug_when>
    <thetext>Correcting the component.
The '=' in the DN is the problem.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61057</commentid>
    <comment_count>2</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-07-23 13:53:42 +0000</bug_when>
    <thetext>Mark, what's the status of this?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61067</commentid>
    <comment_count>3</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2004-07-23 17:23:54 +0000</bug_when>
    <thetext>Sorry, slipped of my todo list. I'll look at this next week.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61069</commentid>
    <comment_count>4</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2004-07-23 18:35:20 +0000</bug_when>
    <thetext>I have now reminded myself what the problem was. The UserDataBaseRealm uses 
the principal name when constructing the oname. With certificates this 
includes several '=' characters. The JMX 1.1 does not allow these characters 
to be used in key properties. However, JMX 1.2 now includes support for 
quoting properties which would over come this. (BTW MX4J 2.x implements JMX 
1.2 and is currently at release 2.0.1)

As I see it, the options are:
1. Do nothing for now. Upgrade to JMX 1.2 at some point in the future and come 
back to this issue then.
2. Upgrade to JMX 1.2 now, and quote values (need to look into whether to 
quote all, some, etc)
3. Continue with JMX 1.1 and introduce some form of arbitary character 
replacement for certificates.

In the spirit of avoiding nugatory work - thoughts anyone?

My vote is for option 2.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61262</commentid>
    <comment_count>5</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-07-28 17:29:49 +0000</bug_when>
    <thetext>My vote is also for option 2, especially with Tomcat 5.1 coming up soon.  
Nugatory is a great word, I had to look it up and now I'll go use it in a 
conversation ;)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61323</commentid>
    <comment_count>6</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2004-07-29 19:23:33 +0000</bug_when>
    <thetext>This has been fixed in CVS. There might be some side-effects in the Admin app 
but this code is in a state of flux at present. Once the Admin app stabalises, 
I will double-check the user database forms.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>28234</bug_id>
          
          <creation_ts>2004-04-06 16:20:00 +0000</creation_ts>
          <short_desc>uri: worker property does not exist any more</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Documentation</component>
          <version>5.0.19</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>http://jakarta.apache.org/tomcat/tomcat-4.1-doc/jk2/jk2/configwebex.html</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ortwin Glueck">odi</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>55413</commentid>
    <comment_count>0</comment_count>
    <who name="Ortwin Glueck">odi</who>
    <bug_when>2004-04-06 16:20:22 +0000</bug_when>
    <thetext>The documentation still lists the 'worker' property in the examples. I guess
this should be replaced by 'group'.

Plus:
Why does the URL read tomcat-4.1 BTW if I browse the 5.0 documentation? Very
confusing.
More comprehensive examples of how to use the context property would be nice.
All in all documentation seems too fuzzy to me. It would definitely nice to have
good documentation on all the parameters of the JK2 configuration.

Cheers

Ortwin Glück</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58340</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-05-28 17:49:43 +0000</bug_when>
    <thetext>On what page does "the URL read tomcat-4.1 BTW if I browse the 5.0 
documentation" ?

Please submit clarified and/or enhanced text for those documentation areas you 
feel are lacking.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58440</commentid>
    <comment_count>2</comment_count>
    <who name="Ortwin Glueck">odi</who>
    <bug_when>2004-06-01 05:59:51 +0000</bug_when>
    <thetext>Go to: http://jakarta.apache.org/tomcat/index.html
Select 'Tomcat 5.0' under 'Documentation'
Select 'JK Documentation' under 'Reference'

All other links in the menu point to 5.0 documentation. But the JK Docs are 4.1</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58456</commentid>
    <comment_count>3</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-06-01 13:33:13 +0000</bug_when>
    <thetext>I see what you mean.  The 4.1 location is the only one where we maintain the JK 
documentation.  How do you suggest we clarify this?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58526</commentid>
    <comment_count>4</comment_count>
    <who name="Ortwin Glueck">odi</who>
    <bug_when>2004-06-02 07:37:49 +0000</bug_when>
    <thetext>Then just make the URLs look like 5.0. Either by deploying it twice or making a
symlink.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59056</commentid>
    <comment_count>5</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-06-10 20:37:26 +0000</bug_when>
    <thetext>OK, here's what I did:
- Moved connector documentation to http://jakarta.apache.org/tomcat/connectors-
doc/jk2
- Symlinked tomcat/tomcat-4.1-doc/jk2 to connectors-doc/jk2 so old links and 
bookmarks still work.
- Modified project.xml and index.xml for tomcat 5 so that future releases use 
connectors-doc and not the tomcat-4.1-doc URL when browsing the connector 
documentation.</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>28236</bug_id>
          
          <creation_ts>2004-04-06 16:54:00 +0000</creation_ts>
          <short_desc>org.apache.jasper.runtime.BodyContentImpl buffer is too small</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.19</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Leva">levadura</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>55415</commentid>
    <comment_count>0</comment_count>
    <who name="Leva">levadura</who>
    <bug_when>2004-04-06 16:54:34 +0000</bug_when>
    <thetext>Well actually in reAllocBuff() method the policy is to incriment it by a 
constant (512 bytes). In my case with a BIG &lt;select&gt; tag 99% of CPU is 
used just to increment the buffer. 

The suggestion is to use

***************
len = Math.max(Constants.DEFAULT_TAG_BUFFER_SIZE, cb.length);
***************
instead of
***************
        if (len &lt; Constants.DEFAULT_TAG_BUFFER_SIZE) {
            len = Constants.DEFAULT_TAG_BUFFER_SIZE;
        }
***************

In my case (I'm using JSF RI 1.0) the change is from ~26 min to 2 sec.

Sincerely,

unknown</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55427</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-04-06 22:05:37 +0000</bug_when>
    <thetext>Anyway, why don't you suggest len = 2 * cb.length ?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55438</commentid>
    <comment_count>2</comment_count>
    <who name="Leva">levadura</who>
    <bug_when>2004-04-07 08:41:25 +0000</bug_when>
    <thetext>well actually changes above has a bug if:

Math.max(Constants.DEFAULT_TAG_BUFFER_SIZE, cb.length) &lt; len

I just  pointed the problem, but I'm not sure about the strategy to use in 
buffer increment...</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>28244</bug_id>
          
          <creation_ts>2004-04-07 05:56:00 +0000</creation_ts>
          <short_desc>XML Comment between jsp:attribute cause attribute after comment was ignored</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.19</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Eric Suen">eric_suen_cn</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>55430</commentid>
    <comment_count>0</comment_count>
    <who name="Eric Suen">eric_suen_cn</who>
    <bug_when>2004-04-07 05:56:13 +0000</bug_when>
    <thetext>The jspx code:

&lt;?xml version="1.0" ?&gt;
&lt;fo:root xmlns:jsp="http://java.sun.com/JSP/Page" 
xmlns:fo="http://www.w3.org/1999/XSL/Format"&gt;
 &lt;fo:block id="test" font-weight="bold" color="blue" font-size="12pt"&gt;
  &lt;jsp:element name="fo:inline"&gt;
   &lt;jsp:attribute name="font-size"&gt;9pt&lt;/jsp:attribute&gt;
   &lt;!-- --&gt;
   &lt;jsp:attribute name="color"&gt;red&lt;/jsp:attribute&gt;
   &lt;jsp:attribute name="font-weight"&gt;bold&lt;/jsp:attribute&gt;
   &lt;jsp:body&gt;Hello World&lt;/jsp:body&gt;
  &lt;/jsp:element&gt;
 &lt;/fo:block&gt;
&lt;/fo:root&gt;

the output of resion 3.0.7 is:
&lt;fo:inline font-size="9pt" color="red" font-weight="bold"&gt;Hello 
World&lt;/fo:inline&gt;

and the tomcat 5.0.19 is:
&lt;fo:inline font-size="9pt"&gt;Hello World&lt;/fo:inline&gt;

Regards</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55498</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-04-07 20:52:26 +0000</bug_when>
    <thetext>The spec (page 1.124) does not seems to allow for comments in between
jsp:attribute's.  However, this can be a spec oversight.

Fixed in CVS.</thetext>
  </long_desc>
      
      

    <bug_classification class="SPEC">SPEC</bug_classification></bug>
    <bug>
          <bug_id>28259</bug_id>
          
          <creation_ts>2004-04-07 12:38:00 +0000</creation_ts>
          <short_desc>Synchronous cluster very slow - select() bug</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina:Cluster</component>
          <version>5.0.21</version>
          <rep_platform>Sun</rep_platform>
          <op_sys>Solaris</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Rainer Jung">rainer.jung</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>rainer.jung</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>55453</commentid>
    <comment_count>0</comment_count>
    <who name="Rainer Jung">rainer.jung</who>
    <bug_when>2004-04-07 12:38:07 +0000</bug_when>
    <thetext>In a TC cluster with synchronous replication there is a bug in using select() 
and registering operations on selectors.

If I use a high tcpSelectorTimeout (e.g. 1000ms) I can observe the secondary 
node waiting in the midlle of a request until the timeout occurs, although 
replication data is available. As a consequence requests take 1 second to work 
on, although only the TC instances need only 20ms to process the request.
Nearly 1 second is spend waiting for select() to return in the middle of 
processing the request.

I assume this is a bug in the logic handling the registration of operations on 
the selector?

It is not a problem of high load, one can observe using single requests,
but it is necessary to use session atributes in the request.

I expect the same problem to occur in pooled mode. The problem does not 
increase response times in asynchronous mode, but I expect, that it will
increase replication time.

Here is a protocol of what is happening. Most of these log lines are non 
standard, I added them to the code, to find out the flow of control in this 
situation. The intersting thing happens between step 5 and 6.

1) Node 1: Request coming in at 12:39:32,563 :

2004-04-07 12:39:32,563 (http-21080-Processor25)
org.apache.catalina.core.StandardWrapper/DEBUG:   Returning non-STM instance
2004-04-07 12:39:32,564 (http-21080-Processor25)
org.apache.jasper.servlet.JspServlet/DEBUG: JspEngine --&gt; /repit.jsp
2004-04-07 12:39:32,564 (http-21080-Processor25)
org.apache.jasper.servlet.JspServlet/DEBUG:         ServletPath: /repit.jsp
2004-04-07 12:39:32,564 (http-21080-Processor25)
org.apache.jasper.servlet.JspServlet/DEBUG:            PathInfo: null
2004-04-07 12:39:32,564 (http-21080-Processor25)
org.apache.jasper.servlet.JspServlet/DEBUG:            RealPath:
/opt/iob3_tomcat_a/webapps/ROOT/repit.jsp
2004-04-07 12:39:32,564 (http-21080-Processor25)
org.apache.jasper.servlet.JspServlet/DEBUG:          RequestURI: /repit.jsp
2004-04-07 12:39:32,564 (http-21080-Processor25)
org.apache.jasper.servlet.JspServlet/DEBUG:         QueryString: null
2004-04-07 12:39:32,564 (http-21080-Processor25)
org.apache.jasper.servlet.JspServlet/DEBUG:      Request Params:

2) Node 1: New session message EVT_SESSION_CREATED is being send at 
12:39:32,567:

2004-04-07 12:39:32,566 (http-21080-Processor25)
org.apache.catalina.cluster.session.DeltaManager/DEBUG: Sending 
EVT_SESSION_CREATED:
Sending creation of Session with  id=CD25AAD154CC01843779EA36B143D101.mkbtomcat1
isValid=true isNew=true accessCount=0 maxInactiveInterval=900 
isPrimarySession=true
creationTime=1081334372565 lastAccessedTime=1081334372565
lastTimeReplicated=1081334372565
2004-04-07 12:39:32,566 (http-21080-Processor25)
org.apache.catalina.cluster.tcp.SimpleTcpCluster/DEBUG: Starting
CatalinaCluster.send for msg 1 session 
CD25AAD154CC01843779EA36B143D101.mkbtomcat1
and destination null

3) Node 2: Message is being received at 12:39:32,568, sending ack at 
12:39:32,573:

2004-04-07 12:39:32,568 (ClusterReceiver)
org.apache.catalina.cluster.tcp.ReplicationListener/DEBUG: ReplicationListener
listen in while doListen after select returned n=1
2004-04-07 12:39:32,568 (ClusterReceiver)
org.apache.catalina.cluster.tcp.ReplicationListener/DEBUG: ReplicationListener 
woke
up in listen
2004-04-07 12:39:32,568 (ClusterReceiver)
org.apache.catalina.cluster.tcp.ReplicationListener/DEBUG: ReplicationListener
calling serviceChannel from readDataFromSocket in TcpReplicationThread
2004-04-07 12:39:32,568 (ClusterReceiver)
org.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread
calling notify in serviceChannel
2004-04-07 12:39:32,568 (ClusterReceiver)
org.apache.catalina.cluster.tcp.ReplicationListener/DEBUG: ReplicationListener
listen in while doListen before select with tcpSelectorTimeout=1000
2004-04-07 12:39:32,569 (p.TcpReplicationThread[2])
org.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread
woke up with key sun.nio.ch.SelectionKeyImpl@b3f9b8
2004-04-07 12:39:32,569 (p.TcpReplicationThread[2])
org.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread
woke up and calling drainChannel for key sun.nio.ch.SelectionKeyImpl@b3f9b8
2004-04-07 12:39:32,569 (p.TcpReplicationThread[2])
org.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread
Starting drainChannel for key sun.nio.ch.SelectionKeyImpl@b3f9b8
2004-04-07 12:39:32,569 (p.TcpReplicationThread[2])
org.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread
drainChannel inner loop has count 401 and pkgcnt 1
2004-04-07 12:39:32,571 (p.TcpReplicationThread[2])
org.apache.catalina.cluster.session.DeltaManager/DEBUG: Manager () Received
SessionMessage of type=SESSION-MODIFIED from
org.apache.catalina.cluster.mcast.McastMember
[tcp://10.254.65.100:5002,10.254.65.100,5002,
alive=230840]
2004-04-07 12:39:32,572 (p.TcpReplicationThread[2])
org.apache.catalina.cluster.session.DeltaManager/DEBUG: Created a DeltaSession 
with
Id[A981679B5BD40B418ED57F874DF8E1ED.mkbtomcat2] Total count=5
2004-04-07 12:39:32,573 (p.TcpReplicationThread[2])
org.apache.catalina.cluster.session.DeltaManager/DEBUG: Receiving
EVT_SESSION_CREATED: Overwriting new Session with 
id=CD25AAD154CC01843779EA36B143D101.mkbtomcat1 isValid=true isNew=false
accessCount=0 maxInactiveInterval=900 isPrimarySession=false
creationTime=1081334372572 lastAccessedTime=1081334372572
lastTimeReplicated=1081334372571
2004-04-07 12:39:32,573 (p.TcpReplicationThread[2])
org.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread
drainChannel has pkgcnt 1
2004-04-07 12:39:32,573 (p.TcpReplicationThread[2])
org.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread
drainChannel sending ack for pkgcnt 1

Important: ClusterReceiver calls select() again at 12:39:32,568. This is the 
place
where now all the time goes by.

4) Node 1: Received ack and proceeds with session.access() at 12:39:32,573. Ends
session.access() at 12:39:32,574:

2004-04-07 12:39:32,573 (http-21080-Processor25)
org.apache.catalina.cluster.session.DeltaManager/DEBUG: Created a DeltaSession 
with
Id[CD25AAD154CC01843779EA36B143D101.mkbtomcat1] Total count=5
2004-04-07 12:39:32,574 (http-21080-Processor25)
org.apache.catalina.cluster.session.DeltaManager/INFO : End of session.access in
id=CD25AAD154CC01843779EA36B143D101.mkbtomcat1 isNew=false
lastAccessedTime=1081334372565 thisAccessedTime=1081334372574 accessCount=1

5) Node 1: Proceeds working on request until Delta message of type 
EVT_SESSION_DELTA
 is being sent at 12:39:32,578:

2004-04-07 12:39:32,576 (http-21080-Processor25)
org.apache.catalina.cluster.tcp.ReplicationValve/DEBUG: Invoking replication 
request
on /repit.jsp
2004-04-07 12:39:32,577 (http-21080-Processor25)
org.apache.catalina.cluster.session.DeltaManager/DEBUG: DeltaManager request
Completed sending EVT_SESSION_DELTA  
id=CD25AAD154CC01843779EA36B143D101.mkbtomcat1
isValid=true isNew=false accessCount=1 maxInactiveInterval=900 
isPrimarySession=true
creationTime=1081334372565 lastAccessedTime=1081334372565
lastTimeReplicated=1081334372565
2004-04-07 12:39:32,577 (http-21080-Processor25)
org.apache.catalina.cluster.session.DeltaManager/DEBUG: DeltaManager request
Completed returns with msg non null
2004-04-07 12:39:32,577 (http-21080-Processor25)
org.apache.catalina.cluster.tcp.SimpleTcpCluster/DEBUG: Starting
CatalinaCluster.send for msg 13 session 
CD25AAD154CC01843779EA36B143D101.mkbtomcat1
and destination null
2004-04-07 12:39:32,577 (http-21080-Processor25)
org.apache.catalina.cluster.tcp.SimpleTcpCluster/DEBUG: Setting msgID in
CatalinaCluster.send for msg 13 session 
CD25AAD154CC01843779EA36B143D101.mkbtomcat1
and destination null to ABC9CBA
2004-04-07 12:39:32,578 (http-21080-Processor25)
org.apache.catalina.cluster.tcp.SimpleTcpCluster/DEBUG: Calling
clusterSender.sendMessage for msg 13 session
CD25AAD154CC01843779EA36B143D101.mkbtomcat1 ID ABC9CBA and destination NULL

6) Now there is no activity for 993 milliseconds - which is the problem - until 
1003
milliseconds after the last call to select() in ClusterReceiver on node 2, 
although
there is one message of type EVT_SESSION_DELTA  waiting to be read. Finally the
select returns at 12:39:33,571 but with n=0 and another immediate call to select
()
returns instantaneously with n=1. From here on everything proceeds normal, the
message is being read and ack is sent at 12:39:33,577:

2004-04-07 12:39:33,571 (ClusterReceiver)
org.apache.catalina.cluster.tcp.ReplicationListener/DEBUG: ReplicationListener
listen in while doListen after select returned n=0
2004-04-07 12:39:33,571 (ClusterReceiver)
org.apache.catalina.cluster.tcp.ReplicationListener/DEBUG: ReplicationListener
listen in while doListen before select with tcpSelectorTimeout=1000
2004-04-07 12:39:33,571 (ClusterReceiver)
org.apache.catalina.cluster.tcp.ReplicationListener/DEBUG: ReplicationListener
listen in while doListen after select returned n=1
2004-04-07 12:39:33,571 (ClusterReceiver)
org.apache.catalina.cluster.tcp.ReplicationListener/DEBUG: ReplicationListener
wokeup in listen
2004-04-07 12:39:33,571 (ClusterReceiver)
org.apache.catalina.cluster.tcp.ReplicationListener/DEBUG: ReplicationListener
calling serviceChannel from readDataFromSocket in TcpReplicationThread
2004-04-07 12:39:33,571 (ClusterReceiver)
org.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread
calling notify in serviceChannel
2004-04-07 12:39:33,571 (ClusterReceiver)
org.apache.catalina.cluster.tcp.ReplicationListener/DEBUG: ReplicationListener
listen in while doListen before select with tcpSelectorTimeout=1000
2004-04-07 12:39:33,571 (p.TcpReplicationThread[1])
org.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread
woke up with key sun.nio.ch.SelectionKeyImpl@b3f9b8
2004-04-07 12:39:33,572 (p.TcpReplicationThread[1])
org.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread
woke up and calling drainChannel for key sun.nio.ch.SelectionKeyImpl@b3f9b8
2004-04-07 12:39:33,572 (p.TcpReplicationThread[1])
org.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread
Starting drainChannel for key sun.nio.ch.SelectionKeyImpl@b3f9b8
2004-04-07 12:39:33,572 (p.TcpReplicationThread[1])
org.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread
drainChannel inner loop has count 540 and pkgcnt 1
2004-04-07 12:39:33,574 (p.TcpReplicationThread[1])
org.apache.catalina.cluster.tcp.SimpleTcpCluster/DEBUG: Received in
clusterSender.messageDataReceived msg 13 session
CD25AAD154CC01843779EA36B143D101.mkbtomcat1
2004-04-07 12:39:33,574 (p.TcpReplicationThread[1])
org.apache.catalina.cluster.session.DeltaManager/DEBUG: Manager () Received
SessionMessage of type=SESSION-DELTA from
org.apache.catalina.cluster.mcast.McastMember
[tcp://10.254.65.100:5002,10.254.65.100,5002,
alive=230851]
2004-04-07 12:39:33,576 (p.TcpReplicationThread[1])
org.apache.catalina.cluster.session.DeltaManager/INFO : End of session.access in
id=CD25AAD154CC01843779EA36B143D101.mkbtomcat1 isNew=false
lastAccessedTime=1081334372572 thisAccessedTime=1081334373575 accessCount=1
2004-04-07 12:39:33,576 (p.TcpReplicationThread[1])
org.apache.catalina.cluster.session.DeltaManager/INFO : End of 
session.endAccess in
id=CD25AAD154CC01843779EA36B143D101.mkbtomcat1 isNew=false
lastAccessedTime=1081334372572 thisAccessedTime=1081334373575 accessCount=0
2004-04-07 12:39:33,577 (p.TcpReplicationThread[1])
org.apache.catalina.cluster.session.DeltaManager/DEBUG: Receiving 
EVT_SESSION_DELTA:
Updating Session with  id=CD25AAD154CC01843779EA36B143D101.mkbtomcat1 
isValid=true
isNew=false accessCount=0 maxInactiveInterval=900 isPrimarySession=false
creationTime=1081334372572 lastAccessedTime=1081334372572
lastTimeReplicated=1081334372571
2004-04-07 12:39:33,577 (p.TcpReplicationThread[1])
org.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread
drainChannel has pkgcnt 1
2004-04-07 12:39:33,577 (p.TcpReplicationThread[1])
org.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread
drainChannel sending ack for pkgcnt 1

7) The ack is seen on node 1 at 12:39:33,579 and session.endAccess() ends the
processing of the request

2004-04-07 12:39:33,579 (http-21080-Processor25)
org.apache.catalina.cluster.session.DeltaManager/INFO : End of 
session.endAccess in
id=CD25AAD154CC01843779EA36B143D101.mkbtomcat1 isNew=false
lastAccessedTime=1081334372565 thisAccessedTime=1081334372574 accessCount=0</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55458</commentid>
    <comment_count>1</comment_count>
    <who name="Rainer Jung">rainer.jung</who>
    <bug_when>2004-04-07 14:50:46 +0000</bug_when>
    <thetext>Here is what causes the problem:

in TcpReplicationThread line 142 the call to key.interestedOps blocks until the
select in the parallel execution of ReplicationListener returns the next time. 
I checked with adding debug output directly nefore and after.

Internet sources confirm, that register and setting interestedOps are blocking 
on select to the same selector.

Some people suggest putting wakeup directly before register and interstedOps, 
but since an interrupted select in ReplicationListener will very quickly do the 
next select, I think you need some way of informing ReplicationListener to not 
do the select until interestedOps has returned.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55459</commentid>
    <comment_count>2</comment_count>
    <who name="Filip Hanik">fhanik</who>
    <bug_when>2004-04-07 14:55:15 +0000</bug_when>
    <thetext>Why would you set tcpSelectorTimeout to 1000ms?

The tcpSelectorTimeout feature is in place because of a bug in java NIO. If 
your NIO is working bug free, then tcpSelectorTimeout should be 0, cause the 
selector should wake up by itself when it receives a package. In many Unix 
JDKs this is not the case, hence you can set it to 50ms.

I am setting this to INVALID, cause 1000ms in tcpSelectorTimeout is wrong. The 
problem is in Java NIO, not in Tomcat, hence you have to set 
tcpSelectorTimeout to a reasonable value. On windows you can set to 0, no 
timeout, cause on windows NIO works well, and the selector wakes up by itself 
when a data packet arrives


Filip</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55464</commentid>
    <comment_count>3</comment_count>
    <who name="Rainer Jung">rainer.jung</who>
    <bug_when>2004-04-07 15:13:14 +0000</bug_when>
    <thetext>I'm having a different opinion: it is well documented, that key.interestedOps() 
blocks waiting for select() to return - dependent on the JVM implementation. It 
is not a bug in the JVM!

You call interestedOps() in TcpReplicationThread line 142 although there is a 
parallelly executing select() call in ReplicationListener. So the interestedOps
() blocks the TcPReplicationThread until the select() in ReplicationListener 
returns. Since during that time OP_READ is not set, select might block a very 
long time.

Of course setting tcpSelectorTimeout to a very small value looks like a 
workaround. But still it is not a safe solution: depending on the scheduling of 
threads on CPUs it might happen, that ReplicationListener calls select() again, 
before interestedOps() is able to set the new flags.

I really think you need a design, 
- where you check for pending interestedOps or register calls before retrying 
select
- where you "register" interestedOps or register calls as pending, afterwards 
call wakeup, then do the interestedOps or register call and 
finally "unregister" the calls.

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55466</commentid>
    <comment_count>4</comment_count>
    <who name="Rainer Jung">rainer.jung</who>
    <bug_when>2004-04-07 15:36:34 +0000</bug_when>
    <thetext>Reopened - reason see my 2 last comments. tcpSelectorTimeout was only chosen so 
big to demonstrate the bug.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55472</commentid>
    <comment_count>5</comment_count>
    <who name="Filip Hanik">fhanik</who>
    <bug_when>2004-04-07 16:13:45 +0000</bug_when>
    <thetext>Yes, you are absolutely right, the interestOps in unix is blocking until 
select is done.

I will fix this, many thanks for the detailed bug report</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55483</commentid>
    <comment_count>6</comment_count>
    <who name="Rainer Jung">rainer.jung</who>
    <bug_when>2004-04-07 18:09:52 +0000</bug_when>
    <thetext>Thank you very much! I hope I don't bother you too much, but we plan to use TC
5.0 cluster in a high load mission critical application starting June. So we try
hard to help you improve robustness.

I think you do a wonderful job and we try to be as precise as possible with our
observations.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55495</commentid>
    <comment_count>7</comment_count>
    <who name="Filip Hanik">fhanik</who>
    <bug_when>2004-04-07 19:06:11 +0000</bug_when>
    <thetext>As always, I stand corrected about interestOps blocking. This has been fixed,
however, setting tcpSelectorTimeout to 1000ms will still yield the same 
problems because of selector.select() will not wake up if new data comes in on 
the tcp channel.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>28262</bug_id>
          
          <creation_ts>2004-04-07 16:06:00 +0000</creation_ts>
          <short_desc>Fix autodeploy bug at CVS HEAD</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.21</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Peter Rossbach">pr</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>55468</commentid>
    <comment_count>0</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-04-07 16:06:01 +0000</bug_when>
    <thetext>Hey,

at 5.0.19 release the dir and war autodeploy feature don't work
but the current cvs head (07.04.2004) has a fix.

After test I see a strange behavior.

first example or bug
====================
start tomcat
copy dir or war to webapps
wait 1 sec
look a manager app 
OK. Apps are deploy and ready.
remove dir or war with the manager app

Result:
dir is deleted but war's not !
  work dir or context.xml removed
  HostConfig not closed a jar pointer. (s. Patch)

next example
============
start tomcat
copy dir or war to webapps
wait 1 sec
look a manager app 
OK. Apps are deploy and ready.
remove dir or war with the manager app
wait 1 sec
copy dir or war again to webapps
Hups. Autodeployment not work anymore

I look at HostConfig and see that all autodeploy xml,dirs and wars
registered at deployed list but not delete.

I add a checkRemoveApps() method and call it inside check().

Now second szenario work correct.

Regards
Peter</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55469</commentid>
    <comment_count>1</comment_count>
      <attachid>11171</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-04-07 16:08:32 +0000</bug_when>
    <thetext>Created attachment 11171
Autodeploy Patch HostConfig</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55470</commentid>
    <comment_count>2</comment_count>
      <attachid>11172</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-04-07 16:09:02 +0000</bug_when>
    <thetext>Created attachment 11172
LocalString.properties ( debug messages)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55615</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-04-10 14:58:53 +0000</bug_when>
    <thetext>Your patch works fine. Thanks.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>11171</attachid>
            <date>2004-04-07 16:08:00 +0000</date>
            <delta_ts>2004-04-07 16:08:32 +0000</delta_ts>
            <desc>Autodeploy Patch HostConfig</desc>
            <filename>HostConfig20040407.patch</filename>
            <type>text/plain</type>
            <size>1862</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>11172</attachid>
            <date>2004-04-07 16:09:00 +0000</date>
            <delta_ts>2004-04-07 16:09:02 +0000</delta_ts>
            <desc>LocalString.properties ( debug messages)</desc>
            <filename>StartupLocalStrings20040407.patch</filename>
            <type>text/plain</type>
            <size>639</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>28286</bug_id>
          
          <creation_ts>2004-04-08 17:36:00 +0000</creation_ts>
          <short_desc>Loosely couple SingleSignOn Valve and Authenticators</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.22</version>
          <rep_platform>All</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Brian Stansberry">bstansberry</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>55530</commentid>
    <comment_count>0</comment_count>
    <who name="Brian Stansberry">bstansberry</who>
    <bug_when>2004-04-08 17:36:32 +0000</bug_when>
    <thetext>Attached is a patch that loosens the coupling between the SingleSignOn valve 
implementation and the various Authenticator classes.  Right now, all 
authenticators check for an instance of the SingleSignOn class in the pipeline, 
and interact directly with it.  In the patch, SingleSignOn implements interface 
SSOValve, and all external classes interact with it through the interface.  This 
will allow application developers to deploy custom SSO implementations without 
having to replace the entire TC5 Authenticator infrastructure.  This follows the 
pattern used by other TC components.

I've been messing around with trying to use the SingleSignOn valve in a cluster 
(see enhancement request 28039) and can easily see how different implementations 
would be appropriate for different environments.  My 28039 patch attacks the 
problem by adding a property to SingleSignOn where deployers can specify use of 
an implementation of a new interface SSOClusterManager.  I think that's a valid 
approach, but loosening the coupling between SingleSignOn and Authenticators 
will provide greater flexibility.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55531</commentid>
    <comment_count>1</comment_count>
      <attachid>11188</attachid>
    <who name="Brian Stansberry">bstansberry</who>
    <bug_when>2004-04-08 17:37:30 +0000</bug_when>
    <thetext>Created attachment 11188
Patch with a diff and new interface SSOValve</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55616</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-04-10 15:11:55 +0000</bug_when>
    <thetext>Your two related patches seem useful. I'll look at them.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55625</commentid>
    <comment_count>3</comment_count>
    <who name="Brian Stansberry">bstansberry</who>
    <bug_when>2004-04-10 18:06:06 +0000</bug_when>
    <thetext>Great.  I'm sorry to say the two patches conflict (not logically, but in the 
sense that they are diffs to the same code base), but if one is committed I'll 
gladly redo the other.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56363</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-04-25 14:55:00 +0000</bug_when>
    <thetext>After reviewing, I am not going to apply this patch or the other. I don't see
the point of adding complexity and additional interfaces when SSO is used
through a standard Valve (SingleSignOn), which can easily be extended to
implement the needed clustering support.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56384</commentid>
    <comment_count>5</comment_count>
    <who name="Brian Stansberry">bstansberry</who>
    <bug_when>2004-04-26 05:48:15 +0000</bug_when>
    <thetext>I thought you might feel that way about the 28039 patch, which is one reason 
why I wrote the interface proposal ;-)  And, it's true an interface isn't 
absolutely needed; subclassing would work.  The fact that SingleSignOnEntry is 
not public (and I'm not arguing it should be) is a big stumbling block in 
easily subclassing SingleSignOn, but getting around that problem in a subclass 
is no harder than writing a whole new implementation of an interface.

But, to get subclassing to work effectively, a couple things need to be 
changed:

1) AuthenticatorBase.reauthenticateFromSSO() invokes SingleSignOn.lookup().  
This method returns a SingleSignOnEntry, which is a package protected class.  
This effectively precludes subclassing this method.  

2) SingleSignOn.update() is package protected, again preventing subclassing.

I'm attaching another patch that addresses these two issues by:

1) Changing the way AuthenticatorBase.reauthenticateFromSSO() works so it does 
not need to call SingleSignOn.lookup().  lookup() is now only called 
internally in SingleSignOn, so someone who wished to write a subclass could 
just remove any calls to it, write their own lookup algorithm, and replace 
SingleSignOnEntry with their own class.

2) Makes SingleSignOn.update() protected.

Maybe 3rd time's the charm? ;-)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56385</commentid>
    <comment_count>6</comment_count>
      <attachid>11330</attachid>
    <who name="Brian Stansberry">bstansberry</who>
    <bug_when>2004-04-26 05:49:01 +0000</bug_when>
    <thetext>Created attachment 11330
Patch to allow subclassing</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56418</commentid>
    <comment_count>7</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-04-26 16:44:59 +0000</bug_when>
    <thetext>I'm all for making the entry public. I think I'm going to apply your patch.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56437</commentid>
    <comment_count>8</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-04-26 21:58:01 +0000</bug_when>
    <thetext>This is committed. I don't see the point of not allowing to extend the entry as
well, so I also patched it.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57488</commentid>
    <comment_count>9</comment_count>
    <who name="Brian Stansberry">bstansberry</who>
    <bug_when>2004-05-15 18:41:48 +0000</bug_when>
    <thetext>The constructor in SingleSignOnEntry is package protected, so the class cannot 
be extended.  The attached patch makes the c'tor protected.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57489</commentid>
    <comment_count>10</comment_count>
      <attachid>11566</attachid>
    <who name="Brian Stansberry">bstansberry</who>
    <bug_when>2004-05-15 18:42:49 +0000</bug_when>
    <thetext>Created attachment 11566
Patch to allow subclassing of SingleSignOnEntry</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>11188</attachid>
            <date>2004-04-08 17:37:00 +0000</date>
            <delta_ts>2004-04-08 17:37:30 +0000</delta_ts>
            <desc>Patch with a diff and new interface SSOValve</desc>
            <filename>patch.zip</filename>
            <type>application/zip</type>
            <size>6808</size>
            <attacher name="Brian Stansberry">bstansberry</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>11330</attachid>
            <date>2004-04-26 05:49:00 +0000</date>
            <delta_ts>2004-04-26 05:49:01 +0000</delta_ts>
            <desc>Patch to allow subclassing</desc>
            <filename>diff</filename>
            <type>text/plain</type>
            <size>9161</size>
            <attacher name="Brian Stansberry">bstansberry</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>11566</attachid>
            <date>2004-05-15 18:42:00 +0000</date>
            <delta_ts>2004-05-15 18:42:49 +0000</delta_ts>
            <desc>Patch to allow subclassing of SingleSignOnEntry</desc>
            <filename>diff.txt</filename>
            <type>text/plain</type>
            <size>1086</size>
            <attacher name="Brian Stansberry">bstansberry</attacher>
            

          </attachment>
      

    <bug_classification class="REFACTORING">REFACTORING</bug_classification></bug>
    <bug>
          <bug_id>28321</bug_id>
          
          <creation_ts>2004-04-09 21:26:00 +0000</creation_ts>
          <short_desc>Memory Leak</short_desc>
          <delta_ts>2005-05-23 22:57:05 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.19</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>blocker</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Rajesh Patel">rpatel</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>stefan.proels</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>55593</commentid>
    <comment_count>0</comment_count>
    <who name="Rajesh Patel">rpatel</who>
    <bug_when>2004-04-09 21:26:49 +0000</bug_when>
    <thetext>Server Setup:
iPlanetTM Web Server, Enterprise Edition 6.0
Windows 2000
Tomcat 5.0.19

iPlanet is connected to the Tomcat server using the jk2 connector.

I configured JMeter with 40 threads to repeated request the same JSP over and over.
All this JSP did was print out the Total Memory, Free Memory.
After about 5000 requests, Tomcat got an out of memory error.

Same test was done but hitting the tomcat container directly, 
successfully served 15k requests with no memory leak

Test was done again, but instead of IPlanet used Apache 2.  Successfully
served 15k requests with no memory leak.

In the test case using IPlanet, there were continuous error files that
were not present in the other test cases:

Apr 8, 2004 6:24:57 PM org.apache.jk.common.HandlerRequest decodeRequest
WARNING: Error registering request
Apr 8, 2004 6:24:57 PM org.apache.jk.common.HandlerRequest invoke
INFO: Unknown message 0</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55594</commentid>
    <comment_count>1</comment_count>
      <attachid>11203</attachid>
    <who name="Rajesh Patel">rpatel</who>
    <bug_when>2004-04-09 21:28:42 +0000</bug_when>
    <thetext>Created attachment 11203
Tomcat stdout.log</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55595</commentid>
    <comment_count>2</comment_count>
    <who name="Rajesh Patel">rpatel</who>
    <bug_when>2004-04-09 21:30:47 +0000</bug_when>
    <thetext>Also, I tried the IPlanet-&gt;Tomcat test case using
Tomcat 5.0.18.  There was not memory leak.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55677</commentid>
    <comment_count>3</comment_count>
      <attachid>11220</attachid>
    <who name="Rajesh Patel">rpatel</who>
    <bug_when>2004-04-12 22:01:33 +0000</bug_when>
    <thetext>Created attachment 11220
JProfiler Heap Snapshot showing path to garbage collection root.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55684</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-04-12 22:42:02 +0000</bug_when>
    <thetext>And did you try adding response = null; in JspWriterImpl.recycle to see what
happened ?
I don't quite understand why or how it would really be a problem, though, as the
references will go away sooner or later.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55685</commentid>
    <comment_count>5</comment_count>
      <attachid>11221</attachid>
    <who name="Rajesh Patel">rpatel</who>
    <bug_when>2004-04-12 22:51:00 +0000</bug_when>
    <thetext>Created attachment 11221
List of objects in memory</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55686</commentid>
    <comment_count>6</comment_count>
    <who name="Rajesh Patel">rpatel</who>
    <bug_when>2004-04-12 22:52:15 +0000</bug_when>
    <thetext>No I didn't want to mess around with the Tomcat code.  I would be happy if I
could just turn off JMX completely.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55687</commentid>
    <comment_count>7</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-04-12 23:11:32 +0000</bug_when>
    <thetext>You could try setting:
  request.registerRequests=false
in your jk2.properties file.  This will turn off the JMX registration of 
Requests.  

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55701</commentid>
    <comment_count>8</comment_count>
    <who name="Rajesh Patel">rpatel</who>
    <bug_when>2004-04-13 15:26:27 +0000</bug_when>
    <thetext>Turning off the jmx registrations has solved the problem for us.  We were able to
do 100k requests with no memory leak.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55704</commentid>
    <comment_count>9</comment_count>
    <who name="Jess Holle">jessh</who>
    <bug_when>2004-04-13 15:31:22 +0000</bug_when>
    <thetext>Bill, did you possibly fix this in 5.0.20?

I am specifically referring to the changelog entry:

  "Fix JMX Request registration in JK (billbarker)"

I know that fixed other issues for which I was using

  request.registerRequests=false

Rajesh, I would be interested in knowing if 5.0.2x exhibit the same issues in
your testing.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55712</commentid>
    <comment_count>10</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-04-13 17:48:10 +0000</bug_when>
    <thetext>There are a couple of other entries in the changelog that are related, but 
yes, this should be fixed in 5.0.20+.

You still should need to disable request-registration if you are using the JNI 
Channel, since the leak is still there.  Fixing it here requires changes to 
the native side of the connector as well, since that is the only place that 
knows that a thread has died.

Marking this as FIXED, since it looks like its a dup of the same-old request-
registration problem.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56727</commentid>
    <comment_count>11</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-05-02 19:57:51 +0000</bug_when>
    <thetext>*** Bug 28731 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>11203</attachid>
            <date>2004-04-09 21:28:00 +0000</date>
            <delta_ts>2004-04-09 21:28:42 +0000</delta_ts>
            <desc>Tomcat stdout.log</desc>
            <filename>OutOfMemory-Raj-4-8-04-stdout.zip</filename>
            <type>application/octet-stream</type>
            <size>34120</size>
            <attacher name="Rajesh Patel">rpatel</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>11220</attachid>
            <date>2004-04-12 22:01:00 +0000</date>
            <delta_ts>2004-04-12 22:01:33 +0000</delta_ts>
            <desc>JProfiler Heap Snapshot showing path to garbage collection root.</desc>
            <filename>graph.png</filename>
            <type>image/png</type>
            <size>61713</size>
            <attacher name="Rajesh Patel">rpatel</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>11221</attachid>
            <date>2004-04-12 22:51:00 +0000</date>
            <delta_ts>2004-04-12 22:51:00 +0000</delta_ts>
            <desc>List of objects in memory</desc>
            <filename>TomcatMemoryLeak.zip</filename>
            <type>application/octet-stream</type>
            <size>64440</size>
            <attacher name="Rajesh Patel">rpatel</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>28333</bug_id>
          
          <creation_ts>2004-04-10 17:57:00 +0000</creation_ts>
          <short_desc>Add info on cvs login to tomcat build file.</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>Unknown</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Sandy McArthur">sandymac</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>55624</commentid>
    <comment_count>0</comment_count>
    <who name="Sandy McArthur">sandymac</who>
    <bug_when>2004-04-10 17:57:17 +0000</bug_when>
    <thetext>On the building doc:
http://jakarta.apache.org/tomcat/tomcat-5.0-doc/building.html you are told to
download and run an ant build file:
http://jakarta.apache.org/tomcat/tomcat-5.0-doc/build.xml to checkout tomcat
sources. For people running this the first time the checkout target will fail
because they need to login to CVS. It would be nice if the following task was
added near the top of the checkout target to inform the developer of what needs
to be done.

&lt;echo level="info"
     message="If the checkouts fail, run `cvs -d ${cvsroot} login` and try again."/&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56360</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-04-25 12:02:25 +0000</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>28335</bug_id>
          
          <creation_ts>2004-04-10 22:55:00 +0000</creation_ts>
          <short_desc>janitorial javadoc clean ups to jakarta-tomcat-catalina</short_desc>
          <delta_ts>2006-09-28 04:21:08 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Unknown</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords>PatchAvailable</keywords>
          <priority>P5</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Sandy McArthur">sandymac</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>55633</commentid>
    <comment_count>0</comment_count>
    <who name="Sandy McArthur">sandymac</who>
    <bug_when>2004-04-10 22:55:11 +0000</bug_when>
    <thetext>The to be attached patch cleans up only JavaDoc comments that have one of the
following problems:

Corrected @param names is wrong or misspelled
Removed @param names that don't exists
Removed @param names that have no description
Removed @return tags without a description
Removed @exception tags for exceptions that are not thrown by the method
Corrected @see tags

In the case where it wasn't obivious how to fix a javadoc comment, I just left
it alone.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55634</commentid>
    <comment_count>1</comment_count>
      <attachid>11212</attachid>
    <who name="Sandy McArthur">sandymac</who>
    <bug_when>2004-04-10 22:55:58 +0000</bug_when>
    <thetext>Created attachment 11212
catalina javadoc clean ups</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58141</commentid>
    <comment_count>2</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-05-26 16:43:28 +0000</bug_when>
    <thetext>Changes made and committed (along with a few more JavaDoc fixes).</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>11212</attachid>
            <date>2004-04-10 22:55:00 +0000</date>
            <delta_ts>2004-04-10 22:55:58 +0000</delta_ts>
            <desc>catalina javadoc clean ups</desc>
            <filename>jakarta-tomcat-catalina.patch</filename>
            <type>text/plain</type>
            <size>83249</size>
            <attacher name="Sandy McArthur">sandymac</attacher>
            

          </attachment>
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>28361</bug_id>
          
          <creation_ts>2004-04-13 12:35:00 +0000</creation_ts>
          <short_desc>foreach no longer works in tag file</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.0.19</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="am">aminm</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>55700</commentid>
    <comment_count>0</comment_count>
    <who name="am">aminm</who>
    <bug_when>2004-04-13 12:35:27 +0000</bug_when>
    <thetext>here is a simple tag file:

&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ attribute name="lista" type="java.util.ArrayList" required="true" 
rtexprvalue="true"%&gt;

${lista[1]}

&lt;c:forEach var="elem"  items="${lista}"&gt;
    &lt;LI&gt; ${elem}&lt;/LI&gt;
&lt;/c:forEach&gt;

Here is the output I get from tomcat 5.0.0.19:

type Exception report

message 

description The server encountered an internal error () that prevented it from 
fulfilling this request.

exception 

org.apache.jasper.JasperException: Unable to compile class for JSP

An error occurred at line: -1 in the jsp file: null

Generated servlet error:
    [javac] Compiling 1 source file

C:\dev\jakarta-tomcat-5.0.19\work\Catalina\localhost\jsp-
examples\org\apache\jsp\tag\web\listado_tag.java:185: cannot resolve symbol
symbol  : variable pageContext 
location: class org.apache.jsp.tag.web.listado_tag
pageContext.setAttribute(
^
1 error


	org.apache.jasper.compiler.DefaultErrorHandler.javacError
(DefaultErrorHandler.java:127)
	org.apache.jasper.compiler.ErrorDispatcher.javacError
(ErrorDispatcher.java:351)
	org.apache.jasper.compiler.Compiler.generateClass(Compiler.java:415)
	org.apache.jasper.compiler.Compiler.compile(Compiler.java:458)
	org.apache.jasper.compiler.Compiler.compile(Compiler.java:439)
	org.apache.jasper.JspCompilationContext.compile
(JspCompilationContext.java:553)
	org.apache.jasper.servlet.JspServletWrapper.loadTagFile
(JspServletWrapper.java:209)
	org.apache.jasper.compiler.TagFileProcessor.loadTagFile
(TagFileProcessor.java:553)
	org.apache.jasper.compiler.TagFileProcessor.access$000
(TagFileProcessor.java:93)
	org.apache.jasper.compiler.TagFileProcessor$TagFileLoaderVisitor.visit
(TagFileProcessor.java:604)
	org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1458)
	org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2180)
	org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2230)
	org.apache.jasper.compiler.Node$Visitor.visit(Node.java:2236)
	org.apache.jasper.compiler.Node$Root.accept(Node.java:485)
	org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2180)
	org.apache.jasper.compiler.TagFileProcessor.loadTagFiles
(TagFileProcessor.java:622)
	org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:259)
	org.apache.jasper.compiler.Compiler.compile(Compiler.java:456)
	org.apache.jasper.compiler.Compiler.compile(Compiler.java:439)
	org.apache.jasper.JspCompilationContext.compile
(JspCompilationContext.java:553)
	org.apache.jasper.servlet.JspServletWrapper.service
(JspServletWrapper.java:291)
	org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:301)
	org.apache.jasper.servlet.JspServlet.service(JspServlet.java:248)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:856)


note The full stack trace of the root cause is available in the Tomcat logs.


------------

It seems that a change done in Tomcat 5.0.0.19 got rid of pageContext in the 
doTag(). Unfortunately foreach seems to need that.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55709</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-04-13 16:44:30 +0000</bug_when>
    <thetext>You must be using a stale tag file.

As of TC 5.0.19, the generated tag handler (corresponding to the tag file)
generates this code:

  _jspx_page_context.setAttribute("lista", getLista());

This change was made in order to address Bugtraq 4984188 ("pageContext used in
*.tag files"). With the fix, the implicit "pageContext" object is no longer
exposed in tag files, to comply with the JSP spec.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55710</commentid>
    <comment_count>2</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-04-13 16:49:47 +0000</bug_when>
    <thetext>Ah, I think you are using one of the tag plugins?
In that case, you're right, this is a bug.

The tag plugins for &lt;c:forEach&gt; and &lt;c:if&gt; still reference "pageContext"
in their generated code.

As a workaround, do not use any tag plugins, until this has been fixed.

</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>28380</bug_id>
          
          <creation_ts>2004-04-14 14:43:00 +0000</creation_ts>
          <short_desc>Dynamic attributes with non-alphanumeric chars in names do not work in classic tag handlers with pooling enabled</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.16</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Vit Timchishin">tivv</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>1</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>55758</commentid>
    <comment_count>0</comment_count>
    <who name="Vit Timchishin">tivv</who>
    <bug_when>2004-04-14 14:43:33 +0000</bug_when>
    <thetext>See summary.
Neither "style.width" nor "mynamespace:attribute" attributes in tags do not work
because Jasper
tries to make pool variable based on this names. I suppose some escaping must be
added.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55772</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-04-14 17:30:51 +0000</bug_when>
    <thetext>No idea what you are talking about.  Dynamic attributes in classic tag handlers?
 Also, Jasper does not make variables out of dynamic attributes.

Please supply a test case (in war) if you still have problems.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56010</commentid>
    <comment_count>2</comment_count>
    <who name="Vit Timchishin">tivv</who>
    <bug_when>2004-04-19 11:11:41 +0000</bug_when>
    <thetext>Yes.
I have my own tag handler that implement DynamicAttributes interface, say
public class ComponentTag extends TagSupport implements
javax.servlet.jsp.tagext.DynamicAttributes {
public synchronized void setDynamicAttribute(String uri, String localname,
Object o) throws JspException {}
}

registered as myTagLib:myTag.

When I try to call &lt;myTagLib:myTag myTagLib:myTagAttribute="attrvalue"/&gt;
or &lt;myTagLib:myTag style.width="100%"/&gt; I am getting an exception from javac
that can't create tag pool variable in JSP class with "style.width" or
"myTagLib:myTagAttribute" string in it's name.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56045</commentid>
    <comment_count>3</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-04-19 21:15:57 +0000</bug_when>
    <thetext>Ah, so the bug covers that cases when there is a '.' or ':' in the attribute
names.  I was lead off track with the mention of dynamic attributes.

Fixed in CVS.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>28441</bug_id>
          
          <creation_ts>2004-04-16 18:55:00 +0000</creation_ts>
          <short_desc>HTTP 500 editing Context</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Administration</component>
          <version>5.0.18</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Hendrik Saly">phps</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>55920</commentid>
    <comment_count>0</comment_count>
    <who name="Hendrik Saly">phps</who>
    <bug_when>2004-04-16 18:55:17 +0000</bug_when>
    <thetext>I have a context called "accounting" with the following entry in server.xml:

&lt;Context path="/accounting" docbase="accounting"&gt;
&lt;Realm className="org.apache.catalina.realm.DataSourceRealm" debug="99"   
dataSourceName="jdbc/accountingDB" digest="md5" userTable="employee"
userNameCol="employee_id" userCredCol="password" userRoleTable="role"
roleNameCol="role"/&gt;
&lt;Logger className="org.apache.catalina.logger.FileLogger" directory="logs"
prefix="accounting.log" suffix=".txt" timestamp="true"/&gt;
&lt;/Context&gt;

The entire application works well. But if i try to use the Tomcat Administrator 
for editing the DataSources or Realms of this context i get an HTTP 500 error.
The "jdbc/accountingDB" ressource is defined in GlobalNamingResources. Editing
this works well.

The errors are: For editing the contexts DataSources: 

javax.servlet.ServletException: Exception retrieving attribute 'driverClassName'
	org.apache.jasper.runtime.PageContextImpl.doHandlePageException(PageContextImpl.java:867)
	org.apache.jasper.runtime.PageContextImpl.handlePageException(PageContextImpl.java:800)
	admin.resources.listDataSources_jsp._jspService(listDataSources_jsp.java:429)
	org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:133)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:856)
	org.apache.struts.action.RequestProcessor.doForward(RequestProcessor.java:1069)
	org.apache.struts.action.RequestProcessor.processForwardConfig(RequestProcessor.java:455)
	org.apache.struts.action.RequestProcessor.process(RequestProcessor.java:279)
	org.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)
	org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:743)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:856)
	org.apache.struts.action.RequestProcessor.doForward(RequestProcessor.java:1069)
	org.apache.struts.action.RequestProcessor.processForwardConfig(RequestProcessor.java:455)
	org.apache.struts.action.RequestProcessor.process(RequestProcessor.java:279)
	org.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)
	org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:743)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:856)


For editing the contexts realms: 

HTTP Status 500 - Error retrieving attribute className

type Status report

message Error retrieving attribute className

description The server encountered an internal error (Error retrieving attribute
className) that prevented it from fulfilling this request.
Apache Tomcat/5.0.18</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55926</commentid>
    <comment_count>1</comment_count>
    <who name="Amy Roh">amyroh</who>
    <bug_when>2004-04-16 22:48:51 +0000</bug_when>
    <thetext>DataSourceRealm is not supported in admin webapp currently.  Only
UserDatabaseRealm, JNDIRealm, JDBCRealm, and MemoryRealm are supported.  I'll go
ahead and add DataSourceRealm to admin, hence changing it to enhancement.
Regarding context datasources, it works fine for me.  Can you attach the full
server.xml?  Probably something wrong with your DataSource definition.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>55935</commentid>
    <comment_count>2</comment_count>
    <who name="Hendrik Saly">phps</who>
    <bug_when>2004-04-17 07:30:21 +0000</bug_when>
    <thetext>Full server.xml

&lt;Server port="8005" shutdown="SHUTDOWN" debug="0"&gt;
	&lt;Listener className="org.apache.catalina.mbeans.ServerLifecycleListener"
debug="0"/&gt;
	&lt;Listener
className="org.apache.catalina.mbeans.GlobalResourcesLifecycleListener" debug="0"/&gt;
	&lt;!-- Global JNDI resources --&gt;
	&lt;GlobalNamingResources&gt;
		&lt;!-- Editable user database that can also be used by
         UserDatabaseRealm to authenticate users --&gt;
		&lt;Resource name="UserDatabase" auth="Container"
type="org.apache.catalina.UserDatabase" description="User database that can be
updated and saved"&gt;
    &lt;/Resource&gt;
		&lt;ResourceParams name="UserDatabase"&gt;
			&lt;parameter&gt;
				&lt;name&gt;factory&lt;/name&gt;
				&lt;value&gt;org.apache.catalina.users.MemoryUserDatabaseFactory&lt;/value&gt;
			&lt;/parameter&gt;
			&lt;parameter&gt;
				&lt;name&gt;pathname&lt;/name&gt;
				&lt;value&gt;conf/tomcat-users.xml&lt;/value&gt;
			&lt;/parameter&gt;
		&lt;/ResourceParams&gt;
		&lt;!-- mysql database --&gt;
		&lt;Resource name="jdbc/accountingDB" auth="Container" type="javax.sql.DataSource"/&gt;
		&lt;ResourceParams name="jdbc/accountingDB"&gt;
			&lt;parameter&gt;
				&lt;name&gt;factory&lt;/name&gt;
				&lt;value&gt;org.apache.commons.dbcp.BasicDataSourceFactory&lt;/value&gt;
			&lt;/parameter&gt;
			&lt;parameter&gt;
				&lt;name&gt;dataSourceName&lt;/name&gt;
				&lt;value&gt;java:comp/env/jdbc/accountingDB&lt;/value&gt;
			&lt;/parameter&gt;
			&lt;parameter&gt;
				&lt;name&gt;defaultAutoCommit&lt;/name&gt;
				&lt;value&gt;false&lt;/value&gt;
			&lt;/parameter&gt;
			&lt;parameter&gt;
				&lt;name&gt;maxActive&lt;/name&gt;
				&lt;value&gt;100&lt;/value&gt;
			&lt;/parameter&gt;
			&lt;parameter&gt;
				&lt;name&gt;maxIdle&lt;/name&gt;
				&lt;value&gt;30&lt;/value&gt;
			&lt;/parameter&gt;
			&lt;parameter&gt;
				&lt;name&gt;maxWait&lt;/name&gt;
				&lt;value&gt;10000&lt;/value&gt;
			&lt;/parameter&gt;
			&lt;!-- MySQL dB username and password for dB connections  --&gt;
			&lt;parameter&gt;
				&lt;name&gt;username&lt;/name&gt;
				&lt;value&gt;dummy&lt;/value&gt;
			&lt;/parameter&gt;
			&lt;parameter&gt;
				&lt;name&gt;password&lt;/name&gt;
				&lt;value&gt;dummy&lt;/value&gt;
			&lt;/parameter&gt;
			&lt;!-- Class name for the official MySQL Connector/J driver --&gt;
			&lt;parameter&gt;
				&lt;name&gt;driverClassName&lt;/name&gt;
				&lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;
			&lt;/parameter&gt;
			&lt;parameter&gt;
				&lt;name&gt;url&lt;/name&gt;
				&lt;value&gt;jdbc:mysql://localhost:3306/accounting?autoReconnect=true&lt;/value&gt;
			&lt;/parameter&gt;
		&lt;/ResourceParams&gt;
	&lt;/GlobalNamingResources&gt;
	&lt;!-- Define the Tomcat Stand-Alone Service --&gt;
	&lt;Service name="Catalina"&gt;
		&lt;!-- Define a non-SSL Coyote HTTP/1.1 Connector on port 8080 --&gt;
		&lt;Connector port="80" maxThreads="150" minSpareThreads="25"
maxSpareThreads="75" enableLookups="false" redirectPort="8443" acceptCount="100"
debug="0" connectionTimeout="20000" disableUploadTimeout="true"/&gt;
		&lt;!-- Define a Coyote/JK2 AJP 1.3 Connector on port 8009 --&gt;
		&lt;Connector port="8009" enableLookups="false" redirectPort="8443" debug="0"
protocol="AJP/1.3"/&gt;
		&lt;!-- Define the top level container in our container hierarchy --&gt;
		&lt;Engine name="Catalina" defaultHost="localhost" debug="0"&gt;
			&lt;!-- Global logger unless overridden at lower levels --&gt;
			&lt;Logger className="org.apache.catalina.logger.FileLogger"
prefix="catalina_log." suffix=".txt" timestamp="true"/&gt;
			&lt;Realm className="org.apache.catalina.realm.UserDatabaseRealm" debug="0"
resourceName="UserDatabase"/&gt;
			&lt;Host name="localhost" debug="0" appBase="webapps" unpackWARs="true"
autoDeploy="true" xmlValidation="false" xmlNamespaceAware="false"&gt;
				&lt;!-- PB --&gt;
				&lt;Valve className="org.apache.catalina.valves.AccessLogValve"
directory="logs" prefix="localhost_access_log." suffix=".txt" pattern="common"
resolveHosts="false"/&gt;
				&lt;!-- PB --&gt;
				&lt;Logger className="org.apache.catalina.logger.FileLogger" directory="logs"
prefix="localhost_log." suffix=".txt" timestamp="true"/&gt;
				&lt;!-- Tomcat Root Context --&gt;
				&lt;Context path="" docBase="ROOT" debug="0"/&gt;
				&lt;Context path="/accounting" docbase="accounting"&gt;
					&lt;Realm className="org.apache.catalina.realm.DataSourceRealm" debug="99"
dataSourceName="jdbc/accountingDB" digest="md5" userTable="employee"
userNameCol="employee_id" userCredCol="password" userRoleTable="role"
roleNameCol="role"/&gt;
					&lt;Logger className="org.apache.catalina.logger.FileLogger" directory="logs"
prefix="accounting.log" suffix=".txt" timestamp="true"/&gt;
				&lt;/Context&gt;
			&lt;/Host&gt;
		&lt;/Engine&gt;
	&lt;/Service&gt;
&lt;/Server&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56047</commentid>
    <comment_count>3</comment_count>
    <who name="Amy Roh">amyroh</who>
    <bug_when>2004-04-19 21:54:36 +0000</bug_when>
    <thetext>Added DataSourceRealm support in admin.  The fix is in cvs and should be
available in the next release.</thetext>
  </long_desc>
      
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>28524</bug_id>
          
          <creation_ts>2004-04-21 23:13:00 +0000</creation_ts>
          <short_desc>Exception throw when creating new JNDI data source</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Administration</component>
          <version>5.0.19</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="David Trott">dtrott</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>56216</commentid>
    <comment_count>0</comment_count>
    <who name="David Trott">dtrott</who>
    <bug_when>2004-04-21 23:13:39 +0000</bug_when>
    <thetext>Steps to reproduce:

Create three empty directories:

testcase
testcase\WEB-INF
testcase\WEB-INF\classes

Create a file web.xml containing the following:


&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE web-app PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 
2.3//EN" "http://java.sun.com/dtd/web-app_2_3.dtd"&gt;
&lt;web-app&gt;
   &lt;resource-ref&gt;
    &lt;description&gt;Test connection&lt;/description&gt;
    &lt;res-ref-name&gt;jdbc/testdb&lt;/res-ref-name&gt;
    &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
    &lt;res-auth&gt;Container&lt;/res-auth&gt;
  &lt;/resource-ref&gt;
&lt;/web-app&gt;


Use the Tomcat manager app to deploy the directory (context) /testcase

Next log into the the "Tomcat Administration Tool" and open the datasources 
page:

  Tomcat Server 
    Service (Catalina) 
     Host (localhost) 
      Context (/testcase) 
        Resources 
          Data Sources 

The following exception is displayed in the right frame:


HTTP Status 500 - 

--------------------------------------------------------------------------------

type Exception report

message 

description The server encountered an internal error () that prevented it from 
fulfilling this request.

exception 

javax.servlet.ServletException: Exception retrieving attribute 'driverClassName'
	org.apache.jasper.runtime.PageContextImpl.doHandlePageException
(PageContextImpl.java:867)
	org.apache.jasper.runtime.PageContextImpl.handlePageException
(PageContextImpl.java:800)
	admin.resources.listDataSources_jsp._jspService
(listDataSources_jsp.java:431)
	org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:133)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:856)
	org.apache.struts.action.RequestProcessor.doForward
(RequestProcessor.java:1069)
	org.apache.struts.action.RequestProcessor.processForwardConfig
(RequestProcessor.java:455)
	org.apache.struts.action.RequestProcessor.process
(RequestProcessor.java:279)
	org.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)
	org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:743)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:856)
	org.apache.struts.action.RequestProcessor.doForward
(RequestProcessor.java:1069)
	org.apache.struts.action.RequestProcessor.processForwardConfig
(RequestProcessor.java:455)
	org.apache.struts.action.RequestProcessor.process
(RequestProcessor.java:279)
	org.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)
	org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:743)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:856)


root cause 

javax.servlet.jsp.JspException: Exception retrieving attribute 'driverClassName'
	org.apache.webapp.admin.AttributeTag.doEndTag(AttributeTag.java:215)
	admin.resources.listDataSources_jsp._jspx_meth_controls_attribute_1
(listDataSources_jsp.java:743)
	admin.resources.listDataSources_jsp._jspService
(listDataSources_jsp.java:391)
	org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:133)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:856)
	org.apache.struts.action.RequestProcessor.doForward
(RequestProcessor.java:1069)
	org.apache.struts.action.RequestProcessor.processForwardConfig
(RequestProcessor.java:455)
	org.apache.struts.action.RequestProcessor.process
(RequestProcessor.java:279)
	org.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)
	org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:743)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:856)
	org.apache.struts.action.RequestProcessor.doForward
(RequestProcessor.java:1069)
	org.apache.struts.action.RequestProcessor.processForwardConfig
(RequestProcessor.java:455)
	org.apache.struts.action.RequestProcessor.process
(RequestProcessor.java:279)
	org.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)
	org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:743)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:856)


note The full stack trace of the root cause is available in the Tomcat logs.


--------------------------------------------------------------------------------

Apache Tomcat/5.0.19</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56219</commentid>
    <comment_count>1</comment_count>
    <who name="Amy Roh">amyroh</who>
    <bug_when>2004-04-21 23:35:13 +0000</bug_when>
    <thetext>I think you're getting the error because you have resource-ref in your web.xml
but no context datasource definition on either server.xml or context.xml.  Admin
is expecting to find datasource and looking up its driverClassName but the
definition isn't there.  As a workaround, you can add context datasource first
via admin or by hand in context.xml and add your resource-ref in web.xml.  I
know it's hacky.  I'll try to fix this for the next release but no time right now.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56221</commentid>
    <comment_count>2</comment_count>
    <who name="David Trott">dtrott</who>
    <bug_when>2004-04-21 23:51:11 +0000</bug_when>
    <thetext>I have confirmed that Amy Roh's workaround works.

Thank You.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56529</commentid>
    <comment_count>3</comment_count>
    <who name="Amy Roh">amyroh</who>
    <bug_when>2004-04-28 02:05:57 +0000</bug_when>
    <thetext>Fixed - doesn't try to display context resource in admin unless you have full 
resource definition in your context.xml or server.xml.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56570</commentid>
    <comment_count>4</comment_count>
    <who name="David Trott">dtrott</who>
    <bug_when>2004-04-28 18:20:05 +0000</bug_when>
    <thetext>I attempted to verify this fix using nightly build:

jakarta-tomcat-5-bin-20040427.zip

First I copied the Oracle JDBC driver into the directory:

jakarta-tomcat-5\common\lib

I was able to successfully reach the data sources page:

  Tomcat Server 
    Service (Catalina) 
     Host (localhost) 
      Context (/testcase) 
        Resources 
          Data Sources


However I then tried to create a data source:

JNDI Name:			jdbc/testdb
Data Source URL:		jdbc:oracle:thin:@paris:1521:d921
JDBC Driver Class:		oracle.jdbc.driver.OracleDriver
User Name:			[PRIVATE]
Password:			[PRIVATE]
Max. Active Connections:	1
Max. Idle Connections:	1
Max. Wait for Connection:	5000
Validation Query:


After clicking the "Save" button, I received the following error:

HTTP Status 500 - Error invoking operation addResource

--------------------------------------------------------------------------------

type Status report

message Error invoking operation addResource

description The server encountered an internal error (Error invoking operation 
addResource) that prevented it from fulfilling this request.


--------------------------------------------------------------------------------

Apache Tomcat/5.0
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56571</commentid>
    <comment_count>5</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-04-28 18:25:35 +0000</bug_when>
    <thetext>You did waste your time, sorry.
a) How about checking the date before hitting submit ?
b) Don't use nightlies, use a CVS build</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56574</commentid>
    <comment_count>6</comment_count>
    <who name="David Trott">dtrott</who>
    <bug_when>2004-04-28 19:21:27 +0000</bug_when>
    <thetext>I have just (12:06 PM PST 04/28/04) done a build from CVS.

The "Error invoking operation addResource" bug still exists in the CVS build.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56582</commentid>
    <comment_count>7</comment_count>
    <who name="Amy Roh">amyroh</who>
    <bug_when>2004-04-28 22:01:43 +0000</bug_when>
    <thetext>What does admin log say?  The log should display the exception that's causing
the error.  The datasource add works for me.  The page now displays datasource
if you have resource-ref in your web.xml with the corresponding
GlobalNamingResource parameters.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56640</commentid>
    <comment_count>8</comment_count>
    <who name="David Trott">dtrott</who>
    <bug_when>2004-04-29 17:05:36 +0000</bug_when>
    <thetext>The exception in the admin log is given at the bottom of this post.

However I just did a clean (deleting all files but build.xml) CVS build, so the 
JNDI data source is not defined.

As a test I tried editing my web.xml file (listed before) to remove the 
resource-ref section.
If the resource-ref section is missing it is possible to add the data source 
(without error), however it is a pain to have to deploy the application edit 
the web.xml, then after defining the data-source edit the web.xml back.



javax.management.RuntimeOperationsException: Exception invoking method 
addResourcenested exception is java.lang.IllegalArgumentException: Invalid 
resource name - already exists'jdbc/testdb'
java.lang.IllegalArgumentException: Invalid resource name - already 
exists'jdbc/testdb'
	at org.apache.catalina.mbeans.NamingResourcesMBean.addResource
(NamingResourcesMBean.java:221)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke
(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke
(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:324)
	at org.apache.commons.modeler.BaseModelMBean.invoke
(BaseModelMBean.java:501)
	at mx4j.server.interceptor.InvokerMBeanServerInterceptor.invoke
(InvokerMBeanServerInterceptor.java:209)
	at mx4j.server.interceptor.DefaultMBeanServerInterceptor.invoke
(DefaultMBeanServerInterceptor.java:123)
	at mx4j.server.interceptor.SecurityMBeanServerInterceptor.invoke
(SecurityMBeanServerInterceptor.java:79)
	at mx4j.server.interceptor.DefaultMBeanServerInterceptor.invoke
(DefaultMBeanServerInterceptor.java:123)
	at mx4j.server.interceptor.DefaultMBeanServerInterceptor.invoke
(DefaultMBeanServerInterceptor.java:123)
	at 
mx4j.server.interceptor.ContextClassLoaderMBeanServerInterceptor.invoke
(ContextClassLoaderMBeanServerInterceptor.java:144)
	at mx4j.server.MBeanServerImpl.invoke(MBeanServerImpl.java:1353)
	at org.apache.webapp.admin.resources.SaveDataSourceAction.perform
(SaveDataSourceAction.java:171)
	at org.apache.struts.action.Action.execute(Action.java:420)
	at org.apache.struts.action.RequestProcessor.processActionPerform
(RequestProcessor.java:484)
	at org.apache.struts.action.RequestProcessor.process
(RequestProcessor.java:274)
	at org.apache.struts.action.ActionServlet.process
(ActionServlet.java:1482)
	at org.apache.struts.action.ActionServlet.doPost(ActionServlet.java:525)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:717)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:810)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter
(ApplicationFilterChain.java:237)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter
(ApplicationFilterChain.java:157)
	at org.apache.catalina.core.StandardWrapperValve.invoke
(StandardWrapperValve.java:214)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:104)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:520)
	at org.apache.catalina.core.StandardContextValve.invokeInternal
(StandardContextValve.java:198)
	at org.apache.catalina.core.StandardContextValve.invoke
(StandardContextValve.java:152)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:104)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke
(AuthenticatorBase.java:540)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:102)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:520)
	at org.apache.catalina.core.StandardHostValve.invoke
(StandardHostValve.java:137)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:104)
	at org.apache.catalina.valves.ErrorReportValve.invoke
(ErrorReportValve.java:117)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:102)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:520)
	at org.apache.catalina.core.StandardEngineValve.invoke
(StandardEngineValve.java:109)
	at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValveContext.java:104)
	at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.java:520)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:929)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service
(CoyoteAdapter.java:160)
	at org.apache.coyote.http11.Http11Processor.process
(Http11Processor.java:793)
	at 
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio
n(Http11Protocol.java:702)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt
(PoolTcpEndpoint.java:571)
	at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run
(ThreadPool.java:644)
	at java.lang.Thread.run(Thread.java:534)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56672</commentid>
    <comment_count>9</comment_count>
    <who name="Amy Roh">amyroh</who>
    <bug_when>2004-04-30 00:42:59 +0000</bug_when>
    <thetext>If you have resource-ref defined in your web.xml, you need to have your resource
definition either under GlobalNamingResource in server.xml or context resource
in your context.xml in order to view via admin.  I have fixed addResource so
that it also checks for duplicate resource using encoded jndi name also.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>28603</bug_id>
          
          <creation_ts>2004-04-26 17:26:00 +0000</creation_ts>
          <short_desc>JspC Ant task does not detect errors on a second compile</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.19</version>
          <rep_platform>All</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Petr Jiricka">petr.jiricka</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>56421</commentid>
    <comment_count>0</comment_count>
    <who name="Petr Jiricka">petr.jiricka</who>
    <bug_when>2004-04-26 17:26:23 +0000</bug_when>
    <thetext>1. Set up an application with an Ant script to compile JSPs as recommended at
http://jakarta.apache.org/tomcat/tomcat-5.0-doc/jasper-howto.html
2. Write a JSP which contains erroneous text such that the first phase (JSP -&gt;
Java translation) fails e.g. by including &lt;jsp:include x="50"/&gt; in the page.
3. Compile the application using the Ant script - a Jasper exception will be
reported.
4. Compile the application again - build will succeed despite the error.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56501</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-04-27 18:15:53 +0000</bug_when>
    <thetext>Fixed by removing empty .java file (that was generated by "new
FileOutputStream()") if parser/validator/generator throws exception.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56923</commentid>
    <comment_count>2</comment_count>
    <who name="Petr Jiricka">petr.jiricka</who>
    <bug_when>2004-05-06 12:59:10 +0000</bug_when>
    <thetext>I must say this still does not work for me in Tomcat 5.0.24. I am attaching an
application which reproduces this issue. To reproduce:

1. Unzip the attached testApp.zip
2. Modify the build.properties file from testApp.zip to point to a Tomcat 5.0.24
installation
3. In the root directory of this test application, run Ant twice (I am using Ant
1.6.1). The first time you run Ant, a compilation error is reported, but the
second time it is not and build succeeds.

Thanks for looking at this.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56924</commentid>
    <comment_count>3</comment_count>
      <attachid>11444</attachid>
    <who name="Petr Jiricka">petr.jiricka</who>
    <bug_when>2004-05-06 13:00:06 +0000</bug_when>
    <thetext>Created attachment 11444
The test application which reproduces this issue.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56957</commentid>
    <comment_count>4</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-05-06 22:44:13 +0000</bug_when>
    <thetext>Hmm, this works for me (on UNIX).

Do you see an empty JSP_jsp.java file being generated in your project's "build"
directory? Such a file used to be generated, but my fix should have deleted it
(using File.delete()).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56994</commentid>
    <comment_count>5</comment_count>
    <who name="Petr Jiricka">petr.jiricka</who>
    <bug_when>2004-05-07 16:38:18 +0000</bug_when>
    <thetext>Ok, I'll look at this over the weekend and debug it on my side.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57086</commentid>
    <comment_count>6</comment_count>
    <who name="Petr Jiricka">petr.jiricka</who>
    <bug_when>2004-05-10 14:01:27 +0000</bug_when>
    <thetext>I found out where the problem is: When the file is deleted, the outputstream
that writes this file is still open, so the delete operation fails on Windows.
The stream is closed too late. I will attach a patch that fixes this on my machine.

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57087</commentid>
    <comment_count>7</comment_count>
      <attachid>11489</attachid>
    <who name="Petr Jiricka">petr.jiricka</who>
    <bug_when>2004-05-10 14:02:38 +0000</bug_when>
    <thetext>Created attachment 11489
Patch that works for me.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57110</commentid>
    <comment_count>8</comment_count>
      <attachid>11499</attachid>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-05-10 16:27:28 +0000</bug_when>
    <thetext>Created attachment 11499
Set 'writer' to NULL, so it won't be closed again in finally</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57111</commentid>
    <comment_count>9</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-05-10 16:28:58 +0000</bug_when>
    <thetext>Thanks for investigating, Petr!

I've applied your patch, which I slightly modified by setting 'writer' to NULL
after closing it in the exception handling code you added, so that it won't be
closed again in the finally.

Modified patch attached.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57120</commentid>
    <comment_count>10</comment_count>
    <who name="Petr Jiricka">petr.jiricka</who>
    <bug_when>2004-05-10 17:54:17 +0000</bug_when>
    <thetext>Thanks!</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>11444</attachid>
            <date>2004-05-06 13:00:00 +0000</date>
            <delta_ts>2004-05-06 13:00:06 +0000</delta_ts>
            <desc>The test application which reproduces this issue.</desc>
            <filename>testApp.zip</filename>
            <type>application/octet-stream</type>
            <size>1445</size>
            <attacher name="Petr Jiricka">petr.jiricka</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>11489</attachid>
            <date>2004-05-10 14:02:00 +0000</date>
            <delta_ts>2004-05-10 14:02:38 +0000</delta_ts>
            <desc>Patch that works for me.</desc>
            <filename>patch.txt</filename>
            <type>text/plain</type>
            <size>903</size>
            <attacher name="Petr Jiricka">petr.jiricka</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>11499</attachid>
            <date>2004-05-10 16:27:00 +0000</date>
            <delta_ts>2004-05-10 16:27:28 +0000</delta_ts>
            <desc>Set 'writer' to NULL, so it won't be closed again in finally</desc>
            <filename>patch.txt</filename>
            <type>text/plain</type>
            <size>867</size>
            <attacher name="Jan Luehe">jan.luehe</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>28604</bug_id>
          
          <creation_ts>2004-04-26 17:32:00 +0000</creation_ts>
          <short_desc>JspC should not display the whole stack trace of errors</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.19</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Petr Jiricka">petr.jiricka</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>56422</commentid>
    <comment_count>0</comment_count>
    <who name="Petr Jiricka">petr.jiricka</who>
    <bug_when>2004-04-26 17:32:50 +0000</bug_when>
    <thetext>1. Set up an application with an Ant script to compile JSPs as recommended at
http://jakarta.apache.org/tomcat/tomcat-5.0-doc/jasper-howto.html
2. Write a JSP which contains erroneous text such that the first phase (JSP -&gt;
Java translation) fails e.g. by including &lt;jsp:include x="50"/&gt; in the page.
3. Compile the application using the Ant script - a Jasper exception will be
reported. This will be reported including the whole Jasper stack trace, which
makes the report unreadable. Just the error message with the location would be
sufficient.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56528</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-04-28 00:43:00 +0000</bug_when>
    <thetext>Print rootcause's stack trace only if rootcause is different from
JasperException</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56931</commentid>
    <comment_count>2</comment_count>
    <who name="Petr Jiricka">petr.jiricka</who>
    <bug_when>2004-05-06 15:25:57 +0000</bug_when>
    <thetext>Thanks, this is definitely an improvement. 

For IDE usage, it would be useful to do some additional changes to the build
error format:

Not including a link to line number in build.xml, as that is not too significant
to the developet. Instead, including the full path of the JSP which contains the
error. Also, text "org.apache.jasper.JasperException" is unnecessary. So instead of:

E:\bugs\28603_tomcat\project\build.xml:23: org.apache.jasper.JasperException:
/JSP.jsp(6,0) Include action: Mandatory attribute page missing

the output would look like:

E:\bugs\28603_tomcat\project\web\JSP.jsp [6:0] Include action: Mandatory
attribute page missing 

This would make the error format consistent with Javac. Is this possible? Thanks.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57314</commentid>
    <comment_count>3</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-05-12 22:59:34 +0000</bug_when>
    <thetext>- Include full path of the JSP that contains the error:

  Done!

- Avoid including a link to line number in build.xml:

  'ant' is adding the build.xml line number when catching the exception
  thrown by JspC.execute(). I don't think there is anything we can do to
  avoid this.

- Text "org.apache.jasper.JasperException" is unnecessary:

  The exception class name is printed by JasperException.toString(),
  which is inherited from java.lang.Throwable.toString():

    public String toString() {
        String s = getClass().getName();
        String message = getLocalizedMessage();
        return (message != null) ? (s + ": " + message) : s;
    }

  We could override JasperException.toString() to suppress the
  exception class name and just output the exception message.
  I agree the exception class name is redundant when using JspC,
  but it is useful info when compiling via the JspServlet.
  Won't be changed. :)
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57334</commentid>
    <comment_count>4</comment_count>
    <who name="Petr Jiricka">petr.jiricka</who>
    <bug_when>2004-05-13 08:36:34 +0000</bug_when>
    <thetext>Ok, this is a sufficient solution for our purposes. Thanks a lot!
</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>28610</bug_id>
          
          <creation_ts>2004-04-27 01:02:00 +0000</creation_ts>
          <short_desc>Max memory reports 0 on status page</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="David Holscher">David.Holscher</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>56445</commentid>
    <comment_count>0</comment_count>
    <who name="David Holscher">David.Holscher</who>
    <bug_when>2004-04-27 01:02:31 +0000</bug_when>
    <thetext>After a bit a digging I found that bootstrap.jar includes 
org/apache/tomcat/util/compat/JdkCompat.class but not 
org/apache/tomcat/util/compat/Jdk14Compat.class which seems to cause the 
Jdk14Compat not to be loadable even though it is in tomcat-util.jar. This 
causes the memory size to report 0 on the status page. I suspect it may cause a 
few other problems as well.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56450</commentid>
    <comment_count>1</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-04-27 05:52:46 +0000</bug_when>
    <thetext>Fixed in the CVS, and should be available in the next nightly.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>28631</bug_id>
          
          <creation_ts>2004-04-27 16:16:00 +0000</creation_ts>
          <short_desc>JAASRealm fix to permit user-specified user/group Principals</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.19</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Andrew Jaquith">arjaquith</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>1</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>56484</commentid>
    <comment_count>0</comment_count>
    <who name="Andrew Jaquith">arjaquith</who>
    <bug_when>2004-04-27 16:16:08 +0000</bug_when>
    <thetext>This bug report was previously posted to tomcat-dev as "[PATCH] JAASRealm fixes" on 24-Apr-2004.
----
These patches enable JAASRealm to work as advertised.
In particular, JAASRealm can use user-specified Principal classes
for both user Principals and group Principals, just like
the documentation says it is supposed to be able to do. In addition,
I have added support for digested passwords similar to the way the
other Realm implementations work.

I have patched three files: JAASRealm.java, JAASCallbackHandler.java,
and LocalStrings.properties. I have unquestionably fouled up
the @version Javadoc tags... one assumes the responsible parties
(surely not me!) can fix these prior to committing.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56486</commentid>
    <comment_count>1</comment_count>
      <attachid>11354</attachid>
    <who name="Andrew Jaquith">arjaquith</who>
    <bug_when>2004-04-27 16:17:27 +0000</bug_when>
    <thetext>Created attachment 11354
JAASRealm.patch</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56487</commentid>
    <comment_count>2</comment_count>
      <attachid>11355</attachid>
    <who name="Andrew Jaquith">arjaquith</who>
    <bug_when>2004-04-27 16:17:57 +0000</bug_when>
    <thetext>Created attachment 11355
JAASCallbackHandler.patch</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56488</commentid>
    <comment_count>3</comment_count>
      <attachid>11356</attachid>
    <who name="Andrew Jaquith">arjaquith</who>
    <bug_when>2004-04-27 16:18:27 +0000</bug_when>
    <thetext>Created attachment 11356
LocalStrings.patch</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56521</commentid>
    <comment_count>4</comment_count>
    <who name="Andrew Jaquith">arjaquith</who>
    <bug_when>2004-04-27 22:39:43 +0000</bug_when>
    <thetext>I should make clear that the patch files I submitted affect 5.0.19, but were diffed against those 
from CVS HEAD, on the morning of 4/14/2004. Sorry if that was not readily apparent.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58470</commentid>
    <comment_count>5</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-06-01 16:47:57 +0000</bug_when>
    <thetext>Please submit test cases for this patch if possible.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61239</commentid>
    <comment_count>6</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-07-28 15:07:35 +0000</bug_when>
    <thetext>No test cases?  This item may be closed if none are submitted.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61285</commentid>
    <comment_count>7</comment_count>
    <who name="Andrew Jaquith">arjaquith</who>
    <bug_when>2004-07-29 02:40:24 +0000</bug_when>
    <thetext>Two issues preventing me from writing test cases:

1) It isn't clear how to do that.

There isn't much documentation on how testing works; I was a but put off by that initially. After some 
investigation, I found jakarta-tomcat-catalina/tester/src/bin/tester.xml, which indeed appears to be an 
Ant file that performs out-of-container HTTP testing. So, sure, I can see how, if the container were 
configured to use my JAASRealm patch, I could re-test the authentication tests in jakarta-tomcat-
catalina/tester/src/tester/org/apache/tester/Authentication0*.java.

Sounds simple, but it all turns on the phrase "if the container were configured to use my JAASRealm 
patch." All of the tests use, by default, uses UserDatabaseRealm. How could I make Tomcat use 
JAASRealm instead? It appears that I would need to either:
- Create a custom context descriptor for the "tester" webapp that uses JAASRealm
- Edit the existing conf/server.xml file
... as well as cause the test script to bounce the server and re-load it with the new context descriptor. 
Aha. To do this, now I need to hack the tester.xml Ant script.

I have *never* written a Tomcat test case before, so this is just my best guess on what it would take. 
Am I wrong?

2) I'm not sure what it would contain. 

Remember that JAASRealm needs an implementation of a JAAS LoginModule to function. There isn't one 
supplied with Tomcat, so this means I'd need to:
- Create a dummy LoginModule that authenticates certain hard-coded users but not others (e.g., "Fred/
bedrock" but not "Barney/feet")
- Create a "sample" LoginModule that authenticates against an existing user registry, like tomcat-
users.xml. But that seems like real work to me; I might as well port MemoryRealm to JAAS while I'm at 
it. (Which is essentially what I'd be doing). 

Frankly, this seems like a lot of bother for a patch that I *know* works; is has been in production on my 
personal wiki for about three months. I can do it if you want to, as long as you accept that this means 
that there will be quite a bit of changes to certain build files, and other things.

What is the best path forward? The key issue here is lack of flexibility in the test scripts, which don't 
permit changing Realms for exercising authentication tests.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61308</commentid>
    <comment_count>8</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-07-29 13:43:55 +0000</bug_when>
    <thetext>Typical test cases submitted for Tomcat are WAR files.  They contain the code 
to be tested along with the META-INF/context.xml file which is the Context 
element with the proper declarations, e.g. for a Realm.  Don't bother using the 
Tester approach, that's wasted effort on build files.

For this case a dummy LoginModule with hard-coded user names and passwords is 
fine.  Also for this case, since the Realm has to be in a common classloader 
repository, a single WAR won't be possible, so maybe a separate JAR.

Basically, we ask for whatever you would use to unit-test your own patch.  I 
understand it works for you, and that's great, and if you don't unit-test 
that's also OK (I sometimes don't do it either, we're not perfect ;)).  But we 
do prefer to have unit tests before committing into the core Tomcat code.

I also wanted to assess your interest in this: I'm glad you responded, and 
quickly.  If I ask for tests, give it a couple of months with no response, then 
ask again and get no response within a month or so, I sometimes close the 
bugzilla issue for lack of interest.  Because you responded we can keep this 
open and resolve it.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63328</commentid>
    <comment_count>9</comment_count>
    <who name="Andrew Jaquith">arjaquith</who>
    <bug_when>2004-09-10 05:44:34 +0000</bug_when>
    <thetext>After a bit (!) of a hiatus, patches against the most recent release (5.0.28), and matching test cases, are 
progressing. I expect to have both submitted early next week.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63765</commentid>
    <comment_count>10</comment_count>
      <attachid>12761</attachid>
    <who name="Andrew Jaquith">arjaquith</who>
    <bug_when>2004-09-18 16:29:55 +0000</bug_when>
    <thetext>Created attachment 12761
Small Ant project that builds a test case WAR, dummy JAAS LoginModule JAR and associated context descriptors.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63766</commentid>
    <comment_count>11</comment_count>
      <attachid>12762</attachid>
    <who name="Andrew Jaquith">arjaquith</who>
    <bug_when>2004-09-18 16:31:33 +0000</bug_when>
    <thetext>Created attachment 12762
JAASRealm.java (whole file, not a diff)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63767</commentid>
    <comment_count>12</comment_count>
      <attachid>12763</attachid>
    <who name="Andrew Jaquith">arjaquith</who>
    <bug_when>2004-09-18 16:32:08 +0000</bug_when>
    <thetext>Created attachment 12763
JAASCallbackHandler.java (whole file; not a diff)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63768</commentid>
    <comment_count>13</comment_count>
      <attachid>12764</attachid>
    <who name="Andrew Jaquith">arjaquith</who>
    <bug_when>2004-09-18 16:32:41 +0000</bug_when>
    <thetext>Created attachment 12764
LocalStrings.properties (whole file; not a diff)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63769</commentid>
    <comment_count>14</comment_count>
      <attachid>12765</attachid>
    <who name="Andrew Jaquith">arjaquith</who>
    <bug_when>2004-09-18 16:36:41 +0000</bug_when>
    <thetext>Created attachment 12765
JAASRealm.java (patch cf. tomcat 5.028 release)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63770</commentid>
    <comment_count>15</comment_count>
      <attachid>12766</attachid>
    <who name="Andrew Jaquith">arjaquith</who>
    <bug_when>2004-09-18 16:37:18 +0000</bug_when>
    <thetext>Created attachment 12766
JAASCallbackHandler (patch cf. tomcat 5.028 release)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63771</commentid>
    <comment_count>16</comment_count>
      <attachid>12767</attachid>
    <who name="Andrew Jaquith">arjaquith</who>
    <bug_when>2004-09-18 16:37:47 +0000</bug_when>
    <thetext>Created attachment 12767
LocalStrings.properties (patch cf. tomcat 5.028 release)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63772</commentid>
    <comment_count>17</comment_count>
    <who name="Andrew Jaquith">arjaquith</who>
    <bug_when>2004-09-18 16:41:26 +0000</bug_when>
    <thetext>I've uploaded a small Ant project contains a series of test cases for the JAASRealm patches. The patches 
were made against the source tree for Tomcat 5.0.28.

First, a short explanation of what the patch itself is all about. As several observers have
noted, the current JAASRealm implementation doesn't actually deliver on all of the functionality
it promises, particularly with respect to its ability to return Principals of user-specified
types. In addition, the current implementation is limited by its inability to hash
passwords. The patch fixes both of these issues.

Files that have been modified (relative to jakarta-tomcat-catalina/catalina/src/share):
org/apache/catalina/realm/JAASRealm.java
org/apache/catalina/realm/LocalStrings.properties
org/apache/catalina/realm/JAASCallbackHandler.java

See the other attachments to this bug for the patch files, whole files, and test case tar file.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64012</commentid>
    <comment_count>18</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-21 23:31:52 +0000</bug_when>
    <thetext>Patch applied on both TOMCAT_5_0 and HEAD (Tomcat 5.5) branches.  Thanks for 
contributing.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64462</commentid>
    <comment_count>19</comment_count>
    <who name="Andrew Jaquith">arjaquith</who>
    <bug_when>2004-09-30 21:54:47 +0000</bug_when>
    <thetext>It looks like the most recent commit of JAASRealm has a slight problem in it. 

The whole-file version I submitted has these lines, starting at line 536:

            if (userPrincipal == null &amp;&amp; userClasses.contains(principalClass)) {
                userPrincipal = principal;
                if( log.isDebugEnabled() ) {
                    log.debug(sm.getString("jaasRealm.userPrincipalSuccess", principal.getName()));
                }
            }
            if (roleClasses.contains(principalClass)) {
                roles.add(principal);
                if( log.isDebugEnabled() ) {
                    log.debug(sm.getString("jaasRealm.rolePrincipalAdd", principal.getName()));
                }
            }

The current file in HEAD looks like this (also starting at 536):

            if (userPrincipal == null &amp;&amp; userClasses.contains(principalClass)) {
                userPrincipal = principal;
                if( log.isDebugEnabled() ) {
                    log.debug(sm.getString("jaasRealm.userPrincipalSuccess", principal.getName()));
                }
            }

            if (roleClasses.contains(principalClass)) {
                roles.add(principal.getName());
            }

            if (roleClasses.contains(principalClass)) {
                roles.add(principal);
                if( log.isDebugEnabled() ) {
                    log.debug(sm.getString("jaasRealm.rolePrincipalAdd", principal.getName()));
                }
            }

The middle chunk of code (3 lines) shouldn't be there. It is adding a String to what is supposed to be a 
collection of Principal objects. This is causing downstream calls to hasRole(Principal, String) to choke 
and die with a ClassCastException.

The patch file I submitted also has this middle chunk marked for removal (-), so I think this was just a 
mistake in the commit process.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64475</commentid>
    <comment_count>20</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-10-01 12:31:20 +0000</bug_when>
    <thetext>My mistake -- good catch.  Thank you for pointing it out.  I've fixed it on 
both HEAD and TOMCAT_5_0.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>11354</attachid>
            <date>2004-04-27 16:17:00 +0000</date>
            <delta_ts>2004-04-27 16:17:27 +0000</delta_ts>
            <desc>JAASRealm.patch</desc>
            <filename>JAASRealm.patch</filename>
            <type>text/plain</type>
            <size>17500</size>
            <attacher name="Andrew Jaquith">arjaquith</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>11355</attachid>
            <date>2004-04-27 16:17:00 +0000</date>
            <delta_ts>2004-04-27 16:17:57 +0000</delta_ts>
            <desc>JAASCallbackHandler.patch</desc>
            <filename>JAASCallbackHandler.patch</filename>
            <type>text/plain</type>
            <size>4887</size>
            <attacher name="Andrew Jaquith">arjaquith</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>11356</attachid>
            <date>2004-04-27 16:18:00 +0000</date>
            <delta_ts>2004-04-27 16:18:27 +0000</delta_ts>
            <desc>LocalStrings.patch</desc>
            <filename>LocalStrings.patch</filename>
            <type>text/plain</type>
            <size>2871</size>
            <attacher name="Andrew Jaquith">arjaquith</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>12761</attachid>
            <date>2004-09-18 16:29:00 +0000</date>
            <delta_ts>2004-09-18 16:29:55 +0000</delta_ts>
            <desc>Small Ant project that builds a test case WAR, dummy JAAS LoginModule JAR and associated context descriptors.</desc>
            <filename>testcases.tar.gz</filename>
            <type>application/octet-stream</type>
            <size>24146</size>
            <attacher name="Andrew Jaquith">arjaquith</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>12762</attachid>
            <date>2004-09-18 16:31:00 +0000</date>
            <delta_ts>2004-09-18 16:31:33 +0000</delta_ts>
            <desc>JAASRealm.java (whole file, not a diff)</desc>
            <filename>JAASRealm.java</filename>
            <type>text/plain</type>
            <size>22416</size>
            <attacher name="Andrew Jaquith">arjaquith</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>12763</attachid>
            <date>2004-09-18 16:32:00 +0000</date>
            <delta_ts>2004-09-18 16:32:08 +0000</delta_ts>
            <desc>JAASCallbackHandler.java (whole file; not a diff)</desc>
            <filename>JAASCallbackHandler.java</filename>
            <type>text/plain</type>
            <size>5247</size>
            <attacher name="Andrew Jaquith">arjaquith</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>12764</attachid>
            <date>2004-09-18 16:32:00 +0000</date>
            <delta_ts>2004-09-18 16:32:41 +0000</delta_ts>
            <desc>LocalStrings.properties (whole file; not a diff)</desc>
            <filename>LocalStrings.properties</filename>
            <type>text/plain</type>
            <size>4569</size>
            <attacher name="Andrew Jaquith">arjaquith</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>12765</attachid>
            <date>2004-09-18 16:36:00 +0000</date>
            <delta_ts>2004-09-18 16:36:41 +0000</delta_ts>
            <desc>JAASRealm.java (patch cf. tomcat 5.028 release)</desc>
            <filename>JAASRealm.patch</filename>
            <type>text/plain</type>
            <size>18006</size>
            <attacher name="Andrew Jaquith">arjaquith</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>12766</attachid>
            <date>2004-09-18 16:37:00 +0000</date>
            <delta_ts>2004-09-18 16:37:18 +0000</delta_ts>
            <desc>JAASCallbackHandler (patch cf. tomcat 5.028 release)</desc>
            <filename>JAASCallbackHandler.patch</filename>
            <type>text/plain</type>
            <size>4421</size>
            <attacher name="Andrew Jaquith">arjaquith</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>12767</attachid>
            <date>2004-09-18 16:37:00 +0000</date>
            <delta_ts>2004-09-18 16:37:47 +0000</delta_ts>
            <desc>LocalStrings.properties (patch cf. tomcat 5.028 release)</desc>
            <filename>LocalStrings.patch</filename>
            <type>text/plain</type>
            <size>2849</size>
            <attacher name="Andrew Jaquith">arjaquith</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>28633</bug_id>
          
          <creation_ts>2004-04-27 17:03:00 +0000</creation_ts>
          <short_desc>Add JMX Support to ClusterManager</short_desc>
          <delta_ts>2006-04-11 08:09:19 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina:Cluster</component>
          <version>5.5.12</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Filip Hanik">fhanik</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>56496</commentid>
    <comment_count>0</comment_count>
    <who name="Filip Hanik">fhanik</who>
    <bug_when>2004-04-27 17:03:03 +0000</bug_when>
    <thetext>Add this todo, since it is bug</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>82931</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2005-11-28 21:00:03 +0000</bug_when>
    <thetext>Changing to an enhancement request, and updating version to latest (5.5.12) as
it's also accurate for the latest Tomcat ;)  This issue is getting old ;)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>87766</commentid>
    <comment_count>2</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2006-04-11 15:09:19 +0000</bug_when>
    <thetext>it is done...</thetext>
  </long_desc>
      
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>28634</bug_id>
          
          <creation_ts>2004-04-27 17:04:00 +0000</creation_ts>
          <short_desc>Extend StandardManager/StandardSession for DeltaManager/DeltaSession</short_desc>
          <delta_ts>2007-01-31 07:12:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina:Cluster</component>
          <version>5.5.12</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Filip Hanik">fhanik</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>56497</commentid>
    <comment_count>0</comment_count>
    <who name="Filip Hanik">fhanik</who>
    <bug_when>2004-04-27 17:04:28 +0000</bug_when>
    <thetext>just better</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>82932</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2005-11-28 21:01:02 +0000</bug_when>
    <thetext>Changing to enhancement request and updating to latest version.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>98837</commentid>
    <comment_count>2</comment_count>
    <who name="Filip Hanik">fhanik</who>
    <bug_when>2007-01-31 07:12:46 +0000</bug_when>
    <thetext>This has been fixed in TC 6.0.x and TC 5.5.x in the "ha" module.</thetext>
  </long_desc>
      
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>28674</bug_id>
          
          <creation_ts>2004-04-28 21:48:00 +0000</creation_ts>
          <short_desc>ArrayOutBoundException in CoyoteAdapter.normalize</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:Coyote</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>0</everconfirmed>
          <reporter name="Torsten Fohrer">tfohrer</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>56581</commentid>
    <comment_count>0</comment_count>
    <who name="Torsten Fohrer">tfohrer</who>
    <bug_when>2004-04-28 21:48:34 +0000</bug_when>
    <thetext>TestCase:
  1. get tomcat 5 release -&gt; tested cvs, 5.0.19
  2. unpack and start it
  3. telnet localhost 8080
  4. enter "GET /jsp-examples/.. HTTP/1.0\n\n
  5. see exception in catalina.out/console

StackTrace:

SCHWERWIEGEND: An exception or error occurred in the container during the
request processing
java.lang.ArrayIndexOutOfBoundsException: 16
        at org.apache.coyote.tomcat5.CoyoteAdapter.normalize(CoyoteAdapter.java:560)
        at
org.apache.coyote.tomcat5.CoyoteAdapter.postParseRequest(CoyoteAdapter.java:283)
        at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:204)
        at
org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:833)
        at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:732)
        at
org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:619)
        at
org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:688)
        at java.lang.Thread.run(Thread.java:536)


Java Code from CoyoteAdapter:  

        // If the URI ends with "/." or "/..", then we append an extra "/"
        // Note: It is possible to extend the URI by 1 without any side effect
        // as the next character is a non-significant WS.
        if (((end - start) &gt; 2) &amp;&amp; (b[end - 1] == (byte) '.')) {
            if ((b[end - 2] == (byte) '/')
                || ((b[end - 2] == (byte) '.')
                    &amp;&amp; (b[end - 3] == (byte) '/'))) {
                b[end] = (byte) '/'; &lt;-- Exception occurs here b.length &lt;= end
                end++;
            }
        }</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56583</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-04-28 22:08:08 +0000</bug_when>
    <thetext>It does not always fail, so the issue is extremely minor.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>28696</bug_id>
          
          <creation_ts>2004-04-29 21:34:00 +0000</creation_ts>
          <short_desc>Jsp:root has invalid attribute: xsi:schemaLocation</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.19</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Gerald Turner">gturner</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>gturner</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>56662</commentid>
    <comment_count>0</comment_count>
    <who name="Gerald Turner">gturner</who>
    <bug_when>2004-04-29 21:34:41 +0000</bug_when>
    <thetext>It seems that Jasper is a bit strict about attributes on an XML JSP root
element.  Example JSP (same JSP causing stack trace listed below):

  &lt;?xml version="1.0" encoding="UTF-8"?&gt;
  &lt;!-- $Id$ --&gt;
  &lt;jsp:root xmlns:jsp="http://java.sun.com/JSP/Page"
            version="2.0"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation="http://java.sun.com/JSP/Page
http://java.sun.com/dtd/jspxml.xsd"&gt;
  &lt;/jsp:root&gt;

These attributes seem to be perfectly valid, page 3-17 of the JSP 2.0
specification (also in http://java.sun.com/dtd/jspxml.xsd) has this annotation
about the root element:

  &lt;xsd:element name = "root"&gt;
    &lt;xsd:annotation&gt;
      &lt;xsd:documentation&gt;
        The root element of all JSP documents is named root.
        
        Authors may, if they wish, include schema location information.
        If specified, the information may appear as attributes of
        the root element as follows:

        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://java.sun.com/JSP/Page xsd-file-location"

        Documents should not specify the system identifier of a DTD
        in a DOCTYPE declaration.
      &lt;/xsd:documentation&gt;
    &lt;/xsd:annotation&gt;
    ...

The reason I am using (or trying to use) XMLSchema-instance is that it seems to
be the only way to trigger Ant's xmlvalidate task to perform XML Schema
validation (perhaps the only way to trigger Xerces to perform Schema validation,
not just xmlvalidate).  It's probably absurd for me to think that my build
scripts will be able to validate real-world JSPs, but I'm one of those pedantic
sorts of people, I dream of the day that an IDE (emacs!) can resolve all XML
namespaces into schemas, possibly JSP tag libraries into schema-like metadata
(perhaps a plug-in for Xerces) and hack away happily without having 5 browser
tabs and 2 PDFs open jumping back and forth.


Full stack trace:

2004-04-29 13:34:36 StandardWrapperValve[jsp]: Servlet.service() for servlet jsp
threw exception
org.apache.jasper.JasperException: /index.jspx(6,96) Jsp:root has invalid
attribute: xsi:schemaLocation
	at
org.apache.jasper.compiler.DefaultErrorHandler.jspError(DefaultErrorHandler.java:83)
	at org.apache.jasper.compiler.ErrorDispatcher.dispatch(ErrorDispatcher.java:402)
	at org.apache.jasper.compiler.ErrorDispatcher.jspError(ErrorDispatcher.java:236)
	at org.apache.jasper.compiler.JspUtil.checkAttributes(JspUtil.java:348)
	at org.apache.jasper.compiler.Validator$ValidateVisitor.visit(Validator.java:432)
	at org.apache.jasper.compiler.Node$JspRoot.accept(Node.java:554)
	at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2180)
	at org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2230)
	at org.apache.jasper.compiler.Node$Visitor.visit(Node.java:2236)
	at org.apache.jasper.compiler.Node$Root.accept(Node.java:485)
	at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2180)
	at org.apache.jasper.compiler.Validator.validate(Validator.java:1518)
	at org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:247)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:456)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:439)
	at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:553)
	at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:291)
	at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:301)
	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:248)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)
	at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:284)
	at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:204)
	at
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:257)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:567)
	at
org.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:245)
	at
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:567)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:184)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:164)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:567)
	at
org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:156)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)
	at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:578)
	at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)
	at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:567)
	at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)
	at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:206)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:833)
	at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:732)
	at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:619)
	at
org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:688)
	at java.lang.Thread.run(Thread.java:534)



In case your're curious (or someone at Sun is looking), Sun has bugs with their
JSP XML Schema, first off the one they've copied into the JSP 2.0 spec is really
the 1.2 XSD.  They don't seem to have a JSP 2.0 XSD anywhere.  The 1.2 XSD is
locked into version="1.2" (very easy to change when using a Catalog and a local
copy of the XSD).  Finally a regular expression in the XSD is broken (also easy
to fix as Xerces reports it in plain english!).  Here's the output of xmlvalidate:

  [xmlvalidate] /dtd/jspxml.xsd:238:42: InvalidRegex: Pattern value
'[A-Za-z0-9_-]*/[A-Za-z0-9_-]*(;\s*(charset=)?[A-Za-z0-9_-]*)?' is not a valid
regular expression. The reported error was: ''-' is an invalid character range.
Write '\-'.'.
  [xmlvalidate] /dtd/jspxml.xsd:249:42: InvalidRegex: Pattern value
'[A-Za-z0-9_-]*/[A-Za-z0-9_-]*' is not a valid regular expression. The reported
error was: ''-' is an invalid character range. Write '\-'.'.
  [xmlvalidate]
/home/gturner/src/newedgenetworks/zhenghesrc/server/src/web/index.jspx:6:96:
cvc-complex-type.3.1: Value '2.0' of attribute 'version' of element 'jsp:root'
is not valid with respect to the corresponding attribute use. Attribute
'version' has a fixed value of '1.2'.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57260</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-05-12 01:26:00 +0000</bug_when>
    <thetext>Fixed in CVS.

BTW, can't locate the quote of the spec in page 3-17 of JSP 2.0 Final, though it
is in http://java.sun.com/dtd/jspxml.xsd.

I'll forward your comment about JSP XML schema to JSP spec leads.  Thanks.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>28709</bug_id>
          
          <creation_ts>2004-04-30 10:49:00 +0000</creation_ts>
          <short_desc>javax.servlet.http.HttpServletRequest.isRequestedSessionIdValid() returns true for an invalidated session!</short_desc>
          <delta_ts>2006-06-11 18:03:54 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.23</version>
          <rep_platform>Other</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter>blumm</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>56690</commentid>
    <comment_count>0</comment_count>
    <who name="">blumm</who>
    <bug_when>2004-04-30 10:49:59 +0000</bug_when>
    <thetext>This is the of the code sequence executed:

  javax.servlet.http.HttpServletRequestWrapper.getSession(true);
  // here, the debugger shows that the session is valid
  javax.servlet.http.HttpSession.invalidate();
  // here the debugger shows that the session has been invalidated
  javax.servlet.http.HttpServletRequestWrapper.getRequest();
  javax.servlet.http.HttpServletRequest.isRequestedSessionIdValid();
  // this call returns true, which is not expected!</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>56693</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-04-30 13:38:43 +0000</bug_when>
    <thetext>Cool, let's start.
I disagree with that, please try the latest release.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57540</commentid>
    <comment_count>2</comment_count>
      <attachid>11576</attachid>
    <who name="">blumm</who>
    <bug_when>2004-05-17 11:19:37 +0000</bug_when>
    <thetext>Created attachment 11576
Test webapplications for the reproduction of the problem described in the bug report.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57541</commentid>
    <comment_count>3</comment_count>
    <who name="">blumm</who>
    <bug_when>2004-05-17 11:40:22 +0000</bug_when>
    <thetext>I still think there is a bug in Tomcat 5.x. BTW I wrote two test
web-applications, which will reproduce the problem for you. I have attached code   
for you. Please take a look at the readme for some instructions about
installation and execution.

Here some comments about the generell idea of the test:

Servlet 1 includes Servlet2 in a cross context environment. It gets a dispatcher
by "coServletContext.getRequestDispatcher(coServletPath)".
Servlet2 gets a new session on the first request and invalidates this session by
"httpSession.invalidate()" and tests the invalidation by
"httpServletRequestWrapper.isRequestedSessionIdValid()" on the second request.
"isRequestedSessionIdValid()" returns "true" instead of "false", which is a bug
 from my point of view.

What do you think? Thank you in advance for your help.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58144</commentid>
    <comment_count>4</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-05-26 17:10:55 +0000</bug_when>
    <thetext>The Servlet Specification states (SRV.7.3) that the session is withint the 
scope of the servlet context and cannot be shared.  Accordingly I don't think 
the semantics of invalidation and the isRequestedSessionIdValid call are clear 
when doing cross-context includes.

Looking at the code, it should be fine.  From CoyoteRequest:
/**
     * Return &lt;code&gt;true&lt;/code&gt; if the session identifier included in this
     * request identifies a valid session.
     */
    public boolean isRequestedSessionIdValid() {

        if (requestedSessionId == null)
            return (false);
        if (context == null)
            return (false);
        Manager manager = context.getManager();
        if (manager == null)
            return (false);
        Session session = null;
        try {
            session = manager.findSession(requestedSessionId);
        } catch (IOException e) {
            session = null;
        }
        if ((session != null) &amp;&amp; session.isValid())
            return (true);
        else
            return (false);
    }

StandardSession#invalidate calls StandardSession#expire:
public void expire(boolean notify) {

        // Mark this session as "being expired" if needed
        if (expiring)
            return;

        synchronized (this) {

            if (manager == null)
                return;

            expiring = true;
        
            // Notify interested application event listeners
            // FIXME - Assumes we call listeners in reverse order
            Context context = (Context) manager.getContainer();
            Object listeners[] = context.getApplicationLifecycleListeners();
            if (notify &amp;&amp; (listeners != null)) {
                HttpSessionEvent event =
                    new HttpSessionEvent(getSession());
                for (int i = 0; i &lt; listeners.length; i++) {
                    int j = (listeners.length - 1) - i;
                    if (!(listeners[j] instanceof HttpSessionListener))
                        continue;
                    HttpSessionListener listener =
                        (HttpSessionListener) listeners[j];
                    try {
                        fireContainerEvent(context,
                                           "beforeSessionDestroyed",
                                           listener);
                        listener.sessionDestroyed(event);
                        fireContainerEvent(context,
                                           "afterSessionDestroyed",
                                           listener);
                    } catch (Throwable t) {
                        try {
                            fireContainerEvent(context,
                                               "afterSessionDestroyed",
                                               listener);
                        } catch (Exception e) {
                            ;
                        }
                        log(sm.getString("standardSession.sessionEvent"), t);
                    }
                }
            }
            accessCount = 0;
            setValid(false);

            // Remove this session from our manager's active sessions
            if (manager != null)
                manager.remove(this);

            // Notify interested session event listeners
            if (notify) {
                fireSessionEvent(Session.SESSION_DESTROYED_EVENT, null);
            }

            // We have completed expire of this session
            expiring = false;

            // Unbind any objects associated with this session
            String keys[] = keys();
            for (int i = 0; i &lt; keys.length; i++)
                removeAttributeInternal(keys[i], notify);

        }

    }

Because of the Manager#remove call, the findSession call in CoyoteRequest will 
return null, and the isRequestedSessionIdValid method will return false.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58842</commentid>
    <comment_count>5</comment_count>
    <who name="">blumm</who>
    <bug_when>2004-06-07 15:41:18 +0000</bug_when>
    <thetext>The excerpts from the code base look fine for me too. What makes me wonder is
that if the test-web-application uses
"coServletContext.getNamedDispatcher(coServlet)"
instead of
"coServletContext.getRequestDispatcher(coServletPath)"
then everything works as expected. I think there must be a consistent behavior.
Did you run the test code that I have provided with the attachments? Is the bug
in test code? 




 </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58849</commentid>
    <comment_count>6</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-06-07 17:02:39 +0000</bug_when>
    <thetext>The request wrapper used by the regular RD doesn't override this method (while
the named RD won't wrap).

No matter how I look at this, the answer to this issue remains the same: sorry,
but we don't care about it.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58851</commentid>
    <comment_count>7</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-06-07 17:31:49 +0000</bug_when>
    <thetext>Ok, actually, my first sentence is a problem: not wrapping for named forwards
would mean trouble with cross context and session handling. That's a separate
issue, but will explain the different session behavior in that case (you're
going to interact with the session from the first context, which is a problem).
This is the only case, because named includes will wrap.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58880</commentid>
    <comment_count>8</comment_count>
    <who name="">blumm</who>
    <bug_when>2004-06-08 16:19:53 +0000</bug_when>
    <thetext>SRV.7.3(from Version 2.4) says:
...
To illustrate this requirement with an example: if a servlet uses the
RequestDispatcher to call a servlet in another Web application, any sessions
created for and visible to the servlet being called must be different from those
visible to the calling servlet.

By the way the spec. does not distinguish at this point between a named request
dispatcher and a regular one.

What do you exactly mean by saying "you're going to interact with the session
from the first context, which is a problem" ? Does not the Spec. cover the
request wrapper in an consistent manner with SRV.7.3 ?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60802</commentid>
    <comment_count>9</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-07-19 12:32:29 +0000</bug_when>
    <thetext>The issue affecting named dispatcher has been fixed (no wrapping was done
previously, so cross context sessions couldn't be handled properly). For the
rest, we won't fix it for now.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>68131</commentid>
    <comment_count>10</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-12-08 20:02:16 +0000</bug_when>
    <thetext>Fixed by implementing
org.apache.catalina.core.ApplicationHttpRequest.isRequestedSessionIdValid() to
check the request's session id (if any) against the session manager of the
context associated with the ApplicationHttpRequest (wrapper), which may be
different from the context of the nested request (it will be different if the
request was dispatched into a foreign context).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>68132</commentid>
    <comment_count>11</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-12-08 20:02:39 +0000</bug_when>
    <thetext>Fixed by implementing
org.apache.catalina.core.ApplicationHttpRequest.isRequestedSessionIdValid() to
check the request's session id (if any) against the session manager of the
context associated with the ApplicationHttpRequest (wrapper), which may be
different from the context of the nested request (it will be different if the
request was dispatched into a foreign context).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>70118</commentid>
    <comment_count>12</comment_count>
    <who name="Peter Lynch">plynch</who>
    <bug_when>2005-01-26 20:17:40 +0000</bug_when>
    <thetext>So this is stated as fixed...

What file revision and tomcat release is the fix in?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>70233</commentid>
    <comment_count>13</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2005-01-28 20:47:09 +0000</bug_when>
    <thetext>Fix went into revision 1.22 of
jakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/core/ApplicationHttpRequest.java,
which was tagged with TOMCAT_5_5_6.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>11576</attachid>
            <date>2004-05-17 11:19:00 +0000</date>
            <delta_ts>2004-05-17 11:19:37 +0000</delta_ts>
            <desc>Test webapplications for the reproduction of the problem described in the bug report.</desc>
            <filename>bug28709.tar.gz</filename>
            <type>application/octet-stream</type>
            <size>15854</size>
            <attacher>blumm</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>28840</bug_id>
          
          <creation_ts>2004-05-08 06:54:00 +0000</creation_ts>
          <short_desc>NPE when using an Iterator for items in a JSTL forEach tag</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.0</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Michael Gratton">mike</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>57012</commentid>
    <comment_count>0</comment_count>
    <who name="Michael Gratton">mike</who>
    <bug_when>2004-05-08 06:54:21 +0000</bug_when>
    <thetext>If you specify an object that is an Iterator for the "items" attribute of a JSTL forEach tag, you get a 
NullPointerException.

The class org.apache.jasper.tagplugins.jstl.ForEach needs to have the following code inserted at line 
140

ctxt.generateJavaSource("else if (" + itemsV + " instanceof Iterator)");
ctxt.generateJavaSource(iterV + "=(Iterator)" + itemsV + ";");

(apologies for not attaching a real diff)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57117</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-05-10 17:29:48 +0000</bug_when>
    <thetext>Thanks for the patch, which I have applied.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>28852</bug_id>
          
          <creation_ts>2004-05-08 20:23:00 +0000</creation_ts>
          <short_desc>failonerror attribute on Ant tasks</short_desc>
          <delta_ts>2011-03-14 07:57:28 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.5.33</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Stephane Bailliez">sbailliez</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>devlists</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>57037</commentid>
    <comment_count>0</comment_count>
    <who name="Stephane Bailliez">sbailliez</who>
    <bug_when>2004-05-08 20:23:38 +0000</bug_when>
    <thetext>failonerror boolean attribute on manager Ant tasks would be a nice have to 
allow for more flexible operation within Ant build files.

I will attach a patch next week that also fixes unecessary CRs during response 
read/print and missing url encoding in some tasks.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57075</commentid>
    <comment_count>1</comment_count>
      <attachid>11484</attachid>
    <who name="Stephane Bailliez">sbailliez</who>
    <bug_when>2004-05-10 11:53:49 +0000</bug_when>
    <thetext>Created attachment 11484
failonerror attribute</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57076</commentid>
    <comment_count>2</comment_count>
    <who name="Stephane Bailliez">sbailliez</who>
    <bug_when>2004-05-10 11:56:15 +0000</bug_when>
    <thetext>The patch also includes a small refactoring of the validation inside a validate
() method, read/display response correctly (previous CRs problems) and add url 
encoding where it was not existing.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>142718</commentid>
    <comment_count>3</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2010-12-14 19:37:40 +0000</bug_when>
    <thetext>*** Bug 10225 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>144613</commentid>
    <comment_count>4</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2011-02-28 13:21:19 +0000</bug_when>
    <thetext>failonerror support and the CR issue had already been fixed.
I have added the URL encoding where it was missing.

This has been fixed in 7.0.x for 7.0.10 onwards and has been proposed for 6.0.x and 5.5.x.

Changing the version to 5.5.x since that is the earliest supported version affected by this issue.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>144912</commentid>
    <comment_count>5</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2011-03-10 08:58:12 +0000</bug_when>
    <thetext>Fixed in 6.0.x and will be included in 6.0.33 onwards.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>144987</commentid>
    <comment_count>6</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2011-03-14 07:57:28 +0000</bug_when>
    <thetext>Fixed in 5.5.x and will be included in 5.5.34 onwards.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>11484</attachid>
            <date>2004-05-10 11:53:00 +0000</date>
            <delta_ts>2004-05-10 11:53:49 +0000</delta_ts>
            <desc>failonerror attribute</desc>
            <filename>patch.txt</filename>
            <type>text/plain</type>
            <size>15438</size>
            <attacher name="Stephane Bailliez">sbailliez</attacher>
            

          </attachment>
      

    <bug_classification class="BUILD_SYSTEM">BUILD_SYSTEM</bug_classification></bug>
    <bug>
          <bug_id>28875</bug_id>
          
          <creation_ts>2004-05-10 15:25:00 +0000</creation_ts>
          <short_desc>Multi-byte characters in default error page aren't printed out correctly.</short_desc>
          <delta_ts>2006-06-11 18:03:57 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P1</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Kan Ogawa">super-creek</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>bien</cc>
    
    <cc>super-creek</cc>
          <votes>12</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>57101</commentid>
    <comment_count>0</comment_count>
    <who name="Kan Ogawa">super-creek</who>
    <bug_when>2004-05-10 15:25:18 +0000</bug_when>
    <thetext>Hi, 

When working the latest Tomcat 5, any multi-byte characters in the default 
error page using ErrorReportValve are not printed out correctly.

As a result of detail investigation, I found that an error report had 
been written to the writer of response which didn't applied the 
suitable character encoding in ErrorReportValve.

So, I suggest a solution to ensure that every multi-byte character 
is normally printed out in this page, and send the following patch. 


Index: jakarta-tomcat-
catalina/catalina/src/share/org/apache/catalina/valves/ErrorReportValve.java
===================================================================
RCS file: /home/cvspublic/jakarta-tomcat-
catalina/catalina/src/share/org/apache/catalina/valves/ErrorReportValve.java,v
retrieving revision 1.16
diff -u -w -r1.16 ErrorReportValve.java
--- jakarta-tomcat-
catalina/catalina/src/share/org/apache/catalina/valves/ErrorReportValve.java
	8 May 2004 22:33:22 -0000	1.16
+++ jakarta-tomcat-
catalina/catalina/src/share/org/apache/catalina/valves/ErrorReportValve.java
	10 May 2004 10:40:52 -0000
@@ -308,19 +308,16 @@
 
         try {
 
-            Writer writer = response.getReporter();
-
-            if (writer != null) {
-
-                Locale locale = Locale.getDefault();
-
                 try {
-                    hres.setContentType("text/html");
-                    hres.setLocale(locale);
+                hres.setContentType("text/html; charset=utf-8");
                 } catch (Throwable t) {
                     if (debug &gt;= 1)
                         log("status.setContentType", t);
                 }
+
+            Writer writer = response.getReporter();
+
+            if (writer != null) {
 
                 // If writer is null, it's an indication that the response has
                 // been hard committed already, which should never happen


I hope that this patch will be applied before next release.

Regards,</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57104</commentid>
    <comment_count>1</comment_count>
      <attachid>11496</attachid>
    <who name="Kan Ogawa">super-creek</who>
    <bug_when>2004-05-10 15:29:08 +0000</bug_when>
    <thetext>Created attachment 11496
The proposed patch to fix this bug in ErrorReportValve.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57106</commentid>
    <comment_count>2</comment_count>
      <attachid>11497</attachid>
    <who name="Kan Ogawa">super-creek</who>
    <bug_when>2004-05-10 15:34:53 +0000</bug_when>
    <thetext>Created attachment 11497
The ErrorReportValve class file that applied the patch.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57132</commentid>
    <comment_count>3</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-05-10 19:38:20 +0000</bug_when>
    <thetext>Kan,

I thought revision 1.11 of CoyoteResponse.java already fixed this issue.

CVS log:

revision 1.11
date: 2004/01/20 19:39:00;  author: luehe;  state: Exp;  lines: +8 -5
Fix for Bugtraq 4655010: Method sendError() of class HttpServletResponse
                         does not send multi byte data

Use response encoding when generating error report, so that the following
code works as expected:

      response.setCharacterEncoding(&lt;charset&gt;);
      response.sendError(&lt;errorCode&gt;, &lt;message&gt;);


Here are the diffs for that revision:

Index: CoyoteResponse.java
===================================================================
RCS file:
/home/cvs/jakarta-tomcat-catalina/catalina/src/share/org/apache/coyote/tomcat5/CoyoteResponse.java,v
retrieving revision 1.10
retrieving revision 1.11
diff -u -r1.10 -r1.11
--- CoyoteResponse.java 15 Oct 2003 18:47:49 -0000      1.10
+++ CoyoteResponse.java 20 Jan 2004 19:39:00 -0000      1.11
@@ -1,7 +1,7 @@
 /*
- * $Header:
/home/cvs/jakarta-tomcat-catalina/catalina/src/share/org/apache/coyote/tomcat5/CoyoteResponse.java,v
1.10 2003/10/15 18:47:49 jfarcand Exp $
- * $Revision: 1.10 $
- * $Date: 2003/10/15 18:47:49 $
+ * $Header:
/home/cvs/jakarta-tomcat-catalina/catalina/src/share/org/apache/coyote/tomcat5/CoyoteResponse.java,v
1.11 2004/01/20 19:39:00 luehe Exp $
+ * $Revision: 1.11 $
+ * $Date: 2004/01/20 19:39:00 $
  *
  * ====================================================================
  *
@@ -107,7 +107,7 @@
  *
  * @author Remy Maucherat
  * @author Craig R. McClanahan
- * @version $Revision: 1.10 $ $Date: 2003/10/15 18:47:49 $
+ * @version $Revision: 1.11 $ $Date: 2004/01/20 19:39:00 $
  */
 
 public class CoyoteResponse
@@ -529,9 +529,12 @@
      * unexpected exception thrown during the servlet processing
      * (and only in that case), null will be returned if the response stream
      * has already been used.
+     *
+     * @exception IOException if an input/output error occurs
      */
-    public PrintWriter getReporter() {
+    public PrintWriter getReporter() throws IOException {
         if (outputBuffer.isNew()) {
+            outputBuffer.checkConverter();
             return writer;
         } else {
             return null;


Do you have any test case to prove that this is still an issue? If so, please
attach.

Thanks,

Jan</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57139</commentid>
    <comment_count>4</comment_count>
    <who name="Kan Ogawa">super-creek</who>
    <bug_when>2004-05-11 01:22:32 +0000</bug_when>
    <thetext>Jan,

I attach screenshot of a test case that returns HTTP 404 status simply.
Until my first proposed patch is applied, this issue always occurs.


Regards,
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57140</commentid>
    <comment_count>5</comment_count>
      <attachid>11507</attachid>
    <who name="Kan Ogawa">super-creek</who>
    <bug_when>2004-05-11 01:31:54 +0000</bug_when>
    <thetext>Created attachment 11507
A test case that returns HTTP 404 status simply, without the first patch.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57141</commentid>
    <comment_count>6</comment_count>
      <attachid>11508</attachid>
    <who name="Kan Ogawa">super-creek</who>
    <bug_when>2004-05-11 01:34:57 +0000</bug_when>
    <thetext>Created attachment 11508
A test case that returns HTTP 404 status simply, with the first patch.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60852</commentid>
    <comment_count>7</comment_count>
    <who name="Kan Ogawa">super-creek</who>
    <bug_when>2004-07-20 07:38:02 +0000</bug_when>
    <thetext>This problem isn't yet solved in Tomcat 5.0.27 release.

It doesn't occur in 4.1.30 release, but always happens in 5.0.x release.
Any multi-byte character is not correctly printed into response reporter, 
independently of the response locale setting.

Therefore, it is impossible to read every multi-byte error messages which is 
displayed in default error page.
(And many Japanese users are in trouble very much.)

According to current ErrorReportValve source code, I have re-written my first 
proposed patch (see the following diff code).
Please apply it.

Index: jakarta-tomcat-
catalina/catalina/src/share/org/apache/catalina/valves/ErrorReportValve.java
===================================================================
RCS file: /home/cvspublic/jakarta-tomcat-
catalina/catalina/src/share/org/apache/catalina/valves/ErrorReportValve.java,v
retrieving revision 1.21
diff -u -w -r1.21 ErrorReportValve.java
--- jakarta-tomcat-
catalina/catalina/src/share/org/apache/catalina/valves/ErrorReportValve.java
	27 Jun 2004 23:56:23 -0000	1.21
+++ jakarta-tomcat-
catalina/catalina/src/share/org/apache/catalina/valves/ErrorReportValve.java
	17 Jul 2004 20:59:20 -0000
@@ -284,19 +284,17 @@
 
         try {
 
-            Writer writer = response.getReporter();
-
-            if (writer != null) {
-
-                Locale locale = Locale.getDefault();
-
                 try {
                 	response.setContentType("text/html");
-                	response.setLocale(locale);
+                response.setCharacterEncoding("utf-8");
                 } catch (Throwable t) {
                     if (container.getLogger().isDebugEnabled())
                         container.getLogger().debug("status.setContentType", 
t);
                 }
+
+            Writer writer = response.getReporter();
+
+            if (writer != null) {
 
                 // If writer is null, it's an indication that the response has
                 // been hard committed already, which should never happen
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60899</commentid>
    <comment_count>8</comment_count>
      <attachid>12178</attachid>
    <who name="Kan Ogawa">super-creek</who>
    <bug_when>2004-07-21 04:31:23 +0000</bug_when>
    <thetext>Created attachment 12178
The re-written patch to fix this problem in ErrorReportValve.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60910</commentid>
    <comment_count>9</comment_count>
    <who name="Moriyoshi Koizumi">moriyoshi</who>
    <bug_when>2004-07-21 16:19:19 +0000</bug_when>
    <thetext>I haven't been looking into this problem much and maybe I'm wrong somewhat.

Regarding the latest patch, I'm wondering if there is any reason to drop setLocale()
from that portion.

Invocation of either setCharacterEncoding() or setContentType() that precedes setLocale()
seems to prevent setLocale() from changing the character encoding for the request.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61212</commentid>
    <comment_count>10</comment_count>
    <who name="Kan Ogawa">super-creek</who>
    <bug_when>2004-07-28 05:18:07 +0000</bug_when>
    <thetext>Thanks, Moriyoshi.

Pondering carefully, the root cause is only that response.getReporter() 
method has been invoked before content type and locale setter methods of 
response are called.
Once the response.getReporter() method is invoked, the setLocale() method and 
the setCharacterEncoding() method of the response will process nothing.

Therefore, I think that so far my submitted patches are basically no wrong.
When the response.getReporter() method is invoked after setting content type 
and 
appropriate character encoding into this response, this issue surely will be 
solved.


Regards,

Kan Ogawa</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61236</commentid>
    <comment_count>11</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-07-28 15:02:08 +0000</bug_when>
    <thetext>I've applied the re-written patch.  I think it looks OK, but I haven't re-built 
and re-run your test cases yet.  If you could do that when you get a chance, 
that'd be great.  Thanks for contributing the patch.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61353</commentid>
    <comment_count>12</comment_count>
    <who name="Kan Ogawa">super-creek</who>
    <bug_when>2004-07-30 02:24:01 +0000</bug_when>
    <thetext>Yoav, 

I downloaded Tomcat 5 nightly distribution (2004-07-28 Build), and have proved 
that this problem was fixed in Japanese language environment.

Thanks,
Kan Ogawa</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61709</commentid>
    <comment_count>13</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-08-09 12:57:34 +0000</bug_when>
    <thetext>Good, thanks for checking.  I'm verifying this issue.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62642</commentid>
    <comment_count>14</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-08-28 13:00:30 +0000</bug_when>
    <thetext>*** Bug 30691 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>11496</attachid>
            <date>2004-05-10 15:29:00 +0000</date>
            <delta_ts>2004-05-10 15:29:08 +0000</delta_ts>
            <desc>The proposed patch to fix this bug in ErrorReportValve.</desc>
            <filename>ErrorReportValve.patch</filename>
            <type>text/plain</type>
            <size>1384</size>
            <attacher name="Kan Ogawa">super-creek</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>11497</attachid>
            <date>2004-05-10 15:34:00 +0000</date>
            <delta_ts>2004-05-10 15:34:53 +0000</delta_ts>
            <desc>The ErrorReportValve class file that applied the patch.</desc>
            <filename>ErrorReportValve.class</filename>
            <type>application/octet-stream</type>
            <size>7888</size>
            <attacher name="Kan Ogawa">super-creek</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>11507</attachid>
            <date>2004-05-11 01:31:00 +0000</date>
            <delta_ts>2004-05-11 01:31:54 +0000</delta_ts>
            <desc>A test case that returns HTTP 404 status simply, without the first patch.</desc>
            <filename>ErrorReportValve-TestCase-without-Patch.jpg</filename>
            <type>image/jpeg</type>
            <size>81205</size>
            <attacher name="Kan Ogawa">super-creek</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>11508</attachid>
            <date>2004-05-11 01:34:00 +0000</date>
            <delta_ts>2004-05-11 01:34:57 +0000</delta_ts>
            <desc>A test case that returns HTTP 404 status simply, with the first patch.</desc>
            <filename>ErrorReportValve-TestCase-with-Patch.jpg</filename>
            <type>image/jpeg</type>
            <size>81591</size>
            <attacher name="Kan Ogawa">super-creek</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>12178</attachid>
            <date>2004-07-21 04:31:00 +0000</date>
            <delta_ts>2004-07-21 04:31:23 +0000</delta_ts>
            <desc>The re-written patch to fix this problem in ErrorReportValve.</desc>
            <filename>ErrorReportValve.patch</filename>
            <type>text/plain</type>
            <size>1464</size>
            <attacher name="Kan Ogawa">super-creek</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>28905</bug_id>
          
          <creation_ts>2004-05-11 17:26:00 +0000</creation_ts>
          <short_desc>ChannelSocket fills stdout log with "connection timeout reached"</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:AJP</component>
          <version>5.0.24</version>
          <rep_platform>Sun</rep_platform>
          <op_sys>Solaris</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="George Lindholm">George.Lindholm</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>57210</commentid>
    <comment_count>0</comment_count>
    <who name="George Lindholm">George.Lindholm</who>
    <bug_when>2004-05-11 17:26:55 +0000</bug_when>
    <thetext>My stdout log file keeps filling up with:

May 11, 2004 5:33:21 AM org.apache.jk.common.ChannelSocket processConnection
INFO: connection timeout reached

They may be useful while debugging, but in a production environment these
messages just hide real problems logged to stdout.

Apache 2.0.49.

   George</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57212</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-05-11 17:51:36 +0000</bug_when>
    <thetext>I think the answer is that you should upgrade to a very new JK, which includes
keepalive support. I think the report will be invalid as soon as JK 1.2.6 is out.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57232</commentid>
    <comment_count>2</comment_count>
    <who name="George Lindholm">George.Lindholm</who>
    <bug_when>2004-05-11 21:57:30 +0000</bug_when>
    <thetext>I'm using 1.4.2_04.


The problem is actually caused by the connectionTimeout value set in
the Connector definition (not quite intuative, but that's what debuggers
are there for).

I'm setting it to connectionTimeout="0"</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>28910</bug_id>
          
          <creation_ts>2004-05-11 18:51:00 +0000</creation_ts>
          <short_desc>RUNNING.txt has wrong info for admin.xml and manager.xml (documentation)</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Documentation</component>
          <version>5.0.19</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>http://cvs.apache.org/viewcvs.cgi/jakarta-tomcat-5/RUNNING.txt?view=markup</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Stefan Lasiewski">flarg</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>57220</commentid>
    <comment_count>0</comment_count>
    <who name="Stefan Lasiewski">flarg</who>
    <bug_when>2004-05-11 18:51:16 +0000</bug_when>
    <thetext>$CATALINA_HOME/RUNNING.txt contains the following text:

"The administration and manager web applications, which are defined in the
$CATALINA_BASE/webapps/admin.xml and $CATALINA_BASE/webapps/manager.xml files"

"- Both web applications are disabled by removing
$CATALINA_BASE/webapps/admin.xml and $CATALINA_BASE/webapps/manager.xml"

The problem:

manager.xml and admin.xml do not actually live under either of those directories.

Instead, they live in these directories:

% find $CATALINA_HOME -follow -name manager.xml -o -name admin.xml
/devel/tomcat/conf/Catalina/localhost/admin.xml
/devel/tomcat/conf/Catalina/localhost/manager.xml
/devel/tomcat/server/webapps/admin/admin.xml
/devel/tomcat/server/webapps/manager/manager.xml</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57222</commentid>
    <comment_count>1</comment_count>
    <who name="Stefan Lasiewski">flarg</who>
    <bug_when>2004-05-11 18:58:24 +0000</bug_when>
    <thetext>(adding a link to the document
http://cvs.apache.org/viewcvs.cgi/jakarta-tomcat-5/RUNNING.txt?view=markup)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57241</commentid>
    <comment_count>2</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2004-05-11 23:46:54 +0000</bug_when>
    <thetext>Fixed. Thanks</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>28914</bug_id>
          
          <creation_ts>2004-05-11 21:10:00 +0000</creation_ts>
          <short_desc>add a thread pool property to set thread priority for tuning quality of service</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.27</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="quartz">quartz12h</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>1</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>57230</commentid>
    <comment_count>0</comment_count>
    <who name="quartz">quartz12h</who>
    <bug_when>2004-05-11 21:10:15 +0000</bug_when>
    <thetext>it is not possible to tune quality of http services (responsiveness)
through thread priority.
other threads in the web app are of various priority than the http connector and
we want the connector to be of a higher/lower priority.

1-
add connector thread pool property to server.xml to set initial thread priority.

2-
additionnally, we would like a tomcat public API (perfectly knowing that it is
not jsdk2.x), maybe jmx but that overkill, to vary connector's thread pool
threads priorities according to application specific knowledge.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57231</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-05-11 21:26:29 +0000</bug_when>
    <thetext>Quite frankly, thread priority is a big lie (at least from Java). Look at the
javadocs.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57261</commentid>
    <comment_count>2</comment_count>
    <who name="quartz">quartz12h</who>
    <bug_when>2004-05-12 02:20:58 +0000</bug_when>
    <thetext>Euh.. No. Sorry.
(suns statements in javadoc about thread are known to be very forgiving for JVM
implementors. Most if not all serious jvm have correct priorities.)

There are plenty of JVMs out there that do correctly implements priority.
And thrust me, it works. Here are some examples.
Please verify by yourself.

-screen updater toggles back and forth between prio 4 and 6. It help propmptness
of drawing.

-finalizer has low prio, for obvious reason. It does run seldomly, as expected
in idle times.

-SEDA architecture like sandstorm works great!
I myself created a seda thread manager based on priority and load detection. It
runs very nicely on sun, ibm, jrockit JVM, on both win32 and linux platform.

Besides, I raise the tomcat connector threads in a dirty way: enumerate thread,
match name with regex, and raise prio to 7 (because I use prio 1 to 6 for
sandstorm).

Trust me, it really balances stage &amp; queue load and work well. And with that
tomcat prio raised, my web UI is responsive and I keep the control.

In other systems, with jmx timer and with container sheduling
JSR 236 titled "Timer for Application Servers"
http://jcp.org/en/jsr/detail?id=236
thread priority will become a serious concern.

Please consider this RFE with "normal priority" (hehehe!)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58220</commentid>
    <comment_count>3</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-05-27 16:15:55 +0000</bug_when>
    <thetext>Done.  Need minor help from Amy Roh or another admin webapp expert on the 
writing of modified configuration, will post on tomcat-dev, but the code is 
there and seems to be working.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59601</commentid>
    <comment_count>4</comment_count>
    <who name="quartz">quartz12h</who>
    <bug_when>2004-06-19 16:58:55 +0000</bug_when>
    <thetext>for cross-ref purpose: see bug #27616
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62085</commentid>
    <comment_count>5</comment_count>
    <who name="quartz">quartz12h</who>
    <bug_when>2004-08-17 19:07:45 +0000</bug_when>
    <thetext>Priority not applied.

Run tomcat in a debugger, like eclipse, pause processors/monitors threads,
look at first stackframe (thread run()), the variable 'this' (the thread).
look at the priority field: still = 5 (normal prio) instead of prescribed value.

Expected to see the monitor thread and the processors threads at priority 8 in
the case below.

	&lt;Connector
		port="1026"
		maxThreads="15"
		minSpareThreads="2"
		maxSpareThreads="5"
		enableLookups="false" 
		acceptCount="100"
		debug="1"
		connectionTimeout="20000"
		disableUploadTimeout="true"
		threadPriority="8"
		redirectPort="18443"
	/&gt;


Thr: d P=05 ALIVE  "http-1026-Processor1" 
(org.apache.tomcat.util.threads.ThreadWithAttributes)

Thr: d P=05 ALIVE  "http-1026-Processor2" 
(org.apache.tomcat.util.threads.ThreadWithAttributes)

Thr:   P=05 ALIVE  "http-1026-Monitor"</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62086</commentid>
    <comment_count>6</comment_count>
    <who name="quartz">quartz12h</who>
    <bug_when>2004-08-17 19:08:08 +0000</bug_when>
    <thetext>against 5.0.27
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62798</commentid>
    <comment_count>7</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-08-30 19:26:14 +0000</bug_when>
    <thetext>Ooops, I forgot the actual Thread#setPriority call.  Sorry about that ;)  Fixed 
in both TOMCAT_5_0 and CVS HEAD branches.</thetext>
  </long_desc>
      
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>28937</bug_id>
          
          <creation_ts>2004-05-12 23:30:00 +0000</creation_ts>
          <short_desc>No error message for jsp.variable.alias</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Mark Roth">mark.roth</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>57315</commentid>
    <comment_count>0</comment_count>
    <who name="Mark Roth">mark.roth</who>
    <bug_when>2004-05-12 23:30:26 +0000</bug_when>
    <thetext>Missing error message for omitting the required alias attribute when specifying
a variable directive in a tag file when name-from-attribute is specified.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57316</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-05-13 00:03:05 +0000</bug_when>
    <thetext>Fixed by replacing "jsp.variable.alias" with "jsp.error.variable.alias", for
which an error message exists.

Same for "jsp.variable.either.name" and "jsp.variable.both.name", which have
been changed to "jsp.error.variable.either.name" and
"jsp.error.variable.both.name", respectively.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>28940</bug_id>
          
          <creation_ts>2004-05-13 03:00:00 +0000</creation_ts>
          <short_desc>Deployer can't treat multi-byte characters in JSP correctly</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.0.24</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Masashi Yamaguchi">yamagu</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>57321</commentid>
    <comment_count>0</comment_count>
    <who name="Masashi Yamaguchi">yamagu</who>
    <bug_when>2004-05-13 03:00:49 +0000</bug_when>
    <thetext>When jakarta-tomcat-5.0.24-deployer compiles web application,
any multi-byte characters in JSP are not printed out correctly.

Java-source produced by jasper2-task is written in "UTF-8" encoding,
so javac-task requires 'encoding="UTF-8"' attribute.

$ diff -u -w build.xml.org build.xml
--- build.xml.org       2004-05-13 10:59:32.510158400 +0900
+++ build.xml   2004-05-13 11:00:21.580718400 +0900
@@ -53,6 +53,7 @@
            optimize="off"
            debug="on" failonerror="false"
            srcdir="${webapp.path}/WEB-INF/classes"
+           encoding="UTF-8"
           excludes="**/*.smap"&gt;
       &lt;classpath&gt;
         &lt;fileset dir="${webapp.path}/WEB-INF/lib"&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58261</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-05-27 23:44:05 +0000</bug_when>
    <thetext>Please tell me which build.xml file you're referring to, and redo the diff, as 
I don't see similar code the those line numbers.  Thanks.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58270</commentid>
    <comment_count>2</comment_count>
    <who name="Masashi Yamaguchi">yamagu</who>
    <bug_when>2004-05-28 00:29:59 +0000</bug_when>
    <thetext>I'm sorry.
That build.xml is "jakarta-tomcat-5/resources/deployer/build.xml" 1.4 in CVS.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58495</commentid>
    <comment_count>3</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-06-01 19:23:50 +0000</bug_when>
    <thetext>OK, fixed.  Thank you for reporting this issue.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>28943</bug_id>
          
          <creation_ts>2004-05-13 07:03:00 +0000</creation_ts>
          <short_desc>Wrong command (cd CURRENT_DIR) in startup.bat and catalina.bat</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.0.24</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Thai Ha">thaiha</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>davidd</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>57329</commentid>
    <comment_count>0</comment_count>
    <who name="Thai Ha">thaiha</who>
    <bug_when>2004-05-13 07:03:36 +0000</bug_when>
    <thetext>Adter unzipping jakarta-tomcat-5.0.24, I tried to run by clicking on 
startup.bat from a command prompt window. A new window was opened and Tomcat 
ran OK in that window. But in the first window, I see these lines:

----------------
D:\programs\jakarta-tomcat-5.0.24\bin&gt;startup
The system cannot find the path specified.
Using CATALINA_BASE:   D:\programs\jakarta-tomcat-5.0.24
Using CATALINA_HOME:   D:\programs\jakarta-tomcat-5.0.24
Using CATALINA_TMPDIR: D:\programs\jakarta-tomcat-5.0.24\temp
Using JAVA_HOME:       D:\programs\j2sdk1.4.2
D:\programs\jakarta-tomcat-5.0.24\bin&gt;
-----------------

And I found the error is because the below command in in startup.bat(16):
cd CURRENT_DIR

I also see there is another "cd CURRENT_DIR" in catalina.bat(46). I guess this 
is also wrong.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57663</commentid>
    <comment_count>1</comment_count>
      <attachid>11599</attachid>
    <who name="Rob Cranfill">robcranfill</who>
    <bug_when>2004-05-19 18:40:25 +0000</bug_when>
    <thetext>Created attachment 11599
Modified startup.bat showing solution: "cd %CURRENT_DIR%"</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58164</commentid>
    <comment_count>2</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-05-26 20:03:32 +0000</bug_when>
    <thetext>*** Bug 29111 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58165</commentid>
    <comment_count>3</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-05-26 20:05:12 +0000</bug_when>
    <thetext>Patch applied as suggested: thanks.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>11599</attachid>
            <date>2004-05-19 18:40:00 +0000</date>
            <delta_ts>2004-05-19 18:40:25 +0000</delta_ts>
            <desc>Modified startup.bat showing solution: "cd %CURRENT_DIR%"</desc>
            <filename>startup.bat</filename>
            <type>text/plain</type>
            <size>1283</size>
            <attacher name="Rob Cranfill">robcranfill</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>28959</bug_id>
          
          <creation_ts>2004-05-13 17:57:00 +0000</creation_ts>
          <short_desc>IOException using CoyoteReader.readLine() but not using .read()</short_desc>
          <delta_ts>2004-11-16 19:05:41 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:Coyote</component>
          <version>5.0.24</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="jim hopp">jim</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>57370</commentid>
    <comment_count>0</comment_count>
    <who name="jim hopp">jim</who>
    <bug_when>2004-05-13 17:57:35 +0000</bug_when>
    <thetext>I get IOExceptions when I use CoyoteReader.readLine to read the request's 
input if the request has many lines to it.  If I read the request using 
CoyoteReader.read(), it works fine.  The stack trace (from my bug test code) 
is below.  I'll attach a war file that demonstrates the bug, as well as source 
code.

I originally discovered this under 5.0.19, but thought it was caused by bug 
#27447.  That bug was reported fixed in 5.0.20, but that fix did not fix this 
problem.

2004-05-13 10:30:15 StandardWrapperValve[bugTest]: Servlet.service() for 
servlet bugTest threw exception
java.io.IOException
	at org.apache.coyote.tomcat5.InputBuffer.reset(InputBuffer.java:440)
	at org.apache.coyote.tomcat5.CoyoteReader.reset(CoyoteReader.java:121)
	at org.apache.coyote.tomcat5.CoyoteReader.readLine
(CoyoteReader.java:178)
	at jimpkg.BugTest.doPost(BugTest.java:45)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:717)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57372</commentid>
    <comment_count>1</comment_count>
    <who name="jim hopp">jim</who>
    <bug_when>2004-05-13 18:13:21 +0000</bug_when>
    <thetext>I seem to be having trouble uploading attachments, so I've posted the war file 
and the zip file at:
http://www.netyourwork.com/download/bugtest.war
and
http://www.netyourwork.com/download/tomcat-5.0.24-bugtest.zip

I'll try again to attach them later.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57392</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-05-14 07:32:59 +0000</bug_when>
    <thetext>Please also submit the client code to reproduce the problem, as this works for
me right now.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57421</commentid>
    <comment_count>3</comment_count>
    <who name="jim hopp">jim</who>
    <bug_when>2004-05-14 15:56:42 +0000</bug_when>
    <thetext>I'm not sure what you mean by "submit the client code to reproduce the problem"
- both the war file and the zip file include /bugtest.html, which is the browser
page that explains how to reproduce the bug and has a form that invokes the
first servlet.  The zip file also includes the source code for the two servlets.
 To invoke the page on my default install of Tomcat, I use
http://localhost:8080/bugtest/bugtest.html.

I've tried several times to attach the zip file and the war file to this bug
report, but with no success.  Perhaps because I'm behind a firewall and a router
using NAT?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57423</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-05-14 16:08:08 +0000</bug_when>
    <thetext>I need some data you send to the servlet, as well as how you send it (= the
cleint code). I didn't look at bugtest.html (the servlet code seemed obvious,
you could have done while(r.readLine() != null)), and it does look enough. I'll
try it. It would have been more reliable using a custom program, of course.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57425</commentid>
    <comment_count>5</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-05-14 16:31:15 +0000</bug_when>
    <thetext>I'm unable to have bugreport.html work, right now (it doesn't seem to generate
anything).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57426</commentid>
    <comment_count>6</comment_count>
    <who name="jim hopp">jim</who>
    <bug_when>2004-05-14 16:38:40 +0000</bug_when>
    <thetext>The html page was just to enable me to quickly try different combinations of
line length and number of lines, since some combinations worked and some did
not.  If after trying the html you still can't reproduce it, I'll write a little
java program that tries the various combinations.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57428</commentid>
    <comment_count>7</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-05-14 16:47:07 +0000</bug_when>
    <thetext>I'm ok with using your html file, but right now it doesn't work for me. For
example, it accesses the BugTest1 servlet (which I think should work), and it
also seems to send empty lines.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57431</commentid>
    <comment_count>8</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-05-14 17:05:13 +0000</bug_when>
    <thetext>Ok, I got the thing to work. It seems like this doesn't work with Mozilla.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57446</commentid>
    <comment_count>9</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-05-14 21:17:52 +0000</bug_when>
    <thetext>.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57447</commentid>
    <comment_count>10</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-05-14 21:19:37 +0000</bug_when>
    <thetext>The test worked ok on IE, and the issue is now fixed.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>28971</bug_id>
          
          <creation_ts>2004-05-14 09:33:00 +0000</creation_ts>
          <short_desc>problems if root-context and application-context sets cookies</short_desc>
          <delta_ts>2004-11-16 19:05:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.24</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Mario Ivankovits">mario</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>57393</commentid>
    <comment_count>0</comment_count>
    <who name="Mario Ivankovits">mario</who>
    <bug_when>2004-05-14 09:33:15 +0000</bug_when>
    <thetext>I am not sure if this is a new bug (i have used tomcat4 for now and the .24
release is my first try to move to tomcat5).

Tomcat (now) sets two cookies - one for the root-context and one for the
application context - say (/opsjs).

Now on every request two cookies are sent to tomcat - one session-id for the
root context and one for the application-context. But it looks like tomcat cant
handle this case - maybe only the first cookie is processed and this do not
match to the cookie-list for the application-context (just an idea) - so a new
session is started and a new cookie sent to the browser.

I have had to disable the cookies on the root context.
&lt;Context path="" docBase="ROOT" debug="0" cookies="false"/&gt; 

Then the application works like expected - only one cookie is sent.

The definition of the application context is:
&lt;Context path="/opsjs"
        docBase="/u/opsj"
        crossContext="false"
        debug="0"
        reloadable="false"
        trusted="false" &gt;
...

Since another user experienced the same problem i decided to enter this (new)
behaviour as critical.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57402</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-05-14 11:20:41 +0000</bug_when>
    <thetext>This is now fixed.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57403</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-05-14 11:22:28 +0000</bug_when>
    <thetext>  Index: CoyoteAdapter.java
  ===================================================================
  RCS file:
/home/cvs/jakarta-tomcat-catalina/catalina/src/share/org/apache/coyote/tomcat5/CoyoteAdapter.java,v
  retrieving revision 1.25
  retrieving revision 1.26
  diff -u -r1.25 -r1.26
  --- CoyoteAdapter.java	28 Apr 2004 22:05:10 -0000	1.25
  +++ CoyoteAdapter.java	14 May 2004 11:00:25 -0000	1.26
  @@ -295,6 +295,9 @@
               return false;
           }
   
  +        // Parse session Id
  +        parseSessionCookiesId(req, request);
  +
           return true;
       }
   
  @@ -352,6 +355,14 @@
               request.setRequestedSessionId(null);
               request.setRequestedSessionURL(false);
           }
  +
  +    }
  +
  +
  +    /**
  +     * Parse session id in URL.
  +     */
  +    protected void parseSessionCookiesId(Request req, CoyoteRequest request) {
   
           // Parse session id from cookies
           Cookies serverCookies = req.getCookies();
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57415</commentid>
    <comment_count>3</comment_count>
      <attachid>11548</attachid>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-05-14 14:43:28 +0000</bug_when>
    <thetext>Created attachment 11548
Extract the package in the Tomcat installation folder</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57416</commentid>
    <comment_count>4</comment_count>
      <attachid>11549</attachid>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-05-14 14:44:07 +0000</bug_when>
    <thetext>Created attachment 11549
Extract the package in the Tomcat installation folder (zip format)</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>11548</attachid>
            <date>2004-05-14 14:43:00 +0000</date>
            <delta_ts>2004-05-14 14:43:28 +0000</delta_ts>
            <desc>Extract the package in the Tomcat installation folder</desc>
            <filename>hotfix-28971.tar.gz</filename>
            <type>application/octet-stream</type>
            <size>6191</size>
            <attacher name="Remy Maucherat">remm</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>11549</attachid>
            <date>2004-05-14 14:44:00 +0000</date>
            <delta_ts>2004-05-14 14:44:07 +0000</delta_ts>
            <desc>Extract the package in the Tomcat installation folder (zip format)</desc>
            <filename>hotfix-28971.zip</filename>
            <type>application/octet-stream</type>
            <size>6977</size>
            <attacher name="Remy Maucherat">remm</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>28989</bug_id>
          
          <creation_ts>2004-05-14 20:01:00 +0000</creation_ts>
          <short_desc>startup-using-launcher.{sh,bat} fail on windows</short_desc>
          <delta_ts>2004-11-16 19:05:38 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.0.24</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Eric Bloch">bloch</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>57440</commentid>
    <comment_count>0</comment_count>
    <who name="Eric Bloch">bloch</who>
    <bug_when>2004-05-14 20:01:28 +0000</bug_when>
    <thetext>Do I need a specific version of ant?
I am runing ant 1.5.1 and have my ANT_HOME pointing there.

I see a jar in ant 1.6 that looks like it has this class defined.

-Eric


% ./startup-using-launcher.sh 
java.lang.NoClassDefFoundError: org/apache/tools/ant/launch/AntMain
        at java.lang.ClassLoader.defineClass0(Native Method)
        at java.lang.ClassLoader.defineClass(ClassLoader.java:486)
        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:111)
        at java.net.URLClassLoader.defineClass(URLClassLoader.java:248)
        at java.net.URLClassLoader.access$100(URLClassLoader.java:56)
        at java.net.URLClassLoader$1.run(URLClassLoader.java:195)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.net.URLClassLoader.findClass(URLClassLoader.java:188)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:297)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:253)
        at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:313)
        at org.apache.commons.launcher.Launcher.start(Launcher.java:385)
        at java.lang.reflect.Method.invoke(Native Method)
        at LauncherBootstrap.main(LauncherBootstrap.java:185)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57441</commentid>
    <comment_count>1</comment_count>
    <who name="Eric Bloch">bloch</who>
    <bug_when>2004-05-14 20:11:49 +0000</bug_when>
    <thetext>Grabbing the ant-launcher.jar from $ANT_HOME/lib (where ant is 1.6.1)
and plopping the jar in my jre/lib/ext to tests... and things work with the .sh
script... but the .bat script still fails... the latter I attribute to 
some likely failure with pathnames that have spaces or somethin...

Eric</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58167</commentid>
    <comment_count>2</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-05-26 20:18:56 +0000</bug_when>
    <thetext>Added ant-launcher.jar to common/lib directory and to launcher.properties 
file.  This was separated out from ant.jar in Ant 1.6.

If you still have a problem with the bat file, please post it specifically (and 
probably in a separate bugzilla issue).

Thanks.</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>29035</bug_id>
          
          <creation_ts>2004-05-17 14:13:00 +0000</creation_ts>
          <short_desc>wrong sessionId in EVT_SESSION_ACCESSED message</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina:Cluster</component>
          <version>5.0.24</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Rainer Jung">rainer.jung</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>rainer.jung</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>57552</commentid>
    <comment_count>0</comment_count>
    <who name="Rainer Jung">rainer.jung</who>
    <bug_when>2004-05-17 14:13:31 +0000</bug_when>
    <thetext>Hi,

in the cluster module in class session/DeltaManager there is a small buglet in
line 799. When sending EVT_SESSION_ACCESSED from a primary node the message is
created using the sessionId plus timestamp as a sessionId. This session will not
be found on the receiving side. Just seperate sessionId from uniqueId in the
message creation like in line 788. The patch is:

atlas1% diff session/DeltaManager.java session/DeltaManager.java_patch
798a799
&gt;                                              sessionId,

The line numbers are the same in CVS HEAD and in 5.0.24. The patch applies to both.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58409</commentid>
    <comment_count>1</comment_count>
    <who name="Rainer Jung">rainer.jung</who>
    <bug_when>2004-05-30 16:19:00 +0000</bug_when>
    <thetext>Fixed in 1.26 of session/DeltaManager. Expected to be included in TC 5.0.26.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>29038</bug_id>
          
          <creation_ts>2004-05-17 16:23:00 +0000</creation_ts>
          <short_desc>HostConfig.deployWars() might not create context xml for auto-deployed .war files</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.19</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Nils Dehn">dev</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>57557</commentid>
    <comment_count>0</comment_count>
    <who name="Nils Dehn">dev</who>
    <bug_when>2004-05-17 16:23:08 +0000</bug_when>
    <thetext>When a war file ist autodeployed a context xml should be automatically created 
in the $CATALINA_BASE/&lt;engine&gt;/&lt;host&gt; directory. In 
org.apache.catalina.startup.HostConfig.deployWars() the line

ostream = new BufferedOutputStream(new FileOutputStream(xml), 1024);

can fail because the parent directories of xml might not exist. The exception 
is silently swallowed. 

Solution: add xml.mkdirs(); before that line.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58258</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-05-27 23:02:10 +0000</bug_when>
    <thetext>I added the mkdirs() call as you suggest.  There could possibly be a 
permissions setup where the server user has permission to write the xml file 
but not permission to create directories, but we require the latter implicitly 
anyways, so I don't think this is a big deal.  Thanks.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59846</commentid>
    <comment_count>2</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-06-24 15:45:26 +0000</bug_when>
    <thetext>Hey,

this fix not work corret.
with xml.mkdirs you generate a dircetory at conf/&lt;enginename&gt;/&lt;hostname&gt;/myapps.xml/

this is wrong and currently we can't autodeploy a new war with META-INf/context.xml

-- At my server the conf/&lt;enginename&gt;/&lt;hostname&gt; directory generated at startup
time. I think for new host this is not made.

I have find a fix. Before extract the META-INF/context.xml we must
check the configBase.

regards
peter
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59847</commentid>
    <comment_count>3</comment_count>
      <attachid>11942</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-06-24 15:46:39 +0000</bug_when>
    <thetext>Created attachment 11942
Patch for lost configBase before autodeploy META-INF/context.xml</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>11942</attachid>
            <date>2004-06-24 15:46:00 +0000</date>
            <delta_ts>2004-06-24 15:46:39 +0000</delta_ts>
            <desc>Patch for lost configBase before autodeploy META-INF/context.xml</desc>
            <filename>HostConfig20040624.patch</filename>
            <type>text/plain</type>
            <size>1703</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>29048</bug_id>
          
          <creation_ts>2004-05-18 03:25:00 +0000</creation_ts>
          <short_desc>Request changes to java permissions in DataSourceRealm</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.19</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Stephen Davies">sjdavies</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>57579</commentid>
    <comment_count>0</comment_count>
    <who name="Stephen Davies">sjdavies</who>
    <bug_when>2004-05-18 03:25:39 +0000</bug_when>
    <thetext>My problem is this. I need to modify the DataSourceRealm so that failed login 
attempts are recorded and an account gets locked after a certain number of 
login failures.

I want to subclass the DataSourceRealm but unfortunately some of the key 
methods, authenticate(x3 params), open and close are declared private. The app 
is to be deployed at a commercial ISP so changing the DatSourceRealm class 
directly isn't a possibility. I intend to copy the class and make the 
appropriate changes as a sibling but it would have been preferable to just 
override these methods.

I would request that the permissions on useful methods in the 
org.apache.catalina.realm.DataSourceRealm be modified from private to protected 
to make future changes easier. I am more than happy to do these changes myself 
and send the modified class to you.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57590</commentid>
    <comment_count>1</comment_count>
    <who name="Dominik Drzewiecki">drzewo</who>
    <bug_when>2004-05-18 08:04:56 +0000</bug_when>
    <thetext>You can achieve it the other (simpler, imho) way round. Provided that you have
the table containing user data (username, password) as well as its status (say
locked), All you have to do is to create a view selecting only unlocked account
table rows and make your DataSourceRealm use this view instead of the table. 

I see no point in bloating DSR with user-specific/app-specific functionality.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57602</commentid>
    <comment_count>2</comment_count>
    <who name="Stephen Davies">sjdavies</who>
    <bug_when>2004-05-18 10:57:39 +0000</bug_when>
    <thetext>As you say, providing a view will provide some of the required function without
code modification. The problem is that if the users fails authentication the
counter must be increased, if the users passes authentication the counter is
zeroed. That may be possible in a view but I can't see how to do it.

This is not a request for user-specific code to be placed in DSR. It is simply
an enhancement request to change method visibility from private to protected.
This will not 'bloat' the code space.

Classes are often used in ways the original designer did not cater for. In
attempting to reuse the functionality of DSR through subclassing, problems were
encountered. Because methods such as open, close &amp; credentials were private they
had to be re-implemented in the subclass even though they were direct copies of
the superclass implementations. The authenticate(x2 params) method had to be
copied because it relied on the private authenticate(x3 params).

Changing the visibility will mean that app-specific subclasses can simply
override authenticate(x3). Surely this level of reuse is desirable?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58159</commentid>
    <comment_count>3</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-05-26 19:52:19 +0000</bug_when>
    <thetext>I like this request, and we do want to encourage such extension, especially for 
such a good use-case.  Please send a diff patch against the class with your 
desired changes.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58757</commentid>
    <comment_count>4</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-06-04 13:52:34 +0000</bug_when>
    <thetext>Made authenticate, open, and close methods protected instead of private.</thetext>
  </long_desc>
      
      

    <bug_classification class="DESIGN_DEFECT">DESIGN_DEFECT</bug_classification></bug>
    <bug>
          <bug_id>29056</bug_id>
          
          <creation_ts>2004-05-18 06:32:00 +0000</creation_ts>
          <short_desc>java.util.ConcurrentModificationException</short_desc>
          <delta_ts>2005-02-18 06:16:09 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.24</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Petteri Stenius">petteri.stenius</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>brill</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>57586</commentid>
    <comment_count>0</comment_count>
    <who name="Petteri Stenius">petteri.stenius</who>
    <bug_when>2004-05-18 06:32:37 +0000</bug_when>
    <thetext>I sometimes see ConcurrentModificationException during Tomcat startup.

This issue was previously reported as #22388 for TC 5.0.7. The issue was 
marked as resolved! Any instructions how to work around this startup problem? 

Tomcat was installed from jakarta-tomcat-5.0.24.zip, the host is running J2SE 
1.4.2_02.


WARNING: Error registering contexts
java.util.ConcurrentModificationException
        at java.util.HashMap$HashIterator.nextEntry(HashMap.java:782)
        at java.util.HashMap$EntryIterator.next(HashMap.java:824)
        at java.util.HashMap.putAllForCreate(HashMap.java:424)
        at java.util.HashMap.clone(HashMap.java:656)
        at mx4j.server.DefaultMBeanRepository.clone
(DefaultMBeanRepository.java:56)
        at mx4j.server.MBeanServerImpl.findMBeansByPattern
(MBeanServerImpl.java:1603)
        at mx4j.server.MBeanServerImpl.queryObjectNames
(MBeanServerImpl.java:1568)
        at mx4j.server.MBeanServerImpl.queryMBeans(MBeanServerImpl.java:1512)
        at org.apache.coyote.tomcat5.MapperListener.init
(MapperListener.java:126)
        at org.apache.coyote.tomcat5.CoyoteConnector.start
(CoyoteConnector.java:1510)
        at org.apache.catalina.core.StandardService.start
(StandardService.java:485)
        at org.apache.catalina.core.StandardServer.start
(StandardServer.java:2298)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:556)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke
(NativeMethodAccessorImpl.java:39)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke
(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:284)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:422)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57587</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-05-18 06:36:56 +0000</bug_when>
    <thetext>This is an issue with the MX4J release we're using. Start TC again (it happens
rarely, so it should be ok), or replace the MX4J impl with the Sun RI (which
doesn't have the issue and has been used for all previous 5.0.x stable releases,
but that we can't bundle anymore due to the new ASF licensing policies).

*** This bug has been marked as a duplicate of 22388 ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57627</commentid>
    <comment_count>2</comment_count>
    <who name="Dave McDonnell">dmcdonnell</who>
    <bug_when>2004-05-19 06:09:00 +0000</bug_when>
    <thetext>I just upgraded to 5.0.24 and I'm getting this every time I start the server.

The server config has 3 Services, each with an Engine. The first 
Service/Engine has 3 Hosts, while the other two Service/Engine only have 1 
Host each.

The first Service/Engine seems to start up correctly, while the second two 
fail.

Will this be resolved in 5.0.25? Or is the only option for me changing to the 
Sun RI?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57629</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-05-19 07:25:23 +0000</bug_when>
    <thetext>Please do not reopen the report. Please reread my answer, everything is there.

*** This bug has been marked as a duplicate of 22388 ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58005</commentid>
    <comment_count>4</comment_count>
    <who name="Dave McDonnell">dmcdonnell</who>
    <bug_when>2004-05-25 02:46:11 +0000</bug_when>
    <thetext>Upon further investigation I found my config file (brought forward from TC4) 
was explicitly referring to the connector class:

&lt;Connector  className="org.apache.coyote.tomcat4.CoyoteConnector" ...&gt;

Removing this has resolved the issue.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59197</commentid>
    <comment_count>5</comment_count>
    <who name="Adam Rabung">adamrabung</who>
    <bug_when>2004-06-14 15:50:10 +0000</bug_when>
    <thetext>This appears to be fixed by commenting out the entire 
&lt;mbean name="CoyoteConnector"&gt; element in
&lt;TOMCAT_HOME&gt;server\classes\org\apache\catalina\mbeans.  As far as I can tell,
it does not cause any new problems.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59491</commentid>
    <comment_count>6</comment_count>
    <who name="Adam Rabung">adamrabung</who>
    <bug_when>2004-06-18 18:34:25 +0000</bug_when>
    <thetext>My previous advice was wrong - that file is not included in default Tomcat
builds (and bizarrely it only fixed the problem for a few days).  
However, using Sun's RI definitely seems to fix it.
1. Download JMX 1.2.1 Reference Implementation from
http://java.sun.com/products/JavaManagement/download.html
2. Extract jmxri.jar to overwrite the file &lt;TOMCAT_HOME&gt;/bin/jmx.jar 

This has worked perfectly for me for like a week.

By the way, Jakarta should consider giving this a closer look.  This problem is
NOT rare for me and my team, and the server must be restarted after it happens.
 It also makes me uncomfortable patching a "final" product.  I'm on Tomcat 5.0.29.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>70901</commentid>
    <comment_count>7</comment_count>
    <who name="Brill Pappin">brill</who>
    <bug_when>2005-02-13 20:38:35 +0000</bug_when>
    <thetext>Using 5.0.29

I'm having the same trouble, it's consistant and critical for a production
system. Restarting Tomcat usually doesn't help, and I have to remove all the
webapps in all the virtual hosts before I can get the system back up.

I've just entered my details in a reopened bug (26752), but it looks like I
added to the wrong ticket (I'll close that one again).

I've reopened this bug as it's clearly not resolved, patching a release version
of Tomcat (comment #9) is *not* resolution. If this is fixed in a later release,
let us know.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>70903</commentid>
    <comment_count>8</comment_count>
    <who name="Brill Pappin">brill</who>
    <bug_when>2005-02-13 20:48:25 +0000</bug_when>
    <thetext>Confirmed that comment #6 resolves the issue.
What version of tomcat can we expect this fix included in?
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>70905</commentid>
    <comment_count>9</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2005-02-13 21:04:06 +0000</bug_when>
    <thetext>Download the news mx4j 2.1.1 http://mx4j.sourceforge.net/
and copy mx4j.jar to your catalina.home/bin. Then delete existing
jmx.jar and move mx4j.jar to jmx.jar.

Peter</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>71191</commentid>
    <comment_count>10</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2005-02-18 15:16:09 +0000</bug_when>
    <thetext>Please read what Remy said about distribution licenses, and Peter's latest 
MX4J suggestion.  5.0.30 includes a later MX4J I think, but 5.5.7 includes it 
for sure, and either way it's an easy swap.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>29100</bug_id>
          
          <creation_ts>2004-05-19 19:21:00 +0000</creation_ts>
          <short_desc>jsp2-example-taglib has invalid schemaLocation</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Examples</component>
          <version>5.0.24</version>
          <rep_platform>All</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Gael Stevens">gael.stevens</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>57665</commentid>
    <comment_count>0</comment_count>
    <who name="Gael Stevens">gael.stevens</who>
    <bug_when>2004-05-19 19:21:42 +0000</bug_when>
    <thetext>jakarta-tomcat-5.0.24/webapps/jsp-examples/WEB-INF/jsp2/jsp2-example-taglib.tld
contains:
xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee web-jsptaglibrary_2_0.xsd

Note the space between j2ee and web-jsptaglibrary_2_0.xsd. It should be a 
slash. This causes some containers to fail resolve the schema location.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57871</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-05-21 20:58:55 +0000</bug_when>
    <thetext>Fixed in CVS.  However, you suggested fix is wrong, though.  See Bug 26147 for
details.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>29108</bug_id>
          
          <creation_ts>2004-05-19 22:30:00 +0000</creation_ts>
          <short_desc>"chunked" transfer-encoding is not working</short_desc>
          <delta_ts>2005-12-20 14:52:05 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:HTTP</component>
          <version>5.0.24</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Meng Tat Fong">mengtat</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>57678</commentid>
    <comment_count>0</comment_count>
    <who name="Meng Tat Fong">mengtat</who>
    <bug_when>2004-05-19 22:30:13 +0000</bug_when>
    <thetext>I am running Tomcat 5.0.24 on an IBM's z/os machine. IE fails to show most of 
my jsp pages (Netscape works in this case). Note that all my jsp pages are 
using UTF8 encoding and at least one jsp:include tag.

After some investigation, I find out that 
org.apache.coyote.http11.filters.ChunkedOutputFilter.java is causing the 
problem. It uses getBytes() without specifing any encoding to generate 
END_CHUNK.

		END_CHUNK.setBytes(endChunkValue.getBytes(), 
                               0, endChunkValue.length());

In my case, z/os uses EBCDIC to encode END_CHUNK. Since my jsp pages are using 
UTF8 encoding, IE fails to detech the "last chunks" of my jsp pages.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58262</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-05-27 23:46:36 +0000</bug_when>
    <thetext>Please suggest a code patch (preferably in a CVS or RCS diff file format).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58407</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-05-30 14:54:07 +0000</bug_when>
    <thetext>I've patched Jean Frederic style. This should fix the issue.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>83854</commentid>
    <comment_count>3</comment_count>
    <who name="quartz">quartz12h</who>
    <bug_when>2005-12-20 16:24:52 +0000</bug_when>
    <thetext>On what version was this fixed?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>83857</commentid>
    <comment_count>4</comment_count>
    <who name="">william.barker</who>
    <bug_when>2005-12-20 17:01:21 +0000</bug_when>
    <thetext>(In reply to comment #3)
&gt; On what version was this fixed?

If you're too stupid to look it up, why should I tell you?  Now go away and 
quit waisting people's time.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>83858</commentid>
    <comment_count>5</comment_count>
    <who name="quartz">quartz12h</who>
    <bug_when>2005-12-20 17:24:37 +0000</bug_when>
    <thetext>This community reserved the right to block users behaving improperly.
Please be respectful. Thanks.

This bug tracking system is the place to look into for getting the fixed release.
Closed bugs must contain a fixed release comment or attribute.

Not everyone has the knowledge to drill down hundred of files in CVS to look for
some unknown comment. Thanks you for your comprehension.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>83865</commentid>
    <comment_count>6</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2005-12-20 23:52:05 +0000</bug_when>
    <thetext>(In reply to comment #5)
&gt; This bug tracking system is the place to look into for getting the fixed release.
No it isn't. The change log is the definitive source for matching bug fixes
against releases.

&gt; Closed bugs must contain a fixed release comment or attribute.
Whilst committers do endeavour to do this when they commit a fix, there is no
policy within the Tomcat project that states that this must occur.

&gt; Not everyone has the knowledge to drill down hundred of files in CVS to look for
&gt; some unknown comment. Thanks you for your comprehension.
It is not necessary to use the source repository (which, for the record, is now
in SVN rather than CVS). Again, look at the change log. (Hint: look at the log
for 5.0.x rather than 5.5.x as this bug was fixed quite some time ago).</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>29133</bug_id>
          
          <creation_ts>2004-05-20 23:05:00 +0000</creation_ts>
          <short_desc>"catalina.sh stop -force" doesn't work</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.24</version>
          <rep_platform>Sun</rep_platform>
          <op_sys>Solaris</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="George Lindholm">George.Lindholm</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>57751</commentid>
    <comment_count>0</comment_count>
    <who name="George Lindholm">George.Lindholm</who>
    <bug_when>2004-05-20 23:05:21 +0000</bug_when>
    <thetext>Using the "stop -force" option with catalina.sh results in the command:

org.apache.catalina.startup.Bootstrap -force stop

which causes Bootstrap to complain since -force is not a valid option.

    George</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57752</commentid>
    <comment_count>1</comment_count>
      <attachid>11619</attachid>
    <who name="George Lindholm">George.Lindholm</who>
    <bug_when>2004-05-20 23:06:43 +0000</bug_when>
    <thetext>Created attachment 11619
Fix parameter parsing so "stop -force" will work (and add option to help text)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58158</commentid>
    <comment_count>2</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-05-26 19:47:45 +0000</bug_when>
    <thetext>Fixed as suggested.  Thanks.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>11619</attachid>
            <date>2004-05-20 23:06:00 +0000</date>
            <delta_ts>2004-05-20 23:06:43 +0000</delta_ts>
            <desc>Fix parameter parsing so "stop -force" will work (and add option to help text)</desc>
            <filename>cat.pa</filename>
            <type>text/plain</type>
            <size>1059</size>
            <attacher name="George Lindholm">George.Lindholm</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>29166</bug_id>
          
          <creation_ts>2004-05-24 07:00:00 +0000</creation_ts>
          <short_desc>Expect: 100-Continue fails after 401 Unauthorized</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:HTTP</component>
          <version>5.0.16</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Chris Floersch">chrisfloersch</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>57943</commentid>
    <comment_count>0</comment_count>
    <who name="Chris Floersch">chrisfloersch</who>
    <bug_when>2004-05-24 07:00:08 +0000</bug_when>
    <thetext>A POST to a protected servlet using Expect: 100-continue results in a 401 
Unauthorized return. If that same connection is held open and the POST is 
resubmitted again using the Expect: 100-continue along with appropriate 
Authorization credentials the 100 Continue is never sent. Timing out on waiting 
for the 100 Continue and sending the entity body anyways results in a 505 HTTP 
Version Not Supported.

In the following senario I am not using a front end web server nor the jk2 
connector. I am using tomcat 5.0.16 with a basic HTTP Connector running as a 
service on Windows2000 with the latest service packs. There are no reported 
errors in the logs.

java version "1.4.1"
Java(TM) 2 Runtime Environment, Standard Edition (build 1.4.1-b21)
Java HotSpot(TM) Client VM (build 1.4.1-b21, mixed mode)


** REQUEST **
POST /client/servlet/EchoExample HTTP/1.1
Host: localhost:8000
User-Agent: NetLib/1.0
Accept: text/html, text/xml, text/plain, image/gif, image/png, image/jpeg, */*
Accept-Language: en-us
Accept-Charset: ISO-8859-1;q=0.8, UTF-8;q=0.6, *;q=0.3
Content-Type: multipart/form-data; 
	boundary="----=_Part_0_27379847.1085374393407"
Content-Length: 727
TE: gzip;q=0.8, deflate;q=0.2
Expect: 100-continue
Connection: keep-alive
Pragma: no-cache
Cache-Control: no-cache

** RESPONSE **
HTTP/1.1 401 Unauthorized
WWW-Authenticate: Basic realm="Realm 1"
Content-Type: text/html;charset=ISO-8859-1
Content-Language: en-US
Content-Length: 911
Date: Mon, 24 May 2004 04:53:18 GMT
Server: Apache-Coyote/1.1

bunch of stuff here.....


** RE REQUEST **
POST /client/servlet/EchoExample HTTP/1.1
Host: localhost:8000
User-Agent: NetLib/1.0
Accept: text/html, text/xml, text/plain, image/gif, image/png, image/jpeg, */*
Accept-Language: en-us
Accept-Charset: ISO-8859-1;q=0.8, UTF-8;q=0.6, *;q=0.3
Authorization: Basic dG9tY2F0MTp0b21jYXQ=
Content-Type: multipart/form-data; 
	boundary="----=_Part_0_27379847.1085374393407"
Content-Length: 727
TE: gzip;q=0.8, deflate;q=0.2
Expect: 100-continue
Connection: keep-alive
Pragma: no-cache
Cache-Control: no-cache


&lt;= THIS IS WHERE THE 100 Continue is never sent and my client code timeouts =&gt;
&lt;= I attempt to send entity body anyway assuming HTTP/1.0 client as per RFC =&gt;

** FINAL RESULT **
HTTP/1.1 505 HTTP Version Not Supported
Date: Mon, 24 May 2004 04:53:25 GMT
Server: Apache-Coyote/1.1
Connection: close



The work around on the client is to close the connection and get a new 
connection before retrying. Obviously this defeats the point of using the 
Expect: 100-continue in the first place.

It seems that the same senario without the intermediary 401 Unauthorized works 
without issue.

After some testing I have found that as long as the Content-Length &lt; 5 it seems 
to work properly. But if the Content-Length &gt;= 5 it never returns 100 Continue.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57944</commentid>
    <comment_count>1</comment_count>
      <attachid>11638</attachid>
    <who name="Chris Floersch">chrisfloersch</who>
    <bug_when>2004-05-24 07:13:07 +0000</bug_when>
    <thetext>Created attachment 11638
Simple test case.. Needs a protected (basic auth) servlet</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57992</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-05-24 21:32:29 +0000</bug_when>
    <thetext>100s are optional anyway. BTW, putting comments which look like science fiction
doesn't help the credibility of your bug report.
I also think the code which handles 100s to be obvious enough. I recommend you
look into this further.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58425</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-05-31 10:59:14 +0000</bug_when>
    <thetext>Ok, I've looked at this. Your test case is not particularly helpful: a simple
telnet is a lot better.
The purpose of 100 is to avoid transferring the (large) request content.
Keepalive in that case is a very small bonus, and Tomcat doesn't handle this yet.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>11638</attachid>
            <date>2004-05-24 07:13:00 +0000</date>
            <delta_ts>2004-05-24 07:13:07 +0000</delta_ts>
            <desc>Simple test case.. Needs a protected (basic auth) servlet</desc>
            <filename>testcase.zip</filename>
            <type>application/octet-stream</type>
            <size>3091</size>
            <attacher name="Chris Floersch">chrisfloersch</attacher>
            

          </attachment>
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>29174</bug_id>
          
          <creation_ts>2004-05-24 12:31:00 +0000</creation_ts>
          <short_desc>complain about liveDeploy tags and enhance documentation of deployOnStartup</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.24</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>http://jakarta.apache.org/tomcat/tomcat-5.0-doc/config/host.html#Attributes</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ralf Hauser">hauser</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>57957</commentid>
    <comment_count>0</comment_count>
    <who name="Ralf Hauser">hauser</who>
    <bug_when>2004-05-24 12:31:06 +0000</bug_when>
    <thetext>coming from 4.1.27, my server.xml had a 3 host tags with each an
unpackWARs="false" autoDeploy="false" liveDeploy="false" setting and each a .war
file. All war files in the same directory.
With 5.0.24, it started to deploy 3*3, i.e. 9 times instead of only 3 like before.

It appears that liveDeploy is not longer used and now called autoDeploy?
If so, shouldn't the server.xml parser complain about this unknown attribute?

Similarly, autoDeploy appears now to be deployOnStartup? If so, it might be
useful to add a note in this respect in the description box for each of the two!</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57958</commentid>
    <comment_count>1</comment_count>
    <who name="Ralf Hauser">hauser</who>
    <bug_when>2004-05-24 12:34:01 +0000</bug_when>
    <thetext>and now, even that I have deployOnStartup="false" unpackWARs="false"
autoDeploy="false" liveDeploy="false"
for each Host element, it still seems to deploy on startup.sh .
I assume the reason for this is that in the web.xml, I use the tag
"load-on-startup" . If this is correct, I assume this should be mentioned as well!</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>57991</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-05-24 21:26:50 +0000</bug_when>
    <thetext>I think the documentation is good enough (and I really hate whines ...).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58010</commentid>
    <comment_count>3</comment_count>
    <who name="Ralf Hauser">hauser</who>
    <bug_when>2004-05-25 04:47:30 +0000</bug_when>
    <thetext>Since there is no DTD for the server.xml as per the faq
http://jakarta.apache.org/tomcat/faq/misc.html#dtd i.e. is there a way other
than going through the source code where I can see whether the "liveDeploy" is
still valid and what it would do under tomcat 5?

http://www.onjava.com/pub/a/onjava/2004/01/28/tomcat5.html?page=last appears to
suggest that liveDeploy no longer exists, but then I would expect a stackdump
complaining about this when doing bin/startup.sh</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58146</commentid>
    <comment_count>4</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-05-26 17:23:42 +0000</bug_when>
    <thetext>You should adjust your expectations regarding the stack dump or complaints 
about unknown elements when it comes to parsing tomcat's server.xml.  You won't 
get any such stack dumps or warning messages, because:
- There's no DTD/schema to validate server.xml, as you noted, and
- We use Digester to scan for predefined patterns and attributes only, so 
unknown ones are simply ignored

If you find the documentation insufficient, please provide patches that are 
actual diff files, rather than general complaints.  We will gladly evaluate and 
apply them as needed.

The source code is easy to download, and you can grep it for "liveDeploy" 
or "autoDeploy" to see exactly what the relevant code does.  If something is in 
the code, then it's in the docs.  If it's not in the docs, it's irrelevant in 
the code.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58455</commentid>
    <comment_count>5</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-06-01 13:31:07 +0000</bug_when>
    <thetext>I'm closing this issue based on personal communication with Mr. Hauser.  

My invitation to submit documentation enhancements, and my promise to review 
and commit them quickly into our repository and web site, still stands.  Your 
contributions would be very welcome and highly appreciated.
</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>29246</bug_id>
          
          <creation_ts>2004-05-27 13:31:00 +0000</creation_ts>
          <short_desc>Error in jakarta-tomcat-5/build.xml:28</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.25</version>
          <rep_platform>All</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="AK">tomcat-bugzilla</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>58205</commentid>
    <comment_count>0</comment_count>
    <who name="AK">tomcat-bugzilla</who>
    <bug_when>2004-05-27 13:31:35 +0000</bug_when>
    <thetext>CVS version 040527 15:00 CEST

jakarta-tomcat-5/build.xml:28: Element type "property" must be followed by
either attribute specifications, "&gt;" or "/&gt;".

&lt;property name="ant-launcher.jar       value="${ant.home}/lib/ant-launcher.jar"/&gt;
must be
&lt;property name="ant-launcher.jar"       value="${ant.home}/lib/ant-launcher.jar"/&gt;

ant-launcher.jar are missing in apache-ant-1.5.4/lib works with apache-ant-1.6.1/lib</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58263</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-05-27 23:47:54 +0000</bug_when>
    <thetext>My fault, I fixed it shortly after committing the buggy version, sorry.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>29247</bug_id>
          
          <creation_ts>2004-05-27 14:52:00 +0000</creation_ts>
          <short_desc>Error building jakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/startup/DigesterFactory.java</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.25</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="AK">tomcat-bugzilla</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>58209</commentid>
    <comment_count>0</comment_count>
    <who name="AK">tomcat-bugzilla</who>
    <bug_when>2004-05-27 14:52:34 +0000</bug_when>
    <thetext>[javac]
/opt/itr/tomcat5src/jakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/startup/DigesterFactory.java:1:
illegal character: \65533
    [javac] ???/*
    [javac] ^
    [javac]
/opt/itr/tomcat5src/jakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/startup/DigesterFactory.java:1:
illegal character: \65533
    [javac] ???/*
    [javac]  ^
    [javac]
/opt/itr/tomcat5src/jakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/startup/DigesterFactory.java:1:
illegal character: \65533
    [javac] ???/*
    [javac]   ^
    [javac]
/opt/itr/tomcat5src/jakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/startup/DigesterFactory.java:35:
duplicate class: DigesterFactory
    [javac] public class DigesterFactory{
    [javac]        ^
    [javac]
/opt/itr/tomcat5src/jakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/ant/ValidatorTask.java:27:
cannot access org.apache.catalina.startup.DigesterFactory
    [javac] bad class file:
/opt/itr/tomcat5src/jakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/startup/DigesterFactory.java
    [javac] file does not contain class org.apache.catalina.startup.DigesterFactory
    [javac] Please remove or make sure it appears in the correct subdirectory of
the classpath.
    [javac] import org.apache.catalina.startup.DigesterFactory;
    [javac]                                    ^
    [javac] 5 errors</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58264</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-05-27 23:48:57 +0000</bug_when>
    <thetext>Same time as the build.xml line 28, only stranger: I don't know how some 
really strange characters got into the file header.  Anyways, I fixed it 
within a few minutes of committing the buggy version, sorry about that.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>29339</bug_id>
          
          <creation_ts>2004-06-02 11:41:00 +0000</creation_ts>
          <short_desc>Reset of "Catalina:type=GlobalRequestProcessor,name=jk-9009" without reboot</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:AJP</component>
          <version>5.0.25</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="AK">tomcat-bugzilla</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>58539</commentid>
    <comment_count>0</comment_count>
    <who name="AK">tomcat-bugzilla</who>
    <bug_when>2004-06-02 11:41:45 +0000</bug_when>
    <thetext>The JMX attributes from a JK Connector have some mysterious behavior over time. 
Without restart tomcat or the connector the values in this mbean (requestCount)
grow but decrease after some time. They "reset" not to 0! I can offer a chart of
this behavior. A HTTP connector works well. I use TC5 cvs 040601

The problems with counting more than one JK connector and the JMX naming problem
are solved with billbarker@apache.org patches to the cvs. Thank you.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58719</commentid>
    <comment_count>1</comment_count>
      <attachid>11759</attachid>
    <who name="AK">tomcat-bugzilla</who>
    <bug_when>2004-06-04 09:54:23 +0000</bug_when>
    <thetext>Created attachment 11759
requestCount over time. should be crow all the time. fallback to 0 are reboots.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58784</commentid>
    <comment_count>2</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-06-04 21:41:38 +0000</bug_when>
    <thetext>It seems that RequestGroupInfo only counts the Request objects that are still 
alive.  Since JK Requests don't live as long a HTTP Requests, it's easier to 
see this problem with JK.  </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58786</commentid>
    <comment_count>3</comment_count>
      <attachid>11768</attachid>
    <who name="AK">tomcat-bugzilla</who>
    <bug_when>2004-06-05 00:46:05 +0000</bug_when>
    <thetext>Created attachment 11768
The same for http connectors. This is was I expected for jk also.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58789</commentid>
    <comment_count>4</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-06-05 06:29:24 +0000</bug_when>
    <thetext>Fixed now in the CVS.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>11759</attachid>
            <date>2004-06-04 09:54:00 +0000</date>
            <delta_ts>2004-06-04 09:54:23 +0000</delta_ts>
            <desc>requestCount over time. should be crow all the time. fallback to 0 are reboots.</desc>
            <filename>requestCount_tomcat_5_cvs.png</filename>
            <type>image/png</type>
            <size>5053</size>
            <attacher name="AK">tomcat-bugzilla</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>11768</attachid>
            <date>2004-06-05 00:46:00 +0000</date>
            <delta_ts>2004-06-05 00:46:05 +0000</delta_ts>
            <desc>The same for http connectors. This is was I expected for jk also.</desc>
            <filename>requestCount_http_tomcat_5_cvs.png</filename>
            <type>image/png</type>
            <size>4498</size>
            <attacher name="AK">tomcat-bugzilla</attacher>
            

          </attachment>
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>29368</bug_id>
          
          <creation_ts>2004-06-03 16:23:00 +0000</creation_ts>
          <short_desc>Replace xmlParserAPIs.jar with xml-apis.jar</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.0.25</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Blair Cooper">blair</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>58647</commentid>
    <comment_count>0</comment_count>
    <who name="Blair Cooper">blair</who>
    <bug_when>2004-06-03 16:23:36 +0000</bug_when>
    <thetext>The install instructions for xerces2-j indicate that xmlParserAPIs.jar has been 
deprecated and replaced by xml-apis.jar (ref: http://xml.apache.org/xerces2-
j/install.html).

This enhancement is to replace xmlParserAPIs.jar and all references to it with 
xml-apis.jar.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59338</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-06-16 18:05:06 +0000</bug_when>
    <thetext>OK, done.</thetext>
  </long_desc>
      
      

    <bug_classification class="CLEANUP">CLEANUP</bug_classification></bug>
    <bug>
          <bug_id>29387</bug_id>
          
          <creation_ts>2004-06-04 09:54:00 +0000</creation_ts>
          <short_desc>Null pointer exception in CoyoteRequest in parseCookies() method when cookie name is reserved word</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.25</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="François Lopitaux">flopitaux</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>kboyd</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>58720</commentid>
    <comment_count>0</comment_count>
    <who name="François Lopitaux">flopitaux</who>
    <bug_when>2004-06-04 09:54:47 +0000</bug_when>
    <thetext>The problem arrives when Tomcat receive an HTTP request with one of the cookie
have reserved name like "Path".

So because one of the cookie name is reserved name, it's throw
IllegalArgumentException but the problem is that log object is null.

i guest that you was wanted to write just log method and not log.info.

CoyoteRequest.java from line 2330 :
for (int i = 0; i &lt; count; i++) {
            ServerCookie scookie = serverCookies.getCookie(i);
            System.out.println("scookie="+scookie);
            try {
                Cookie cookie = new Cookie(scookie.getName().toString(),
                                           scookie.getValue().toString());
                cookie.setPath(scookie.getPath().toString());
                cookie.setVersion(scookie.getVersion());
                String domain = scookie.getDomain().toString();
                if (domain != null) {
                    cookie.setDomain(scookie.getDomain().toString());
                }
                cookies[idx++] = cookie;
            } catch(IllegalArgumentException e) {
                log.info("Bad Cookie: Name: " + scookie.getName() 
                         + " Value: " + scookie.getValue());
            }

Exception throws : 
java.lang.NullPointerException
        at
org.apache.coyote.tomcat5.CoyoteRequest.parseCookies(CoyoteRequest.java:2343)
        at
org.apache.coyote.tomcat5.CoyoteRequest.getCookies(CoyoteRequest.java:1850)
        at
org.apache.coyote.tomcat5.CoyoteRequestFacade.getCookies(CoyoteRequestFacade.java:418)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58725</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-06-04 10:39:27 +0000</bug_when>
    <thetext>The most reasonable is to remove the log statement.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58848</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-06-07 16:56:20 +0000</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59537</commentid>
    <comment_count>3</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-06-18 23:42:42 +0000</bug_when>
    <thetext>*** Bug 29681 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>29389</bug_id>
          
          <creation_ts>2004-06-04 10:31:00 +0000</creation_ts>
          <short_desc>package mx4j never loaded by webappX classloader</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Documentation</component>
          <version>5.0.25</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P5</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>29388</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter name="Bernhard Seebass">seebass</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>58724</commentid>
    <comment_count>0</comment_count>
    <who name="Bernhard Seebass">seebass</who>
    <bug_when>2004-06-04 10:31:47 +0000</bug_when>
    <thetext>It seems the classes from mx4j.* are never loaded by webappX classloader but by 
system classloader. This is not in accordance with the documentation (tomcat-5.
0-doc/class-loader-howto.html) and furthermore makes it impossible to access 
mx4j-tools.jar without adding it to system classpath.

Maybe the problem is caused by the fact, that javax.managment.* is (correctly) 
always loaded by system classloader.

java.lang.ClassNotFoundException: mx4j.tools.naming.NamingService
        at java.net.URLClassLoader$1.run(URLClassLoader.java:199)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.net.URLClassLoader.findClass(URLClassLoader.java:187)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:289)
        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:274)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:235)
        at mx4j.server.interceptor.InvokerMBeanServerInterceptor.
instantiate(InvokerMBeanServerInterceptor.java:93)
        at mx4j.server.interceptor.DefaultMBeanServerInterceptor.
instantiate(DefaultMBeanServerInterceptor.java:108)
        at mx4j.server.interceptor.SecurityMBeanServerInterceptor.
instantiate(SecurityMBeanServerInterceptor.java:67)
        at mx4j.server.interceptor.DefaultMBeanServerInterceptor.
instantiate(DefaultMBeanServerInterceptor.java:108)
        at mx4j.server.interceptor.DefaultMBeanServerInterceptor.
instantiate(DefaultMBeanServerInterceptor.java:108)
        at mx4j.server.interceptor.ContextClassLoaderMBeanServerInterceptor.
instantiate(ContextClassLoaderMBeanServerInterceptor.java:90)
        at mx4j.server.MBeanServerImpl.instantiateImpl(MBeanServerImpl.java:840)
        at mx4j.server.MBeanServerImpl.createMBean(MBeanServerImpl.java:958)
        at mx4j.server.MBeanServerImpl.createMBean(MBeanServerImpl.java:926)
        at org.sape.carbon.services.jmx.server.mx4j.DefaultJrmpRemotingImpl.
configure(DefaultJrmpRemotingImpl.java:132)
        at org.sape.carbon.core.component.lifecycle.DefaultLifecycleInterceptor.
callComponentConfigure(DefaultLifecycleInterceptor.java:973)
        at org.sape.carbon.core.component.lifecycle.DefaultLifecycleInterceptor.
configureComponent(DefaultLifecycleInterceptor.java:469)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58726</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-06-04 10:39:56 +0000</bug_when>
    <thetext>We will not address this, and is not a bug.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58758</commentid>
    <comment_count>2</comment_count>
    <who name="Bernhard Seebass">seebass</who>
    <bug_when>2004-06-04 14:00:29 +0000</bug_when>
    <thetext>OK - as mx4j is the implementation of javax.managment I guess it is considered 
beeing part of the apache tomcat server and therefore delegated by the webappX 
classloader. =&gt; no bug

My wish: Please update the documentation:

http://jakarta.apache.org/tomcat/tomcat-5.0-doc/class-loader-howto.html

1. chapter classloader definitions
"jmx.jar - The JMX 1.2 implementation." must be placed under System (currently: 
Common)

2. 
Old:
...in accordance with the recommendations in the Servlet Specification, version 
2.3, section 9.6... 
(this is the chapter Web Application Archive File)
New:
...in accordance with the recommendations in the Servlet Specification, version 
2.3, section 9.7.2 Web Application Classloader ...


3 (and most important). delegation according package pattern
add
- mx4j.*

Thanks

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59323</commentid>
    <comment_count>3</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-06-16 15:52:47 +0000</bug_when>
    <thetext>OK, done for items 1 and 2 on your list.  I didn't add 3 to the document 
because it's simply false.  The classloader how-to correctly and completely 
lists the packages that are delegated, as you can easily verify by looking at 
the source for org.apache.catalina.loader.WebappClassLoader.java (the 
packageTriggers field).</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>29399</bug_id>
          
          <creation_ts>2004-06-04 19:23:00 +0000</creation_ts>
          <short_desc>Wrong MBean name for jk connector Tomcat 5 cvs and JDK 1.3.1</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:AJP</component>
          <version>5.0.25</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="AK">tomcat-bugzilla</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>58781</commentid>
    <comment_count>0</comment_count>
    <who name="AK">tomcat-bugzilla</who>
    <bug_when>2004-06-04 19:23:40 +0000</bug_when>
    <thetext>Name: Catalina:type=ThreadPool,name=jk-0.0.0.0%2F0.0.0.0-9009

OK under JDK 1.4.2
Name: Catalina:type=ThreadPool,name=jk-9009</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58787</commentid>
    <comment_count>1</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-06-05 05:56:34 +0000</bug_when>
    <thetext>Fixed now in the CVS.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>29418</bug_id>
          
          <creation_ts>2004-06-06 20:24:00 +0000</creation_ts>
          <short_desc>Umlaut problems when precompiling jsp files</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.24</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ralf Hauser">hauser</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>58823</commentid>
    <comment_count>0</comment_count>
    <who name="Ralf Hauser">hauser</who>
    <bug_when>2004-06-06 20:24:41 +0000</bug_when>
    <thetext>now that precompile no longer fails as reported in Bug 29160, it seems that
Umlauts such as ü are dealt with correctly when compiled by tomcat at runtime on
the fly, but not when precompiling. For example my German jsp's do contain lines
such as
&lt;%@ page language="java" %&gt;&lt;%@ taglib uri="/WEB-INF/lib/struts-template.tld" pre
fix="template" %&gt;...
&lt;?xml version="1.0" encoding="iso-8859-1"?&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="de"&gt;
&lt;html:xhtml /&gt;
&lt;head&gt;
...
&lt;meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" /&gt;

is it possible that when precompiling from ant, it assumes the default UTF8?

Might I have to 1. state the page encoding at the top of the page in a different
way, or 2. try Jikes?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59314</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-06-16 15:14:23 +0000</bug_when>
    <thetext>Yes, JspC assumed default UTF-8.  A new javaEncoding attribute has been added 
to JspC and now your problem should be solved.  This will be available in the 
5.0.27 build.</thetext>
  </long_desc>
      
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>29470</bug_id>
          
          <creation_ts>2004-06-09 16:10:00 +0000</creation_ts>
          <short_desc>GlobalResourcesLifecycleListener: Error message should be debug message</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.25</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Rainer Jung">rainer.jung</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>rainer.jung</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>58940</commentid>
    <comment_count>0</comment_count>
    <who name="Rainer Jung">rainer.jung</who>
    <bug_when>2004-06-09 16:10:47 +0000</bug_when>
    <thetext>In

org/apache/catalina/mbeans/GlobalResourcesLifecycleListener.java rev=1.4 

in line 205 there is a wrong log level log.error(). This should be log.debug()
instead. The message only shows up, when debug is set to &gt;=3, but the message
text says ERROR, although it is just an informational message. All similar
messages in GlobalResourcesLifecycleListener are with level debug. Example message:

2004-06-09 17:58:33,133 (main)
org.apache.catalina.mbeans.GlobalResourcesLifecycleListener/ERROR:   Creating
Role MBean for role &lt;role rolename="manager"/&gt;

Context diff for suggested patch follows, thanks for considering.

***************
*** 202,208 ****
          while (roles.hasNext()) {
              Role role = (Role) roles.next();
              if (debug &gt;= 3) {
!                 log.error("  Creating Role MBean for role " + role);
              }
              if (MBeanUtils.createMBean(role) == null) {
                  throw new IllegalArgumentException
--- 202,208 ----
          while (roles.hasNext()) {
              Role role = (Role) roles.next();
              if (debug &gt;= 3) {
!                 log.debug("Creating Role MBean for role " + role);
              }
              if (MBeanUtils.createMBean(role) == null) {
                  throw new IllegalArgumentException</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58964</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-06-09 20:39:28 +0000</bug_when>
    <thetext>Fixed.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>29472</bug_id>
          
          <creation_ts>2004-06-09 16:40:00 +0000</creation_ts>
          <short_desc>Embedded overrides add/remove Connector, but not findConnectors</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.25</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Arieh Markel">arieh.markel</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>58945</commentid>
    <comment_count>0</comment_count>
    <who name="Arieh Markel">arieh.markel</who>
    <bug_when>2004-06-09 16:40:03 +0000</bug_when>
    <thetext>The problem I am having relates to the Embedded class.

It centers around the problem that 'connectors' is a private variable
in the class, and there is no overriding of 'findConnectors' (which
is defined in StandardService).

Therefore, findConnectors() on Embedded returns a value related to its
superclass (StandardService) own (private) connectors[] variable, while
the class manages its own private list. 

-- 

A possible solution would be to:

    - remove connectors private definition from Embedded
    - make connectors in StandardService 'protected'

-- 

I understand that one would not expect to query connectors when using
Embedded. However, in the context I am using, I have variants that may
use either Embedded, or Catalina (or a modification of Catalina/Bootstrap
that I have developed).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58984</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-06-10 01:06:23 +0000</bug_when>
    <thetext>getConnectorNames() was suffering from the same problem.

Fixed by:

- changing "initialized", "connectors", and "container" from private to
  protected in StandardService,
- removing "connectors" from Embedded,
- leveraging StandardService's addConnector() and removeConnector() from
  Embedded, and
- storing the most recently added Engine in Embedded's "container" (so that it
  is used when calling connector.setContainer() in
  Standardservice.addConnector())
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59037</commentid>
    <comment_count>2</comment_count>
    <who name="Arieh Markel">arieh.markel</who>
    <bug_when>2004-06-10 17:11:53 +0000</bug_when>
    <thetext>Following Jan's comments and my inspection of the code of
Embedded and StandardService, it appears that there may still be several
issues laying around that could be resolved by a refactoring of many
of the methods.

I believe that the Listener subscription logic is duplicated.
It should be possible for the subclasses (Embedded) not to override the
variables nor the code.

The debug (variable, setter, getter) appears to be duplicated as well.
So is the Lifecycle creation.

Also, the start() method on both appears to not share the same activities
happening. Worthwhile to consider Embedded to invoke appropriately
super.start().

Similarly for stop().</thetext>
  </long_desc>
      
      

    <bug_classification class="DESIGN_DEFECT">DESIGN_DEFECT</bug_classification></bug>
    <bug>
          <bug_id>29478</bug_id>
          
          <creation_ts>2004-06-09 20:26:00 +0000</creation_ts>
          <short_desc>problem with JSPC and useBean and static initialization</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.25</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jacy Grannis">jgrannis</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>58962</commentid>
    <comment_count>0</comment_count>
    <who name="Jacy Grannis">jgrannis</who>
    <bug_when>2004-06-09 20:26:21 +0000</bug_when>
    <thetext>We have a form bean that does some static initialization which references some
classes which only work if the system is actually running.  For some reason,
though, when jspc is processing the useBean tag referring to this bean, it tries
to instantiate the bean, which fails b/c, of course, it is not doing so in the
context of a running system, but is doing so while building.  We did not have
this problem with jasper 1, but we do in jasper 2.  Also, fyi, we have tomcat
5.0.26 (least, that's what it says on system startup) but that wasn't an option
in the version box.  Here's the tag from the jsp:

&lt;jsp:useBean id="MaintainProductForm"
class="com.fuelquest.products.web.MaintainProductForm" scope="request"/&gt;

here's the jspc output, including the stack trace:

jspc:
     [java] log4j:WARN No appenders could be found for logger
(org.apache.jasper.compiler.JspRuntimeContext).
     [java] log4j:WARN Please initialize the log4j system properly.
     [java] java.lang.NoClassDefFoundError
     [java]     at
com.fuelquest.relationships.AbstractRelationshipTypeProvider.getRelationshipType(AbstractRelationshipTypeProvider.java:71)
     [java]     at
com.fuelquest.products.ProductRelationshipTypes.getProductFtaRelationshipType(ProductRelationshipTypes.java:71)
     [java]     at
com.fuelquest.products.web.MaintainProductForm.&lt;clinit&gt;(MaintainProductForm.java:76)
     [java]     at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native
Method)
     [java]     at
sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)
     [java]     at
sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)
     [java]     at java.lang.reflect.Constructor.newInstance(Constructor.java:274)
     [java]     at java.lang.Class.newInstance0(Class.java:308)
     [java]     at java.lang.Class.newInstance(Class.java:261)
     [java]     at
org.apache.jasper.compiler.Generator$GenerateVisitor.visit(Generator.java:1212)
     [java]     at org.apache.jasper.compiler.Node$UseBean.accept(Node.java:1116)
     [java]     at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2163)
     [java]     at org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2213)
     [java]     at org.apache.jasper.compiler.Node$Visitor.visit(Node.java:2219)
     [java]     at org.apache.jasper.compiler.Node$Root.accept(Node.java:456)
     [java]     at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2163)
     [java]     at
org.apache.jasper.compiler.Generator.generate(Generator.java:3261)
     [java]     at
org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:244)
     [java]     at org.apache.jasper.compiler.Compiler.compile(Compiler.java:470)
     [java]     at org.apache.jasper.JspC.processFile(JspC.java:776)
     [java]     at org.apache.jasper.JspC.execute(JspC.java:905)
     [java]     at org.apache.jasper.JspC.main(JspC.java:195)
     [java] Exception in thread "main" 

     [java] Java Result: 1

We can probably code around this problem, but it does seem a bit "odd", to say
the least, that jasper would be instantiating classes and form beans in order to
generate java code....it seems like it could learn everything it needs to by
inspecting the Class without needing to actually create an instance.  I'm not
really defending the static initialization that takes place in the class, it
wasn't really my idea, but it really shouldn't matter to jasper one way or the
other.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58965</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-06-09 21:20:25 +0000</bug_when>
    <thetext>The call to newInstance is guarded by a try/catch, so its failure should not
cause the compilation to be aborted.  Please attach a test case.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>58967</commentid>
    <comment_count>2</comment_count>
    <who name="Jacy Grannis">jgrannis</who>
    <bug_when>2004-06-09 21:27:03 +0000</bug_when>
    <thetext>went and looked at the try-catch block.  You are trapping Exception. 
NoClassDefFoundError is not an Exception, it's an Error.  You should consider
trapping Throwable instead, if you want to guarantee the newInstance will not
cause compilation to fail.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59063</commentid>
    <comment_count>3</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-06-10 21:22:47 +0000</bug_when>
    <thetext>Fixed in CVS.  Bean instantiations are now avoided at compilation time.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>29521</bug_id>
          
          <creation_ts>2004-06-11 11:50:00 +0000</creation_ts>
          <short_desc>No destroy methods called on service shutdown</short_desc>
          <delta_ts>2006-06-11 18:04:02 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Native:Integration</component>
          <version>5.0.25</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Johan Philippe">johan.philippe</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>amalinowski</cc>
    
    <cc>henk.leermakers</cc>
    
    <cc>paul</cc>
          <votes>1</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>59093</commentid>
    <comment_count>0</comment_count>
    <who name="Johan Philippe">johan.philippe</who>
    <bug_when>2004-06-11 11:50:50 +0000</bug_when>
    <thetext>If the Tomcat server is stopped using shutdown.bat, then the shutdown sequence
is completed without any problems and the appropriate destroy methods of the
servlets and contextDestroyed methods of the ContextListener are called.

If the same server instance is stopped using either:
- the Apache Monitor task icon
- the Windows Services panel
- the command net stop "Apache Tomcat"

Then these destroy methods do not get called and the server is just "killed".

Using: 
Java 1.4.2_04
Standard configuration and example applications</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59095</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-06-11 12:22:40 +0000</bug_when>
    <thetext>I don't think so: are you absolutely certain that is the case ?
Please don't get abused by the fact commons-logging may be stopping logging stuff.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59096</commentid>
    <comment_count>2</comment_count>
    <who name="Mladen Turk">mturk</who>
    <bug_when>2004-06-11 12:27:55 +0000</bug_when>
    <thetext>You are probaly trying to "kill" the Tomcat using Task Manager.
Seems to me that the Task Manager gives you a warning that the application is
going to be shut down 'abnormarly', and gives you a proper warning:

"The process will not be given the chance to save its state or data before it is
terminated."</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59104</commentid>
    <comment_count>3</comment_count>
    <who name="Johan Philippe">johan.philippe</who>
    <bug_when>2004-06-11 13:58:08 +0000</bug_when>
    <thetext>I am absolutely sure.
In the destroy methods, I have added code that generates output, no matter what.
This includes
- the standard system.out / system.err usage
- create a file with a timestamp
- updating my configuration storage file (what I need)

And no, there is no KILL involved.
I ask for a nice and clean shutdown using the Stop Service.
But still it behaves as if it had been killed.

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59326</commentid>
    <comment_count>4</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-06-16 16:05:35 +0000</bug_when>
    <thetext>I've verified what the user is reporting.  It seems that the service stop only 
pauses the connector and doesn't completely shutdown things.  Neither the 
example's app listeners nor my own test ones get the contextDestroyed method.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59327</commentid>
    <comment_count>5</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-06-16 16:06:39 +0000</bug_when>
    <thetext>BTW, my tests are with 5.0.26, on Win 2K, JDK 1.4.2_04.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59328</commentid>
    <comment_count>6</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-06-16 16:18:14 +0000</bug_when>
    <thetext>I'm raising the priority on this run: it's bad if we can't properly stop the 
windows service.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64834</commentid>
    <comment_count>7</comment_count>
    <who name="Mladen Turk">mturk</who>
    <bug_when>2004-10-08 15:56:48 +0000</bug_when>
    <thetext>I would like to close that bug.

There has been some work on procrun recently that surely
address those issues. Can anyone test if this is the case with
the latest distribution, or at least provide a simple test case
(in java please :).
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65355</commentid>
    <comment_count>8</comment_count>
    <who name="Ben Souther">bsouther</who>
    <bug_when>2004-10-20 12:00:30 +0000</bug_when>
    <thetext>I tested on Win 2k Server with j2sdk1.4.2_05
From:
   -The windows service manager
   -net stop / net start
   -The start menu tools

In all 3 cases the destroy methods of the servlet and the contextListener were
called.

Attaching a test war file and a stdout.log file.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65356</commentid>
    <comment_count>9</comment_count>
      <attachid>13154</attachid>
    <who name="Ben Souther">bsouther</who>
    <bug_when>2004-10-20 12:02:01 +0000</bug_when>
    <thetext>Created attachment 13154
War file</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65357</commentid>
    <comment_count>10</comment_count>
      <attachid>13155</attachid>
    <who name="Ben Souther">bsouther</who>
    <bug_when>2004-10-20 12:02:33 +0000</bug_when>
    <thetext>Created attachment 13155
output from test</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65358</commentid>
    <comment_count>11</comment_count>
    <who name="Ben Souther">bsouther</who>
    <bug_when>2004-10-20 12:03:33 +0000</bug_when>
    <thetext>Oh, test was with 5.0.29.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>66112</commentid>
    <comment_count>12</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-10-29 18:01:40 +0000</bug_when>
    <thetext>OK, I've repeated the tests, it works fine.  So use 5.0.29 or later, you should 
be OK.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>66628</commentid>
    <comment_count>13</comment_count>
    <who name="Johan Philippe">johan.philippe</who>
    <bug_when>2004-11-09 08:17:31 +0000</bug_when>
    <thetext>Have verified the status with the original configuration and this problem is
indeed fixed when using 5.0.29 beta

Thanks</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>67142</commentid>
    <comment_count>14</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-11-18 16:10:27 +0000</bug_when>
    <thetext>*** Bug 31239 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>84060</commentid>
    <comment_count>15</comment_count>
    <who name="Arkadiusz Malinowski">amalinowski</who>
    <bug_when>2005-12-29 09:43:54 +0000</bug_when>
    <thetext>*** Bug 38010 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>13154</attachid>
            <date>2004-10-20 12:02:00 +0000</date>
            <delta_ts>2004-10-20 12:02:01 +0000</delta_ts>
            <desc>War file</desc>
            <filename>test.war</filename>
            <type>application/octet-stream</type>
            <size>2638</size>
            <attacher name="Ben Souther">bsouther</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>13155</attachid>
            <date>2004-10-20 12:02:00 +0000</date>
            <delta_ts>2004-10-20 12:02:33 +0000</delta_ts>
            <desc>output from test</desc>
            <filename>sdout.log</filename>
            <type>text/plain</type>
            <size>3148</size>
            <attacher name="Ben Souther">bsouther</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>29561</bug_id>
          
          <creation_ts>2004-06-14 18:40:00 +0000</creation_ts>
          <short_desc>NullPointerException in Compiler.java:547</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Lars Kral">no.spam.lkral</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>59202</commentid>
    <comment_count>0</comment_count>
    <who name="Lars Kral">no.spam.lkral</who>
    <bug_when>2004-06-14 18:40:15 +0000</bug_when>
    <thetext>When executing JSPC through an Ant target I receive the following stack trace:

jspc:
     [java] java.lang.NullPointerException
     [java]     at org.apache.jasper.compiler.Compiler.isOutDated
(Compiler.java:547)
     [java]     at org.apache.jasper.JspC.processFile(JspC.java:775)
     [java]     at org.apache.jasper.JspC.execute(JspC.java:905)
     [java]     at org.apache.jasper.JspC.main(JspC.java:195)
     [java] org.apache.jasper.JasperException

I think the missing check for (jsw==null) starts at line 560 .

Tested with: Tomcat 5.0.26</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59252</commentid>
    <comment_count>1</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-06-15 19:09:10 +0000</bug_when>
    <thetext>Please attach test case, including build.xml</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59255</commentid>
    <comment_count>2</comment_count>
      <attachid>11851</attachid>
    <who name="Lars Kral">no.spam.lkral</who>
    <bug_when>2004-06-15 20:11:08 +0000</bug_when>
    <thetext>Created attachment 11851
a simple test case</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59258</commentid>
    <comment_count>3</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-06-15 21:30:51 +0000</bug_when>
    <thetext>Fixed, problem occurred only if servlet class already existed.
Thanks for reporting the issue!</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>11851</attachid>
            <date>2004-06-15 20:11:00 +0000</date>
            <delta_ts>2004-06-15 20:11:08 +0000</delta_ts>
            <desc>a simple test case</desc>
            <filename>testcase.zip</filename>
            <type>application/zip</type>
            <size>638</size>
            <attacher name="Lars Kral">no.spam.lkral</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>29584</bug_id>
          
          <creation_ts>2004-06-15 19:14:00 +0000</creation_ts>
          <short_desc>JNDI documentation could be more clear</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.0.25</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Benson Margulies">bim2003</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>59254</commentid>
    <comment_count>0</comment_count>
    <who name="Benson Margulies">bim2003</who>
    <bug_when>2004-06-15 19:14:35 +0000</bug_when>
    <thetext>The JNDI documentation is not entirely clear as to the number of JNDI contexts 
and their relationship. I am reading the page entitled, "JNDI Resources HOW-TO".

The top of the page states that each web app receives a unique initial context. 
So far, so good.

Then, under 'Configuring JNDI Resources', the explanation talks about elements 
that live inside either &lt;Context&gt; or &lt;DefaultContext&gt; in server.xml. 

First clarification: Since &lt;Context&gt; elements are frequently created in 
separate files in the Catalina directory, this text should reference those 
files.

Second clarification issue: the page 'globalresources.html' explicitly states 
that &lt;Environment/&gt; elements in the GlobalNamingResources propagate 
automatically into each web application. To me, that implied that the other 
resources defined in GlobalNamingResources would also propagate. They don't, at 
least in the 'custom factory' case. Under 'Resource Definitions', the text says 
that you can declare the characteristics of resource-env-ref's for a web.xml in 
the GlobalNamingResources. This may be true of the standard factories, but it 
is NOT true for custom factories. Unless that's deemed to be a defect, this 
text should state, explicitly, that custom factories require a ResourceLink 
element to make them available in the per-web-application InitialContext.

Back to the JNDI howto.  

Third clarification:

The initial reference to &lt;ResourceLink&gt; mentions the global JNDI context 
without referencing the GlobalNamingResources link. The terminology here is not 
quite consistent with the definition of 'Global Resources' below. It would be 
clearer to include an href to GlobalNamingResources in the &lt;ResourceLink&gt; 
bullet, since ResourceLink is (I think) only useful for GlobalNamingResources.

Fourth clarification: Under 'Adding Custom Resource Factories', the reference 
to conf/server.xml should be more specific. It should state that you have three 
choices: &lt;Context&gt;, &lt;DefaultContext&gt;, or &lt;GlobalNamingResources&gt; with a 
&lt;ResourceLink&gt; to make it available in Context or DefaultContext. Possibly, the 
same clarification is apropos for the standard resource factories, though the 
special cases for them in the source might render it unnecessary.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59300</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-06-16 14:36:48 +0000</bug_when>
    <thetext>Great.  Next, please submit documentation patches for these pages containing 
the text you'd like to see in them.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59332</commentid>
    <comment_count>2</comment_count>
    <who name="Benson Margulies">bim2003</who>
    <bug_when>2004-06-16 16:46:43 +0000</bug_when>
    <thetext>I'll treat your comment as indicating that you have decided that the current 
behavior is entirely intended :-).

Can I prepare patches from 5.0.25, or do I have to get set up for CVS?
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59334</commentid>
    <comment_count>3</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-06-16 17:34:44 +0000</bug_when>
    <thetext>No, it's by design, but the docs could be better.  You can do patches from 
5.0.25 but CVS head is preferable.  CVS directions are at 
http://www.apache.org/dev/contributors.html#cvsbasics.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59544</commentid>
    <comment_count>4</comment_count>
      <attachid>11884</attachid>
    <who name="Benson Margulies">bim2003</who>
    <bug_when>2004-06-19 00:57:36 +0000</bug_when>
    <thetext>Created attachment 11884
Proposed doc improvement</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59545</commentid>
    <comment_count>5</comment_count>
      <attachid>11885</attachid>
    <who name="Benson Margulies">bim2003</who>
    <bug_when>2004-06-19 01:18:33 +0000</bug_when>
    <thetext>Created attachment 11885
clarifications to globalresources.html</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59546</commentid>
    <comment_count>6</comment_count>
    <who name="Benson Margulies">bim2003</who>
    <bug_when>2004-06-19 01:21:42 +0000</bug_when>
    <thetext>Here are the proposed changes.

Note that in the second patch I made use of the &lt;![CDATA[ ]]&gt; construct
to save myself all those &amp;lt; and &amp;gt; blots.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59557</commentid>
    <comment_count>7</comment_count>
    <who name="Benson Margulies">bim2003</who>
    <bug_when>2004-06-19 11:07:09 +0000</bug_when>
    <thetext>Each of the attachments has errors. I'm posting fixed ones, now that I've been 
able to build and test them.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59558</commentid>
    <comment_count>8</comment_count>
      <attachid>11887</attachid>
    <who name="Benson Margulies">bim2003</who>
    <bug_when>2004-06-19 11:08:12 +0000</bug_when>
    <thetext>Created attachment 11887
FIXED patch to globalresource.sxml</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59559</commentid>
    <comment_count>9</comment_count>
      <attachid>11888</attachid>
    <who name="Benson Margulies">bim2003</who>
    <bug_when>2004-06-19 11:08:40 +0000</bug_when>
    <thetext>Created attachment 11888
FIXED patch to jndi howto.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60930</commentid>
    <comment_count>10</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-07-21 19:25:38 +0000</bug_when>
    <thetext>Fixed patches applied.  Thank you for your contribution.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>11884</attachid>
            <date>2004-06-19 00:57:00 +0000</date>
            <delta_ts>2004-06-19 00:57:36 +0000</delta_ts>
            <desc>Proposed doc improvement</desc>
            <filename>jndi-resources-howto.xml.patch</filename>
            <type>text/plain</type>
            <size>4955</size>
            <attacher name="Benson Margulies">bim2003</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>11885</attachid>
            <date>2004-06-19 01:18:00 +0000</date>
            <delta_ts>2004-06-19 01:18:33 +0000</delta_ts>
            <desc>clarifications to globalresources.html</desc>
            <filename>globalresources.xml.patch</filename>
            <type>text/plain</type>
            <size>3600</size>
            <attacher name="Benson Margulies">bim2003</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>11887</attachid>
            <date>2004-06-19 11:08:00 +0000</date>
            <delta_ts>2004-06-19 11:08:12 +0000</delta_ts>
            <desc>FIXED patch to globalresource.sxml</desc>
            <filename>globalresources.xml.patch</filename>
            <type>text/plain</type>
            <size>3606</size>
            <attacher name="Benson Margulies">bim2003</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>11888</attachid>
            <date>2004-06-19 11:08:00 +0000</date>
            <delta_ts>2004-06-19 11:08:40 +0000</delta_ts>
            <desc>FIXED patch to jndi howto.</desc>
            <filename>jndi-resources-howto.xml.patch</filename>
            <type>text/plain</type>
            <size>4958</size>
            <attacher name="Benson Margulies">bim2003</attacher>
            

          </attachment>
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>29597</bug_id>
          
          <creation_ts>2004-06-16 11:27:00 +0000</creation_ts>
          <short_desc>JspC has javaEncoding hard coded to UTF-8</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.25</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Julien Dubois">julien</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>59275</commentid>
    <comment_count>0</comment_count>
    <who name="Julien Dubois">julien</who>
    <bug_when>2004-06-16 11:27:06 +0000</bug_when>
    <thetext>The Java Encoding is hard coded to UTF-8, when running JspC from the command line. 

Bug 19622 concerned the Ant task (which now understands the javaEncoding
parameter), this one is quite similar.

I would like a new switch, so that another encoding can be selected when
launching from the command line.

For example :
&lt;java classname="org.apache.jasper.JspC"
              fork="true"
              failonerror="true"
              classpathref="jasper.classpath"&gt;
              
              (...)
              &lt;arg value="-javaEncoding"/&gt;
              &lt;arg value="ISO-8859-1"/&gt;
              (...)
&lt;/java&gt;

I am ready to write and submit a patch. Contact me at http://www.julien-dubois.com.

Julien Dubois.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59294</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-06-16 14:19:39 +0000</bug_when>
    <thetext>OK, done.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>29661</bug_id>
          
          <creation_ts>2004-06-18 08:13:00 +0000</creation_ts>
          <short_desc>Host Names parsing is case sensitive</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.0.18</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="François Jeanmougin">francois.jeanmougin</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>59459</commentid>
    <comment_count>0</comment_count>
    <who name="François Jeanmougin">francois.jeanmougin</who>
    <bug_when>2004-06-18 08:13:51 +0000</bug_when>
    <thetext>Virtual Hosts is managed by the Host: header in HTTP1.x queries. Recent wap 
terminals do not lower case the host name. Host name parsed by (I assume) the 
Coyote connector is used as is (with potential upper character). RFC2616 says 
that the Host header should be treated case insensitive (see section 3.2.3).

Well, it is not really obvious because it talks about clients, I assume that a 
server should treat a Host: header case-insensitively. Because it can leads to 
broken connections, or unwanted 400 errors, I tag it as critical.

Thank you for al your work,

François.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59471</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-06-18 10:57:35 +0000</bug_when>
    <thetext>Sorry, I am not convinced: please find something which discusses the Host
header, and try to provide a patch.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59478</commentid>
    <comment_count>2</comment_count>
    <who name="François Jeanmougin">francois.jeanmougin</who>
    <bug_when>2004-06-18 12:58:58 +0000</bug_when>
    <thetext>Create a Host entry like this :

&lt;Host name=www.toto.com ...&gt;
Add a context here
&lt;/Host&gt;

Test it with a simple telnet or netcat :
nc yourhost:80 &lt; EOT
GET /index.jsp HTTP/1.1
Host:www.toto.com 



EOT
(Be carefull to add a double &lt;CR&gt;)
You will got your page. Now, do :
nc yourhost:80 &lt; EOT
GET /index.jsp HTTP/1.1
Host:WWW.toto.com 



EOT
You will have a 400 (invalid request) error.

I can try to llok at the code and provide a patch but I never tried to read 
tomcat sources. If you can point me in which part of the code this is done, I 
can try to read it.

As far as I know, it is NOT a invalid "bug" :), even if you could consider it 
as a misfeature. In fact, most of the good'all navigators do it for the user, 
it is clearly a wap (bad) terminal problem.

François.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59550</commentid>
    <comment_count>3</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-06-19 04:27:14 +0000</bug_when>
    <thetext>Fixed in the CVS, and should appear in 5.0.28.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>29688</bug_id>
          
          <creation_ts>2004-06-19 13:25:00 +0000</creation_ts>
          <short_desc>HostConfig NullPointerException</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.25</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P1</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Sascha Dierkes">sd</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>ammulder</cc>
    
    <cc>bossy</cc>
    
    <cc>greg</cc>
    
    <cc>rbetjes</cc>
          <votes>1</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>59583</commentid>
    <comment_count>0</comment_count>
    <who name="Sascha Dierkes">sd</who>
    <bug_when>2004-06-19 13:25:36 +0000</bug_when>
    <thetext>The following Exception was thrown:

java.lang.NullPointerException
        at org.apache.catalina.startup.HostConfig.deployDescriptors
(HostConfig.java:490)    

A first analyse of source code:

    protected void deployDescriptors(File configBase, String[] files)

the "files[]" parameter might be null, but is not tested on null in body of 
method. The calling functions also don't check for a null array. Simple 
solution would be:

use:

    protected void deployDescriptors(File configBase, String[] files) {

        if (!deployXML || files==null)
           return;
        [...]

instead of:

    protected void deployDescriptors(File configBase, String[] files) {

        if (!deployXML)
           return;
        [...]

In all cases i found the calling methods use the File.list() mtehod to create 
array without check, but according to J2SE API Doc "null" is allowed as return 
value of "list()", so a check might make sense.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59753</commentid>
    <comment_count>1</comment_count>
    <who name="Sascha Dierkes">sd</who>
    <bug_when>2004-06-23 08:57:38 +0000</bug_when>
    <thetext>After taking a deeper look into source code, there are several more points 
where the files list is not checked against null values.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59861</commentid>
    <comment_count>2</comment_count>
    <who name="Sascha Dierkes">sd</who>
    <bug_when>2004-06-25 08:15:18 +0000</bug_when>
    <thetext>The NPE is actually blocking the whole Tomcat, because of infinite number of 
exceptions (s. log). So could someone please commit the patch I provided 
earlier. It's just simple null value checking.

Thanks,
 Sascha

from LOG:

25.06.2004 10:06:58 
org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor 
processChildren
SCHWERWIEGEND: Exception invoking periodic operation:
java.lang.NullPointerException
        at org.apache.catalina.startup.HostConfig.deployDescriptors
(HostConfig.java:445)
        at org.apache.catalina.startup.HostConfig.deployApps
(HostConfig.java:427)
        at org.apache.catalina.startup.HostConfig.check(HostConfig.java:1064)
        at org.apache.catalina.startup.HostConfig.lifecycleEvent
(HostConfig.java:327)
        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent
(LifecycleSupport.java:119)
        at org.apache.catalina.core.StandardHost.backgroundProcess
(StandardHost.java:800)
        at 
org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChild
ren(ContainerBase.java:1619)
        at 
org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChild
ren(ContainerBase.java:1628)
        at 
org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run
(ContainerBase.java:1608)
        at java.lang.Thread.run(Thread.java:534)
25.06.2004 10:06:58 
org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor 
processChildren
SCHWERWIEGEND: Exception invoking periodic operation:
java.lang.NullPointerException
        at org.apache.catalina.startup.HostConfig.deployDescriptors
(HostConfig.java:445)
        at org.apache.catalina.startup.HostConfig.deployApps
(HostConfig.java:427)
        at org.apache.catalina.startup.HostConfig.check(HostConfig.java:1064)
        at org.apache.catalina.startup.HostConfig.lifecycleEvent
(HostConfig.java:327)
        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent
(LifecycleSupport.java:119)
        at org.apache.catalina.core.StandardHost.backgroundProcess
(StandardHost.java:800)
        at 
org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChild
ren(ContainerBase.java:1619)
        at 
org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChild
ren(ContainerBase.java:1628)
        at 
org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run
(ContainerBase.java:1608)
        at java.lang.Thread.run(Thread.java:534)
25.06.2004 10:06:58 
org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor 
processChildren
SCHWERWIEGEND: Exception invoking periodic operation:
java.lang.NullPointerException
        at org.apache.catalina.startup.HostConfig.deployDescriptors
(HostConfig.java:445)
        at org.apache.catalina.startup.HostConfig.deployApps
(HostConfig.java:427)
        at org.apache.catalina.startup.HostConfig.check(HostConfig.java:1064)
        at org.apache.catalina.startup.HostConfig.lifecycleEvent
(HostConfig.java:327)
        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent
(LifecycleSupport.java:119)
        at org.apache.catalina.core.StandardHost.backgroundProcess
(StandardHost.java:800)
        at 
org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChild
ren(ContainerBase.java:1619)
        at 
org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChild
ren(ContainerBase.java:1628)
        at 
org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run
(ContainerBase.java:1608)
        at java.lang.Thread.run(Thread.java:534)
i</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59885</commentid>
    <comment_count>3</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-06-25 16:47:16 +0000</bug_when>
    <thetext>Hey,

I have made a patch to fix some NPE risks.

also this patch include the xml.mkdir fix.
http://issues.apache.org/bugzilla/show_bug.cgi?id=29038

regards
peter</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59886</commentid>
    <comment_count>4</comment_count>
      <attachid>11947</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-06-25 16:47:48 +0000</bug_when>
    <thetext>Created attachment 11947
HostConfig</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60139</commentid>
    <comment_count>5</comment_count>
    <who name="Sascha Dierkes">sd</who>
    <bug_when>2004-07-05 08:59:26 +0000</bug_when>
    <thetext>As mentioned before the NPE is blocking the tomcat, it's even impossible to 
shut down the server:

Catalina.stop: java.net.SocketException: Broken pipe
java.net.SocketException: Broken pipe
        at java.net.SocketOutputStream.socketWrite0(Native Method)
        at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)
        at java.net.SocketOutputStream.write(SocketOutputStream.java:115)
        at org.apache.catalina.startup.Catalina.stopServer(Catalina.java:414)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke
(NativeMethodAccessorImpl.java:39)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke
(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at org.apache.catalina.startup.Bootstrap.stopServer(Bootstrap.java:333)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:424)

The server shuts down normally if the NPE is not in the log-file, whenever the 
NPE is in the logs, the shutdown script failed with above exception (no need to 
tell me something about killing processes). I would really appreciate if the 
patch could be applied and committed.  Any reason why this didn't happen ? If 
there are any concerns, could you please tell me ?

-Sascha</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60140</commentid>
    <comment_count>6</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-07-05 09:33:33 +0000</bug_when>
    <thetext>Hey,

here my HostConfig.class.

copy to server/classes/org/apache/catalina/startup

regards
peter</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60141</commentid>
    <comment_count>7</comment_count>
      <attachid>12026</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-07-05 09:34:37 +0000</bug_when>
    <thetext>Created attachment 12026
HostConfig with NPE und XML.mkdirs Patch</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61185</commentid>
    <comment_count>8</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-07-27 17:01:12 +0000</bug_when>
    <thetext>*** Bug 30331 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61254</commentid>
    <comment_count>9</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-07-28 16:08:16 +0000</bug_when>
    <thetext>*** Bug 30249 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61540</commentid>
    <comment_count>10</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-08-04 14:38:48 +0000</bug_when>
    <thetext>*** Bug 30462 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62293</commentid>
    <comment_count>11</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-08-21 19:20:34 +0000</bug_when>
    <thetext>Patch applied in TOMCAT_5_0 branch as suggested here.  Modified portions 
applied on CVS HEAD as HostConfig on HEAD has already been significantly 
modified for Tomcat 5.5.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62598</commentid>
    <comment_count>12</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-08-27 16:38:27 +0000</bug_when>
    <thetext>*** Bug 30899 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>11947</attachid>
            <date>2004-06-25 16:47:00 +0000</date>
            <delta_ts>2004-06-25 16:47:48 +0000</delta_ts>
            <desc>HostConfig</desc>
            <filename>HostConfig20040625.patch</filename>
            <type>text/plain</type>
            <size>2944</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>12026</attachid>
            <date>2004-07-05 09:34:00 +0000</date>
            <delta_ts>2004-07-05 09:34:37 +0000</delta_ts>
            <desc>HostConfig with NPE und XML.mkdirs Patch</desc>
            <filename>HostConfig.class</filename>
            <type>application/octet-stream</type>
            <size>16820</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>29727</bug_id>
          
          <creation_ts>2004-06-21 22:56:00 +0000</creation_ts>
          <short_desc>JNDI env-entry not reload when context reloaded</short_desc>
          <delta_ts>2006-09-21 16:58:00 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="robert engels">rengels</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>59696</commentid>
    <comment_count>0</comment_count>
    <who name="robert engels">rengels</who>
    <bug_when>2004-06-21 22:56:25 +0000</bug_when>
    <thetext>If environment entries are changed in web.xml, and the application context is 
restarted, the values in the JNDI context are the old values.

If the environment entries are changed via the Tomcat 'admin' interface, then 
the values provided to the context are correct.

The following code is can be used to check the environment:

        try {
            InitialContext ic = new InitialContext();
            NamingEnumeration enum = ic.listBindings("java:comp/env");

            while (enum.hasMore()) {
                Binding binding = (Binding) enum.next();
                jndi.setProperty(binding.getName(), "" + binding.getObject());
                System.out.println("jndi setting: " + binding.getName() + "=" 
+ binding.getObject());
            }
        } catch (NamingException e) {
            System.err.println("unable to read JNDI settings, " + e);
        }


The web.xml fragment looks as follows:

	&lt;env-entry&gt;
		&lt;env-entry-name&gt;DatabaseURL&lt;/env-entry-name&gt;
		&lt;env-entry-value&gt;jdbc:hsqldb:hsql://localhost&lt;/env-entry-value&gt;
		&lt;env-entry-type&gt;java.lang.String&lt;/env-entry-type&gt;
	&lt;/env-entry&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59704</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-06-22 08:09:44 +0000</bug_when>
    <thetext>The JNDI context is discarded between restarts, so I doubt that this is the
case. I recommend you investigate the issue further.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59716</commentid>
    <comment_count>2</comment_count>
    <who name="robert engels">rengels</who>
    <bug_when>2004-06-22 14:17:30 +0000</bug_when>
    <thetext>as I said, the application works correctly (i.e. the new value is picked up) 
when the environment value is changed via the Tomcat Admin interface, but does 
not work when the value is changed by manually editting the web.xml and 
stop/start the application.

So how can this be an application level problem?

The only thing I can thing of is that it is somehow related to a Classloader 
issue??? But I am not sure why it would work with the Admin interface then.


</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59717</commentid>
    <comment_count>3</comment_count>
    <who name="robert engels">rengels</who>
    <bug_when>2004-06-22 14:21:24 +0000</bug_when>
    <thetext>also, I found someone else reported the same issue on the mailing list...

http://archives.real-time.com/pipermail/tomcat-users/2003-March/103584.html</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63884</commentid>
    <comment_count>4</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-20 15:41:49 +0000</bug_when>
    <thetext>The code as posted can't be compiled: what's the "jndi" variable?

If you post a complete test case, i.e. a WAR file that I can drop into my 
Tomcat installation to reproduce your problem, I'll be glad to look at it.

In addition, can you please test 5.0.28, the latest stable Tomcat 5.0 release 
at the time of this writing?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63916</commentid>
    <comment_count>5</comment_count>
      <attachid>12809</attachid>
    <who name="robert engels">rengels</who>
    <bug_when>2004-09-20 19:46:34 +0000</bug_when>
    <thetext>Created attachment 12809
war file to demonstrate env-entry problem</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63917</commentid>
    <comment_count>6</comment_count>
    <who name="robert engels">rengels</who>
    <bug_when>2004-09-20 19:51:05 +0000</bug_when>
    <thetext>I have posted the war file. I ran the test against 5.0.28 - no change, problem 
still exists. Thanks for looking into this.

To test:

install war in server

browse to &lt;webserver&gt;/&lt;context&gt;/listenv.jsp

-  the current value of the env-entry should be displayed

change the web.xml env-entry using some text editor.

reload the context, or allow tomcat to auto reload on change.

browse to &lt;webserver&gt;/&lt;context&gt;/listenv.jsp (refresh needs to be performed)

-  the OLD value is still displayed

change the env-entry using the tomcat 'admin' web interface. post changes.

browse to &lt;webserver&gt;/&lt;context&gt;/listenv.jsp (refresh needs to be performed)

-  the NEW value is still displayed
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>66158</commentid>
    <comment_count>7</comment_count>
    <who name="Igor">ia_rud</who>
    <bug_when>2004-10-30 06:03:50 +0000</bug_when>
    <thetext>Could you please consider the following modification of
org.apache.catalina.core.NamingContextListener class:

it was:

public void lifecycleEvent(LifecycleEvent event) {
...
            // Binding the naming context to the class loader
            if (container instanceof Context) {
                // Setting the context in read only mode
                ContextAccessController.setReadOnly(getName());
                try {
                    ContextBindings.bindClassLoader
                        (container, container,
                         ((Container)
container).getLoader().getClassLoader());
                } catch (NamingException e) {
                    log(sm.getString("naming.bindFailed", e));
                }
            }
...
}

I think, it should be:


public void lifecycleEvent(LifecycleEvent event) {
...
            // Binding the naming context to the class loader
            if (container instanceof Context) {



               namingResources.addPropertyChangeListener(this);



                // Setting the context in read only mode
                ContextAccessController.setReadOnly(getName());
                try {
                    ContextBindings.bindClassLoader
                        (container, container,
                         ((Container)
container).getLoader().getClassLoader());
                } catch (NamingException e) {
                    log(sm.getString("naming.bindFailed", e));
                }
            }
...
}


Thank you,
Igor</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>66242</commentid>
    <comment_count>8</comment_count>
      <attachid>13292</attachid>
    <who name="Igor">ia_rud</who>
    <bug_when>2004-11-01 14:53:13 +0000</bug_when>
    <thetext>Created attachment 13292
If Environment entry is changed using admin app, the change is not visisble in JNDI. Patch to solve this problem</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>66245</commentid>
    <comment_count>9</comment_count>
    <who name="Igor">ia_rud</who>
    <bug_when>2004-11-01 15:35:28 +0000</bug_when>
    <thetext>Sorry, this patch is wrong :-( Please do not apply it</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>66246</commentid>
    <comment_count>10</comment_count>
    <who name="robert engels">rengels</who>
    <bug_when>2004-11-01 16:05:11 +0000</bug_when>
    <thetext>The comments from Igor are not correct. It works ok if you change the variable
via the admin interface - it does not work if you manually change the web.xml,
and stop/restart the web application.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>67353</commentid>
    <comment_count>11</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-11-22 17:37:01 +0000</bug_when>
    <thetext>Updating version to 5.0.28.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>72882</commentid>
    <comment_count>12</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2005-03-26 04:23:05 +0000</bug_when>
    <thetext>The chances of this getting fixes in Tomcat 5.0.x are now slim.  Can either or
both of you test with 5.5.7 (or 5.5.9 which will be out in a couple of days) and
let us know if it works or not?  That would be great...</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>77536</commentid>
    <comment_count>13</comment_count>
    <who name="Igor">ia_rud</who>
    <bug_when>2005-07-22 07:32:11 +0000</bug_when>
    <thetext>I did a simple test with tomcat 5.5.9. Environment entries are reloaded when 
context is reloaded.

But if I change environment entry in admin application, it is not reloaded. To 
force application to see new entries user will have to reload context, which is 
dangerous operation.

It would be great if application would see new value after changing it in admin 
application too.

(In reply to comment #12)
&gt; The chances of this getting fixes in Tomcat 5.0.x are now slim.  Can either or
&gt; both of you test with 5.5.7 (or 5.5.9 which will be out in a couple of days) 
and
&gt; let us know if it works or not?  That would be great...

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>77537</commentid>
    <comment_count>14</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2005-07-22 07:59:47 +0000</bug_when>
    <thetext>That's pointless: accessing JNDI is costly, and is supposed to be read only in
the first place. As a result, webapps should be reading values, etc, in init,
and that's it.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>77538</commentid>
    <comment_count>15</comment_count>
    <who name="robert engels">rengels</who>
    <bug_when>2005-07-22 08:18:10 +0000</bug_when>
    <thetext>My original bug, is that if the web.xml file is modified (via text editor, etc.)
while the context is running, and the context is restarted, the container is
supposed to detect this and load the new JNDI values.

This is according to the J2EE specification.

This does not occur in 5.0. I have not yet tested with the 5.5 release, but
based on the fact that nothing has been posted as a direct fix for this, I am
fairly certain the problem still exists.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>77558</commentid>
    <comment_count>16</comment_count>
    <who name="Igor">ia_rud</who>
    <bug_when>2005-07-22 15:22:57 +0000</bug_when>
    <thetext>As a developer I want to have possiblity to change environment entries without 
restarting, reloading ... My application should work 24/7 and I do not want to 
restart or reload application because of I need to change only one parameter.

Environment entries are very convinient to store init parameters. And I do not 
want to change parameters too often. But it would be nice if I could change 
something in application parameters without restart.

I can "change" environment entries in admin application. What is this feature 
for, if it do not do anything, just changes value in admin?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>77565</commentid>
    <comment_count>17</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2005-07-22 16:09:49 +0000</bug_when>
    <thetext>This can be done via JMX. Assume you have a webapp called /myapp with a JNDI
environment string called i/need. It can be queried via the JMPXproxy in the
manager app. Here's the ouput example:

Name:
Catalina:type=Environment,resourcetype=Context,path=/myapp,host=localhost,name=i/need
modelerType: org.apache.catalina.mbeans.ContextEnvironmentMBean
className: org.apache.catalina.deploy.ContextEnvironment
name: i/need
override: false
type: java.lang.String
value: less cowbell

So your search URL would be (unescaped for readability ...)
http://localhost/manager/jmxproxy?qry=Catalina:type=Environment,resourcetype=Context,path=/myapp,host=localhost,name=i/need

And can be set via
http://localhost/manager/jmxproxy?set=Catalina:type=Environment,resourcetype=Context,path=/myapp,host=localhost,name=i/need&amp;att=value&amp;val=more+cowbell

More information:
http://jakarta.apache.org/tomcat/tomcat-5.0-doc/manager-howto.html#What%20is%20JMX%20Proxy%20Servlet
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>77566</commentid>
    <comment_count>18</comment_count>
    <who name="robert engels">rengels</who>
    <bug_when>2005-07-22 16:18:19 +0000</bug_when>
    <thetext>Reopening bug. you cannot close as won't fix. your solution is not related to
this bug. This is a different bug, in that manual changes made to a web.xml
file, are not seen in the JNDI environment after a context restart. This is not
adhering to the J2EE specification.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>77571</commentid>
    <comment_count>19</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2005-07-22 16:24:41 +0000</bug_when>
    <thetext>Sure I can close the bug ;) This will not be fixed.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>77573</commentid>
    <comment_count>20</comment_count>
    <who name="robert engels">rengels</who>
    <bug_when>2005-07-22 16:34:40 +0000</bug_when>
    <thetext>Sorry, but you are an idiot, or have very little reading comprehension skills.

This bug needs to be fixed, it is not J2EE compliant. You do not need to fix the
request in comment #13, that changes are visible in the JNDI context without a
reload when changes are made via the admin interface. There is not in J2EE that
states that a container must update the JNDI context in real-time, but not sure
that the feature wouldn't be helpful as Igor has pointed out.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>77575</commentid>
    <comment_count>21</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2005-07-22 16:45:54 +0000</bug_when>
    <thetext>(In reply to comment #20)
&gt; Sorry, but you are an idiot

That sounds good to me :)

To translate since you apparently have very little general comprehension skills,
this minor issue will not be fixed in the 5.0.x branch.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>77581</commentid>
    <comment_count>22</comment_count>
    <who name="robert engels">rengels</who>
    <bug_when>2005-07-22 16:59:30 +0000</bug_when>
    <thetext>How is it a minor issue? Do you run any large, multiple server, sites at all? It
is fairly common to update deployed application by copying new web.xml files to
the deployment directories, and then use the Tomcat weburl to restart the context.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>93802</commentid>
    <comment_count>23</comment_count>
    <who name="robert engels">rengels</who>
    <bug_when>2006-09-19 17:53:10 +0000</bug_when>
    <thetext>Why is this bug not moved to the 5.5 branch then?

The J2EE specification states that the JNDI variables for an application are
reloaded during a CONTEXT RESTART. This is the only way for init() methods in a
servlet to retrieve any changed values.

This bug is NOT related to Igor's comments where he wants JNDI changes to be
visible as they are made.

For what it is worth, I tested this behavior with Jetty and it works as expected.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>93892</commentid>
    <comment_count>24</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2006-09-20 01:52:52 +0000</bug_when>
    <thetext>Tested against 5.5.x and is still present. I am working on a fix...

Note, I am only considering the original bug report.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>93984</commentid>
    <comment_count>25</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2006-09-21 23:58:00 +0000</bug_when>
    <thetext>This is fixed in svn and will be in 5.5.21 onwards.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>12809</attachid>
            <date>2004-09-20 19:46:00 +0000</date>
            <delta_ts>2004-09-20 19:46:34 +0000</delta_ts>
            <desc>war file to demonstrate env-entry problem</desc>
            <filename>tomcatbug.war</filename>
            <type>application/octet-stream</type>
            <size>1048</size>
            <attacher name="robert engels">rengels</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>13292</attachid>
            <date>2004-11-01 14:53:00 +0000</date>
            <delta_ts>2004-11-01 14:53:13 +0000</delta_ts>
            <desc>If Environment entry is changed using admin app, the change is not visisble in JNDI. Patch to solve this problem</desc>
            <filename>NamingContextListener.patch</filename>
            <type>text/plain</type>
            <size>488</size>
            <attacher name="Igor">ia_rud</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>29779</bug_id>
          
          <creation_ts>2004-06-24 06:00:00 +0000</creation_ts>
          <short_desc>Package Path wrong at admin class SetCharacterEncodingFilter</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Administration</component>
          <version>5.0.25</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Peter Rossbach">pr</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>59820</commentid>
    <comment_count>0</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-06-24 06:00:42 +0000</bug_when>
    <thetext>HEy,

At Admin the Class SetCharcterEncodingFilter has wrong package path.

regards 
Peter</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59821</commentid>
    <comment_count>1</comment_count>
      <attachid>11938</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-06-24 06:01:57 +0000</bug_when>
    <thetext>Created attachment 11938
correct package path</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61058</commentid>
    <comment_count>2</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-07-23 14:03:55 +0000</bug_when>
    <thetext>Fixed, thanks.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>11938</attachid>
            <date>2004-06-24 06:01:00 +0000</date>
            <delta_ts>2004-06-24 06:01:57 +0000</delta_ts>
            <desc>correct package path</desc>
            <filename>SetCharacterEncodingFilter.patch</filename>
            <type>text/plain</type>
            <size>775</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>29826</bug_id>
          
          <creation_ts>2004-06-27 14:12:00 +0000</creation_ts>
          <short_desc>Installation always exits with an error code.</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.25</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Assaf Flatto">assaf</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>59947</commentid>
    <comment_count>0</comment_count>
    <who name="Assaf Flatto">assaf</who>
    <bug_when>2004-06-27 14:12:37 +0000</bug_when>
    <thetext>when running the tomcat installation from an NSIS script , the installation 
always returns an error code to the main script .
example :
----------------------------------------------------------------------------
NoJInstall:
IfErrors 0 NoAbort
    MessageBox MB_OK "Couldn't find a Tomcat Jakarta Web server installed. 
Setup will now install a FOO required Jakarta ."
    DetailPrint "Couldn't find a Tomcat Jakarta Web server installed. Setup 
will now install a Foo required Jakarta ."
    execwait "C:\jakarta-tomcat-5.0.25.exe"
    IfErrors 0 Problem

 Problem:
      Sleep 300
      Abort
------------------------------------------------------------------------
when finishing the jakarta installer , there are two check boxes , at first i 
thought that unmarking them caused the error , but in a second try i left them 
marked and the same error happened.

i think the error is generated by the "close" button in the end of the install.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60169</commentid>
    <comment_count>1</comment_count>
      <attachid>12034</attachid>
    <who name="Andrew Boyer">apache</who>
    <bug_when>2004-07-06 04:03:10 +0000</bug_when>
    <thetext>Created attachment 12034
New setclasspath.bat</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60170</commentid>
    <comment_count>2</comment_count>
      <attachid>12035</attachid>
    <who name="Andrew Boyer">apache</who>
    <bug_when>2004-07-06 04:03:41 +0000</bug_when>
    <thetext>Created attachment 12035
New catalina.bat</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60171</commentid>
    <comment_count>3</comment_count>
    <who name="Andrew Boyer">apache</who>
    <bug_when>2004-07-06 04:06:22 +0000</bug_when>
    <thetext>This problem is due to the call to exit in setclasspath.bat.  The syntax should probably be "exit /b 
errorlevel".  There's also a typo in catalina.bat, CURRENT_DIR vs. %CURRENT_DIR%.  I've attached 
proposed fixes for the two files.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61132</commentid>
    <comment_count>4</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-07-26 15:37:02 +0000</bug_when>
    <thetext>Thank you for reporting this bug and posting patches.  I've applied the 
setclasspath exit code patch.  The catalina.bat %current_dir% one was already 
applied in 5.0.26 or 5.0.27, so no action needed there.

In the future, if possible post diff patches rather than the full file.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>12034</attachid>
            <date>2004-07-06 04:03:00 +0000</date>
            <delta_ts>2004-07-06 04:03:10 +0000</delta_ts>
            <desc>New setclasspath.bat</desc>
            <filename>setclasspath.bat</filename>
            <type>text/plain</type>
            <size>2039</size>
            <attacher name="Andrew Boyer">apache</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>12035</attachid>
            <date>2004-07-06 04:03:00 +0000</date>
            <delta_ts>2004-07-06 04:03:41 +0000</delta_ts>
            <desc>New catalina.bat</desc>
            <filename>catalina.bat</filename>
            <type>text/plain</type>
            <size>7345</size>
            <attacher name="Andrew Boyer">apache</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>29831</bug_id>
          
          <creation_ts>2004-06-27 23:09:00 +0000</creation_ts>
          <short_desc>Support for boolean property in bean factory</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.0.25</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Sam Meder">meder</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>59958</commentid>
    <comment_count>0</comment_count>
    <who name="Sam Meder">meder</who>
    <bug_when>2004-06-27 23:09:49 +0000</bug_when>
    <thetext>The attached patch adds support for boolean properties to the BeanFactory.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>59959</commentid>
    <comment_count>1</comment_count>
      <attachid>11966</attachid>
    <who name="Sam Meder">meder</who>
    <bug_when>2004-06-27 23:10:28 +0000</bug_when>
    <thetext>Created attachment 11966
Add boolean property support to BeanFactory</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61134</commentid>
    <comment_count>2</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-07-26 15:40:48 +0000</bug_when>
    <thetext>Done, thanks.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>11966</attachid>
            <date>2004-06-27 23:10:00 +0000</date>
            <delta_ts>2004-06-27 23:10:28 +0000</delta_ts>
            <desc>Add boolean property support to BeanFactory</desc>
            <filename>boolean.patch</filename>
            <type>text/plain</type>
            <size>940</size>
            <attacher name="Sam Meder">meder</attacher>
            

          </attachment>
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>29866</bug_id>
          
          <creation_ts>2004-06-30 10:03:00 +0000</creation_ts>
          <short_desc>JspReader#skipUntil may try to read beyond the end of the file</short_desc>
          <delta_ts>2005-01-11 06:00:13 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.25</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Stefan Bodewig">bodewig</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>funkman</cc>
    
    <cc>zikmund</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>60056</commentid>
    <comment_count>0</comment_count>
    <who name="Stefan Bodewig">bodewig</who>
    <bug_when>2004-06-30 10:03:28 +0000</bug_when>
    <thetext>I'll attach a very simple JSP to reproduce the problem.

If you have a JSP that contains at least one '&lt;' character and ends with a ':'
Jasper will die with an ArrayIndexOutOfBoundsException in JspReader#peekChar.

Digging deeper I see that the situation I describe will invoke
JspWriter.skipUntil(":root").  This will match the colon as the last char and
then invoke peekChar unconditionally.

I think peekChar should have a 

	if (!hasMoreInput())
	    return -1;

block on top just like nextChar, but I didn't look close enough to be sure this
wouldn't cause bad side effects.

Stack trace looks like this:

java.lang.ArrayIndexOutOfBoundsException: 6
        at org.apache.jasper.compiler.JspReader.peekChar(JspReader.java:156)
        at org.apache.jasper.compiler.JspReader.skipUntil(JspReader.java:281)
        at
org.apache.jasper.compiler.ParserController.hasJspRoot(ParserController.java:538)
        at
org.apache.jasper.compiler.ParserController.determineSyntaxAndEncoding(ParserController.java:369)
        at
org.apache.jasper.compiler.ParserController.doParse(ParserController.java:170)
        at
org.apache.jasper.compiler.ParserController.parse(ParserController.java:101)
        at org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:203)
        at org.apache.jasper.compiler.Compiler.compile(Compiler.java:461)
        at org.apache.jasper.compiler.Compiler.compile(Compiler.java:442)
        at org.apache.jasper.compiler.Compiler.compile(Compiler.java:430)
        at
org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:511)
        at
org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:274)
        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:292)
        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:236)
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:810)
        at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:237)
        at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:157)
        at
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:214)
        at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:104)
        at
org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:520)
        at
org.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:198)
        at
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:152)
        at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:104)
        at
org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:520)
        at
org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:137)
        at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:104)
        at
org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:117)
        at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:102)
        at
org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:520)
        at
org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)
        at
org.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:104)
        at
org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:520)
        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:929)
       at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:160)
        at
org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:793)
        at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:702)
        at
org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:571)
        at
org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:644)
        at java.lang.Thread.run(Thread.java:534)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60057</commentid>
    <comment_count>1</comment_count>
      <attachid>11995</attachid>
    <who name="Stefan Bodewig">bodewig</who>
    <bug_when>2004-06-30 10:04:56 +0000</bug_when>
    <thetext>Created attachment 11995
simple JSP that demonstrates the problem.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60058</commentid>
    <comment_count>2</comment_count>
    <who name="Stefan Bodewig">bodewig</who>
    <bug_when>2004-06-30 10:05:46 +0000</bug_when>
    <thetext>Note that there is no newline at the end of the attached file, the colon has to be
the very last character.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60098</commentid>
    <comment_count>3</comment_count>
    <who name="Stefan Bodewig">bodewig</who>
    <bug_when>2004-07-02 15:37:09 +0000</bug_when>
    <thetext>Now that bugzilla notifications work again, I'll add a random comment to raise
awareness ;-)

The most simple JSP to demonstrate the bug consists of a single &lt; character, two
characters &lt;: will work as well.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61202</commentid>
    <comment_count>4</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-07-27 22:06:46 +0000</bug_when>
    <thetext>I didn't have problems with &lt;: or &lt;br/&gt;:, though I did got the exception with &lt;.

Fixed in CVS.  Thanks for reporting and the suggested fix.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>66554</commentid>
    <comment_count>5</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-11-05 19:28:24 +0000</bug_when>
    <thetext>*** Bug 32044 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>67116</commentid>
    <comment_count>6</comment_count>
    <who name="Stefan Bodewig">bodewig</who>
    <bug_when>2004-11-18 10:15:53 +0000</bug_when>
    <thetext>Kin-Man, it appears that you've only fixed CVS HEAD since the problem still appears
in 5.0.28 and 5.0.29.

I know that 5.5.x is supposed to be the new product line now, but is there any
chance you could merge the fix into the TOMCAT_5_0 branch so a potential future
version of the 5.0.x series picks it up?

I'm currently getting a different kind of problem with 5.5.x (report will follow
once I have analyzed it) so upgrading is not an option for me right now.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>67149</commentid>
    <comment_count>7</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-11-18 16:45:37 +0000</bug_when>
    <thetext>Reopening bug for Tomcat 5.0.30 as a reminder to myself.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>67229</commentid>
    <comment_count>8</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-11-19 16:17:45 +0000</bug_when>
    <thetext>OK, fix ported to 5.0.30.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>69531</commentid>
    <comment_count>9</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2005-01-11 15:00:13 +0000</bug_when>
    <thetext>*** Bug 33042 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>11995</attachid>
            <date>2004-06-30 10:04:00 +0000</date>
            <delta_ts>2004-06-30 10:04:56 +0000</delta_ts>
            <desc>simple JSP that demonstrates the problem.</desc>
            <filename>foo.jsp</filename>
            <type>text/plain</type>
            <size>6</size>
            <attacher name="Stefan Bodewig">bodewig</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>29869</bug_id>
          
          <creation_ts>2004-06-30 13:11:00 +0000</creation_ts>
          <short_desc>Better support for JSR 77 state notfications at Context and Wrapper</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.25</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Peter Rossbach">pr</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>60063</commentid>
    <comment_count>0</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-06-30 13:11:40 +0000</bug_when>
    <thetext>Hey,

I have see that context and wrapper has a implement
a NotificationBroadcaster to send JSR 77 complaint
state information 

Problem is: We can't register a NotificationListener.


I have tested with MX4J 2.0.1
Tomcat current CVS Head

One problem still exists:

I can only register the Listener directly and not with
the mbeanserver.addNotificationListener() methods.

access code example:
try {
   ObjectName managercontext = new ObjectName(
				
"Catalina:j2eeType=WebModule,name=//localhost/,J2EEApplication=none,J2EEServer=none");
   log.info(managercontext);
// work		    
   StandardContext context =(StandardContext) 
        mserver.getAttribute(managercontext, "managedResource");
   context.addNotificationListener(this, null, null);
// not work
// log.info(context.getName() + ".(" +context.getDocBase() + ")");
// mserver.addNotificationListener(managercontext,this,null,null);
   log.info("Notfication to ROOT added");
} catch (Exception e) {
    log.error(e);
}

Other strange things:
a)   it is a problem to get the j2ee.state.starting message.
     No chance to register before manager or autodeployment procedure
     create and start context or wrapper!
b)   Context destroy is not called at StandardHostDeployer!
     j2ee.state.deleted to emitted.
     Clear/remove NotificationBroadcaster is not implemened at destroy.

See my patches (base implementations. :-)

regards
Peter</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60064</commentid>
    <comment_count>1</comment_count>
      <attachid>11997</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-06-30 13:12:44 +0000</bug_when>
    <thetext>Created attachment 11997
StandardContext with NotifcationEmitter support</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60065</commentid>
    <comment_count>2</comment_count>
      <attachid>11998</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-06-30 13:13:10 +0000</bug_when>
    <thetext>Created attachment 11998
StandardWrapper with NotifcationEmitter support</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61320</commentid>
    <comment_count>3</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-07-29 16:06:48 +0000</bug_when>
    <thetext>Patch committed (by Remy, I'm just cleaning up Bugzilla).  Thanks for 
contriburing it.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>11997</attachid>
            <date>2004-06-30 13:12:00 +0000</date>
            <delta_ts>2004-06-30 13:12:44 +0000</delta_ts>
            <desc>StandardContext with NotifcationEmitter support</desc>
            <filename>StandardContext20040630.patch</filename>
            <type>text/plain</type>
            <size>4902</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>11998</attachid>
            <date>2004-06-30 13:13:00 +0000</date>
            <delta_ts>2004-06-30 13:13:10 +0000</delta_ts>
            <desc>StandardWrapper with NotifcationEmitter support</desc>
            <filename>StandardWrapper20040630.patch</filename>
            <type>text/plain</type>
            <size>4529</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>29887</bug_id>
          
          <creation_ts>2004-07-02 14:59:00 +0000</creation_ts>
          <short_desc>Recursive Tag files modification check causes StackOverflowError</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.25</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Robert Krüger">krueger</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>ohollander</cc>
          <votes>1</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>60096</commentid>
    <comment_count>0</comment_count>
    <who name="Robert Krüger">krueger</who>
    <bug_when>2004-07-02 14:59:47 +0000</bug_when>
    <thetext>Recursive Tag files modification check causes StackOverflowError presumably
because a tag file making use of itself is added to the list of its dependents,
causing the modification check to loop infinitely. See attached test case.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60097</commentid>
    <comment_count>1</comment_count>
      <attachid>12014</attachid>
    <who name="Robert Krüger">krueger</who>
    <bug_when>2004-07-02 15:00:53 +0000</bug_when>
    <thetext>Created attachment 12014
test app with instructions to reproduce the bug</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60186</commentid>
    <comment_count>2</comment_count>
    <who name="Robert Krüger">krueger</who>
    <bug_when>2004-07-06 10:21:44 +0000</bug_when>
    <thetext>I'm adding a patch that works around the problem by not allowing the recursive
dependency to be added to the page. This is rather dealing with the symptoms
than a good solution but it solves and might help to illustrate my current problem.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60577</commentid>
    <comment_count>3</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-07-13 22:53:15 +0000</bug_when>
    <thetext>I don't see any patch.  Anyway, not allowing recursive dependencies to be added
to the page actually works, and is the simplest solution.  Fixed in CVS.

Thanks for reporting this bug.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60691</commentid>
    <comment_count>4</comment_count>
    <who name="Robert Krüger">krueger</who>
    <bug_when>2004-07-16 11:36:52 +0000</bug_when>
    <thetext>Oops, obviously forgot to upload the patch. Your fix makes absolute sense.
Thanks for yet another quick reaction!</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65135</commentid>
    <comment_count>5</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-10-14 17:16:39 +0000</bug_when>
    <thetext>*** Bug 31382 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65165</commentid>
    <comment_count>6</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-10-14 23:58:47 +0000</bug_when>
    <thetext>There is still a problem with recompiling recursive tag file, but not with
Argen's test case from 31382.  The problem occurs only for indiret recursive tag
files (t.tag uses t2.tag which use t.tag), and it occurs not during dependency
checking, but in the JSP compilation itself.

This is now fixed in CVS.  Thanks for being persistent. :)</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>12014</attachid>
            <date>2004-07-02 15:00:00 +0000</date>
            <delta_ts>2004-07-02 15:00:53 +0000</delta_ts>
            <desc>test app with instructions to reproduce the bug</desc>
            <filename>recursebug-testapp.zip</filename>
            <type>application/octet-stream</type>
            <size>265177</size>
            <attacher name="Robert Krüger">krueger</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>29914</bug_id>
          
          <creation_ts>2004-07-05 07:50:00 +0000</creation_ts>
          <short_desc>StandardServer.storeConfig() not saved DefaultContext Listeners</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.25</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Peter Rossbach">pr</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>60138</commentid>
    <comment_count>0</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-07-05 07:50:34 +0000</bug_when>
    <thetext>Hey,

storeDefaultContext()
===========================================
Hey,

I implement a new store server.xml mechanisnm and detectet following strange
behaviour: 

Config 

&lt;DefaultContext&gt;
   &lt;Listener className="org.apache.catalina.listener.InfoLifecycleListener"/&gt;
&lt;/DefaultContext&gt;

are not saved with StandardServer.storeConfig()

1) wrong Lifecycle Listener storage
	StandardDefaultContext not implement Lifecycle.
	Reason: the configuered LifecycleListener not saved at DefaultContext instead
	all Listener saved at every Context. Hups!
	
	s. StandardDefaultContext.installDefaultContext addLifecycleListener
	
	This store mechaismn generate an error situation after deploy new applications

Hmm at my implementation I made following changes:
- delete the Lifecycle instanceof check 
- check every Listener at context
there are not at Engine or Host DefaultContext!
- Also check
2) ResourceLink not saved at storeNamingResource
	correct for GlobalNamingResource but wrong for DefaultContext and Context

3)  After storeConfig the DefaultContext looks like this
       &lt;DefaultContext
className="org.apache.catalina.core.StandardDefaultContext" reloadable="true"&gt;

     strange effect this class is included at the skippables[] array!

regards
Peter</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60142</commentid>
    <comment_count>1</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-07-05 09:41:16 +0000</bug_when>
    <thetext>Hey,


can we change the Listener Event handling to context.
Instead add the Lifcycle Listener from DefaultContext to Context
better call all Listener add DefaultContext at 

Implement a spezial LifecycleSupport class to
handle StandardContext.fireLifecycleEvent() with DefaultCOntext Lifecycle Listeners.


regards
Peter
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60279</commentid>
    <comment_count>2</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-07-08 08:54:55 +0000</bug_when>
    <thetext>Before we can implemented a better defaultContext support
we must add removeLifecycleListener and findLifecycleListeners.

regards
peter

s. Patch
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60281</commentid>
    <comment_count>3</comment_count>
      <attachid>12058</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-07-08 08:59:57 +0000</bug_when>
    <thetext>Created attachment 12058
Better LifecycleListenerSupport at DefaultContext</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60283</commentid>
    <comment_count>4</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-07-08 09:09:13 +0000</bug_when>
    <thetext>Szenario:
DefaultContext with LifecycleListener info
start context
stop context
start context

Hups:
Now the context have two DefaultContext Listener info

Problem is: That installDefaultContext() called at every context start, but
the DefaultContext LifecycleListener not delete at stop!

Regards
Peter

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60284</commentid>
    <comment_count>5</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-07-08 09:20:37 +0000</bug_when>
    <thetext>
At which use case the follwing code at
StandardDefaultContext.importDefaultContext() make sense?

       if (!(context instanceof StandardContext)) {
            ContextEjb [] contextEjb = findEjbs();

I thing the NamingContextListener transfer all DefaultContext information.
after DefaultContext get the lifecycleEvent.

Strange is the addLocalEjb at NamingContextListener is not yet implemented...

regards
peter
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61265</commentid>
    <comment_count>6</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-07-28 17:37:16 +0000</bug_when>
    <thetext>Dude, please get out of the habit of using Bugzilla as a conversation forum, 
especially with yourself ;)  Use the mailing lists to discuss bugs and 
enhancements, approaches to them, and iterations.  Only post the final 
iteration to Bugzilla if possible.  That makes it much easier for us to 
evaluate and commit your suggestions.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63060</commentid>
    <comment_count>7</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-03 18:23:50 +0000</bug_when>
    <thetext>OK, patch applied on TOMCAT_5_0 branch.  It's not relevant to Tomcat 5.5 (see 
DefaultContext replacement discussions on tomcat-dev for that).</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>12058</attachid>
            <date>2004-07-08 08:59:00 +0000</date>
            <delta_ts>2004-07-08 08:59:57 +0000</delta_ts>
            <desc>Better LifecycleListenerSupport at DefaultContext</desc>
            <filename>StandardDefaultContext20040708.patch</filename>
            <type>text/plain</type>
            <size>1450</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>29923</bug_id>
          
          <creation_ts>2004-07-05 22:55:00 +0000</creation_ts>
          <short_desc>localized resources for example servlets in Portuguese</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Examples</component>
          <version>Unknown</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Joao Medeiros">jmedeiros</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>60165</commentid>
    <comment_count>0</comment_count>
    <who name="Joao Medeiros">jmedeiros</who>
    <bug_when>2004-07-05 22:55:12 +0000</bug_when>
    <thetext># Copyright 2004 The Apache Software Foundation
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# $Id: LocalStrings_pt.properties,v 1.2 2004/07/05 16:40:33 jmedeiro Exp $

# Default localized resources for example servlets
# This locale is pt_PT

helloworld.title=Ola Mundo!

requestinfo.title=Exemplo da Informacao do Pedido
requestinfo.label.method=Metodo:
requestinfo.label.requesturi=URI do Pedido:
requestinfo.label.protocol=Protocolo:
requestinfo.label.pathinfo=Informacao do Caminho:
requestinfo.label.remoteaddr=Endereco Remoto:

requestheader.title=Exemplo da Cebeceira do Pedido

requestparams.title=Examplo de Parametros do Pedido
requestparams.params-in-req=Parametros neste pedido:
requestparams.no-params=Sem Parametros, Por favor entre alguns
requestparams.firstname=Primeiro Nome:
requestparams.lastname=Apelido:

cookies.title=CExamplo de Cookies
cookies.cookies=O se browser esta a enviar os seguintes cookies:
cookies.no-cookies=O seu browser nao esta a enviar nenhuns cookies
cookies.make-cookie=Crie um cookie para enviar para o seu browser
cookies.name=Nome:
cookies.value=Valor:
cookies.set=Acabou de enviar o seguinte cookie para o seu browser:

sessions.title=Examplo de sessoes
sessions.id=Identificador da Sessao:
sessions.created=Criada:
sessions.lastaccessed=Ultima vez acedida:
sessions.data=Os seguintes dados fazem parte da sua sessao:
sessions.adddata=Adicione data a sua sessao
sessions.dataname=Nome do atributo da sessao:
sessions.datavalue=Valor do atributo da Sessao:</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60177</commentid>
    <comment_count>1</comment_count>
      <attachid>12038</attachid>
    <who name="Joao Medeiros">jmedeiros</who>
    <bug_when>2004-07-06 07:25:53 +0000</bug_when>
    <thetext>Created attachment 12038
Localised Strings in Portuguese</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61260</commentid>
    <comment_count>2</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-07-28 17:18:13 +0000</bug_when>
    <thetext>I requested on tomcat-dev that someone with jakarta-servletapi-5 commit this.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62421</commentid>
    <comment_count>3</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2004-08-24 18:46:38 +0000</bug_when>
    <thetext>Commited. Thanks Yoav for the push ;-)</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>12038</attachid>
            <date>2004-07-06 07:25:00 +0000</date>
            <delta_ts>2004-07-06 07:25:53 +0000</delta_ts>
            <desc>Localised Strings in Portuguese</desc>
            <filename>LocalStrings_pt.properties</filename>
            <type>text/plain</type>
            <size>2057</size>
            <attacher name="Joao Medeiros">jmedeiros</attacher>
            

          </attachment>
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>29936</bug_id>
          
          <creation_ts>2004-07-06 15:18:00 +0000</creation_ts>
          <short_desc>XML parser loading problems by container</short_desc>
          <delta_ts>2008-07-30 11:06:36 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.5.23</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>blocker</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="peter neville">p_nevilleuk</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>daniel.spilker</cc>
    
    <cc>ecapachedev</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>60195</commentid>
    <comment_count>0</comment_count>
    <who name="peter neville">p_nevilleuk</who>
    <bug_when>2004-07-06 15:18:51 +0000</bug_when>
    <thetext>I'm trying to use JSTL 1.1 with this version of tomcat and have both saxon and 
crimson in my web-app.

If we have crimson and saxon in our webapp lib then tomcat tries to use crimson 
as the xml parser when reading the web.xml and compiling the jsp and we get the 
prefix error:

org.apache.jasper.JasperException: &lt;h3&gt;Validation error messages from 
TagLibraryValidator for c&lt;/h3&gt;&lt;p&gt;null: java.lang.IllegalStateException: can't 
declare any more prefixes in this context&lt;/p&gt;&lt;h3&gt;Validation error messages from 
TagLibraryValidator for fmt&lt;/h3&gt;&lt;p&gt;null: java.lang.IllegalStateException: can't 
declare any more prefixes in this context&lt;/p&gt;

If we remove crimson, tomcat uses saxon (aelfred parser) and this fails on 
reading the web.xml (javax.xml.parsers.ParserConfigurationException: AElfred 
parser is namespace-aware)

If we remove saxon and crimson then we are okay (defaults to xerces in the 
tomcat endorsed directory?)

It seems to me that tomcat is using the parser in my web-app to read the 
web.xml rather than using xerces from the endorsed directory.  

The same web-app runs without problems in version 5.0.16.  

Tomcat seems to be using the service provider mechanism in 5.0.25 as I have 
property files in C:\Java\jakarta-tomcat-5.0.25
\work\Catalina\localhost\diabetes\loader\META-INF\services (can't find any 
documents on this).

If I'm using more than one parser won't this cause problems as tomcat is 
setting only one parser and xslt processor here?

Any comments are gratefully received.

Thanks,
Peter Neville</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60196</commentid>
    <comment_count>1</comment_count>
    <who name="peter neville">p_nevilleuk</who>
    <bug_when>2004-07-06 15:21:39 +0000</bug_when>
    <thetext>BTW: Java SDK is version 1.4.2_01</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60198</commentid>
    <comment_count>2</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-07-06 15:52:31 +0000</bug_when>
    <thetext>I am afraid if you want this resolved, you'll have to investigate this further.
One thing which really hurts your report is the fact that this would be a
classloader issue, and yet there is no relevant functional changes in the
classloader since 5.0.16.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60201</commentid>
    <comment_count>3</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2004-07-06 16:02:18 +0000</bug_when>
    <thetext>Are you sure you haven't duplicated the tagdef in the JSP multiple times?

For example - this would cause an error:
&lt;%@ taglib uri="http://java.sun.com/jstl/core/c.tld" prefix="c" %&gt;
&lt;%@ taglib uri="http://java.sun.com/jstl/core/c.tld" prefix="c" %&gt;

Or this:
&lt;%@ taglib uri="http://java.sun.com/jstl/core/c.tld" prefix="c" %&gt;
&lt;%@include page="foo.jsp"%&gt; 

where foo.jsp also has:
&lt;%@ taglib uri="http://java.sun.com/jstl/core/c.tld" prefix="c" %&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60219</commentid>
    <comment_count>4</comment_count>
    <who name="peter neville">p_nevilleuk</who>
    <bug_when>2004-07-07 07:57:06 +0000</bug_when>
    <thetext>Remy: You mention that there hasn;t been any classloader chnages since 5.0.16, 
but to the best of my knowledge 5.0.16 did not store service provider details 
in the apache work/catalina/localhost/webapp/loader sub-directories.
Are there any explanations on this available?

Tim:

The taglibs are declared as:

&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %&gt;
&lt;%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %&gt;

So not multiple declarations - there ins aninclude but this doesn't use taglibs.

The problem is instantly resolved by removing saxon and crimson from the web-
app lib.


Thanks for your help so far...</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60221</commentid>
    <comment_count>5</comment_count>
    <who name="peter neville">p_nevilleuk</who>
    <bug_when>2004-07-07 08:20:53 +0000</bug_when>
    <thetext>Also, I must set my web.xml for the web-app to :
&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;web-app xmlns="http://java.sun.com/xml/ns/j2ee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee web-app_2_4.xsd"
    version="2.4"&gt;

instead of :

&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;!DOCTYPE web-app
    PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
    "http://java.sun.com/dtd/web-app_2_3.dtd"&gt;
&lt;web-app&gt;


Otherwise tomcat gives errors when compiling the jsp indicating that it can't 
find bean properties etc.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60242</commentid>
    <comment_count>6</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-07-07 14:49:47 +0000</bug_when>
    <thetext>If you don't know what 5.0.16 has and what it does not have, I think you need to
check the CVS history. I really cannot see anything I'd like to test in this bug
report (except the usual: we don't support replacing the XML provider, except
using the JVM provided mechanism).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60557</commentid>
    <comment_count>7</comment_count>
    <who name="Eliot Stock">themoney</who>
    <bug_when>2004-07-13 17:19:49 +0000</bug_when>
    <thetext>for what it's worth I'm seeing the same thing with:

tomcat 5.0.25
jstl 1.1
j2dsk 1.4.2_05
linux

for a web app that has crimson in the WEB-INF/lib. Removing the JAR that
contains crimson fixes it. It's surprising to me that tomcat is using the parser
it finds in the web app for web.xml and JSP compilation - not what I'd expect
and will probably trip other people up the same way.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>104176</commentid>
    <comment_count>8</comment_count>
    <who name="Eddy Chan">ecapachedev</who>
    <bug_when>2007-06-07 12:15:01 +0000</bug_when>
    <thetext>This issue is also prevalent in 5.5.x.  To reproduce, do the following:

1) Remove all stock webapps that come with the standard installation.  This
includes the ones in server/webapps.  Remember to remove the configurations in
conf/Catalina.
2) Add a webapp that has a saxon parser located in WEB-INF/lib.  For instance,
one from sourceforge.
3) Start Tomcat.  You should a stack trace similar to this:

Jun 7, 2007 11:33:29 AM org.apache.commons.digester.Digester getParser
SEVERE: Digester.getParser: 
javax.xml.parsers.ParserConfigurationException: AElfred parser is namespace-aware
	at
com.icl.saxon.aelfred.SAXParserFactoryImpl.newSAXParser(SAXParserFactoryImpl.java:37)
	at org.apache.commons.digester.Digester.getParser(Digester.java:686)
	at org.apache.commons.digester.Digester.getXMLReader(Digester.java:902)
	at org.apache.commons.digester.Digester.parse(Digester.java:1548)
	at org.apache.catalina.startup.ContextConfig.defaultConfig(ContextConfig.java:515)
	at org.apache.catalina.startup.ContextConfig.start(ContextConfig.java:623)
	at org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:216)
	at
org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)
	at org.apache.catalina.core.StandardContext.start(StandardContext.java:4290)
	at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:823)
	at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:807)
	at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:595)
	at
org.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:277)
	at org.apache.catalina.core.StandardHost.install(StandardHost.java:832)
	at org.apache.catalina.startup.HostConfig.deployWARs(HostConfig.java:625)
	at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:431)
	at org.apache.catalina.startup.HostConfig.start(HostConfig.java:983)
	at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:349)
	at
org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)
	at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1091)
	at org.apache.catalina.core.StandardHost.start(StandardHost.java:789)
	at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1083)
	at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:478)
	at org.apache.catalina.core.StandardService.start(StandardService.java:480)
	at org.apache.catalina.core.StandardServer.start(StandardServer.java:2313)
	at org.apache.catalina.startup.Catalina.start(Catalina.java:556)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:287)
	at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:425)
Jun 7, 2007 11:33:29 AM org.apache.catalina.startup.ContextConfig defaultConfig
SEVERE: Parse error in default web.xml
java.lang.NullPointerException
	at org.apache.commons.digester.Digester.getXMLReader(Digester.java:902)
	at org.apache.commons.digester.Digester.parse(Digester.java:1548)
	at org.apache.catalina.startup.ContextConfig.defaultConfig(ContextConfig.java:515)
	at org.apache.catalina.startup.ContextConfig.start(ContextConfig.java:623)
	at org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:216)
	at
org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)
	at org.apache.catalina.core.StandardContext.start(StandardContext.java:4290)
	at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:823)
	at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:807)
	at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:595)
	at
org.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:277)
	at org.apache.catalina.core.StandardHost.install(StandardHost.java:832)
	at org.apache.catalina.startup.HostConfig.deployWARs(HostConfig.java:625)
	at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:431)
	at org.apache.catalina.startup.HostConfig.start(HostConfig.java:983)
	at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:349)
	at
org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)
	at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1091)
	at org.apache.catalina.core.StandardHost.start(StandardHost.java:789)
	at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1083)
	at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:478)
	at org.apache.catalina.core.StandardService.start(StandardService.java:480)
	at org.apache.catalina.core.StandardServer.start(StandardServer.java:2313)
	at org.apache.catalina.startup.Catalina.start(Catalina.java:556)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:287)
	at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:425)

I believe the issue here is that when the Digester to parse web.xml is set in
ContextConfig, the path to WEB-INF/lib is established for the WebappClassloader.
 When the SAXParserFactory is created with newInstance() within the call to
Digester.getParser(), the rules dictate that it will search thirdmost for a file
META-INF/services/javax.xml.parsers.SAXParserFactory in jars available, and it
will find it in saxon.jar, prior to defaulting to a platform default parser. 
This webapp parser is now used for parsing the web.xml file, but since this task
is the container's responsibility, it should not be used.  As a note, this
particular parser needs to be namespace-aware and the setting of it being not
namespace-aware throws this exception.

A possible solution is to load the (default) parser into the Digester prior to
having it being loaded by the WebappClassloader.  Since this appears to be
one-time settable, it will use this parser regardless of what the webapp has.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>106180</commentid>
    <comment_count>9</comment_count>
    <who name="Ryan Sweet">ryan</who>
    <bug_when>2007-08-02 11:08:22 +0000</bug_when>
    <thetext>Eddy, which particular sourceforge webapp did you use to test this?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>106466</commentid>
    <comment_count>10</comment_count>
    <who name="Eddy Chan">ecapachedev</who>
    <bug_when>2007-08-07 14:10:59 +0000</bug_when>
    <thetext>The webapp was one of my own, but you just need a bare one, I believe.  It
contained a saxon parser from Sourceforge, which overrides the default parser.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>107672</commentid>
    <comment_count>11</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2007-09-03 17:50:13 +0000</bug_when>
    <thetext>This works for me, at least I can't reproduce by following the steps provided
here, with the latest source from svn.

Please test this with the latest 5.5.x release. If you still see the issue,
please provide the simplest possible WAR that reproduces the issue on a clean
Tomcat install along with any additional configuration steps that may be required.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>108668</commentid>
    <comment_count>12</comment_count>
      <attachid>20889</attachid>
    <who name="Eddy Chan">ecapachedev</who>
    <bug_when>2007-09-26 13:54:44 +0000</bug_when>
    <thetext>Created attachment 20889
WAR causing problem for container</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>108669</commentid>
    <comment_count>13</comment_count>
    <who name="Eddy Chan">ecapachedev</who>
    <bug_when>2007-09-26 13:56:44 +0000</bug_when>
    <thetext>I've attached a small problematic WAR that just contains a blank web.xml along
with a saxon.jar in the WEB-INF/lib.  Remember that you need to remove ALL the
apps that come with Tomcat (rm -fr webapps/*) as well as the configs (rm -fr
conf/Catalina).
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>108921</commentid>
    <comment_count>14</comment_count>
    <who name="John Kew">john</who>
    <bug_when>2007-10-02 14:52:12 +0000</bug_when>
    <thetext>I can replicate this issue with the provided war on 5.5.x. It seems odd that
this only occurs with the conf/Catalina and other webapps missing.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>115721</commentid>
    <comment_count>15</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2008-04-20 13:46:01 +0000</bug_when>
    <thetext>The root cause of this issue is the ContextConfig class creating the parser for web.xml whilst it is using the webapp's classloader. This causes a problem if the app being processed includes an xml parser.

I have committed a fix to trunk and will propose it for 6.0.x and 5.5.x.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>115889</commentid>
    <comment_count>16</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2008-04-25 12:18:14 +0000</bug_when>
    <thetext>*** Bug 43444 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>116106</commentid>
    <comment_count>17</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2008-05-01 10:43:29 +0000</bug_when>
    <thetext>This has been committed to 6.0.x and will be in 6.0.17 onwards.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>119135</commentid>
    <comment_count>18</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2008-07-30 11:06:36 +0000</bug_when>
    <thetext>This has been fixed in 5.5.x and will be included in 5.5.27 onwards.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>20889</attachid>
            <date>2007-09-26 13:54:00 +0000</date>
            <delta_ts>2007-09-26 13:54:44 +0000</delta_ts>
            <desc>WAR causing problem for container</desc>
            <filename>test.war</filename>
            <type>application/octet-stream</type>
            <size>559504</size>
            <attacher name="Eddy Chan">ecapachedev</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>29938</bug_id>
          
          <creation_ts>2004-07-06 18:30:00 +0000</creation_ts>
          <short_desc>cygwin windows dirs treated as path vars instead of dirs (includes PATCH)</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.25</version>
          <rep_platform>PC</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Trevor Baker">amoebaworks</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>funkman</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>60204</commentid>
    <comment_count>0</comment_count>
    <who name="Trevor Baker">amoebaworks</who>
    <bug_when>2004-07-06 18:30:59 +0000</bug_when>
    <thetext>1) JAVA_HOME, CATALINA_HOME, CATALINA_BASE, CATALINA_TMPDIR are not path 
variables (ie: bin\java:/usr/local/java) but are directories (the other type of 
paths :-). When the conversion is made back to windows dirs, the cygpath 
commands have the '--path' option included, which shouldn't be there. See 
cygpath help for more info on paths &amp; dirs.

So need a fix so that no '--path' option should be set for JAVA_HOME, 
CATALINA_HOME, CATALINA_BASE, CATALINA_TMPDIR.

2) Also I sometimes use CATALINA_BASE of '.' cygpath converts this to '.\' 
with 'cygpath --windows .' (why I don't know) but this later causes 
the 'touch "$CATALINA_BASE"/logs/catalina.out' on line 203 to fail because the 
converted path is: '.\/logs/catalina.out'. If the cygpath option '--absolute' 
is added it prevents this case from happening.

So need another fix for CATALINA_BASE to have the '--absolute' option added. 

Actually it can be added to JAVA_HOME, CATALINA_HOME, and CATALINA_TMPDIR too 
without problems but usually these don't have '.' as their dirpath. It probably 
should be added for these too for consistency.

------------------------------------------------
Here's the diff for the patch:
catalina.sh (rev 1.14) 
117,120c117,120
&lt;   JAVA_HOME=`cygpath --path --windows "$JAVA_HOME"`
&lt;   CATALINA_HOME=`cygpath --path --windows "$CATALINA_HOME"`
&lt;   CATALINA_BASE=`cygpath --path --windows "$CATALINA_BASE"`
&lt;   CATALINA_TMPDIR=`cygpath --path --windows "$CATALINA_TMPDIR"`
---
&gt;   JAVA_HOME=`cygpath --windows --absolute "$JAVA_HOME"`
&gt;   CATALINA_HOME=`cygpath --windows --absolute "$CATALINA_HOME"`
&gt;   CATALINA_BASE=`cygpath --windows --absolute "$CATALINA_BASE"`
&gt;   CATALINA_TMPDIR=`cygpath --windows --absolute "$CATALINA_TMPDIR"`</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60756</commentid>
    <comment_count>1</comment_count>
    <who name="Trevor Baker">amoebaworks</who>
    <bug_when>2004-07-17 18:57:15 +0000</bug_when>
    <thetext>actually noticed that JSSE_HOME needs to be updated too. Here's the new patch:

$ diff catalina-new.sh catalina-1.14.sh
75c75
&lt;   [ -n "$JSSE_HOME" ] &amp;&amp; JSSE_HOME=`cygpath --unix "$JSSE_HOME"`
---
&gt;   [ -n "$JSSE_HOME" ] &amp;&amp; JSSE_HOME=`cygpath --path --unix "$JSSE_HOME"`
117,120c117,120
&lt;   JAVA_HOME=`cygpath --absolute --windows "$JAVA_HOME"`
&lt;   CATALINA_HOME=`cygpath --absolute --windows "$CATALINA_HOME"`
&lt;   CATALINA_BASE=`cygpath --absolute --windows "$CATALINA_BASE"`
&lt;   CATALINA_TMPDIR=`cygpath --absolute --windows "$CATALINA_TMPDIR"`
---
&gt;   JAVA_HOME=`cygpath --path --windows "$JAVA_HOME"`
&gt;   CATALINA_HOME=`cygpath --path --windows "$CATALINA_HOME"`
&gt;   CATALINA_BASE=`cygpath --path --windows "$CATALINA_BASE"`
&gt;   CATALINA_TMPDIR=`cygpath --path --windows "$CATALINA_TMPDIR"`
122c122
&lt;   JSSE_HOME=`cygpath --absolute --windows "$JSSE_HOME"`
---
&gt;   JSSE_HOME=`cygpath --path --windows "$JSSE_HOME"`</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61205</commentid>
    <comment_count>2</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2004-07-28 00:51:28 +0000</bug_when>
    <thetext>patch applied. Thanks</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61286</commentid>
    <comment_count>3</comment_count>
    <who name="Trevor Baker">amoebaworks</who>
    <bug_when>2004-07-29 03:38:06 +0000</bug_when>
    <thetext>no prob. thanks for applying it ;-)

BTW:
catalina.sh 1.16: line 78
[ -n "$JSSE_HOME" ] &amp;&amp; JSSE_HOME=`cygpath --absolute --unix 
"$JSSE_HOME"`

doesn't need the --absolute option since the unix formats are okay to 
begin with (doesn't matter if it's there or not). It was the windows format 
that needed fixing, but whatever works.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>29971</bug_id>
          
          <creation_ts>2004-07-08 09:26:00 +0000</creation_ts>
          <short_desc>Commented out page directive is parsed</short_desc>
          <delta_ts>2005-02-12 12:09:00 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.25</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>http://tomcat.stud.aitel.hist.no/jonaroe/Guestbook/web/index2.jsp</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Petr Pisl">petr.pisl</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>zikmund</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>60285</commentid>
    <comment_count>0</comment_count>
    <who name="Petr Pisl">petr.pisl</who>
    <bug_when>2004-07-08 09:26:20 +0000</bug_when>
    <thetext>If I have this page:
&lt;%@page contentType="text/html"%&gt;
&lt;%--&lt;%@page pageEncoding="ISO-8859-2"%&gt;--%&gt;
&lt;html&gt;
    &lt;head&gt;&lt;title&gt;JSP Page&lt;/title&gt;&lt;/head&gt;
    &lt;body&gt;
    &lt;/body&gt;
&lt;/html&gt;

Then the second page directive is parsed as well and the response encoding and
the file encoding is ISO-8859-2. It should be ISO-8859-1.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>68567</commentid>
    <comment_count>1</comment_count>
    <who name="Martin Schovanek">mschovanek</who>
    <bug_when>2004-12-15 14:36:27 +0000</bug_when>
    <thetext>The original case is fixed but if I compile this page:
&lt;%-- --%&gt;
&lt;%--&lt;%@page pageEncoding="xxx"%&gt;--%&gt;
&lt;html&gt;
    &lt;head&gt;&lt;title&gt;JSP Page&lt;/title&gt;&lt;/head&gt;
    &lt;body&gt;
    &lt;/body&gt;
&lt;/html&gt;

Jasper throws:
JasperException: Unsupported encoding: xxx

Without the 1st comment the page works fine.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>68568</commentid>
    <comment_count>2</comment_count>
    <who name="Allistair Crossley">allistair.crossley</who>
    <bug_when>2004-12-15 14:56:13 +0000</bug_when>
    <thetext>JSP.1.6 Quoting and Escape Conventions

Quoting in Scripting Elements
A literal %&gt; is quoted by %\&gt;
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>69496</commentid>
    <comment_count>3</comment_count>
    <who name="Petr Pisl">petr.pisl</who>
    <bug_when>2005-01-10 17:23:27 +0000</bug_when>
    <thetext>I don't understand how your comment influence this issue. This issue is that jsp
parser returns encoding from jsp comment. </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>69570</commentid>
    <comment_count>4</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2005-01-11 23:16:44 +0000</bug_when>
    <thetext>Fixed jan 11, 2005</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>30028</bug_id>
          
          <creation_ts>2004-07-10 23:35:00 +0000</creation_ts>
          <short_desc>session attributes Map may become inconsistent start causing "strange" problems</short_desc>
          <delta_ts>2007-06-04 10:29:47 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.25</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Vlad Ilyushchenko">vlad</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>vitor.buitoni</cc>
          <votes>3</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>60417</commentid>
    <comment_count>0</comment_count>
    <who name="Vlad Ilyushchenko">vlad</who>
    <bug_when>2004-07-10 23:35:28 +0000</bug_when>
    <thetext>Hi,

Access to StandardSession.attributes field is not synchronized; if used in
frames or in any other way asynchronousely, session.setAttribute() or
session.removeAttribute() may make StandardSession.attributes HashTable
inconsistent.

We have experienced a situation where attributes.getKeys().size() had become
greater then the number of the elements in the Set. This caused
StandardSession.keys() to throw NoSuchElement exception and serialization for
that session to be broken permanently. That in its turn caused cluster to become
inconsistent and so on.

I do appreciate that the relevant synchronization is expected to be done by
developers but it is not always possible to enforce that. Some software we use
is either close-source obfuscated type, or a big project developed and tested by
a third party on a different application server. Either way existing sites dont
work properly on Tomcat and we are not in a position to rewrite/modify the code
to make those sites more "intellegent" so to speak.

Anyway, i would like to suggest a fix to StandardSession.java:

34a35,36
&gt; import java.util.Collections;
&gt; import java.util.Map;
119,120c121
&lt;     protected HashMap attributes = new HashMap();
&lt; 
---
&gt;     protected Map attributes = Collections.synchronizedMap(new HashMap());

This is a patch for the 5.0.27 source.

Thanks,
Vlad</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60444</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-07-11 14:44:16 +0000</bug_when>
    <thetext>Obviously, session access isn't synchronized, and needs syncing in the user code
as needed. I thought this was obvious when reading the servlet specification
(glad your have a workaround for your third party libraries).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60452</commentid>
    <comment_count>2</comment_count>
    <who name="Vlad Ilyushchenko">vlad</who>
    <bug_when>2004-07-11 23:44:45 +0000</bug_when>
    <thetext>Remy,

&lt;quote&gt;

SRV.7.7.1 Threading Issues

Multiple servlets executing request threads may have active access to a single
session object at the same time. The Developer has the responsibility for
synchronizing access to session resources as appropriate.

&lt;/quote&gt;

I wouldnt say this implies that HttpSession is not guaranteed to be thread-safe
and to be fair it is quite ambiguous about either. As to my interpretation the
spec is talking about objects that are stored in session. And it would be
logical because the container cannot possibly synchronize access to them.

The session itself is a different matter altogether. It is a container resource
and I dont think it would qualify as a "session resource" the spec is going on
about. I would say that the container have to synchronize calls to
setAttribute/removeAttribute to ensure session consistency.

Performance difference between HashMap and the synchronized map is negligible
and the advantages are obvious. Basically unless session is accessed by the
single servlet implementing SingleThreadModel there is no way to gurantee
session connsistency? Even &lt;jsp:useBean&gt; does not synchronize against the
session. So everyone is a winner if StandardSession.attributes is synchronized?

I do hope that what i said here makes sense because Tomcat is one of the few
servers that doesnt care about setAttribute/removeAttribute thread safety, which
is a shame.

Regards,
Vlad
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60454</commentid>
    <comment_count>3</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-07-12 05:24:21 +0000</bug_when>
    <thetext>Hey,

I think we must sync the session data structure!
It make a big difference that app data are inconsistence or
the container data structure! Simple change and a very positive
effect.

regards
peter</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60462</commentid>
    <comment_count>4</comment_count>
    <who name="Vlad Ilyushchenko">vlad</who>
    <bug_when>2004-07-12 10:22:56 +0000</bug_when>
    <thetext>Remy,

excuse my poor english please, what i did mean to say in the last paragraph is
that Tomcat is one of the few containers that doesnt provide thread-safe
set/removeAttribute calls. "doesnt care" wasnt appropriate, sorry

Regards,
Vlad</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60463</commentid>
    <comment_count>5</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2004-07-12 11:10:21 +0000</bug_when>
    <thetext>The spec says the session sync is responsibility of the developer. It does not
matter what other containers do.

Since the spec does not call for this, therefore it is not a bug. At best it
would be an enhancement.

Introducing a sync'd HashMap does not fix the issue in cases where you are in a
cluster and 2 requests for the same session on to different nodes occurs.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60465</commentid>
    <comment_count>6</comment_count>
    <who name="Vlad Ilyushchenko">vlad</who>
    <bug_when>2004-07-12 11:55:55 +0000</bug_when>
    <thetext>Tim,

"The spec says the session sync is responsibility of the developer."

i think that you are ignoring the fact that the spec is ambiguous about syncing
session access. Moreover the spec is saying about "session resources".

Given that the sync problem is *easy* to rectify on the container side with no
side effects it is a reasonable thing to do. I dont mind calling it an
enhancement either.

Cluster problem you described is a different matter. If you use "sticky" load
balancing you wouldnt have experienced that.

Vlad</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>99186</commentid>
    <comment_count>7</comment_count>
    <who name="Vitor Buitoni">vitor.buitoni</who>
    <bug_when>2007-02-09 09:50:45 +0000</bug_when>
    <thetext>Hi,

I'm reopening this bug, since i'm also having problems with this issue, and I
really think that someone could take a better look at this. I don't think the
bug is invalid.

I can see the problem happening when my application or tomcat itself tries to
invalidate a session, the problem happens in the method expire():

StandardWrapperValve[action]: Servlet.service() for servlet action threw exception
java.lang.ArrayIndexOutOfBoundsException: -6
        at java.util.AbstractCollection.toArray(AbstractCollection.java:177)
        at
org.apache.catalina.session.StandardSession.keys(StandardSession.java:1523)
        at
org.apache.catalina.session.StandardSession.expire(StandardSession.java:706)
        at
org.apache.catalina.session.StandardSession.expire(StandardSession.java:632)
        at
org.apache.catalina.session.StandardSession.invalidate(StandardSession.java:1051)
        at
org.apache.catalina.session.StandardSessionFacade.invalidate(StandardSessionFacade.java:149)
        at
br.com.digitro.supervisor.webapp.controller.actions.LogOutAction.execute(LogOutAction.java:31)
        at
org.apache.struts.action.RequestProcessor.processActionPerform(RequestProcessor.java:484)
        at
org.apache.struts.action.RequestProcessor.process(RequestProcessor.java:274)
        at org.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)
        at org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)


As you can see, this -6 is the result of a call to the size() method of
attributes.keySet().

Please, let's not use the spec as an excuse for not doing things the right way.
The spec clearly says that the developer has the responsibility for
synchronizing access to "session resources", but doesn't say anything about the
session itself.

The container can and should synchronize the access to the session attribute
map, it would avoid many strange problems. Another side effect of this problem
is that tomcat isn't even able to invalidate expired sessions in this situation.

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>103990</commentid>
    <comment_count>8</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2007-06-01 18:11:47 +0000</bug_when>
    <thetext>This was fixed quite some time ago.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>104039</commentid>
    <comment_count>9</comment_count>
    <who name="Vitor Buitoni">vitor.buitoni</who>
    <bug_when>2007-06-04 10:29:47 +0000</bug_when>
    <thetext>Indeed. It seems it has been fixed in Tomcat 5.5.16.
Just for information, this issue is very similar to the one in BUG 36541.
(perhaps a duplicate...)
</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>30048</bug_id>
          
          <creation_ts>2004-07-12 12:35:00 +0000</creation_ts>
          <short_desc>Setting compressableMimeTypes is ignored.</short_desc>
          <delta_ts>2004-11-22 12:18:14 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:Coyote</component>
          <version>5.0.25</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ronald Klop">ronald</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>60468</commentid>
    <comment_count>0</comment_count>
    <who name="Ronald Klop">ronald</who>
    <bug_when>2004-07-12 12:35:27 +0000</bug_when>
    <thetext>I put this in my server.xml for the Connector.
compression="on"
compressableMimeTypes="text/html,text/xml,text/plain,text/javascript,text/css"
But it still doesn't compress text/javascript and text/css.
I checked this by sniffing the network traffic.
The text/html is compressed.
After looking in the source code, I couldn't find where the 
compressableMimeTypes are set, but it is possible, that I'm missing something 
here.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>66117</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-10-29 18:13:58 +0000</bug_when>
    <thetext>The code for setting the compressableMimeTypes is in the protocol processor, 
e.g. http://cvs.apache.org/viewcvs.cgi/jakarta-tomcat-
connectors/http11/src/java/org/apache/coyote/http11/Http11Processor.java?
rev=1.112&amp;view=markup for HTTP 1.1.  I believe it's being called and set.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>67103</commentid>
    <comment_count>2</comment_count>
    <who name="Ronald Klop">ronald</who>
    <bug_when>2004-11-18 01:06:42 +0000</bug_when>
    <thetext>If I grep in jakarta-tomcat-catalina for compressableMimeType I get this.

&gt;grep -r --mmap compressableMimeType *
catalina/src/conf/server.xml:
   compressableMimeType="text/html,text/xml"
webapps/docs/config/http.xml:
   &lt;attribute name="compressableMimeTypes" required="false"&gt;

(whitespace edited for readability)
Can there be a typo, that there is a missing 's' in compressableMimeType_s_?

It seems to work if I do not use the 's' in my config. But all the documentation 
I found talks about compressableMimeTypes.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>67341</commentid>
    <comment_count>3</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-11-22 15:35:31 +0000</bug_when>
    <thetext>Looking at the code, all the references are to compressableMimeTypes with an S 
at the end.  So it would appear the typo is in server.xml.  But it's strange 
that you say it works without the S, and fails with the S.  Is that also true 
on 5.0.28?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>67361</commentid>
    <comment_count>4</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-11-22 21:17:47 +0000</bug_when>
    <thetext>Docs updated in CVS to reflect correct spelling.  Thanks for pointing this out.</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>30067</bug_id>
          
          <creation_ts>2004-07-13 09:52:00 +0000</creation_ts>
          <short_desc>"Scripting elements are disallowed here" exception behind scriptless tag</short_desc>
          <delta_ts>2006-04-03 16:10:53 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.25</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Martin Schovanek">mschovanek</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>petr.pisl</cc>
          <votes>1</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>60528</commentid>
    <comment_count>0</comment_count>
    <who name="Martin Schovanek">mschovanek</who>
    <bug_when>2004-07-13 09:52:11 +0000</bug_when>
    <thetext>[jdk 1.4.2_04]

I got the exception for a script-less tag following by scriplet section in JSP
in XML syntax. The scriptlet is *behind* the tag. The same code in Standard JSP
syntax works for me.

- xindex.jspx - throws the exception:
&lt;jsp:root version="2.0"
    xmlns:jsp="http://java.sun.com/JSP/Page"
    xmlns:tag="urn:jsptagdir:/WEB-INF/tags"&gt;
    &lt;tag:EmptyTag/&gt;
    &lt;jsp:scriptlet&gt;String x;&lt;/jsp:scriptlet&gt;
&lt;/jsp:root&gt;

- index.jsp - works for me:
&lt;%@ taglib tagdir="/WEB-INF/tags/" prefix="tag"%&gt;
&lt;tag:EmptyTag/&gt;
&lt;jsp:scriptlet&gt;String x;&lt;/jsp:scriptlet&gt;

- EmptyTag.tag
&lt;%@tag body-content="scriptless"%&gt;
&lt;h1&gt;Empty Tag&lt;/h1&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60529</commentid>
    <comment_count>1</comment_count>
      <attachid>12098</attachid>
    <who name="Martin Schovanek">mschovanek</who>
    <bug_when>2004-07-13 09:55:26 +0000</bug_when>
    <thetext>Created attachment 12098
Scripting elements exception are disallowed here - exception.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>87549</commentid>
    <comment_count>2</comment_count>
    <who name="Ilguiz Latypov">ilatypov</who>
    <bug_when>2006-04-03 23:10:53 +0000</bug_when>
    <thetext>I see the bug is supposed to be fixed in 5.0.28.

Are there work-arounds for 5.0.27?
</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>12098</attachid>
            <date>2004-07-13 09:55:00 +0000</date>
            <delta_ts>2004-07-13 09:55:26 +0000</delta_ts>
            <desc>Scripting elements exception are disallowed here - exception.</desc>
            <filename>bug</filename>
            <type>text/plain</type>
            <size>1287</size>
            <attacher name="Martin Schovanek">mschovanek</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>30073</bug_id>
          
          <creation_ts>2004-07-13 13:20:00 +0000</creation_ts>
          <short_desc>NPE when compiling .jspx with broken xml format in jspcmode</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.25</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Martin Grebac">martin.grebac</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>60543</commentid>
    <comment_count>0</comment_count>
    <who name="Martin Grebac">martin.grebac</who>
    <bug_when>2004-07-13 13:20:47 +0000</bug_when>
    <thetext>While compiling jsp in broken xml format:

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;jspX:root xmlns:jsp="http://java.sun.com/JSP/Page" version="2.0"&gt;

    &lt;!-- to change the content type or response encoding change the following
line --&gt;
    &lt;jsp:directive.page contentType="text/xml;charset=UTF-8"/&gt;

    &lt;!-- any content can be specified here, e.g.: --&gt;
    &lt;jsp:element name="text"&gt;
        &lt;jsp:attribute name="lang"&gt;EN&lt;/jsp:attribute&gt;
        &lt;jsp:body&gt;Sample text&lt;/jsp:body&gt;
    &lt;/jsp:element&gt;
&lt;/jsp:root&gt;

with jasper in jspc mode, we get following exception:

java.lang.NullPointerException
org.apache.jasper.compiler.Mark.getURL(Mark.java:213)
org.apache.jasper.compiler.ErrorDispatcher.dispatch(ErrorDispatcher.java:355)
org.apache.jasper.compiler.ErrorDispatcher.jspError(ErrorDispatcher.java:90)
org.apache.jasper.compiler.JspDocumentParser.parse(JspDocumentParser.java:201)
org.apache.jasper.compiler.ParserController.doParse(ParserController.java:197)
org.apache.jasper.compiler.ParserController.parse(ParserController.java:101)
org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:203)
org.apache.jasper.compiler.Compiler.compile(Compiler.java:461)
org.apache.jasper.JspC.processFile(JspC.java:761)
org.apache.jasper.JspC.execute(JspC.java:885)
org.netbeans.modules.web.project.ant.JspC.main(JspC.java:39)
org.apache.jasper.JasperException

When JspServlet invokes compilation everything works ok, but ErrorDispatcher in
jspcmode probably gets null in mark.getUrl() call and .toString() method then
throws uncaught NPE.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>30117</bug_id>
          
          <creation_ts>2004-07-15 11:33:00 +0000</creation_ts>
          <short_desc>ResourceParams ignored in default context</short_desc>
          <delta_ts>2005-02-02 07:43:37 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Administration</component>
          <version>5.0.25</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          <blocked>33360</blocked>
          <everconfirmed>1</everconfirmed>
          <reporter>Andrew.Premdas</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>60633</commentid>
    <comment_count>0</comment_count>
    <who name="">Andrew.Premdas</who>
    <bug_when>2004-07-15 11:33:30 +0000</bug_when>
    <thetext>Setting up a DBCP pool. If I place correct &lt;Resource&gt; and &lt;ResourceParams&gt; 
tags in the default context, the params are not loaded.

If I create an application context &lt;context ...&gt; and place the same &lt;Resource&gt; 
and &lt;ResourceParams&gt; tags the params are now correctly loaded.

Bug or feature?

Tags in full are below just in case you need them. Location in server.xml is 
just before the &lt;/host&gt; tag at the end of server.xml

---- tags ----

			&lt;Resource
				name="jdbc/DataWarehouse"
				auth="Container"
				type="javax.sql.DataSource"
			/&gt;
		
			&lt;ResourceParams name="jdbc/DataWarehouse"&gt;
				&lt;!-- Driver class and URL --&gt;
				&lt;parameter&gt;
				   &lt;name&gt;factory&lt;/name&gt;
				   
&lt;value&gt;org.apache.commons.dbcp.BasicDataSourceFactory&lt;/value&gt;
				&lt;/parameter&gt;
				
				&lt;parameter&gt;
				   &lt;name&gt;driverClassName&lt;/name&gt;
				   &lt;value&gt;oracle.jdbc.OracleDriver&lt;/value&gt;
				&lt;/parameter&gt;
			
				&lt;parameter&gt;
					&lt;name&gt;url&lt;/name&gt;
				
	&lt;value&gt;jdbc:oracle:thin:@acudw1.acu.man.ac.uk:1521:dw1&lt;/value&gt;
				&lt;/parameter&gt;
			 
				&lt;!-- account details --&gt;
			
				&lt;parameter&gt;
					&lt;name&gt;username&lt;/name&gt;
					&lt;value&gt;web_image&lt;/value&gt;
				&lt;/parameter&gt;
			
				&lt;parameter&gt;
					&lt;name&gt;password&lt;/name&gt;
					&lt;value&gt;pr0ject&lt;/value&gt;
				&lt;/parameter&gt;
			
				&lt;!-- pooling controls --&gt;
			
				&lt;parameter&gt;
					&lt;name&gt;maxActive&lt;/name&gt;
					&lt;value&gt;20&lt;/value&gt;
				&lt;/parameter&gt;
			
				&lt;parameter&gt;
					&lt;name&gt;maxIdle&lt;/name&gt;
					&lt;value&gt;10&lt;/value&gt;
				&lt;/parameter&gt;
			
				&lt;parameter&gt;
					&lt;name&gt;maxWait&lt;/name&gt;
					&lt;value&gt;-1&lt;/value&gt;
				&lt;/parameter&gt;
				
				&lt;!-- prevent pool leaks --&gt;
				&lt;parameter&gt;
					&lt;name&gt;removeAbandoned&lt;/name&gt;
					&lt;value&gt;true&lt;/value&gt;
				&lt;/parameter&gt;
				
				&lt;parameter&gt;
					&lt;name&gt;removeAbandonedTimeout&lt;/name&gt;
					&lt;value&gt;60&lt;/value&gt;
				&lt;/parameter&gt;
				
				&lt;parameter&gt;
					&lt;name&gt;logAbandoned&lt;/name&gt;
					&lt;value&gt;true&lt;/value&gt;
				&lt;/parameter&gt;
				
			&lt;/ResourceParams&gt;

----
put them in this context and they work

&lt;Context 
			path="/poolSpike" 
			reloadable="true" 
			docBase="C:\andy\workspace\poolSpike" 
			workDir="C:\andy\workspace\poolSpike\work"&gt;
	

&lt;/Context&gt;</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61206</commentid>
    <comment_count>1</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2004-07-28 00:54:05 +0000</bug_when>
    <thetext>With Remy's new patches for 5.5 this will be fixed by using a default context
file used in a similar manner that we use web.xml.

But there is no known date for a 5.5 release.

So unless someone objects - I'll mark this as "fixed".</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>30144</bug_id>
          
          <creation_ts>2004-07-16 10:43:00 +0000</creation_ts>
          <short_desc>res.setContentType in SSIServlet.java line 167</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlets:SSI</component>
          <version>5.0.25</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Qiang Du">duarthur</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>60683</commentid>
    <comment_count>0</comment_count>
    <who name="Qiang Du">duarthur</who>
    <bug_when>2004-07-16 10:43:38 +0000</bug_when>
    <thetext>In SSIServlet.java line 167, the code is 
res.setContentType("text/html;charset=UTF-8");
But in DefaultServlet.java, the content type is found from web.xml, the code is 
// Find content type.
        String contentType =
            getServletContext().getMimeType(resourceInfo.path);

I don't know if it's a problem.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61261</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-07-28 17:27:41 +0000</bug_when>
    <thetext>It's not a problem, but a decent thing to fix anyways.  I made it check the 
resource MIME type first, and use it if found, otherwise use text/html and UTF-
8 as the default.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>30149</bug_id>
          
          <creation_ts>2004-07-16 12:53:00 +0000</creation_ts>
          <short_desc>IllegalArgumentException when using context-param in web.xml</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Cheng Fang">cheng.fang</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>60695</commentid>
    <comment_count>0</comment_count>
    <who name="Cheng Fang">cheng.fang</who>
    <bug_when>2004-07-16 12:53:45 +0000</bug_when>
    <thetext>It appears any wars with context-param failed to
deploy.  When parsing web.xml, context-param elements are parsed and added
to map twice for some reason, and thus cause the second adding to throw
IllegalArgumentException.

I instrumented
apache/jakarta-tomcat-
catalina/catalina/src/share/org/apache/catalina/core/StandardContext.java
addParameter method

Here it shows context-param was added twice:

INFO: Installing web application at context path /jsp-examples from URL
file:/.../jakarta-tomcat-5/webapps/jsp-examples
### name=webmaster value=myaddress@mycompany.com
### map={}
### value=null
### to add ok
### name=webmaster value=myaddress@mycompany.com
### map={webmaster=myaddress@mycompany.com}
### value=myaddress@mycompany.com
### to throw

To repruduce it, just add to jsp-examples/web-inf/web.xml:

    &lt;context-param&gt;
      &lt;param-name&gt;webmaster&lt;/param-name&gt;
      &lt;param-value&gt;myaddress@mycompany.com&lt;/param-value&gt;
      &lt;description&gt;
        The EMAIL address of the administrator to whom questions
        and comments about this application should be addressed.
      &lt;/description&gt;
    &lt;/context-param&gt;

Stack trace from catalina.log:
Jul 15, 2004 9:54:37 PM org.apache.tomcat.util.digester.Digester endElement
SEVERE: End event threw exception
java.lang.reflect.InvocationTargetException
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke
(NativeMethodAccessorImpl.java:39)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke
(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:324)
        at org.apache.tomcat.util.IntrospectionUtils.callMethodN
(IntrospectionUtils.java:907)
        at org.apache.tomcat.util.digester.CallMethodRule.end
(CallMethodRule.java:576)
        at org.apache.tomcat.util.digester.Rule.end(Rule.java:228)
        at org.apache.tomcat.util.digester.Digester.endElement
(Digester.java:1057)
        at org.apache.crimson.parser.Parser2.maybeElement(Parser2.java:1720)
        at org.apache.crimson.parser.Parser2.content(Parser2.java:1963)
        at org.apache.crimson.parser.Parser2.maybeElement(Parser2.java:1691)
        at org.apache.crimson.parser.Parser2.parseInternal(Parser2.java:667)
        at org.apache.crimson.parser.Parser2.parse(Parser2.java:337)
        at org.apache.crimson.parser.XMLReaderImpl.parse(XMLReaderImpl.java:448)
        at org.apache.tomcat.util.digester.Digester.parse(Digester.java:1561)
        at org.apache.catalina.startup.ContextConfig.applicationConfig
(ContextConfig.java:234)
        at org.apache.catalina.startup.ContextConfig.start
(ContextConfig.java:557)
        at org.apache.catalina.startup.ContextConfig.lifecycleEvent
(ContextConfig.java:187)
        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent
(LifecycleSupport.java:119)
        at org.apache.catalina.core.StandardContext.start
(StandardContext.java:4285)
        at org.apache.catalina.core.ContainerBase.addChildInternal
(ContainerBase.java:755)
        at org.apache.catalina.core.ContainerBase.addChild
(ContainerBase.java:739)
        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:595)
        at org.apache.catalina.core.StandardHostDeployer.install
(StandardHostDeployer.java:276)
        at org.apache.catalina.core.StandardHost.install(StandardHost.java:832)
        at org.apache.catalina.startup.HostConfig.deployWARs
(HostConfig.java:584)
        at org.apache.catalina.startup.HostConfig.deployApps
(HostConfig.java:398)
        at org.apache.catalina.startup.HostConfig.check(HostConfig.java:997)
        at org.apache.catalina.startup.HostConfig.lifecycleEvent
(HostConfig.java:298)
        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent
(LifecycleSupport.java:119)
        at org.apache.catalina.core.StandardHost.backgroundProcess
(StandardHost.java:800)
        at 
org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChild
ren(ContainerBase.java:1511)
        at 
org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChild
ren(ContainerBase.java:1520)
        at 
org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run
(ContainerBase.java:1500)
        at java.lang.Thread.run(Thread.java:534)
Caused by: java.lang.IllegalArgumentException: Duplicate context initialization 
parameter webmaster
        at org.apache.catalina.core.StandardContext.addParameter
(StandardContext.java:2116)
        ... 35 more
Jul 15, 2004 9:54:37 PM org.apache.catalina.startup.ContextConfig 
applicationConfig
SEVERE: Parse error in application web.xml
java.lang.IllegalArgumentException: Duplicate context initialization parameter 
webmaster
        at org.apache.tomcat.util.digester.Digester.createSAXException
(Digester.java:2740)
        at org.apache.tomcat.util.digester.Digester.createSAXException
(Digester.java:2766)
        at org.apache.tomcat.util.digester.Digester.endElement
(Digester.java:1060)
        at org.apache.crimson.parser.Parser2.maybeElement(Parser2.java:1720)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60993</commentid>
    <comment_count>1</comment_count>
    <who name="Cheng Fang">cheng.fang</who>
    <bug_when>2004-07-22 19:39:06 +0000</bug_when>
    <thetext>I traced the problem to CallMethodRule class, where callMethodN was invoked 
twice.  With the following change, Tomcat works fine with context-param.  I 
also tested this change with jsp tck.  I will appreciate it if someone could 
review and apply it.

Index: CallMethodRule.java
===================================================================
RCS file: /home/cvspublic/jakarta-tomcat-
connectors/util/java/org/apache/tomcat/util/digester/CallMethodRule.java,v
retrieving revision 1.1
diff -u -r1.1 CallMethodRule.java
--- CallMethodRule.java 26 Jun 2004 17:41:30 -0000      1.1
+++ CallMethodRule.java 22 Jul 2004 19:24:05 -0000
@@ -572,7 +572,6 @@
             sb.append(")");
             digester.log.debug(sb.toString());
         }
-        IntrospectionUtils.callMethodN(target, methodName, paramValues, 
paramTypes);
         Object result = IntrospectionUtils.callMethodN(target, methodName,
                 paramValues, paramTypes);
         processMethodCallResult(result);
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61064</commentid>
    <comment_count>2</comment_count>
    <who name="Jan Luehe">jan.luehe</who>
    <bug_when>2004-07-23 15:59:36 +0000</bug_when>
    <thetext>Fixed by applying Cheng's patch.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>30155</bug_id>
          
          <creation_ts>2004-07-16 17:47:00 +0000</creation_ts>
          <short_desc>Problem with viewing mail session</short_desc>
          <delta_ts>2006-06-11 15:59:55 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Administration</component>
          <version>5.0.28</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>http://localhost:8080/admin/resources/listMailSessions.do?resourcetype=Context&amp;path=%2Fmyapp&amp;host=localhost&amp;domain=Catalina&amp;forward=MailSessions+List+Setup</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="bill lu">lubx</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>lubx</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>60712</commentid>
    <comment_count>0</comment_count>
    <who name="bill lu">lubx</who>
    <bug_when>2004-07-16 17:47:09 +0000</bug_when>
    <thetext>After compile and deploy the application (myapp) to tomcat, trying to view the
Mail Session set-up in Admin, Admin throws exception.  
It doesn't happen at very first time to set up the Mail Session, after modify
the setting, or modifying the server context file, it will keep throwing the
exception even undo  all changes in config file. 
This bug could be repeated after following the fix of  bug #29255.

Exception:
javax.servlet.ServletException: Exception retrieving attribute 'mail.smtp.host'
	org.apache.jasper.runtime.PageContextImpl.doHandlePageException(PageContextImpl.java:825)
	org.apache.jasper.runtime.PageContextImpl.handlePageException(PageContextImpl.java:758)
	admin.resources.listMailSessions_jsp._jspService(listMailSessions_jsp.java:431)
	org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:94)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:810)
	org.apache.struts.action.RequestProcessor.doForward(RequestProcessor.java:1069)
	org.apache.struts.action.RequestProcessor.processForwardConfig(RequestProcessor.java:455)
	org.apache.struts.action.RequestProcessor.process(RequestProcessor.java:279)
	org.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)
	org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:697)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:810)
	org.apache.struts.action.RequestProcessor.doForward(RequestProcessor.java:1069)
	org.apache.struts.action.RequestProcessor.processForwardConfig(RequestProcessor.java:455)
	org.apache.struts.action.RequestProcessor.process(RequestProcessor.java:279)
	org.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)
	org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:697)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:810)

Root Cause:

javax.servlet.jsp.JspException: Exception retrieving attribute 'mail.smtp.host'
	org.apache.webapp.admin.AttributeTag.doEndTag(AttributeTag.java:170)
	admin.resources.listMailSessions_jsp._jspx_meth_controls_attribute_1(listMailSessions_jsp.java:761)
	admin.resources.listMailSessions_jsp._jspService(listMailSessions_jsp.java:391)
	org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:94)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:810)
	org.apache.struts.action.RequestProcessor.doForward(RequestProcessor.java:1069)
	org.apache.struts.action.RequestProcessor.processForwardConfig(RequestProcessor.java:455)
	org.apache.struts.action.RequestProcessor.process(RequestProcessor.java:279)
	org.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)
	org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:697)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:810)
	org.apache.struts.action.RequestProcessor.doForward(RequestProcessor.java:1069)
	org.apache.struts.action.RequestProcessor.processForwardConfig(RequestProcessor.java:455)
	org.apache.struts.action.RequestProcessor.process(RequestProcessor.java:279)
	org.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)
	org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:697)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:810)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60834</commentid>
    <comment_count>1</comment_count>
    <who name="Amy Roh">amyroh</who>
    <bug_when>2004-07-19 21:36:15 +0000</bug_when>
    <thetext>I can't reproduce.  Can you attach your config files?  From the exception, it
looks like your mail session resource is missing "mail.smtp.host" parameter.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60892</commentid>
    <comment_count>2</comment_count>
    <who name="bill lu">lubx</who>
    <bug_when>2004-07-20 20:51:07 +0000</bug_when>
    <thetext>I actually removed the configuration regarding the mail session both in web.xml
and context.xml. here goes the web.xml, context.xml and server.xml:

web.xml:

&lt;web-app&gt;
&lt;!--  Omit other config  --&gt;
     &lt;resource-ref&gt;
        &lt;description&gt;DB Connection&lt;/description&gt;
        &lt;res-ref-name&gt;jdbc/dsapp1&lt;/res-ref-name&gt;
        &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
        &lt;res-auth&gt;Container&lt;/res-auth&gt;
    &lt;/resource-ref&gt;
&lt;!--    &lt;resource-ref&gt;--&gt;
&lt;!--        &lt;description&gt;mail&lt;/description&gt;--&gt;
&lt;!--        &lt;res-ref-name&gt;mail/Session_send&lt;/res-ref-name&gt;--&gt;
&lt;!--        &lt;res-type&gt;javax.mail.Session&lt;/res-type&gt;--&gt;
&lt;!--        &lt;res-auth&gt;Container&lt;/res-auth&gt;--&gt;
&lt;!--    &lt;/resource-ref&gt;--&gt;

        &lt;!-- The tomcat role --&gt;
    &lt;security-role&gt;
        &lt;description&gt;Default Role for All Users&lt;/description&gt;
        &lt;role-name&gt;tomcat&lt;/role-name&gt;
    &lt;/security-role&gt;
&lt;/web-app&gt;

context.xml:

&lt;Context path="/dsapp1" docBase="dsapp1" debug="99" reloadable="true"&gt;
    &lt;Logger className="org.apache.catalina.logger.FileLogger" 
        prefix="dsapp1_log." suffix=".txt" timestamp="true"/&gt;


    &lt;!-- NOTE: If you want to use a DataSourceRealm, the Resource must be a
               global resource --&gt;
    &lt;Realm className="org.apache.catalina.realm.JDBCRealm" debug="99"
          driverName="com.mysql.jdbc.Driver"
      
connectionURL="jdbc:mysql://localhost/dsapp1?autoReconnect=true&amp;amp;useUnicode=true&amp;amp;characterEncoding=UTF-8"
      connectionName="test" connectionPassword="test"
           userTable="app_user" userNameCol="username" userCredCol="password"
       userRoleTable="user_role" roleNameCol="role_name" /&gt;
    &lt;Resource name="jdbc/dsapp1" auth="Container" type="javax.sql.DataSource"/&gt;
    &lt;ResourceParams name="jdbc/dsapp1"&gt;
        &lt;parameter&gt;
            &lt;name&gt;factory&lt;/name&gt;
            &lt;value&gt;org.apache.commons.dbcp.BasicDataSourceFactory&lt;/value&gt;
        &lt;/parameter&gt;
        &lt;!-- Maximum number of dB connections in pool. Make sure you
             configure your mysqld max_connections large enough to handle
             all of your db connections. Set to 0 for no limit.
             --&gt;
        &lt;parameter&gt;
            &lt;name&gt;maxActive&lt;/name&gt;
            &lt;value&gt;100&lt;/value&gt;
        &lt;/parameter&gt;
&lt;!-- Omit other config --&gt;
    &lt;/ResourceParams&gt;
    &lt;!-- This is not working --&gt;
&lt;!--    &lt;Resource name="mail/Session" auth="Container"
type="javax.mail.Session"/&gt;--&gt;
&lt;!--    &lt;ResourceParams name="mail/Session"&gt;--&gt;
&lt;!--        &lt;parameter&gt;--&gt;
&lt;!--            &lt;name&gt;mail.smtp.host&lt;/name&gt;--&gt;
&lt;!--            &lt;value&gt;localhost&lt;/value&gt;--&gt;
&lt;!--        &lt;/parameter&gt;--&gt;
&lt;!--    &lt;/ResourceParams&gt;--&gt;
&lt;/Context&gt;

server.xml:

?xml version='1.0' encoding='utf-8'?&gt;
&lt;Server&gt;
  &lt;Listener className="org.apache.catalina.mbeans.ServerLifecycleListener"/&gt;
  &lt;Listener
className="org.apache.catalina.mbeans.GlobalResourcesLifecycleListener"/&gt;
  &lt;GlobalNamingResources&gt;
    &lt;Environment name="simpleValue" type="java.lang.Integer" value="30"/&gt;
    &lt;Resource auth="Container" description="User database that can be updated
and saved" name="UserDatabase" type="org.apache.catalina.UserDatabase"/&gt;
    &lt;Resource name="mail/Session_send" type="javax.mail.Session"/&gt;
    &lt;ResourceParams name="UserDatabase"&gt;
      &lt;parameter&gt;
        &lt;name&gt;factory&lt;/name&gt;
        &lt;value&gt;org.apache.catalina.users.MemoryUserDatabaseFactory&lt;/value&gt;
      &lt;/parameter&gt;
      &lt;parameter&gt;
        &lt;name&gt;pathname&lt;/name&gt;
        &lt;value&gt;conf/tomcat-users.xml&lt;/value&gt;
      &lt;/parameter&gt;
    &lt;/ResourceParams&gt;
    &lt;ResourceParams name="mail/Session_send"&gt;
      &lt;parameter&gt;
        &lt;name&gt;mail.smtp.host&lt;/name&gt;
        &lt;value&gt;smtp.host.net&lt;/value&gt;
      &lt;/parameter&gt;
    &lt;/ResourceParams&gt;
  &lt;/GlobalNamingResources&gt;
 &lt;Service name="Catalina"&gt;
    &lt;Connector acceptCount="100" connectionTimeout="20000"
disableUploadTimeout="true" port="8080" redirectPort="8443"&gt;
    &lt;/Connector&gt;
    &lt;Connector port="8009" protocol="AJP/1.3"
protocolHandlerClassName="org.apache.jk.server.JkCoyoteHandler" redirectPort="8443"&gt;
    &lt;/Connector&gt;
    &lt;Engine defaultHost="localhost" name="Catalina"&gt;
      &lt;Host appBase="webapps" name="localhost"&gt;
        &lt;Logger className="org.apache.catalina.logger.FileLogger"
prefix="localhost_log." suffix=".txt" timestamp="true"/&gt;
      &lt;/Host&gt;
      &lt;Logger className="org.apache.catalina.logger.FileLogger"
prefix="catalina_log." suffix=".txt" timestamp="true"/&gt;
      &lt;Realm className="org.apache.catalina.realm.UserDatabaseRealm"/&gt;
    &lt;/Engine&gt;
  &lt;/Service&gt;
&lt;/Server&gt;

thanks for your time

bill</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61241</commentid>
    <comment_count>3</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-07-28 15:15:26 +0000</bug_when>
    <thetext>5.0.25 has a known issue with the naming-factory.jar missing the 
javax.mail.Session factory support.  Use 5.0.27.  I'm going to close this issue 
as I'm 99% sure this is the problem, but if I'm wrong feel free to reopen the 
issue and change the version from 5.0.25 to 5.0.27.  Thanks.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>90075</commentid>
    <comment_count>4</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2006-06-11 22:59:55 +0000</bug_when>
    <thetext>This has been re-opened but no additional comment provided. Closing again as
fixed based on Yoav's last comment.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>30159</bug_id>
          
          <creation_ts>2004-07-16 20:25:00 +0000</creation_ts>
          <short_desc>Incorrect spelling of word in .jspx example</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Examples</component>
          <version>Unknown</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Christian Winebrenner">jadecristal</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>60716</commentid>
    <comment_count>0</comment_count>
    <who name="Christian Winebrenner">jadecristal</who>
    <bug_when>2004-07-16 20:25:56 +0000</bug_when>
    <thetext>In the examples application, the word "prove" is spelled "proove" at path, in
the last line of generated code (where the current date/time is displayed):

/jsp-examples/jsp2/jspx/basic.jspx

Version: the current release, 5.0.27 - not shown in the Apache Bug Database
Version selection box.</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>30179</bug_id>
          
          <creation_ts>2004-07-19 12:13:00 +0000</creation_ts>
          <short_desc>Not all entries in catalina.properties are correctly used by the classloaders</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.25</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Thorsten Kamann">thorsten.kamann</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>60797</commentid>
    <comment_count>0</comment_count>
    <who name="Thorsten Kamann">thorsten.kamann</who>
    <bug_when>2004-07-19 12:13:26 +0000</bug_when>
    <thetext>In catalina.properties I can define path to use for the classloaders.
The entry ${catalina.home}/ext/lib/*.jar does work, bit if I want to add only
one special jar in combination of the placeholder ${catalina.home} or
${catalina.base} this doesn't work, eg:
${catalina.home}/ext/lib/test.jar

The resolution for this bug is in the attached patch.

Best regards
Thorsten</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60798</commentid>
    <comment_count>1</comment_count>
      <attachid>12155</attachid>
    <who name="Thorsten Kamann">thorsten.kamann</who>
    <bug_when>2004-07-19 12:14:59 +0000</bug_when>
    <thetext>Created attachment 12155
This patch resolves the problem with the classloaders and the catalina.properties entries</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62295</commentid>
    <comment_count>2</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-08-21 19:36:52 +0000</bug_when>
    <thetext>Patch applied in TOMCAT_5_0 branch.  Patch applied in CVS_HEAD.  Thanks!</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>12155</attachid>
            <date>2004-07-19 12:14:00 +0000</date>
            <delta_ts>2004-07-19 12:14:59 +0000</delta_ts>
            <desc>This patch resolves the problem with the classloaders and the catalina.properties entries</desc>
            <filename>bootstrap.patch</filename>
            <type>text/plain</type>
            <size>1359</size>
            <attacher name="Thorsten Kamann">thorsten.kamann</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>30239</bug_id>
          
          <creation_ts>2004-07-21 17:48:00 +0000</creation_ts>
          <short_desc>Connector documentation is not up-to-date for IIS 6</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Native:Packaging</component>
          <version>5.0.25</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jess Holle">jessh</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>60916</commentid>
    <comment_count>0</comment_count>
    <who name="Jess Holle">jessh</who>
    <bug_when>2004-07-21 17:48:16 +0000</bug_when>
    <thetext>The IIS portion of the Tomcat connector documentation makes no mention of the
extra steps required to get the connectors working with IIS 6.  These are
clearly documented elsewhere on the web
(http://www.rit.edu/~ack5504/tomcat-iis6-howto/tomcat-iis6-howto.html amongst
other places), so there is little reason not to incorporate this information. 
Not bundling this information leaves most people attempting this configuration
completely lost -- and they just give up.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>60917</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-07-21 18:07:49 +0000</bug_when>
    <thetext>- Added link to this IIS how-to document in Wiki pages
- Updated JK IIS how-to page with section on IIS 5 and 6 which points readers 
to the wiki page with the many how-to links and references.

(These changes will be visible next time the docs site is updated, and of 
course in the next releases).</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>30241</bug_id>
          
          <creation_ts>2004-07-21 19:03:00 +0000</creation_ts>
          <short_desc>Enhance build script to use branch argument when checking out files</short_desc>
          <delta_ts>2009-07-16 13:56:42 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.25</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>CLOSED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Yoav Shapira">yoavs</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>60928</commentid>
    <comment_count>0</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-07-21 19:03:25 +0000</bug_when>
    <thetext>With the TOMCAT_5_0 branch now effective, the build files need to be modified 
so that when they check out from CVS they use a branch directive.  The default 
should of course be HEAD.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62281</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-08-21 12:20:48 +0000</bug_when>
    <thetext>Already done, cool ;)  See cvstag property in build.xml.</thetext>
  </long_desc>
      
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>30245</bug_id>
          
          <creation_ts>2004-07-21 21:56:00 +0000</creation_ts>
          <short_desc>Documentation omission</short_desc>
          <delta_ts>2006-02-12 12:28:28 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>Unknown</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>http://jakarta.apache.org/tomcat/tomcat-5.0-doc/config/ajp.html</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Nerius Landys">neriuslandys</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>60938</commentid>
    <comment_count>0</comment_count>
    <who name="Nerius Landys">neriuslandys</who>
    <bug_when>2004-07-21 21:56:09 +0000</bug_when>
    <thetext>This is a documentation bug.  My motivation for filing this bug is that I wanted
to have a tomcat AJP 1.3 connector bind to 127.0.0.1 instead of grabbing an
external IP - not finding documentation on how to do this I consulted the source
code.  Reading the source code for
org/apache/coyote/tomcat5/CoyoteConnector.java gave me the idea to try an
'address="127.0.0.1"' attribute in a &lt;Connector /&gt; definition in my server.xml
config file.  Adding such an attribute to the Connector definition did indeed
achieve my desired affect.

Perhaps the documentation at the URL
http://jakarta.apache.org/tomcat/tomcat-5.0-doc/config/ajp.html should document
the use of the "address" attribute in some or all Connectors.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61059</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-07-23 14:15:14 +0000</bug_when>
    <thetext>Fixed documentation, thanks.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>85730</commentid>
    <comment_count>2</comment_count>
    <who name="JOSEP LUICHIS PARDOUW">mfg2hacker</who>
    <bug_when>2006-02-12 21:28:28 +0000</bug_when>
    <thetext>SERA QUE SI, DONDE ESTA EL ECADESSSSSS</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>30289</bug_id>
          
          <creation_ts>2004-07-23 09:59:00 +0000</creation_ts>
          <short_desc>Wrong SMAP mappings with body dependent tags</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.27</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Martin Grebac">martin.grebac</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>petr.jiricka</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>61045</commentid>
    <comment_count>0</comment_count>
    <who name="Martin Grebac">martin.grebac</who>
    <bug_when>2004-07-23 09:59:39 +0000</bug_when>
    <thetext>The actual debugger bug description is here:
http://www.netbeans.org/issues/show_bug.cgi?id=45360

See attached web app - important files are mostly these:
WebApplication3/web/index.jsp and 
WebApplication3/build/generated/src/org/apache/jsp/index_jsp.class.smap
WebApplication3/build/generated/src/org/apache/jsp/index_jsp.java

I think that issue 29638
(http://issues.apache.org/bugzilla/show_bug.cgi?id=29638) mentions the same.

Mapping part of the smap for index.jsp looks like this:

1,4:57
4:81,29
4,7:93
10,3:63

I believe the second mapping shouldn't be there, because then it causes debugger
to completely skip the contents of the tag body and also breakpoints in those
areas are not reflected. This is quite serious issue, as it makes debugging of
jsps with tags (like from Jstl and Struts, e.g.) completely unusable.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61046</commentid>
    <comment_count>1</comment_count>
      <attachid>12199</attachid>
    <who name="Martin Grebac">martin.grebac</who>
    <bug_when>2004-07-23 10:00:16 +0000</bug_when>
    <thetext>Created attachment 12199
web application with all the needed files</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61149</commentid>
    <comment_count>2</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-07-26 20:53:07 +0000</bug_when>
    <thetext>Fixed in CVS.  Thanks for reporting.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>12199</attachid>
            <date>2004-07-23 10:00:00 +0000</date>
            <delta_ts>2004-07-23 10:00:16 +0000</delta_ts>
            <desc>web application with all the needed files</desc>
            <filename>webapp.zip</filename>
            <type>application/octet-stream</type>
            <size>20089</size>
            <attacher name="Martin Grebac">martin.grebac</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>30291</bug_id>
          
          <creation_ts>2004-07-23 11:13:00 +0000</creation_ts>
          <short_desc>Wrong smap in expressions and scriptlets</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.27</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Martin Grebac">martin.grebac</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>petr.jiricka</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>61048</commentid>
    <comment_count>0</comment_count>
    <who name="Martin Grebac">martin.grebac</who>
    <bug_when>2004-07-23 11:13:02 +0000</bug_when>
    <thetext>See attached .zip file for the actual files. One of problems is e.g. in this
mapping line:
9,4:50
which does not correspond with the actual lines.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61118</commentid>
    <comment_count>1</comment_count>
      <attachid>12217</attachid>
    <who name="Martin Grebac">martin.grebac</who>
    <bug_when>2004-07-26 09:23:16 +0000</bug_when>
    <thetext>Created attachment 12217
zip with files</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61150</commentid>
    <comment_count>2</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-07-26 20:54:00 +0000</bug_when>
    <thetext>Fixed in CVS.  Thnaks for reporting.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>12217</attachid>
            <date>2004-07-26 09:23:00 +0000</date>
            <delta_ts>2004-07-26 09:23:16 +0000</delta_ts>
            <desc>zip with files</desc>
            <filename>smaptest.zip</filename>
            <type>application/octet-stream</type>
            <size>1527</size>
            <attacher name="Martin Grebac">martin.grebac</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>30314</bug_id>
          
          <creation_ts>2004-07-25 12:06:00 +0000</creation_ts>
          <short_desc>Review new HostConfig and add something</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Peter Rossbach">pr</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>61096</commentid>
    <comment_count>0</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-07-25 12:06:15 +0000</bug_when>
    <thetext>Hello Remy,

I have look inside the new HostConfig. Great!

Find some FIXME answer and fix small bugs.
   see my comments and questions.

How we can add the watch resource support?

- Look for WEB-INF/web.xml, conf/&lt;enginename&gt;/&lt;host&gt;/&lt;app&gt;.xml
  Changeses add war File
- How we can handle remove work/ explanded War Dirs
   see my removeContextAp
- Why we change the deploy order at deployApps?
    5.0.xx has
        descriptors
        wars
        directory
    New HostConfig
        descriptors
        directory
        wars
    Problem are
     expanded wars without META-INF/context.xml - After restart only
     directory are deployed!

ToDo:
    Add Watch Ressouces support
    Refactoring for long methods and some small code duplications
    Test, Test
    Check LocalStrings


regards
peter




regards.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61097</commentid>
    <comment_count>1</comment_count>
      <attachid>12214</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-07-25 12:07:04 +0000</bug_when>
    <thetext>Created attachment 12214
HostConfig with Fixes and new questions</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61098</commentid>
    <comment_count>2</comment_count>
      <attachid>12215</attachid>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-07-25 12:07:34 +0000</bug_when>
    <thetext>Created attachment 12215
Changed LocalString for HostConfig</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61101</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-07-25 12:43:26 +0000</bug_when>
    <thetext>I think it's really difficult to jump in the middle of someone's patches (which
I committed mostly for backup purposes - not that I expect my brand new laptop
to fail right away, but you never know ;) ) without causing conflicts.
I'll obviously make tons of adjustments, but not all in the direction of your
patch (you try too much to blend the old stuff with the new stuff, which wasn't
my intention, otherwise there's no point rewriting the code).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61138</commentid>
    <comment_count>4</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-07-26 16:41:14 +0000</bug_when>
    <thetext>I committed some updated code, which seems to work, more or less. It's not done
yet, but it's getting there. Some of your suggestions were good, thanks (but you
should post them on tomcat-dev, probably).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61139</commentid>
    <comment_count>5</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-07-26 16:47:10 +0000</bug_when>
    <thetext>Hello Remy,

you mean that post better patches and comments at the tomdev list? 

regards
Peter</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61140</commentid>
    <comment_count>6</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-07-26 16:58:32 +0000</bug_when>
    <thetext>Yes, to talk about development issues, I think it's better.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>12214</attachid>
            <date>2004-07-25 12:07:00 +0000</date>
            <delta_ts>2004-07-25 12:07:04 +0000</delta_ts>
            <desc>HostConfig with Fixes and new questions</desc>
            <filename>HostConfig20040725.patch</filename>
            <type>text/plain</type>
            <size>23072</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>12215</attachid>
            <date>2004-07-25 12:07:00 +0000</date>
            <delta_ts>2004-07-25 12:07:34 +0000</delta_ts>
            <desc>Changed LocalString for HostConfig</desc>
            <filename>HostConfig20040725-LocalStrings.patch</filename>
            <type>text/plain</type>
            <size>3069</size>
            <attacher name="Peter Rossbach">pr</attacher>
            

          </attachment>
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>30325</bug_id>
          
          <creation_ts>2004-07-26 17:16:00 +0000</creation_ts>
          <short_desc>[PATCH] $CATALINA_HOME set unconditionally in bin/catalina.sh</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.27</version>
          <rep_platform>All</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P5</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Guillaume Déflache">guillaume</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>61143</commentid>
    <comment_count>0</comment_count>
    <who name="Guillaume Déflache">guillaume</who>
    <bug_when>2004-07-26 17:16:50 +0000</bug_when>
    <thetext>...whereas in bin/catalina.bat it is only set if not defined, as documented.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61144</commentid>
    <comment_count>1</comment_count>
      <attachid>12226</attachid>
    <who name="Guillaume Déflache">guillaume</who>
    <bug_when>2004-07-26 17:24:20 +0000</bug_when>
    <thetext>Created attachment 12226
Patch not to set $CATALINA_HOME if already defined (applies to bin/catalina.sh).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61145</commentid>
    <comment_count>2</comment_count>
    <who name="Guillaume Déflache">guillaume</who>
    <bug_when>2004-07-26 17:27:14 +0000</bug_when>
    <thetext>Provided patch to fix the problem. Done on Tomcat 5.0.27 but works on 5.0.25 as
well.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61248</commentid>
    <comment_count>3</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-07-28 15:50:57 +0000</bug_when>
    <thetext>This seems reasonable.  Patch committed.  Thanks.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>12226</attachid>
            <date>2004-07-26 17:24:00 +0000</date>
            <delta_ts>2004-07-26 17:24:20 +0000</delta_ts>
            <desc>Patch not to set $CATALINA_HOME if already defined (applies to bin/catalina.sh).</desc>
            <filename>catalina.sh.patch</filename>
            <type>text/plain</type>
            <size>366</size>
            <attacher name="Guillaume Déflache">guillaume</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>30346</bug_id>
          
          <creation_ts>2004-07-27 12:45:00 +0000</creation_ts>
          <short_desc>service.bat did not work properly; Unable to find a javac compiler</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.0.27</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Leif Hanack">leif.hanack</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>1</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>61178</commentid>
    <comment_count>0</comment_count>
    <who name="Leif Hanack">leif.hanack</who>
    <bug_when>2004-07-27 12:45:18 +0000</bug_when>
    <thetext>When using the /bin/service.bat on a windows system the service is created, 
but seems to leave a not 100% functional tomcat. tomcat is starting fine. If 
you browse a uncompiled jsp, you receive the following message:

..
org.apache.jasper.JasperException: Unable to compile class for JSP
..
Unable to find a javac compiler;
com.sun.tools.javac.Main is not on the classpath.
Perhaps JAVA_HOME does not point to the JDK
	org.apache.tools.ant.taskdefs.compilers.CompilerAdapterFactory.getCompi
ler(CompilerAdapterFactory.java:106)
..

The environment variables are set correct! Running the /bin/startup script 
everything works fine, i.e. jsp's got compiled correct.

At my web-search i found people who have the same problem, but i couldn't 
found the bug in the database. Someone tell to use the windows-installer-exe 
(jakarta-tomcat-5.0.27.exe) and define the JAVA_HOME to use. I've done this 
and the guy was right. 

The service that was installed within the installation process of jakarta-
tomcat-5.0.27.exe works fine. This service compiles jsp's as well, but the 
service.bat did not!

It would be great to hear soon from you:)

Thanks in advance, Leif</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61244</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-07-28 15:19:14 +0000</bug_when>
    <thetext>If you want to hear from us, the mailing lists are a better place than 
Bugzilla.  And if you want hear positive feedback, please post suggested 
patches and/or test cases with your bugs when possible ;)  Thanks.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62290</commentid>
    <comment_count>2</comment_count>
    <who name="Mladen Turk">mturk</who>
    <bug_when>2004-08-21 15:47:04 +0000</bug_when>
    <thetext>Just closing the bug report :)
Already fixed in the CVS.
</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>30352</bug_id>
          
          <creation_ts>2004-07-27 22:07:00 +0000</creation_ts>
          <short_desc>CLIENT-CERT auth doesn't work with DataSourceRealm and JDBCRealm</short_desc>
          <delta_ts>2004-11-29 12:02:34 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.27</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Marek Materzok">tilk</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>61203</commentid>
    <comment_count>0</comment_count>
    <who name="Marek Materzok">tilk</who>
    <bug_when>2004-07-27 22:07:21 +0000</bug_when>
    <thetext>CLIENT-CERT authentication, as defined in RealmBase, requires working
getPrincipal() method. However, DataSourceRealm and JDBCRealm have dummy
getPrincipal(), which always returns null, so CLIENT-CERT auth doesn't work with
these realms. Why is it like that? Will it be fixed?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63603</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-15 16:18:10 +0000</bug_when>
    <thetext>Did you actually try testing CLIENT-CERT authentication? ;)  It works.  Check 
out http://marc.theaimsgroup.com/?l=tomcat-user&amp;m=109275632305374&amp;w=2 for 
example.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63609</commentid>
    <comment_count>2</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-09-15 17:00:09 +0000</bug_when>
    <thetext>Are you, like, totally brain-dead?  CLIENT-CERT auth only works with 
MemoryRealm and (in 5.5.x) UDBRealm.  With the other Realms, it's just like the 
reporter states it is.  </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>66121</commentid>
    <comment_count>3</comment_count>
    <who name="T Rob Darrough">rdarrough</who>
    <bug_when>2004-10-29 18:24:38 +0000</bug_when>
    <thetext>The example URL you give (marc.theaimsgroup.com) has role-name *. If web.xml 
has inside security-role any role-name other than * then tomcat will give 403 
to users in that role.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>67143</commentid>
    <comment_count>4</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-11-18 16:11:12 +0000</bug_when>
    <thetext>Changing this to an enhancement request.  OP, if you want to work on this, a 
patch would be gladly welcome.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>67575</commentid>
    <comment_count>5</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2004-11-29 21:02:34 +0000</bug_when>
    <thetext>This is now fixed in CVS for TC5.5.x</thetext>
  </long_desc>
      
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>30359</bug_id>
          
          <creation_ts>2004-07-28 09:18:00 +0000</creation_ts>
          <short_desc>If installed as service by Installer tempdir property is invalid</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Native:Integration</component>
          <version>5.0.27</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Wolfgang Knauf">wknauf</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>61221</commentid>
    <comment_count>0</comment_count>
    <who name="Wolfgang Knauf">wknauf</who>
    <bug_when>2004-07-28 09:18:47 +0000</bug_when>
    <thetext>During install I choose the option to install Tomcat as a service. 

Afterwards I found out that the Java property "java.io.tmpdir"
(System.getProperty("java.io.tmpdir") ) pointed to the tomcat base dir (in my
case: "D:\Programme\Apache Group\Tomcat5", not to the "temp" subdir
("D:\Programme\Apache Group\Tomcat5\temp").

In the "service.bat" file this is correctly specified
("-Djava.io.tmpdir=%CATALINA_BASE%\temp").

So this was my workaround: remove the service, reinstall it with this file.

The OS is Windows Server 2003.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62289</commentid>
    <comment_count>1</comment_count>
    <who name="Mladen Turk">mturk</who>
    <bug_when>2004-08-21 15:35:00 +0000</bug_when>
    <thetext>Fixed in the CVS.
Thx. for spotting that</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>30415</bug_id>
          
          <creation_ts>2004-07-30 16:21:00 +0000</creation_ts>
          <short_desc>DocBase folders that end with .war are incorrectly handled as WAR files</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.27</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Miles Chaston">miles.chaston</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>61389</commentid>
    <comment_count>0</comment_count>
    <who name="Miles Chaston">miles.chaston</who>
    <bug_when>2004-07-30 16:21:16 +0000</bug_when>
    <thetext>If a "Context" is defined with a doc base that is a folder ending with ".war", 
the SetDocBaseRule class misinterprets that as a WAR file that it needs to read 
using ExpandWar.  This fails with the following stack trace:

java.util.zip.ZipException: Access is denied
        at java.util.zip.ZipFile.open(Native Method)
        at java.util.zip.ZipFile.&lt;init&gt;(ZipFile.java:112)
        at java.util.jar.JarFile.&lt;init&gt;(JarFile.java:127)
        at java.util.jar.JarFile.&lt;init&gt;(JarFile.java:65)
        at sun.net.www.protocol.jar.URLJarFile.&lt;init&gt;(URLJarFile.java:55)
        at sun.net.www.protocol.jar.URLJarFile.getJarFile(URLJarFile.java:40)
        at sun.net.www.protocol.jar.JarFileFactory.get(JarFileFactory.java:78)
        at sun.net.www.protocol.jar.JarURLConnection.connect
(JarURLConnection.java:85)
        at sun.net.www.protocol.jar.JarURLConnection.getJarFile
(JarURLConnection.java:69)
        at org.apache.catalina.startup.ExpandWar.expand(ExpandWar.java:155)
        at org.apache.catalina.startup.SetDocBaseRule.begin
(SetDocBaseRule.java:129)
        at org.apache.commons.digester.Digester.startElement(Digester.java:1273)
        at org.apache.catalina.util.CatalinaDigester.startElement
(CatalinaDigester.java:65)
        at org.apache.xerces.parsers.AbstractSAXParser.startElement(Unknown 
Source)
...

What should happen is that the folder is recognized as such and read like 
normal.  This bug (or at least the effect) has existed since at least tomcat 
4.1.27.

Possible fix note:
The problem comes from SetDocBaseRule line 123.  If the test first looked to 
see if it was a folder, this problem could be avoided.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61395</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-07-30 17:53:28 +0000</bug_when>
    <thetext>How about not using .war as a docBase? ;)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62976</commentid>
    <comment_count>2</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-02 18:47:59 +0000</bug_when>
    <thetext>Fixed on TOMCAT_5_0 branch.  I'll take a look at CVS HEAD, but this might not 
be relevant for Tomcat 5.5.  I still think it's a dubious use-case that should 
be avoided.</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>30561</bug_id>
          
          <creation_ts>2004-08-10 15:42:00 +0000</creation_ts>
          <short_desc>NamingService doesn't correctly start/stop</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.27</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Frédéric Mascaro">dev</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>61757</commentid>
    <comment_count>0</comment_count>
    <who name="Frédéric Mascaro">dev</who>
    <bug_when>2004-08-10 15:42:16 +0000</bug_when>
    <thetext>1/ When you start the NamingService for the first time, with no
Context.INITIAL_CONTEXT_FACTORY property, everything works fine. The default
value is null.

2/ When you stop the NamingService, the property is then "", and not null.

3/ If you want to restart the NamingService, the "oldValue" isn't null and so
it's used. So, the NamingService doesn't start.

This is my solution, in the start method:

oldValue = System.getProperty(Context.INITIAL_CONTEXT_FACTORY);
if (oldValue != null &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &amp;&amp; oldValue.length() &gt; 0 &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;) {
   oldIcValue = oldValue;
} else {
   System.setProperty(Context.INITIAL_CONTEXT_FACTORY, Constants.Package 
     + ".java.javaURLContextFactory");
}

Now, when you start + stop + start the NamingService, the service works fine.


Frederic</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62282</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-08-21 12:28:49 +0000</bug_when>
    <thetext>Done as suggested.  Thanks ;)</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>30568</bug_id>
          
          <creation_ts>2004-08-10 18:59:00 +0000</creation_ts>
          <short_desc>Cannot find daemon loader</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.27</version>
          <rep_platform>Macintosh</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Justin Gombos">bugdatabase.tomcat.jgombos</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>crossley</cc>
          <votes>1</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>61769</commentid>
    <comment_count>0</comment_count>
    <who name="Justin Gombos">bugdatabase.tomcat.jgombos</who>
    <bug_when>2004-08-10 18:59:12 +0000</bug_when>
    <thetext>There are multiple defects.  Some are likely to be defects with the Gentoo 
distribution of Tomcat5, and at least one of the defects (documented below) is 
in Catalina.  For the history of installation issues, see the following two 
URLS:

  http://forums.gentoo.org/viewtopic.php?t=208259
  http://bugs.gentoo.org/show_bug.cgi?id=59899

I spotted another report of this issue in an Apache mailing list:

  http://www.mail-archive.com/commons-dev@jakarta.apache.org/msg30457.html

Skipping the installation issues (because they may be in the scope of the 
Gentoo folks), I will go right to the problem that results following a manual 
install as per the Tomcat documentation.

Execution of:

    cd $CATALINA_HOME
    ./bin/jsvc -Djava.endorsed.dirs=./common/endorsed -cp ./bin/bootstrap.jar \
        -outfile ./logs/catalina.out -errfile ./logs/catalina.err \
        org.apache.catalina.startup.Bootstrap

Results in:

  jsvc.exec error: Cannot find daemon loader 
    org/apache/commons/daemon/support/DaemonLoader
  jsvc.exec error: Service exit with a return value of 1

I see no reason why jsvc would not be able to find the Daemon Loader.  The JAR 
file is in the $CATALINA_HOME/bin folder, and looking at the table of contents 
reveals the class that jsvc cannot find.

Also, it may still be worthwhile to look at the Gentoo installation issues, 
because the ./configure script that comes packaged with Tomcat fails when 
uname -m returns "ppc64".</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62849</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-08-31 14:23:57 +0000</bug_when>
    <thetext>I don't have a Gentoo system to test.  This works for me on Solaris and RHEL by 
following the Tomcat docs, no problem.

bootstrap.jar includes commons-daemon.jar in its manifest Class Path.  If 
commons-daemon.jar is in the same directory with the proper file permissions, 
you should have no problem with this.  If you do have a problem, it's a 
configuration or installation issue, not a Tomcat bug.

Finally, please use separate Bugzilla issues for separate bugs, don't combine 
them.  For example, the ./configure script bug you report should be a separate 
issue.  (That one as I mentioned I can't test because I don't have a Gentoo 
system).  Thanks.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63085</commentid>
    <comment_count>2</comment_count>
    <who name="David Crossley">crossley</who>
    <bug_when>2004-09-05 07:44:38 +0000</bug_when>
    <thetext>I see this same issue with Tomcat-5.0.28 binary distribution (on RedHat Linux 9
and J2SDK-1.4.1).
Followed the instructions at
http://jakarta.apache.org/tomcat/tomcat-5.0-doc/setup.html
and get the same problems and described in this issue.

Following $CATALINA_HOME/RUNNING.txt and using startup.sh is okay.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63238</commentid>
    <comment_count>3</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-08 19:51:52 +0000</bug_when>
    <thetext>OK, if you want, please submit doc patches for setup.xml and I'll modify that 
file so that the instructions are correct.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63261</commentid>
    <comment_count>4</comment_count>
    <who name="David Crossley">crossley</who>
    <bug_when>2004-09-09 01:33:22 +0000</bug_when>
    <thetext>Perhaps you misinterpret my comments. The documentation describes two different
ways to start Tomcat. The method described in RUNNING.txt works okay. The method
described in setup.html fails with this "daemon loader" error.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63606</commentid>
    <comment_count>5</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-15 16:20:37 +0000</bug_when>
    <thetext>I understand your comments, I think ;)  I'm asking you to provide a diff patch 
of setup.xml so that it is correct.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64270</commentid>
    <comment_count>6</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-27 15:33:48 +0000</bug_when>
    <thetext>OK, I've added a note to cover this situation to the setup.xml (which becomes 
setup.html) files, on both the Tomcat 5.0 and 5.5 branches.  Thanks for 
reporting this issue.</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>30583</bug_id>
          
          <creation_ts>2004-08-11 09:40:00 +0000</creation_ts>
          <short_desc>Cannot switch of tld scan for Embedded tomcat</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.27</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Christian Pesch">Christian.Pesch</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>61802</commentid>
    <comment_count>0</comment_count>
    <who name="Christian Pesch">Christian.Pesch</who>
    <bug_when>2004-08-11 09:40:47 +0000</bug_when>
    <thetext>Hi,

I'm using the Embedded tomcat 5.0.27 for servlets only. So a minimalistic setup
is ok. When starting up, the StandardContext does a TLD scan, which fails als it
finds a TLD, which is not meant to be used in this setup:

java.lang.NullPointerException
        at
org.apache.catalina.startup.DigesterFactory.register(DigesterFactory.java:174)
        at
org.apache.catalina.startup.DigesterFactory.registerLocalSchema(DigesterFactory.java:130)
        at
org.apache.catalina.startup.DigesterFactory.newDigester(DigesterFactory.java:92)
        at
org.apache.catalina.startup.TldConfig.createTldDigester(TldConfig.java:408)
        at org.apache.catalina.startup.TldConfig.tldScanStream(TldConfig.java:508)
        at org.apache.catalina.startup.TldConfig.tldScanJar(TldConfig.java:472)
        at org.apache.catalina.startup.TldConfig.execute(TldConfig.java:307)
        at org.apache.catalina.core.StandardContext.start(StandardContext.java:4282)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1083)
        at org.apache.catalina.core.StandardHost.start(StandardHost.java:789)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1083)
        at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:478)
        at org.apache.catalina.startup.Embedded.start(Embedded.java:846)
        at
com.coremedia.servlet.tomcat.EmbeddedTomcat.start(EmbeddedTomcat.java:118)

Please consider making the TLD scan optional, as thought about in 
StandardContext:

org.apache.catalina.core.StandardContext, line 4260ff

               // Read tldListeners. XXX Option to disable
                TldConfig tldConfig = new TldConfig();
                tldConfig.setContext(this);

The workaround to overwrite this large start() method is not very elegant
and error prone.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62850</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-08-31 14:53:34 +0000</bug_when>
    <thetext>OK, feature added.  StandardContext now has a processTlds attribute which you 
can set to false in your use-case.  I also took processTlds() out of the big 
start() method so that classes extending StandardContext can easily modify 
processTlds behavior.  All of this will be available in Tomcat 5.0.29 and 5.5.0.</thetext>
  </long_desc>
      
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>30587</bug_id>
          
          <creation_ts>2004-08-11 12:10:00 +0000</creation_ts>
          <short_desc>ExtendedAccessLogValve typo for  x-H(requestedSessionIdValid)</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>http://marc.theaimsgroup.com/?l=tomcat-dev&amp;m=109220681724335&amp;w=2</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Tim Funk">funkman</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>61809</commentid>
    <comment_count>0</comment_count>
    <who name="Tim Funk">funkman</who>
    <bug_when>2004-08-11 12:10:30 +0000</bug_when>
    <thetext>Per the link there's a typo in ExtendedAccessLogValve. The link has a PATCH too. 

Just copying from the tomcat-dev list - so its not lost.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61837</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-08-11 16:35:06 +0000</bug_when>
    <thetext>OK, fixed.  Thanks for submitting the patch.</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>30602</bug_id>
          
          <creation_ts>2004-08-11 17:31:00 +0000</creation_ts>
          <short_desc>Subject is not available during the first call to the servlet which use the basic authentication</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.27</version>
          <rep_platform>All</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Josip Jureta">jjureta</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>61844</commentid>
    <comment_count>0</comment_count>
    <who name="Josip Jureta">jjureta</who>
    <bug_when>2004-08-11 17:31:22 +0000</bug_when>
    <thetext>Hi,

I’m using jakarta-tomcat-5.0.27-src and Windows XP.

I made a servlet that print current subject principals (authenticated user).
The servlet code is:

&lt;code&gt;
private void doQuery(
HttpServletRequest request,
HttpServletResponse response)
throws ServletException, IOException {

response.setContentType("text/html");
PrintWriter out = response.getWriter();

out.println("&lt;HTML&gt;");
out.println("&lt;HEAD&gt;");
out.println("&lt;TITLE&gt;TestServletProtected&lt;/TITLE&gt;");

out.println("&lt;META HTTP-EQUIV=\"Pragma\" CONTENT=\"no-cache\"&gt;");
out.println("&lt;META HTTP-EQUIV=\"Expires\" CONTENT=\"-1\"&gt;");

out.println("&lt;/HEAD&gt;");

out.println("&lt;BODY&gt;");

out.println("&lt;br&gt;");
out.println(request.getAuthType());
out.println("&lt;/br&gt;");
out.println("&lt;br&gt;");
out.println(request.getRemoteUser());
out.println("&lt;/br&gt;");
out.println("&lt;br&gt;");
out.println(request.getUserPrincipal());
out.println("&lt;/br&gt;");
out.println("&lt;br&gt;");
out.println(request.isUserInRole("tomcat"));
out.println("&lt;/br&gt;");
out.println("&lt;br&gt;");
out.println(request.isUserInRole("admin"));
out.println("&lt;/br&gt;");

Subject subject = Subject.getSubject(AccessController.getContext());
out.println("&lt;br&gt;");
out.println(subject);
out.println("&lt;/br&gt;");

subject =
(Subject) request.getSession(true).getAttribute(
"javax.security.auth.subject");

out.println("&lt;br&gt;");
out.println(subject);
out.println("&lt;/br&gt;");
out.println("&lt;/BODY&gt;");

out.println("&lt;/BODY&gt;");
out.println("&lt;/HTML&gt;");

out.close();
    }
&lt;/code&gt;

The first time I call this servlet I get:
BASIC 
tomcat 
GenericPrincipal[tomcat(admin,manager,tomcat,)] 
true 
true 
null 
null

The next time I get:
BASIC 
tomcat 
GenericPrincipal[tomcat(admin,manager,tomcat,)] 
true 
true 
Subject: Principal: GenericPrincipal[tomcat(admin,manager,tomcat,)] 
Subject: Principal: GenericPrincipal[tomcat(admin,manager,tomcat,)]

I found that SecurityUtil.execute trying to find the subject in the current 
session, 
but because the session is not been created yet, the subject passed to the 
function 
Subject.doAsPrivileged is null.

When I changed the code in the function SecurityUtil.execute to:

// The first argument is always the request object
if (targetArguments != null 
&amp;&amp; targetArguments[0] instanceof HttpServletRequest){
HttpServletRequest request = 
(HttpServletRequest)targetArguments[0];

HttpSession session = request.getSession(false);
if (session != null){
subject =        (Subject)session.getAttribute(Globals.SUBJECT_ATTR);
}
                
if ((subject == null) &amp;&amp; (principal != null)){
subject = new Subject();
subject.getPrincipals().add(principal);
                        
if(session != null) {
session.setAttribute(Globals.SUBJECT_ATTR, subject);
}
}
}

Everything looks OK except that the subject is not in the session 
(request.getSession(true).getAttribute(
"javax.security.auth.subject"); return null).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62145</commentid>
    <comment_count>1</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2004-08-18 20:06:53 +0000</bug_when>
    <thetext>I will investigate more, but your fix make sense. More to come.

-- Jeanfrancois </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62236</commentid>
    <comment_count>2</comment_count>
    <who name="Jean-Francois Arcand">jfarcand</who>
    <bug_when>2004-08-20 14:31:26 +0000</bug_when>
    <thetext>Fixed. Will be available in the next release of Tomcat 5.

Merci :-)

-- Jeanfrancois</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>30615</bug_id>
          
          <creation_ts>2004-08-12 13:08:00 +0000</creation_ts>
          <short_desc>Installing Tomcat as a Windows Service fails to recognize non-standard service name</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.0.24</version>
          <rep_platform>Other</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Sean McRae">smcrae</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>61882</commentid>
    <comment_count>0</comment_count>
    <who name="Sean McRae">smcrae</who>
    <bug_when>2004-08-12 13:08:03 +0000</bug_when>
    <thetext>Usinng service.bat to install Tomcat 5 as a Windows service does not respect 
the service name passed from the command line. Error appears to be in line 64 
of service.bat:

ERRANT:  set PR_DISPLAYNAME=Apache Tomcat

CORRECT: set PR_DISPLAYNAME=%SERVICE_NAME%

Optionally there could be hard coded values in there like this: (our solution)

OPTIONAL: set PR_DISPLAYNAME=Apache Tomcat %SERVICE_NAME%</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61883</commentid>
    <comment_count>1</comment_count>
    <who name="Mladen Turk">mturk</who>
    <bug_when>2004-08-12 13:45:24 +0000</bug_when>
    <thetext>Well, It's not a major bug :)

Anyhow the patched version is in the CVS.
It sets the display name to a different value ony if the service name
has been provided at the command line.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61885</commentid>
    <comment_count>2</comment_count>
    <who name="Sean McRae">smcrae</who>
    <bug_when>2004-08-12 13:49:59 +0000</bug_when>
    <thetext>Cool, thanks. Only marked it as major since the install fails if you attempt to 
install the service multiple times (like we do). The script runs and fails but 
still says the service was installed. Perhaps there should be a check for the 
return value from the executable to indicate success/failure in the file?</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>30624</bug_id>
          
          <creation_ts>2004-08-12 17:07:00 +0000</creation_ts>
          <short_desc>unable to load tiles-definition.war when running embedded tomcat</short_desc>
          <delta_ts>2008-02-14 06:08:58 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.27</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>blocker</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Sudhir Srinivas">sudhir.srinivas</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>61905</commentid>
    <comment_count>0</comment_count>
    <who name="Sudhir Srinivas">sudhir.srinivas</who>
    <bug_when>2004-08-12 17:07:15 +0000</bug_when>
    <thetext>I was prototyping using tomcat embedded in my java application. Was trouble 
having launch a webapp based on tiles/struts. i got this error when i tried to 
run the standard example of tiles-definiton.war. This war properly loads when 
running tomcat as a stand alone web container.


java.lang.NullPointerException
        at org.apache.catalina.realm.RealmBase.findSecurityConstraints
(RealmBase
.java:428)
        at org.apache.catalina.authenticator.AuthenticatorBase.invoke
(Authentica
torBase.java:455)
        at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValv
eContext.java:102)
        at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.jav
a:520)
        at org.apache.catalina.core.StandardHostValve.invoke
(StandardHostValve.j
ava:137)
        at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValv
eContext.java:104)
        at org.apache.catalina.valves.ErrorReportValve.invoke
(ErrorReportValve.j
ava:117)
        at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValv
eContext.java:102)
        at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.jav
a:520)
        at org.apache.catalina.core.StandardEngineValve.invoke
(StandardEngineVal
ve.java:109)
        at org.apache.catalina.core.StandardValveContext.invokeNext
(StandardValv
eContext.java:104)
        at org.apache.catalina.core.StandardPipeline.invoke
(StandardPipeline.jav
a:520)
        at org.apache.catalina.core.ContainerBase.invoke
(ContainerBase.java:929)

        at org.apache.coyote.tomcat5.CoyoteAdapter.service
(CoyoteAdapter.java:16
0)
        at org.apache.coyote.http11.Http11Processor.process
(Http11Processor.java
:799)
        at 
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.proce
ssConnection(Http11Protocol.java:705)
        at org.apache.tomcat.util.net.TcpWorkerThread.runIt
(PoolTcpEndpoint.java
:577)
        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run
(ThreadP
ool.java:683)
        at java.lang.Thread.run(Thread.java:534)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>61906</commentid>
    <comment_count>1</comment_count>
      <attachid>12409</attachid>
    <who name="Sudhir Srinivas">sudhir.srinivas</who>
    <bug_when>2004-08-12 17:09:28 +0000</bug_when>
    <thetext>Created attachment 12409
the java file that i compile to run tomcat embedded</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62810</commentid>
    <comment_count>2</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-08-30 20:33:57 +0000</bug_when>
    <thetext>I've added better null checking in RealmBase#findSecurityConstraints on both 
the TOMCAT_5_0 and CVS HEAD branches.  Thanks for pointing this out.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>113744</commentid>
    <comment_count>3</comment_count>
    <who name="quartz">quartz12h</who>
    <bug_when>2008-02-14 06:08:58 +0000</bug_when>
    <thetext>We have seen this bug on 5.5.23

java.lang.NullPointerException
at org.apache.catalina.realm.RealmBase.findSecurityConstraints(RealmBase.java:501)
at
org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:426)

Please assert the necessity to reopen, or spin off a bug for the 5.5.x branch.
Thanks.
</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>12409</attachid>
            <date>2004-08-12 17:09:00 +0000</date>
            <delta_ts>2004-08-12 17:09:28 +0000</delta_ts>
            <desc>the java file that i compile to run tomcat embedded</desc>
            <filename>EmbeddedTomcat.java</filename>
            <type>text/plain</type>
            <size>4208</size>
            <attacher name="Sudhir Srinivas">sudhir.srinivas</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>30636</bug_id>
          
          <creation_ts>2004-08-12 21:00:00 +0000</creation_ts>
          <short_desc>NullPointerException in DigesterFactory</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.27</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Rob Grzywinski">rgrzywinski</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>61920</commentid>
    <comment_count>0</comment_count>
    <who name="Rob Grzywinski">rgrzywinski</who>
    <bug_when>2004-08-12 21:00:17 +0000</bug_when>
    <thetext>A misconfigured server will cause the following:

java.lang.NullPointerException
	at org.apache.catalina.startup.DigesterFactory.register
(DigesterFactory.java:174)
	at org.apache.catalina.startup.DigesterFactory.registerLocalSchema
(DigesterFactory.java:139)
	at org.apache.catalina.startup.DigesterFactory.newDigester
(DigesterFactory.java:92)
	at org.apache.catalina.startup.ContextConfig.createWebXmlDigester
(ContextConfig.java:435)
        ...

The defect occurs because a resource is loaded from the ClassLoader and is 
never checked for null.  Lines 173 - 174 of 
org.apache.catalina.startup.DigesterFactory should be changed to:

        URL url = DigesterFactory.class.getResource(resourceURL);
        if(url == null)
            throw new WhateverIsAnAppropriateException(&lt;"The resource 
identified by \"" + resourceURL + "\" does not exist."&gt;);
        /* else -- the URL for the resource exists */
        schemaResolver.register(resourcePublicId , url.toString() );

where the text in &lt;&gt;'s is replaced with the appropriate resource bundle 
mechanism.

I would recommend that a code audit is performed to determine other such uses 
of getResource(), getResourceAsStream(), etc without appropriate null checks to 
ensure a consistent and pleasant user experience.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62960</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-02 14:28:11 +0000</bug_when>
    <thetext>Added Log and NPE checking to DigesterFactory.  Thanks.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>30650</bug_id>
          
          <creation_ts>2004-08-13 12:53:00 +0000</creation_ts>
          <short_desc>Override Object.equals() in StandardSession</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Servlet &amp; JSP API</component>
          <version>5.0.0</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Hendrik Saly">phps</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>61948</commentid>
    <comment_count>0</comment_count>
    <who name="Hendrik Saly">phps</who>
    <bug_when>2004-08-13 12:53:32 +0000</bug_when>
    <thetext>Consider to override Object.equals() and Object.hashCode() in StandardSession
or rather StandardSessionFacade. Isn't it a good idea, that equals() would
return  something like: session.getId().equals(otherSession.getId()).

If its not a good idea, please add a explicit Javadoc comment that sessions are
only considered as equal if they are "reference-equal".</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62638</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-08-28 12:56:07 +0000</bug_when>
    <thetext>I don't think it's a good idea when seen in light of clustering, and so I've 
added explicit comments as you requested.</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>30756</bug_id>
          
          <creation_ts>2004-08-19 16:24:00 +0000</creation_ts>
          <short_desc>MySQL DBCP Example on JNDI Datasource Documentation</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Documentation</component>
          <version>5.0.0</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc>http://jakarta.apache.org/tomcat/tomcat-5.0-doc/jndi-datasource-examples-howto.html</bug_file_loc>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="matt">s803738</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>62180</commentid>
    <comment_count>0</comment_count>
    <who name="matt">s803738</who>
    <bug_when>2004-08-19 16:24:04 +0000</bug_when>
    <thetext>MySQL DBCP Example Documentation

The following suggestions help to make sure that the example application works.

Suggestions

1. Add the "flush privileges" to the list of SQL commands for DBTest database
2. To replace "...Foo ${row.foo}..." with "... Foo &lt;c:out value="${row.foo}" /&gt; ..."
3. TO replace "...Bar ${row.bar}..." with "...Bar &lt;c:out value="${row.bar}" /&gt; ... "
4. To include the following lines in the web.xml
  &lt;taglib&gt;
    &lt;taglib-uri&gt;http://java.sun.com/jsp/jstl/sql&lt;/taglib-uri&gt;
    &lt;taglib-location&gt;/WEB-INF/tlds/sql.tld&lt;/taglib-location&gt;
  &lt;/taglib&gt;

  &lt;taglib&gt;
    &lt;taglib-uri&gt;http://java.sun.com/jsp/jstl/core&lt;/taglib-uri&gt;
    &lt;taglib-location&gt;/WEB-INF/tlds/c.tld&lt;/taglib-location&gt;
  &lt;/taglib&gt;
5. To include a sample directory structure about how the files are likely to be
kept. For example,

/DBTest/
/DBTest/test.jsp
/DBTest/WEB-INF
/DBTest/WEB-INF/web.xml
/DBTest/WEB-INF/lib/standard.jar
/DBTest/WEB-INF/lib/jstl.jar
/DBTest/WEB-INF/lib/*.jar
/DBTest/WEB-INF/tlds/c.tld
/DBTest/WEB-INF/tlds/sql.tld
/DBTest/WEB-INF/tlds/*.tld
/DBTest/WEB-INF/classes

6. To replace the following sentence "...Once you have JSTL, copy jstl.jar and
standard.jar to your web app's WEB-INF/lib directory..." with the following
sentence -&gt; "...Once you have JSTL, you can copy all the jar and tld files to
your web app's lib and tlds folders respectively ..."</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62299</commentid>
    <comment_count>1</comment_count>
    <who name="Daniel Lacerda">danlacer</who>
    <bug_when>2004-08-21 23:47:39 +0000</bug_when>
    <thetext>7. There is also a problem with the web.xml example for mysql DBCP. It has a
double open-tag:

---------------
&lt;web-app xmlns="http://java.sun.com/xml/ns/j2ee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee
http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"
    version="2.4"&gt;
&lt;web-app&gt; 
  &lt;description&gt;MySQL Test App&lt;/description&gt;
  ...
---------------
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62802</commentid>
    <comment_count>2</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-08-30 19:38:59 +0000</bug_when>
    <thetext>1 - Is it strictly necessary, and if so exactly what text should be there?
2,3 - Are they strictly necessary?  I think they're just an alternative JSTL 
syntax, so I won't add those now.
4 - Is not needed.
5 - Just clutters things up, that's why we have the First Webapp tutorial.
6 - I don't like the vague alternative text, suggest something clearer maybe.
7 - That's an error, I've fixed it in CVS (both TOMCAT_5_0 and HEAD branches).

Thanks for your help.  Next time send .diff patches please.</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>30762</bug_id>
          
          <creation_ts>2004-08-19 19:17:00 +0000</creation_ts>
          <short_desc>destroy method in servlet called before contextDestroyed method in ServletContextListener class.</short_desc>
          <delta_ts>2006-12-24 19:06:52 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.5.17</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P2</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="David L. Diehl">dldiehl</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>dldiehl</cc>
          <votes>2</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>62201</commentid>
    <comment_count>0</comment_count>
    <who name="David L. Diehl">dldiehl</who>
    <bug_when>2004-08-19 19:17:12 +0000</bug_when>
    <thetext>I created an implementation of ServletContextListener and was expecting its 
contextDestroyed(ServletContextEvent event) method to be invoked AFTER the 
destroy() method of the single servlet for the web app.  The 2.4 servlet spec 
states:

public void contextDestroyed(ServletContextEvent sce)
  Notification that the servlet context is about to be shut down. All servlets 
and filters have been destroy()ed before any ServletContextListeners are 
notified of context destruction.


Using Tomcat 5.0.25 and 5.0.27, the servlet destroy() method was invoked AFTER 
the contextDestroyed() method, in violation of the spec.  I tried with and 
without &lt;load-on-startup&gt; in the web.xml to see if this made a difference, and 
it did not.

NOTE:  The order of calls on the initialization side was correct and as I 
expected.  The method contextInitialized(ServletContextEvent event) in my 
ServletContextListener class was called before the init() methods of my 
servlet (and filters).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62601</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-08-27 16:56:41 +0000</bug_when>
    <thetext>Hmm, it seems you're right.  I'm attaching a WAR that shows this behavior.  I'm 
not sure how we haven't detected this in our tests and the Sun TCK tests.  I'll 
ask on tomcat-dev.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62602</commentid>
    <comment_count>2</comment_count>
      <attachid>12549</attachid>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-08-27 16:57:20 +0000</bug_when>
    <thetext>Created attachment 12549
A simple WAR showing this (writes to System.out)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62636</commentid>
    <comment_count>3</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-08-28 12:50:32 +0000</bug_when>
    <thetext>Fix committed on TOMCAT_5_0 branch.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>91700</commentid>
    <comment_count>4</comment_count>
    <who name="Michael Soubine Chun">mchun</who>
    <bug_when>2006-07-28 17:54:31 +0000</bug_when>
    <thetext>This bug seem to have revived in Tomcat 5.5.16 and currently present in Tomcat
5.5.17.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>93123</commentid>
    <comment_count>5</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2006-09-07 02:07:24 +0000</bug_when>
    <thetext>This has been re-fixed in SVN.

Thanks for the report.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>97250</commentid>
    <comment_count>6</comment_count>
    <who name="David L. Diehl">dldiehl</who>
    <bug_when>2006-12-24 19:06:52 +0000</bug_when>
    <thetext>*** Bug 39038 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>12549</attachid>
            <date>2004-08-27 16:57:00 +0000</date>
            <delta_ts>2004-08-27 16:57:20 +0000</delta_ts>
            <desc>A simple WAR showing this (writes to System.out)</desc>
            <filename>test.war</filename>
            <type>application/octet-stream</type>
            <size>2857</size>
            <attacher name="Yoav Shapira">yoavs</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>30763</bug_id>
          
          <creation_ts>2004-08-19 21:01:00 +0000</creation_ts>
          <short_desc>would be nice to have "failonerror" attribute for UndeployTask</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina:Modules</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ed Burns">edburns</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>62212</commentid>
    <comment_count>0</comment_count>
    <who name="Ed Burns">edburns</who>
    <bug_when>2004-08-19 21:01:06 +0000</bug_when>
    <thetext>It would be nice to be able to do &lt;remove ... failonerror="false"&gt; in my
build.xml file.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62213</commentid>
    <comment_count>1</comment_count>
      <attachid>12495</attachid>
    <who name="Ed Burns">edburns</who>
    <bug_when>2004-08-19 21:02:12 +0000</bug_when>
    <thetext>Created attachment 12495
trivial fix for this trivial feature request</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62804</commentid>
    <comment_count>2</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-08-30 19:54:55 +0000</bug_when>
    <thetext>OK, done.  Thanks.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>12495</attachid>
            <date>2004-08-19 21:02:00 +0000</date>
            <delta_ts>2004-08-19 21:02:12 +0000</delta_ts>
            <desc>trivial fix for this trivial feature request</desc>
            <filename>30763.txt</filename>
            <type>text/plain</type>
            <size>1037</size>
            <attacher name="Ed Burns">edburns</attacher>
            

          </attachment>
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>30770</bug_id>
          
          <creation_ts>2004-08-20 10:34:00 +0000</creation_ts>
          <short_desc>Crash on missing "user-agent" / compression enabled</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Connector:HTTP</component>
          <version>5.0.27</version>
          <rep_platform>All</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Elmar Haneke">elmar</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>62230</commentid>
    <comment_count>0</comment_count>
    <who name="Elmar Haneke">elmar</who>
    <bug_when>2004-08-20 10:34:07 +0000</bug_when>
    <thetext>When accessing tomcat (in standalone mode and compression="on") the server
refuses to handle any request if there is no user-agent transferred.

In catalina.out there is an exception noted:

SCHWERWIEGEND: Error finishing response
java.lang.NullPointerException
        at
org.apache.coyote.http11.Http11Processor.isCompressable(Http11Processor.java:1379)
        at
org.apache.coyote.http11.Http11Processor.prepareResponse(Http11Processor.java:1441)
        at org.apache.coyote.http11.Http11Processor.action(Http11Processor.java:892)
        at org.apache.coyote.Response.action(Response.java:180)
        at
org.apache.coyote.http11.InternalOutputBuffer.endRequest(InternalOutputBuffer.java:388
        at
org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:836)
        at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http
        at
org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:577)
        at
org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:683)
        at java.lang.Thread.run(Thread.java:536)

The problem can be reproduced with the "konqueror" browser, there is an option
not to send browser identification. If browser-identification is send everything
goes right, if the switch is changed the error does occurr.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62276</commentid>
    <comment_count>1</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-08-21 02:53:56 +0000</bug_when>
    <thetext>Fixed now in the CVS, and should appear in the next Tomcat release.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>30803</bug_id>
          
          <creation_ts>2004-08-23 12:45:00 +0000</creation_ts>
          <short_desc>WebApp classloader fails to load classes from CATALINA_HOME\shared\lib</short_desc>
          <delta_ts>2004-12-09 08:14:20 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.30</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="tal">tal_f</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>dave</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>62333</commentid>
    <comment_count>0</comment_count>
    <who name="tal">tal_f</who>
    <bug_when>2004-08-23 12:45:45 +0000</bug_when>
    <thetext>In the case which my web application is located under CATALINA_HOME\webapps 
everything works fine.
But, when I take the same web application and put it outside the tomcat 
directory and add a context.xml file to CATALINA_HOME\conf\Engine\Host , this 
context points to the physical location of the webapp,what happens is that the 
context is loaded propelrly but when i try to activate my classes located 
under my webapplication/lib in a jar file which are dependant on the mysql 
jdbc jars which are located under CATALINA_HOME\shared\lib which is a valid 
place according to the class loader delegation model I get a 
ClassNotFoundException
regarding the classes located under CATALINA_HOME\shared\lib in jar files</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63607</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-15 16:20:59 +0000</bug_when>
    <thetext>Fixed in 5.0.28 and 5.5.2.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>68139</commentid>
    <comment_count>2</comment_count>
    <who name="Dave Hodson">dave</who>
    <bug_when>2004-12-08 23:36:27 +0000</bug_when>
    <thetext>Bug occurs in 5.0.30</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>68191</commentid>
    <comment_count>3</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-12-09 17:14:20 +0000</bug_when>
    <thetext>Works for me in 5.5.5 and 5.0.30, from a clean simple test.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>30869</bug_id>
          
          <creation_ts>2004-08-26 14:48:00 +0000</creation_ts>
          <short_desc>JAAS module name is not allowed in jaas.conf file</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.27</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Alex Blewitt">alex_blewitt</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>62539</commentid>
    <comment_count>0</comment_count>
    <who name="Alex Blewitt">alex_blewitt</who>
    <bug_when>2004-08-26 14:48:50 +0000</bug_when>
    <thetext>When running with the JAASRealm, the container sets the JAAS application name to 
be the container's name:

--- 8&lt; --- JAASRealm.java --- 8&lt; ---
public void setContainer(Container container) {
  super.setContainer(container);
  String name=container.getName();
  if( appName==null  ) {
    appName=name;
    log.info("Setting JAAS app name " + appName);
  }
}
--- 8&lt; --- JAASRealm.java --- 8&lt; ---

However, the container's name always starts with a /, which isn't an allowable
name in the JAAS specification:

--- 8&lt; --- stdout --- 8&lt; ---
...
INFO: Setting JAAS app name /MyApp
...
--- 8&lt; --- stdout --- 8&lt; ---

--- 8&lt; --- jaas.conf --- 8&lt; ---
/MyApp {
  com.example.MyJAASLoginModule required;
};
--- 8&lt; --- jaas.conf --- 8&lt; ---

The Sun Security barfs at the '/' on leading MyApp, so it can't be speficied.
The default name 'Tomcat' doesn't work either, because the JAAS name has already
been set, and this cannot be set in the config file.

Instead, you have to use 'other' which is applicable to all apps in the application.

The fix would be to check whether there are any unprintable characters in the
application name, and if so, fix them. Of course, what constitutes an
unprintable character is up to Sun's Configuration parser, which probably isn't
that good.

A quick fix would be:

--- 8&lt; --- JAASRealm.java.fix --- 8&lt; ---
public void setContainer(Container container) {
  super.setContainer(container);
  String name=container.getName();
  if( appName==null  ) {
    if (name.startsWith("/")) name.substring(1);
    appName=name;
    log.info("Setting JAAS app name " + appName);
  }
}
--- 8&lt; --- JAASRealm.java.fix --- 8&lt; ---

but in reality, you'd need to check for all other non-printable characters and
replace/delete them as appropriate, because a name may have other / characters
(e.g. /MyApp/Other).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62540</commentid>
    <comment_count>1</comment_count>
    <who name="Alex Blewitt">alex_blewitt</who>
    <bug_when>2004-08-26 14:59:19 +0000</bug_when>
    <thetext>Of course, I meant 'name=name.substring(1)'.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62819</commentid>
    <comment_count>2</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-08-31 00:10:49 +0000</bug_when>
    <thetext>Can you point to the class or code in "Sun Security" that "barfs" at the 
leading slash please?  Also if you could attach your suggested patch in .diff 
format, that'd be great.  Thanks ;)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62827</commentid>
    <comment_count>3</comment_count>
    <who name="Alex Blewitt">alex_blewitt</who>
    <bug_when>2004-08-31 09:00:54 +0000</bug_when>
    <thetext>I'm not sure I can find the code for the barf, because I don't have the Sun
source code :-) 

I think the problem is in com.sun.security.auth.login.ConfigFile which is the
class reading the jaas.config file (actually, the name isn't relevant -- it's
the file pointed to by the URL in -Djava.security.auth.login.config or by
default in ${user.home}/.java.login.config)

The JavaDoc isn't up to much: ConfigFile is

http://java.sun.com/j2se/1.4.2/docs/guide/security/jaas/spec/com/sun/security/auth/login/ConfigFile.html

which says it parses the file with the syntax described in:

http://java.sun.com/j2se/1.4.2/docs/api/javax/security/auth/login/Configuration.html

and all it says in there is

"Each entry in the Configuration is indexed via an application name.

ApplicationName {
	      ModuleClass  Flag    ModuleOptions;
	      ModuleClass  Flag    ModuleOptions;
	      ModuleClass  Flag    ModuleOptions;
};
"

So Tomcat is setting the name OK programmatically, but the ConfigFile parser
only seems to allow [a-zA-Z]+ as the ApplicationName, so fails at the initial /

Thus, if you try and use a config file:

/MyAppRoot {
  com.example.LoginModule required;
};

then the ConfigFile parser doesn't successfully read it.

It seems that the ConfigFile uses lazy loading, so it doesn't parse the first
login request when using JAAS.

Sorry, can't paste in .diff format; I don't have the Tomcat source code on a
machine with a '.diff' command -- I just eyeballed the problem to find out why
the name was being set with a leading '/'.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63887</commentid>
    <comment_count>4</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-20 16:15:25 +0000</bug_when>
    <thetext>OK, done for both 5.0.29 and 5.5.3.  My initial implementation is simply to 
remove leading slash if one is present.  I made the relevant method protected 
so extenders of JAASRealm can easily modify this behavior.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>30905</bug_id>
          
          <creation_ts>2004-08-27 16:46:00 +0000</creation_ts>
          <short_desc>Windows installed doesn't setup properly</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.0.27</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>blocker</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Jerry Nelson">jerry.nelson</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>62599</commentid>
    <comment_count>0</comment_count>
    <who name="Jerry Nelson">jerry.nelson</who>
    <bug_when>2004-08-27 16:46:24 +0000</bug_when>
    <thetext>When running jakarta-tomcat-5.0.27.exe, the installer looks for j2re instead of 
j2sdk and the environment is not setup correctly.  Because of this, Tomcat 
cannot find Javac to compile JSP files, which means JSP web pages cannot run.  
No matter how you setup the environment manually, it still does not work.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62604</commentid>
    <comment_count>1</comment_count>
    <who name="Mladen Turk">mturk</who>
    <bug_when>2004-08-27 17:26:31 +0000</bug_when>
    <thetext>First of all it is not true. You can use tomcat5w and set the
JVM desired.
Anyhow this issue has been fixed in the cvs.
Wait for 5.0.28 that will be released next week.
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>30936</bug_id>
          
          <creation_ts>2004-08-30 10:54:00 +0000</creation_ts>
          <short_desc>Adding HTTPS Connector with Administration webapp mangles server.xml</short_desc>
          <delta_ts>2005-07-25 13:53:45 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Administration</component>
          <version>5.0.28</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Juha">juha_motorsportcom</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>alvaro</cc>
    
    <cc>sbj</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>62758</commentid>
    <comment_count>0</comment_count>
    <who name="Juha">juha_motorsportcom</who>
    <bug_when>2004-08-30 10:54:09 +0000</bug_when>
    <thetext>Installed Tomcat 5.0.28 from zip and installed as service with service.bat.
Service.bat did not work without modifications in 5.0.27, but now OK.
Modified service to use username Tomcat, started service, OK.

Added HTTPS-connector with Administration webapp, keystore configured to be in 
conf\tomcat.keystore.
Keystore also in user Tomcat home directory as .keystore, but no reference to 
it in configuration files.

Hitting Save button in Administration webapp did not change server.xml on disk, 
OK, https pages load OK with browser but certificate comes from .keystore file 
in user Tomcat home directory, not from configured file.

Hitting Save button and Commit changes buttons restarts? Tomcat and the 
server.xml is modified with new Connector :

    &lt;Connector acceptCount="100" connectionTimeout="20000" 
disableUploadTimeout="true" port="8080" redirectPort="8443" 
maxSpareThreads="75" maxThreads="150" minSpareThreads="25"&gt;
    &lt;/Connector&gt;
    &lt;Connector port="8009" protocol="AJP/1.3" 
protocolHandlerClassName="org.apache.jk.server.JkCoyoteHandler" 
redirectPort="8443"&gt;
    &lt;/Connector&gt;
    &lt;Connector keystoreFile="C:\Ohjelmatiedostot\jakarta-tomcat-5.0.28
\conf\tomcat.keystore" keystorePass="changeit" port="8443" redirectPort="-1" 
scheme="https" secure="true" sslProtocol="TLS" algorithm="SunX509" 
clientauth="false" keypass="changeit" keystore="C:\Documents and 
Settings\Tomcat\.keystore" keytype="JKS" protocol="TLS" secure="true"&gt;
      &lt;Factory className="org.apache.coyote.tomcat5.CoyoteServerSocketFactory" 
keystoreFile="C:\Ohjelmatiedostot\jakarta-tomcat-5.0.28\conf\tomcat.keystore"/&gt;
    &lt;/Connector&gt;

stderr.log at the end of this email.

then HTTPS not working. Same problem with Tomcat 5.0.27.
Tomcat 5.0.19 with Save and Commit changes --&gt; server.xml OK but needs stopping 
and starting Tomcat-service manually to read correct keystore file, then OK.

Regards,

Juha (Kuopio, Finland)

stderr.log :

30.8.2004 11:30:57 org.apache.commons.digester.Digester fatalError
SEVERE: Parse Fatal Error at line 24 column 369: Attribute "secure" was already 
specified for element "Connector".
org.xml.sax.SAXParseException: Attribute "secure" was already specified for 
element "Connector".
	at org.apache.xerces.util.ErrorHandlerWrapper.createSAXParseException
(Unknown Source)
	at org.apache.xerces.util.ErrorHandlerWrapper.fatalError(Unknown Source)
	at org.apache.xerces.impl.XMLErrorReporter.reportError(Unknown Source)
	at org.apache.xerces.impl.XMLErrorReporter.reportError(Unknown Source)
	at org.apache.xerces.impl.XMLScanner.reportFatalError(Unknown Source)
	at org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanAttribute
(Unknown Source)
	at 
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanStartElement(Unknown 
Source)
	at 
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.
dispatch(Unknown Source)
	at org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument
(Unknown Source)
	at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)
	at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)
	at org.apache.xerces.parsers.XMLParser.parse(Unknown Source)
	at org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)
	at org.apache.commons.digester.Digester.parse(Digester.java:1548)
	at org.apache.catalina.startup.Catalina.load(Catalina.java:489)
	at org.apache.catalina.startup.Catalina.load(Catalina.java:528)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke
(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke
(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:324)
	at org.apache.catalina.startup.Bootstrap.load(Bootstrap.java:250)
	at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:424)
30.8.2004 11:30:57 org.apache.commons.digester.Digester fatalError
SEVERE: Parse Fatal Error at line 24 column 369: Attribute "secure" was already 
specified for element "Connector".
org.xml.sax.SAXParseException: Attribute "secure" was already specified for 
element "Connector".
	at org.apache.xerces.util.ErrorHandlerWrapper.createSAXParseException
(Unknown Source)
	at org.apache.xerces.util.ErrorHandlerWrapper.fatalError(Unknown Source)
	at org.apache.xerces.impl.XMLErrorReporter.reportError(Unknown Source)
	at org.apache.xerces.impl.XMLErrorReporter.reportError(Unknown Source)
	at org.apache.xerces.impl.XMLScanner.reportFatalError(Unknown Source)
	at org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanAttribute
(Unknown Source)
	at 
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanStartElement(Unknown 
Source)
	at 
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.
dispatch(Unknown Source)
	at org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument
(Unknown Source)
	at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)
	at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)
	at org.apache.xerces.parsers.XMLParser.parse(Unknown Source)
	at org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)
	at org.apache.commons.digester.Digester.parse(Digester.java:1548)
	at org.apache.catalina.startup.Catalina.load(Catalina.java:489)
	at org.apache.catalina.startup.Catalina.start(Catalina.java:548)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke
(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke
(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:324)
	at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:287)
	at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:425)
30.8.2004 11:30:57 org.apache.catalina.startup.Catalina start
INFO: Server startup in 0 ms
java.lang.reflect.InvocationTargetException
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke
(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke
(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:324)
	at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:287)
	at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:425)
Caused by: java.lang.NullPointerException
	at org.apache.catalina.startup.Catalina.await(Catalina.java:619)
	at org.apache.catalina.startup.Catalina.start(Catalina.java:579)
	... 6 more</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62784</commentid>
    <comment_count>1</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2004-08-30 15:40:21 +0000</bug_when>
    <thetext>Hey,

yes, that is a really existing problem. I have start to implement
a better saving server.xml mechanism. But believe me, that is currently
not easy. I hope at next week to commit a first version for Tomcat 5.5.0

After testing, I will see to made a backport to 5.0.x release line.

Regards
Peter</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62986</commentid>
    <comment_count>2</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-02 19:38:16 +0000</bug_when>
    <thetext>I actually think this might be much simpler: both the Connector and the 
ProtocolHandler have a "secure" attribute, so the persister outputs it twice 
and Digester complains.  This is not an i18n issue like some other admin 
persistence errors.

BTW, you're too late for 5.5.0 ;)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>66129</commentid>
    <comment_count>3</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-10-29 18:40:28 +0000</bug_when>
    <thetext>*** Bug 30198 has been marked as a duplicate of this bug. ***</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>72402</commentid>
    <comment_count>4</comment_count>
    <who name="James Clark">sbj</who>
    <bug_when>2005-03-14 18:23:34 +0000</bug_when>
    <thetext>One of my customers has experienced this problem lately.  For them, server.xml
is modified every time Tomcat is restarted.  The only workaround I know of is to
overwrite server.xml just before starting Tomcat, every time.
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>72883</commentid>
    <comment_count>5</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2005-03-26 04:23:59 +0000</bug_when>
    <thetext>This should be fixed in the new storeconfig module that's shipping with Tomcat
5.5.9, which itself will be out in a couple of days.  Can you please test it
when you get a chance and let us know how it works?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>73099</commentid>
    <comment_count>6</comment_count>
    <who name="Juha">juha_motorsportcom</who>
    <bug_when>2005-03-30 19:52:44 +0000</bug_when>
    <thetext>Sorry but cannot test for a while. I am on vacation for 2 months, soon sitting
under a palm tree in Barbados and sipping rum punch. Hopefully I don't see any
cats named Tom while in Barbados ;)

--juha</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>73100</commentid>
    <comment_count>7</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2005-03-30 20:07:55 +0000</bug_when>
    <thetext>What a nice long vacation... If you do see any such cats, make sure to take a
picture.  We could use nifty graphics...</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>77572</commentid>
    <comment_count>8</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2005-07-22 16:25:18 +0000</bug_when>
    <thetext>Almost 4 months later: can you please test the 5.5.9 StoreConfig enhancements to
see if they solve your problem?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>77586</commentid>
    <comment_count>9</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2005-07-22 19:02:12 +0000</bug_when>
    <thetext>5.5.10 I hope solve the problem,
but I see no chance to make a backport from storeconfig to the 5.0.x code base.

</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>77640</commentid>
    <comment_count>10</comment_count>
    <who name="Juha">juha_motorsportcom</who>
    <bug_when>2005-07-25 21:53:45 +0000</bug_when>
    <thetext>After returning from my vacation I forgot to test .... Sorry Yoavs ....

The reason is that I have moved to a completely different project, aviation
related, and I have not had anything to do with Java, Tomcat or even web servers!

--juha</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>30949</bug_id>
          
          <creation_ts>2004-08-30 23:54:00 +0000</creation_ts>
          <short_desc>After Failed Include, Request and Response not Unwrapped</short_desc>
          <delta_ts>2007-09-04 19:02:45 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.27</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Scott Goldstein">sdgoldst</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>mcalmus</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>62818</commentid>
    <comment_count>0</comment_count>
    <who name="Scott Goldstein">sdgoldst</who>
    <bug_when>2004-08-30 23:54:36 +0000</bug_when>
    <thetext>In org.apache.catalina.core.ApplicationDispatcher.doInclude(ServletRequest 
request, ServletResponse response), after invoke() is called to perform the 
include, the request and response objects are normally unwrapped.  However, if 
a ServletException or IOException is thrown, the unwrapping does not take place.

This leads to problems in environments in which cross context includes are 
being performed.  For example, 

1.  Web App A performs an include to a Servlet in Web App B
2.  The Servlet in Web App B throws a ServletException
3.  Web App A catches the ServletException and attempts to forward to an error 
jsp.

Step 3 above will fail due to the fact that the request has not been 
unwrapped.  The active request will contain the ServletContext of web app B and 
the jsp file will not be found.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62821</commentid>
    <comment_count>1</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-08-31 00:29:43 +0000</bug_when>
    <thetext>Ok. Since I don't want to use a finally for that (as the exception is rethrown 
in invoke), I think moving the unwrapping in the invoke method (before the 
code which rethrows the exception) would be appropriate.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63189</commentid>
    <comment_count>2</comment_count>
    <who name="Scott Goldstein">sdgoldst</who>
    <bug_when>2004-09-08 05:26:29 +0000</bug_when>
    <thetext>That seems like a reasonable solution.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64314</commentid>
    <comment_count>3</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-28 13:34:31 +0000</bug_when>
    <thetext>OK, I've moved the ApplicationDispatcher unwrap requests to the invoke method 
as Remy suggested.  Done on both the Tomcat 5.0 and 5.5 CVS branches.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>104166</commentid>
    <comment_count>4</comment_count>
    <who name="Peter Rossbach">pr</who>
    <bug_when>2007-06-07 02:36:10 +0000</bug_when>
    <thetext>I detect a similar problem with wrapped request at ApplicationDispatcher.forward und include.
The wrapped request are not recylced after an exceptions. Arrg!

- With STRICT_SERVLET_COMPLAINS this means we have still a HTTPSession memory leak
- and at cluster crossContext session replication are not triggered.

Currently the only chance I see, is a double try/catch implementation. Look at my checkin at tomcat 
5.5.24 revision  545127.

But I don't really like the double try/catch for wrapped request!

Peter</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>105915</commentid>
    <comment_count>5</comment_count>
    <who name="Mike Calmus">mcalmus</who>
    <bug_when>2007-07-24 13:04:03 +0000</bug_when>
    <thetext>I'm running into an issue that I think is a side effect of this patch. When
forward() calls invoke() the request object now gets unwrapped. Then the forward
method again tries to unwrap the already unwrapped request. As a result I am
getting a ClassCastException in unwrapRequest (ApplicationDispatcher.java:814).
It seems like unwrapRequest should be setting wrappedRequest to null before
exiting so subsequent calls to the method don't do anything. Does this seem
reasonable?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>107673</commentid>
    <comment_count>6</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2007-09-03 18:35:16 +0000</bug_when>
    <thetext>Mike - having stepped through the code, I don't see the problem you are
describing. If you still see the issue, please open a new Bugzilla item and
provide the steps to reproduce and/or a simple test war.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>107728</commentid>
    <comment_count>7</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2007-09-04 19:02:45 +0000</bug_when>
    <thetext>I have committed a fix for this that doesn't require additional
try/catch/finally blocks. See r572854 (TC5.5.x) and r572856 (TC6.0.x)</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>30984</bug_id>
          
          <creation_ts>2004-09-01 08:45:00 +0000</creation_ts>
          <short_desc>Add an ability to compile JSPs to specified target JVM</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.28</version>
          <rep_platform>All</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Dominik Drzewiecki">drzewo</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>62883</commentid>
    <comment_count>0</comment_count>
    <who name="Dominik Drzewiecki">drzewo</who>
    <bug_when>2004-09-01 08:45:08 +0000</bug_when>
    <thetext>I installed Tomcat 5.0.28 on W2K box. During installation I provided path to
j2sdk 5.0 beta 3 build 60, therefore tools.jar has been taken from this
particular distro. After that I had been forced to switch JVM to IBM's 1.4.1
(WebSphere 5.1 AppClient). Tomcat starts with no problem, however, Jasper
compiles JSP with javac from tools.jar (jvm 5.0 compliant) and makes compiled
classes unusable for the 1.4.1 jvm. 

The simplest workaround is to overwrite tools.jar with the one that comes with
the jdk that tomcat is run on.  However, the simple solution is to provide the
"target" parameter to JspServlet and pass it along to ant javac compiler. 

...Yes, I know we're going to get rid of ant compiler... ;) BTW, I wonder which
version of classes JDT will produce. Maybe this also should be up to the user to
decide?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62963</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-02 16:10:07 +0000</bug_when>
    <thetext>OK, added compilerTargetVM option to JspServlet and JspC.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63016</commentid>
    <comment_count>2</comment_count>
    <who name="Dominik Drzewiecki">drzewo</who>
    <bug_when>2004-09-03 10:36:13 +0000</bug_when>
    <thetext>Based on mu recent experience, javac params source and target are interrelated.
For example, the default source version for the 5.0 RC b63 is 1.5 which implies
1.5 as a target. For example using ant 1.6.2 on j2sdk1.5 (hell, cannot get used
to switching to 5.0, either can Sun, I suppose ;) the following

&lt;javac target="1.4" ... /&gt; 

results in:

 [javac] javac: target release 1.4 conflicts with default source release 1.5

Providing source attribute to ant's javac task forces compiler to downgrade to
1.4 sources.

&lt;javac target="1.4" source="1.4" ... /&gt; 

I'd be more than delighted if you could also provide the source parameter in the
same manner as you have done with the compilerTargetVM. BTW, I have no idea if
this also affects JDT. </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63017</commentid>
    <comment_count>3</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-09-03 11:04:24 +0000</bug_when>
    <thetext>We're waiting for your patches :)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63055</commentid>
    <comment_count>4</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-03 17:55:13 +0000</bug_when>
    <thetext>Yes, this also affects JDT.  And please do NOT reopen one issue to ask for 
something else to be done, even if it's related.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63075</commentid>
    <comment_count>5</comment_count>
    <who name="Dominik Drzewiecki">drzewo</who>
    <bug_when>2004-09-04 07:21:14 +0000</bug_when>
    <thetext>The reason why I reopened was the fact that the solution you provided
*partially* works. What I wanted to point out is the fact that the "target"
parameter alone seems not to be sufficient. Sorry for reopening but I still
consider adding "source" parameter is essential for this very enhancement to be
fully functional. My bad I haven't indicated it in my initial submission. </thetext>
  </long_desc>
      
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>31001</bug_id>
          
          <creation_ts>2004-09-01 18:56:00 +0000</creation_ts>
          <short_desc>NPE and incorrect for MBeansFactory createStandardService method signature description in mbeans-descriptor.xml</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.27</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Alex Smirnoff">alexsmr</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>62919</commentid>
    <comment_count>0</comment_count>
    <who name="Alex Smirnoff">alexsmr</who>
    <bug_when>2004-09-01 18:56:57 +0000</bug_when>
    <thetext>MBeansFactory createStandardService method has not correct descriptor:

&lt;operation   name="createStandardService"
       description="Create a new StandardService"
            impact="ACTION"
       returnType="java.lang.String"&gt;
   &lt;parameter name="parent"
       description="MBean Name of the associated parent component"
            type="java.lang.String"/&gt;
   &lt;parameter name="name"
       description="Unique name of this Service"
            type="java.lang.String"/&gt;
&lt;/operation&gt;

the method signature however is createStandardService(String, String, String) 
that results in runtime exception.

Even if you specify correct parameters, the method will throw NPE on return 
statement because the ObjectName for the service was not initialized.

Alex.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62945</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-02 01:13:03 +0000</bug_when>
    <thetext>Fixed in TOMCAT_5_0 and CVS HEAD -- thanks for reporting it.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>31018</bug_id>
          
          <creation_ts>2004-09-02 15:55:00 +0000</creation_ts>
          <short_desc>Race condition in SystemLogHandler.java</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.0.28</version>
          <rep_platform>Other</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ron Gomes">rrg</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>62962</commentid>
    <comment_count>0</comment_count>
    <who name="Ron Gomes">rrg</who>
    <bug_when>2004-09-02 15:55:31 +0000</bug_when>
    <thetext>The org.apache.tomcat.util.log.SystemLogHandler class (source code in
jakarta-tomcat-connectors) handles, among other things, capturing of
System.out and System.err so that they can be redirected to an
application's log file.  It makes use of another class (CaptureLog) to
hold the captured data, and maintains a stack of unused CaptureLog
instances to avoid creating new ones where possible.
                                                                                
This "reuse" stack is global to the class and it looks like the use of
it is not thread-safe.  The startCapture() method acquires a
CaptureLog() this way:
                                                                                
    if (!reuse.isEmpty()) {
        log = (CaptureLog)reuse.pop();
    } else {
        log = new CaptureLog();
    }
                                                                                
There's a race between the call to isEmpty() and the call to pop().
We've been able to reliably elicit a java.util.EmptyStackException at
this point with an application under heavy load.
                                                                                
Replacing the above code with
                                                                                
    synchronized (reuse) {
        log = reuse.isEmpty() ? new CaptureLog() : (CaptureLog)reuse.pop();
    }
                                                                                
eliminates the problem (with no effect on performance that we could
observe).
                                                                                
An alternative approach might be to catch the (rare)
EmptyStackException and treat it as equivalent to the isEmpty==true
case, but this seems cleaner.
                                                                                
There would seem to be no need to synchronize the code that pushes
old CaptureLog instances onto the reuse stack since java.util.Stack
is already synchronized.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>62977</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-02 18:52:57 +0000</bug_when>
    <thetext>Fixed, thanks.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>31051</bug_id>
          
          <creation_ts>2004-09-03 17:41:00 +0000</creation_ts>
          <short_desc>Incorrect instruction in documentation file RUNNING.TXT</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Unknown</component>
          <version>5.5.0</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="lap_junior">lap_junior</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>63052</commentid>
    <comment_count>0</comment_count>
    <who name="lap_junior">lap_junior</who>
    <bug_when>2004-09-03 17:41:36 +0000</bug_when>
    <thetext>To configure the Tomcat with JDK 1,4 in archive RUNNIN.TXT it says: 

"(2) Place the compat package to jar in Tomcat's server classpath by copying it 
into the #CATALINA_HOME/server/lib directory." ,

but the correct is unzip the package in $&lt;catalina_home&gt;\</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63054</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-03 17:53:03 +0000</bug_when>
    <thetext>Ooof, picky people ;)  I've fixed it in CVS, thanks for pointing it out.</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>31052</bug_id>
          
          <creation_ts>2004-09-03 17:50:00 +0000</creation_ts>
          <short_desc>org.apache.naming.factory.BeanFactory does not propage root exceptions</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina:Modules</component>
          <version>5.0.0</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter>gawor</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>63053</commentid>
    <comment_count>0</comment_count>
    <who name="">gawor</who>
    <bug_when>2004-09-03 17:50:56 +0000</bug_when>
    <thetext>Only the error messages are propagated in the NamingException:

            } catch (java.beans.IntrospectionException ie) {
                throw new NamingException(ie.getMessage());
            }

Since some exceptions do not have a message associated with it, it is very hard 
sometimes to tell what went wrong from the NamingException. So it would be nice 
if the actual exception was chained with the NamingException. The change is 
small:

            } catch (java.lang.IllegalAccessException iae) {
                NamingException ex = new new NamingException(iae.getMessage());
                ex.setRootCause(iae);
                throw ex;
            }

Also, there is a call to e.printStackTrace() which probably shouldn't be there.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63058</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-03 18:08:43 +0000</bug_when>
    <thetext>Now that we require JDK 1.4 where setRootCause is available, this fix is 
possible, so I've done it in TOMCAT_5_0 and HEAD.  Thanks.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63059</commentid>
    <comment_count>2</comment_count>
    <who name="">gawor</who>
    <bug_when>2004-09-03 18:15:33 +0000</bug_when>
    <thetext>Thanks! Btw, the setRootCause() method on NamingException was actually 
available in 1.3.x (if not before that even).

</thetext>
  </long_desc>
      
      

    <bug_classification class="IMPROVEMENT">IMPROVEMENT</bug_classification></bug>
    <bug>
          <bug_id>31065</bug_id>
          
          <creation_ts>2004-09-05 19:58:00 +0000</creation_ts>
          <short_desc>unused import in jsp code causes failure in jdt compiler</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.5.0</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="John Dillenburg">dillenbu</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>63100</commentid>
    <comment_count>0</comment_count>
    <who name="John Dillenburg">dillenbu</who>
    <bug_when>2004-09-05 19:58:20 +0000</bug_when>
    <thetext>My jsp code includes a common "init.jsp" that in turn imports all my 
packages.  When I upgraded to tomcat 5.5.0, none of my jsp code worked because 
the jdt compiler is much more restrictive.  I found the error and corrected it 
by modifying JDTCOmpiler.java as follows:

*** jakarta-tomcat-
jasper/jasper2/src/share/org/apache/jasper/compiler/JDTCompiler.java	Sun 
Sep  5 14:41:20 2004
--- jakarta-tomcat-
jasper/jasper2/src/share/org/apache/jasper/compiler/JDTCompiler.java.orig
	Sun Sep  5 14:41:05 2004
***************
*** 263,270 ****
                       CompilerOptions.GENERATE);

          settings.put(CompilerOptions.OPTION_ReportDeprecation,

                       CompilerOptions.IGNORE);

-         settings.put(CompilerOptions.OPTION_ReportUnusedImport,

-                      CompilerOptions.IGNORE);		

  

          if (ctxt.getOptions().getJavaEncoding() != null) {

              settings.put(CompilerOptions.OPTION_Encoding,</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63107</commentid>
    <comment_count>1</comment_count>
    <who name="Trevor Campbell">Trevor_Campbell</who>
    <bug_when>2004-09-06 04:30:19 +0000</bug_when>
    <thetext>This is a widespread item (although prbably not best coding practice).  I found
it in the jsp examples, e.g. cal1.jsp</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63250</commentid>
    <comment_count>2</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-08 20:23:27 +0000</bug_when>
    <thetext>Fixed in 5.5.1.  We mistakingly treated unused import warnings as errors.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>31090</bug_id>
          
          <creation_ts>2004-09-07 13:54:00 +0000</creation_ts>
          <short_desc>The session "disappears" when the context name contains the space character</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.5.3</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Ivanka Baneva">erania</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>2</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>63154</commentid>
    <comment_count>0</comment_count>
    <who name="Ivanka Baneva">erania</who>
    <bug_when>2004-09-07 13:54:59 +0000</bug_when>
    <thetext>Well, I am not quite sure it is a bug, but I lost one day to find where my
problem was, so it may be helpful :)
When the context name contains a space character (' ') everything works fine ,
except that the session object in the request is null (and a new session is
created when getSession is invoked ) even if a session has already been initialized.
For example:
public class MyServlet extends HttpServlet {

    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
       doPost(request, response);
    }
    
    protected void doPost(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
      
        response.setContentType("text/html");
        PrintWriter out = response.getWriter();
        out.println("&lt;html&gt;&lt;body&gt;&lt;a href=\"MyServlet\"&gt; click me!&lt;/a&gt;&lt;br&gt;");
        out.println(request.getSession().getAttribute("hello"));
        out.println("&lt;/body&gt;&lt;/html&gt;");
        request.getSession().setAttribute("hello", "Hello!");
        
    }
}

When the context name contains a space (fo example: "Sample Project") and you
load the page and click on the link, the result is always :
click me
null

When you change the name to "SampleProject", the problem is gone.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63890</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-20 16:43:22 +0000</bug_when>
    <thetext>Where are you defining this context name?  In the web.xml (display-name 
attribute)?  In the context.xml file for the context?  Or explicitly by making 
it a directory in the webapps directory?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63970</commentid>
    <comment_count>2</comment_count>
    <who name="Ivanka Baneva">erania</who>
    <bug_when>2004-09-21 11:56:13 +0000</bug_when>
    <thetext>In the server.xml.
I am using Eclipse and a tomcat plugin for it. It defines the context in the
server.xml file.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64005</commentid>
    <comment_count>3</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-21 19:13:00 +0000</bug_when>
    <thetext>Can you attach your server.xml file to this report please?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64087</commentid>
    <comment_count>4</comment_count>
      <attachid>12843</attachid>
    <who name="Ivanka Baneva">erania</who>
    <bug_when>2004-09-23 07:43:47 +0000</bug_when>
    <thetext>Created attachment 12843
server.xml</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64088</commentid>
    <comment_count>5</comment_count>
      <attachid>12844</attachid>
    <who name="Ivanka Baneva">erania</who>
    <bug_when>2004-09-23 07:45:11 +0000</bug_when>
    <thetext>Created attachment 12844
The Eclipse project for testing</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64131</commentid>
    <comment_count>6</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-23 20:38:44 +0000</bug_when>
    <thetext>I've verified your bug outside Eclipse, and I'm attaching a WAR that lets one 
reproduce it on an out-of-the-box tomcat.  Deploying this war as 
SessionSpace.war versus "Session Space.war" shows the bug.

I'm updating the comopnent, platform, OS, version fields of the bug report as 
well.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64132</commentid>
    <comment_count>7</comment_count>
      <attachid>12851</attachid>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-23 20:39:18 +0000</bug_when>
    <thetext>Created attachment 12851
WAR to reproduce bug</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65032</commentid>
    <comment_count>8</comment_count>
    <who name="Ben Souther">bsouther</who>
    <bug_when>2004-10-13 02:14:32 +0000</bug_when>
    <thetext>This is due to browsers not recognizing spaces in the session cookie's path. See
the headers from two hits to the example (from the war file by Yoav Shapira).

I'm attaching a patch to fix this.
Tested with MSIE 6 and Mozilla 1.7.2


Headers ========================================================
http://localhost:8080/Sample%20App/test



GET /Sample%20App/test HTTP/1.1

Host: localhost:8080

User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.7.2) Gecko/20040803

Accept:
text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5

Accept-Language: en-us,en;q=0.5

Accept-Encoding: gzip,deflate

Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7

Keep-Alive: 300

Connection: keep-alive

Cache-Control: max-age=0



HTTP/1.x 200 OK

Server: Apache-Coyote/1.1

Set-Cookie: JSESSIONID=33047CF84AA4E7159F1262C21D4FEA83; Path=/Sample App

Content-Type: text/html;charset=ISO-8859-1

Content-Length: 165

Date: Wed, 13 Oct 2004 01:31:50 GMT

----------------------------------------------------------

http://localhost:8080/Sample%20App/test



GET /Sample%20App/test HTTP/1.1

Host: localhost:8080

User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.7.2) Gecko/20040803

Accept:
text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5

Accept-Language: en-us,en;q=0.5

Accept-Encoding: gzip,deflate

Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7

Keep-Alive: 300

Connection: keep-alive

Referer: http://localhost:8080/Sample%20App/test

Cache-Control: max-age=0



HTTP/1.x 200 OK

Server: Apache-Coyote/1.1

Set-Cookie: JSESSIONID=82313411257D1DA54FDFD741D4E1FE78; Path=/Sample App

Content-Type: text/html;charset=ISO-8859-1

Content-Length: 165

Date: Wed, 13 Oct 2004 01:32:03 GMT

----------------------------------------------------------</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65033</commentid>
    <comment_count>9</comment_count>
      <attachid>13058</attachid>
    <who name="Ben Souther">bsouther</who>
    <bug_when>2004-10-13 02:16:14 +0000</bug_when>
    <thetext>Created attachment 13058
Patch to encode spaces in session cookie path</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65136</commentid>
    <comment_count>10</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-10-14 17:25:18 +0000</bug_when>
    <thetext>Good investigation and finding, OK patch.  OK because replaceAll is in JDK 1.4, 
so I can use the patch as-is for Tomcat 5.5, but for Tomcat 5.0 we need the 
same thing in JDK 1.3-compatible format.  Maybe I'll just URLEncoder.encode the 
cookie's path?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65144</commentid>
    <comment_count>11</comment_count>
    <who name="Ben Souther">bsouther</who>
    <bug_when>2004-10-14 17:39:21 +0000</bug_when>
    <thetext>Ahh, good point.

I originally went with the URLEncoder but it was encoding the "/" at the
beginning.  

So, to go this route, I would either need to strip out the "/" before encoding or 
do a replace afterwards.  </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65146</commentid>
    <comment_count>12</comment_count>
    <who name="Ben Souther">bsouther</who>
    <bug_when>2004-10-14 18:00:06 +0000</bug_when>
    <thetext>If characters other than spaces don't need to be considered, maybe use this
patch on 5.5x. and use the URLEncoder for the older release?

Note:  The Request class doesn't import URLEncoder yet so this means one more
object created for each request.  This needs to be added to the object creation
involved with pulling and replacing the "/".   Probably trivial but I know there
is a lot of effort being made to increase performance and it's a shame to add
more overhead just to support spaces in a context path. 




</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65147</commentid>
    <comment_count>13</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-10-14 18:02:10 +0000</bug_when>
    <thetext>Maybe add a URL encoded path field on the Context. (URL encoding stuff all the
time is a bit expensive, and it could be needed)
I'll try it later today.

BTW, before making any changes: cookie values should be URL encoded then ? I
don't remember that, but maybe it's true. Can anyone confirm ?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65148</commentid>
    <comment_count>14</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-10-14 18:11:30 +0000</bug_when>
    <thetext>Actually, I think cookies shouldn't be URL encoded. See the ServerCookie class,
and in particular the maybeQuote and isToken methods. Now ' ' isn't part of the
"special" list anymore, for some reason.

OTOH, the Cookie class from the servlet API includes:
    private static final String tspecials = ",; ";

I think the bug will only need a change there.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65156</commentid>
    <comment_count>15</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-10-14 19:20:05 +0000</bug_when>
    <thetext>IMHO, Remy's idea is best.  But it will throw an IAE since the session cookie 
is v0.  Probably we could just remove the version check in maybeQuote, since 
I'm guessing that most UAs probably support quoted values, even if they don't 
support all of RFC2019.

Using the JDK1.3 j.n.URLEncoder is going to cause more problems then it will 
ever solve, given that it uses the platform encoding (which is unlikely to be 
utf-8 :).  If you have to encode the path, use the UEncoder in the Response.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65157</commentid>
    <comment_count>16</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-10-14 19:43:34 +0000</bug_when>
    <thetext>Ah, yes, I missed that "small" point. I thought I had a really good idea here ;)

BTW, can you explain the tspecials descrepancy between the two cookies classes
for the tspecial field ?</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65158</commentid>
    <comment_count>17</comment_count>
    <who name="">william.barker</who>
    <bug_when>2004-10-14 19:51:45 +0000</bug_when>
    <thetext>It looks like the ServerCookie value is the one from jakarta-servletapi (aka 
servlet-2.2), and simply hasn't been updated.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65718</commentid>
    <comment_count>18</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-10-26 12:49:49 +0000</bug_when>
    <thetext>After discussion on the tomcat-dev list, I'm closing this as WONTFIX because 
it's a contrived use-case: the browser will never send a request with a space 
character in it (it'd be encoded as %20, which is handled fine by Tomcat).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65719</commentid>
    <comment_count>19</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-10-26 13:05:22 +0000</bug_when>
    <thetext>Yes, but the problem is that TC will set a cookie based on the unencoded path,
and the browser doesn't make the association between that and the URL (somehow).
In theory, we would need to URL encode the context path using straight conversion.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65749</commentid>
    <comment_count>20</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-10-26 15:45:53 +0000</bug_when>
    <thetext>.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65751</commentid>
    <comment_count>21</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-10-26 15:47:03 +0000</bug_when>
    <thetext>It is fixed now, but the fix assumes UTF-8 encoding for URLs. I guess even if it
doesn't work always, it's better than it it never works.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65753</commentid>
    <comment_count>22</comment_count>
    <who name="Remy Maucherat">remm</who>
    <bug_when>2004-10-26 15:49:41 +0000</bug_when>
    <thetext>Forgot to mention: for really tricky situations (i18n ...), you can also choose
to set the cookie path to "/" by using emptySessionPath="true" on the Connector.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>12843</attachid>
            <date>2004-09-23 07:43:00 +0000</date>
            <delta_ts>2004-09-23 07:43:47 +0000</delta_ts>
            <desc>server.xml</desc>
            <filename>server.xml</filename>
            <type>text/plain</type>
            <size>18925</size>
            <attacher name="Ivanka Baneva">erania</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>12844</attachid>
            <date>2004-09-23 07:45:00 +0000</date>
            <delta_ts>2004-09-23 07:45:11 +0000</delta_ts>
            <desc>The Eclipse project for testing</desc>
            <filename>SampleProject.tar.gz</filename>
            <type>application/octet-stream</type>
            <size>2145</size>
            <attacher name="Ivanka Baneva">erania</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="0" isprivate="0">
            <attachid>12851</attachid>
            <date>2004-09-23 20:39:00 +0000</date>
            <delta_ts>2004-09-23 20:39:18 +0000</delta_ts>
            <desc>WAR to reproduce bug</desc>
            <filename>SessionSpace.war</filename>
            <type>application/octet-stream</type>
            <size>2189</size>
            <attacher name="Yoav Shapira">yoavs</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>13058</attachid>
            <date>2004-10-13 02:16:00 +0000</date>
            <delta_ts>2004-10-13 02:16:14 +0000</delta_ts>
            <desc>Patch to encode spaces in session cookie path</desc>
            <filename>patchfile.txt</filename>
            <type>text/plain</type>
            <size>758</size>
            <attacher name="Ben Souther">bsouther</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>31098</bug_id>
          
          <creation_ts>2004-09-07 16:51:00 +0000</creation_ts>
          <short_desc>'assert' keyword missing from list of Java keywords</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.28</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Petr Jiricka">petr.jiricka</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>63159</commentid>
    <comment_count>0</comment_count>
    <who name="Petr Jiricka">petr.jiricka</who>
    <bug_when>2004-09-07 16:51:08 +0000</bug_when>
    <thetext>Class org.apache.jasper.compiler.JspUtil has an algorithm that determined class
names of generated Java files, and that handles Java keywords specially (thanks
to class variable javaKeywords). However, keyword 'assert' is missing from this
list.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63175</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-09-07 20:18:48 +0000</bug_when>
    <thetext>Added "assert" and "enum" to the Java keyword list.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>31110</bug_id>
          
          <creation_ts>2004-09-08 07:53:00 +0000</creation_ts>
          <short_desc>o.a.c.servlets.LocalStrings missing</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.5.1</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Dominik Drzewiecki">drzewo</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>63192</commentid>
    <comment_count>0</comment_count>
    <who name="Dominik Drzewiecki">drzewo</who>
    <bug_when>2004-09-08 07:53:20 +0000</bug_when>
    <thetext>During startup tomcat complains about missing resource:
org.apache.catalina.servlets.LocalStrings

2004-09-08 09:31:13 org.apache.coyote.http11.Http11Protocol init
INFO: Initializing Coyote HTTP/1.1 on http-10080
2004-09-08 09:31:13 org.apache.catalina.startup.Catalina load
INFO: Initialization processed in 2375 ms
2004-09-08 09:31:14 org.apache.catalina.core.StandardService start
INFO: Starting service Catalina
2004-09-08 09:31:14 org.apache.catalina.core.StandardEngine start
INFO: Starting Servlet Engine: Apache Tomcat/5.5.1
2004-09-08 09:31:14 org.apache.catalina.core.StandardHost start
INFO: XML validation disabled
Can't find resource org.apache.catalina.servlets.LocalStrings WebappClassLoader
  delegate: false
  repositories:
----------&gt; Parent Classloader:
org.apache.catalina.loader.StandardClassLoader@80d1ff

[Ljava.net.URL;@1955970
2004-09-08 09:31:17 org.apache.coyote.http11.Http11Protocol start
INFO: Starting Coyote HTTP/1.1 on http-10080
2004-09-08 09:31:18 org.apache.jk.common.ChannelSocket init
INFO: JK2: ajp13 listening on /0.0.0.0:10009
2004-09-08 09:31:18 org.apache.jk.server.JkMain start
INFO: Jk running ID=0 time=0/125 
config=d:\java\eclipse-3.1-M1\tomcat5.5\conf\jk2.properties
2004-09-08 09:31:18 org.apache.catalina.startup.Catalina start
INFO: Server startup in 4968 ms</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63193</commentid>
    <comment_count>1</comment_count>
    <who name="Dominik Drzewiecki">drzewo</who>
    <bug_when>2004-09-08 08:12:54 +0000</bug_when>
    <thetext>Back in 5.0.28 times, o.a.c.servlets.LocalStrings.properties has been placed in
servlets-common.jar, which seems to be gone right now. All other packages
default LocalStrings properties are there (that is: in catalina.jar).
servlets-common.jar IMHO should be back to hold those LocalStrings for
o.a.c.servlets same as naming-common.jar does for o.a.naming. But I still might
be wrong...</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>31129</bug_id>
          
          <creation_ts>2004-09-08 19:32:00 +0000</creation_ts>
          <short_desc>updates/fix for jndi-datasource-examples-howto.html</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Documentation</component>
          <version>5.0.27</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Alan Tingley">atingley</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>63235</commentid>
    <comment_count>0</comment_count>
    <who name="Alan Tingley">atingley</who>
    <bug_when>2004-09-08 19:32:43 +0000</bug_when>
    <thetext>jndi-datasource-examples-howto.html (an excellent reference, btw):

Section 2:  Needs update for Tomcat 5.0.27:
Instead of referring to $CATALINA_HOME/conf/server.xml for adding the
"/DBTest" context path, the contents of this file should appear in a
*new* $CATALINA_HOME/conf/Catalina/localhost/DBTest.xml file.

Section 3:  Typo:
Extraneous &lt;web-app&gt; tag following the verbose &lt;web-app xmlns=...&gt; tag.
Will cause numerous cut-paste-induced errors starting up DBTest app!
Solution is to remove the either of the &lt;web-app&gt; start tags.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63237</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-08 19:50:30 +0000</bug_when>
    <thetext>Putting it in server.xml is still valid, so I don't want to change the doc and 
confuse users.  The 2nd point has already been addressed in CVS (it was 
reported as Bugzilla 30756).  Thanks though.</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>31132</bug_id>
          
          <creation_ts>2004-09-08 21:08:00 +0000</creation_ts>
          <short_desc>missing</short_desc>
          <delta_ts>2005-05-06 06:22:02 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.28</version>
          <rep_platform>Other</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P5</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Stephen More">smore</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>63257</commentid>
    <comment_count>0</comment_count>
    <who name="Stephen More">smore</who>
    <bug_when>2004-09-08 21:08:27 +0000</bug_when>
    <thetext>There are certain shell tests that do not work properly on the 400's qshell. 
Like -x and -r.

These will only work if:
   1. The user is the owner of the file
or 2. The file's group ownership is by the user's PRIMARY group.

If the file's group ownership is in the user's secondary groups, the qshell 
tests will fail, even though it has authority to run/read it.

I have been making changes like this:


#!/bin/sh
# -----------------------------------------------------------------------------
# Start Script for the CATALINA Server
#
# $Id: startup.sh,v 1.3 2002/08/04 18:19:43 patrickl Exp $
# -----------------------------------------------------------------------------

os400=false
case "`uname`" in
OS400*) os400=true;;
esac


# resolve links - $0 may be a softlink
PRG="$0"

while [ -h "$PRG" ] ; do
  ls=`ls -ld "$PRG"`
  link=`expr "$ls" : '.*-&gt; \(.*\)$'`
  if expr "$link" : '.*/.*' &gt; /dev/null; then
    PRG="$link"
  else
    PRG=`dirname "$PRG"`/"$link"
  fi
done
 
PRGDIR=`dirname "$PRG"`
EXECUTABLE=catalina.sh

# Check that target executable exists
if $os400; then
  # -x will Only work on the os400 if the files are: 
  # 1. owned by the user
  # 2. owned by the PRIMARY group of the user
  # this will not work if the user belongs in secondary groups
else
  if [ ! -x "$PRGDIR"/"$EXECUTABLE" ]; then
    echo "Cannot find $PRGDIR/$EXECUTABLE"
    echo "This file is needed to run this program"
    exit 1
  fi
fi

exec "$PRGDIR"/"$EXECUTABLE" start "$@"</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>66124</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-10-29 18:29:13 +0000</bug_when>
    <thetext>Please attach your proposed changes in diff -u format, instead of the whole 
file.  When you do that I'll be glad to look at them and commit them.  Thanks.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>66238</commentid>
    <comment_count>2</comment_count>
      <attachid>13289</attachid>
    <who name="Stephen More">smore</who>
    <bug_when>2004-11-01 13:58:15 +0000</bug_when>
    <thetext>Created attachment 13289
Patch for startup.sh</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>66239</commentid>
    <comment_count>3</comment_count>
      <attachid>13290</attachid>
    <who name="Stephen More">smore</who>
    <bug_when>2004-11-01 13:58:37 +0000</bug_when>
    <thetext>Created attachment 13290
Patch for catalina.sh</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>66240</commentid>
    <comment_count>4</comment_count>
      <attachid>13291</attachid>
    <who name="Stephen More">smore</who>
    <bug_when>2004-11-01 13:58:56 +0000</bug_when>
    <thetext>Created attachment 13291
Patch for setclasspath.sh</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>67074</commentid>
    <comment_count>5</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-11-17 21:18:14 +0000</bug_when>
    <thetext>OK, done for Tomcat 5.0.30 and 5.5.5.  Thanks for submitting this patch.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>13289</attachid>
            <date>2004-11-01 13:58:00 +0000</date>
            <delta_ts>2004-11-01 13:58:15 +0000</delta_ts>
            <desc>Patch for startup.sh</desc>
            <filename>startup.sh</filename>
            <type>text/plain</type>
            <size>1122</size>
            <attacher name="Stephen More">smore</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>13290</attachid>
            <date>2004-11-01 13:58:00 +0000</date>
            <delta_ts>2004-11-01 13:58:37 +0000</delta_ts>
            <desc>Patch for catalina.sh</desc>
            <filename>catalina.sh</filename>
            <type>text/plain</type>
            <size>1044</size>
            <attacher name="Stephen More">smore</attacher>
            

          </attachment>
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>13291</attachid>
            <date>2004-11-01 13:58:00 +0000</date>
            <delta_ts>2004-11-01 13:58:56 +0000</delta_ts>
            <desc>Patch for setclasspath.sh</desc>
            <filename>setclasspath.sh</filename>
            <type>text/plain</type>
            <size>848</size>
            <attacher name="Stephen More">smore</attacher>
            

          </attachment>
      

    <bug_classification class="TEST">TEST</bug_classification></bug>
    <bug>
          <bug_id>31171</bug_id>
          
          <creation_ts>2004-09-10 16:53:00 +0000</creation_ts>
          <short_desc>ClassCastException in org.apache.jasper.runtime.PageContextImpl.getException</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.19</version>
          <rep_platform>All</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Steve Revilak">srevilak</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>63367</commentid>
    <comment_count>0</comment_count>
    <who name="Steve Revilak">srevilak</who>
    <bug_when>2004-09-10 16:53:50 +0000</bug_when>
    <thetext>I am writing to report a case where calling PageContextImpl.getException()
can result in a ClassCastException.  This occurred in tomcat 5.0.19,
but examination of tomcat 5.0.28's source code, the problem could
occur there as well.

In my application, I have an jsp declared as an error page.  This
error page uses a tag to record some additional information.  The
first few lines of this tag are as follows:

    public void doTag() throws IOException, JspException
    {
	try {

	    PageContext context = (PageContext)getJspContext();
	    JspWriter out = context.getOut();
            HttpServletRequest request = (HttpServletRequest) context.getRequest();
            Throwable error = context.getException();
            // proceed to log the exception and some of the
            // surrounding contextual information

In one case, the `catch' associated with this try caught a
ClassCastException from PageContextImpl.getException():

  // line 608 in 5.0.19's PageContextImpl.java
  // line 560 in 5.0.28's PageContextImpl.java
  public Exception getException() { return (Exception)request.getAttribute(EXCEPTION); }


This would occur if the error was a result of a java.lang.Throwable.


What possible paths might lead up to this?

The _jspService() generated by JspC typically terminates with
something like the following:

    } catch (Throwable t) {
      if (!(t instanceof SkipPageException)){
        out = _jspx_out;
        if (out != null &amp;&amp; out.getBufferSize() != 0)
          out.clearBuffer();
        if (pageContext != null) pageContext.handlePageException(t);
      }
    } finally {
      if (_jspxFactory != null) _jspxFactory.releasePageContext(pageContext);
    }

It's catching a Throwable.

PageContextImpl.handlePageException() (lines 730 - 745 in version
5.0.28) does this: 


   public void handlePageException(final Throwable t)
        throws IOException, ServletException
    {
        if (t == null)
            throw new NullPointerException("null Throwable");

        if (System.getSecurityManager() != null){
            try{
                AccessController.doPrivileged(new PrivilegedExceptionAction(){
                    public Object run() throws Exception{
                        doHandlePageException(t);
                        return null;
                    }
                });


It's dealing with throwables.

Continuing on to doHandlePageException(), (lines 763 - 786 in version
5.0.28):

    private void doHandlePageException(Throwable t)
        throws IOException, ServletException {

        if (errorPageURL != null &amp;&amp; !errorPageURL.equals("")) {

            /*
             * Set request attributes.
             * Do not set the javax.servlet.error.exception attribute here
             * (instead, set in the generated servlet code for the error page)
             * in order to prevent the ErrorReportValve, which is invoked as
             * part of forwarding the request to the error page, from
             * throwing it if the response has not been committed (the response
             * will have been committed if the error page is a JSP page).
             */
            request.setAttribute("javax.servlet.jsp.jspException", t);
            request.setAttribute("javax.servlet.error.status_code",
                new Integer(HttpServletResponse.SC_INTERNAL_SERVER_ERROR));
            request.setAttribute("javax.servlet.error.request_uri",
            ((HttpServletRequest) request).getRequestURI());
            request.setAttribute("javax.servlet.error.servlet_name",
                     config.getServletName());
                try {
                    forward(errorPageURL);


It's also dealing with Throwables.


The following two (short) jsp files reproduce the problem consistently.


--------------- Page: foo.jsp -----------------------------------
&lt;%@ page session="false"
         language="java" 
         errorPage="/myerror.jsp"
%&gt;

&lt;html&gt;&lt;body&gt;hello world&lt;/body&gt;&lt;/html&gt;
&lt;%
  if (1 + 1 == 2) {
    throw new Throwable("The cake fell in the mud");
  }
%&gt;
------------------------------------------------------------------


------------------- Page: myerror.jsp ----------------------------
&lt;!-- myerror.jsp --&gt;
&lt;%@ page session="false"
         language="java"
         isErrorPage="true"
         import="java.io.PrintWriter"
%&gt;

An error occurred:

&lt;pre&gt;
&lt;%
out.println(pageContext.getException().toString());

%&gt;
&lt;/pre&gt;
------------------------------------------------------------------


Perhaps getException() could take extra steps to ensure that the
object being returned is indeed an exception (and wrap it if it's
not).</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63614</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-15 18:14:29 +0000</bug_when>
    <thetext>Good, interesting catch.  It seems like something simple in the PageContext 
imlpementation, like

if(! (exception instanceof Exception)) {
  exception = new JspException(exception);
}

would be a good wrap.  It only wraps if needed, and the JspException 
constructor takes a Throwable root cause, so I think we'll be all set.  I'll 
wait to see what more experienced Jasper developers (Kin-Man?) think of this.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63790</commentid>
    <comment_count>2</comment_count>
    <who name="Steve Revilak">srevilak</who>
    <bug_when>2004-09-19 02:04:05 +0000</bug_when>
    <thetext>Yoav Shapira's suggestion (2004-09-15 18:14) seems like a reasonable way to handle this.  If my 
opinion matters :)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63897</commentid>
    <comment_count>3</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-20 18:09:33 +0000</bug_when>
    <thetext>Fixed for 5.0.29 and 5.5.3.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>31185</bug_id>
          
          <creation_ts>2004-09-12 19:35:00 +0000</creation_ts>
          <short_desc>Tomcat service management GUI corrupts configuration</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Native:Packaging</component>
          <version>5.5.1</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Gili">cowwoc</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>63420</commentid>
    <comment_count>0</comment_count>
    <who name="Gili">cowwoc</who>
    <bug_when>2004-09-12 19:35:25 +0000</bug_when>
    <thetext>1) Start up tomcat5w.exe (service manager)
2) Click on startup tab
3) Notice that argument is "start" (or at least, it should be)
4) Click on shutdown tab
5) Notice that argument is "stop"
6) Click OK
7) Run tomcat5w.exe again
8) Click on startup tab
9) Notice that argument magically changed to "stop" (!!)
10) The only way to bring the value back to "start" is to change the argument
value to "start", click APPLY and then OK. Clicking OK alone seems to not save
the value to disk.

So there are two major problems here:

1) Configuration values are being corrupted by the GUI (leads to hours of fun
debugging what the heck is going wrong)
2) Clicking OK is not enough to save changes to disk. Apply is meant to be an
optional button, not required.

I consider this a major bug in the native packaging because it is very easy to
corrupt the configuration and then one spends hours trying to figure out what
the heck is going wrong with Tomcat. The logging output isn't very helpful either.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63421</commentid>
    <comment_count>1</comment_count>
    <who name="Gili">cowwoc</who>
    <bug_when>2004-09-12 19:36:36 +0000</bug_when>
    <thetext>Correction on bug #2 (clicking apply is required). Clicking OK works fine. Bug
#1 still exists though.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63442</commentid>
    <comment_count>2</comment_count>
    <who name="Mladen Turk">mturk</who>
    <bug_when>2004-09-13 06:10:09 +0000</bug_when>
    <thetext>Fixed in the CVS.
You may try the binaries from CVS:

http://cvs.apache.org/viewcvs.cgi/*checkout*/jakarta-tomcat-
connectors/procrun/bin/tomcat5w.exe?rev=1.2.2.2
</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>31209</bug_id>
          
          <creation_ts>2004-09-13 23:45:00 +0000</creation_ts>
          <short_desc>Setting caseSensitive to false for FileDirContext seems to have no effect</short_desc>
          <delta_ts>2005-03-20 17:06:12 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.28</version>
          <rep_platform>PC</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter>paul</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>63506</commentid>
    <comment_count>0</comment_count>
    <who name="">paul</who>
    <bug_when>2004-09-13 23:45:21 +0000</bug_when>
    <thetext>For some time I have used the following Context Element for webapps to disable
case sensitivity in resource names.

&lt;Context path="/iCom" docBase="../webapps/iCom" debug="0"&gt;
  &lt;Resources
    className="org.apache.naming.resources.FileDirContext" caseSensitive="false" /&gt;
&lt;/Context&gt;

This worked fine in early releases of Tomcat 5 (e.g. Tomcat 5.0.12) but at some
point it stopped working (by Tomcat 5.0.19 it was no longer working, and is
still not working in 5.0.28).  I've checked the documentation for 5.0.28 and so
far as I can see the above should still work fine.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63510</commentid>
    <comment_count>1</comment_count>
    <who name="">paul</who>
    <bug_when>2004-09-14 05:49:23 +0000</bug_when>
    <thetext>I figured out that by changing the Context element
&lt;Context path="/iCom" docBase="iCom" debug="0" caseSensitive="false" /&gt;

I managed to turn off case sensitivity again.

Sorry to bother you.</thetext>
  </long_desc>
      
      

    <bug_classification class="OTHER">OTHER</bug_classification></bug>
    <bug>
          <bug_id>31257</bug_id>
          
          <creation_ts>2004-09-16 05:10:00 +0000</creation_ts>
          <short_desc>java.endorsed.dirs is not used when JSP compilation is forked</short_desc>
          <delta_ts>2008-07-30 11:14:40 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.0.27</version>
          <rep_platform>All</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>critical</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="James DeFelice">james_defelice</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>63651</commentid>
    <comment_count>0</comment_count>
    <who name="James DeFelice">james_defelice</who>
    <bug_when>2004-09-16 05:10:06 +0000</bug_when>
    <thetext>When the JSP compiler forks a javac process, it should check to see what the 
currently endorsed directories are (check the system 
property "java.endorsed.dirs" - otherwise, classes end up missing and JSP 
pages do not properly compile.  We experienced a problem when we explicitly 
set the java.endorsed.dirs property on the command line, and the JSP compiler 
did not use it when javac was forked.

I have patched org.apache.jasper.compiler.Compiler to support this:
*** src.original\jakarta-tomcat-jasper\jasper2
\src\share\org\apache\jasper\compiler\Compiler.java       Tue Jun 15 17:30:35 
2004
--- src\org\apache\jasper\compiler\Compiler.java        Thu Sep 16 00:05:14 
2004

***************
*** 349,358 ****
--- 349,369 ----
              extdirs.setPath(exts);
              javac.setExtdirs(extdirs);
              info.append("    extension dir=" + exts + "\n");
          }

+         // Add endorsed directories
+         String endorsed = System.getProperty("java.endorsed.dirs");
+         if(endorsed != null) {
+             Javac.ImplementationSpecificArgument endorsedArg = 
javac.createCompilerArg();
+             endorsedArg.setLine("-J-Djava.endorsed.dirs="+endorsed);
+             info.append("    endorsed dir=" + endorsed + "\n");
+         }
+         else {
+             info.append("    no endorsed dirs specified\n");
+         }
+
          // Configure the compiler object
          javac.setEncoding(javaEncoding);
          javac.setClasspath(path);
          javac.setDebug(ctxt.getOptions().getClassDebugInfo());

true, i should probably check ctxt.getOptions().getFork() in the if() as well, 
but since i always fork it doesn't matter to me.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64009</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-21 19:47:18 +0000</bug_when>
    <thetext>Thanks for submitting this enhancement.  I've applied it to both the Tomcat 5.0 
and 5.5 branches: it will be in 5.0.29 and 5.5.3.  However, this applies to the 
Ant/Javac compiler only, not to the JDT compiler, which is the default in 
5.5.3.  If you have an equivalent patch for the JDT compiler, please submit 
it.  Otherwise, I'll do some research to try to find the equivalent JDT 
compiler option, but if you submit a patch it'll get done faster.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>111062</commentid>
    <comment_count>2</comment_count>
    <who name="Goldyard">goldyard</who>
    <bug_when>2007-11-24 10:08:21 +0000</bug_when>
    <thetext>There is still a bug in this fixing.
When the endorsed dir is like:
   C:\Program Files\Java\jdk1.5.0_11\jre\lib\endorsed
the space char in dir will cause a compile error. "Files\Java\jdk1.5.0_11
\jre\lib\endorsed" part will be treated as a new parameter of javac. Please use 
quotation marks to quotate each dir in the endorsed dir list.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>115722</commentid>
    <comment_count>3</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2008-04-20 15:39:22 +0000</bug_when>
    <thetext>The quoting issue has been fixed in trunk and proposed for 5.5.x and 6.0.x</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>116107</commentid>
    <comment_count>4</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2008-05-01 10:49:04 +0000</bug_when>
    <thetext>This has been committed to 6.0.x and will be in 6.0.17 onwards.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>119136</commentid>
    <comment_count>5</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2008-07-30 11:14:40 +0000</bug_when>
    <thetext>This has been fixed in 5.5.x and will be included in 5.5.27 onwards.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>31277</bug_id>
          
          <creation_ts>2004-09-17 15:12:00 +0000</creation_ts>
          <short_desc>Applciation deployed twice after restart if path doesn't match war filename</short_desc>
          <delta_ts>2005-03-20 17:06:14 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Documentation</component>
          <version>5.0.28</version>
          <rep_platform>All</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Pete Edwards">peter.edwards</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>63730</commentid>
    <comment_count>0</comment_count>
    <who name="Pete Edwards">peter.edwards</who>
    <bug_when>2004-09-17 15:12:12 +0000</bug_when>
    <thetext>If you upload a war file using the HTML manager interface it places the war 
file in the webapps directory. It also extracts the context.xml file and places 
this in conf/Catalina/localhost using the war file to generate the new 
filename. So if the war file is called MyApp.war, the context file is 
MyApp.xml. So far, so good.

If the context file declares the path to be "/myapp" the application is 
deployed in the context /myapp.

Now, if you restart the server you get two instances of your application. One 
because of the MyApp.war file in webapps - this is deployed as /MyApp. The 
second is due to the context file (MyApp.xml) but this deploys as /myapp.

I don't know what the correct behaviour should be but the restriction is that 
your path must be the same as the war filename.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63733</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-17 15:27:37 +0000</bug_when>
    <thetext>Turn off autoDeploy and this won't happen.  It's not a Tomcat bug, merely a 
configuration issue.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63856</commentid>
    <comment_count>2</comment_count>
    <who name="Pete Edwards">peter.edwards</who>
    <bug_when>2004-09-20 09:38:52 +0000</bug_when>
    <thetext>I did have the flag autoDeploy set to false but your comment pointed me in the 
right direction. The flag that needs turning off is in fact deployOnStartup. So 
the host element needs to be:
&lt;Host name="localhost" debug="0" appBase="webapps" unpackWARs="false" 
autoDeploy="false" deployOnStartup="false"&gt;

I think there is still an issue around the documentation. The help on Automatic 
Application Deployment is misleading (http://jakarta.apache.org/tomcat/tomcat-
5.0-doc/config/host.html#Automatic%20Application%20Deployment).

1. I think the first action happens even when deployOnStartup is false - I 
didn't try this attribute because I thought it would stop things deploying on 
startup but it doesn't. Actually it solves the problem I was having by only 
deploying things from context files in 
$CATALINA_HOME/conf/[engine_name]/[host_name], but doesn't deploy things from 
appBase.
2. Should the second action read "Any web application archive file &lt;ins&gt;within 
the application base directory&lt;/ins&gt; that does not have a corresponding 
directory of the same name..."
3. The paragraph starting "In addition to the automatic deployment" doesn't 
mention the attribute "autoDeploy" but I think this is what it is referring to.
4. The last paragraph starting "When using automatic deployment," doesn't 
reflect the fact that if you upload a war file, the docBase attribute is 
ignored and the file goes in the appBase directory. Hence you get double 
deployment on restart unless you disable deployOnStartup

I accept that this was in fact a configuration issue but hopefully the 
documentation can be made clearer.

Thanks</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63900</commentid>
    <comment_count>3</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-20 18:31:13 +0000</bug_when>
    <thetext>OK, doc clarified (for 5.0.29 and 5.5.3).</thetext>
  </long_desc>
      
      

    <bug_classification class="DOCUMENTATION">DOCUMENTATION</bug_classification></bug>
    <bug>
          <bug_id>31288</bug_id>
          
          <creation_ts>2004-09-18 23:45:00 +0000</creation_ts>
          <short_desc>MailSessionFactory should allow authentication to be configured</short_desc>
          <delta_ts>2005-03-23 07:31:07 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Nightly Build</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Joseph Walton">joe</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>63782</commentid>
    <comment_count>0</comment_count>
    <who name="Joseph Walton">joe</who>
    <bug_when>2004-09-18 23:45:11 +0000</bug_when>
    <thetext>Looking for a way to configure a JNDI JavaMail session, I ran into
&lt;http://www.mail-archive.com/tomcat-dev@jakarta.apache.org/msg43073.html&gt;. It
looks like the only way to do this is through manually opening the transport in
code; there should be a way to configure an authenticated session through
server.xml and the MailSessionFactory.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>63783</commentid>
    <comment_count>1</comment_count>
      <attachid>12769</attachid>
    <who name="Joseph Walton">joe</who>
    <bug_when>2004-09-18 23:48:01 +0000</bug_when>
    <thetext>Created attachment 12769
Patch to add a 'password' property to MailSessionFactory initialisation.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>2172</commentid>
    <comment_count>2</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2005-03-23 16:24:54 +0000</bug_when>
    <thetext>Changing components for Tomcat 5.5.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>2173</commentid>
    <comment_count>3</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2005-03-23 16:31:07 +0000</bug_when>
    <thetext>Done for 5.5.9.  Thanks for submitting this patch.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>12769</attachid>
            <date>2004-09-18 23:48:00 +0000</date>
            <delta_ts>2004-09-18 23:48:01 +0000</delta_ts>
            <desc>Patch to add a 'password' property to MailSessionFactory initialisation.</desc>
            <filename>MailSessionFactory-authenticator.patch</filename>
            <type>text/plain</type>
            <size>2511</size>
            <attacher name="Joseph Walton">joe</attacher>
            

          </attachment>
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>31339</bug_id>
          
          <creation_ts>2004-09-21 12:07:00 +0000</creation_ts>
          <short_desc>admin app throwing struts exceptions</short_desc>
          <delta_ts>2006-09-06 19:44:28 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Webapps:Administration</component>
          <version>5.0.28</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Blake Binkley">blake</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>1</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>63971</commentid>
    <comment_count>0</comment_count>
    <who name="Blake Binkley">blake</who>
    <bug_when>2004-09-21 12:07:55 +0000</bug_when>
    <thetext>when a service is clicked on in the left navigaiton frame:
HTTP Status 500 - 

--------------------------------------------------------------------------------

type Exception report

message 

description The server encountered an internal error () that prevented it from 
fulfilling this request.

exception 

javax.servlet.ServletException: Define tag cannot set a null value
	org.apache.jasper.runtime.PageContextImpl.doHandlePageException
(PageContextImpl.java:825)
	org.apache.jasper.runtime.PageContextImpl.handlePageException
(PageContextImpl.java:758)
	admin.service.service_jsp._jspService(service_jsp.java:864)
	org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:94)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:802)
	org.apache.struts.action.RequestProcessor.doForward
(RequestProcessor.java:1069)
	org.apache.struts.action.RequestProcessor.processForwardConfig
(RequestProcessor.java:455)
	org.apache.struts.action.RequestProcessor.process
(RequestProcessor.java:279)
	org.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)
	org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:689)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:802)


root cause 

javax.servlet.jsp.JspException: Define tag cannot set a null value
	org.apache.struts.taglib.bean.DefineTag.doEndTag(DefineTag.java:272)
	admin.service.service_jsp._jspService(service_jsp.java:253)
	org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:94)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:802)
	org.apache.struts.action.RequestProcessor.doForward
(RequestProcessor.java:1069)
	org.apache.struts.action.RequestProcessor.processForwardConfig
(RequestProcessor.java:455)
	org.apache.struts.action.RequestProcessor.process
(RequestProcessor.java:279)
	org.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)
	org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:689)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:802)


note The full stack trace of the root cause is available in the Apache 
Tomcat/5.0 logs.


--------------------------------------------------------------------------------

Apache Tomcat/5.0

************************************************************
************************************************************
************************************************************

when a host is clicked on on the left navigation frame:

HTTP Status 500 - 

--------------------------------------------------------------------------------

type Exception report

message 

description The server encountered an internal error () that prevented it from 
fulfilling this request.

exception 

java.lang.NullPointerException
	org.apache.struts.taglib.logic.CompareTagBase.condition
(CompareTagBase.java:179)
	org.apache.struts.taglib.logic.NotEqualTag.condition
(NotEqualTag.java:90)
	org.apache.struts.taglib.logic.ConditionalTagBase.doStartTag
(ConditionalTagBase.java:218)
	admin.host.host_jsp._jspService(host_jsp.java:450)
	org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:94)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:802)
	org.apache.struts.action.RequestProcessor.doForward
(RequestProcessor.java:1069)
	org.apache.struts.action.RequestProcessor.processForwardConfig
(RequestProcessor.java:455)
	org.apache.struts.action.RequestProcessor.process
(RequestProcessor.java:279)
	org.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)
	org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:689)
	javax.servlet.http.HttpServlet.service(HttpServlet.java:802)


note The full stack trace of the root cause is available in the Apache 
Tomcat/5.0 logs.


--------------------------------------------------------------------------------

Apache Tomcat/5.0</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64291</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-27 22:58:55 +0000</bug_when>
    <thetext>This is a bit mysterious, as neither host.jsp nor the 
Edit/Add/SaveHostAction.java files have changed in more than six months.  I'll 
have to dig a bit deeper it seems ;)</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64292</commentid>
    <comment_count>2</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-27 23:03:53 +0000</bug_when>
    <thetext>You must have some weird configuration error, because it works for me.  I'm 
unable to reproduce your issue.

Here are the steps I took and other details:
- Download jakarta-tomcat-5.0.28.zip from the Jakarta binaries download page, 
unzip to c:\ (I'm running Windows XP SP2, Sun JDK 1.4.2_04).
- Edit conf/tomcat-users.xml to add an admin user, startup the server using 
statup.bat.
- Go to the Administration link, login to the admin webapp, click around 
server, service, host (in fact I clicked on every link I could find, all 
worked).
- I even add a brand new host, saved, committed changed, then deleted, no 
problem.  Same with adding a service.

I suggest you use the tomcat-user mailing list to ask for help if you do a 
clean installation and still get this issue.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>85183</commentid>
    <comment_count>3</comment_count>
      <attachid>17533</attachid>
    <who name="Amila">amilaSuriarachchi</who>
    <bug_when>2006-01-30 05:55:14 +0000</bug_when>
    <thetext>Created attachment 17533
use the domain parameter instead of TomcatTreeBuilder.DEFAULT_DOMAIN

this bug is caused by the following method in 
org.apache.webapp.admin.Lists.java class

The method is : 

public static String getAdminAppService (MBeanServer mbserver, String domain,
HttpServletRequest
request)
	throws Exception {

	String adminDomain = TomcatTreeBuilder.DEFAULT_DOMAIN;
	// Get the admin app's service name
	StringBuffer sb = new StringBuffer(adminDomain);
	sb.append(":type=Service,*");
	ObjectName search = new ObjectName(sb.toString());
	 // other parts
	return service;

    }

as you can see it always uses the TomcatTreeBuilder.DEFAULT_DOMAIN to find the
service. but this value is hard coded as "Catalina"

so if someone rename the Engine name(defuaul Catalina) in server.xml it causes
this error.

some we have to use the domain paramenter as follows
 StringBuffer sb = new StringBuffer(domain);</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>88072</commentid>
    <comment_count>4</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2006-04-14 15:16:13 +0000</bug_when>
    <thetext>Blake, does Amila's patch fix your issue?

The relevant code is still intact in the 5.5 branch as of 5.5.16, so this is not
just a 5.0 issue.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>93125</commentid>
    <comment_count>5</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2006-09-07 02:44:28 +0000</bug_when>
    <thetext>This has been fixed in 5.5.x and will be included in 5.5.19 onwards.

Thanks for the report and the patch.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>17533</attachid>
            <date>2006-01-30 05:55:00 +0000</date>
            <delta_ts>2006-01-30 05:55:14 +0000</delta_ts>
            <desc>use the domain parameter instead of TomcatTreeBuilder.DEFAULT_DOMAIN</desc>
            <filename>patch.txt</filename>
            <type>text/plain</type>
            <size>698</size>
            <attacher name="Amila">amilaSuriarachchi</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>31356</bug_id>
          
          <creation_ts>2004-09-22 07:15:00 +0000</creation_ts>
          <short_desc>Duplicate sessions counter not incremented in ManagerBase</short_desc>
          <delta_ts>2005-03-20 17:06:14 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.5.1</version>
          <rep_platform>All</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Michael Leditschke">mike</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>64018</commentid>
    <comment_count>0</comment_count>
    <who name="Michael Leditschke">mike</who>
    <bug_when>2004-09-22 07:15:13 +0000</bug_when>
    <thetext>The incrementing of this counter was lost during a refactor from version
1.29 to 1.30 of ManagerBase. The attached patch adds in back again
in the code to detect duplicate session ids in generateSessionId().</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64019</commentid>
    <comment_count>1</comment_count>
      <attachid>12828</attachid>
    <who name="Michael Leditschke">mike</who>
    <bug_when>2004-09-22 07:16:03 +0000</bug_when>
    <thetext>Created attachment 12828
diff to fix problem</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64187</commentid>
    <comment_count>2</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-24 14:59:35 +0000</bug_when>
    <thetext>OK, I've applied your patch, fixing this item for now.  As Remy said, the whole 
duplicates counting and tracking may be removed in a future release.</thetext>
  </long_desc>
      
          <attachment isobsolete="0" ispatch="1" isprivate="0">
            <attachid>12828</attachid>
            <date>2004-09-22 07:16:00 +0000</date>
            <delta_ts>2004-09-22 07:16:03 +0000</delta_ts>
            <desc>diff to fix problem</desc>
            <filename>ManagerBase-duplicates.txt</filename>
            <type>text/plain</type>
            <size>823</size>
            <attacher name="Michael Leditschke">mike</attacher>
            

          </attachment>
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>31362</bug_id>
          
          <creation_ts>2004-09-22 13:25:00 +0000</creation_ts>
          <short_desc>Start Catalina under JPDA debugger with "-security" option fails</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.28</version>
          <rep_platform>Other</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter>sherold</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>64043</commentid>
    <comment_count>0</comment_count>
    <who name="">sherold</who>
    <bug_when>2004-09-22 13:25:15 +0000</bug_when>
    <thetext>Starting Catalina under JPDA debugger with "-security" option fails. You will
get following error message:

Error occurred during initialization of VM
-Xrun library failed to init: jdwp
JDWP unable to access JVMDI Version 1.
Maybe you need to start the VM with the -Xdebug option

This is a windows jdk1.4 specific bug. It can be fixed by modifying the
bin/catalina.bat startup script like this:

- %_EXECJAVA% %JAVA_OPTS% %CATALINA_OPTS%
-Xrunjdwp:transport=%JPDA_TRANSPORT%,address=%JPDA_ADDRESS%,server=y,suspend=n
%DEBUG_OPTS%
+ %_EXECJAVA% %JAVA_OPTS% %CATALINA_OPTS% -Xdebug
-Xrunjdwp:transport=%JPDA_TRANSPORT%,address=%JPDA_ADDRESS%,server=y,suspend=n
%DEBUG_OPTS%</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64129</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-23 20:21:29 +0000</bug_when>
    <thetext>OK, fixed.  Thanks for pointing it out ;)</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>31364</bug_id>
          
          <creation_ts>2004-09-22 15:12:00 +0000</creation_ts>
          <short_desc>Missing resource in org/apache/catalina/core/LocalStrings.properties</short_desc>
          <delta_ts>2006-12-06 05:19:14 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.28</version>
          <rep_platform>All</rep_platform>
          <op_sys>All</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Yoav Shapira">yoavs</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>64054</commentid>
    <comment_count>0</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-22 15:12:52 +0000</bug_when>
    <thetext>... causes problems with webapp reload.  The missing resource is keyed 
standardContext.stoppingContext.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64055</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-22 15:27:33 +0000</bug_when>
    <thetext>Original mailing list post reporting error:

Hi Guys,

Version: 5.0.28

Scenario:

One of our web applications has context reload="true" set so that we can deploy 
single class patches (side question: is there a better way of hot-deploying 
single-class patching?)

However, every time we copy the new class over the existing class, Tomcat 
begins to reload but throws the following exception stack trace about 6 times 
in a row (in stdout) and the UI presents error 503 application unavailable on 
requests. 

Tomcat never recovers from this and we have to restart the service.

INFO: Reloading this Context has started
22-Sep-2004 10:02:25 org.apache.catalina.core.StandardContext reload
SEVERE: Cannot find message associated with key standardContext.stoppingContext
LifecycleException:  Manager has not yet been started
	at org.apache.catalina.session.StandardManager.stop
(StandardManager.java:680)
	at org.apache.catalina.core.StandardContext.stop
(StandardContext.java:4474)
	at org.apache.catalina.core.StandardContext.reload
(StandardContext.java:3015)
	at org.apache.catalina.core.StandardContext.backgroundProcess
(StandardContext.java:4629)
	at 
org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChild
ren(ContainerBase.java:1619)
	at 
org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChild
ren(ContainerBase.java:1628)
	at 
org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChild
ren(ContainerBase.java:1628)
	at 
org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run
(ContainerBase.java:1608)
	at java.lang.Thread.run(Unknown Source)
22-Sep-2004 10:02:25 org.apache.catalina.core.StandardContext start
INFO: Container StandardContext[] has already been started
22-Sep-2004 10:02:36 org.apache.catalina.core.StandardContext reload

Kind regards, Allistair.


&lt;FONT SIZE=1 FACE="VERDANA,ARIAL" COLOR=BLUE&gt; 
-------------------------------------------------------
QAS Ltd.
Developers of QuickAddress Software
&lt;a href="http://www.qas.com"&gt;www.qas.com&lt;/a&gt;
Registered in England: No 2582055
Registered in Australia: No 082 851 474
-------------------------------------------------------
&lt;/FONT&gt;


---------------------------------------------------------------------
To unsubscribe, e-mail: tomcat-user-unsubscribe@jakarta.apache.org
For additional commands, e-mail: tomcat-user-help@jakarta.apache.org</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64056</commentid>
    <comment_count>2</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-22 15:52:39 +0000</bug_when>
    <thetext>Fixed for both Tomcat 5.0 and 5.5.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>96559</commentid>
    <comment_count>3</comment_count>
    <who name="Neale Rudd">neale</who>
    <bug_when>2006-12-06 05:06:07 +0000</bug_when>
    <thetext>Hi, I still get this in 5.0.28, even though the bugzilla settings show it as 
closed for 5.0.28.

Tomcat Manager shows:
FAIL - Application at context path / could not be started

Versions:
Apache Tomcat/5.0.28 1.4.2_04-b05 Sun Microsystems Inc. Windows 2003 5.2 x86 

Stack Trace:
Dec 6, 2006 11:55:28 PM org.apache.catalina.core.StandardContext reload
SEVERE: Cannot find message associated with key standardContext.stoppingContext
LifecycleException:  Manager has not yet been started
        at org.apache.catalina.session.StandardManager.stop
(StandardManager.java:680)
        at org.apache.catalina.core.StandardContext.stop
(StandardContext.java:4496)
        at org.apache.catalina.core.StandardContext.reload
(StandardContext.java:3037)
        at org.apache.catalina.startup.HostConfig.restartContext
(HostConfig.java:873)
        at org.apache.catalina.startup.HostConfig.checkContextLastModified
(HostConfig.java:759)
        at org.apache.catalina.startup.HostConfig.check(HostConfig.java:1085)
        at org.apache.catalina.startup.HostConfig.lifecycleEvent
(HostConfig.java:327)
        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent
(LifecycleSupport.java:119)
        at org.apache.catalina.core.StandardHost.backgroundProcess
(StandardHost.java:800)
</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>96560</commentid>
    <comment_count>4</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2006-12-06 05:19:14 +0000</bug_when>
    <thetext>This is expected. We don't patch previous releases to fix bugs. Fixes are
included in the next release after the fix was made. Where a release has not
been made since the fix, you can obtain the latest code from SVN which will
include the fix.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>31436</bug_id>
          
          <creation_ts>2004-09-27 13:02:00 +0000</creation_ts>
          <short_desc>missing % before and after CURRENT_DIR in startup.bat</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>5.0.25</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Windows XP</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P5</priority>
          <bug_severity>minor</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Pander">pander</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>64259</commentid>
    <comment_count>0</comment_count>
    <who name="Pander">pander</who>
    <bug_when>2004-09-27 13:02:42 +0000</bug_when>
    <thetext>missing % before and after CURRENT_DIR in startup.bat

see line 16
change from
cd CURRENT_DIR
to
cd %CURRENT_DIR%</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64260</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-27 13:27:32 +0000</bug_when>
    <thetext>Fixed four months ago.  Update your Tomcat version.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>31447</bug_id>
          
          <creation_ts>2004-09-28 08:56:00 +0000</creation_ts>
          <short_desc>Contribution: system daemon script for GNU/Linux</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina</component>
          <version>Unknown</version>
          <rep_platform>All</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>enhancement</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Pander">pander</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>64296</commentid>
    <comment_count>0</comment_count>
    <who name="Pander">pander</who>
    <bug_when>2004-09-28 08:56:05 +0000</bug_when>
    <thetext>Here is a contribution of a system daemon script for GNU/Linux to mangege 
starting and stopping of Tomcat. It has been developed and tested on RedHat 
Enterprise Server 3 but had been made with other distributions in mind. RedHat 
(and probably also for Mandrake) specfied code (/etc/rc.d/init.d/functions) is 
only activated when available.

It would be very nice to ship Tomcat with a out of the box worknig system 
deamon script for Linux.

#!/bin/bash
#
# Startup script for the Tomcat Servlet Container
#
# chkconfig: - 86 14
# description: Tomcat is the servlet container that is used in the official \
#              Reference Implementation for the Java Servlet and JavaServer \
#              Pages technologies
 
# Source function library.
if [ -x /etc/rc.d/init.d/functions ]; then
	. /etc/rc.d/init.d/functions
else
	echo_success() {
		echo -n "[  OK  ]"
		echo -ne "\r"
		return 0
	}
	echo_failure() {
		echo -n "[FAILED]"
		echo -ne "\r"
		return 1
	}
fi
prog=tomcat
TOMCAT_HOME=/opt/tomcat

start() {
	echo -n $"Starting $prog: "
	su - root -c $TOMCAT_HOME/bin/startup.sh &gt; /dev/null
	RETVAL=$?
	if [ $RETVAL -eq 0 ]; then
		echo_success
	else
		echo_failure
	fi
	echo
	[ $RETVAL = 0 ] &amp;&amp; touch /var/lock/subsys/$prog
	return $RETVAL
}
stop() {
	echo -n $"Stopping $prog: "
	su - root -c $TOMCAT_HOME/bin/shutdown.sh &gt; /dev/null
	RETVAL=$?
	if [ $RETVAL -eq 0 ]; then
		echo_success
	else
		echo_failure
	fi
	echo
	[ $RETVAL = 0 ] &amp;&amp; rm -f /var/lock/subsys/$prog
	return $RETVAL
}

# See how we were called.
case "$1" in
  start)
	start
	;;
  stop)
	stop
	;;
  restart)
	stop
	start
	;;
  status)
	INSTANCES=`ps --columns 512 -aef|grep java|grep tomcat|grep 
org.apache.catalina.startup.Bootstrap|wc -l`
	if [ $INSTANCES -eq 0 ]; then	
		echo $prog is stopped
		REVAL=3
	else
		if [ $INSTANCES -eq 1 ]; then	
			echo $prog is running 1 instance...
		else
			echo $prog is running $INSTANCES instances...
		fi
		REVAL=0
	fi
	;;
  *)
	echo $"Usage: $prog {start|stop|restart|status|help}"
	exit 1
esac

exit $RETVAL</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64436</commentid>
    <comment_count>1</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-09-30 15:10:31 +0000</bug_when>
    <thetext>I wonder what the proper CVS location for this is.  jakarta-tomcat-
catalina/catalina/src/bin might be the place, but I'm thinking we might need a 
new contrib directory for some other OS-specific scripts we're getting via the 
mailing list.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65931</commentid>
    <comment_count>2</comment_count>
    <who name="Yoav Shapira">yoavs</who>
    <bug_when>2004-10-28 20:02:17 +0000</bug_when>
    <thetext>OK, added for Tomcat 5.0.30.  See bin/contrib directory.  Thanks for submitting 
this.</thetext>
  </long_desc>
      
      

    <bug_classification class="RFE">RFE</bug_classification></bug>
    <bug>
          <bug_id>31465</bug_id>
          
          <creation_ts>2004-09-29 14:33:00 +0000</creation_ts>
          <short_desc>JSP encoding is wrong</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Jasper</component>
          <version>5.5.2</version>
          <rep_platform>Other</rep_platform>
          <op_sys>other</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>normal</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="David Holscher">David.Holscher</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>64364</commentid>
    <comment_count>0</comment_count>
    <who name="David Holscher">David.Holscher</who>
    <bug_when>2004-09-29 14:33:14 +0000</bug_when>
    <thetext>I have the following text in a JSP with no encoding declared:

Copyright © 2003 by 

The copyright symbol does not come out correctly. I checked the file and the 
stored character code is 0xA9 which is correct for ISO-8859-1. I checked the 
JSP 2.0 spec and the default encoding is still supposed to be ISO-8859-1. Yet 
the result is

Copyright Â© 2003 by

This can be easily reproduced by creating an empty web application and putting 
just Copyright © 2003 by into a jsp file.

Looking at the generated Java file I see

      out.write("Copyright Â© 2003 by\r\n");</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64498</commentid>
    <comment_count>1</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-10-02 01:36:20 +0000</bug_when>
    <thetext>The reason for the seemly extra character in out.write() is that the java file
Jasper generated is defaulted to utf8 encoding (0xa9 is 0xc2a9 in utf8). 
However, you cannot just set the Jasper option javaEncoding to ISO-5589-1,
because you'll then also need to set a javac option to use the same encoding,
and  currently you cannot change the javac source encoding.

Looks like the only way for this to work is to use urt8 for both the page and
the response.  :(</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64576</commentid>
    <comment_count>2</comment_count>
    <who name="Kin-Man Chung">kin-man.chung</who>
    <bug_when>2004-10-04 19:14:35 +0000</bug_when>
    <thetext>On second thought, what I said wasn't entirely correct.  :(

Jasper is still correct to output the bytes 0xc2a9 because of the difference in
encoding.  However, druing javac compilation, these bytes should be translated
back to the original 0xa9, and everything should be OK.  The problem seems to be
in the JDT compiler, or its setup codes.

As a work around, use ant compilation to use JDK 1.4 javac. </thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64577</commentid>
    <comment_count>3</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2004-10-04 19:35:52 +0000</bug_when>
    <thetext>I have a fix for this that I will commit very shortly. I came across whilst 
looking at another bug.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>64579</commentid>
    <comment_count>4</comment_count>
    <who name="Mark Thomas">markt</who>
    <bug_when>2004-10-04 19:48:35 +0000</bug_when>
    <thetext>Patch committed and verified.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>
    <bug>
          <bug_id>31495</bug_id>
          
          <creation_ts>2004-09-30 18:40:00 +0000</creation_ts>
          <short_desc>Context reload causes ClusterManager to stop operating</short_desc>
          <delta_ts>2004-11-16 19:05:46 +0000</delta_ts>
          <reporter_accessible>1</reporter_accessible>
          <cclist_accessible>1</cclist_accessible>
          <classification_id>1</classification_id>
          <classification>Unclassified</classification>
          <product>Tomcat 5</product>
          <component>Catalina:Cluster</component>
          <version>5.0.28</version>
          <rep_platform>PC</rep_platform>
          <op_sys>Linux</op_sys>
          <bug_status>RESOLVED</bug_status>
          <resolution>FIXED</resolution>
          
          
          <bug_file_loc/>
          <status_whiteboard/>
          <keywords/>
          <priority>P3</priority>
          <bug_severity>major</bug_severity>
          <target_milestone>---</target_milestone>
          
          
          <everconfirmed>1</everconfirmed>
          <reporter name="Brantley Hobbs">bhobbs</reporter>
          <assigned_to name="Tomcat Developers Mailing List">dev</assigned_to>
          <cc>lawrence</cc>
          <votes>0</votes>

      

      

      

          <comment_sort_order>oldest_to_newest</comment_sort_order>  
          <long_desc isprivate="0">
    <commentid>64450</commentid>
    <comment_count>0</comment_count>
    <who name="Brantley Hobbs">bhobbs</who>
    <bug_when>2004-09-30 18:40:51 +0000</bug_when>
    <thetext>A functioning clustered application works fine when the tomcat server is
initially started.  Sessions are replicated, etc.

As soon as the context is reloaded on one server, the sessions are no longer
replicated between servers.  A full tomcat restart is required to restore this
functionality.

The application and configuration are known to be functional, and the problem
does not occur on 5.0.25.  The problem only occurs on our 5.0.28 installation. 
We have downgraded our installation to verify this, and the same functionality
that does not work properly on 5.0.28 does in fact work on 5.0.25.

There is a thread with the subject of "Clustering and session replication" in
the tomcat-users mailing list, starting on 9/29/2004.

All relevant output is below:
--Host "A" catalina.out from context reload--
Sep 29, 2004 3:47:26 PM org.apache.catalina.cluster.session.DeltaManager
start
WARNING: Manager[/nahrgisdev], requesting session state from
org.apache.catalina.cluster.mcast.McastMember[tcp://10.0.0.2:4001,
10.0.0.2,4001, alive=253140]. This operation will timeout if no
session state has been received within 60 seconds
Sep 29, 2004 3:48:26 PM org.apache.catalina.cluster.session.DeltaManager
start
SEVERE: Manager[/nahrgisdev], No session state received, timing out.

--Host "B" catalina.out from context reload--
Sep 29, 2004 3:50:16 PM org.apache.catalina.cluster.session.DeltaManager start
WARNING: Manager[/nahrgisdev], requesting session state from
org.apache.catalina.cluster.mcast.McastMember[tcp://10.0.0.1:4001,10.0.0.1,4001,
alive=681060]. This operation will timeout if no session state has been received
within 60 seconds
Sep 29, 2004 3:50:16 AM org.apache.catalina.cluster.session.DeltaManager start
INFO: Manager[/nahrgisdev], session state received in 109 ms.</thetext>
  </long_desc><long_desc isprivate="0">
    <commentid>65368</commentid>
    <comment_count>1</comment_count>
    <who name="Filip Hanik">fhanik</who>
    <bug_when>2004-10-20 17:06:30 +0000</bug_when>
    <thetext>Fixed, the container reuses the Manager instead of creating a new one upon 
context reload, and the DeltaManager wasn't readding itself to the cluster 
upon restart.</thetext>
  </long_desc>
      
      

    <bug_classification class="BUG">BUG</bug_classification></bug>

</bugzilla>