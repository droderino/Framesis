@relation 'Bugzilla data'

@attribute bug_bug_id numeric
@attribute bug_short_desc string
@attribute bug_product string
@attribute bug_component string
@attribute bug_reporter string
@attribute bug_assigned_to string
@attribute bug_long_desc string
@attribute bug_thetext string
@attribute bug_classification {BUG,RFE,IMPROVEMENT,DOCUMENTATION,BUILD_SYSTEM,REFACTORING,CLEANUP,SPEC,TEST,BACKPORT,TASK,OTHER,DESIGN_DEFECT}

@data
372,'examples/ShowSource always reports \"Invalid JSP file\" due to logic error in ShowSource.java BugRat Report#661','Tomcat 5',Jasper,tony_robertson,dev,'Within the source for the ShowSource tab from the examples\ncontext, ie. the file installed at:\n$(TOMCAT_HOME)\\webapps\\examples\\WEB-INF\\classes\\examples\\ShowSource.java,\nlines 23 to 26 look like this:\n\nif ((jspFile.indexOf( \"..\" ) >= 0) ||\n  (jspFile.toUpperCase().indexOf(\"/WEB-INF/\") != 0) ||\n  (jspFile.toUpperCase().indexOf(\"/META-INF/\") != 0))\n  throw new JspTagException(\"Invalid JSP file \" + jspFile);\n\nlines 24 and 25 should use \"!= -1\" rather than \"!= 0\"\n\nThis effects the \"show source\" links of all the\njsp examples that use the \"ShowSource\" tag.\n\nFixed in 3.2.3-dev and 3.3Have you fixed the problem ??\nsachinxman@gmail.com',?,BUG
2500,'FileNotFoundException from service() unintentionally caught','Tomcat 5',Jasper,bayern,dev,'In the service() method of org.apache.jasper.servlet.JspServlet, I believe the \nscope for which the \'catch FileNotFoundException\' block applies is too great;\nif a FileNotFoundException is thrown from within the JSP page, the result is\nan HTTP 404 error.  The calling code believes the JSP resource itself wasn\'t\nfound, when in fact the exception should be treated as internal to the page.\n(You can test with\n\n   <\% if (1==1) throw new java.io.FileNotFoundException(); \%>\n\nI noticed this problem when debugging the code of a colleague, Shawn Douglas,\nwhose component logic called by the JSP page threw a FileNotFoundException.)\n\nThe offending code seems to be:\n\n           try {\n                loadIfNecessary(request, response);\n\n                // If a page is to only to be precompiled return.\n                if (precompile)\n                    return;\n\n                if (theServlet instanceof SingleThreadModel) {\n                    // sync on the wrapper so that the freshness\n                    // of the page is determined right before servicing\n                    synchronized (this) {\n                        theServlet.service(request, response);\n                    }\n                } else {\n                    theServlet.service(request, response);\n                }\n\n            } catch (FileNotFoundException ex) {\n\n                    ...\n\nbut I haven\'t had the time to look at it thoroughly.  I believe this affects \nTomcat 3.x as well.  The necessary fix should just be to narrow the scope\nof the \'catch\' block, but I haven\'t had a chance to think that through \ncompletely or test it.  (Sorry! :-) )It seems to me that Jasper is doing the right thing -- if the application wants\nto use FileNotFoundException internal to a page, it should swallow that\nexception instead of allowing it to propogate back to the container.\n\nMaybe there should be some spec-based description of how exceptions thrown by\nJSP page components should be handled?\nChanging to an \"enhancement\" request since this is a non-spec issue.\nAt this point, this will not be fixed (if still present in Jasper 2).I disagree with Remy and Craig, and I think if you polled 10 developers, 11 of\nthem would call this a bug.\n\nThe specification pretty clearly lays out what is to happen when a .jsp page\nthrows an Exception:\n\npublic abstract void handlePageException(java.lang.Throwable t)\nThis method is intended to process an unhandled ’page’ level exception by\nforwarding the exception to the specified error page for this JSP. If forwarding\nis not possible (for example because the response has already been committed),\nan implementation dependent mechanism should be used to invoke\nthe error page (e.g. “including” the error page instead).\nIf no error page is defined in the page, the exception should be rethrown so\nthat the standard servlet error handling takes over.\n\nIn this case, if I specifically define an error page for the .jsp, it is\ninvoked, and the 404 error is not reported - Hurray!\n\nHowever, contrary to the spec, if an error page isn\'t defined, the standard\nservlet error handling doesn\'t take over.  For example, defining the following\nin web.xml, according to the servlet spec, dictates that the given error page\nshould be invoked when a FileNotFoundException is thrown:\n<error-page>\n   <exception-type>java.io.FileNotFoundException</exception-type>\n   <location>/error.jsp</location>\n</error-page>\n\nAs the above doesn\'t happen, and a 404 error is displayed instead, this behavior\nviolates the spec and is a bug.  I am reopening it.  As it is still broken in\nTomcat5, I am putting that for the Product field.  As it is not an enhancement\nbut a bug, I am changing the Severity to \'minor\'.This is now fixed in svn for 5.5.x and 6.0.x and will be included in the next\nreleases of each.',?,BUG
4690,'sessions not scoped according to spec section 7.3','Tomcat 5',Catalina,jmcnally,dev,'The session for a request is set according to the context in which the request\noriginated.  When a request is passed to a servlet in another context the\nsession object should not be the same as in the original context.\n\nLooking at the code, it appears this boils down to having the context stored in\nthe request reflect the actual context where the request is currently being\nprocessed.  A mechanism also needs to be in place so that any sessions initiated\nin the second (or greater) context in the chain will have the same id as the\nsession in the original context.\n\nThis bug is present in the current CVS and was reported against tomcat and\nservlet 2.2 spec as well.Created attachment 771\nmy attempt to fix the problem, did not work do to use of Facade classI checked the spec, and it seems you\'re right. I wouldn\'t categorize it as high \npriority, as I\'m not a big fan of cross context access (for security reasons, \nplus I think that webapps should be as self-contained as possible).\n\nThe patch appears far reaching and high risk, so it\'s not going in 4.0.x \nanytime soon (and will be documented as a known issue in all Tomcat 4.0.x \nversions which do have this problem).\nWaiting for Craig\'s opinion on this subject ...This bug is complex to fix, and for this reason will probably not be fixed in \nthe 4.0.x branch, but more likely for 4.1. This will be mentioned in the \nrelease notes.*** Bug 8213 has been marked as a duplicate of this bug. ****** Bug 9116 has been marked as a duplicate of this bug. ****** Bug 10886 has been marked as a duplicate of this bug. ****** Bug 11879 has been marked as a duplicate of this bug. ****** Bug 13516 has been marked as a duplicate of this bug. ***I hope someone can solve this problem, this is a serious problem to me, and I \ncan\'t think of a solution to solve my problem other than using cross context.\n\nI working on a project which related to goverment policy.  Therefore the \napplication has to change every year (I mean the application calculation engine \nand the jsp page).  Although it change to new year application, but the old \napplication still has to stay alive for users who haven\'t migrate their data to \nnew year application.  \n\nEvery year I have to deploy a new application and allow old application can \ncross context to talk to new application.  Due to the session problem, the \nwhole things cannot be done unless I change to another application server.\n\nNow is already version 4.1.18, this bug still haven\'t solve yet.  Hope someone \ncan consider this issue.\n\nMy post in tomcat user mailing list:\nhttp://archives.apache.org/eyebrowse/ReadMsg?listName=tomcat-\nuser@jakarta.apache.org&msgNo=95890\n\nThis will not get fixed in Tomcat 4.1.x. Spec people will have to assess the\nseverity of the problem.This should now be fixed. The fix will be included in 5.0.7.While the new session is now being created and provided to the included\nresource, no cookie is being added to the response to allow the session to be\nretrieved when direct requests to the included context are recieved.  \n\n(Pluto bug PLUTO-53 depends upon a fix to this issue:\nhttp://nagoya.apache.org/jira/browse/PLUTO-53)\n\nI have have attached a patch.\nCreated attachment 12542\nCross Context Patch - Add Cookie if able toI tried applying the specified path to 5.0.27 My portlet test still failed. The\nportlet\'s session ID was different than the servlet\'s session ID.There have been two Servlet Spec versions and many more Tomcat versions since \nthis bug was originally filed.  Does this still matter to anyone, or at least \nto the original poster?\n\nIs the latest Servlet Spec (v2.4) clear on this issue?  How is it handled in \nthe latest stable Tomcat (5.0.28 at the time of this writing)?  Who would \nobject if this issue is closed as WONTFIX, since that\'s been the effective \nstatus for a year now?I was the original poster and I obviously haven\'t been waiting 3 years hoping it\nwill be fixed and I am less dependent on the cross-context behavior now than I\nwas then.  I simply filed the issue as a failure in the reference implementation\nto meet the specification.  \n\nBut there are others who are still suffering from this problem and many dupes\nwere filed as well.  Remy indicates that it should have been fixed, but it\nappears there is still a bug.  The problem in Tomcat 4.x was deep in the\narchitecture, but  it sounds like a solution is closer at hand now, it would\nseem a shame to declare it a WONTFIX, if the current bug turns out to be simple.\n\nResetting this to Tomcat 4 and declaring it WONTFIX while also entering a more\nspecific defect report in Tomcat 5 might be a reasonable route though. I would also object.  The Portlet Specification depends upon cross context\nfunctionality working properly and there have been several complaints on the\nPluto user and dev lists about this.  I\'m pretty sure that the underlying\nproblem is in tomcat and not in pluto.  \n\nAs I stated before, the fix seems to be implemented halfway.  The session which\nis passed to the target context is now unique, however, it is not permenantly\nassociated with the context and thus can\'t be retrieved during future requests.I completely disagree with this.\nThe included session is merely a shadow of the including session. As a result,\nit will not be handled as an actual session with an independant cookie. This is\nnot specified, so this is my interpretation, which should stand until\ncrosscontext session lifecycle and behavior is actually fully specified.Can you provide some insight on why your interpretation is that this session is\na mere shadow?  What use would a session be if it can\'t be retrieved later on\nfor use by subsequent requests?\n\nCan you provide any ideas on how we can meet the requirements of the portlet\nspecification\'s Application Scoped attributes (15.3) with your interpretation.\nI\'m not necessarily a fan of cross context apps either, however, our issue is\nthat we\'re trying to implement a specification which *seems* to require a\ndifferent interpretation of the servlet spec than yours.  Any help would be\ngreatly appreciated.I just voted for this bug and wanted to voice a comment as well. uPortal 2.3 and\nhigher uses the Pluto JSR-168 portlet container in it\'s framework and is running\ninto this bug as well. This issue is more pronounced in a portal environment\nsince the abaility to share a session in the manner described in the bug is\nessential for a portlet to securly pass session scoped data to a servlet outside\nof the portal to initiate a download or similar action.It\'s not my fault if the portal JSR decided to make asumptions about the servlet\nspecification, and then, to be sure that they would piss off people, included\ntheir dubious asumptions in their TCK.It seems to me that the only assumption that was made was that sessions would\nwork normally when used from a cross-context dispatcher. Why is this such a\ndubious assumption?I think this is an issue to be resolved between the Portlet Spec people and \nthe Servlet Spec people.  Tomcat\'s implementation is strictly according to the \nServlet Spec, and is valid (passes all TCKs 100\%) according to that Spec.  IF \nthe Spec specifies cross-context behavior that we don\'t support (it doesn\'t), \nthen you\'d have a legit Tomcat bug.  \n\nIf the Portlet Spec relies on behavior that is unspecified or unclear in the \nServlet Spec, contact the JSR 154 team (jsr-154-comments@jcp.org) to address \nthe issue.  The Servlet Spec, like the Portlet Spec, is very much alive.  I \nwould not be surprised to see clarification on this cross-context stuff in \nv2.5 of the Servlet Spec.  And needless to say, the next major Tomcat version \nwill implement the next Servlet Spec version accurately and fully, just as it \ndoes now.  But until such a Spec change is made, this is not a Tomcat bug.This bug has been resolved through the patch referenced to below:\n\nhttp://nagoya.apache.org/eyebrowse/ReadMsg?listName=tomcat-dev@jakarta.apache.org&msgNo=80223\n\nAnyone wanting to use this functionality must remember to set the\n\"emptySessionPath\" attribute in their connector configuration.  An example is below.\n\n<Connector port=\"8080\" maxThreads=\"150\" minSpareThreads=\"25\"\n           maxSpareThreads=\"75\" enableLookups=\"false\"\n           redirectPort=\"8443\" acceptCount=\"100\"\n           connectionTimeout=\"20000\" disableUploadTimeout=\"true\"\n           emptySessionPath=\"true\" /> \n\n\nMany thanks to the Tomcat team for working with us to find an acceptable\nsolution to all parties!',?,RFE
4829,'Automatic deployment of war files does not work properly','Tomcat 5',Catalina,e.roske,dev,'When we define a context in the server.xml file for our application, it will \nnot be deployed. We have deleted the directory webapps/lexis before starting \ntomcat.\n\n        <Context path=\"/lexis\" docBase=\"lexis.war\">\n            <Parameter name=\"appName\" value=\"lexis\" override=\"false\"/>\n            <Logger className=\"org.apache.catalina.logger.FileLogger\"\n                  prefix=\"localhost_lexis_log.\" suffix=\".txt\" timestamp=\"true\"/>\n        </Context>\n\nWithout defining a context the application lexis is deployed and starts without \nany problems.\n\nIt does however work while working with Apache and the Warp Connector when it \nis first activated by calling http://www.foobar.com/lexis/lexis.doWhen  you use that kind of declaration (referencing a WAR), the webapp is run\nwithout unpacking the WAR (although the JARs and the classes will be extracted\nto a temporary location).\nStruts should run in that mode, but webapps which require filesystem access will\nnot (getRealPath() will return null, and direct filesystem access to the\nwebapp\'s resources will obviously fail).\n\nIf you don\'t want that to happen, you can let Tomcat extract the WAR, and then\ndeclare your context as <Context path=\"/lexis\" docBase=\"lexis\">.\nWe had already tried your proposal, but it does not work.\n\nWe have not changed the parameter unpackWARs (which -I think-\nis responsible for the unpacking), but Tomcat does not unpack the\nwebapp:\n\n<Host name=\"localhost\" debug=\"0\" appBase=\"webapps\" unpackWARs=\"true\">\n\nIs there any other way to let Tomcat extract the WAR file?\n\nWe _must_ define a context for lexis, to do the folowing:\n1) avoid the sessions to be persisted and reloaded (saveOnRestart=\"false\") when \nTomcat is shut down and restarted (Just because we do not only use struts: we \nalso use log4j, which is not Serializable, and at higher levels the \nPersistentManager declarations seem not to work)\n2) to log4j the lexis application to a specific file/directory\n3) to use application parameters\n\n((Without defining a context for the webapp lexis Tomcat\nDOES extract the WAR file. Only when I __define__ a context\nit DOES NOT!!))\nWhat I suggest doing works for me. That\'s how the examples webapp is declared \n(and it uses a lot of custom parameters).\n\nThe unpackWARs attribute is used only when auto-deploying webapps, not when \nexplicitely declaring contexts.Yeah, it does work ONLY if the webapp is in extracted form under webapp/lexis...\n\nBUT the examples webapp is now NOT distributed as a war-file. It was so \ndistributed in earlier Versions. Tomcat 3.2.1 had some war-files: admin, \nexamples, ROOT and test. With Catalina these webapps aren\'t distibuted anymore \nas war-files.\n\nMay this be because of this problem, or should we developers avoid using war-\nfiles to distribute our applications/updates?\n\nPlease take a closer look to the following:\n==================================================================\nWHEN I DO NOT DEFINE A CONTEXT FOR lexis, BUT A DefaultContext,\n\n      <Host name=\"localhost\" debug=\"0\" appBase=\"webapps\" unpackWARs=\"true\">\n\n        <Valve className=\"org.apache.catalina.authenticator.SingleSignOn\"\n                   debug=\"0\"/>\n        <Valve className=\"org.apache.catalina.valves.AccessLogValve\"\n                 directory=\"logs\"  prefix=\"localhost_access_log.\" suffix=\".txt\"\n                 pattern=\"common\"/>\n\n        <Logger className=\"org.apache.catalina.logger.SystemOutLogger\"/>\n\n        <DefaultContext reloadable=\"true\">\n          <Manager className=\"org.apache.catalina.session.PersistentManager\"\n              debug=\"4\"\n              saveOnRestart=\"false\"\n              maxActiveSessions=\"-1\"\n              minIdleSwap=\"-1\"\n              maxIdleSwap=\"-1\"\n              maxIdleBackup=\"-1\">\n                <Store className=\"org.apache.catalina.session.FileStore\"/>\n          </Manager>\n        </DefaultContext>\n        .....\n\nTHE WAR FILE webapps/lexis.war WILL BE EXPANDED AND DEPLOYED.\nBUT THIS DEFAULT CONTEXT WILL JUST BE IGNORED (saveOnRestart=\"false\").\nI AM ALSO NOT ABLE TO DEFINE APPLICATION PARAMETERS:\n==================================================================\nStarting service Tomcat-Standalone\nApache Tomcat/4.0.1\nStandardHost[localhost]: Installing web application at context path /lexis from \nURL jar:file:D:\\Programme\\JBuilder5\\tomcat\\webapps\\lexis.war!/\nWebappLoader[/lexis]: Deploying class repositories to work directory \nD:\\Programme\\JBuilder5\\tomcat\\work\\localhost\\lexis\nWebappLoader[/lexis]: Deploy JAR /WEB-INF/lib/activation.jar to \nD:\\Programme\\JBuilder5\\tomcat\\webapps\\lexis\\WEB-INF\\lib\\activation.jar\nWebappLoader[/lexis]: Deploy JAR /WEB-INF/lib/crimson.jar to \nD:\\Programme\\JBuilder5\\tomcat\\webapps\\lexis\\WEB-INF\\lib\\crimson.jar\nWebappLoader[/lexis]: Deploy JAR /WEB-INF/lib/jaxp.jar to D:\\Programme\\JBuilder5\n\\tomcat\\webapps\\lexis\\WEB-INF\\lib\\jaxp.jar\nWebappLoader[/lexis]: Deploy JAR /WEB-INF/lib/lexis.jar to \nD:\\Programme\\JBuilder5\\tomcat\\webapps\\lexis\\WEB-INF\\lib\\lexis.jar\nWebappLoader[/lexis]: Deploy JAR /WEB-INF/lib/log4j.jar to \nD:\\Programme\\JBuilder5\\tomcat\\webapps\\lexis\\WEB-INF\\lib\\log4j.jar\nWebappLoader[/lexis]: Deploy JAR /WEB-INF/lib/mail.jar to D:\\Programme\\JBuilder5\n\\tomcat\\webapps\\lexis\\WEB-INF\\lib\\mail.jar\nWebappLoader[/lexis]: Deploy JAR /WEB-INF/lib/struts.jar to \nD:\\Programme\\JBuilder5\\tomcat\\webapps\\lexis\\WEB-INF\\lib\\struts.jar\nStandardManager[/lexis]: Seeding random number generator class \njava.security.SecureRandom\nStandardManager[/lexis]: Seeding of random number generator has been completed\nStandardManager[/lexis] IOException while loading persisted sessions: \njava.io.WriteAbortedException: Writing aborted by exception; \njava.io.NotSerializableExce\nion: org.apache.log4j.Category\njava.io.WriteAbortedException: Writing aborted by exception; \njava.io.NotSerializableException: org.apache.log4j.Category\n        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:445)\n        at java.io.ObjectInputStream.inputClassFields\n(ObjectInputStream.java:2263)\n        at java.io.ObjectInputStream.defaultReadObject\n(ObjectInputStream.java:519)\n        at java.io.ObjectInputStream.inputObject(ObjectInputStream.java:1412)\n        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:386)\n        at java.io.ObjectInputStream.inputClassFields\n(ObjectInputStream.java:2263)\n        at java.io.ObjectInputStream.defaultReadObject\n(ObjectInputStream.java:519)\n        at java.io.ObjectInputStream.inputObject(ObjectInputStream.java:1412)\n        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:386)\n        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:236)\n        at org.apache.catalina.session.StandardSession.readObject\n(StandardSession.java:1268)\n        at org.apache.catalina.session.StandardSession.readObjectData\n(StandardSession.java:810)\n        at org.apache.catalina.session.StandardManager.load\n(StandardManager.java:411)\n        at org.apache.catalina.session.StandardManager.start\n(StandardManager.java:617)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1104)\n        at org.apache.catalina.core.StandardContext.start\n(StandardContext.java:3334)\n        at org.apache.catalina.core.ContainerBase.addChild\n(ContainerBase.java:785)\n        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:454)\n        at org.apache.catalina.core.StandardHost.install(StandardHost.java:712)\n        at org.apache.catalina.startup.HostConfig.deployApps\n(HostConfig.java:647)\n        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:777)\n        at org.apache.catalina.startup.HostConfig.lifecycleEvent\n(HostConfig.java:463)\n        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent\n(LifecycleSupport.java:155)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1131)\n        at org.apache.catalina.core.StandardHost.start(StandardHost.java:612)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1123)\n        at org.apache.catalina.core.StandardEngine.start\n(StandardEngine.java:307)\n        at org.apache.catalina.core.StandardService.start\n(StandardService.java:388)\n        at org.apache.catalina.core.StandardServer.start\n(StandardServer.java:505)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:776)\n        at org.apache.catalina.startup.Catalina.execute(Catalina.java:681)\n        at org.apache.catalina.startup.Catalina.process(Catalina.java:179)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:243)\n\nStandardManager[/lexis] Exception loading sessions from persistent storage\njava.io.WriteAbortedException: Writing aborted by exception; \njava.io.NotSerializableException: org.apache.log4j.Category\n        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:445)\n        at java.io.ObjectInputStream.inputClassFields\n(ObjectInputStream.java:2263)\n        at java.io.ObjectInputStream.defaultReadObject\n(ObjectInputStream.java:519)\n        at java.io.ObjectInputStream.inputObject(ObjectInputStream.java:1412)\n        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:386)\n        at java.io.ObjectInputStream.inputClassFields\n(ObjectInputStream.java:2263)\n        at java.io.ObjectInputStream.defaultReadObject\n(ObjectInputStream.java:519)\n        at java.io.ObjectInputStream.inputObject(ObjectInputStream.java:1412)\n        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:386)\n        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:236)\n        at org.apache.catalina.session.StandardSession.readObject\n(StandardSession.java:1268)\n        at org.apache.catalina.session.StandardSession.readObjectData\n(StandardSession.java:810)\n        at org.apache.catalina.session.StandardManager.load\n(StandardManager.java:411)\n        at org.apache.catalina.session.StandardManager.start\n(StandardManager.java:617)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1104)\n        at org.apache.catalina.core.StandardContext.start\n(StandardContext.java:3334)\n        at org.apache.catalina.core.ContainerBase.addChild\n(ContainerBase.java:785)\n        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:454)\n        at org.apache.catalina.core.StandardHost.install(StandardHost.java:712)\n        at org.apache.catalina.startup.HostConfig.deployApps\n(HostConfig.java:647)\n        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:777)\n        at org.apache.catalina.startup.HostConfig.lifecycleEvent\n(HostConfig.java:463)\n        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent\n(LifecycleSupport.java:155)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1131)\n        at org.apache.catalina.core.StandardHost.start(StandardHost.java:612)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1123)\n        at org.apache.catalina.core.StandardEngine.start\n(StandardEngine.java:307)\n        at org.apache.catalina.core.StandardService.start\n(StandardService.java:388)\n        at org.apache.catalina.core.StandardServer.start\n(StandardServer.java:505)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:776)\n        at org.apache.catalina.startup.Catalina.execute(Catalina.java:681)\n        at org.apache.catalina.startup.Catalina.process(Catalina.java:179)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:243)\n\nContextConfig[/lexis]: Configured an authenticator for method BASIC\nStandardWrapper[/lexis:default]: Loading container servlet default\ndefault: init\naction: init\n2001-11-16 09:20:47,185 [main] INFO  com.lincas.web.servlets.MainServlet  - Die \nLexis Anwendungskonfigurationsdatei D:\\Programme\\JBuilder5\\tomcat\\webapps\\lexi\nWEB-INF\\lexis-config.xml wurde geladen\n2001-11-16 09:20:47,195 [main] INFO  com.lincas.web.servlets.MainServlet  - \nDefault Lexis Anwendungskonfiguration: LEXIS\n2001-11-16 09:20:47,195 [main] INFO  com.lincas.web.servlets.MainServlet  - \nMailserver 195.206.1.128 f³r LEXIS initialisiert\n2001-11-16 09:20:47,195 [main] INFO  com.lincas.web.servlets.MainServlet  - \nMailserver 195.206.1.128 f³r ROLIX initialisiert\n2001-11-16 09:20:47,195 [main] INFO  com.lincas.web.servlets.MainServlet  - \nMailserver 195.206.1.128 f³r KOLIX initialisiert\n2001-11-16 09:20:47,195 [main] INFO  com.lincas.web.servlets.MainServlet  - Die \nLEXIS-Anwendung wurde initialisiert\nStandardWrapper[/lexis:invoker]: Loading container servlet invoker\ninvoker: init\njsp: init\nStandardHost[localhost]: Installing web application at context path /manager \nfrom URL file:D:\\Programme\\JBuilder5\\tomcat\\webapps\\manager\nWebappLoader[/manager]: Deploying class repositories to work directory \nD:\\Programme\\JBuilder5\\tomcat\\work\\localhost\\manager\nStandardManager[/manager]: Seeding random number generator class \njava.security.SecureRandom\nStandardManager[/manager]: Seeding of random number generator has been completed\nContextConfig[/manager]: Configured an authenticator for method BASIC\nStandardWrapper[/manager:default]: Loading container servlet default\ndefault: init\nStandardWrapper[/manager:invoker]: Loading container servlet invoker\ninvoker: init\njsp: init\nStandardHost[localhost]: Installing web application at context path  from URL \nfile:D:\\Programme\\JBuilder5\\tomcat\\webapps\\ROOT\nWebappLoader[]: Deploying class repositories to work directory \nD:\\Programme\\JBuilder5\\tomcat\\work\\localhost\\_\nStandardManager[]: Seeding random number generator class \njava.security.SecureRandom\nStandardManager[]: Seeding of random number generator has been completed\nStandardWrapper[:default]: Loading container servlet default\ndefault: init\nStandardWrapper[:invoker]: Loading container servlet invoker\ninvoker: init\njsp: init\nStandardHost[localhost]: Installing web application at context path /tomcat-\ndocs from URL file:D:\\Programme\\JBuilder5\\tomcat\\webapps\\tomcat-docs\nWebappLoader[/tomcat-docs]: Deploying class repositories to work directory \nD:\\Programme\\JBuilder5\\tomcat\\work\\localhost\\tomcat-docs\nStandardManager[/tomcat-docs]: Seeding random number generator class \njava.security.SecureRandom\nStandardManager[/tomcat-docs]: Seeding of random number generator has been \ncompleted\nStandardWrapper[/tomcat-docs:default]: Loading container servlet default\ndefault: init\nStandardWrapper[/tomcat-docs:invoker]: Loading container servlet invoker\ninvoker: init\njsp: init\nStandardHost[localhost]: Installing web application at context path /webdav \nfrom URL file:D:\\Programme\\JBuilder5\\tomcat\\webapps\\webdav\nWebappLoader[/webdav]: Deploying class repositories to work directory \nD:\\Programme\\JBuilder5\\tomcat\\work\\localhost\\webdav\nStandardManager[/webdav]: Seeding random number generator class \njava.security.SecureRandom\nStandardManager[/webdav]: Seeding of random number generator has been completed\nStandardWrapper[/webdav:default]: Loading container servlet default\ndefault: init\nStandardWrapper[/webdav:invoker]: Loading container servlet invoker\ninvoker: init\njsp: init\nStarting service Tomcat-Apache\nApache Tomcat/4.0.1\n\n==================================================================\nWHEN I DEFINE A CONTEXT FOR lexis, \n\n        <Context path=\"/lexis\" docBase=\"lexis\" debug=\"0\" reloadable=\"true\">\n          <Logger className=\"org.apache.catalina.logger.FileLogger\"\n                  prefix=\"localhost_lexis_log.\" suffix=\".txt\" timestamp=\"true\"/>\n          <Manager className=\"org.apache.catalina.session.PersistentManager\"\n                 debug=\"0\"\n                 saveOnRestart=\"false\"\n                 maxActiveSessions=\"-1\"\n                 minIdleSwap=\"-1\"\n                 maxIdleSwap=\"-1\"\n                 maxIdleBackup=\"-1\">\n                <Store className=\"org.apache.catalina.session.FileStore\"/>\n          </Manager>\n        </Context>\n        \nTHE WAR FILE webapps/lexis.war WILL NOT BE EXPANDED AND DEPLOYED\n(I HAVE DIRECTORY webapps/lexis DELETED BEFORE STARTING TOMCAT):\n==================================================================\nStarting service Tomcat-Standalone\nApache Tomcat/4.0.1\nStandardHost[localhost]: Installing web application at context path /manager \nfrom URL file:D:\\Programme\\JBuilder5\\tomcat\\webapps\\manager\nWebappLoader[/manager]: Deploying class repositories to work directory \nD:\\Programme\\JBuilder5\\tomcat\\work\\localhost\\manager\nStandardManager[/manager]: Seeding random number generator class \njava.security.SecureRandom\nStandardManager[/manager]: Seeding of random number generator has been completed\nContextConfig[/manager]: Configured an authenticator for method BASIC\nStandardWrapper[/manager:default]: Loading container servlet default\ndefault: init\nStandardWrapper[/manager:invoker]: Loading container servlet invoker\ninvoker: init\njsp: init\nStandardHost[localhost]: Installing web application at context path  from URL \nfile:D:\\Programme\\JBuilder5\\tomcat\\webapps\\ROOT\nWebappLoader[]: Deploying class repositories to work directory \nD:\\Programme\\JBuilder5\\tomcat\\work\\localhost\\_\nStandardManager[]: Seeding random number generator class \njava.security.SecureRandom\nStandardManager[]: Seeding of random number generator has been completed\nStandardWrapper[:default]: Loading container servlet default\ndefault: init\nStandardWrapper[:invoker]: Loading container servlet invoker\ninvoker: init\njsp: init\nStandardHost[localhost]: Installing web application at context path /tomcat-\ndocs from URL file:D:\\Programme\\JBuilder5\\tomcat\\webapps\\tomcat-docs\nWebappLoader[/tomcat-docs]: Deploying class repositories to work directory \nD:\\Programme\\JBuilder5\\tomcat\\work\\localhost\\tomcat-docs\nStandardManager[/tomcat-docs]: Seeding random number generator class \njava.security.SecureRandom\nStandardManager[/tomcat-docs]: Seeding of random number generator has been \ncompleted\nStandardWrapper[/tomcat-docs:default]: Loading container servlet default\ndefault: init\nStandardWrapper[/tomcat-docs:invoker]: Loading container servlet invoker\ninvoker: init\njsp: init\nStandardHost[localhost]: Installing web application at context path /webdav \nfrom URL file:D:\\Programme\\JBuilder5\\tomcat\\webapps\\webdav\nWebappLoader[/webdav]: Deploying class repositories to work directory \nD:\\Programme\\JBuilder5\\tomcat\\work\\localhost\\webdav\nStandardManager[/webdav]: Seeding random number generator class \njava.security.SecureRandom\nStandardManager[/webdav]: Seeding of random number generator has been completed\nStandardWrapper[/webdav:default]: Loading container servlet default\ndefault: init\nStandardWrapper[/webdav:invoker]: Loading container servlet invoker\ninvoker: init\njsp: init\nStarting service Tomcat-Apache\nApache Tomcat/4.0.1\n================================================================================\n=====\nAND WHEN I TRY TO CALL THE WEBAPP (http://localhost:8080/lexis/lexis.do) I \nBECOME:\nHTTP Status 404: The requested resource (/lexis/lexis.do) is not available\n================================================================================\n=====\n\n\n\nI have test the DefaultContext with nightly 11/12/2001 build\nand it works with Parameter and Env \n*** Bug 5105 has been marked as a duplicate of this bug. ****** Bug 5105 has been marked as a duplicate of this bug. ****** Bug 5600 has been marked as a duplicate of this bug. ***[Note that this is still the behaviour in 4.0.2].\n\nI must concur with the reporter.  The documentation at tomcat-\ndocs/config/host.html leads one to believe that the auto-deployment of the \napplication is orthogonal to the automatic creation of the <context> if it is \nnot supplied. \n\nA work-around we have experimented with is to choose a path that is different \nfrom the docBase (given that documents.war is in the webapps directory):\n\t<Context path=”/docs” docBase=”documents”/>\nAt first this seems to work but there are two problems\n1. This actually deploys as two applications, each using the same docBase.  \nOnce at /docs and the other at /documents.\n2. There is a race condition.  If the “/doc” context is started before the \ndocuments.war is deployed it will not be found until tomcat is restarted.\n\nIt does not seem unreasonable to want to have a war file auto deploy and \nspecify a <context> in the server.xml file.  I may have an application for \nwhich I wish to create files in the applications docBase and want to add \nparameters to the <context> (e.g. <realm>.\nAs I stated quite a few times, this \"bug\" will not be fixed.\nIf you are not satisfied with the current behavior, the best way to fix it is to\nsubmit a patch, and we\'ll consider it for inclusion.*** Bug 6941 has been marked as a duplicate of this bug. ***I have also observed this behavior. This probably could be considered more of a \nbug in the documentation than the code. The 4.0 on-line docs state you can \"set \n(the unpackWARS attribute of a <Host> element) to true if you want web \napplications that are deployed into this virtual host from a Web Application \nArchive (WAR) file to be unpacked into a disk directory structure.\" They also \nstate that \"(y)ou can nest one or more Context elements inside this Host \nelement, each representing a different web application associated with this \nvirtual host.\"\n\nAs to Context, \"(t)he <Context> element represents a web application, which is \nrun within a particular virtual host. Each web application is based on a Web \nApplication Archive (WAR) file, or a corresponding directory containing the \ncorresponding unpacked contents...\", and that\"(e)ach (<Context> element) MUST \nhave a unique context path, which is defined by the path attribute.\"\n\nThe docs don\'t say that before Tomcat unpacks any warfiles, it will first \nattempt to verify the context path of a <Context> element by checking for a \nweb.xml file in the corresponding webapp WEB-INF directories. It also doesn\'t \nstate that if it can\'t find the web.xml file in the context path directory \nreferenced by the <Context> element, it will shut down.\n\nIf anything, the desired behavior should be the opposite: unpack the warfiles, \nthen check the <Context> elements in server.xml against the appropriate \nweb.xml. That might be a little less irritating than not.\n\nPaulGarvie*** Bug 7527 has been marked as a duplicate of this bug. ***I strongly believe this is a problem. As an example, if I have a WAR file \nnamed \"MyAppl.war\", and I dont define anything about it in \"server.xml\", just \nplace the file in CATALINA_HOME/webapps, the file is automatically unpacked. \nBut in order to be able to get other servlet contexts, if I add the following \nline in the server.xml :\n\n<Context path=\"/MyAppl\"  docBase=\"MyAppl\" crossContext=\"true\"/>\n\nnow the WAR file is NOT automatically expanded. \n\nIn summary \"a WAR file is automatically expanded by Tomcat, but if I just want \nto enable crosscontext support, it will not be expanded automatically.\" Doesnt \nit sound like a bug?  Just because I want the crosscontext property enabled for \nthe application and I  add a line in server.xml I would not be able to \ndistribute my app as a WAR file, but would have to distribute it in expanded \nform?\n*** Bug 8036 has been marked as a duplicate of this bug. ****** Bug 8418 has been marked as a duplicate of this bug. ****** Bug 6739 has been marked as a duplicate of this bug. ***Dear Remy\n\nYou have my full sympathy about this problem, but there is a lot of confusion \noccurring.\n\nYou\'re being perfectly reasonable both in pointing out that this isn\'t a bug at \nall, but the designed behavior, and in suggesting that bug reporters instead \nsubmit a patch to change the behavior.\n\nThe problem is that many people who are experiencing this bug, and this applies \nto me, are not technically adept enough to propose such a change - is there any \nchance that you could revisit the stated design and , or would this then \ncontravene a specification?\n\nWhat I believe people want or need is to be able to start Tomcat *with* a \ncontext (e.g. \"MyApp\") defined in server.xml, and with a \"MyApp.war\" file in \nplace, but *without* the exploded \"MyApp\" webapp directory; in this scenario it \nwould be most excellent if Tomcat unpacked the WAR before alternatively \ndiscovering the absence of the declared context.\n\nWhat are your thoughts on this suggestion?\n\nTIA\n\nKind regards\nTim Cooke\nP.S. At present I run Tomcat 4.0.1.\nNo further behavior modifications will be made in Tomcat 4.1.x, so this won\'t be\naddressed.Improvements have been made to Tomcat 5.0 deployer, which should address this\nRFE. This will be in Tomcat 5.0.4.',?,RFE
6582,'SERVLETAPI: Sample code does not match behavior','Tomcat 5',Webapps:Examples,chris,dev,'The \"Source Code for Request Parameter Example\" link does \nnot show the correct source code for the sample servlet \nthat is installed.  This can be verified both by the behavior \nof the servlet and looking at the true sample source at\n\%CATALINA_HOME\%\\webapps\\examples\\WEB-INF\\classes\\RequestParamExample.java.Created attachment 9425\nPatch for TC4 to fix this bugCreated attachment 9426\nPatch for TC5 to fix this bugFixed in TC4 but needs jakarta-servletapi-5 karama to fix for TC5 which means\none of the spec team needs to commmit the patch.\n\nUpdating severity as discussed on tomcat-dev mailing list.Fixed now we have commit access to the examples in SVN.',?,DOCUMENTATION
9351,'IPv6 HTTP/1.1 requests not working','Tomcat 5',Unknown,jserna,dev,'The problem is in org.apache.catalina.connector.http.HttpProcessor the parsing \nof the Host header assumes that its format is:\n\n<host_name>[:port]\n\nwhere host_name mustn\'t contain any \':\' character.\n\nBut with IPv6 addresses (RFC 2736 - Format for literal IPv6 addresses in URL), \na valid address could be:\n\n[3ffe:3328:6:3::2]:80\n\nand so the code:\n\n---\n\n} else if (header.equals(DefaultHeaders.HOST_NAME)) {\n                  int n = value.indexOf(\':\');\n\n----\n\nwhich assumes \':\' only as port separator is not working.\n\nAdditional parsing must be added to this class in order to take into account \nIPv6 Addresses.\n\nJorge SernaCan you submit a patch on that topic, of course tested with J2SE 1.4, to \nsee if it actually works?\nA current workaround would be to use a host name resolving as an IPv6 \naddress (for example, I use localhost_ipv6 , which resolves to \"::1\"), but I \nnever tested it on Tomcat...I have developed no bug fix yet, but it shouldn\'t be very difficult to do it \n(it\'s a simple String parsing). As of now we\'re using a little workaround which \nis using names instead of IPv6 addresses, and it works fine.Created attachment 5762\npatch for org.apache.coyote.http11.Http11ProcessorCreated attachment 5763\ntest case for org.apache.coyote.http11.Http11ProcessorNo offense, but I think there is little market for IPv6 in TC right now. As\nsuch, it will not be ported in Tomcat 4.x. Thanks for the patch, anyway.I have found other problems of IPv6 HTTP/1.1 requests.\n\n\n\n\nWhen hotname is IPv6 address,\n\n\nHttpServletRequest#getRequestURL() and HttpServletResponse#sendRedirect() don\'t \nwork properly.\n\n\n\n\nI have developed additional patches,\n\n\nand I will post patches and test-cases.\n\n\n-  org.apache.coyote.tomcat4.CoyoteReques\n\n\n-  org.apache.coyote.tomcat5.CoyoteRequest\n\n\n-  org.apache.coyote.tomcat5.CoyoteResponset\n\n\n-  org.apache.catalina.util.URL\n\n\n-  org.apache.tomcat.util.net.URL\n\n\n\n\n\n\nexample of problems:\n\n\n  [Tomcat4 & 5]\n\n\n  When Host header is \"[3ffe:3328:6:3::2]:80\",\n\n\n  HttpServletRequest#getRequestURL() returns \"http://3ffe:3328:6:3::2:80/abc\".\n\n\n  Expected return-value was \"http://[3ffe:3328:6:3::2]:80/abc\".\n\n\n\n\n  [Tomcat4]\n\n\n  When Host header is \"[3ffe:3328:6:3::2]:80\",\n\n\n  HttpServletResponse#sendRedirect() fails to create Location header.\n\n\n  (catches IllegalArgumentException and set status SC_NOT_FOUND.)\n\n\n\n\n  [Tomcat5]\n\n\n  When Host header is \"[3ffe:3328:6:3::2]:80\",\n\n\n  HttpServletResponse#sendRedirect() sets \"http://3ffe:3328:6:3::2:80/abc/\" to \nLocation header.\n\n\n  Expected Location header was \"http://[3ffe:3328:6:3::2]:80/abc/\".\n\n\nCreated attachment 5788\npatch for org.apache.coyote.tomcat4.CoyoteRequesCreated attachment 5789\npatch for org.apache.coyote.tomcat5.CoyoteRequestCreated attachment 5790\norg.apache.coyote.tomcat5.CoyoteResponsetCreated attachment 5791\npatch for org.apache.tomcat.util.net.URLCreated attachment 5792\ntest case for org.apache.tomcat.util.net.URLCreated attachment 5793\npatch for org.apache.catalina.util.URLCreated attachment 5794\ntest case for org.apache.catalina.util.URLI\'ve posted all patches and test-cases I maked.\n\norg.apache.catalina.connector package has same problems,\nbut it was \"deprecated\" sp I have do nothing to it.\nYour patches still have bugs in them.  I\'ve committed changes to \no.a.t.u.net.URL (one of the less critical classes) based on a heavily modified \nversion of your patch.  You might want to review it to see some of the \nproblems, and re-submit fixed patches.I have reviewed comitted o.a.t.u.net.URL\nand I realize that I have misunderstanded URL#getHost()\'s sepecification.\n\"URL#getHost() returns IPv6 address enclosed in square brackets.\"\n\no.a.c.u.URL\'s patch I posted is invalid.\no.a.c.u.URL needs patch same with o.a.t.u.net.URL.\n\nCoyoteRequest\'s patch I posted is invalid.\nCoyoteRequest needs no patches.\n\nDoes ServletRequest#getServerName() also returns enclosed IPv6 address?\nIf it does,\n CoyoteResponse needs no patches,\n Http11Processor\'s patch I posted has to be fixed.\nCreated attachment 5798\nfixed patch for org.apache.coyote.http11.Http11Processor. (ServletRequest#getServerName() returns enclosed IPv6 address)Created attachment 5799\nfixed test case for org.apache.coyote.http11.Http11Processor. (serverName is enclosed IPv6 address)Created attachment 5800\nfixed test case for o.a.t.u.net.URL (getHost() returns enclosed IPv6 address)I have applied the patch to Http11Processor, thanks :)\nAs for o.a.c.u.URL, it does not seem to be used anymore, so I see no reason for\npatching it (t.u.net.URL).',?,BUG
10671,'Major issues with jsp:param in jsp:include and jsp:forward','Tomcat 5',Jasper,jessh,dev,'This is related to bug 9361, which I also filed, but I have now run across a \nnumber of more substantive, related issues.\n\nTomcat 4.1.3 (and 4.1.2 and I\'m not sure how far previously) take:\n  <jsp:include ....>\n    ...\n    <jsp:param name=\"foo\" value=\"<\%=bar\%>\"/>\n    ...\nand generate something like\n  JspEngine.include( ... + \"&foo=\" + java.net.URLEncoder.encode( bar ) ... );\nwhereas Tomcat 3.x did something like\n  JspEngine.include( ... + \"&foo=\" + bar ... );\n[Yes, I know the class is not actually \"JspEngine\", but you get the idea.]\n\nThis was apparently done to fix issues when bar.toString()\'s result contained \n&, =, or other special characters.\n\nUnfortunately, this change has a number of critical issues:\n  1) As per 9361, if \'bar\' is null, then this throws an exception, whereas most\n     every servlet engine around (including Tomcat 3.2.x and 3.3.x) do not.\n  2) If \'bar\' is not a String, then the JSP page will no longer compile,\n     whereas non-String variables could be used in this context previously and\n     in other JSP engines.\n  3) java.net.URLEncoder.encode() does not properly handle non-ASCII or at\n     least non-Latin characters.  One has to do something like get the string\n     bytes as per UTF8 then URLEncode the string formed from these bytes\n     (interpretting each byte as a char) -- or more efficiently do this all in\n     a single pass.  Thus the original intent of using URLEncoder.encode() is\n     not fully accomplished by the change anyway.\n\nAs it stands now, Tomcat 4.1.x seriously cripples jsp:param as it is commonly \nused.  If this is as per the JSP 1.2 spec, please point this out (though I\'d \nhave trouble believing this).\n\nI strongly suggest a single\n  String JspEngine.encode( Object obj )\nmethod that will return \"\" for a null object and otherwise to obj.toString(), \nUTF8 encode and URL encode this result.\n\nAs it is now, I suspect we were better off overall with the Tomcat 3.x \njsp:param code generation, i.e. a heck of a lot of big, real apps run just fine \non it without running afoul of URL encoding issues.I was going to file a bug regarding this, until I realized this was changed in\n4.1.x. So by default now (in 4.1.x) the behavior is to URLEncode the parameter\nvalues automatically?\n\nI ran into an issue with passing URLS as paramters where the invalid characters\n(for a url), when not escaped, would effectively \"hide\" any further parameters\nfrom being parsed. In ServletExec 3.1 the URLEncode step is automatically done.\nSo it sounds like this was also added to Tomcat 4.1.x?\n\nYes, the URLEncode bit was added to 4.1.x BUT as per my description above simply\ndoing this brings with it as many problems as it solves.\n\nThe UTF8 bit is necessary to handle non-ASCII (or at least non-Latin)\ncharacters, but just to handle normal accepted usages null and non-String object\nhandling must be added back in.There is a two argument version of java.net.URLEncoder.encode in j2sdk 1.4 that\nlet the encoding be specified as the 2nd argument.  I should probably use that,\nbut unfortunately that is not available in 1.3.We ran into URL encoding problems in one of our projects and found this at the \nW3C:\n\nhttp://www.w3.org/International/URLUTF8Encoder.java\n\nIt seems to do exactly what the new encode method in JDK 1.4 does.BTW, should this be _always_ UTF8 or shouldn\'t this be the value of the \ndocument-encoding of the specific page instead ? If we have a page served as \nISO-8859-1, then the URLencoding should as well encodes characters to its \nISO-8859-1 byte representation; if the page is UTF8, then we should serve \nURL-encode with UTF8. I assume, many browsers will run into problems \notherwise, because encoding is mixed in the same page ? One can always encode hyperlinks to UTF-8 bytes and then URLEncode them.  This\nalways results in ASCII without any special characters.  The issue is that the\ncode processing the link requests must know to expect UTF-8 encoded data.  The\nissue here is in making all of one\'s form submissions follow this as well (or\nusing POST for forms and handling POST and GET a bit differently).There is talk of calling 4.1.10 a final release, but yet this apparent spec \nviolation has not been fixed?!?The behavior in 4.1.11 will be identical to Tomcat 4.0.x. It is still unclear \nto me if this is a spec violation or not.*** Bug 9361 has been marked as a duplicate of this bug. ***I lately ran into ALMOUST the same URL encoding decoding problem.\nAs it seems no action is going to be taken I\'ll describe my situation so it\ncould help in the desition making.\n\nFirst I need to put ISO-8859-4 characters on the URL (I know it\'s bad design and\nthe next time I\'ll use underlying coding ;). For example the URL to be encoded\nis: \"folder.do?path=/Uusim/täpiline\".\n\nNow I use struts for createing the actual URL and so the URL is encoded in\nUTF-8. When tomcat decodes the request URL on the next step useing platform\ndefaul encodeing ISO-8859-4 I get different result.\n\nAs you all can see the problem could even be none of Tomcat\'s business but while\nfiguring about the solutions I came up with a little example that makes it\nTomcat\'s problem:\n\nLets assume that I encode the url with URLEncoder.encode(java.lang.String)\nmanually. Then struts will not find any unaceptable characters and leaves the\nURL alone (At least I hope so). Now I shouldn\'t have no problems with Tomcat\'s\ndecodeing method.\n\nBut the same problem comes up again when my application is distributed and the\nurl location happens to be on a different server with a different encodeing. Now\nwhen the different server happens to be out of my hands and so the encodeing\nremains different then I\'ll have to deal with the encoding problem on\napplication level and that\'s a bit stupid.\n\nSo my opinion is that the URL encodeing and decodeing should allways be done in\nUTF-8 encodeing like the \"World Wide Web Consortium\" recommends. And maybe\nintroduce a configuration parameter for extreme cases when some other server\nhandles this issue incorrectly.\n\nI\'d be happy to get any response concering this issue.\n\nPS! I also checked and think that this problem is currently up with both the\n4.1.27 and 5.0.12 server versions.We have not hit these issues with 4.1.24 they went away for us quite some 4.1.x\nreleases back.I agree that passing non-ISO-8859-1 characters (or whatever your platform \ndefault is) via <jsp:param> is broken in 4.1.27.\n\nA suggested work-around:\n\nWhile this work-around won\'t be suitable for all applications, it is handy \nwhere an included page (or a page that is always the target of a forward) \nwants to receive characters that would otherwise not work.\n\nBasically encode the value of the parameter into something that can be \nrepresented in ISO-8859-1 before passing it to <jsp:param>, and then do the \nreverse encoding in the called page. Using Java 1.4\'s URLEncoder.encode\n(string, \"UTF-8\") before giving the string to <jsp:param> is one such encoding \nthat does this.\n\nThis causes:\n[non ISO-8859-1 suitable string]\n  (encode using URLEncoder.encode(string, \"UTF-8\"))\n[string that can be represented in ISO-8859-1]\n  (pass to <jsp:include> or <jsp:forward> via <jsp:param>)\n  (Tomcat calls URLEncoder.encode(string))\n  (Tomcat calls the included or forwarded page)\n  (Tomcat calls URLEncoder.decode(string))\n[string that can be represented in ISO-8859-1]\n  (decode using URLDecoder.decode(string, \"UTF-8\"))\n[original string]\nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=31804\n \nCould someone please advise me on whether this Bug is fixed?\nBugzilla shows this bug to be filed under Tomcat 4.0 I am using Tomcat 5.0.28 \nand am having problems when using the jsp:param tag. I get tons of deprecation \nerrors.\n \nMy IDE is jbuilder 2005 and am using :\njava version \"1.4.2_05\"\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.4.2_05-b04) Java \nHotSpot(TM) Client VM (build 1.4.2_05-b04, mixed mode)\n\n \nany tips on whether this bugID is fixed for Tomcat 5.0.28 (or how could it be \nfixed OR a workaround ) would be greatly appreciated.\nsorry. prior post had the wrong URL the correct one is : \nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=10671Jess, I\'m closing this item.  Please reopen if and only if it\'s relevant in \nTomcat 5.5.6.I *believe* this has been fixed in recent 4.1, 5.0, and 5.5 releases -- at least\nwe\'ve not been bitten by it recently.  I\'ve not had a chance to go looking for\nit lately either.  If it is still an issue in 5.5 someone will re-open.',?,BUG
11740,'Errors on startup during tomcat','Tomcat 5',Catalina,prasad.subramanian,dev,'When you startup Tomcat 5 there is lot errors related to XML schema in\ncatalina.out or console depending upon the startup srcipt used.\n=====================================\nHere is a sample\nAug 14, 2002 12:52:37 PM org.apache.commons.digester.Digester warning\nSEVERE: Parse Warning at line 1981 column 20: schema_reference.4: Failed\nto read schema document \'null\', because 1) could not find the document;\n2) the document could not be read; 3) the root element of the document\nis not <xsd:schema>.\norg.xml.sax.SAXParseException: schema_reference.4: Failed to read schema\ndocument \'null\', because 1) could not find the document; 2) the document\ncould not be read; 3) the root element of the document is not <xsd:schema>.\n      at\norg.apache.xerces.util.ErrorHandlerWrapper.createSAXParseException(ErrorHandlerWrapper.java:232)\n      at\norg.apache.xerces.util.ErrorHandlerWrapper.warning(ErrorHandlerWrapper.java:141)\n      at\norg.apache.xerces.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:358)\n      at\norg.apache.xerces.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:296)\n      at\norg.apache.xerces.impl.xs.traversers.XSDHandler.reportSchemaWarning(XSDHandler.java:1841)\n      at\norg.apache.xerces.impl.xs.traversers.XSDHandler.getSchema(XSDHandler.java:1298)\n      at\norg.apache.xerces.impl.xs.traversers.XSDHandler.parseSchema(XSDHandler.java:392)\n      at\norg.apache.xerces.impl.xs.traversers.XSDHandler.parseSchema(XSDHandler.java:381)\n      at\norg.apache.xerces.impl.xs.XMLSchemaValidator.parseSchema(XMLSchemaValidator.java:2250)\n      at\norg.apache.xerces.impl.xs.XMLSchemaValidator.findSchemaGrammar(XMLSchemaValidator.java:2178)\n      at\norg.apache.xerces.impl.xs.XMLSchemaValidator.handleStartElement(XMLSchemaValidator.java:1724)\n      at\norg.apache.xerces.impl.xs.XMLSchemaValidator.startElement(XMLSchemaValidator.java:568)\n      at\norg.apache.xerces.impl.XMLNamespaceBinder.handleStartElement(XMLNamespaceBinder.java:832)\n      at\norg.apache.xerces.impl.XMLNamespaceBinder.startElement(XMLNamespaceBinder.java:568)\n      at\norg.apache.xerces.impl.dtd.XMLDTDValidator.startElement(XMLDTDValidator.java:796)\n      at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanStartElement(XMLDocumentFragmentScannerImpl.java:752)\n      at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(XMLDocumentFragmentScannerImpl.java:1454)\n      at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:333)\n      at\norg.apache.xerces.parsers.StandardParserConfiguration.parse(StandardParserConfiguration.java:529)\n      at\norg.apache.xerces.parsers.StandardParserConfiguration.parse(StandardParserConfiguration.java:585)\n      at org.apache.xerces.parsers.XMLParser.parse(XMLParser.java:147)\n      at\norg.apache.xerces.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1148)\n      at org.apache.commons.digester.Digester.parse(Digester.java:1514)\n      at\norg.apache.catalina.startup.ContextConfig.tldScanStream(ContextConfig.java:1050)\n      at\norg.apache.catalina.startup.ContextConfig.tldScanJar(ContextConfig.java:994)\n      at\norg.apache.catalina.startup.ContextConfig.tldScan(ContextConfig.java:941)\n      at\norg.apache.catalina.startup.ContextConfig.start(ContextConfig.java:720)\n      at\norg.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:247)\n      at\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)\n      at\norg.apache.catalina.core.StandardContext.start(StandardContext.java:3493)\n      at\norg.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:821)\n      at\norg.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:807)\n      at\norg.apache.catalina.core.StandardHost.addChild(StandardHost.java:579)\n      at\norg.apache.catalina.core.StandardHostDeployer.addChild(StandardHostDeployer.java:617)\n      at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n      at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n      at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n      at java.lang.reflect.Method.invoke(Method.java:324)\n      at\norg.apache.commons.beanutils.MethodUtils.invokeMethod(MethodUtils.java:228)\n      at org.apache.commons.digester.SetNextRule.end(SetNextRule.java:260)\n      at\norg.apache.commons.digester.Digester.endElement(Digester.java:1036)\n      at\norg.apache.xerces.parsers.AbstractSAXParser.endElement(AbstractSAXParser.java:559)\n      at\norg.apache.xerces.impl.XMLNamespaceBinder.endElement(XMLNamespaceBinder.java:646)\n      at\norg.apache.xerces.impl.dtd.XMLDTDValidator.handleEndElement(XMLDTDValidator.java:2978)\n      at\norg.apache.xerces.impl.dtd.XMLDTDValidator.endElement(XMLDTDValidator.java:918)\n      at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.handleEndElement(XMLDocumentFragmentScannerImpl.java:1145)\n      at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanEndElement(XMLDocumentFragmentScannerImpl.java:988)\n      at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(XMLDocumentFragmentScannerImpl.java:1446)\n      at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:333)\n      at\norg.apache.xerces.parsers.StandardParserConfiguration.parse(StandardParserConfiguration.java:529)\n      at\norg.apache.xerces.parsers.StandardParserConfiguration.parse(StandardParserConfiguration.java:585)\n      at org.apache.xerces.parsers.XMLParser.parse(XMLParser.java:147)\n      at\norg.apache.xerces.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1148)\n      at org.apache.commons.digester.Digester.parse(Digester.java:1514)\n      at\norg.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:423)\n      at\norg.apache.catalina.core.StandardHost.install(StandardHost.java:803)\n      at\norg.apache.catalina.startup.HostConfig.deployDescriptors(HostConfig.java:452)\n      at\norg.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:409)\n      at org.apache.catalina.startup.HostConfig.start(HostConfig.java:879)\n      at\norg.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:368)\n      at\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)\n      at\norg.apache.catalina.core.ContainerBase.start(ContainerBase.java:1196)\n      at\norg.apache.catalina.core.StandardHost.start(StandardHost.java:738)\n      at\norg.apache.catalina.core.ContainerBase.start(ContainerBase.java:1188)\n      at\norg.apache.catalina.core.StandardEngine.start(StandardEngine.java:347)\n      at\norg.apache.catalina.core.StandardService.start(StandardService.java:497)\n      at\norg.apache.catalina.core.StandardServer.start(StandardServer.java:2231)\n      at org.apache.catalina.startup.Catalina.start(Catalina.java:516)\n      at org.apache.catalina.startup.Catalina.execute(Catalina.java:402)\n      at org.apache.catalina.startup.Catalina.process(Catalina.java:180)\n      at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n      at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n      at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n      at java.lang.reflect.Method.invoke(Method.java:324)\n      at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:203)',?,BUG
11742,'jsp:attribute with a non string body','Tomcat 5',Jasper,prasad.subramanian,dev,'If we have a tag that has an attribute that accepts non -string objects as\nvalues,using <jsp:attribute> to supply values to the attribute throws an\nexception. This is a complie time error , this happens because the body of the\njsp:attribute is evaluated ansd converted to a string and then assigned to the\nsetter method of the tag handler which in turn takes in a argument of type other\nthan string.\nThe body of the jsp:attribute contains a expression.\n\nHere is the JSP:\n\n<!-- This JSP tests the use of jsp:attribute and jsp:body with a Custom tag\nimplementing body support -->\n\n<\%@taglib uri=\"/WEB-INF/JSPAttTL.tld\" prefix=\"att\" \%>\n<\%@page import=\"java.util.*\" \%>\n<jsp:useBean id=\"depts\" class=\"tlitertag.OrgList\" />\n<att:list name=\"dept\"  >\n\t<jsp:attribute>\n\t\t${depts.organization}\n\t</jsp:attribute>\n\n    <jsp:body>\n      <\%=pageContext.getAttribute(\"dept\") \%>\n    </jsp:body>\n</att:list>\n========\nHere entity accepts a value of type java.util.ArrayList and organization is a\nproperty of type ArrayListOops...\nThe JSp has a small problem:\nit should read as \n<\%@taglib uri=\"/WEB-INF/JSPAttTL.tld\" prefix=\"att\" \%>\n<\%@page import=\"java.util.*\" \%>\n<jsp:useBean id=\"depts\" class=\"tlitertag.OrgList\" />\n<att:list name=\"dept\"  >\n<jsp:attribute name=\"entity\" >\n${depts.organization}\n\t</jsp:attribute>\n\n<jsp:body>\n<\%=pageContext.getAttribute(\"dept\") \%>\n</jsp:body>\n</att:list>\n\nThe problem nevertheless exists\n\nFixed.\n',?,BUG
11829,'Unable to use Property editors with jsp:attribute','Tomcat 5',Jasper,prasad.subramanian,dev,'This happens while using jsp:setProperty.\nSection 2.13.1 of the JSP Spec says that a property editor can be used for\nimplict concversion od the property values assigned via jsp:setProperty.\n\nI have a property editor defined for  a Date . \nI use jsp:attribute to set the value of the Date via jsp:setProperty, and an \nIllegal Argument exception is thrown.\nHere is the sample jsp:\n=====================\n<!-- This JSP tests to see if a Property Editor works fine with jsp:attribute --\n>\n<\%@page contentType=\"text/html\"\%>\n\n<html>\n<head><title>PosPETestDate</title></head>\n<body>\n<!-- This JSP is used to test the PropertyEditor.setAstext() method -->\n\n <jsp:useBean id=\"peTest\"  class=\"bean.propeditor.PETest\" />\n\n\n <jsp:setProperty name=\"peTest\"  property=\"dateOfBirth\" >\n        <jsp:attribute name=\"value\">\n          01.02.2001\n         </jsp:attribute>\n </jsp:setProperty>\n\n\nThe Date of Birth is : <jsp:getProperty name =\"peTest\" property=\"dateOfBirth\" />\n</body>\n</html>\n==========================\n\nThis works fine if the value of the date is given as an XML attribute.Fixed.\n',?,BUG
11883,'Unable to use Dynamic attributes','Tomcat 5',' JSP API',prasad.subramanian,dev,'The JSP spec says \" A tag handler should implement the DynamicAttributes\ninterface to be able to accept dynamic attributes\"\n\nHowever ,when a tag handler that implements DynamicAttributes  is compiled , an\nerror is thrown :\n\nTag Handler <<name>> should be declared abstract  ;it does not define\nsetDynamicAttribute(java.lang.String,java.lang.String,java.lang.Object) in <<name>>\n\nThis causes a problem as according to the spec the container would invoke the\nsetDynamic Attributes method at runtime.Fixed by Mark Roth',?,BUG
11884,'getParent in a SimpleTag implementation returns a Tag','Tomcat 5',' JSP API',prasad.subramanian,dev,'If getparent is called within a tag handler implementing SimpleTag , an instance\nof javax.servlet.jsp.tagext.Tag is returned.\nAccording to the spec javax.servlet.jsp.tagext.Tag adapter should be returnedFixed by Mark Roth pending verification',?,BUG
12003,'Unable t use jsp:include in a fragment','Tomcat 5',Jasper,prasad.subramanian,dev,'If a jsp:include is used in a Fragment ( body of a simple tag handler) with \nbodycontent JSP a compilation error is thrown.\n\n==============================\norg.apache.jasper.JasperException: Unable to compile class for JSP\n\nAn error occurred at line: -1 in the jsp file: null\n\nGenerated servlet error:\n    [javac] Compiling 1 source file\n/home/ps125818/locus/tomcat5-src/jakarta-tomcat-\n5/dist/work/Standalone/localhost/jsp20-\ntests/jsp2/simpletagspos/STBodyInclActionPos_jsp.java:112: include\n(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse,ja\nva.lang.String,javax.servlet.jsp.JspWriter,boolean) in \norg.apache.jasper.runtime.JspRuntimeLibrary cannot be applied to \n(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse,ja\nva.lang.String,java.io.Writer,boolean)\n      JspRuntimeLibrary.include(request, response, \"$inclFile\", out, false);\n                       ^\n1 error\n\n\n\tat org.apache.jasper.compiler.DefaultErrorHandler.javacError\n(DefaultErrorHandler.java:125)\n\tat org.apache.jasper.compiler.ErrorDispatcher.javacError\n(ErrorDispatcher.java:293)\n\tat org.apache.jasper.compiler.Compiler.generateClass(Compiler.java:364)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:382)\n\tat org.apache.jasper.JspCompilationContext.compile\n(JspCompilationContext.java:552)\n\tat org.apache.jasper.servlet.JspServletWrapper.service\n(JspServletWrapper.java:241)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile\n(JspServlet.java:289)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:247)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:263)\n\tat \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:191)\n\tat \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2487)\n\tat org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:180)\n\tat \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n\tat org.apache.catalina.valves.ErrorDispatcherValve.invoke\n(ErrorDispatcherValve.java:170)\n\tat \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:171)\n\tat \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:174)\n\tat \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service\n(CoyoteAdapter.java:223)\n\tat org.apache.coyote.http11.Http11Processor.process\n(Http11Processor.java:405)\n\tat \norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio\nn(Http11Protocol.java:380)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java:508)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:533)\n\tat java.lang.Thread.run(Thread.java:536)\n\n\n\n--------------------------------------------------------------------------------Fixed.\n',?,BUG
12020,'Using a name-from-attribute in the variable diirective in a tag file gives an error','Tomcat 5',Jasper,prasad.subramanian,dev,'If a tag file has a variable directive that has a \"name-from-attribute\" as an\nattribute ,a translation time exception thrown.\nHere is the tag file:\n=============\n\n\n<\%@tag dynamic-attributes=\"false\" import=\"java.io.*\" isScriptingEnabled=\"true\" \%>\n\n<\%@attribute name=\"id\" required=\"true\" rtexprvalue=\"false\" \%>\n<\%@attribute name=\"frag1\" fragment=\"true\" required=\"true\"  \%>\n<\%@variable name-from-attribute=\"url\" scope=\"AT_BEGIN\" \%>\n<jsp:invoke fragment=\"frag1\"/>\n<jsp:doBody/>\n\n\n\n=============\norg.apache.jasper.JasperException: /WEB-INF/tags/tagfilepos/MySimpleTag.tag(6,0)\nVariable directive: Invalid attribute, name-from-attribute\n\tat\norg.apache.jasper.compiler.DefaultErrorHandler.jspError(DefaultErrorHandler.java:95)\n\tat org.apache.jasper.compiler.ErrorDispatcher.dispatch(ErrorDispatcher.java:440)\n\tat org.apache.jasper.compiler.ErrorDispatcher.jspError(ErrorDispatcher.java:219)\n\tat org.apache.jasper.compiler.JspUtil.checkAttributes(JspUtil.java:383)\n\tat\norg.apache.jasper.compiler.TagFileProcessor$TagFileVisitor.visit(TagFileProcessor.java:213)\n\tat org.apache.jasper.compiler.Node$VariableDirective.accept(Node.java:511)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1543)\n\tat org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:1585)\n\tat org.apache.jasper.compiler.Node$Visitor.visit(Node.java:1591)\n\tat org.apache.jasper.compiler.Node$Root.accept(Node.java:334)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1543)\n\tat\norg.apache.jasper.compiler.TagFileProcessor.parseTagFile(TagFileProcessor.java:326)\n\tat\norg.apache.jasper.compiler.TagLibraryInfoImpl.createTagFileInfo(TagLibraryInfoImpl.java:464)\n\tat\norg.apache.jasper.compiler.TagLibraryInfoImpl.parseTLD(TagLibraryInfoImpl.java:289)\n\tat org.apache.jasper.compiler.TagLibraryInfoImpl.(TagLibraryInfoImpl.java:195)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective(Parser.java:406)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parse(ParserController.java:210)\n\tat org.apache.jasper.compiler.ParserController.parse(ParserController.java:160)\n\tat org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:257)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:381)\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:552)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:241)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:289)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:247)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:260)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2505)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat\norg.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:171)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:223)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:405)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:380)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:508)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:533)\n\tat java.lang.Thread.run(Thread.java:536)',?,BUG
12046,'Reloading of tag files when modified','Tomcat 5',Jasper,prasad.subramanian,dev,'If a jsp  ( foo.jsp) refers to a tag defined by a tag file (footag.tag) , and\nfootag.tag is modified after foo.jsp has been compiled ,the footag.tag is not\nrecompiled and loaded again.\nThe foo.jsp needs to be recompiled again for these changes to take effect.',?,IMPROVEMENT
12088,'When a SkipPageException is thrown from a tag  the JSP returns a HTTP500 ( as the exception is wrapped with a Servlet Exception)','Tomcat 5',Jasper,prasad.subramanian,dev,'Lets say we have a JSP that includes a JSP that has a simple tag handler which\nthrows a SkipPage Exception based upon a certain condition.\nIn this case the the calling JSP returns a HTTP 500 ( Servlet Exception wrapping\nthe SkipPage Exception)\n\nThis defeats the purpose of using the SkipPage Exception to skip evaluationof\nthe rest of the page and continiue with the calling page.',?,BUG
12107,'ContentType header value is set as null while using taglib/include directive','Tomcat 5',Jasper,prasad.subramanian,dev,'If a JSP page has  an include directive or a taglib directive ,  then the\nresponse header for ContentType  is set as null. It should be text/html\"\n\nThis causes the XXML style comments and the HTML elemnst also to be displayed in\nbrowsers like Netscape. \nHowever the display is perfect in IE.\n\nAlso having a page directive alone does not cause the header ContentType to be\nset to null.To reproduce :\nWrite  a small JSP with a taglib directive \nEnable the requestdumpervalve in localhost to capture the headers.The content is null only when a tag file is used.  It is correct for a page that\nhas an include directive or taglib directive for a classic tag.',?,OTHER
12109,'Using functions in EL causes a NPE to be thrown in the GenerateELFunctionMap.java','Tomcat 5',Jasper,prasad.subramanian,dev,'If a JSP uses a functions defined by EL a translation time NPE is thrown.\n==================\nrg.apache.jasper.JasperException: Unable to compile class for JSP\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:558)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:241)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:289)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:247)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:260)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2505)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat\norg.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:171)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.valves.RequestDumperValve.invoke(RequestDumperValve.java:221)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:223)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:405)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:380)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:508)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:533)\n\tat java.lang.Thread.run(Thread.java:536)\n\nroot cause\n\njava.lang.NullPointerException\n\tat org.apache.jasper.compiler.Generator.generateELFunctionMap(Generator.java:593)\n\tat\norg.apache.jasper.compiler.Generator.genPreambleStaticInitializers(Generator.java:391)\n\tat org.apache.jasper.compiler.Generator.generatePreamble(Generator.java:471)\n\tat org.apache.jasper.compiler.Generator.generate(Generator.java:2868)\n\tat org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:279)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:381)\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:552)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:241)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:289)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:247)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:260)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2505)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat\norg.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:171)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.valves.RequestDumperValve.invoke(RequestDumperValve.java:221)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:223)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:405)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:380)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:508)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:533)\n\tat java.lang.Thread.run(Thread.java:536)\n\n===================Fixed.\n',?,BUG
12135,'servlets-examples application does not get started up','Tomcat 5',Webapps:Examples,prasad.subramanian,dev,'This happens because the web.xml contains a mapping for a non existent tld with\nWEB-INF/jsp .This was fixed in Tomcat CVS.',?,DOCUMENTATION
12147,'session logout() method does not invalidate the session','Tomcat 5',Catalina,jian.cai,dev,'After HttpSession.logout()was called, the session is still active. \nThe BASIC authentication did not logout the user and ask passwords when the \nlogout() method had been called.\n\nThe following is the code to call logout()\n\n     Debug.println(\"LogoutHandler: perform\");\n\n        HttpSession session = (HttpSession)signoutevent.get(\"session\");\n        if (session!=null)\n        {\n            Debug.println(\"current session id:\"+ session.getId());\n            Debug.println(\"current session status:\" + session.getCreationTime\n()); \n            session.logout();\n            \n            Debug.println(\"new session id:\"+ session.getId());\n            Debug.println(\"new session status:\" + session.isNew());\n            Debug.println(\"new session status:\" + session.getCreationTime());\n         \n        }\n\nThe folloing is the debug message:\n\nLogoutHandler: perform\ncurrent session id:F1C4C622A113E256274753A6B11631A4\ncurrent session status:1030582292752\nnew session id:F1C4C622A113E256274753A6B11631A4\nnew session status:false\nnew session status:1030582292752\n\nThe following is the security config\n\n<security-constraint>\n      <display-name>Security For Container Login</display-name>\n      <web-resource-collection>\n         <web-resource-name>Protected Area</web-resource-name>\n         <url-pattern>/control/signin_cfb</url-pattern>\n\t <http-method>DELETE</http-method>\n         <http-method>GET</http-method>\n         <http-method>POST</http-method>\n\t <http-method>PUT</http-method>\n      </web-resource-collection>\n      <auth-constraint>\n         <role-name>tomcat</role-name>\n\t <role-name>manager</role-name>\n\t <role-name>engineer</role-name>\n      </auth-constraint>\n    </security-constraint>Hi.  \"Basic Authentication\" works by challening the browswer when a protected \nresource is requested.  Thereafter, the browser supplies the\nusername/password/domain with every subsequent request.  Esentially the browser\nlogs in everytime a request is made.  Therefore, the logout() method cannot\ncause the user to get a \"login dialog.\"\n\nWhen using \"Basic Authentication\", calling logout() clears the user\'s session. \nIf using SingleSignOn, then all the users sessions are cleared.',?,OTHER
12201,'Problme defining values for type element in attributes of  custom actions','Tomcat 5',Jasper,prasad.subramanian,dev,'If the <type> element of an attribute belonging to a Custom Attribute is\nspecified as \"boolean\" then a translation exception occurs which says :\nUnknown attribute type (boolean) for attribute test\n\nThis happens with the JSTL tag <c:when>\n\nThis also happens when a attribute has \"String\" defined as type.Fixed.\nProblem occurred with *any* primitive type specified with the <type> subelement\nof the <attribute> element, not just with \"boolean\", because we were passing the\ntype string to Class.forName() in order to determine an attribute\'s expected\ntype. Of course, Class.forName() will fail for any primitive types.\nAdded special treatment for primitive types, which determines the Class object\nfor a primitive type by appending \".class\" to the keyword of the primitive type\n(e.g., \"boolean.class\").',?,BUG
12269,'body-content attribute of tag directive needs to be compared in a case insensitive manner','Tomcat 5',Jasper,prasad.subramanian,dev,'In the TagFileProcessor.java the contents of the \"body-content\" attribute of \nthe tag directive in a tag file are compared with the capitalized version of \nthe valid values ( Values from TagInfo.java) .\nThey need to be compared in a case \\-insensitive manner',?,BUG
12282,'NPE thrown when a tag defined by a tag file is specified as a fragment in the attribute of  a tag defined by tag file','Tomcat 5',Jasper,prasad.subramanian,dev,'Lets take a tag defined by a tag file.This tag would take in an attribute of\ntype fragment. The fragment would consist of another tag . This tag would also\nbe defined by a tag file.\nIn such a case a NPE is thrown.\n\n<tf:outertag >\n  <jsp:attribute name=\"frag\">\n    <tf:innertag />\n   </jsp:attribute>\n</tf:outertag>\n\nwhere innertag and outertag are tags defined by tag files.\n\n===================\norg.apache.jasper.JasperException: Unable to compile class for JSP\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:558)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:270)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:289)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:247)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:260)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2505)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat\norg.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:171)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:223)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:405)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:380)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:508)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:533)\n\tat java.lang.Thread.run(Thread.java:536)\n\nroot cause\n\njava.lang.NullPointerException\n\tat java.beans.Introspector.findExplicitBeanInfo(Introspector.java:380)\n\tat java.beans.Introspector.(Introspector.java:331)\n\tat java.beans.Introspector.getBeanInfo(Introspector.java:132)\n\tat org.apache.jasper.compiler.Generator$TagHandlerInfo.(Generator.java:3235)\n\tat org.apache.jasper.compiler.Generator$GenerateVisitor.visit(Generator.java:1470)\n\tat org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1021)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1543)\n\tat org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:1585)\n\tat\norg.apache.jasper.compiler.Generator$GenerateVisitor.generateJspFragment(Generator.java:2675)\n\tat\norg.apache.jasper.compiler.Generator$GenerateVisitor.generateNamedAttributeJspFragment(Generator.java:2748)\n\tat\norg.apache.jasper.compiler.Generator$GenerateVisitor.generateSetters(Generator.java:2486)\n\tat\norg.apache.jasper.compiler.Generator$GenerateVisitor.generateCustomDoTag(Generator.java:2176)\n\tat org.apache.jasper.compiler.Generator$GenerateVisitor.visit(Generator.java:1539)\n\tat org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1021)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1543)\n\tat org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:1585)\n\tat org.apache.jasper.compiler.Node$Visitor.visit(Node.java:1591)\n\tat org.apache.jasper.compiler.Node$Root.accept(Node.java:334)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1543)\n\tat org.apache.jasper.compiler.Generator.generate(Generator.java:2888)\n\tat org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:279)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:381)\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:552)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:270)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:289)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:247)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:260)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2505)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat\norg.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:171)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:223)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:405)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:380)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:508)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:533)\n\tat java.lang.Thread.run(Thread.java:536)Fixed.\n',?,BUG
12283,'If a tag implementing SimpleTag is invoked within a tag file a NPE is thrown','Tomcat 5',Jasper,prasad.subramanian,dev,'A tag file invokes a tag that implements SimpleTag.\nThis causes a NPE to be thrown at translation.\n====================\nThis is the JSP file\n<!-- This JSP calls a tag defined by a tag file that calls a Simple Tag that\nreturns a SkipPageException -->\n\n<\%@taglib uri=\"/TagFile\" prefix=\"tf\" \%>\n\nThis is the template text before the tag\n\n<tf:NestSTEx start=\"0\" end=\"10\" />\n\nThis is the template text after the tag\n=======================================\nThis is the tag file for NestSTEx\n========================================\n\n<!-- The tag file defines a tag that calls a Simple Tag that returns a SKIP_PAGE -->\n<\%@tag dynamic-attributes=\"false\" isELEnabled=\"true\" isScriptingEnabled=\"true\" \%>\n<\%@taglib uri=\"/SimpleTaglib\" prefix=\"st\" \%>\n<\%@attribute name=\"start\" type=\"integer\" rtexprvalue=\"false\" \%>\n<\%@attribute name=\"end\" type=\"integer\" rtexprvalue=\"false\" \%>\n\nThis is the template text in the body of the tag file\n\n<st:simpleEx start=\"10\" end=\"0\" >\n\tTemplate text here \n</st:simpleEx>\n\n\nThis is the text after the inclusion of the tag \n<jsp:doBody/>\n\n===================================================Fixed.\n(Notice that the fact that the SimpleTag was throwing a SkipPageException was\nirrelevant for this bug.)',?,BUG
12319,'Compile Error when a Classic Tag is nested in the jsp:attribute of a Simple Tag','Tomcat 5',Jasper,prasad.subramanian,dev,'Lets take the case :\n<st:simpleTag att1=\"var\" >\n   <jsp:attribute name=\"param\" >--------------------------------------------------------------------------------\n\nLets take the case :\n<st:simpleTag att1=\"var\" >\n   <jsp:attribute name=\"param\" >\n      <ct:classicTag var=\"name\" />\n   </jsp:attribute>\n\n  <jsp:body>\n    <st:simpleTag1 att2=\"${var}\" >\n      <jsp:attribute name=\"param1\" >\n           Somevalue \n      </jsp:attribute>\n     <jsp:body>\n        <ct:classicTag1 var1=\"name1\" >\n        .....\n      </jsp:body>\n     </st:simpleTag1>\n   </jsp:body>\n  </st:simpleTag>\n===============================================\nWhen a jsp like this gets translated there are couple of \"return;\" statement \ninside the public boolean invokex (where x=0,1,2) methods.\nThis causes a compilation error.\n\n\n*** Bug 12318 has been marked as a duplicate of this bug. ***Fixed.\n',?,BUG
12321,'StackOverflow Exception when a tag defined by a tag file is called within a tag file','Tomcat 5',Jasper,prasad.subramanian,dev,'If a tag file invokes a another tag defined by a tag file within the same sub-\ndirectory under WEB-INF/tags AND the taglib directive uses an Implicit Tag \nLibrary a java.lang.StackOverflowException occurs.\n\n===========================================\njavax.servlet.ServletException\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:248)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:247)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:260)\n\tat \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:191)\n\tat \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke\n(AuthenticatorBase.java:474)\n\tat \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2505)\n\tat org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:180)\n\tat \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n\tat org.apache.catalina.valves.ErrorDispatcherValve.invoke\n(ErrorDispatcherValve.java:170)\n\tat \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:171)\n\tat \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:174)\n\tat \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service\n(CoyoteAdapter.java:223)\n\tat org.apache.coyote.http11.Http11Processor.process\n(Http11Processor.java:405)\n\tat \norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio\nn(Http11Protocol.java:380)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java:508)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:533)\n\tat java.lang.Thread.run(Thread.java:536)\n\n\nroot cause \n\njava.lang.StackOverflowError\n\tat java.io.File.(File.java:266)\n\tat org.apache.naming.resources.FileDirContext.file\n(FileDirContext.java:857)\n\tat org.apache.naming.resources.FileDirContext.listBindings\n(FileDirContext.java:361)\n\tat org.apache.naming.resources.ProxyDirContext.listBindings\n(ProxyDirContext.java:523)\n\tat org.apache.catalina.core.ApplicationContext.listCollectionPaths\n(ApplicationContext.java:1120)\n\tat org.apache.catalina.core.ApplicationContext.getResourcePathsInternal\n(ApplicationContext.java:739)\n\tat org.apache.catalina.core.ApplicationContext.getResourcePaths\n(ApplicationContext.java:721)\n\tat org.apache.catalina.core.ApplicationContextFacade.getResourcePaths\n(ApplicationContextFacade.java:158)\n\tat org.apache.jasper.JspCompilationContext.getResourcePaths\n(JspCompilationContext.java:270)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:113)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\tat org.apache.jasper.compiler.TagFileProcessor.parseTagFile\n(TagFileProcessor.java:316)\n\tat org.apache.jasper.compiler.ImplicitTagLibraryInfo.\n(ImplicitTagLibraryInfo.java:126)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective\n(Parser.java:412)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:457)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1384)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:149)\n\tat org.apache.jasper.compiler.ParserController.parseFile\n(ParserController.java:234)\n\tat org.apache.jasper.compiler.ParserController.parseTagFile\n(ParserController.java:185)\n\n\n\n--------------------------------------------------------------------------------\n\nApache Tomcat/5.0Fixed.\n',?,BUG
12343,'Dynamic Attributes specified via jsp:attribute not recognized if specified as body content','Tomcat 5',Jasper,prasad.subramanian,dev,'If a tag is declared to accept Dynamic Attributes ,and the attributes are\nspecified as body to <jsp:attribute> tags,the container does not seem to\nrecognize them\nThis happens in cases where the tag is either a Simple tag or a Classic tag.Fixed.\n',?,BUG
12381,'Mangling file names not unique','Tomcat 5',Jasper,steve.downey,dev,'If the file name doesn\'t start with a valid java identifier start character, a \n_ is prepended. Unfortunately, _ is a valid java identifier start character. \nSo, for example, 0.jsp and _0.jsp, will both be mapped to _0_jsp.java.  \n \nIn general, if _ is to be used as an escape character, _ needs to be escaped \nitself.Created attachment 2964\nfixes mangling to handle \'_\' as the escape charThe fix doesn\'t quite fix everything. For example, the jsp files \"a(.jsp\" and \na_00028.jsp will be mapped to the same java class file. \n \nThe attached patch mangles all non-valid characters plus \'_\'. It also shortens \nthe mangled sequence. Chars range in value from \\u0000 to \\uFFFF, so only 4 \nhex digits are required, not 5. The total string length is 5 instead of 6. \n \n ',?,BUG
12393,'Compile time error if passing EL as argument to property attribute','Tomcat 5',Jasper,prasad.subramanian,dev,'The following compile time error occurs when a JSP has a set property that has\nan EL expression supplying  a value to the \"value\" attribute of the jsp:property\naction.\n\nAn error occurred at line: 15 in the jsp file: /jsp2/jspelpos/ELOperatorCompPos.jsp\n\nGenerated servlet error:\n    [javac] Compili\nng 1 source file\n/home/ps125818/locus/tomcat5-src/jakarta-tomcat-5/dist/work/Standalone/localhost/tcatjsp2-tests/jsp2/jspelpos/ELOperatorCompPos_jsp.java:87:\nhandleSetPropertyExpression(java.lang.Object,java.lang.String,java.lang.String,javax.servlet.jsp.PageContext,javax.servlet.jsp.el.VariableResolver,javax.servlet.jsp.el.FunctionMapper)\nin org.apache.jasper.runtime.JspRuntimeLibrary cannot be applied to\n(java.lang.Object,java.lang.String,java.lang.String,javax.servlet.jsp.PageContext,javax.servlet.jsp.PageContext,org.apache.jsp.ELOperatorCompPos_jsp)\n     \nJspRuntimeLibrary.handleSetPropertyExpression(pageContext.findAttribute(\"cust\"),\n\"firstName\", \"${list[1].firstName}\", pageContext, pageContext, this );\n                       ^\n1 error\n\n\n\tat\norg.apache.jasper.compiler.DefaultErrorHandler.javacError(DefaultErrorHandler.java:125)\n\tat org.apache.jasper.compiler.ErrorDispatcher.javacError(ErrorDispatcher.java:293)\n\tat org.apache.jasper.compiler.Compiler.generateClass(Compiler.java:364)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:382)\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:553)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:270)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:289)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:247)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:260)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2505)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat\norg.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:171)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:223)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:405)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:380)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:508)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:533)\n\tat java.lang.Thread.run(Thread.java:536)\n============\nHere is the JSP:\n\nThis JSP demonstrates the use of \"[]\" and \".\" operators to access methods and\nproperties via EL\n\nThe bean is an ArrayList of classes of type Customer. <br>\nEach Customer has the following properties:\nid<br>\nFirst Name <br>\nLast Name <br>\nSex<br>\nThe idea is to demonstrate the access of the Customer peroperties using the EL. <br>\n\n\n<jsp:useBean id=\"list\" class=\"misc.CustomerList\" />\n\n<jsp:useBean id=\"cust\" class=\"misc.Customer\" />\n\n<jsp:setProperty name=\"cust\" property=\"firstName\" value=\"${list[1].firstName}\" />\n\nThe customer\'s first name is ${cust.firstName}\n\n\n\n\n\nThe first Name of the First Customer : ${list[0].firstName} <br>\nThe last Name of the Last Customer : ${list[4].lastName}Fixed.\n',?,BUG
12414,'Tag file defined in XML syntax does not seem to recignize import attribute in tag directive','Tomcat 5',Jasper,prasad.subramanian,dev,'If a tag file is defined in XML syntax , then the value of the attribute import \nin the tag directive is not reflected in the import list in the Simple Tag \nHandler ( java) file that this tag file is translated into.',?,BUG
12456,'RequestDispatcher for ERROR value does not get filtered','Tomcat 5',Catalina,jian.cai,dev,'A servlet (reqServlet.class) throws a 404 error page using:\n\n    resp.sendError(404, \"Error from ReqDispacherServlet\");\n\nThat error page has been mapped with a filter with \n<dispatcher>ERROR</dispatcher>.\n\n  <filter-mapping>\n        <filter-name>DispatcherFilterErr</filter-name>\n        <url-pattern>/error</url-pattern>\n        <dispatcher>ERROR</dispatcher>\n   </filter-mapping>\n\nThe error page is set as :\n\n   <error-page>\n        <error-code>\n            404\n        </error-code>\n        <location>\n            /error\n        </location>\n    </error-page>\n\nHowever, a call to reqServlet did not activate the  filter (DispatchFilterErr).\n\nSRV.6.2.5 states: the Filter will be applied to the request \"only when the \nrequest is being processed with the error page mechanism specified in SRV9.9 to \nan error resource matching the <url-pattern>. This is indicated by a \n<dispatcher> element with the value ERROR.\"Fixed.',?,BUG
12457,'Filter does not work when RequestDispatcher uses INCLUDE value','Tomcat 5',Catalina,jian.cai,dev,'servlet \"/reqdisp\" calls a request disapcher (named rd) has name \ncommencing \'admin\' which uses \n\nRequestDispatcher rd = req.getRequestDispatcher(\"/admin\");\nrd.include(req, resp);\n\nA filter has been mapped to /admin:\n\n   <filter-mapping>\n        <filter-name>DispatcherFilterIcd</filter-name>\n        <url-pattern>/admin</url-pattern>\n        <dispatcher>INCLUDE</dispatcher>\n   </filter-mapping>\n\nbut when request /reqdisp, the filter does not work (it has been initialized).Fixed.In the lastest Integration with J2EE RI, this problem occured again. It was \nfixed beforeCan you see if this works with the latest update of web-app_2_4.xsd?  The new \nweb-app_2_4.xsd is checked into the cvs.Hey, Is anybody looking at this? (my guess, no.)   I am starting to look into it.Fixed.',?,BUG
12461,'Jasper imports classes it shouldn\'t','Tomcat 5',Jasper,steve.downey,dev,'Jasper imports \'org.apache.jasper.runtime.*\' in the java it generates. According\nto spec, the only default imports should be \"javax.servlet.*\",\n\"javax.servlet.http.*\", and \"javax.servlet.jsp.*\"\n\nClasses from the o.a.j.runtime package should be used via fully qualified names. \n\nsee attached patch (supercedes one posted to tomcat-dev as there\'s a conflict now)Created attachment 2981\nreplaces o.a.j.runtime imports with fully qualified class namesFixed. Thanks for the patch!\n\n',?,CLEANUP
12466,'Unable to call jsp:invoke in the body of a classic/simple tag in a tag file.','Tomcat 5',Jasper,prasad.subramanian,dev,'If in a tag file there are two tags :\n\n<ct:ClassicTag var=\"foo\" >\n  <st:SimpleTag>\n     <jsp:invoke fragment=\"fragment1\" />\n  </st:SimpleTag>\n</ct:ClassicTag>\n\nIn this case when the tag file is complied a compile time error is thrown :\nlocation: class org.apache.jsp.tagfile.dbAccess.dbAccessHelper\n      _jspx_params = new java.util.HashMap();\n      ^\n/home/ps125818/locus/tomcat5-src/jakarta-tomcat-5/dist/work/Standalone/localhost/ActTrack/tagfiles/org/apache/jsp/tagfile/dbAccess.java:178:\ncannot resolve symbol\nsymbol  : variable _jspx_params  \nlocation: class org.apache.jsp.tagfile.dbAccess.dbAccessHelper\ngetQuery().invoke(null, _jspx_params);\n                        ^\n\nIn the invoke method _jspx_params is not defined. \nThe Map object \"params\" passed in the signature of should be used ?Fixed.\n',?,BUG
12467,'Unable to call jsp:invoke withing a classic tag handler in a tag file','Tomcat 5',Jasper,prasad.subramanian,dev,'If a classic tag handler has a jsp:invoke action in its body, a compile time\nerror is thrown while compiling the java file generated.\nThis is related to the non-decalartion of the Map _jspx_params in the tag\nhandler method craeted in the java file for the tag file.\n\nTest case \n/ActTrack/WEB-INF/tags/database/dbAccessCT.tag\n/ActTrack/jsp/Review/status_review_proj_CT.jsp?by=proj&fromdate=2001-01-01&todate=2001-12-12Fixed.\n',?,BUG
12469,'Whitespace has different definition in XML and Java','Tomcat 5',Jasper,steve.downey,dev,'According to the JSP spec [5.2.1] in a JSP Document, all textual nodes which\ncontain only whitespace, except for jsp:text, are dropped. However the\ndefinition of whitespace is not the same as that of Java. The formfeed character\nis NOT a whitespace character in XML, and is in Character.isSpace(). The JSP\nspec actually calls these out literally.\n\nYes, this is anal. I was only looking at it because isSpace is also happens to\nbe a deprecated method.\n\nPatch will be attached.Created attachment 2985\nreplace Character.isSpace() with tests against literals',?,BUG
12558,'Unable to capture fragment evaluation in a Writer if the fragment writes to the default \'out\'','Tomcat 5',Jasper,prasad.subramanian,dev,'Lets take the case when a Simple Tag evaluates its body and captures the\nevaluation in a StringWriter.\nThe body in turn consists of a classic tag ( or simple tag) that writes some\ntext to the default writer ( using pageContext.getOut().println() )\n\nWhat happens is that the text gets written into the default out and is not\ncaptured by the StringWriter.\n\n<st:SimpleTag att1=\"attvalue1\">\n   <ct:classictag>\n    </ct:classictag>\n</st:simpletag>',?,BUG
12559,'setLocale gives wrong content type','Tomcat 5',Catalina,jian.cai,dev,'The following entry in web.xml set a locale mapping to encoding.\n\n      <locale-encoding-mapping-list>\n        <locale-encoding-mapping>\n            <locale>zh</locale>\n            <encoding>gb2312</encoding>\n        </locale-encoding-mapping>\n      </locale-encoding-mapping-list>\n\nThe servlet (AdminServlet) set the locale of response if the request parameter \nhas \"lan\".\n\nWhen access /admin?lan=zh, the broswer tried to save the file as a binary file.\nWhen access /admin?lan=en, the broswer tried to save the file as a binary file.\nWhen access /admin, the broswer shown the HTML file\nWhen access /admin?lan=(other), the broswer shown the HTML file.\n\nIt seemed the setLocale() incorrectly changed the content_type of the response \nwhen the locale to be set to zh or en.\n\npublic class AdminServlet extends HttpServlet {\n\n    String precedence=\"starting\";\n    \n    public void init(ServletConfig sc) throws ServletException {\n\n    }\n\n\n    public void service (ServletRequest request,ServletResponse response) \nthrows ServletException, IOException {\n        \n       response.setContentType(\"text/html\"); \n       \n       String languagepref = request.getParameter(\"lan\");\n                if (languagepref!=null)\n                {\n                    response.setLocale(new java.util.Locale\n(languagepref));                    \n                }\n\n        //response.setContentType(\"text/html\");\t\n        PrintWriter out = response.getWriter();\t\n        \n        out.println(\"<HTML>\\n\");\n        out.println(\"<Body>\\n\");\n\tout.println(\"<p>Admin Servelt</p>\\n\");\n\n        out.println(\"characterecoding: \" + response.getCharacterEncoding()\n+ \"\\n\");\n        out.println(\"locale: \" + response.getLocale()+ \"\\n\");\n       // out.flush();\n    }\n}Hi, James.\n\nIf you use my patch for Bug 10901, is Bug 12559 solved ???\n( Bug 10901 is different from this bug. )\n\nWhen customizing the patch for Bug 10901,\nI encountered the same phenomenon as this bug you reported.\nHowever, I didn\'t detect that bug at this time.I tried this test case in the latest Tomcat 5 and the servlet always returns\nvalid HTML with the expected values. So, it appears that the patch for bug 10901\nfixed this problem.',?,BUG
12590,'Unable to nest jsp:attribute within jsp:body if used with jsp:include','Tomcat 5',Jasper,prasad.subramanian,dev,'A test case like:\n\n<jsp:include >\n   <jsp:attribute name=\"page>\n     foo.jsp\n    </jsp:attribute>\n    <jsp:body>\n       <jsp:param>\n          <jsp:attribute name=\"name\" >\n            ....\n ....\n</jsp:include>\n\nThrows a error :\n============\norg.apache.jasper.JasperException: /jsp2/jspattrpos/param-in-param.jsp(13,15)\nNot allowed in a template text body.\n\tat\norg.apache.jasper.compiler.DefaultErrorHandler.jspError(DefaultErrorHandler.java:95)\n\tat org.apache.jasper.compiler.ErrorDispatcher.dispatch(ErrorDispatcher.java:440)\n\tat org.apache.jasper.compiler.ErrorDispatcher.jspError(ErrorDispatcher.java:126)\n\tat org.apache.jasper.compiler.Parser.parseElementsTemplateText(Parser.java:1524)\n\tat org.apache.jasper.compiler.Parser.parseBody(Parser.java:1642)\n\tat org.apache.jasper.compiler.Parser.parseNamedAttributes(Parser.java:1688)\n\tat org.apache.jasper.compiler.Parser.parseEmptyBody(Parser.java:904)\n\tat org.apache.jasper.compiler.Parser.parseParam(Parser.java:792)\n\tat org.apache.jasper.compiler.Parser.parseBody(Parser.java:1639)\n\tat org.apache.jasper.compiler.Parser.parseJspBody(Parser.java:1574)\n\tat org.apache.jasper.compiler.Parser.parseJspAttributeAndBody(Parser.java:1016)\n\tat org.apache.jasper.compiler.Parser.parseOptionalBody(Parser.java:981)\n\tat org.apache.jasper.compiler.Parser.parseInclude(Parser.java:821)\n\tat org.apache.jasper.compiler.Parser.parseAction(Parser.java:1140)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1420)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:159)\n\tat org.apache.jasper.compiler.ParserController.parseFile(ParserController.java:245)\n\tat org.apache.jasper.compiler.ParserController.parse(ParserController.java:169)\n\tat org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:259)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:409)\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:570)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:295)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:289)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:247)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:271)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2505)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat\norg.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:171)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:223)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:405)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:380)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:508)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:533)\n\tat java.lang.Thread.run(Thread.java:536)',?,BUG
12594,'If a SKIP_PAGE is returned from a classic tag nested within a Simple Tag , the page following the simple tag is displayed','Tomcat 5',Jasper,prasad.subramanian,dev,'Lets take this case :\n<st:simpletag att=\"val1\" >\n   <ct:tagex att2=\"val2\">\n      I return a SKIP_PAGE \n    </st:tagex>\n     Template text \n</st:simpletag>\n   This is the text after the simple tag\n\nIn such a case where ct:tagex returns a SKIP_PAGE in the doEndTag the text after\nthe end tag of the simple tag handler is displayed.',?,BUG
12638,'${pageContext.errorData.throwable.message} throws an error','Tomcat 5',Jasper,prasad.subramanian,dev,'If a error page has a EL expression that tries to recover the error message \nthrown in the EL is unable to locate the ErrorData object using the following \nexpression\n\n${pageContext.errorData.throwable.message}\n\njavax.servlet.jsp.JspException: An error occurred while evaluating custom \naction attribute \"<unknown>\" with \nvalue \"${pageContext.errorData.throwable.message}\": An error occurred while \ngetting property \"errorData\" from an instance of class \norg.apache.jasper.runtime.PageContextImpl\n   at org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate\n(PageContextImpl.java:600)\n   at org.apache.jsp.errorpage_jsp._jspService(errorpage_jsp.java:83)\n\n\nTest Case: /jsp20-tests/jsp2/Exception.jspFixed (pending patch to jsr152/src/share/javax/servlet/jsp/PageContext.java in\njakarta-servletapi-5 repository).\n',?,BUG
12653,'include-coda does not get included if JSP has a taglib directive','Tomcat 5',Jasper,prasad.subramanian,dev,'If a JSP has a configuration element that defines a include-coda for it,and it \nalso has a taglib directive within the JSP,then the include-coda does not get \nincluded.\ntest case:\njsp20-tests/jsp2/include/srcinclude/JSPConfScrEnablePos.jspFixed.\n',?,BUG
12654,'Translation Exception not thrown when a pageEncoding directive specifies a different pageEncoding than the one specified by configuration elements','Tomcat 5',Jasper,prasad.subramanian,dev,'If a JSP has a configuration element defined for a page-encoding , and a page-\nencoding directive specifies a different encoding (say UTF-8) then as per the \nspec a translation exception should be thrown , but is not thrown\n\nTest case:\n/jsp20-tests/jsp2/JSPConfneg/pageencoding/*.jspFixed.\n',?,BUG
12715,'webapp_2_4.xsd missed \"ERROR\" value in \"dispatcher\"','Tomcat 5',' JSP API',jian.cai,dev,'The dispatcherType in webapp_2_4.xsd missed the ERROR value:\n\n<xsd:simpleType name=\"dispatcherType\">\n<xsd:annotation>\n<xsd:documentation>\n\nThe dispatcher has three legal values, FORWARD and REQUEST\nand INCLUDE. A value of FORWARD means the Filter\nwill be applied under RequestDispatcher.forward() calls.\nA value of REQUEST means the Filter will be applied\nunder ordinary client calls to the path or servlet. A value of\nINCLUDE means the Filter will be applied under\nRequestDispatcher.include() calls.\nThe absence of any dispatcher elements in a\nfilter-mapping indicates a default of applying\nfilters only under ordinary client calls to the path or servlet.\n\n</xsd:documentation>\n</xsd:annotation>\n\n    <xsd:restriction base=\"j2ee:string\">\n        <xsd:enumeration value=\"FORWARD\"/>\n    <xsd:enumeration value=\"INCLUDE\"/>\n    <xsd:enumeration value=\"REQUEST\"/>\n\n    </xsd:restriction>\n\n</xsd:simpleType>\n\n\nAccording to servelt spec 2.4 P53, there should be ERROR value for the \n<dispacher> entry.Fixed.',?,BUG
12717,'No Translation error thrown when an attribute that does not take in a rtexprvalue is given a EL as a value','Tomcat 5',Jasper,prasad.subramanian,dev,'If tag foo has an attribute att1 that does not take runtime expressions as a \nvalue and a EL expression is given as a value to this attribute, a translation \ntime expression should be thrown, but is not thrown.Fixed.\nTranslation exception is now thrown if scriptlet or EL expression is specified\nas the value of an XML-style attribute whose <rtexprvalue> TLD element is set to\nFALSE (translation exception was already thrown for <jsp:attribute> style\nattributes).',?,BUG
12718,'A variable scoped within a fragment in a tag file is always expsed as a string','Tomcat 5',Jasper,prasad.subramanian,dev,' If a tag file declares a variable within a fragment with a variable-class \nspecified. If the variable is accessed withing the frgament using EL , it is \nobserved that the type of the object exposed by the variable is a String not a \ntype specified by variable class.\n\nTest case:\njsp20-tests/jsp2/tagfilepos/TFFragVarPos.jsp Is jsp20-tests/jsp2 something that the rest of us can see? Fixed.\n',?,BUG
12755,'welcome file for jsp does not work','Tomcat 5',Catalina,jian.cai,dev,'Tomcat could not use the jsp as welcome file. This feature used to work. \n\nThe following is the config entry in web.xml.\n\n  <welcome-file-list> \n    <welcome-file>index.jsp</welcome-file> \n  </welcome-file-list>Created attachment 3203\na build tree for a war file that demonstrates working welcome files.Humm...  I am having difficulty reproducing this.  I have attached a testcase\nthat  seems to demonstrate that everything is working....This problem used to be in one of the previous Tomcat 5.0 build. It might go\naway in Tomcat latest build . But in the J2EE pre integration build (Having\nTomcat 5.0 HEAD), welcome file within a ear does not.  Original poster says HEAD is now working correctly.',?,BUG
13000,'tag file handler generation with complex attributes','Tomcat 5',Jasper,jan.luehe,dev,'stephanie.bodoff@sun.com writes:\n\nI\'m experimenting with tag files and believe I have found a bug. Here\'s \nmy tag file (simplified for debugging):\n\n<\%@ attribute name=\"books\" required=\"true\" rtexprvalue=\"true\" \ntype=\"java.util.Collection\" \%>\n<\%@ attribute name=\"color\" required=\"true\" \%>\n\n${color}\n${books.numberOfBooks}\n\nI\'m passing a collection for the books attribute. However, I\'m getting \nJSP exception (and not a very helpful one at that) when the tag is \nexecuted because the tag handler generated from the tag file is \nincorrect- the type of the books attribute is set to String instead of \nCollection. Is this a bug that has been fixed that I haven\'t picked up \nor is it a new one?Fixed.\n',?,BUG
13058,'Dynamic Attributes do not take in RT expressions','Tomcat 5',Jasper,prasad.subramanian,dev,'If an attribute in a tag has been sepecified as a dynamic attribute , and a EL \nexpression is specified ( or runtime expression) as the value of the attribute \nthen a Eception is thrown that says that EL or runtime expressions not allowed \nin template text body.This happens only in the case when the attribute value is specified as a bodyof \nthe jsp:attribute element',?,BUG
13094,'Compliance Issue - NPE not thrown if a null reference is passed to PageContext.handlePageException(Exception) or PageContext.handlePageException(Throwable).','Tomcat 5',Jasper,Ryan.Lubke,dev,'Javadocs for PageContext.handlePageException(Exception) and \nPageContext.handlePageException(Throwable) clearly state that\na NullPointerException is to be thrown if a null reference is passed\nto these methods.*** Bug 13093 has been marked as a duplicate of this bug. ***',?,BUG
13138,'Compliance issue.  PageContext.setAttribute(String, Object, int) fails to throw an IllegalArgumentException if provide an invalid scope.','Tomcat 5',Jasper,Ryan.Lubke,dev,'Per the Javadocs, PageContext.setAttribute(String, Object, int)\nmust throw an IllegalArgumentException if provided an invalid scope.\n\nI looked at o.a.j.runtime.PageContextImpl and found that the default case in the\nswitch does nothing when it should throw an IllegalArgumentException.',?,BUG
13140,'Compliance issue - PageContext.setAttribute, under certain circumstances, fails to throw an NPE when the value provided is null','Tomcat 5',Jasper,Ryan.Lubke,dev,'If trying to set a PageContext attribute in the following scopes, an NPE is not\nthrown when the value provided is null:\n\n   JspContext.REQUEST_SCOPE\n   JspContext.SESSION_SCOPE\n   JspContext.APPLICATION_SCOPE\n\n   ex.\n\n   pageContext.setAttribute(\"attrName\", null, JspContext.APPLICATION_SCOPE);',?,BUG
13173,'NPE thrown by ELException.toString() if not originally created with a root cause exception.','Tomcat 5',Jasper,Ryan.Lubke,dev,'Given:\n\nELException ele = new ELException();\nString str = ele.toString().\n\n\nResulting stacktrace:\n\n java.lang.NullPointerException\n     [java] \tat javax.servlet.jsp.el.ELException.toString(ELException.java:139)Closing as the toString() method will be removed.',?,BUG
13552,'missing attribute name in exception message when EL expression evaluation fails','Tomcat 5',Jasper,jan.luehe,dev,'When an EL expression that is supplied as the value for an action\nattribute fails to evaluate, the exception message does not contain\nthe name of the attribute. Instead, it contains an empty string.\n\nFor example, if the following EL expression\n\n  <c:set var=\"book\" value=\"${bookDB.bookDetails}\" />\n\nfails to evaluate, this exception message is printed:\n\n  An error occurred while evaluating custom action attribute \"\" with\n  value \"${bookDB.bookDetails.title}\"\n\nIt would be useful if the exception message contained the attribute name.I think someone fixed this.\nI tried to recreate with this:\n<\%pageContext.setAttribute(\"prescription\", \"cowbell\");\%>\n<c:set var=\"fever\" value=\"${prescription.more.what}\" />\n\nAnd got:\njavax.servlet.ServletException: Unable to find a value for \"more\" in object of\nclass \"java.lang.String\" using operator \".\"\n ...\nroot cause\n\njavax.servlet.jsp.el.ELException: Unable to find a value for \"more\" in object of\nclass \"java.lang.String\" using operator \".\"\n\tat org.apache.commons.el.Logger.logError(Logger.java:481)\n...\n\n\nIf this is still valid - it seems that this might belong to commons-el and not\ntomcat. ',?,IMPROVEMENT
13553,'Jasper incorrectly generating a translation error if a tag has both a TEI and variable declarations.','Tomcat 5',Jasper,Ryan.Lubke,dev,'Given:\n\n<tag>\n    <name>test</name>\n    <tei-class>com.foo.TestTEI</tei-class>\n    <variable>\n        <name-given>var1</name-given>\n    </variable>\n</tag>\n\nJasper will generate the following:\n\n   \"variable subelement defined in TLD when TagExtraInfo class MyClass\n    is non-null\"\n\nThis translation error should only occur if a tag has a variable declaration\nand a call to TagExtraInfo.getVariableInfo() returns a non-null value.\n\nSee lines 412-418 in o.a.j.compile.TagLibraryInfoImpl.java.',?,BUG
13587,'version out of date in some document','Tomcat 5',Webapps:Documentation,iasandcb,dev,'In webapps\\tomcat-docs\\catalina\\funcspecs\\fs-admin-apps.html\nDependencies-External Technologies section says\nJavaServer Pages Standard Tag Library 1.0-EA (when available) \n\nActually JSTL now has 1.0 final spec and 1.0.1 RI from Jakarta Taglibs-\nStandard.\n\nJavaServer Pages Standard Tag Library 1.0(Taglibs-Standard 1.0.1)\n\nshould be better for the statement.Updated document to JSTL 1.0.',?,DOCUMENTATION
13619,'TagInfo.getAttributes returns a zero-length array instead of null if a tag has not defined attributes.','Tomcat 5',Jasper,Ryan.Lubke,dev,'According to the javadocs, TagInfo.getAttributes must return null if the tag in\nquestion is defined with no attributes.\n\nLooking at line 280 of o.a.j.c.TagFileProcessor.java, the size of a vector is\nused to initialize the size of the array, so if the even if the vector has no\nelements the array is initialized and passed to the constructor of TagInfo.',?,BUG
13723,'Tom Cat does not start','Tomcat 5',Unknown,prashanth,dev,'When I startup the Tomcat server it threw \njava.lang.IllegalMonitorStateException: current thread not ownerI never encountered any problem like this with Tomcat on Win 2k or XP, nor can\nreproduce this. There is probably a setup problem somewhere (or at least, you\'ll\nhave to give very detailed instructions on how to reproduce thise - and for\nstarters, you *must* include the full stack trace when dealing with\nnever-before-seen errors).I\'ve seen this on Windows 98 with JDK 1.2.2, and it may be the same with other\nWindows versions and this old JDK. \n\nI noticed that it can be \"fixed\" by turning off the JIT, e.g. by setting\nJAVA_COMPILER=NONE. Looks like a JIT bug to me.Thanks to Hans Bergsten, I set an envirionmental variable JAVA_COMPILER=NONE \nand the bug is fixed.\n\nThanks once again.I got exactly same error. I am using win98.\n************************************************\nD:\\>D:\\jakarta-tomcat-4.1.12\\bin\\startup start\nUsing CATALINA_BASE:   D:\\jakarta-tomcat-4.1.12\nUsing CATALINA_HOME:   D:\\jakarta-tomcat-4.1.12\nUsing CATALINA_TMPDIR: D:\\jakarta-tomcat-4.1.12\\temp\nUsing JAVA_HOME:       D:\\jdk1.2.2\n1  \"D:\\jdk1.2.2\\bin\\java\"    -Djava.endorsed.dirs=\"D:\\jakarta-tomcat-4.1.12\\bin;\nD:\\jakarta-tomcat-4.1.12\\common\\endorsed\" -classpath \"D:\\jdk1.2.2\\lib\\tools.jar;\nD:\\jakarta-tomcat-4.1.12\\bin\\bootstrap.jar\" -Dcatalina.base=\"D:\\jakarta-tomcat-4\n.1.12\" -Dcatalina.home=\"D:\\jakarta-tomcat-4.1.12\" -Djava.io.tmpdir=\"D:\\jakarta-t\nomcat-4.1.12\\temp\" org.apache.catalina.startup.Bootstrap\nBootstrap: Class loader creation threw exception\njava.lang.IllegalMonitorStateException: current thread not owner\n        at org.apache.catalina.loader.StandardClassLoader.addRepositoryInternal(\nStandardClassLoader.java, Compiled Code)\n        at org.apache.catalina.loader.StandardClassLoader.<init>(StandardClassLo\nader.java, Compiled Code)\n        at org.apache.catalina.startup.ClassLoaderFactory.createClassLoader(Clas\nsLoaderFactory.java, Compiled Code)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java, Compiled C\node)\nD:\\>\n************************************************I also had the exact same problem on Win2k, JDK 1.2.2, Tomcat 4.1 and it got \nfixed with setting the environment variable JAVA_COMPILER=NONE.Created attachment 3706\njava.lang.IllegalMonitorStateException: current thread not ownerI\'ve also been getting this error and it seems to be a basic problem with \nrunning Tomcat 4 with JDK 1.2.\n\nSearching through the tomcat-user list showed a number of people were reporting \nthis error. Some people seem to be able to resolve the problem with the \nJAVA_COMPILER=NONE fix. However, the actual root of the problem was pointed out \nas being a bug in java:\nhttp://developer.java.sun.com/developer/bugParade/bugs/4776385.html\n\nThe suggested workaround of using the hotspot VM seems to have worked for me. \nTo fix it on the Tomcat site would require compilation in 1.3 or 1.2 instead of \n1.4, which is probably not feasible. Maybe this could be added to the Tomcat 4 \nFAQ?I added this my FAQ.  (http://tomcatfaq.sourceforge.net/)\n\nHopefully the developers will add a note to the README file too.\n\nChanging status to WONTFIX since the public distribution from jakarta won\'t be\ncompiled using jdk1.2.X. (I least that is my assumption) It will be up to the\nuser to recompile from src tree.\nWhen I shutdown tomcat (or when it is running), I get the error \njava.lang.IllegalMonitorStateException: current thread not owner \n\nwhen I start server using startup.bat ,server runs for few seconds & \nautomatically shuts down & also \nWhen Iam using shutdown.bat, I get the error \njava.lang.IllegalMonitorStateException: current thread not owner \n*** Bug 24819 has been marked as a duplicate of this bug. ***I installed the Apache Tomcat application server on a windows 2000 advanced\nserver PC with service pack 3.  When I tried to start the application via the\nconfiguration tool, the configuration tool\'s start button indicates that the\napplication has started but there is nothing binding to port 8080 (the tomcat\nadmin port). In addition I am not able to connect to http://127.0.0.1:8080.\nFinally when I check the tomcat log files there is nothing in \"stderr.log or\nstdout.log files\"  but the \"jakarta_service_20041111.log\" file contains the\nfollowing data below.\n\n\n[2004-11-11 15:34:37] [info] Service Tomcat5 name Apache Tomcat\n[2004-11-11 15:34:38] [info] Service Tomcat5 installed\n[2004-11-11 15:34:38] [info] Procrun finished.\n[2004-11-11 15:34:38] [info] Updating service...\n[2004-11-11 15:34:39] [info] Service Tomcat5 updated\n[2004-11-11 15:34:39] [info] Update service finished.\n[2004-11-11 15:34:39] [info] Procrun finished.\n[2004-11-11 15:34:44] [info] Updating service...\n[2004-11-11 15:34:44] [info] Service Tomcat5 updated\n[2004-11-11 15:34:44] [info] Update service finished.\n[2004-11-11 15:34:44] [info] Procrun finished.\n[2004-11-11 15:34:45] [info] Updating service...\n[2004-11-11 15:34:45] [info] Service Tomcat5 updated\n[2004-11-11 15:34:45] [info] Update service finished.\n[2004-11-11 15:34:45] [info] Procrun finished.\n[2004-11-11 15:34:49] [info] Running Service...\n[2004-11-11 15:34:49] [info] Starting service...\n[2004-11-11 15:34:52] [info] Service started in 2484 ms.\n[2004-11-11 15:34:56] [info] Run service finished.\n[2004-11-11 15:34:56] [info] Procrun finished.\n[2004-11-11 15:40:28] [info] Running Service...\n[2004-11-11 15:40:28] [info] Starting service...\n[2004-11-11 15:40:29] [info] Service started in 1265 ms.\n[2004-11-11 15:40:33] [info] Run service finished.\n[2004-11-11 15:40:33] [info] Procrun finished.\n[2004-11-11 15:43:02] [info] Running Service...\n[2004-11-11 15:43:02] [info] Starting service...\n[2004-11-11 15:43:13] [info] Service started in 11234 ms.\n[2004-11-11 15:43:21] [info] Run service finished.\n[2004-11-11 15:43:21] [info] Procrun finished.\n[2004-11-11 15:45:30] [info] Running Service...\n[2004-11-11 15:45:30] [info] Starting service...\n[2004-11-11 15:45:31] [info] Service started in 1265 ms.\n[2004-11-11 15:45:35] [info] Run service finished.\n[2004-11-11 15:45:35] [info] Procrun finished.\n[2004-11-11 15:49:18] [1193 prunsrv.c] [debug] Procrun log initialized\n[2004-11-11 15:49:18] [info] Running Service...\n[2004-11-11 15:49:18] [1036 prunsrv.c] [debug] Inside ServiceMain...\n[2004-11-11 15:49:18] [info] Starting service...\n[2004-11-11 15:49:18] [408  javajni.c] [debug] Jvm Option[0]\n-Dcatalina.home=C:\\Program Files\\Apache Software Foundation\\Tomcat 5.5\n[2004-11-11 15:49:18] [408  javajni.c] [debug] Jvm Option[1]\n-Djava.endorsed.dirs=C:\\Program Files\\Apache Software Foundation\\Tomcat\n5.5\\common\\endorsed\n[2004-11-11 15:49:18] [408  javajni.c] [debug] Jvm Option[2]\n-Djava.io.tmpdir=C:\\Program Files\\Apache Software Foundation\\Tomcat 5.5\\temp\n[2004-11-11 15:49:18] [408  javajni.c] [debug] Jvm Option[3] -Xrs\n[2004-11-11 15:49:18] [408  javajni.c] [debug] Jvm Option[4]\n-Djava.class.path=C:\\Program Files\\Apache Software Foundation\\Tomcat\n5.5\\bin\\bootstrap.jar\n[2004-11-11 15:49:18] [408  javajni.c] [debug] Jvm Option[5] vfprintf\n[2004-11-11 15:49:19] [494  javajni.c] [debug] argv[0] = start\n[2004-11-11 15:49:20] [907  prunsrv.c] [debug] Java started\norg/apache/catalina/startup/Bootstrap\n[2004-11-11 15:49:20] [info] Service started in 1250 ms.\n[2004-11-11 15:49:20] [1110 prunsrv.c] [debug] Waitning worker to finish...\n[2004-11-11 15:49:24] [531  javajni.c] [debug] Java Worker thread finished\n[2004-11-11 15:49:24] [1115 prunsrv.c] [debug] Worker finished.\n[2004-11-11 15:49:24] [info] Run service finished.\n[2004-11-11 15:49:24] [info] Procrun finished.\n[2004-11-11 16:04:56] [1193 prunsrv.c] [debug] Procrun log initialized\n[2004-11-11 16:04:56] [info] Running Service...\n[2004-11-11 16:04:56] [1036 prunsrv.c] [debug] Inside ServiceMain...\n[2004-11-11 16:04:56] [info] Starting service...\n[2004-11-11 16:04:56] [408  javajni.c] [debug] Jvm Option[0]\n-Dcatalina.home=C:\\Program Files\\Apache Software Foundation\\Tomcat 5.5\n[2004-11-11 16:04:56] [408  javajni.c] [debug] Jvm Option[1]\n-Djava.endorsed.dirs=C:\\Program Files\\Apache Software Foundation\\Tomcat\n5.5\\common\\endorsed\n[2004-11-11 16:04:56] [408  javajni.c] [debug] Jvm Option[2]\n-Djava.io.tmpdir=C:\\Program Files\\Apache Software Foundation\\Tomcat 5.5\\temp\n[2004-11-11 16:04:56] [408  javajni.c] [debug] Jvm Option[3] -Xrs\n[2004-11-11 16:04:56] [408  javajni.c] [debug] Jvm Option[4]\n-Djava.class.path=C:\\Program Files\\Apache Software Foundation\\Tomcat\n5.5\\bin\\bootstrap.jar\n[2004-11-11 16:04:56] [408  javajni.c] [debug] Jvm Option[5] vfprintf\n[2004-11-11 16:04:56] [494  javajni.c] [debug] argv[0] = start\n[2004-11-11 16:04:57] [907  prunsrv.c] [debug] Java started\norg/apache/catalina/startup/Bootstrap\n[2004-11-11 16:04:57] [info] Service started in 1265 ms.\n[2004-11-11 16:04:57] [1110 prunsrv.c] [debug] Waitning worker to finish...\n[2004-11-11 16:05:01] [531  javajni.c] [debug] Java Worker thread finished\n[2004-11-11 16:05:01] [1115 prunsrv.c] [debug] Worker finished.\n[2004-11-11 16:05:01] [info] Run service finished.\n[2004-11-11 16:05:01] [info] Procrun finished.\n[2004-11-11 16:05:13] [1193 prunsrv.c] [debug] Procrun log initialized\n[2004-11-11 16:05:13] [info] Running Service...\n[2004-11-11 16:05:13] [1036 prunsrv.c] [debug] Inside ServiceMain...\n[2004-11-11 16:05:13] [info] Starting service...\n[2004-11-11 16:05:13] [408  javajni.c] [debug] Jvm Option[0]\n-Dcatalina.home=C:\\Program Files\\Apache Software Foundation\\Tomcat 5.5\n[2004-11-11 16:05:13] [408  javajni.c] [debug] Jvm Option[1]\n-Djava.endorsed.dirs=C:\\Program Files\\Apache Software Foundation\\Tomcat\n5.5\\common\\endorsed\n[2004-11-11 16:05:13] [408  javajni.c] [debug] Jvm Option[2]\n-Djava.io.tmpdir=C:\\Program Files\\Apache Software Foundation\\Tomcat 5.5\\temp\n[2004-11-11 16:05:13] [408  javajni.c] [debug] Jvm Option[3] -Xrs\n[2004-11-11 16:05:13] [408  javajni.c] [debug] Jvm Option[4]\n-Djava.class.path=C:\\Program Files\\Apache Software Foundation\\Tomcat\n5.5\\bin\\bootstrap.jar\n[2004-11-11 16:05:13] [408  javajni.c] [debug] Jvm Option[5] vfprintf\n[2004-11-11 16:05:13] [494  javajni.c] [debug] argv[0] = start\n[2004-11-11 16:05:14] [907  prunsrv.c] [debug] Java started\norg/apache/catalina/startup/Bootstrap\n[2004-11-11 16:05:14] [info] Service started in 1250 ms.\n[2004-11-11 16:05:14] [1110 prunsrv.c] [debug] Waitning worker to finish...\n[2004-11-11 16:05:18] [531  javajni.c] [debug] Java Worker thread finished\n[2004-11-11 16:05:18] [1115 prunsrv.c] [debug] Worker finished.\n[2004-11-11 16:05:18] [info] Run service finished.\n[2004-11-11 16:05:18] [info] Procrun finished.\n[2004-11-11 16:12:18] [1193 prunsrv.c] [debug] Procrun log initialized\n[2004-11-11 16:12:18] [info] Running Service...\n[2004-11-11 16:12:18] [1036 prunsrv.c] [debug] Inside ServiceMain...\n[2004-11-11 16:12:18] [info] Starting service...\n[2004-11-11 16:12:18] [408  javajni.c] [debug] Jvm Option[0]\n-Dcatalina.home=C:\\Program Files\\Apache Software Foundation\\Tomcat 5.5\n[2004-11-11 16:12:18] [408  javajni.c] [debug] Jvm Option[1]\n-Djava.endorsed.dirs=C:\\Program Files\\Apache Software Foundation\\Tomcat\n5.5\\common\\endorsed\n[2004-11-11 16:12:18] [408  javajni.c] [debug] Jvm Option[2]\n-Djava.io.tmpdir=C:\\Program Files\\Apache Software Foundation\\Tomcat 5.5\\temp\n[2004-11-11 16:12:18] [408  javajni.c] [debug] Jvm Option[3] -Xrs\n[2004-11-11 16:12:18] [408  javajni.c] [debug] Jvm Option[4]\n-Djava.class.path=C:\\Program Files\\Apache Software Foundation\\Tomcat\n5.5\\bin\\bootstrap.jar\n[2004-11-11 16:12:18] [408  javajni.c] [debug] Jvm Option[5] vfprintf\n[2004-11-11 16:12:18] [494  javajni.c] [debug] argv[0] = start\n[2004-11-11 16:12:19] [907  prunsrv.c] [debug] Java started\norg/apache/catalina/startup/Bootstrap\n[2004-11-11 16:12:19] [info] Service started in 1265 ms.\n[2004-11-11 16:12:19] [1110 prunsrv.c] [debug] Waitning worker to finish...\n[2004-11-11 16:12:23] [531  javajni.c] [debug] Java Worker thread finished\n[2004-11-11 16:12:23] [1115 prunsrv.c] [debug] Worker finished.\n[2004-11-11 16:12:23] [info] Run service finished.\n[2004-11-11 16:12:23] [info] Procrun finished.\n[2004-11-11 16:13:04] [1193 prunsrv.c] [debug] Procrun log initialized\n[2004-11-11 16:13:04] [info] Running Service...\n[2004-11-11 16:13:04] [1036 prunsrv.c] [debug] Inside ServiceMain...\n[2004-11-11 16:13:04] [info] Starting service...\n[2004-11-11 16:13:04] [408  javajni.c] [debug] Jvm Option[0]\n-Dcatalina.home=C:\\Program Files\\Apache Software Foundation\\Tomcat 5.5\n[2004-11-11 16:13:04] [408  javajni.c] [debug] Jvm Option[1]\n-Djava.endorsed.dirs=C:\\Program Files\\Apache Software Foundation\\Tomcat\n5.5\\common\\endorsed\n[2004-11-11 16:13:04] [408  javajni.c] [debug] Jvm Option[2]\n-Djava.io.tmpdir=C:\\Program Files\\Apache Software Foundation\\Tomcat 5.5\\temp\n[2004-11-11 16:13:04] [408  javajni.c] [debug] Jvm Option[3] -Xrs\n[2004-11-11 16:13:04] [408  javajni.c] [debug] Jvm Option[4]\n-Djava.class.path=C:\\Program Files\\Apache Software Foundation\\Tomcat\n5.5\\bin\\bootstrap.jar\n[2004-11-11 16:13:04] [408  javajni.c] [debug] Jvm Option[5] vfprintf\n[2004-11-11 16:13:04] [494  javajni.c] [debug] argv[0] = start\n[2004-11-11 16:13:05] [907  prunsrv.c] [debug] Java started\norg/apache/catalina/startup/Bootstrap\n[2004-11-11 16:13:05] [info] Service started in 1265 ms.\n[2004-11-11 16:13:05] [1110 prunsrv.c] [debug] Waitning worker to finish...\n[2004-11-11 16:13:09] [531  javajni.c] [debug] Java Worker thread finished\n[2004-11-11 16:13:09] [1115 prunsrv.c] [debug] Worker finished.\n[2004-11-11 16:13:09] [info] Run service finished.\n[2004-11-11 16:13:09] [info] Procrun finished.\n[2004-11-11 16:13:54] [1193 prunsrv.c] [debug] Procrun log initialized\n[2004-11-11 16:13:54] [info] Running Service...\n[2004-11-11 16:13:54] [1036 prunsrv.c] [debug] Inside ServiceMain...\n[2004-11-11 16:13:54] [info] Starting service...\n[2004-11-11 16:13:54] [408  javajni.c] [debug] Jvm Option[0]\n-Dcatalina.home=C:\\Program Files\\Apache Software Foundation\\Tomcat 5.5\n[2004-11-11 16:13:54] [408  javajni.c] [debug] Jvm Option[1]\n-Djava.endorsed.dirs=C:\\Program Files\\Apache Software Foundation\\Tomcat\n5.5\\common\\endorsed\n[2004-11-11 16:13:54] [408  javajni.c] [debug] Jvm Option[2]\n-Djava.io.tmpdir=C:\\Program Files\\Apache Software Foundation\\Tomcat 5.5\\temp\n[2004-11-11 16:13:54] [408  javajni.c] [debug] Jvm Option[3] -Xrs\n[2004-11-11 16:13:54] [408  javajni.c] [debug] Jvm Option[4]\n-Djava.class.path=C:\\Program Files\\Apache Software Foundation\\Tomcat\n5.5\\bin\\bootstrap.jar\n[2004-11-11 16:13:54] [408  javajni.c] [debug] Jvm Option[5] vfprintf\n[2004-11-11 16:13:54] [494  javajni.c] [debug] argv[0] = start\n[2004-11-11 16:13:55] [907  prunsrv.c] [debug] Java started\norg/apache/catalina/startup/Bootstrap\n[2004-11-11 16:13:55] [info] Service started in 1265 ms.\n[2004-11-11 16:13:55] [1110 prunsrv.c] [debug] Waitning worker to finish...\n[2004-11-11 16:13:59] [531  javajni.c] [debug] Java Worker thread finished\n[2004-11-11 16:13:59] [1115 prunsrv.c] [debug] Worker finished.\n[2004-11-11 16:13:59] [info] Run service finished.\n[2004-11-11 16:13:59] [info] Procrun finished.\n[2004-11-11 16:14:46] [1193 prunsrv.c] [debug] Procrun log initialized\n[2004-11-11 16:14:46] [info] Running Service...\n[2004-11-11 16:14:46] [1036 prunsrv.c] [debug] Inside ServiceMain...\n[2004-11-11 16:14:46] [info] Starting service...\n[2004-11-11 16:14:46] [408  javajni.c] [debug] Jvm Option[0]\n-Dcatalina.home=C:\\Program Files\\Apache Software Foundation\\Tomcat 5.5\n[2004-11-11 16:14:46] [408  javajni.c] [debug] Jvm Option[1]\n-Djava.endorsed.dirs=C:\\Program Files\\Apache Software Foundation\\Tomcat\n5.5\\common\\endorsed\n[2004-11-11 16:14:46] [408  javajni.c] [debug] Jvm Option[2]\n-Djava.io.tmpdir=C:\\Program Files\\Apache Software Foundation\\Tomcat 5.5\\temp\n[2004-11-11 16:14:46] [408  javajni.c] [debug] Jvm Option[3] -Xrs\n[2004-11-11 16:14:46] [408  javajni.c] [debug] Jvm Option[4]\n-Djava.class.path=C:\\Program Files\\Apache Software Foundation\\Tomcat\n5.5\\bin\\bootstrap.jar\n[2004-11-11 16:14:46] [408  javajni.c] [debug] Jvm Option[5] vfprintf\n[2004-11-11 16:14:46] [494  javajni.c] [debug] argv[0] = start\n[2004-11-11 16:14:47] [907  prunsrv.c] [debug] Java started\norg/apache/catalina/startup/Bootstrap\n[2004-11-11 16:14:47] [info] Service started in 1265 ms.\n[2004-11-11 16:14:47] [1110 prunsrv.c] [debug] Waitning worker to finish...\n[2004-11-11 16:14:51] [531  javajni.c] [debug] Java Worker thread finished\n[2004-11-11 16:14:51] [1115 prunsrv.c] [debug] Worker finished.\n[2004-11-11 16:14:51] [info] Run service finished.\n[2004-11-11 16:14:51] [info] Procrun finished.\n[2004-11-11 16:15:00] [1193 prunsrv.c] [debug] Procrun log initialized\n[2004-11-11 16:15:00] [info] Running Service...\n[2004-11-11 16:15:00] [1036 prunsrv.c] [debug] Inside ServiceMain...\n[2004-11-11 16:15:00] [info] Starting service...\n[2004-11-11 16:15:00] [408  javajni.c] [debug] Jvm Option[0]\n-Dcatalina.home=C:\\Program Files\\Apache Software Foundation\\Tomcat 5.5\n[2004-11-11 16:15:00] [408  javajni.c] [debug] Jvm Option[1]\n-Djava.endorsed.dirs=C:\\Program Files\\Apache Software Foundation\\Tomcat\n5.5\\common\\endorsed\n[2004-11-11 16:15:00] [408  javajni.c] [debug] Jvm Option[2]\n-Djava.io.tmpdir=C:\\Program Files\\Apache Software Foundation\\Tomcat 5.5\\temp\n[2004-11-11 16:15:00] [408  javajni.c] [debug] Jvm Option[3] -Xrs\n[2004-11-11 16:15:00] [408  javajni.c] [debug] Jvm Option[4]\n-Djava.class.path=C:\\Program Files\\Apache Software Foundation\\Tomcat\n5.5\\bin\\bootstrap.jar\n[2004-11-11 16:15:00] [408  javajni.c] [debug] Jvm Option[5] vfprintf\n[2004-11-11 16:15:01] [494  javajni.c] [debug] argv[0] = start\n[2004-11-11 16:15:02] [907  prunsrv.c] [debug] Java started\norg/apache/catalina/startup/Bootstrap\n[2004-11-11 16:15:02] [info] Service started in 1281 ms.\n[2004-11-11 16:15:02] [1110 prunsrv.c] [debug] Waitning worker to finish...\n[2004-11-11 16:15:06] [531  javajni.c] [debug] Java Worker thread finished\n[2004-11-11 16:15:06] [1115 prunsrv.c] [debug] Worker finished.\n[2004-11-11 16:15:06] [info] Run service finished.\n[2004-11-11 16:15:06] [info] Procrun finished.\nI am running Tomcat 5.5.12 and jdk1.5.0_06, and I still get this problem.\nThis problem will happen from time to time, maybe after 3 days of normal \nrunning. The stack trace is :\n\njava.lang.IllegalMonitorStateException: current thread not owner\n\tat java.lang.Object.notifyAll(Native Method)\n\tat org.apache.tomcat.util.net.AprEndpoint$Worker.run\n(AprEndpoint.java:1216)\nI am running Tomcat 5.5.12 and jdk1.5.0_06, and I still get this problem.\nThis problem will happen from time to time, maybe after 3 days of normal \nrunning. The stack trace is :\n\njava.lang.IllegalMonitorStateException: current thread not owner\n\tat java.lang.Object.notifyAll(Native Method)\n\tat org.apache.tomcat.util.net.AprEndpoint$Worker.run\n(AprEndpoint.java:1216)Michael, your bug is different, please open a new Bugzilla issue for it.  Yours\nhas to do with the AprEndpoint / APR connector, brand new to Tomcat 5.5, and\ndoes not have to do with the JIT/HotSpot/JDK 1.2.2 issues encountered earlier.',?,OTHER
14230,'JSP errorPage mechanism is failing in HEAD build of Tomcat 5','Tomcat 5',Catalina,Ryan.Lubke,dev,'It would seem a problem has appeared in dispatching a request to an error page\ndefined in a JSP.\n\nHere is an example of the failure from Watchdog:\n\n   [java]  [watchdog] ERROR: Server\'s response and configured goldenfile do not\nmatch!\n     [java]  [watchdog] Response received from server:\n     [java]  [watchdog] ---------------------------------------------------------\n     [java]  [watchdog] <html><head><title>Apache Tomcat/5.0 - Error\nreport</title><STYLE><!--H1{font-family : sans-serif,Arial,Tahoma;color :\nwhite;background-color : #0086b2;} H3{font-family :\nsans-serif,Arial,Tahoma;color : white;background-color : #0086b2;}\nBODY{font-family : sans-serif,Arial,Tahoma;color : black;background-color :\nwhite;} B{color : white;background-color : #0086b2;} HR{color : #0086b2;}\n--></STYLE> </head><body><h1>HTTP Status 500 - </h1><HR size=\"1\"\nnoshade><p><b>type</b> Exception report</p><p><b>message</b>\n<u></u></p><p><b>description</b> <u>The server encountered an internal error ()\nthat prevented it from fulfilling this request.</u></p><p><b>exception</b>\n<pre>java.lang.ArithmeticException: / by zero\n     [java]  [watchdog] \tat\norg.apache.jsp.positiveErrorPage_jsp._jspService(positiveErrorPage_jsp.java:63)\n     [java]  [watchdog] \tat\norg.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:135)\n\n\nInstead of the defined error page being invoked, the default error page\nmechanism for uncaught exceptions is being used.\n\nI don\'t believe this to be an issue with Jasper2 as it relies on the Servlet\ncontainer\'s RequestDispatcher to handle this functionality.Reverting costin\'s flush-in-release patch fixes this problem',?,BUG
14273,'Unable to invoke a fragment within a tag in a tag file','Tomcat 5',Jasper,prasad.subramanian,dev,'If there is a tag file that contains a tag( simple or classic), and \n> within the body of the tag a fragment is invoked using the jsp:invoke \n> action, the tag file throws a compilation error.\n> e.g:\n> <!-- a.tag -->\n> <\%@attribute name=\"frag\" fragment=\"true\" \%>\n> <ct:complexTag var=\"foo\" >\n>     <jsp:invoke fragment=\"frag\" />\n> </ct:complexTag>\n> \n> In this case the _jspx_out that is passed to the getFrag.invoke(...) \n> creates the problem, as the compler finds that this is not defined in \n> the helper class.\n> \n>Fixed.\n',?,BUG
14413,'NPE while using jsp:attribute in JSP Document','Tomcat 5',Jasper,prasad.subramanian,dev,'If a JSPDocument has a jsp:attribute that has both the attributes specified as\nXML style attributes ,a NPE is thrown while parsing. In case the value attribute\nis specified as a body then the JSP document is compiled and executed properly.\n\nHere is the JSP Document :\n<jsp:root xmlns:jsp=\"http://java.sun.com/JSP/Page\" xmlns:st=\"/SimpleTaglib\"  \nversion=\"2.0\" >\n <st:simplefmtbegin var=\"myDt\" pattern=\"MM/dd/yyyy\" >\n    \t<jsp:attribute name=\"input\" value=\"02/02/2001\"/>\n </st:simplefmtbegin>\n <jsp:text><![CDATA[ <br> This is the date <br> ]]> </jsp:text>\n \n <jsp:text><![CDATA[ <br> This is the date from EL <br> ]]> </jsp:text>\n \n <jsp:text>${myDt}</jsp:text>\n     \n</jsp:root>\n\n=====\nHere is the error \n=====\njava.lang.NullPointerException\n\tat\norg.apache.jasper.compiler.JspDocumentParser.endElement(JspDocumentParser.java:380)\n\tat\norg.apache.xerces.parsers.AbstractSAXParser.endElement(AbstractSAXParser.java:585)\n\tat\norg.apache.xerces.parsers.AbstractXMLDocumentParser.emptyElement(AbstractXMLDocumentParser.java:222)\n\tat\norg.apache.xerces.impl.XMLNamespaceBinder.emptyElement(XMLNamespaceBinder.java:595)\n\tat\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanStartElement(XMLDocumentFragmentScannerImpl.java:747)\n\tat\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(XMLDocumentFragmentScannerImpl.java:1477)\n\tat\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:329)\n\tat org.apache.xerces.parsers.DTDConfiguration.parse(DTDConfiguration.java:525)\n\tat org.apache.xerces.parsers.DTDConfiguration.parse(DTDConfiguration.java:581)\n\tat org.apache.xerces.parsers.XMLParser.parse(XMLParser.java:152)\n\tat org.apache.xerces.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1175)\n\tat javax.xml.parsers.SAXParser.parse(SAXParser.java:394)\n\tat org.apache.jasper.compiler.JspDocumentParser.parse(JspDocumentParser.java:180)\n\tat org.apache.jasper.compiler.ParserController.parseFile(ParserController.java:207)\n\tat org.apache.jasper.compiler.ParserController.parse(ParserController.java:150)\n\tat org.apache.jasper.compiler.ParserController.parse(ParserController.java:139)\n\tat org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:263)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:413)\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:552)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:297)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:295)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:241)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:280)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:194)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:276)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)\n\tat org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2523)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat\norg.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:172)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)\n\tat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:223)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:413)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:380)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:537)\n\tat\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:533)\n\tat java.lang.Thread.run(Thread.java:536)Fixed.\nA more meaningful exception (consistent with the exception thrown in the\nstandard syntax case) is now thrown (notice that it is illegal for\n<jsp:attribute> to specify a \'value\' attribute).',?,BUG
14526,' not supported in standard syntax','Tomcat 5',Jasper,jan.luehe,dev,'<jsp:element> currently is supported in XML syntax only. According to the spec,\nwhich has been clarified in this respect, it also must be supported in standard\nsyntax.',?,SPEC
14616,'Redirects should be issued prior to authentication challenges','Tomcat 5',Catalina,Keith,dev,'4.0.6 exhibits this wrong behavior:\n GET /foo                       ->  401\n GET /foo with auth             ->  301 to /foo/\n GET /foo/ with auth            ->  200    \n GET /bar with auth  .. (browser will send auth to other realms!)\n\nIt should exhibit this correct behavior (as Apache does):\n GET /foo                       ->  301 to /foo/\n GET /foo/                      ->  401\n GET /foo/ with auth            ->  200\n GET /bar  WITHOUT auth\n\nOtherwise, browsers will cache and send auth information for the\nentire domain and not just a protected directory.Proposed patch (against TOMCAT_4_1_18):\n\nIndex: \ncatalina/src/share/org/apache/catalina/authenticator/AuthenticatorBase.java\n===================================================================\nRCS file: /home/cvs/jakarta-tomcat-\n4.0/catalina/src/share/org/apache/catalina/authenticator/AuthenticatorBase.java,\nv\nretrieving revision 1.35\ndiff -u -r1.35 AuthenticatorBase.java\n--- catalina/src/share/org/apache/catalina/authenticator/AuthenticatorBase.java\n16 Nov 2002 04:49:22 -0000      1.35\n+++ catalina/src/share/org/apache/catalina/authenticator/AuthenticatorBase.java\n12 Mar 2003 02:34:45 -0000\n@@ -443,6 +443,17 @@\n         }\n         HttpRequest hrequest = (HttpRequest) request;\n         HttpResponse hresponse = (HttpResponse) response;\n+\n+        // Do not authenticate prior to redirects for trailing slashes,\n+        // at least for the root of the context\n+        String requestURI = hrequest.getDecodedRequestURI();\n+        String contextPath = this.context.getPath();\n+        if (requestURI.charAt(requestURI.length() - 1) != \'/\' &&\n+            requestURI.equals(contextPath)) {\n+            context.invokeNext(request, response);\n+            return;\n+        }\n+\n         if (debug >= 1)\n             log(\"Security checking request \" +\n                 ((HttpServletRequest) request.getRequest()).getMethod() + \" \" +\n@@ -473,8 +484,6 @@\n         // Special handling for form-based logins to deal with the case\n         // where the login form (and therefore the \"j_security_check\" URI\n         // to which it submits) might be outside the secured area\n-        String contextPath = this.context.getPath();\n-        String requestURI = hrequest.getDecodedRequestURI();\n         if (requestURI.startsWith(contextPath) &&\n             requestURI.endsWith(Constants.FORM_ACTION)) {\n             if (!authenticate(hrequest, hresponse, config)) {Fixed in 4.1.23, changed product and version as a placeholder to do this work \nin 5.0.Remy informs me this is fixed in 5.0, super.',?,IMPROVEMENT
14660,'Unable to use custom tag when running applicaiton in war','Tomcat 5',Jasper,jian.cai,dev,'When the web application was running as a war file (unpacked), the JSPer \nthrough a exception of compiling the JSP. And the custom tags got error.  But \nthe same applicaiton can be run when the webapplication unpacked.\n\nthe exception is :\n\njava.lang.NullPointerException\n        at org.apache.jasper.compiler.SmapUtil.inputSmapPath(SmapUtil.java:163)\n        at org.apache.jasper.compiler.SmapUtil.generateSmap(SmapUtil.java:104)\n        at org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:303)\n        at org.apache.jasper.compiler.Compiler.compile(Compiler.java:413)\n        at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext\n.java:552)\n        at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper\n.java:297)\n        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:2\n95)\n        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:241)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(Appl\nicationFilterChain.java:280)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationF\nilterChain.java:194)\n        at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDisp\natcher.java:727)\n        at org.apache.catalina.core.ApplicationDispatcher.doInclude(ApplicationD\nispatcher.java:616)\n        at org.apache.catalina.core.ApplicationDispatcher.include(ApplicationDis\npatcher.java:530)\n        at com.sun.j2ee.workflow.taglib.InsertTag.doEndTag(InsertTag.java:63)\n        at org.apache.jsp.template_jsp._jspx_meth_j2ee_insert_4(template_jsp.jav\na:198)\n        at org.apache.jsp.template_jsp._jspService(template_jsp.java:95)\n        at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:138)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper\n.java:317)\n        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:2\n95)\n        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:241)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(Appl\nicationFilterChain.java:280)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationF\nilterChain.java:194)\n        at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDisp\natcher.java:727)\n        at org.apache.catalina.core.ApplicationDispatcher.doForward(ApplicationD\nispatcher.java:464)\n        at org.apache.catalina.core.ApplicationDispatcher.forward(ApplicationDis\npatcher.java:356)\n        at com.sun.j2ee.workflow.control.web.MainServlet.doGet(MainServlet.java:\n127)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:740)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(Appl\nicationFilterChain.java:280)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationF\nilterChain.java:194)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperV\nalve.java:276)\n        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex\nt.invokeNext(StandardPipeline.java:643)\n        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav\na:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)\n\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextV\nalve.java:191)\n        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex\nt.invokeNext(StandardPipeline.java:643)\n        at org.apache.catalina.valves.RequestListenerValve.invoke(RequestListene\nrValve.java:170)\n        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex\nt.invokeNext(StandardPipeline.java:641)\n        at org.apache.catalina.authenticator.AuthenticatorBase.invoke(Authentica\ntorBase.java:474)\n        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex\nt.invokeNext(StandardPipeline.java:641)\n        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav\na:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)\n\n        at org.apache.catalina.core.StandardContext.invoke(StandardContext.java:\n2523)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.j\nava:180)\n        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex\nt.invokeNext(StandardPipeline.java:643)\n        at org.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatche\nrValve.java:170)\n        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex\nt.invokeNext(StandardPipeline.java:641)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.j\nava:172)\n        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex\nt.invokeNext(StandardPipeline.java:641)\n        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav\na:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)\n\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineVal\nve.java:174)\n        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex\nt.invokeNext(StandardPipeline.java:643)\n        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav\na:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)\n\n        at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:22\n3)\n        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java\n:413)\n        at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.proce\nssConnection(Http11Protocol.java:380)\n        at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java\n:537)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadP\nool.java:533)\n        at java.lang.Thread.run(Thread.java:536)\nInsertTag:doEndTag caught: org.apache.jasper.JasperException: Unable to compile\nclass for JSPHere is the simple way to reproduce the bug:\n\nIn the server.xml add the following <Context..> entry inside the <Host\nname=\"localhost\" ...> element\n\nlike:\n \n<Host name=\"localhost\" debug=\"0\" appBase=\"webapps\"\n       unpackWARs=\"true\" autoDeploy=\"true\">\n......\n\n        <Context className=\"org.apache.catalina.core.StandardContext\"\ncachingAllowed=\"true\"\ncharsetMapperClass=\"org.apache.catalina.util.CharsetMapper\" cookies=\"true\"\ncrossContext=\"false\" debug=\"0\" displayName=\"JSPSample\"\ndocBase=\"jsp-examples2.war\"\nmapperClass=\"org.apache.catalina.core.StandardContextMapper\" override=\"true\"\npath=\"/jsp-examples2\" privileged=\"false\" reloadable=\"false\" useNaming=\"true\"\nwrapperClass=\"org.apache.catalina.core.StandardWrapper\">\n        </Context>\n\n\n\tthe context points to a jsp-examples2.war (just a copy of the jsp-examples.war)\nas docBase. When the containter starts, there will be no jsp-examples2 directory\ncreated. The webapplication can be access in http://localhost:8080/jsp-examples2/\n\nbut when click the links of the samples, there will be exception:\n\nSuch as:\n\njava.lang.NullPointerException\n        at org.apache.jasper.compiler.SmapUtil.inputSmapPath(SmapUtil.java:163)\n        at org.apache.jasper.compiler.SmapUtil.generateSmap(SmapUtil.java:104)\n        at org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:303)\n        at org.apache.jasper.compiler.Compiler.compile(Compiler.java:413)\n        at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext\n.java:552)\n        at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper\n.java:297)\n        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:2\n95)\n        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:241)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(Appl\nicationFilterChain.java:280)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationF\nilterChain.java:194)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperV\nalve.java:276)\n        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex\nt.invokeNext(StandardPipeline.java:643)\n        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav\na:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)\n\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextV\nalve.java:191)\n        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex\nt.invokeNext(StandardPipeline.java:643)\n        at org.apache.catalina.authenticator.AuthenticatorBase.invoke(Authentica\ntorBase.java:474)\n        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex\nt.invokeNext(StandardPipeline.java:641)\n        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav\na:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)\n\n        at org.apache.catalina.core.StandardContext.invoke(StandardContext.java:\n2523)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.j\nava:180)\n        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex\nt.invokeNext(StandardPipeline.java:643)\n        at org.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatche\nrValve.java:170)\n        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex\nt.invokeNext(StandardPipeline.java:641)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.j\nava:172)\n        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex\nt.invokeNext(StandardPipeline.java:641)\n        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav\na:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)\n\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineVal\nve.java:174)\n        at org.apache.catalina.core.StandardPipeline$StandardPipelineValveContex\nt.invokeNext(StandardPipeline.java:643)\n        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav\na:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)\n\n        at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:22\n3)\n        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java\n:413)\n        at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.proce\nssConnection(Http11Protocol.java:380)\n        at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java\n:537)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadP\nool.java:533)\n        at java.lang.Thread.run(Thread.java:536)\n</Host>',?,BUG
14854,'Allow redeploying tag libraries from the same jar, do not lock the jar files on Windows','Tomcat 5',Jasper,petr.jiricka,dev,'There are two separate but related problems:\n\nWhen Jasper loads .tld files from the tag library jar files, it does not close \nthe jar files. Because of this, the file can not be deleted/overwritten on \nWindows, which causes pain when developing the application (and frequent \nchanges are desirable).\n\nWhen using Jasper inside Catalina, then a workaround is to stop the application \nusing the manager application (or stop the server, but that does not help the \nspeed of the development cycle). However, when Jasper is used outside the \nserver as a standalone embedded application, then there is no workaround. \n\nThe second problem is that Jasper uses the caches in JarURLConnection, which \nmeans that one .tld can not be redeployed from the same jar. A simple fix is to \ncall connection.setUseCaches(false), which now in JDK 1.4 finally works.\n\nAnother minor issue in class TldLocationsCache is the fact that it does not \nalways close the .tld file stream, which seems strange. I don\'t see any reason \nwhy not to close the stream.\n\nThe following patch may not be a complete solution to all these problems, but \nit goes in that direction. Please consider applying it. \n\nThanks. PetrCreated attachment 3953\nPatch which partially addresses the above issuesPatch applied.\n\nI notice that redeployMode is not on by default; should we?\n\nAlso, does this patch fixes the problems in the bug report?  If so, please\nupdate bugzilla.  If not, what are the problems that was not addressed?There have been some changes in this area of the code, and since I haven\'t heard\nfrom you, I assume that it has been fixed.  Reopen if that\'s not the case.',?,RFE
15002,'Tag files in different directories not belonging to different tag libraries','Tomcat 5',Jasper,jan.luehe,dev,'Tag files located in different directories must belong to different implicit tag\nlibraries.\n\nHowever, Jasper currently stores the corresponding tag handlers in the same\ndirectory (<web-app-name>/tagfiles/org/apache/jsp/tagfile/) and assigns them to\nthe same package.\n\nFor example, the tag handlers corresponding to\n\n  /WEB-INF/tags/foo/test.tag and\n  /WEB-INF/tags/bar/test.tag\n\nin a web application named \"webtest\" are both stored in \n\n  <scratch_dir>/webtest/tagfiles/org/apache/jsp/tagfile/test.javaThe path of a tag file is now reflected in the directory in which the\ncorresponding tag handler is stored, and in the name of the package to\nwhich the tag handler is assigned.\n\nThis change also avoids conflicts between tag files with the same name\nand path under /META-INF/tags/ and /WEB-INF/tags/, by adding \"meta\" or\n\"web\", respectively, to the directory and package names of the\nrespective tag handlers.*** Bug 14741 has been marked as a duplicate of this bug. ***This fix breaks ALL tag files with the latest checkout from cvs you get this\nif you run the Hello World tag file example :\n\norg.apache.jasper.JasperException: Unable to compile class for JSP\n\tat org.apache.jasper.JspCompilationContext.compile\n(JspCompilationContext.java:564)\n\tat org.apache.jasper.servlet.JspServletWrapper.loadTagFile\n(JspServletWrapper.java:207)\n\tat org.apache.jasper.compiler.TagFileProcessor.loadTagFile\n(TagFileProcessor.java:388)\n\tat org.apache.jasper.compiler.TagFileProcessor.access$000\n(TagFileProcessor.java:83)\n\tat \norg.apache.jasper.compiler.TagFileProcessor$TagFileLoaderVisitor.visit\n(TagFileProcessor.java:430)\n\tat org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1038)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1554)\n\tat org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:1596)\n\tat org.apache.jasper.compiler.Node$Visitor.visit(Node.java:1602)\n\tat org.apache.jasper.compiler.Node$Root.accept(Node.java:345)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1554)\n\tat org.apache.jasper.compiler.TagFileProcessor.loadTagFiles\n(TagFileProcessor.java:448)\n\tat org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:285)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:413)\n\tat org.apache.jasper.JspCompilationContext.compile\n(JspCompilationContext.java:558)\n\tat org.apache.jasper.servlet.JspServletWrapper.service\n(JspServletWrapper.java:289)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile\n(JspServlet.java:295)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:241)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:280)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:194)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:277)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:490)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)\n\tat org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:191)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke\n(AuthenticatorBase.java:496)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:490)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)\n\tat org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2523)\n\tat org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:180)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.valves.ErrorDispatcherValve.invoke\n(ErrorDispatcherValve.java:170)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:149)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:172)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:490)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)\n\tat org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:174)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:490)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service\n(CoyoteAdapter.java:223)\n\tat org.apache.coyote.http11.Http11Processor.process\n(Http11Processor.java:432)\n\tat \norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio\nn(Http11Protocol.java:386)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java:534)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:530)\n\tat java.lang.Thread.run(Thread.java:536)\n\n\nroot cause \n\njava.io.FileNotFoundException: no such file: C:\\dev\\jakarta\\jakarta-tomcat-5\n\\build\\work\\Standalone\\localhost\\jsp-examples\\tags\\helloWorld.class\n\tat org.apache.jasper.compiler.SmapUtil$SDEInstaller.(SmapUtil.java:220)\n\tat org.apache.jasper.compiler.SmapUtil$SDEInstaller.install\n(SmapUtil.java:208)\n\tat org.apache.jasper.compiler.SmapUtil.installSmap(SmapUtil.java:147)\n\tat org.apache.jasper.compiler.Compiler.generateClass(Compiler.java:404)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:414)\n\tat org.apache.jasper.JspCompilationContext.compile\n(JspCompilationContext.java:558)\n\tat org.apache.jasper.servlet.JspServletWrapper.loadTagFile\n(JspServletWrapper.java:207)\n\tat org.apache.jasper.compiler.TagFileProcessor.loadTagFile\n(TagFileProcessor.java:388)\n\tat org.apache.jasper.compiler.TagFileProcessor.access$000\n(TagFileProcessor.java:83)\n\tat \norg.apache.jasper.compiler.TagFileProcessor$TagFileLoaderVisitor.visit\n(TagFileProcessor.java:430)\n\tat org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1038)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1554)\n\tat org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:1596)\n\tat org.apache.jasper.compiler.Node$Visitor.visit(Node.java:1602)\n\tat org.apache.jasper.compiler.Node$Root.accept(Node.java:345)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1554)\n\tat org.apache.jasper.compiler.TagFileProcessor.loadTagFiles\n(TagFileProcessor.java:448)\n\tat org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:285)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:413)\n\tat org.apache.jasper.JspCompilationContext.compile\n(JspCompilationContext.java:558)\n\tat org.apache.jasper.servlet.JspServletWrapper.service\n(JspServletWrapper.java:289)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile\n(JspServlet.java:295)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:241)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:280)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:194)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:277)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:490)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)\n\tat org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:191)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke\n(AuthenticatorBase.java:496)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:490)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)\n\tat org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2523)\n\tat org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:180)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.valves.ErrorDispatcherValve.invoke\n(ErrorDispatcherValve.java:170)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:149)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:172)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:490)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)\n\tat org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:174)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:490)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:996)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service\n(CoyoteAdapter.java:223)\n\tat org.apache.coyote.http11.Http11Processor.process\n(Http11Processor.java:432)\n\tat \norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio\nn(Http11Protocol.java:386)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java:534)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:530)\n\tat java.lang.Thread.run(Thread.java:536)\n\nAll the tag file examples of the jsp-examples webapp work for me.\nPlease make sure to remove your installation\'s scratch dir and to\ndo a clean build of jasper.\nI tried building the whole of tomcat-5 from scratch on a different machine and \ngot the same error. \n\nAfter investigating it more it seems that the problem is that the tagfile java \nfile is being created in the wrong directory. When I hit the hello world tagfile\nexample the helloWorld.java is in this directory :\n\n\\Standalone\\localhost\\jsp-examples\\tags\n\nwhen it should be in \n\n\\Standalone\\localhost\\jsp-examples\\tags\\org\\apache\\jsp\\tag\\web\n\nAfter copying the java file to this directory and hitting the jsp again it works\n\nSo to reiterate i get this with a complete fresh checkout of all of tomcat-5.I also get the same error as Richard, both for the JSP examples and for any tag \nfiles I write from scratch.  I am using the nightly build of Tomcat 5 on \nWindows NT 4.0, with clean directories.  It worked up until November 27 and \nstopped working after this fix was applied.Looking into this. Problem must be related to file path separators on Windows.\nExamples work fine on Solaris.\nI\'m unable to reproduce this, so I assume it has been fixed, and just not \nupdated in Bugzilla.  Anyone who can reproduce it, please reopen.\n\nRunning a fresh checkout of Tomcat 5 on Windows XP, I was able to run all the \ntagfile examples in the jsp-examples webapp.\n\nI also tested the original problem case of /WEB-INF/tags/foo/test.tag and /WEB-\nINF/tags/bar/test.tag.  There was no sign of a conflict, and the tags compiled \nto <scratch_dir>/<appname>/org/apache/jsp/tag/web/foo/test.java and \n<scratch_dir>/<appname>/org/apache/jsp/tag/web/bar/test.java, respectively, as \nJan\'s note said they would.',?,BUG
15003,'Tag pool size not configurable','Tomcat 5',Jasper,jan.luehe,dev,' Added init parameter named \"tagPoolSize\".\n',?,RFE
15189,'Error message provided when jsp:param element is not used properly is misleading','Tomcat 5',Jasper,Ryan.Lubke,dev,'Example:\n\ntest.jsp\n--------------------------\n\n<jsp:param name=\"param1\" value=\"value1\" />\n\n<\%-- end of JSP --\%>\n\nWhen Jasper processes this page the following error message is returned:\n\n  \'The action is not a recognizable standard action.\'\n\nThis is somewhat misleading since jsp:param is a valid standard action, but the\nusage context is incorrect.\n\nI would like to request that the parser be enhanced to handle such cases so that\nmeaningful error messages can be provided.',?,IMPROVEMENT
15337,'ArrayIndexOutOfBoundException thrown when bad JSP provided to Jasper parser','Tomcat 5',Jasper,Ryan.Lubke,dev,'Given the following invalid JSP page:\n----------- Invalid.jsp ----------------\n\n<jsp:plugin code=\"foo.class\" codebase=\"/\" >\n\n----------------------------------------\n\nThe following exception is raised:\n\n[java] </pre></p><p><b>root cause</b>\n<pre>java.lang.ArrayIndexOutOfBoundsException: 329\n     [java]     at org.apache.jasper.compiler.JspReader.peekChar(JspReader.java:222)\n     [java]     at org.apache.jasper.compiler.JspReader.isSpace(JspReader.java:412)\n     [java]     at\norg.apache.jasper.compiler.JspReader.skipSpaces(JspReader.java:320)\n     [java]     at\norg.apache.jasper.compiler.JspReader.matchesOptionalSpacesFollowedBy(JspReader.java:309)\n\n\nI think Jasper could report this a bit better stating the action isn\'t closed\nvs. what is currently returned.',?,BUG
15338,'jsp:params action used outside of the expected context yields misleading error message.','Tomcat 5',Jasper,Ryan.Lubke,dev,'Given the following JSP:\n\n-------- InvalidUsage.jsp -----------\n\n<jsp:params>\n   <jsp:param name=\"param1\" value=\"value1\" />\n</jsp:params>\n\n-------------------------------------\n\nThe following error is returned:\norg.apache.jasper.JasperException: /JspParamsUsageContextTest.jsp(10,5) The\naction is not a recognizable standard action.\n\nThis is misleading as jsp:params is a standard action.',?,BUG
15354,'Jasper doesn\'t cause a translation error if an EL or RT expression is provided to an attribute of jsp:plugin that doesn\'t accept dynamic attribute values.','Tomcat 5',Jasper,Ryan.Lubke,dev,'According to Sections JSP.1.14.1 and JSP.5.7, the only attributes of the\njsp:plugin action that accept dynamic attribute values are the height and width\nattributes.  \n\nA translation-time error must occur if any other attribute of the jsp:plugin\naction is provided either an EL or RT expression.\n\nA translation error doesn\'t occur in this case for the following attributes:\n\nalign\ncodebase\ncode\nhspace\nvspace\niepluginurl\nnspluginurl\njreversion\nname\ntype *\n\n* When providing an RT or EL expression to the \'type\' attribute\n  a translation error does occur, but for the wrong reason.  The\n  error in this case is that the value provided to the type attribute\n  is invalid.  The value must be \'bean\' or \'applet\'.Add \'archive\' to the list of static attributes.',?,BUG
15355,'If a jsp:params element (nested within a jsp:plugin element) has no nested jsp:param elements, a translation error is not generated.','Tomcat 5',Jasper,Ryan.Lubke,dev,'The syntax for jsp:plugin, according to JSP.5.7 states that if the jsp:params\nelement is present as a child of the jsp:plugin element, it must have at least one\nnested jsp:param element.  \n\nHowever, if Jasper is provided a JSP that contains such an error condition, no\ntranslation-time error is raised.',?,BUG
15360,'jsp:fallback action used outside of the expected context yields misleading error message.','Tomcat 5',Jasper,Ryan.Lubke,dev,'Given the following JSP:\n\n-------- InvalidUsage.jsp -----------\n\n<jsp:fallback>fallback_text</jsp:fallback>\n\n-------------------------------------\n\nThe following error is returned:\norg.apache.jasper.JasperException: /JspParamsUsageContextTest.jsp(10,5) The\naction is not a recognizable standard action.\n\nThis is misleading as jsp:fallback is a standard action.',?,BUG
15364,'The jsp:body action doesn\'t work as expected when used with the jsp:fallback action.','Tomcat 5',Jasper,Ryan.Lubke,dev,'If the body of jsp:fallback is supplied via a jsp:body action, the jsp:body\naction is treated as template text and appears in the response.\n\nExample output:\n------------------------------------------\n<OBJECT classid=clsid:8AD9C840-044E-11D1-B3E9-00805F499D93 name=\"test\"\nwidth=\"10\" height=\"10\" hspace=\"1\" vspace=\"1\" align=\"middle\"\ncodebase=\"http://www.nowaythiswebsitecouldpossiblyexist.com\">\n     [java] <PARAM name=\"java_code\" value=\"foo.class\">\n     [java] <PARAM name=\"java_codebase\" value=\"/\">\n     [java] <PARAM name=\"java_archive\" value=\"test.jar\">\n     [java] <PARAM name=\"type\" value=\"application/x-java-bean;version=1.3.1\">\n     [java] <PARAM name=\"test\" value=\"testvalue\">\n     [java] <COMMENT>\n     [java] <EMBED type=\"application/x-java-bean;version=1.3.1\" name=\"test\"\nwidth=\"10\" height=\"10\" hspace=\"1\" vspace=\"1\" align=\"middle\"\npluginspage=\"http://www.nowaythiswebsitecouldpossiblyexist.com\"\njava_code=\"foo.class\" java_codebase=\"/\" java_archive=\"test.jar\" test=\"testvalue\">\n     [java] <NOEMBED>\n     [java] </COMMENT>\n     [java]                 <jsp:body>fallback_text</jsp:body>\n     [java] </NOEMBED></EMBED>\n     [java] </OBJECT>',?,BUG
15391,'Jasper generates a translation error if the body of jsp:params is supplied though jsp:body','Tomcat 5',Jasper,Ryan.Lubke,dev,'Given the following segment\n-------------------------------------------------\n\n<jsp:plugin code=\"foo.class\" codebase=\"/\">\n    <jsp:params>\n        <jsp:body>\n            <jsp:param name=\"param1\" value=\"param2\" />\n        </jsp:body>\n    </jsp:params>\n</jsp:plugin>\n\n--------------------------------------------------\n\nA translation error is incorrectly generated with the following\nmessage.\n\n  Expected \"param\" tag with \"name\" and \"value\" attributes\n\nSection 5.11 of the 2.0 PFD states:\n\n  \"It is also legal to use the <jsp:body> standard action to supply\n   bodies to standard actions, for *any* standard action that accepts\n   a body.\"',?,BUG
15404,' are not present in the TLD','Tomcat 5',Jasper,Ryan.Lubke,dev,'According to the PFD specification, the TLD elements <jsp-version> and\n<tlib-version> are supposed to be mandatory, however, Jasper doesn\'t raise an\nerror condition if it encounters a TLD with these elements missing.',?,BUG
15410,'if the jsp:attribute action is used out of the spec\'d context, a misleading error message is generated.','Tomcat 5',Jasper,Ryan.Lubke,dev,'The following message is generated when using jsp:attribute in a context other\nthan nesting within a standard or custom action:\n\n    - The action is not a recognizable standard action.\n\nThis error is misleading as jsp:attribute is a standard action...just the usage\ncontext is incorrect.\n\nWould like to request that Jasper be enhanced to have a more meaningful error\nmessage.',?,IMPROVEMENT
15411,'A translation error does not occur if jsp:attribute is used to provide an attribute value for an XML element that should be conisdered template text.','Tomcat 5',Jasper,Ryan.Lubke,dev,'JSP.5.10 - <jsp:attribute> - states:\n\n  \"The action must only appear as a subelement of a standard or custom action.  \n   An attempt to use it otherwise must result in a translation error.\"\n\nThe spec then gives an example\n\n  \"For example, it cannot be used to specify the value of an attribute for\n   XML elements that are template text.\"\n\nGiven the following:\n\n-----------------------------------------------\n<?xml version=\"1.0\"?>\n\n<root>\n    <child>\n        <jsp:attribute xmlns:jsp=\"http://java.sun.com/JSP/Page\"\n            name=\"myAttrName\">\n           myAttrValue\n        </jsp:attribute>\n    </child>\n</root>\n-------------------------------------------\n\nA translation-time error is not generated.',?,BUG
15771,'correction needed to Makefile.apxs','Tomcat 5',Connector:AJP,phil,dev,'jk/native2/server/apache13/Makefile.apxs.in\nthe line with $(APXS) in it needs to be fixed, to replace\n\n  mod_jk2.c\n\nwith something like\n\n ${C_FILES}\n\nThen C_FILES needs to be defined to add jk_service_apache13.c\n\neg:\n\nC_FILES=jk_service_apache13.c mod_jk2.c\n\nthe code does not properly build as-is, since the DSO will be missing the code\nin jk_service_apache13.c\n\n\nPS: This is with \"jk2-2.0.2\" source.\n\nI think it should really have its own bug area. But since it doesnt, I guess I\nhave to file the bug in this section.Fixed per patch suggestions.',?,BUG
15772,'catalina\'s web.xml missing mime-types some incorrect...','Tomcat 5',Catalina,hoju,dev,'I had reported a bug with Tomcat-4.1.10 missing xml and xsl mime type entries. \nIt was fixed shortly thereafter, but it doesn\'t seem as if the change ever made\nit to Tomcat5.  There are also a few other issues that are listed below...\n\nThe following mime-types are missing...\n\n<mime-mapping>\n    <extension>jsf</extension>\n    <mime-type>text/plain</mime-type>\n</mime-mapping>\n<mime-mapping>\n    <extension>jspf</extension>\n    <mime-type>text/plain</mime-type>\n</mime-mapping>\n\nThe above was added in the Tomcat-4.1.11 release by Remy.  See the following for\ninfo:\nhttp://nagoya.apache.org/bugzilla/show_bug.cgi?id=11674\n\n<mime-mapping>\n    <extension>xml</extension>\n    <mime-type>text/xml</mime-type>\n</mime-mapping>\n<mime-mapping>\n    <extension>xsl</extension>\n    <mime-type>text/xml</mime-type>\n</mime-mapping>\n\n\nThe following is wrong...\n\n<mime-mapping>\n    <!-- WML Script Source -->\n    <extension>wmls</extension>\n    <mime-type>text/vnd.wap.wmls</mime-type>\n</mime-mapping>\n\nit should be...\n\n<mime-mapping>\n    <!-- WML Script Source -->\n    <extension>wmls</extension>\n    <mime-type>text/vnd.wap.wmlscript</mime-type>\n</mime-mapping>\n\nI also cleaned up a couple of white space issues that were different between the\nTomcat-4.1.18 web.xml file and the Tomcat-5.0 nightly web.xml file.  A corrected\nversion is coming up...\n\nJakeCreated attachment 4327\nzip file containing corrected web.xml based on Tomcat-5.0-nightly 2003-01-02OK I have ported the change from Tomcat 4.1.x branch and make the change you\nrequested. What is the white space issue?\n\n-- JeanfrancoisThe white-space issue isn\'t much of an issue.  In the mods I made, I just made \nsure that anything in common between the web.xml from Tomcat-4.1.18 and Tomcat-\n5.0 looked exactly the same.  Since Tomcat-4.1.18 is the stable side of things, \nI made the web.xml of Tomcat-5.0 match that of Tomcat-4.1.18.  In the case of \nwhite-space, this means that if the web.xml of Tomcat-5.0 had an extra tab at \nthe end of a line where it didn\'t in Tomcat-4.1.18, I removed it to make it \nmatch Tomcat-4.1.18\'s web.xml.  To see what I am talking about, perform a diff \non the old Tomcat-5.0 web.xml and compare it to that of Tomcat-4.1.18.  Notice \nthe differences where there really shouldn\'t be any?\n\nDoes that make sense?  It may seem pedantic, but it makes it easier to perform \ndiff\'s on the files so that it is easier to keep them in sync.  Again, not a \nbig issue, but I figured I might as well fix it while I was making other more \nmeaningful changes.  Thanks for applying the changes!\n\nJake',?,BUG
15774,'tomcat5 shared/lib behavior different than that of tomcat4.1.x','Tomcat 5',Catalina,hoju,dev,'Using Tomcat-4.1.x, I can have separate instances of Tomcat running which access\ntheir own shared/lib folder.  In Tomcat-5.0 latest nightly build, that doesn\'t\nseem to be the case.  In fact, Tomcat5 only ever sees CATALINA_HOME/shared/lib\nwhere Tomcat4.1.x only ever sees CATALINA_BASE/shared/lib and only when\nCATALINA_BASE happens to be the same as CATALINA_HOME does Tomcat4.1.x see\nCATALINA_HOME/shared/lib.\n\nFor instance, using Tomcat-4.1.18, if I have some jars in\nCATALINA_HOME/shared/lib and I start up a new tomcat instance with CATALINA_BASE\nset as something other than CATALINA_HOME, the jars in CATALINA_HOME/shared/lib\nwill *not* be loaded.  Instead, jars will be loaded from\nCATALINA_BASE/shared/lib (if it exists).  This is the behavior I expect and love!\n\nHowever, using Tomcat-5.0, if I set things up the same way, jars in\nCATALNIA_HOME/shared/lib *will* be loaded and jars in CATALNIA_BASE/shared/lib\nare completely ignored. This is behavior that I don\'t expect and don\'t like.\n\nFor a concrete example...\nI use the capability of running separate instances of Tomcat to run apps which\nrequire different versions of xerces.  I put xerces-1.4.4.jar in\nCATALINA_HOME/shared/lib for apps which I use most often.  However, I have other\napps that need either slightly modified version of xerces-1.4.4 or require\nxerces-2.x.x.  For those cases, I run separate instances of Tomcat (running on\ndifferent ports, of course), each with a distinct CATALNIA_BASE and a local\nCATALINA_BASE/shared/lib with the appropriately versioned jars that I need for a\nparticular set of apps.  Everyone is happy because everyone gets to use their\nown shared set of libraries without stepping on each other.\n\nSo, obviously, this is a great feature in Tomcat-4.1.x (and, I assume,\nTomcat-4.0.x) but it seems to be broken in Tomcat-5.0.  \n\nIs this new behavior in Tomcat-5.0 a bug or was it intentional?  If it was\nintentional, can someone please explain the reasons for the change in behavior\nto that of Tomcat-4.1.x?\n\nJakeThis should work off CATALINA_BASE by default again now. You may also configure \nthe CL using conf/catalina.properties (so don\'t complain).Thanks Remy,\n\nNo complaints here.  I had no idea it was setable in catalina.propeties as that\ndidn\'t exist in Tomcat-4.x.x.  Without default behavior being the same as\nTomcat-4.1.x, though, I think that would be an issue for those counting on the\nbehavior and not having the proper info on how to get the desired behavior. \nThis just makes the default config of Tomcat-5 simpler.  Again, thanks for\nmaking the change and pointing out where I can change it myself.\n\nJakeActually, the classloading scheme may undergo a radical change by the time\nTomcat 5 gets released.',?,OTHER
15851,'Parser generates a NullPointerException for invalid use case of jsp:attribute instead of a useful message.','Tomcat 5',Jasper,Ryan.Lubke,dev,'Consider the following fragment which is supposed to generate a translation-time\nerror:\n\n<jsp:attribute>\n    <jsp:attribute name=\"name\">\n        someattr\n    </jsp:attribute>\n    <jsp:body>\n        someattrvalue\n    </jsp:body>\n</jsp:attribute>\n\nAccording to the specification, if a jsp:attribute standard action is nested\nwithin another jsp:attribute standard action, a translation error must occur.\n\nIn this case, a translation error does occur, but for the wrong reason.  Here is\nthe resulting cause:\n\n<stacktrace>\njava.lang.NullPointerException\n        at org.apache.jasper.compiler.Parser.getAttributeBodyType(Parser.java:1736)\n        at org.apache.jasper.compiler.Parser.parseNamedAttributes(Parser.java:1710)\n        at\norg.apache.jasper.compiler.Parser.parseJspAttributeAndBody(Parser.java:1045)\n        at org.apache.jasper.compiler.Parser.parseOptionalBody(Parser.java:1017)\n        at org.apache.jasper.compiler.Parser.parseCustomTag(Parser.java:1313)\n        at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1458)\n        at org.apache.jasper.compiler.Parser.parse(Parser.java:164)\n</stacktrace>NPE no longer occurs, but error message:\n\n  jsp:attribute must be the subelement of a standard or custom action\n\nis not what we want:\n\n  a jsp:attribute standard action cannot be nested within another jsp:attribute\n  standard action\nThe test page\n\n<jsp:attribute>\n    <jsp:attribute name=\"name\">\n        someattr\n    </jsp:attribute>\n    <jsp:body>\n        someattrvalue\n    </jsp:body>\n</jsp:attribute>\n\nis not a valid page.  The compiler\'s error message\n\n    jsp:attribute must be the subelement of a standard or custom action\n\nis valid.  If the page is modified so that jsp:attribute is nested in a standard\naction, such as\n\n<jsp:include>\n  <jsp:attribute>\n    <jsp:attribute name=\"name\">\n        someattr\n    </jsp:attribute>\n    <jsp:body>\n        someattrvalue\n    </jsp:body>\n  </jsp:attribute>\n</jsp:include>\n\nthen the compiler will generate the message\n\n    a jsp:attribute standard action cannot be nested within another\n    jsp:attribute standard action\n\nas expected.',?,BUG
15854,'Unable to provide a qname attribute value to the name attribute of the jsp:attribute action.','Tomcat 5',Jasper,Ryan.Lubke,dev,'According to table JSP.5-8, in particular the section regarding the \'name\'\nattribute:\n\n    \"The value of name can be a QName.  If so, the prefix must match that of the \n     action it applies to,....\"\n\nSo given the following:\n\n<some:action>\n    <jsp:attribute name=\"some:attributename\">\n        attributevalue\n    </jsp:attribute>\n</some:action>\n\nThe following error is incorrectly returned:\n\n<error>\n/JspAttributeQNameTest1.jsp(9,0) According to the TLD attribute attributename is\nmandatory for tag action\n</error>',?,BUG
15863,'An NPE occurs in Jasper2\'s parser when the body of jsp:attribute is empty.','Tomcat 5',Jasper,Ryan.Lubke,dev,'According to the JSP 2.0 specicifcation, if the body of the jsp:attribute action\nis empty, it is the equivalent of specifying \"\" as the value of the attribute.\n\nWhen Jasper2 is provided such a scenario, an NPE occurs.\n\nStacktrace below:\n\n<stacktrace>\njava.lang.NullPointerException\n        at\norg.apache.jasper.compiler.Validator$ValidateVisitor.visit(Validator.java:825)\n        at org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1022)\n        at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1634)\n        at org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:1676)\n        at org.apache.jasper.compiler.Node$Visitor.visit(Node.java:1682)\n        at org.apache.jasper.compiler.Node$Root.accept(Node.java:323)\n        at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1634)\n        at org.apache.jasper.compiler.Validator.validate(Validator.java:1167)\n        at org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:260)\n        at org.apache.jasper.compiler.Compiler.compile(Compiler.java:427)\n        at\norg.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:571)\n</stacktrace>',?,BUG
15904,'UnsupportedEncodingException not thrown if invalid charset (from content type) is set and a call to ServletResponse.getWriter() is made.','Tomcat 5',Catalina,Ryan.Lubke,dev,'According the the javadocs for Servletrespons.getWriter():\n  - \"java.io.UnsupportedEncodingException - if the charset specified in\nsetContentType cannot be used\"\n\nThe following code doesn\'t cause the UnsupportedEncodingException to be thrown:\n\nresponse.setContentType(\"text/html; charset=invalid-charset\");\nresponse.getWriter();Fixed in CVS (a few days ago).',?,BUG
15937,'Misleading error message produced if jsp:body is not a child of a standard or custom action.','Tomcat 5',Jasper,Ryan.Lubke,dev,'The following error is produced when jsp:body is not a child of a custom or\nstandard action:\n\n   \"The action is not a recognizable standard action.\"\n\nThis is misleading as jsp:body is indeed a standard action.',?,IMPROVEMENT
15961,'getBodyContent() is not returning null when the action has only jsp:attribute actions within the body.','Tomcat 5',Jasper,Ryan.Lubke,dev,'JSP.5.11 states:\n\n\"If one or more jsp:attribute elements appear in the body of a tag invocation\nbut no jsp:body element appears, it is the equivalent of the tag having an empty\nbody\"\n\nConsider the following example using a tag handler that extends BodyTagSupport\nand implements DynamicAttributes\n\n<body:cemptybody>\n    <jsp:attribute name=\"attr1\">value1</jsp:attribute>\n    <jsp:attribute name=\"attr2\">value2</jsp:attribute>\n</body:cemptybody>\n\nThe cemptybody action attempts to validate that a call to getBodyContent()\nreturns null.\n\nKeep in mind that the javadocs state that setBodyContent() will not be invoked for \nan empty tag.The issue has been resolved for Classic tag handlers, however a clarification\nhas been added to the spec with regards to this case with Simple tag handlers:\n\nJSP.12.6, item 5, bullet 1: Change to:\n\n    * If the tag is declared to have a body-content\n      of \"empty\" or no body or an empty body is passed\n      for this invocation, then null is passed to\n      setJspBody().\n\nIf the TLD doesn\'t mark body-content as empty and an empty jsp:body element is\nprovided, getJspBody() doesn\'t return null as it should.\n',?,BUG
15964,'Wrong source paths in generated SMAP file entries','Tomcat 5',Jasper,jph,dev,'One of the new features of Jasper in Tomcat 5 is that it attaches a \"Source\nMap\" attribute to class files to describe the file name and line number\nmapping from a JSP source file to the generated Java source file.\n\nAccording to JSR-45, each file entry in the SMAP defines a source name,\nand optionally, a source path.  The SMAP that I see in the class files\ngenerated by Jasper doesn\'t specify a source path.  This means that the\nsource path defaults to a subdirectory based on the package of the class\nfile.  In other words, for class files generated by Jasper, the source\npath ends up being \"org/apache/jsp\".  This is the source path for both\nthe \"JSP\" stratum and the \"Java\" stratum.  The problem is that this\nsource path is wrong for both strata, given how Jasper stores files.\n\nAn example would help explain this.  Say the user wants to debug the\n\"numguess.jsp\" file that\'s part of the \"jsp-examples\" web application\nthat comes with Tomcat.  I\'ve written a debugger that allows the user to\nenter directory names that the debugger should search for source files.\nOther debuggers have pretty much the same technique for finding source\nfiles.  For this discussion, let\'s call this the debugger\'s \"search\npath\".  Let\'s say the entries in the search path are \"A\" and \"B\".  When\na debugger wants to locate a source file corresponding to a particular\nlocation in a class, it uses the Java Debugging Interface (JDI) API to\nread the source name and source path for the stratum it intends to use\nfor the display.  Let\'s assume for the moment it wants to use the JSP\nstratum.  So the debugger first looks for the file\n\"A/org/apache/jsp/numguess.jsp\", then for\n\"B/org/apache/jsp/numguess.jsp\".  You get the idea.  The problem is that\nthere\'s no directory that the user could specify in the debugger\'s\nsearch path that allows the debugger to find the file, because the jsp\nfile doesn\'t reside in a \"org/apache/jsp\" subdirectory of any directory.\nInstead, it resides in the \"TH/webapps/jsp-examples/num\" directory,\nwhere \"TH\" is the Tomcat home directory.\n\nOne possibility would be for Jasper to specify \".\" (just a dot, meaning\nthe current directory) as the source path in the SMAP for the JSP\nstratum.  Then the user could enter \"TH/webapps/jsp-examples/num\" as the\npath to search.  The debugger would be able to locate the file, since it\nwould then be looking for \"TH/webapps/jsp-examples/num/./numguess.jsp\".\nBut I have a better suggestion:  How about specifying the subdirectory\nof the directory in which the web application is expanded?  Continuing\nthe example, this means specifying the source path \"num\" for the file\n\"numguess.jsp\".  The user would then enter \"TH/webapps/jsp-examples\"\ninto the debugger\'s search path.  When the debugger tries to locate the\nfile, it will paste together these three pieces and come up with\n\"TH/webapps/jsp-examples/num/numguess.jsp\", successfully finding the\nfile.  The advantage of this approach is that the user need only enter\nthe top directory of the web application into the debugger\'s search path\nand the debugger will then be able to locate any JSP file for the web\napplication.  If \".\" were used, the user would need to enter every\ndirectory under the web application\'s top directory that contains a JSP\nto be debugged into the debugger\'s search path.\n\nA similar problem exists for the \"Java\" stratum.  If the user of the\ndebugger wanted to debug the JSP using the Java stratum, the debugger\nwould try to locate the \"numguess_jsp.java\" file by searching the\nsubdirectories of the debugger\'s search path.  But again, the debugger\nwould be unable to find the java file because it doesn\'t reside in a\n\"org/apache/jsp\" subdirectory of any directory.  Just poking around,\nJasper seems to put the Java source file under the \"TH/work\" directory, in\nmy case in the directory \"TH/work/Standalone/localhost/jsp-examples/num\".\nThe solution here isn\'t as simple as for the JSP stratum, however, since I\ndon\'t think it\'s possible to change the source path for a file in the Java\nstratum in the SMAP.  In other words, the source path for\n\"numguess_jsp.java\" is stuck being \"org/apache/jsp\", since that\'s the\npackage the class is in.  So, I can think of only two solutions:\n\n1. Put the java file into the expected hierarchy.  Perhaps designate that\n   the \"jsp\" subdirectory of the web application\'s work directory will be\n   the root of all jsp-related Java source files.  Then change the Jasper\n   source code generator to write the Java source file into the directory\n   \"TH/work/Standalone/localhost/jsp-examples/jsp/org/apache/jsp\".  So the\n   user of the debugger would enter\n   \"TH/work/Standalone/localhost/jsp-examples/jsp\" into the debugger\'s\n   search path, allowing it to locate any Java source file generated by\n   Jasper for that web application.  I don\'t know if it\'s even necessary to\n   create a \"jsp\" top directory.  I suggested it only to keep these source\n   and class files out the way of any other files in the work area, but if in\n   fact the work area isn\'t used for anything else, then leave it off.\n\n2. Change the package associated with the generated Java file, so\n   that the source file can be found where it is today.  I don\'t\n   really like this suggestion, but I thought I\'d mention it.  In our\n   example, this means generating the source such that the\n   \"numguess_jsp.java\" source file starts with \"package num\" instead\n   of \"package org.apache.jsp\".  In this case, the user would enter\n   \"TH/work/Standalone/localhost/jsp-examples\" into the debugger\'s\n   search path, allowing it to locate any Java source file generated\n   by Jasper for that web application.It looks like that if we use package names that mirror the file heirachy for the\nJSP files, and place the .java and .class files in the similiar directory\nheirachy, then we can solve the problem for both JSP and Java stratum.  Let me\nelaborate.\n\nThe file TC/webapps/jsp-examples/num/numguess.jsp will have the package name of\n\"jsp.jsp-examples.num\".  The prepend the name \"jsp\" is for the top level JSP\nfiles, since they have to be in a package.  The generated .java and .class files\nwill then be in TC/work/Standalone/localhost/jsp/jsp-examples/num directory. \nThen we can leave the source path empty, as is now, and it\'ll be easy for the\nuser to tell the debugger where to find the .jsp and .class files.\n\nIf you think this will work, I\'ll make a proposal on the tomcat-dev.I like your proposal, I think.  To make sure I understand what you\'re proposing,\nI\'ll continue the example for the numguess.jsp file:\n\n1. For the JSP stratum, you\'ll store a source path of jsp-examples/num.\n2. For the Java stratum, you\'ll put the generated Java and class files into the\n   directory TC/webapps/work/Standalone/localhost/jsp/jsp-examples/num, and use\n   a package name of jsp.jsp-examples.num in the Java file.\n\nThis seems very convienient for the user of the debugger.  They would add\nTC/webapps to their debugger\'s search path in order to debug any JSP file (if\nthe war files are being exploded) in any web app in the JSP stratum, and\nTC/webapps/work/Standalone/localhost to the search path to debug any generated\nJava file in any web app in the Java stratum.Fixed with my latest commit.  Let me know if there are problems.',?,IMPROVEMENT
15966,'Jasper parser is incorrectly handling empty jsp:body elements','Tomcat 5',Jasper,Ryan.Lubke,dev,'Given the following productions:\n\nJspBodyBody ::= (S? JspBodyEmptyBody)\n              | (S> \'>\' (JspBodyBodyContent - \'\') \'</jsp:boyd>\'\n\nand\n\nJspBodyEmptyBody ::=   \'/>\'\n                     | \'></jsp:body>\'\n                     | <TRANSLATION_ERROR>\n\nJasper generates a translation error with the error message of \n\"&lt;jsp:body&gt; must not have any attributes\" When it encounters \nsomething like:\n\n  <ctm:action>\n     <jsp:body />\n  <ctm:action>\n\n\nFor the following code snippet:\n\n   <ctm:action>\n      <jsp:body></jsp:body>\n   <cts:action>\n\nThis error message is generated at translation time:\n\n  \"Empty body not allowed for &lt;jsp:body&gt;\"  \n\nwhich is incorrect according to the grammar.',?,BUG
15967,'IllegalStateException not thrown by HttpSession.getLastAccessedTime() if session has been invalidated.','Tomcat 5',Catalina,Ryan.Lubke,dev,'According to the javadocs for HttpSession.getLastAccessedTime() will throw \nan IllegalStateException if called against a method that has been invalidated.I have added the proper exception.\n\nThanks :-)getLastAccessedTime has never been marked as throwing IllegalStateException\n(J2EE 1.2 => 1.4), and this is non-sense to make it throw it, because it\'s the\nonly way to detect conveniently that a session is in timeout (combined with\ngetMaxInactiveInterval).Although this exception isn\'t in the pdf for the 2.4 spec it is in source code\nand the javadoc. It was clearly intended to be there. It would have been\nincluded in the pdf if it wasn\'t for the typo that was corrected in the first\nerrata.\n\nSee http://jcp.org/aboutJava/communityprocess/maintenance/jsr154/errata204.txt\nfor more details.> Although this exception isn\'t in the pdf for the 2.4 spec\n\nIt has never been in the PDF spec, neither 2.2, 2.3 nor 2.4.\n\n> it is in source code and the javadoc.\n\nIt has never been in the publicized javadoc, neither 2.2, 2.3 nor 2.4.\nhttp://java.sun.com/j2ee/1.4/docs/api/javax/servlet/http/HttpSession.html#getLastAccessedTime()\nThere is no source code for 2.2 or 2.3, it\'s binary only and non-normative.\n\n> It was clearly intended to be there. [...]\n> See http://jcp.org/aboutJava/communityprocess/maintenance/jsr154/errata204.txt\n> for more details.\n\nI stand corrected. Maintenance Review 1 adds IllegalStateException on getId and getLastAccessedTime. Maintenance Review 5 (for 2.5) removes it from getId, but \"leaves\" it on getLastAccessedTime.\nAt least we\'ve won a new definition of \"clearly intended\": \"never present during 5 years of maintained documentation, and render the method useless\". For the \"method useless\" part, see http://bugs.sun.com/view_bug.do?bug_id=6470831 , ain\'t it sweet to access internal method to circumvent a \"clearly intended\" misbehaviour? All we need now is to mark getMaxInactiveInterval() as throwing the same exception :-)',?,BUG
16027,'Misleading error message generated when jsp:body is nested within another jsp:body element.','Tomcat 5',Jasper,Ryan.Lubke,dev,'In the case described in the summary, a translation error is generated, but\nerror message returned by the translation time error is misleading:\n\n   \"jsp:body must be the subelement of a standard or custom action\"',?,IMPROVEMENT
16030,'Incorrected error message generated when jsp:body is used to provide the body of a jsp:attribute action','Tomcat 5',Jasper,Ryan.Lubke,dev,'The JSP 2.0 specification states that a translation-time error must occur if\njsp:body is used to provide the body of a jsp:attribute action.\n\nWhile Jasper does generate a translation-time error for this case, the error\nmessage is incorrect:\n\n    \"The action is not a recognizable standard action.\"',?,BUG
16077,'Invalid error generated when translating a valid JSP document','Tomcat 5',Jasper,Ryan.Lubke,dev,'Given the following simple JSP 2.0 Document:\n<?xml version=\"1.0\"?>\n<root xmlns:jsp=\"http://java.sun.com/JSP/Page\">\n    <jsp:directive.page contentType=\"text/xml\" />\n    <jsp:text><![CDATA[Hello World]]></jsp:text>\n</root>\n\nThe following error message is now returned with the latest nightly build:\n\n  \"jsp:attribute must be the subelement of a standard or custom action\"*** Bug 16079 has been marked as a duplicate of this bug. ***Woke up a bit and noticed that the line the translator is complaining about in\nall my cases is the <root> element with the jsp namespace declaration.',?,BUG
16078,' is no longer working as expected.','Tomcat 5',Jasper,Ryan.Lubke,dev,'Given the following request line:\n\n    GET /test.jsp?param1=value1 HTTP/1.1\n\ntest.jsp\n---------------------------------------\n<jsp:forward page=\"resource.jsp\">\n    <jsp:param name=\"param1\" value=\"value2\" />\n    <jsp:param name=\"param2\" value=\"value2\" />\n</jsp:forward>\n---------------------------------------\n\nresource.jsp\n-------------------------------------------------\n<\%@ page contentType=\"text/plain\" \%>\n<\%\n    String[] param1Values = request.getParameterValues(\"param1\");\n    String[] param2Values = request.getParameterValues(\"param2\");\n    for (int i = 0; i < param1Values.length; i++) {\n        out.println(\"PARAM1 VALUE: \" + param1Values[i]);\n    }\n    for (int i = 0; i < param2Values.length; i++) {\n        out.println(\"PARAM2 VALUE: \" + param2Values[i]);\n    }\n\n\%>\n--------------------------------------------------------------------\n\nWhen checking the values of the request parameters in resource.jsp,\nparam1 has value2,value2,value1 as values instead of value2,value1.\nparam2 has value2,value2 as values instead of just value2.\n\nThis worked properly in previous builds.Fixed. mergeParameters was called twice.',?,BUG
16088,'Translation error not generated if body of jsp:attribute, providing an attribute value of type JspFragment, contains a scripting element','Tomcat 5',Jasper,Ryan.Lubke,dev,'From JSP.5.10\n\n   \"For custom action attributes of type javax.servlet.jsp.tagext.JspFragment, \n    the container must create a JspFragment out of the body of the \n    <jsp:attribute> action and pass it to the tag handler.  This applies for\n    both Classic Tag Handlers and Simple Tag Handlers.  A translation error must\n    result if the body of the <jsp:attribute> action is not scriptless in this\n    case\"\n\nGiven\n------------------------------------------------------------\n<\%@ page contentType=\"text/plain\" \%>\n<\%@ taglib uri=\"http://blurb.org\" prefix=\"attr\" \%>\n\n<attr:classic>\n    <jsp:attribute name=\"fragment\">\n        <\%= \"fragment body\" \%>\n    </jsp:attribute>\n</attr:classic>\n-------------------------------------------------------------\n\nIn the TLD, the classic tag has one attribute named \'fragment\' with the \n<fragment> element body set to true.',?,BUG
16113,'removing then replacing a jsp page continues to give a 404','Tomcat 5',Jasper,dball,dev,'Hi guys. I\'ve got what appears to be a bona fide error in tomcat\'s jsp servlet\nor one of its friends. The steps to reproduce the problem are:\n\n1. start tomcat-4.1.18 with a webapp containing a foo.jsp page\n2. hit the foo.jsp url and see the page\n3. remove foo.jsp from the webapp\n4. reload the foo.jsp url until you finally get a 404 (why does this take\nseveral tries?)\n5. replace the foo.jsp file in the webapp\n6. note that hitting the foo.jsp url will forever give you a 404 until you\nrestart tomcatI can reproduce it. It doesn\'t happen with non-JSPs, such as images, so it\nshouldn\'t be a cache bug.\nBTW, the (small) delay is there because there\'s a cache.FWIW, this problem does not occur with tomcat-4.0.6. The problem is serious\nenough in our context that we have been forced to downgrade.We\'re seeing it too. Very nasty.I have a working patch for this bug; I\'d appreciate help/advice from anyone \nmore familiar with creating and submitting patches to the Tomcat team.Any word on this bug? Very surprised to see the 4.0.x series disappear from the\njakarta mirrors with serious bugs like this outstanding in the 4.1 branch.What I wrote (patch against 4.1.24 source archive) never got in. \n\nI was building a patch file; as a sanity check, I had checked out the public CVS\ncode labeled \"TOMCAT_4_1_24\", and I saw that it didn\'t match their \"4.1.24\"\nsource archives. When I asked about this, Remy basically told me \"learn CVS\",\nand that was the only response I got. \n\nI did notice that the dev code in CVS had progressed pretty far from 4.1.24\nalready at the time, and I recall seeing some significant changes in and around\nthe relevant code... I guessed that this bug had already been fixed, and just\nforgotten in the DB. \n\nDoes this still happen in 4.1.27? I have verified that it is still a bug in 4.1.29. David, would it be possible\nfor you to mail me a copy of your patch?If you have a patch, preferably against 5.0.19, please post it so we can \nevaluate how risky it is.Simply compare JspRuntimeContext.checkCompile(), this calls \nctxt.incrementRemoved() if a FileNotFoundException occur. JspServletWrapper \nonly set a 404 if a FileNotFoundException occur and finish. \n \nCode from JspRuntineContext: \n            synchronized(jsw) { \n                try { \n                    ctxt.compile(); \n                } catch (FileNotFoundException ex) { \n                    ctxt.incrementRemoved(); \n                } catch (Throwable t) { \n                    jsw.getServletContext().log(\"Background compile failed\", \n                                                t); \n                } \n            } \n \nCode from JspServletWrapper: \n \n       } catch (FileNotFoundException ex) { \n            String includeRequestUri = (String) \n                request.getAttribute(\"javax.servlet.include.request_uri\"); \n            if (includeRequestUri != null) { \n                // This file was included. Throw an exception as \n                // a response.sendError() will be ignored by the \n                // servlet engine. \n                throw new ServletException(ex); \n            } else { \n                try { \n                    response.sendError(HttpServletResponse.SC_NOT_FOUND, \n                                      ex.getMessage()); \n                } catch (IllegalStateException ise) { \n                    log.error(Localizer.getMessage(\"jsp.error.file.not.found\", \n                                                   ex.getMessage()), \n                              ex); \n                } \n \n \nadd a simple ctxt.incrementRemoved in catch block and test case works. Another solution : in JspServletWrapper, line 343, before sending\nHttpServletResponse.SC_NOT_FOUND, remove wrapper from collection of previously\ncreated wrapper : \n\nCode from JspServletWrapper: \n\n       } catch (FileNotFoundException ex) { \n            String includeRequestUri = (String) \n                request.getAttribute(\"javax.servlet.include.request_uri\"); \n            if (includeRequestUri != null) { \n                // This file was included. Throw an exception as \n                // a response.sendError() will be ignored by the \n                // servlet engine. \n                throw new ServletException(ex); \n            } else { \n                try { \n                    // BELOW 1 LINE PROPOSED FOR THIS BUG\n                    ctxt.getRuntimeContext().removeWrapper(jspUri);\n                    response.sendError(HttpServletResponse.SC_NOT_FOUND, \n                                      ex.getMessage()); \n                } catch (IllegalStateException ise) { \n                    log.error(Localizer.getMessage(\"jsp.error.file.not.found\", \n                                                   ex.getMessage()), \n                              ex); \n                } using incrementRemoved() is cleaner, it removes wrapper and java-/class-file. \n \nCode from JspCompilationContext: \n \n    // ==================== Removal ==================== \n \n    public void incrementRemoved() { \n        if (removed > 1) { \n            jspCompiler.removeGeneratedFiles(); \n            if( rctxt != null ) \n                rctxt.removeWrapper(jspUri); \n        } \n        removed++; \n    } \n OK, I agree.\n\nWhat\'s happen now? I suppose this patch must be validated and voted by Tomcat\ncommiters.Example for fixed code \n \nJspServletWrapper: \n       } catch (FileNotFoundException ex) {  \n            String includeRequestUri = (String)  \n                request.getAttribute(\"javax.servlet.include.request_uri\");  \n            ctxt.incrementRemoved() \n            if (includeRequestUri != null) {  \n                // This file was included. Throw an exception as  \n                // a response.sendError() will be ignored by the  \n                // servlet engine.  \n                throw new ServletException(ex);  \n            } else {  \n                try {  \n                    response.sendError(HttpServletResponse.SC_NOT_FOUND,  \n                                      ex.getMessage());  \n                } catch (IllegalStateException ise) {  \n                    log.error(Localizer.getMessage(\"jsp.error.file.not.found\",  \n                                                   ex.getMessage()),  \n                              ex);  \n                }  \n  oh, you reminder JspServletWrapper/JspCompilationContext in your reminder, \nread the discussion on tomcat-user currently. \n \ni agree with Q. Bordeaux. \n \nsome live-enviroment requires jasper background compilation or development \nenabled. \nsome not, use precompile instead. \n Created attachment 10692\npoproposed patchPatch applied.  Thanks.Does this patch is applied to both Tomcat 5.x and Tomcat 4.1.x or only to Tomcat\n5.x?I just applied the patch to 4.1.x also.*** Bug 35650 has been marked as a duplicate of this bug. ***',?,BUG
16127,'Seems to be a problem doing a static include of content when using a different charset.','Tomcat 5',Jasper,Ryan.Lubke,dev,'According to JSP.4.1 of the 2.0 specificiation, Files included using the include\ndirective are read using the character encoding of the including page.\n\nFor my case, I have a JSP Document encoded in UTF-16BE (the JSP Document also\nsets the response content type to text/plain; charset=ISO-8859-1\".  The document\nuses an include directive to include another text document also encoded in\nUTF-16BE.  \n\nReviewing the result of the page, I can see that the included content is still\nin UTF-16BE instead of ISO-8859-1 (note, I can leave off the contentType\nattribute of the page directive so that the response is text/xml with a charset\nof UTF-8, but it makes no difference).\n\nHere is the calling JSP Document:\n-------------------------------------------------\n?xml version=\"1.0\" encoding=\"UTF-16BE\"?>\n<root xmlns:jsp=\"http://java.sun.com/JSP/Page\">\n    <jsp:directive.page contentType=\"text/plain; charset=ISO-8859-1\" />\n    <jsp:directive.include file=\"inclusion_utf-16BE.txt\" />\n</root>\n-------------------------------------------------\n\nThe included text file contains (encoded in UTF-16BE):       \n    <included>Included Content</included>\n\n\nThe result that I\'m seeing looks something like:\n\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n<root\nxmlns:jsp=\"http://java.sun.com/JSP/Page\">^@<^@i^@n^@c^@l^@u^@d^@e^@d^@>^@I^@n^@c^@l^@u^@d^@e^@d^@\n^@C^@o^@n^@t^@e^@n^@t^@<^@/^@i^@n^@c^@l^@u^@d^@e^@d^@>^@\n</root>\n\nThis was working in previous builds.Ok, maybe it doesn\'t work, but since the writer object used is the same, and the\nincluding page can\'t set its own encoding either, I\'d like you to explain how it\ncan not work (or if it doesn\'t, how I can make it work).It seems I misunderstood the bug report.Ryan,\n\nJSP.4.1 talks about the \"Page Character Encoding\", but from your bug report it\nseems like you are complaining about the response character encoding, which is\ncovered in JSP.4.2 (\"Response Character Encoding\").\n\nIt seems like in your example, both the JSP document and its included segment\nare read using the UTF-16BE encoding specified in the JSP document\'s XML prolog.\nSo far so good.\n\nHowever, since the wrapping JSP document specifies a response encoding of\nISO-8859-1, you would expect the response to be encoded that way. I agree, but\nJSP.4.2 actually does not mention anything about it. I\'ll ping Mark to see if he\ncould clarify JSP.4.2.\n\nThanks,\n\nJan\n\nSorry, JSP.4.2 already is perfectly clear. I thought it needed to mention\nsomething about included JSP segments, but that\'s not needed, since they\'re\nexpanded in place.\n\nI\'ve fixed the bug in my private workspace and will commit my changes soon.\n',?,BUG
16129,'A translation-time error is not raised when the value of the page directives pageEncoding attribute fails to match that of the xml prolog of the JSP document.','Tomcat 5',Jasper,Ryan.Lubke,dev,'A translation error is not generated when Jasper is presented the following:\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<root>\n    <jsp:directive.page \n         xmlns:jsp=\"http://java.sun.com/JSP/Page\"\n         pageEncoding=\"ISO-8859-1\" />\n</root>\n\nJSP.4.1 states the following for JSP documents:\n\n   \"It is a translation-time error to name different encodings \n    in two or more of the following:  the XML prolog of a JSP\n    page, the pageEncoding attribute of the page directive of the\n    JSP page, and in a JSP configuration element whose URL pattern\n    matches the page.\n\nThis worked as expected in previous builds.',?,BUG
16395,'Incorrect SMAP mapping information','Tomcat 5',Jasper,martin.grebac,dev,'I\'ve got following included jsps:\n\nhello.jsp:\n----------\n<HTML>\n<HEAD>\n<TITLE>Hello example</TITLE>\n</HEAD>\n<BODY>\n<\%@ include file=\"greeting.jsp\" \%>\n</BODY>\n</HTML>\n\ngreeting.jsp:\n-------------\nHello there!<P>\nGoodbye on January\n\nWhen the hello.jsp is compiled, SMAP information included in the classfile looks\nlike this:\n\nSMAP\nhello_jsp.java\nJSP\n*S JSP\n*F\n0 hello.jsp\n1 greeting.jsp\n*L\n0:0,0\n0:45\n1:46\n2:47\n2:48\n3:49\n4:50\n5:0,0\n0#1:0,0\n0:51\n0:52\n5#0:53\n6:54\n7:55\n*E\n\nwhere line 5:0,0 is incorrectly mapped.',?,BUG
16572,'Compile error when invoking tag file that uses JSTL','Tomcat 5',Jasper,hans,dev,'A simple JSP page:\n\n  <\%@ taglib prefix=\"my\" tagdir=\"/WEB-INF/tags/mytags\" \%>\n  <my:test/>\n\ninvoking a simple tag file:\n  <\%@ taglib prefix=\"c\" uri=\"http://java.sun.com/jstl/core_rt\" \%>\n  <jsp:useBean id=\"now\" class=\"java.util.Date\" />\n  <c:out value=\"${now}\" />\n\nResults in:\norg.apache.jasper.JasperException: Unable to compile class for JSP\n\nAn error occurred at line: -1 in the jsp file: null\n\nGenerated servlet error:\n\n\n\n\tat\norg.apache.jasper.compiler.DefaultErrorHandler.javacError(DefaultErrorHandler.java:120)\n\tat org.apache.jasper.compiler.ErrorDispatcher.javacError(ErrorDispatcher.java:307)\n\tat org.apache.jasper.compiler.Compiler.generateClass(Compiler.java:405)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:429)\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:572)\n\tat\norg.apache.jasper.servlet.JspServletWrapper.loadTagFile(JspServletWrapper.java:215)\n\tat\norg.apache.jasper.compiler.TagFileProcessor.loadTagFile(TagFileProcessor.java:446)\n\tat org.apache.jasper.compiler.TagFileProcessor.access$000(TagFileProcessor.java:84)\n\tat\norg.apache.jasper.compiler.TagFileProcessor$TagFileLoaderVisitor.visit(TagFileProcessor.java:488)\n\tat org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1033)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1700)\n        [...]\n\nIf I change the tag file to not use <c:out>, everything works fine:\n\n  <jsp:useBean id=\"now\" class=\"java.util.Date\" />\n  ${now}\n\nSince I\'ve seen the same error with other JSTL (1.0.1) actions, I assume there\'s\na problem with JSTL (or custom actions in general) in tag files.The bug was due to a recent change in tag pooling, and the changes introduced a\nbug when tag pooling is enabled in a tag file.  The method\norg.apache.jasper.runtime.TagHandlerPool.getTagHandlerPool has been modified to\ntake a jspServlet, which a tag file is not.  Hence the bug.\n\nA workaround is to turn off tag pooling.',?,BUG
16727,'Incorrect exception raised when tag file uses jsp:invoke to store result of fragment into session scope and calling page doesn\'t participate in a session.','Tomcat 5',Jasper,Ryan.Lubke,dev,'Table JSP.5-8 states that the container must throw am IllegalStateException at\nruntime if scope is session and the calling page does not participate in a session.\n\nConsider the following:\n\nTestPage.jsp\n-----------------------------------------\n<\%@ page session=\"false\" \%>\n<\%@ taglib tagdir=\"/WEB-INF/tags\" prefix=\"tags\" \%>\n<tags:notInSession>\n    <jsp:attribute name=\"attr1\">\n        attribute value\n    </jsp:attribute>\n</tags:notInSession>\n------------------------------------------\n\nnotInSession.tag\n------------------------------------------\n<\%@ attribute name=\"attr1\" fragment=\"true\" \%>\n\n<jsp:invoke fragment=\"attr1\" var=\"someVar\" scope=\"session\" />\n------------------------------------------\n\nIf I wrap the section of the calling page that invokes the tag with \na try catch, an Exception is indeed thrown, but it is an instance of\nJspException.  If I check the root exception of the JspException it is\nan instance of IllegalArgumentException.',?,IMPROVEMENT
16728,'Translation error not raised of jsp:attribute is provided an invalid value to the \'scope\' attribute','Tomcat 5',Jasper,Ryan.Lubke,dev,'Table JSP.5-8 states that the valid values that can be provided to the \'scope\' \nattribute of jsp:invoke are \'page\', \'request\', \'session\', \'application\'.\n\nIf I provide values such as Page, reQuest, sessioN, or ApplicatioN a translation\nerror is not raised by the container.',?,BUG
16731,'A translation error is not raised by the container if jsp:invoke specifies the \'scope\' attribute but not \'var\' or \'varReader\'','Tomcat 5',Jasper,Ryan.Lubke,dev,'JSP.5-8 states that a translation error will result if the scope attribute\nis specified and var or varReader are not.\n\nThe current Jasper impementation doesn\'t raise any translation error and instead\nignores the scope attribute and sends the result of jsp:invoke to the current\nwriter.',?,BUG
16778,'jsp:include doesn\'t work in tag file','Tomcat 5',Jasper,ajeru,dev,'<jsp:include.../> doesn\'t seem to work in tag files. I\'m getting this exception\nwhen the tag file is compiled (this is from a nightly build I downloaded a few\ndays ago):\n\n\norg.apache.jasper.JasperException: Unable to compile class for JSP\n\nAn error occurred at line: -1 in the jsp file: null\n\nGenerated servlet error:\n    [javac] Since fork is true, ignoring compiler setting.\n    [javac] Compiling 1 source file\n    [javac] Since fork is true, ignoring compiler setting.\n    [javac]\nD:\\prog\\tomcat5\\src\\jakarta-tomcat-5\\build\\work\\Standalone\\localhost\\n6\\tags\\org\\apache\\jsp\\tag\\web\\mainframe.java:109:\ninclude(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse,java.lang.String,java.io.Writer,boolean)\nin org.apache.jasper.runtime.JspRuntimeLibrary cannot be applied to\n(javax.servlet.ServletRequest,javax.servlet.ServletResponse,java.lang.String,javax.servlet.jsp.JspWriter,boolean)\n    [javac]       org.apache.jasper.runtime.JspRuntimeLibrary.include(request,\nresponse, \"/n6/blah.html\", out, false);\n    [javac]                                                  ^\n    [javac] 1 error\n\n\n\n\tat\norg.apache.jasper.compiler.DefaultErrorHandler.javacError(DefaultErrorHandler.java:120)\n\tat org.apache.jasper.compiler.ErrorDispatcher.javacError(ErrorDispatcher.java:307)\n\tat org.apache.jasper.compiler.Compiler.generateClass(Compiler.java:399)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:427)\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:572)\n\tat\norg.apache.jasper.servlet.JspServletWrapper.loadTagFile(JspServletWrapper.java:215)\n\tat\norg.apache.jasper.compiler.TagFileProcessor.loadTagFile(TagFileProcessor.java:446)\n\tat org.apache.jasper.compiler.TagFileProcessor.access$000(TagFileProcessor.java:84)\n\tat\norg.apache.jasper.compiler.TagFileProcessor$TagFileLoaderVisitor.visit(TagFileProcessor.java:488)\n\tat org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1033)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1700)\n\tat org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:1742)\n\tat org.apache.jasper.compiler.Node$Visitor.visit(Node.java:1748)\n\tat org.apache.jasper.compiler.Node$Root.accept(Node.java:334)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1700)\n\tat\norg.apache.jasper.compiler.TagFileProcessor.loadTagFiles(TagFileProcessor.java:506)\n\tat org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:262)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:426)\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:572)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:297)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:293)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:288)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:294)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:490)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1005)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:196)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:490)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1005)\n\tat org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2608)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat\norg.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:172)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:490)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1005)\n\tat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:163)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:490)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1005)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:196)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:612)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:428)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:565)\n\tat\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:623)\n\tat java.lang.Thread.run(Thread.java:536)',?,BUG
16865,'EL expressions in tag files no longer works','Tomcat 5',Jasper,hans,dev,'Something is fundamentally wrong with EL evaluation in tag files, a bug that\nmust have been introduced recently (a nightly build from last week worked fine).\n\nThis tag file:\n\n  <\%@ taglib prefix=\"c\" uri=\"http://java.sun.com/jstl/core_rt\" \%>\n  <\%@ tag body-content=\"scriptless\" \%>\n\n  Static text and c:out: <c:out value=\"static text\" />\n  <br>\n  EL expr with variable and c:out: \n  <c:out value=\"${pageContext.request.servletPath}\" />\n  <br>\n  EL expr with variable in text: ${pageContext.request.servletPath}\n  <br>\n  EL expr with static text: ${\'static text\'}\n\nproduces this output when invoked from a JSP page:\n\n  Static text and c:out: static text\n  EL expr with variable and c:out:\n  EL expr with variable in text:\n  EL expr with static text: static text \n\nIn other words, evaluation of an EL expression that contains variables (I\'ve\ntested with other variables than pageContext, used here) results in the empty\nstring. An EL expression that only contains static text is evaluated correctly.The cause for this seems to be that in JspContextWrapper (which is used as the\nPageContext implementation in a tag file), the getVariableResolver() method\nreturns null.\nOkay, I\'ve verified that relaying getVariableResolver() in JspContextWrapper to\nthe original JspContext fixes this problem, i.e.:\n\n  public VariableResolver getVariableResolver() {\n    invokingJspCtxt.getVariableResolver();\n  }\nThe suggested fix would only work for attributes that are alredy defined in the\ninvoking context, and not for those that are defined locally in the tag files. \nI have a fix that I am now testing, and would commit that if it works.Nae, this is not the complete solution. Now the JSP page scope is used when\nresolving variables in the tag file. I guess JspContextWrapper needs its own\nVariableResolver that knows about the tag file\'s local page scope, but how fix\nthat is beyond what I can figure out at the moment ;-)Thanks for reporting this problem and pointing me to the right direction.',?,BUG
16899,'tomcat-5 can not compile tiles','Tomcat 5',Jasper,bpm,dev,'On solaris and linux with jdk 1.4.1, jakarta-tomcat-5 nightly build & nightly\nbuild of struts, I get the following error running any tiles based app.\n\n[ServletException in:/layouts/vboxLayout.jsp] Unable to compile class for JSP An\nerror occurred at line: 14 in the jsp file: /layouts/vboxLayout.jsp Generated\nservlet error: [javac] Since compiler setting isn\'t classic or modern,ignoring\nfork setting. [javac] Compiling 1 source file [javac] Since compiler setting\nisn\'t classic or modern,ignoring fork setting. [javac]\n/home/bpm/compile_area/cvs_jakarta/jakarta-tomcat-5/dist/work/Standalone/localhost/tiles-documentation/layouts/vboxLayout_jsp.java:68:12:68:15:\nSemantic Error: No field named \"list\" was found in type\n\"org.apache.jsp.vboxLayout_jsp\". \'\n\nand this:\n\n[ServletException in:/layout/columnsLayout.jsp] Unable to compile class for JSP\nAn error occurred at line: 13 in the jsp file: /layout/columnsLayout.jsp\nGenerated servlet error: [javac] Since compiler setting isn\'t classic or\nmodern,ignoring fork setting. [javac] Compiling 1 source file [javac] Since\ncompiler setting isn\'t classic or modern,ignoring fork setting. [javac]\n/home/bpm/compile_area/cvs_jakarta/jakarta-tomcat-5/dist/work/Standalone/localhost/tiles-documentation/layout/columnsLayout_jsp.java:72:32:72:41:\nSemantic Error: No field named \"numColsStr\" was found in type\n\"org.apache.jsp.columnsLayout_jsp\". \'\n\nAlso in the struts-exercise-taglib, the <bean:define> tags has the following error:\n\norg.apache.jasper.JasperException: Unable to compile class for JSP\n\nAn error occurred at line: 34 in the jsp file: /bean-define.jsp\n\nGenerated servlet error:\n    [javac] Since compiler setting isn\'t classic or modern,ignoring fork setting.\n    [javac] Compiling 1 source file\n    [javac] Since compiler setting isn\'t classic or modern,ignoring fork setting.\n    [javac]\n/home/bpm/compile_area/cvs_jakarta/jakarta-tomcat-5/dist/work/Standalone/localhost/struts-exercise-taglib/bean_0002ddefine_jsp.java:131:33:131:45:\nSemantic Error: No field named \"test1_boolean\" was found in type\n\"org.apache.jsp.bean_0002ddefine_jsp\".It is impossible to diagnose the cause of this compile error without seeing the\nactual page in question, so we can see what is on line 14.\n\nDoes this application compile and work correctly on Tomcat 4.1.18?  If so, it is\nlikely to be a bug in the Tomcat 5 JSP page compiler, and should be reported as\nsuch.  If not, then it is a bug in your page.\n\nEither way, you\'ll need to provide more information if you want this to be\nlooked at.\ntried out the tiles-documentation.war (nightly build) with tomcat5.0.0 alpha \nrelease. Had some initial problems with tomcat (have to manually create a \nmissing \'temp\' directory). Once tomcat was setup, i notice a peculiar behaviour:\n\nIf I visit tomcat jsp-examples first and then tiles-documentation, everything \nis fine.\n\nIf I visit tiles-documentation first, all subsequent JSP compiles fail. Am \ngoing to attach the Exception page.\n\ntomcat 4.1.12 does not show this peculiar behaviour and everything runs fine...Created attachment 4793\nJSP compile error.Sorry for not being precise.  The problem is the distributed examples from the\nstruts webapps:  1) tiles-documentation.war gives the first error, 2)\nstruts-exercise-taglibs.war gives the second error.  \n\nYes you are correct that jakarta-tomcat-5.0 alpha does compile the\ntiles-documentation.  However, the nightly builds of tomcat-5 have failed for\nthe last two weeks.  I did not know if it was a jasper compiler error as these\nerrors are only seen with struts tiles.The latest CVS co as of 2/18/03 (must disable precompile of jsp in\njakarta-tomcat-5) works just fine.',?,BUG
17052,'jsp:element name attribute clobbered by nested jsp:attribute','Tomcat 5',Jasper,Phil.Hanna,dev,'If a <jsp:element> has a nested <jsp:attribute name=\"name\">, the\n<jsp:attribute> body is erroneously used as the tag name of the\ngenerated element.\n\nThe JSP 2.0 spec JSP.5.14 says:\n\n   A jsp:element element has one mandatory\n   attribute, name, of type String. The value of\n   the attribute is used as that of the tag of the\n   element generated.\n\nIn other words,\n\n   <jsp:element name=\"foo\">\n      <jsp:attribute name=\"bar\">yada</jsp:attribute>\n   </jsp:element>\n\ngenerates this:\n\n   <foo bar=\"yada\"/>\n\nHowever, if the attribute\'s name happens to be \"name\", the tag\nname gets clobbered. Hence for this coding:\n\n   <jsp:element name=\"input\">\n      <jsp:attribute name=\"type\">text</jsp:attribute>\n      <jsp:attribute name=\"name\">userName</jsp:attribute>\n   </jsp:element>\n\ninstead of this:\n\n   <input type=\"text\" name=\"userName\" size=\"20\"/>\n\nit generates this:\n\n   <userName type=\"text\" size=\"20\"/>\n\nThis makes it impossible with XML syntax to generate HTML forms,\nthat use named input elements.\n\n--- Suggested Fix ---\n\nThe affected classes are in the org.apache.jasper.compiler package:\n\n   Generator.java\n   Node.java\n\nIn the Generator class, in the method\n\n   public void visit(Node.JspElement n)\n\nthe code currently has special handling for any attribute named\n\"name\", making it the tag name and excluding it from the rest of\nthe attribute generation.  This appears to be wrong to me, as it\nconfuses <jsp:attribute name=\"name\"> and <jsp:element\nname=\"foo\">, and it makes it impossible to create <input\ntype=\"text\" name=\"foo\"/>, as noted above.\n\nI think the fix would involve:\n\n   1. In Node.java: add a \"name\" property to the Node.JspElement\n      class, corresponding to the \"name\" attribute of the\n      <jsp:element> standard action. In the constructor, extract\n      the required \"name\" attribute passed in the first\n      parameter, and store it as the value of the name property. \n\n   2. In Generator.java: In the visit(Node.JspElement n) method,\n      take out the special handling, just using the\n      Node.JspElement \"name\" property as the tag name,\n      and allowing *all* Node.JspAttribute elements to\n      contribute to the tag attributes without skipping \"name\".',?,BUG
17059,'o.a.j.compiler.ImplicitTagLibraryInfo doesn\'t include tag files with the extension of .tagx when generating an implicit TLD','Tomcat 5',Jasper,Ryan.Lubke,dev,'JSP.8.1 states that valid extensions for tag files are .tag (standard syntax)\nand .tagx (XML syntax).\n\nLooking at the constuctor for ImplicitTagLibraryInfo, only tag files with the\nextension of .tag are considered during processing.',?,IMPROVEMENT
17061,'[PATCH] Allow tomcat5 to startup/shutdown with cygwin','Tomcat 5',Catalina,funkman,dev,'tomcat5 doesn\'t startup with cygwin.\n\nIt is because CATALINA_BASE and CATALINA_TMPDIR are set but not translated back\nto windows paths instead of cygwin paths. This is very evident when the\nenvironment variables get echoed.\n\nPatch is attached to fix catalina.shCreated attachment 4864\npatch of build/catalina.shFixed. Thanks.',?,RFE
17062,'Unable to specify the \'var\' or \'varReader\' attributes of jsp:invoke using the jsp:attribute action.','Tomcat 5',Jasper,Ryan.Lubke,dev,'Consider the following fragment of a tag file:\n\n<jsp:invoke>\n    <jsp:attribute name=\"fragment\">frag1</jsp:attribute>\n    <jsp:attribute name=\"var\">exported</jsp:attribute>\n    <jsp:attribute name=\"scope\">request</jsp:attribute>\n</jsp:invoke>\n\nWhen invoked jasper generates a translation-time error\n\n<error>\n\nJspAttributeTag.tag(7,0) Missing \'var\' or \'varReader\' attribute\n\n</error>',?,BUG
17171,'Tomcat 5 Nightly binaries are not available','Tomcat 5',Native:Packaging,mraible,dev,'I want to download a binary version of the latest Tomcat 5, but when I go to \nthe nightly builds area - the .zip and .tar.gz files are empty for the binary \nversions:\n\nhttp://cvs.apache.org/builds/jakarta-tomcat-5/nightly/Hi,\n\nwhen the build failed, a mail will be posted to tomcat-dev@jakarta.apache.org.\nLook at this list before filling a bug since the script will also fail.\n\nThanks,\n\n-- Jeanfrancois',?,OTHER
17204,'jsp:element generates incorrect output when used in a JSP Document and the element includes an xmlns attribute.','Tomcat 5',Jasper,Ryan.Lubke,dev,'Given the following segment within a JSP Document:\n\n<jsp:element name=\"elementName\"\n    xmlns:jsp=\"http://java.sun.com/JSP/Page>body</jsp:element>\n\nWill generate the following:\n\n  <elementName xmlns:jsp=\"http://java.sun.com/JSP/Page\">body</elementName>\n\nThe xmlns attribute in this case shouldn\'t be passed through to the output,\nunless explicitly set using a jsp:attribute action.',?,BUG
17310,';jsessionid confuses StandardHost....can\'t find Context','Tomcat 5',Catalina,hoju,dev,'Using Tomcat5 that I built from source today.\n\nWhen I open a new browser and go to my context...\nhttp://localhost:8081/xmlc/\n\nthe index.html redirects to this page:\nhttp://localhost:8081/xmlc/ReloadTest?docClass=xmlc.demo.WelcomeHTML\n\nAll is fine so far.  However, the URL\'s in the links of the latter page look\nsomething like this:\nhttp://localhost:8081/xmlc/ReloadTest;jsessionid=FF350A3154EDE9395DA1109ECAB92D82?docClass=xmlc.demo.test01HTML\n\n\nWhen I go the latter page I get the following error in the browser....\n\nHTTP Status 500 - No Context configured to process this request\n\ntype Status report\n\nmessage No Context configured to process this request\n\ndescription The server encountered an internal error (No Context configured to\nprocess this request) that prevented it from fulfilling this request.\nApache Tomcat/5.0\n\n\nThe console looks like this:\n\n30688 [Thread-5] INFO core.ContainerBase  - Mapping contextPath=\'/xmlc\' with\nrequestURI=\'/xmlc/ReloadTest\' and relativeURI=\'/ReloadTest\'\n30688 [Thread-5] INFO core.ContainerBase  -   Trying exact match\n30688 [Thread-5] INFO core.ContainerBase  -  Mapped to servlet \'ReloadTest\' with\nservlet path \'/ReloadTest\' and path info \'null\' and update=true\n51110 [Thread-5] ERROR core.StandardHost  - MAPPING configuration error for\nrequest URI\n\n\nIn the access log, I get this:\n\n127.0.0.1 - - [22/Feb/2003:15:27:28 -0600] \"GET\n/xmlc/ReloadTest?docClass=xmlc.demo.test01HTML HTTP/1.1\" 500 842\n\n\nSeems like a URL parsing problem in the StandardHost where it isn\'t able to\nfigure out the context path appropriately so it doesn\'t know what context to\ndelegate the request to.\n\nI don\'t have this problem at all in Tomcat-4.1.19 so it is definitely Tomcat-5\nspecific.\n\nJakeOh, I forgot to mention that stripping off the\n;jsessionid=FF350A3154EDE9395DA1109ECAB92D82 resulting in the following URL\nmakes things work like normal:\n\nhttp://localhost:8081/xmlc/ReloadTest?docClass=xmlc.demo.test01HTML\n\n\nJakeThis was fixed since.verified fixed!\n\nJake',?,BUG
17387,'A misleading error message is generated when providing an invalid body to jsp:text','Tomcat 5',Jasper,Ryan.Lubke,dev,'If providing an invalid body to jsp:text (scriplets or actions), a translation\nerror is properly generated, however, the error message is misleading.\n\n  Unterminated &lt;jsp:text&gt;',?,IMPROVEMENT
17390,'If jsp:text is provided an invalid body in the context of a JSP document, a translation error is not raised.','Tomcat 5',Jasper,Ryan.Lubke,dev,'Consider the following examples within a JSP document\n\n<jsp:text>\n    <jsp:scriptlet><![CDATA[out.println(\"HELLO\");]]></jsp:scriptlet>\n</jsp:text>\n\n - or -\n\n<jsp:text>\n    <jsp:element name=\"element1\">body</jsp:element>\n</jsp:text>\n\nIn either of the above cases, a translation error is not generated as required\nin JSP.5.15.',?,BUG
17394,'Misleading error message generated when jsp:output is used in an invalid context','Tomcat 5',Jasper,Ryan.Lubke,dev,'JSP.5.16 states that jsp:output is only valid for use in JSP documents or Tag\nfiles in XML syntax.\n\nIf jsp:output is used in either a JSP or Tag file in standard syntax, a\ntranslation error is generated, but the error message for the cause is misleading:\n\n   JspOutputUsageTag.tag(5,5) Invalid standard action\n\nThe action is valid, just the usage is incorrect.',?,IMPROVEMENT
17395,'Translation error incorrectly generated when using jsp:output in a Tag file in XML syntax','Tomcat 5',Jasper,Ryan.Lubke,dev,'JSP.5.16 states that jsp:output may be used in JSP documents and in tag files in\nXML sytnax.\n\nHowever, if I use jsp:output in a Tag file in XML syntax, the following\ntranslation-time error is returned:\n\n    JspOutputUsageXMLTag.tagx(6,9) Invalid standard action',?,BUG
17397,'Jasper incorrectly generates a translation error if the omit-xml-declaration attribute of the jsp:output action is not specified.','Tomcat 5',Jasper,Ryan.Lubke,dev,'Table JSP.5-11 states that the omit-xml-declaration attribute of the jsp:output\naction is optional.\n\nIf this attribute is not present within a document translated by Jasper, the\nfollowing error is returned:\n\n     jsp:output: Mandatory attribute omit-xml-declaration missingCreated attachment 5041\npatch to fix this issue',?,BUG
17398,'Jasper incorrectly allows a page author to specify a body for jsp:output in a JSP document.','Tomcat 5',Jasper,Ryan.Lubke,dev,'JSP.5.16 states that the jsp:output action may not have a body.  \n\nConsider the following:  \n\n<root xmlns:jsp=\"http://java.sun.com/JSP/Page\">\n    <jsp:directive.page contentType=\"text/plain\" />\n    <jsp:output omit-xml-declaration=\"yes\">\n        Test FAILED\n    </jsp:output>\n</root>\n\nNo translation error is generated.',?,BUG
17399,'Misleading error message generated when jsp:output, within a Tag file in XML syntax has a body.','Tomcat 5',Jasper,Ryan.Lubke,dev,'JSP.5.16 states that the jsp:output action may not have a body.\n\nIf jsp:output is specified with a body within a Tag file in XML syntax,\na translation-time error is correctly generated, however the cause of the \nerror is incorrect.\n\n    JspOutputBodyTag.tagx(6,9) Invalid standard action\n\nPerhaps it would be more beneficial to end users to have a more descriptive\nmessage about the issue.',?,IMPROVEMENT
17403,'NegativeArraySizeException generated when jsp:element action is missing the \'name\' attribute.','Tomcat 5',Jasper,Ryan.Lubke,dev,'Previously a meaningful error message was generated when jsp:element was used\nwithout the name attribute.\n\nNow when the same JSP is run through a build from cvs HEAD, the following\nstacktrace is generated:\n\n<stacktrace>\n[java] </pre></p><p><b>root cause</b> <pre>java.lang.NegativeArraySizeException\n     [java]     at\norg.apache.jasper.compiler.Validator$ValidateVisitor.visit(Validator.java:901)\n     [java]     at org.apache.jasper.compiler.Node$JspElement.accept(Node.java:1067)\n     [java]     at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1918)\n     [java]     at org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:1960)\n     [java]     at\norg.apache.jasper.compiler.Validator$ValidateVisitor.visit(Validator.java:670)\n     [java]     at\norg.apache.jasper.compiler.Node$UninterpretedTag.accept(Node.java:1045)\n     [java]     at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1918)\n     [java]     at org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:1960)\n     [java]     at org.apache.jasper.compiler.Node$Visitor.visit(Node.java:1966)\n     [java]     at org.apache.jasper.compiler.Node$Root.accept(Node.java:416)\n     [java]     at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:1918)\n     [java]     at\norg.apache.jasper.compiler.Validator.validate(Validator.java:1211)\n     [java]     at\norg.apache.jasper.compiler.Compiler.generateJava(Compiler.java:253)\n</stacktrace>',?,BUG
17404,'Error message generated when the name attribute is provided with a dynamic value','Tomcat 5',Jasper,Ryan.Lubke,dev,'Given the following:\n\n<jsp:element name=\"${\'element1\'}\">body1</jsp:element>\n<jsp:element name=\'<\%= \"element2\" \%>\'>body2</jsp:element>\n\nThe following error is returned when the page is translated:\n\nMandatory XML-style \'name\' attribute missing\n\nThis worked as expected in previous builds.',?,BUG
17406,'Code generation issue when using providing namespaced attributes for jsp:element in a JSP document','Tomcat 5',Jasper,Ryan.Lubke,dev,'Consider the following:\n---------------------------------------------------------------------\n<root xmlns:jsp=\"http://java.sun.com/JSP/Page\">\n    <jsp:directive.page contentType=\"text/plain\" />\n\n    <jsp:element name=\"test\">\n        <jsp:attribute name=\"test:status\">passed</jsp:attribute>\n        <jsp:body>Test PASSED</jsp:body>\n    </jsp:element>\n</root>\n---------------------------------------------------------------------\n\nThe result is the following compile error returned from Jasper:\n\n<error>\n   [javac]\n/files/j2eesrc/j2eepreint1.4fcs/j2ee13/build/unix/web/repository/Standard-Engine/localhost/jsp_core_act_attribute_web/JspAttributeQNameTest3_jspx.java:45:\n\')\' expected\n     [java]     [javac]       out.write(\"</\"null + \">\");\n     [java]     [javac]                     ^\n     [java]     [javac] 1 error\n</error>\n\nThis JSP document ran successfully in previous builds.',?,BUG
17435,'Request-time attribute values are not properly evaluated when providing values to the name attribute of jsp:element','Tomcat 5',Jasper,Ryan.Lubke,dev,'Consider the following:\n\n <jsp:element name=\'\%= \"element2\" \%\'>body2</jsp:element>\n\nThe following element is generated:\n\n <\%= \"element2\" \%>body2</\%= \"element2\" \%>',?,BUG
17438,'if omit-xml-decl is set to \'no\' or \'false\' no xml declaration is generated.','Tomcat 5',Jasper,Ryan.Lubke,dev,'Consider the following:\n\n<?xml version=\"1.0\"?>\n<root xmlns:jsp=\"http://java.sun.com/JSP/Page\">\n    <jsp:output omit-xml-declaration=\"false\" />\n</root>\n\nGenerates the following:\n\n  <root></root>',?,BUG
17492,'If the omit-xml-declaration attribute of jsp:output is \'true\' or \'yes\' in the context of a JSP document, the xml declaration is still generated.','Tomcat 5',Jasper,Ryan.Lubke,dev,'Interestingly enough, if the same situation occurs within a Tag file in XML\nsyntax, the behavior is as expected and no declaration is generated.',?,BUG
17611,'Translation error is not raised if an invalid value is provided to the version attribute of the jsp:root element','Tomcat 5',Jasper,Ryan.Lubke,dev,'Table JSP.6-2 states the only valid values for version attribute of jsp:root are\n\"1.2\" and \"2.0\".  It also states that a translation error must be raised if the\nvalue is not one of the two acceptable values.',?,BUG
17749,' tag in server.xml matters for tomcat 5.','Tomcat 5',Catalina,rajiv.mordani,dev,'When I have more than one <Service> element in the server.xml if I don\'t put\nlocalhost as the first one the server comes up with no context initialized.\nHowever if I put localhost first and then the other virtual host second then it\nseems to work fine. This works fine with tomcat 4.1.x. It is a regression in\ntomcat 5.\n\nFor example\n\n<Service name=\"foo\">\n\n    <Connector className=\"org.apache.coyote.tomcat5.CoyoteConnector\"\n               port=\"8080\" minProcessors=\"5\" maxProcessors=\"100\"\n               enableLookups=\"true\" redirectPort=\"8443\" acceptCount=\"100\"\n               debug=\"0\" connectionTimeout=\"20000\"\n               disableUploadTimeout=\"true\" />\n<Engine name=\"StandAlone\" defaultHost=\"localhost\" debug=\"0\">\n\n\n      <Realm   className=\"org.apache.catalina.realm.UserDatabaseRealm\"\n            resourceName=\"UserDatabase\"\n                   debug=\"0\"/>\n\n      <!-- Define the default virtual host -->\n      <Host name=\"localhost\" debug=\"0\" appBase=\"webapps\"\n       unpackWARs=\"false\" autoDeploy=\"true\">\n\n      </Host>\n\n    </Engine>\n</Service>\n<Service name=\"bar\">\n\n    <Connector className=\"org.apache.coyote.tomcat5.CoyoteConnector\"\n               port=\"8081\" minProcessors=\"5\" maxProcessors=\"100\"\n               enableLookups=\"true\" redirectPort=\"8443\" acceptCount=\"100\"\n               debug=\"0\" connectionTimeout=\"20000\"\n               disableUploadTimeout=\"true\" />\n\n    <Engine name=\"NewEngine\" defaultHost=\"bar\" debug=\"0\">\n\n      <!-- Define the default virtual host -->\n      <Host name=\"jwsdp-services\" debug=\"0\" appBase=\"foo/webapps\"\n       unpackWARs=\"false\" autoDeploy=\"true\">\n\n      </Host>\n\n    </Engine>\n\n  </Service>\n\nThis works but if you reverse the order of the <Service> elements it doesn\'t.*** Bug 17748 has been marked as a duplicate of this bug. ***In addition on switching the order the first service comes up. However with the\nsecond service I get the following error\n[WARN] MapperListener - -Error registering Context\nCatalina:j2eeType=WebModule,name=//foo/webapps,J2EEApplication=none,J2EEServer=none\n<java.lang.ArrayIndexOutOfBoundsException>java.lang.ArrayIndexOutOfBoundsException\n        at org.apache.tomcat.util.http.mapper.Mapper.addContext(Mapper.java:192)\n       at\norg.apache.coyote.tomcat5.MapperListener.registerContext(MapperListener.java:300)\n        at\norg.apache.coyote.tomcat5.MapperListener.handleNotification(MapperListener.java:192)\n        at\ncom.sun.management.jmx.MBeanServerNotificationListener.handleNotification(MBeanServerNotificationListener.java:48)\n        at\njavax.management.NotificationBroadcasterSupport.sendNotification(NotificationBroadcasterSupport.java:142)\n        at\njavax.management.MBeanServerDelegate.sendNotification(MBeanServerDelegate.java:176)\n        at\ncom.sun.management.jmx.MBeanServerImpl.sendNotification(MBeanServerImpl.java:2645)\n        at\ncom.sun.management.jmx.MBeanServerImpl.internal_addObject(MBeanServerImpl.java:2368)\n        at\ncom.sun.management.jmx.MBeanServerImpl.registerMBean(MBeanServerImpl.java:874)\n        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:438)\n        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:391)\n        at\norg.apache.catalina.core.StandardContext.registerJMX(StandardContext.java:4667)\n        at org.apache.catalina.core.StandardContext.start(StandardContext.java:3964)\n        at\norg.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:831)\n        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:817)\n        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:632)\n       at\norg.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:305)\n        at org.apache.catalina.core.StandardHost.install(StandardHost.java:825)\n        at\norg.apache.catalina.startup.HostConfig.deployDirectories(HostConfig.java:631)\n        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:471)\n        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:814)\n        at\norg.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:428)\n        at\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1235)\n       at org.apache.catalina.core.StandardHost.start(StandardHost.java:791)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1227)\n       at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:351)\n        at org.apache.catalina.core.StandardService.start(StandardService.java:516)\n        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2291)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:540)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at org.apache.commons.launcher.ChildMain.run(ChildMain.java:269)\n\n[WARN] MapperListener - -Error registering Wrapper\nCatalina:j2eeType=Servlet,name=default,WebModule=foo/webapps,J2EEApplication=none,J2EEServer=none\n<java.lang.ArrayIndexOutOfBoundsException>java.lang.ArrayIndexOutOfBoundsException\n        at org.apache.tomcat.util.http.mapper.Mapper.addWrapper(Mapper.java:245)\n       at\norg.apache.coyote.tomcat5.MapperListener.registerWrapper(MapperListener.java:375)\n        at\norg.apache.coyote.tomcat5.MapperListener.handleNotification(MapperListener.java:198)\n        at\ncom.sun.management.jmx.MBeanServerNotificationListener.handleNotification(MBeanServerNotificationListener.java:48)\n        at\njavax.management.NotificationBroadcasterSupport.sendNotification(NotificationBroadcasterSupport.java:142)\n        at\njavax.management.MBeanServerDelegate.sendNotification(MBeanServerDelegate.java:176)\n        at\ncom.sun.management.jmx.MBeanServerImpl.sendNotification(MBeanServerImpl.java:2645)\n        at\ncom.sun.management.jmx.MBeanServerImpl.internal_addObject(MBeanServerImpl.java:2368)\n        at\ncom.sun.management.jmx.MBeanServerImpl.registerMBean(MBeanServerImpl.java:874)\n        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:438)\n        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:391)\n        at\norg.apache.catalina.core.StandardWrapper.registerJMX(StandardWrapper.java:1516)\n        at\norg.apache.catalina.core.StandardContext.registerJMX(StandardContext.java:4674)\n        at org.apache.catalina.core.StandardContext.start(StandardContext.java:3964)\n        at\norg.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:831)\n        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:817)\n        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:632)\n       at\norg.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:305)\n        at org.apache.catalina.core.StandardHost.install(StandardHost.java:825)\n        at\norg.apache.catalina.startup.HostConfig.deployDirectories(HostConfig.java:631)\n        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:471)\n        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:814)\n        at\norg.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:428)\n        at\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1235)\n       at org.apache.catalina.core.StandardHost.start(StandardHost.java:791)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1227)\n       at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:351)\n        at org.apache.catalina.core.StandardService.start(StandardService.java:516)\n        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2291)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:540)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at org.apache.commons.launcher.ChildMain.run(ChildMain.java:269)\n\n[WARN] MapperListener - -Error registering Wrapper\nCatalina:j2eeType=Servlet,name=invoker,WebModule=jwsdp-services/jaxm-provider,J2EEApplication=none,J2EEServer=none\n<java.lang.ArrayIndexOutOfBoundsException>java.lang.ArrayIndexOutOfBoundsException\n        at org.apache.tomcat.util.http.mapper.Mapper.addWrapper(Mapper.java:245)\n       at\norg.apache.coyote.tomcat5.MapperListener.registerWrapper(MapperListener.java:375)\n        at\norg.apache.coyote.tomcat5.MapperListener.handleNotification(MapperListener.java:198)\n        at\ncom.sun.management.jmx.MBeanServerNotificationListener.handleNotification(MBeanServerNotificationListener.java:48)\n        at\njavax.management.NotificationBroadcasterSupport.sendNotification(NotificationBroadcasterSupport.java:142)\n        at\njavax.management.MBeanServerDelegate.sendNotification(MBeanServerDelegate.java:176)\n        at\ncom.sun.management.jmx.MBeanServerImpl.sendNotification(MBeanServerImpl.java:2645)\n        at\ncom.sun.management.jmx.MBeanServerImpl.internal_addObject(MBeanServerImpl.java:2368)\n        at\ncom.sun.management.jmx.MBeanServerImpl.registerMBean(MBeanServerImpl.java:874)\n        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:438)\n        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:391)\n        at\norg.apache.catalina.core.StandardWrapper.registerJMX(StandardWrapper.java:1516)\n        at\norg.apache.catalina.core.StandardContext.registerJMX(StandardContext.java:4674)\n        at org.apache.catalina.core.StandardContext.start(StandardContext.java:3964)\n        at\norg.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:831)\n        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:817)\n        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:632)\n       at\norg.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:305)\n        at org.apache.catalina.core.StandardHost.install(StandardHost.java:825)\n        at\norg.apache.catalina.startup.HostConfig.deployDirectories(HostConfig.java:631)\n        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:471)\n        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:814)\n        at\norg.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:428)\n        at\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1235)\n       at org.apache.catalina.core.StandardHost.start(StandardHost.java:791)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1227)\n       at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:351)\n        at org.apache.catalina.core.StandardService.start(StandardService.java:516)\n        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2291)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:540)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at org.apache.commons.launcher.ChildMain.run(ChildMain.java:269)\n\n[WARN] MapperListener - -Error registering Wrapper\nCatalina:j2eeType=Servlet,name=jsp,WebModule=foo/webapps,J2EEApplication=none,J2EEServer=none\n<java.lang.ArrayIndexOutOfBoundsException>java.lang.ArrayIndexOutOfBoundsException\n        at org.apache.tomcat.util.http.mapper.Mapper.addWrapper(Mapper.java:245)\n       at\norg.apache.coyote.tomcat5.MapperListener.registerWrapper(MapperListener.java:375)\n        at\norg.apache.coyote.tomcat5.MapperListener.handleNotification(MapperListener.java:198)\n        at\ncom.sun.management.jmx.MBeanServerNotificationListener.handleNotification(MBeanServerNotificationListener.java:48)\n        at\njavax.management.NotificationBroadcasterSupport.sendNotification(NotificationBroadcasterSupport.java:142)\n        at\njavax.management.MBeanServerDelegate.sendNotification(MBeanServerDelegate.java:176)\n        at\ncom.sun.management.jmx.MBeanServerImpl.sendNotification(MBeanServerImpl.java:2645)\n        at\ncom.sun.management.jmx.MBeanServerImpl.internal_addObject(MBeanServerImpl.java:2368)\n        at\ncom.sun.management.jmx.MBeanServerImpl.registerMBean(MBeanServerImpl.java:874)\n        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:438)\n        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:391)\n        at\norg.apache.catalina.core.StandardWrapper.registerJMX(StandardWrapper.java:1516)\n        at\norg.apache.catalina.core.StandardContext.registerJMX(StandardContext.java:4674)\n        at org.apache.catalina.core.StandardContext.start(StandardContext.java:3964)\n        at\norg.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:831)\n        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:817)\n        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:632)\n       at\norg.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:305)\n        at org.apache.catalina.core.StandardHost.install(StandardHost.java:825)\n        at\norg.apache.catalina.startup.HostConfig.deployDirectories(HostConfig.java:631)\n        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:471)\n        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:814)\n        at\norg.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:428)\n        at\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1235)\n       at org.apache.catalina.core.StandardHost.start(StandardHost.java:791)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1227)\n       at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:351)\n        at org.apache.catalina.core.StandardService.start(StandardService.java:516)\n        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2291)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:540)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at org.apache.commons.launcher.ChildMain.run(ChildMain.java:269)\n\n[WARN] MapperListener - -Error registering Wrapper\nCatalina:j2eeType=Servlet,name=providerservlet,WebModule=foo/webapps,J2EEApplication=none,J2EEServer=none\n<java.lang.ArrayIndexOutOfBoundsException>java.lang.ArrayIndexOutOfBoundsException\n        at org.apache.tomcat.util.http.mapper.Mapper.addWrapper(Mapper.java:245)\n       at\norg.apache.coyote.tomcat5.MapperListener.registerWrapper(MapperListener.java:375)\n        at\norg.apache.coyote.tomcat5.MapperListener.handleNotification(MapperListener.java:198)\n        at\ncom.sun.management.jmx.MBeanServerNotificationListener.handleNotification(MBeanServerNotificationListener.java:48)\n        at\njavax.management.NotificationBroadcasterSupport.sendNotification(NotificationBroadcasterSupport.java:142)\n        at\njavax.management.MBeanServerDelegate.sendNotification(MBeanServerDelegate.java:176)\n        at\ncom.sun.management.jmx.MBeanServerImpl.sendNotification(MBeanServerImpl.java:2645)\n        at\ncom.sun.management.jmx.MBeanServerImpl.internal_addObject(MBeanServerImpl.java:2368)\n        at\ncom.sun.management.jmx.MBeanServerImpl.registerMBean(MBeanServerImpl.java:874)\n        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:438)\n        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:391)\n        at\norg.apache.catalina.core.StandardWrapper.registerJMX(StandardWrapper.java:1516)\n        at\norg.apache.catalina.core.StandardContext.registerJMX(StandardContext.java:4674)\n        at org.apache.catalina.core.StandardContext.start(StandardContext.java:3964)\n        at\norg.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:831)\n        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:817)\n        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:632)\n       at\norg.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:305)\n        at org.apache.catalina.core.StandardHost.install(StandardHost.java:825)\n        at\norg.apache.catalina.startup.HostConfig.deployDirectories(HostConfig.java:631)\n        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:471)\n        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:814)\n        at\norg.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:428)\n        at\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1235)\n       at org.apache.catalina.core.StandardHost.start(StandardHost.java:791)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1227)\n       at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:351)\n        at org.apache.catalina.core.StandardService.start(StandardService.java:516)\n        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2291)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:540)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at org.apache.commons.launcher.ChildMain.run(ChildMain.java:269)\n\n[WARN] MapperListener - -Error registering Wrapper\nCatalina:j2eeType=Servlet,name=receiverservlet,WebModule=foo/webapps,J2EEApplication=none,J2EEServer=none\n<java.lang.ArrayIndexOutOfBoundsException>java.lang.ArrayIndexOutOfBoundsException\n        at org.apache.tomcat.util.http.mapper.Mapper.addWrapper(Mapper.java:245)\n       at\norg.apache.coyote.tomcat5.MapperListener.registerWrapper(MapperListener.java:375)\n        at\norg.apache.coyote.tomcat5.MapperListener.handleNotification(MapperListener.java:198)\n        at\ncom.sun.management.jmx.MBeanServerNotificationListener.handleNotification(MBeanServerNotificationListener.java:48)\n        at\njavax.management.NotificationBroadcasterSupport.sendNotification(NotificationBroadcasterSupport.java:142)\n        at\njavax.management.MBeanServerDelegate.sendNotification(MBeanServerDelegate.java:176)\n        at\ncom.sun.management.jmx.MBeanServerImpl.sendNotification(MBeanServerImpl.java:2645)\n        at\ncom.sun.management.jmx.MBeanServerImpl.internal_addObject(MBeanServerImpl.java:2368)\n        at\ncom.sun.management.jmx.MBeanServerImpl.registerMBean(MBeanServerImpl.java:874)\n        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:438)\n        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:391)\n        at\norg.apache.catalina.core.StandardWrapper.registerJMX(StandardWrapper.java:1516)\n        at\norg.apache.catalina.core.StandardContext.registerJMX(StandardContext.java:4674)\n        at org.apache.catalina.core.StandardContext.start(StandardContext.java:3964)\n        at\norg.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:831)\n        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:817)\n        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:632)\n       at\norg.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:305)\n        at org.apache.catalina.core.StandardHost.install(StandardHost.java:825)\n        at\norg.apache.catalina.startup.HostConfig.deployDirectories(HostConfig.java:631)\n        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:471)\n        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:814)\n        at\norg.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:428)\n        at\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1235)\n       at org.apache.catalina.core.StandardHost.start(StandardHost.java:791)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1227)\n       at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:351)\n        at org.apache.catalina.core.StandardService.start(StandardService.java:516)\n        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2291)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:540)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at org.apache.commons.launcher.ChildMain.run(ChildMain.java:269)\n\n[WARN] MapperListener - -Error registering Wrapper\nCatalina:j2eeType=Servlet,name=digest,WebModule=foo/webapps,J2EEApplication=none,J2EEServer=none\n<java.lang.ArrayIndexOutOfBoundsException>java.lang.ArrayIndexOutOfBoundsException\n        at org.apache.tomcat.util.http.mapper.Mapper.addWrapper(Mapper.java:245)\n       at\norg.apache.coyote.tomcat5.MapperListener.registerWrapper(MapperListener.java:375)\n        at\norg.apache.coyote.tomcat5.MapperListener.handleNotification(MapperListener.java:198)\n        at\ncom.sun.management.jmx.MBeanServerNotificationListener.handleNotification(MBeanServerNotificationListener.java:48)\n        at\njavax.management.NotificationBroadcasterSupport.sendNotification(NotificationBroadcasterSupport.java:142)\n        at\njavax.management.MBeanServerDelegate.sendNotification(MBeanServerDelegate.java:176)\n        at\ncom.sun.management.jmx.MBeanServerImpl.sendNotification(MBeanServerImpl.java:2645)\n        at\ncom.sun.management.jmx.MBeanServerImpl.internal_addObject(MBeanServerImpl.java:2368)\n        at\ncom.sun.management.jmx.MBeanServerImpl.registerMBean(MBeanServerImpl.java:874)\n        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:438)\n        at org.apache.commons.modeler.Registry.registerComponent(Registry.java:391)\n        at\norg.apache.catalina.core.StandardWrapper.registerJMX(StandardWrapper.java:1516)\n        at\norg.apache.catalina.core.StandardContext.registerJMX(StandardContext.java:4674)\n        at org.apache.catalina.core.StandardContext.start(StandardContext.java:3964)\n        at\norg.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:831)\n        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:817)\n        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:632)\n       at\norg.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:305)\n        at org.apache.catalina.core.StandardHost.install(StandardHost.java:825)\n        at\norg.apache.catalina.startup.HostConfig.deployDirectories(HostConfig.java:631)\n        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:471)\n        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:814)\n        at\norg.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:428)\n        at\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1235)\n       at org.apache.catalina.core.StandardHost.start(StandardHost.java:791)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1227)\n       at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:351)\n        at org.apache.catalina.core.StandardService.start(StandardService.java:516)\n        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2291)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:540)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at org.apache.commons.launcher.ChildMain.run(ChildMain.java:269)\n\nThe problem does not occur when non \"localhost\" service comes but when an engine\nother than \"Tomcat-Standalone\" name comes first due to\nMapperListener.registerHost has hardcoded engine object name with\n\"Tomcat-Standalone\".  I believe it\'s still under development since it has\n\"FIXME\" comment. :-)  The problems with the mapper should have been resolved now that the relevant\nhosts are properly registered with JMX.',?,BUG
17783,' value set to FORWARD only','Tomcat 5',' JSP API',dianne.jiao,dev,'Filter mapping:\n\n  <filter-mapping>\n    <filter-name>ServletMappedTest_Filter</filter-name>\n    <servlet-name>ForwardedServlet</servlet-name>\n    <dispatcher>FORWARD</dispatcher>\n  </filter-mapping>\n\nAccess ForwardedServlet directly, filter gets invoked.The forward mechanism was broken. Please try an let me know.\n\nThanks,\n\n-- JeanfrancoisFix verified in today\'s cvs build.  Thanks.',?,BUG
17784,' value set   to FORWARD only','Tomcat 5',' JSP API',dianne.jiao,dev,'Access ForwardedServlet using forward, the filter configured not get invoked:\n\npublic void forwardTest(ServletRequest request, ServletResponse response )\n                           throws ServletException, IOException {\n        String path = \"/forward/ForwardedServlet\";\n        RequestDispatcher rd = getServletContext().getRequestDispatcher( path );\n        rd.forward( request, response );\n    }\n\nFilter is configured as follow:\n  <filter-mapping>\n    <filter-name>ServletMappedTest_Filter</filter-name>\n    <servlet-name>ForwardedServlet</servlet-name>\n    <dispatcher>FORWARD</dispatcher>\n  </filter-mapping>Filter not invoked when filter is configured using <url-pattern. as well:\n\n  <filter-mapping>\n    <filter-name>ServletMappedTest_Filter</filter-name>\n    <url-pattern>/generic/*</url-pattern>\n    <dispatcher>REQUEST</dispatcher>\n    <dispatcher>INCLUDE</dispatcher>\n    <dispatcher>FORWARD</dispatcher>\n    <dispatcher>ERROR</dispatcher>\n  </filter-mapping>\nThe forward mechanism was broken. Please try an let me know.\n\nThanks,\n\n-- JeanfrancoisFix verified in today\'s cvs build. Thanks.',?,BUG
17785,'filter not invoked at all RequestDispatcher.include actions','Tomcat 5',' JSP API',dianne.jiao,dev,'All filters configured as follows not invoked when IncludedServlet, \n/generic/dummyServlet, /generic/dummyJSP, /dummy.html is accessed through\nRequestDipatcher.include.\n\n  <filter-mapping>\n    <filter-name>ServletMappedTest_Filter</filter-name>\n    <servlet-name>IncludedServlet</servlet-name>\n    <dispatcher>INCLUDE</dispatcher>\n  </filter-mapping>\n\n  <filter-mapping>\n    <filter-name>ServletMappedTest_Filter</filter-name>\n    <url-pattern></url-pattern>\n    <dispatcher>REQUEST</dispatcher>\n    <dispatcher>INCLUDE</dispatcher>\n    <dispatcher>FORWARD</dispatcher>\n    <dispatcher>ERROR</dispatcher>\n  </filter-mapping>\n\n  <filter-mapping>\n    <filter-name>ServletMappedTest_Filter</filter-name>\n    <url-pattern>/dummy.html</url-pattern>\n    <dispatcher>REQUEST</dispatcher>\n    <dispatcher>INCLUDE</dispatcher>\n    <dispatcher>FORWARD</dispatcher>\n    <dispatcher>ERROR</dispatcher>\n  </filter-mapping>The forward mechanism was broken. Please try an let me know.\n\nThanks,\n\n-- JeanfrancoisFix verified in today\'s cvs build. Thanks.',?,BUG
17787,' value set to ERROR','Tomcat 5',' JSP API',dianne.jiao,dev,'When to access an non-exist file, 404 and Errorpage is returned,  but the filter\nconfigured for the error page didn\'t get invoked:\n\nERROR filter is configured:\n  <filter-mapping>\n    <filter-name>ServletMappedTest_Filter</filter-name>\n    <url-pattern>/generic/*</url-pattern>\n    <dispatcher>REQUEST</dispatcher>\n    <dispatcher>INCLUDE</dispatcher>\n    <dispatcher>FORWARD</dispatcher>\n    <dispatcher>ERROR</dispatcher>\n  </filter-mapping>\n\nErrorpage is configured:\n<error-page>\n    <error-code>404</error-code>\n    <location>/generic/ErrorPage</location>\n  </error-page>The forward mechanism was broken. Please try an let me know.\n\nThanks,\n\n-- Jeanfrancois',?,BUG
17929,'EL expression treated as plain text in template data attribute with Jsp Document syntax','Tomcat 5',Unknown,erik,dev,'When i use the xml syntax for a jsp page with Tomcat 5.0 Alpha and try to \nreference an EL parameter in a template data attribute, the EL expression gets \noutput as plain text, i.e. it is treated as quoted plaintext within the \nattribute. The behavior seems a bit strange to me, I\'d expect it to output the \nparameter. I\'ve been trying to find a clarification in the JSP 2.0, and JSTL \n1.0 specification but unfonrtunately no luck so far.\n\nExample, please note that the first EL expression is treated as plain text, \nwhile the second evaluates correctly.:\n\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n<jsp:root\n xmlns:jsp=\"http://java.sun.com/JSP/Page\"\n xmlns:c=\"http://java.sun.com/jstl/core\"\n version=\"2.0\">\n\n<jsp:directive.page\n contentType=\"text/html\"\n pageEncoding=\"ISO-8859-1\"/>\n\n<html>\n<body>\n    <div class=\"${1+2}\">${1+2}</div>\n</body>\n</html>\n</jsp:root>The attributes for an unterpreted tag in XML syntax are not evaluated.  That\nmeans that any EL or rt expressions are not evaluated.  This is intended.\n\nTo get around this problem, instead of\n\n\t<div class=\"${1+2}\">${1+2}</div>\n\nyou can write\n\n\t<jsp:element name=\"div\">\n\t    <jsp:attribute name=\"class\">${1+2}</jsp:attribute>\n\t    <jsp:body>${1+2}</jsp:body>\n\t</jsp:element>\n\nSorry, but I disagree that EL expressions in XML element attributes are not\nevaluated. \"JSP.6.3.10 Dynamic Template Content\" in PFD2 says this about it:\n\n  In some cases, the dynamic content that is generated can be described as\n  simple substitutions on otherwise static templates. JSP documents can have \n  XML templates where EL expressions are used as the values of the body or \n  of attributes. For instance, the next example uses the expression \n  table.indent as the value of an attribute, and the expression table.value \n  as that for the body of an element:\n\n    <table indent=\"${table.indent}\">\n      <row>${table.value}</row>\n    </table>',?,OTHER
18199,'Regression in Tomcat 5: UnavailableException thrown in init() return Status 404 not 503','Tomcat 5',' JSP API',dianne.jiao,dev,'UnavailableException thrown in init():\n\n public void init( ServletConfig sc ) throws ServletException {\n        //throw new UnavailableException(this,\"Negative Init Test\");\n        throw new UnavailableException( \"Negative Init Test\" );\n    }\n\nConfiguration of the accessed servlet:\n<servlet>\n    <servlet-name>DoInit1TestLogicalName</servlet-name>   \n<servlet-class>com.sun.ts.tests.servlet.api.javax_servlet.servlet.DoInit1TestServlet</servlet-class>\n  </servlet>\n\n  <servlet-mapping>\n    <servlet-name>DoInit1TestLogicalName</servlet-name>\n    <url-pattern>/DoInit1Test</url-pattern>\n  </servlet-mapping>This is correct behaviour according to spec.  Mark it invalid.The bug is valid, but the statement needs to be corrected:\nExpect 404 but got 500.\nCreated attachment 5519\nwar file to help reproduce the problemFixed. Based on the spec SRV.2.3.3.2 Exceptions During Request Handling:\n  \n  - 404 will be returned if the servlet is permanently unavailable\n  - 503 will be returned if the servlet is unavailable for x time\n\n-- JeanfrancoisFix verified in today\'s cvs build.  Thanks.Created attachment 5545\nupdated test case',?,BUG
18200,'Regression in Tomcat 5:  runtime Exception that cannot be caught by catch block','Tomcat 5',Catalina,dianne.jiao,dev,'The following catch block cannot catch java.net.MalformedURLException:\n\ntry {\n            URL resourceURL = context.getResource( path );\n\n            passed=false;\n            pw.println(\"GetResource_2Test \"+ Data.PASSED);\n            pw.println(\" Should not be here!!!\");\n        } catch (java.net.MalformedURLException ex) {\n            passed = true;\n            pw.println(\"GetResource_2Test \"+ Data.PASSED);\n            pw.println(\"Expected java.net.MalformedURLException is thrown\");\n        } catch ( Exception e) {\n            passed = false;\n            pw.println(\"GetResource_2Test \"+ Data.PASSED);\n            pw.println(\"Unexpected Exception is thrown: \" + e.toString());\n        }\n\nStacktrace from server:\nMar 20, 2003 1:53:30 PM org.apache.catalina.core.ApplicationContextFacade\ndoPrivileged\nSEVERE: doPrivileged\njava.net.MalformedURLException: Path {0} does not start with a \"/\" character\n        at\norg.apache.catalina.core.ApplicationContext.getResource(ApplicationContext.java:470)\n        at sun.reflect.GeneratedMethodAccessor44.invoke(Unknown Source)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at\norg.apache.catalina.core.ApplicationContextFacade.executeMethod(ApplicationContextFacade.java:400)\n        at\norg.apache.catalina.core.ApplicationContextFacade.doPrivileged(ApplicationContextFacade.java:328)\n        at\norg.apache.catalina.core.ApplicationContextFacade.doPrivileged(ApplicationContextFacade.java:305)\n        at\norg.apache.catalina.core.ApplicationContextFacade.getResource(ApplicationContextFacade.java:209)\n        at\ncom.sun.ts.tests.servlet.api.javax_servlet.servletcontext.TestServlet.getResource_2(TestServlet.java:377)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at\ncom.sun.ts.tests.servlet.common.servlets.GenericTCKServlet.invokeTest(GenericTCKServlet.java:79)\n        at\ncom.sun.ts.tests.servlet.common.servlets.GenericTCKServlet.service(GenericTCKServlet.java:63)\n        at\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:288)\n        at\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n        at\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:294)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:490)\n        at\norg.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1025)\n        at\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:196)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:490)\n        at\norg.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1025)\n        at\norg.apache.catalina.core.StandardContext.invoke(StandardContext.java:2658)\n        at\norg.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n        at\norg.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:171)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n        at\norg.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:172)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:490)\n        at\norg.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1025)\n        at\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:163)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:490)\n        at\norg.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1025)\n        at\norg.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:196)\n        at\norg.apache.coyote.http11.Http11Processor.process(Http11Processor.java:625)\n        at\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:430)\n        at\norg.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:567)\n        at\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:623)\n        at java.lang.Thread.run(Thread.java:536)Fixed. The original exception will be thrown.Fix verified in Today\'s CVS build.  Thanks.',?,BUG
18201,'Tomcat 5 regression: getReader() doesnot throw UnsupportedEncodingException when bogus charset is used','Tomcat 5',' JSP API',dianne.jiao,dev,'Request:\n[REQUEST LINE] -> POST\n/servlet_js_servletrequest_web/getReaderUnsupportedEncodingExceptionTest\nHTTP/1.1\n     [java]        [REQUEST HEADER] -> Content-Length: 49\n     [java]        [REQUEST HEADER] -> Host: slappy.east:8080\n     [java]        [REQUEST HEADER] -> User-Agent: Jakarta\nCommons-HttpClient/2.0M1\n     [java]        [REQUEST HEADER] -> Content-Type: text/plain;\ncharset=DoesNonExist\n     [java]        [REQUEST BODY LENGTH] -> 49\n\nServlet code:\npublic void service(ServletRequest request, ServletResponse response) throws\nServletException, IOException {\n        PrintWriter pw=response.getWriter();\n        try {\n            BufferedReader br = request.getReader();\n            pw.println( \"getReader() method did not throw\nUnsupportedEncodingException\" );\n        } catch (Throwable t) {\n            if ( !(t instanceof UnsupportedEncodingException) ) {\n                pw.println(\"Exception thrown, but was not an instance of\nIllegalStateException.\");\n                pw.println(\"instead received: \" + t.getClass().getName());\n            }\n        }\n    }Created attachment 5522\ntestcase war fileThis has been fixed.',?,BUG
18202,'Tomcat 5 regression: default Content-Type is set to text/plain','Tomcat 5',' JSP API',dianne.jiao,dev,'This behaviour is against Servlet spec 2.4 SRV.5.2.The statement from the specification contradicts the HTTP spec (and the\nparagraph makes a wrong statement about the HTTP spec, which DOES default to a\ndefault encoding when none is specified; whether or not it is explicitely\nspecified in the request or response does not make any semantic difference).To be specific, the following call should return null when not set:   \nServletResponse.getContentType()\nNow TC5 returns by default:      Content-Type: text/plain\n\npublic void service(ServletRequest request, ServletResponse response) throws\nServletException, IOException {\n        PrintWriter pw = response.getWriter();\n        String actual = response.getContentType();\n        if (actual != null) {\n            pw.println( \"getContentType() did not return a null\");\n            pw.println( \"actual=\"+actual);\n        }\n}Created attachment 5520\ntest caseThis has been fixed.',?,BUG
18204,'Regression in Tomcat 5: no IllegalArgumentException thrown with new Cookie(\"$test\", \"Valueless\");','Tomcat 5',' JSP API',dianne.jiao,dev,'The $ sign that starts cookie\'s name $test should cause IllegalArgumentException\nthrown.Created attachment 5521\ntestcaseFixed.',?,BUG
18220,' Paste doesn\'t work (Apache Service Monitor)','Tomcat 5',Native:Integration,marc.lehmann,dev,'I can\'t Copy&Paste text strings from the Console Monitor application (Apache \nService Monitor) to any other application. The Copy&Paste buffer seems to be \nempty.I just reproduced it on Windows 2000 (Tomcat 5.0.3, JDK 1.4.1_03).Fixed now in the CVS and should appear in 5.0.10.',?,BUG
18225,'Regression in Tomcat 5: Request failed to match \"default\" servlet','Tomcat 5',' JSP API',dianne.jiao,dev,'Server failed to map the following request: \nGET /servlet_jsh_httpservletrequest_web/getServletPathEmptyStringTest HTTP/1.1\nTo the default servlet, and return status code 404.\n\nServlet configuration:\n  <servlet-mapping>\n    <servlet-name>getServletPathEmptyStringTest</servlet-name>\n    <url-pattern>/*</url-pattern>\n  </servlet-mapping>\n\nTest Servlet:\n    public void service(PrintWriter pw, HttpServletRequest request,\nHttpServletResponse response) throws ServletException, IOException {\n        String expectedResult = \"\";\n        String result = request.getServletPath();\n        PrintWriter pw = response.getWriter();\n\n        if (result != null) {\n            if (!result.equals(expectedResult)) {\n                pw.println(\"getServletPath() returned an incorrect result\");\n                pw.println(\"Expected result = \'\'\");\n                pw.println(\"Actual result = |\" + result + \"|\");\n            } \n        } else {\n            pw.println(\"getServletPath() returned a null result\");\n        }\n    }Try again with a CVS build, and reopen if it still doesn\'t work. Note: If it\njust doesn\'t work because getServletPath returns null or \"/\" instead of \"\",\nplease mention it.\n\nIn this case, the mapper will map to getServletPathEmptyStringTest.Created attachment 5498\nwar file for reproducing problemForgot to re-open it last time.I\'ll decline the priviledge to recieve your stuff twice, thanks ;-)The wildcard mapping had a bug.Fix verified today.  Thanks.- Always verify using the CVS code\n- Always submit a test case (I did reproduce what you had explained, but there\nwas no problem with what you described)',?,BUG
18236,'An xmlns declaration that doesn\'t denote a tag library causes translation error','Tomcat 5',Jasper,hans,dev,'In a JSP Document, xmlns declarations are used to declare tag libraries, but\nxmlns declarations for regular XML namespaces are also allowed. With TC 5.0.1,\nhowever, such a declaration cause a translation error with this root cause message:\n\norg.apache.jasper.JasperException: The absolute uri:\nhttp://www.w3c.org/1999/xhtml cannot be resolved in either web.xml or the jar\nfiles deployed with this application\n\tat\norg.apache.jasper.compiler.DefaultErrorHandler.jspError(DefaultErrorHandler.java:94)\n\nThis is the result when accessing a JSP Document such as the one used as an\nexample in JSP 2.0 PDF2, section JSP.6.4.4, with a root element like this:\n\n  <html\n    xmlns=\"http://www.w3.org/1999/xhtml\"\n    xmlns:jsp=\"http://java.sun.com/JSP/Page\"\n    xmlns:c=\"http://java.sun.com/jstl/core\"\n    xmlns:u=\"urn:jsptagdir:/WEB-INF/tags/mylib/\">',?,BUG
18251,'ServletResponse.setLocale() is not implemented as described in the spec','Tomcat 5',Connector:HTTP,hans,dev,'The setLocale() method in org.apache.coyote.tomcat5.CoyoteResponse is not spec\ncompliant: it doesn\'t respect a locale setting after setContentType() has been\ncalled, even if the provided content type doesn\'t specify a charset.\n\nThe Javadocs for setLocale() in Servlet 2.4 PDF2 says:\n\n  Sets the locale of the response, setting the Content-Language header, \n  if the response has not been committed yet. It also sets the response\'s \n  character encoding appropriately for the locale, if the character encoding\n  has not been explicitly set using setContentType(String) or \n  setCharacterEncoding(String) , getWriter hasn’t been called yet, and the \n  response hasn’t been committed yet. ...\n\nCoyoteResponse breaks two of these rules:\n1) It doesn\'t set the Content-Language header (by calling Response.setLocale())\n   if setContentType() or setCharacterEncoding() has been called. It should\n   make this call in all cases, as long as the response has not been committed.\n2) It doesn\'t set the charset attribute of the Content-Type header (by calling\n   Response.setCharacterEncoding()) if setContentType() has been called. It\n   should make this call even if setContentType() has been called, as long\n   as the specified content type doesn\'t include a charset attribute.I do not agree with that. Setting the content-language header is delayed, and\nwill be set right before the response is committed. I don\'t see any problem with\ndoing that.Basically, in this case, the specification attempts to force how things are\nimplemented, although the servlet cannot access the headers. Delaying setting\nthem will not change anything, so the specification exact wording WILL NOT be\nimplemented. I am -1 for fixing this, as the container should use special\nhandling for all special HTTP headers, and restrict access to them.\n\nSome part of the bug seems valid, though (although it should be noted that the\nspec is too complex; as usual, why have three ways of doing the same thing ?).Spec complexity concerns should be addressed to the JSR-154 EG. Even though I\nagree that the implementation doesn\'t necessarily have to be changed as I\nindicated, the fact is that calling setLocale() after calling setContentType()\n(without charset), doesn\'t work as defined by the spec in TC 5.0.1. \n\nDelaying setting the headers should be fine, as long as the end result is what\'s\ndefined by the extract from the spec I included.This has been fixed. The spec is too complex, though.',?,SPEC
18465,'Problem in build file with bad xerces value','Tomcat 5',Catalina,jmoliere,dev,'The ANT script tries to download the 2.3 release of Xerces while this one is no\nmore present on the webserver.\nUsing the 2.4 instead solves this problem..\ncould be helpful ...Fixed. ',?,BUG
18479,'HttpSessionBindingListener.valueUnbound() not called','Tomcat 5',Unknown,dave,dev,'I have an object that implements HttpSessionBindingListener. It calls \nvalueBound fine. But it never calls valueUnbound. Not when it times out and not \nwhen Tomcat is closed.With version 4.1.24 it does call it on a timeout. However, it does not call it \nif Tomcat is shut down and if the listener class is not serializable it is not \nbrought back when Tomcat restarts.Fixed in CVS for TC4 and TC5.I believe the fix for this issue has caused another one.  The Tomcat-5.0.21\nchanglog says the following about the fix for this bug report...\n\n18479: Non-serializable sessions attributes should be removed (so valueUnbound\nis called) (markt)\n\nI have a session that is perfectly serializable in both 5.0.19 and 5.0.20, but\nas of 5.0.21, the value for the session attribute comes back null.  I also\ntested in 5.0.22 with the same result.  The test consists of a hit counter that\nstays in the session and should pick up right where it left off upon\nserver/application reload as long as the session hasn\'t yet timed out.\n\nI have a HttpSessionAttributeListener reporting when objects are\nadded/removed/replaced in the session.  I get the report of the object in\nquestion being added, but I never see that it has been removed or replaced.  As\nsuch, I must assume that the session attribute is still there, but its value\nchanged to null somewhere behind the scenes in a way that doesn\'t report it to\nthe HttpSessionAttributeListener (at a minimum, attributeReplaced() should be\ncalled, no?).\n\nIf this report should be separate from this bug, please say so and I\'ll do that,\nbut this one seems suspect as the cause for the issue I am seeing.  Also let me\nknow if more information is needed or if a test case is needed.  I, obviously,\nhave a test case, but it not exactly simplified.  I\'ll do that if what I am\nreporting seems non-obvious to the Tomcat gurus.\n\nJakePlease don\'t bother.\n\nThe new code  in writeObject is:\n        // Accumulate the names of serializable and non-serializable attributes\n        String keys[] = keys();\n        ArrayList saveNames = new ArrayList();\n        ArrayList saveValues = new ArrayList();\n        for (int i = 0; i < keys.length; i++) {\n            Object value = null;\n            synchronized (attributes) {\n                value = attributes.get(keys[i]);\n            }\n            if (value == null)\n                continue;\n            else if ( (value instanceof Serializable) \n                    && (!exclude(keys[i]) )) {\n                saveNames.add(keys[i]);\n                saveValues.add(value);\n            } else {\n                removeAttribute(keys[i]);\n            }\n        }\n\nThe change is the added removeAttribute. The patch which \"broke\" everything is\n(this is the only difference between 5.0.20 and 5.0.21):\n  diff -u -r1.40 -r1.41\n  --- StandardSession.java\t12 Mar 2004 22:36:46 -0000\t1.40\n  +++ StandardSession.java\t25 Mar 2004 22:17:54 -0000\t1.41\n  @@ -1397,6 +1397,8 @@\n                       && (!exclude(keys[i]) )) {\n                   saveNames.add(keys[i]);\n                   saveValues.add(value);\n  +            } else {\n  +                removeAttribute(keys[i]);\n               }\n           }\n\nI doubt your \"perfectly serializable\" stuff actually is.Hi Remy,\n\nI have to admit, it looks pretty rock solid, but how is it that in 5.0.20 my\nsession serialized/deserialized *without* error and gave me a non-null attribute\nvalue (exactly as I expected) after reload?  Serialization is pretty straight\nforward; either it is serializable and you get no errors or it isn\'t\nserializable and you get errors.  I get no errors.  How is that not the\ndefinition of \"perfectly serializable\"?  And if removeAttribute() is being\ncalled, why isn\'t the attributeRemoved() method in my SessionBindingListener\nbeing triggered?  I have println() statements in all methods of my\nSessionBindingListener and the only ones I\'m seeing are on attributeAdded(). \nYou can go ahead and stick to your guns and say that my object is not\nserializable (I\'m 99.9999\% sure it is), but you can\'t, at the same time, claim\nthat it is being removed from the session when attributeRemoved() is not being\ntriggered.... unless there is a bug where the removeAttribute(keys[i]) call is\nnot notifying listeners of the attributes it is removing.\n\nSo, I guess I\'ll have to investigate some more, but something is wrong here. \nHopefully we can work together to figure it out.\n\nJakeYou were right, Remy,\n\nAfter some investigation, I figured out that one of the packages I was using\nadded a session attribute whose job was to react to cases where it had its\nvalueUnbound() method called and do some cleanup.  However, it was set as an\nanonymous HttpSessionBindingListener which (obviously) doesn\'t implement\nSerializable.  Besides that, the class in which the anonymous class was created\nis not serializable and if you do a toString() on the session value that was\ncreated, you get the name of the containing class, so I think the containing\nclass would have to be serializable here as well.  In any case, the alternative\nmethod would be to just use a SessionListener#sessionDestroyed() method to do\nthe cleanup.  I think the former method was used because the session is already\ndestroyed in Jetty by the time sessionDestroyed() is called (I think that\'s\nright?) making cleanup in sessionDestroyed() impossible (That\'s got to be bad\nbehavior on Jetty\'s part, but this needs to work with all containers, hence the\nworkaround).  Everything worked under Tomcat after I moved to using\nsessionDestroyed() to do the cleanup.\n\nHowever, shouldn\'t valueUnbound() be called on the non-serializable attribute\nvalue when it is removed from the session HashTable?  Actually, isn\'t that\nexactly what this bug is about?  If so, isn\'t this bug not really fixed?  At the\nvery least, some logging should be done to tell me what happening.  I wouldn\'t\nhave even have started asking questions here if Tomcat had provided me with some\nhint of what it was doing instead of silently removing non-serializable attributes.\n\n\nJakeThe sessionDestroyed timing problem is what the 2.3 specification mandated (this\nwas a mistake obviously), so you cannot have something portable between 2.3 and\n2.4 here.\n\nvalueUnbound is, as far as I can see, correctly called after the value is no\nlonger available through getAttribute.\n\nIn setAttribute:\n        // Replace or add this attribute\n        Object unbound = attributes.put(name, value);\n\n        // Call the valueUnbound() method if necessary\n        if ((unbound != null) &&\n            (unbound instanceof HttpSessionBindingListener)) {\n            try {\n                ((HttpSessionBindingListener) unbound).valueUnbound\n                    (new HttpSessionBindingEvent(this, name));\n            } catch (Throwable t) {\n                log(sm.getString(\"standardSession.bindingEvent\"), t);\n            }\n        }\n\nIn removeAttribute:\n        // Remove this attribute from our collection\n        Object value = attributes.remove(name);\n\n        // Do we need to do valueUnbound() and attributeRemoved() notification?\n        if (!notify || (value == null)) {\n            return;\n        }\n\n        // Call the valueUnbound() method if necessary\n        HttpSessionBindingEvent event = null;\n        if (value instanceof HttpSessionBindingListener) {\n            event = new HttpSessionBindingEvent(this, name, value);\n            ((HttpSessionBindingListener) value).valueUnbound(event);\n        }\n\nHi Remy,\n\nYou are right.  valueUnbound() *is* being called.  The problem is, my registered\nSessionAttributeListener isn\'t being called (and yes, it is registered.  I get\nprintln() output from attributeAdded()).  I added some println() statements to\nStandardSession to see what was going on and I found something weird; The\nlisteners[] array is null.\n\nHere\'s my debugging output...\n\nApr 14, 2004 12:23:48 AM org.apache.catalina.core.StandardContext reload\nINFO: Reloading this Context has started\nJRK... key being removed: KILLER_HELPER\nJRK... instance of HttpSessionBindingListener? true\nServletContainerListener.valueUnbound() called!\nJRK... listeners are: null\nApr 14, 2004 12:23:48 AM org.apache.catalina.logger.LoggerBase stop\nINFO: unregistering logger Catalina:type=Logger,path=/picoservlet,host=localhost\n\n\nSo, it makes sense that I wasn\'t seeing the println() statements in my\nattributeRemoved() method since the following code in\nStandardSession.removeAttributeInternal() can\'t find the listeners...\n\n    Context context = (Context) manager.getContainer();\n    Object listeners[] = context.getApplicationEventListeners();\n\n\nHere\'s a patch showing where I added the debugging lines resulting in the above\noutput...\n\nIndex: catalina/src/share/org/apache/catalina/session/StandardSession.java\n===================================================================\nRCS file:\n/home/cvspublic/jakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/session/StandardSession.java,v\nretrieving revision 1.43\ndiff -u -r1.43 StandardSession.java\n--- catalina/src/share/org/apache/catalina/session/StandardSession.java\t1 Apr\n2004 20:18:15 -0000\t1.43\n+++ catalina/src/share/org/apache/catalina/session/StandardSession.java\t14 Apr\n2004 05:26:23 -0000\n@@ -1398,6 +1398,8 @@\n                 saveNames.add(keys[i]);\n                 saveValues.add(value);\n             } else {\n+                System.out.println(\"JRK... key being removed: \" + keys[i]);\n+                System.out.println(\"JRK... instance of\nHttpSessionBindingListener? \" + (value instanceof HttpSessionBindingListener));\n                 removeAttribute(keys[i]);\n             }\n         }\n@@ -1568,6 +1570,7 @@\n         // Notify interested application event listeners\n         Context context = (Context) manager.getContainer();\n         Object listeners[] = context.getApplicationEventListeners();\n+        System.out.println(\"JRK... listeners are: \" + listeners);\n         if (listeners == null)\n             return;\n         for (int i = 0; i < listeners.length; i++) {\n\n\nThis is a valid bug, no?\n\nJakeJust to be clear, the listeners are null only when Tomcat is removing\nnon-serializable attributes.  Listeners exist (as they should) when attributes\nare removed during normal session expiration.  And valueUnbound() always works\njust fine.  So, the bug here is to make sure HttpSessionAttributeListeners get\ncalled in cases where the attribue is being removed because the attribute\'s\nvalue isn\'t serializable.\n\nJakeI think Jacob is right cause I have a similiar problem:\n\nUsing Tomcat 5.0.19 I call the function invalidate() to destroy the session. \nThere is a Listener but the method valueUnbound() is not called.I committed a change which may fix this. Either this fixes it or it will not be\nfixed since (unless you submit a tested patch) I don\'t see the issue as very\nimportant.Thanks Remy, that sovled the issue!  The listeners are no longer null so the\nattributeRemoved() method of my HttpSessionAttributeListener is now successfully\ncalled as expected.\n\nJake',?,BUG
18535,'Jasper is not generating a translation error if jsp:text contains subelements.','Tomcat 5',Jasper,Ryan.Lubke,dev,'Given the following JSP Document:\n------------------------------------------\n<root xmlns:jsp=\"http://java.sun.com/JSP/Page>\n    <jsp:text>\n        <jsp:scriptlet><![CDATA[out.println(\"Hello\")]]></jsp:scriptlet>\n    </jsp:text>\n</root>\n------------------------------------------\n\n\"Hello\" is incorrectly returned to the client.\n\nHowever, it should be noted that a JSP in standard syntax with a jsp:text\nelement having a child element of some type does behave as expected.',?,BUG
18639,'Manager webapp not working.','Tomcat 5',Webapps:Administration,rajiv.mordani,dev,'When accessing the manager webapp with tomcat 5 as of last night\'s build I get\nthe following stack trace and I can\'t use the manager webapp at all - \nINFO: Marking servlet Manager as unavailable\nApr 2, 2003 4:43:17 PM org.apache.catalina.core.StandardWrapperValve invoke\nSEVERE: Allocate exception for servlet Manager\njavax.servlet.ServletException: Error instantiating servlet class \norg.apache.catalina.manager.ManagerServlet\n    at \norg.apache.catalina.core.StandardWrapper.loadServlet(StandardWrapper.java:995)\n    at \norg.apache.catalina.core.StandardWrapper.allocate(StandardWrapper.java:696)\n    at \norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:1\n93)\n    at \norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.ja\nva:151)\n    at \norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:552)\n    at \norg.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1017)\n    at \norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:1\n96)\n    at \norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.ja\nva:151)\n    at \norg.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.jav\na:558)\n    at \norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.ja\nva:149)\n    at \norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:552)\n    at \norg.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1017)\n    at \norg.apache.catalina.core.StandardContext.invoke(StandardContext.java:2667)\n    at \norg.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)\n    at \norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.ja\nva:151)\n    at \norg.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java\n:171)\n    at \norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.ja\nva:149)\n    at \norg.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:172)\n    at \norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.ja\nva:149)\n    at \norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:552)\n    at \norg.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1017)\n    at \norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:163\n)\n    at \norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.ja\nva:151)\n    at \norg.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:512)\n    at \norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.ja\nva:149)\n    at \norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:552)\n    at \norg.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1017)\n    at \norg.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:196)\n    at \norg.apache.coyote.http11.Http11Processor.process(Http11Processor.java:630)\n    at \norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio\nn(Http11Protocol.java:430)\n    at \norg.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:568)\n    at \norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:62\n3)\n    at java.lang.Thread.run(Thread.java:536)\n-------------\%<-----------------------------------------------------------------\n--------------This should be fixed with reloading fix.',?,BUG
19031,'Failure in processing TLD files in JAR files included with web application','Tomcat 5',Jasper,Ryan.Lubke,dev,'The following exception is raised when trying to use tag libraries packaged as\nJAR files in the web application:\n\norg.apache.jasper.JasperException: Unable to read TLD \"META-INF/tlds/multi2.tld\"\nfrom JAR file \"jndi:/localhost/jsp_tldres_web/WEB-INF/lib/multitaglib.jar\":\njava.lang.IllegalStateException: zip file closed\n\nthe JAR file has two TLDs in the JAR file.  One is in META-INF, and the other is\nin META-INF/tlds.\n\nThis seems to be a regression in behavior as this worked with previous builds.I made a change for something I saw in TldLocCache, and which looked bad. This \nmay cause that problem (however, IMO a) the code looks like a workaround for a \nJDK bug b) that spec feature is bad).*** Bug 19032 has been marked as a duplicate of this bug. ***Now that JAR files are closed in the TagLibraryInfoImpl constructor\'s finally,\nwe must instruct JarURLConnection not to cache them, that is, disable caching.',?,BUG
19032,'MalformedURLException returned by Jasper when attempting to process a tag library packaged in JSP 1.1 fashion.','Tomcat 5',Jasper,Ryan.Lubke,dev,'Jasper throws the following:\n\nUnable to read TLD \"META-INF/taglib.tld\" from JAR file\n\"/WEB-INF/lib/jsp11taglib.jar\": java.net.MalformedURLException: invalid url:\n/WEB-INF/lib/jsp11taglib.jar!/ (java.net.MalformedURLException: no protocol:\n/WEB-INF/lib/jsp11taglib.jar)\n\n\nThe JAR file contains a single TLD (taglib.tld) in the META-INF directory.\n\nThis functionality worked in previous builds.I strongly feel it\'s the same bug as your other.\n\n*** This bug has been marked as a duplicate of 19031 ***This bug is distinct from 19031, not a duplicate.\n',?,BUG
19071,'IllegalStateException thrown when attepting to access Tag files packaged in JAR file.','Tomcat 5',Jasper,Ryan.Lubke,dev,'The following Exception and Stacktrace is raised when attempting to access Tag\nfiles packaged in a JAR:\n\n----------------------------------------------------------\n</pre></p><p><b>root cause</b> <pre>java.lang.IllegalStateException: zip file closed\n     [java]     at java.util.zip.ZipFile.ensureOpen(ZipFile.java:398)\n     [java]     at java.util.zip.ZipFile.getEntry(ZipFile.java:145)\n     [java]     at java.util.jar.JarFile.getEntry(JarFile.java:184)\n     [java]     at sun.net.www.protocol.jar.URLJarFile.getEntry(URLJarFile.java:89)\n     [java]     at\norg.apache.jasper.compiler.JspUtil.getInputStream(JspUtil.java:857)\n     [java]     at\norg.apache.jasper.xmlparser.XercesEncodingDetector.getEncodingMethod(XercesEncodingDetector.java:160)\n     [java]     at\norg.apache.jasper.xmlparser.XMLEncodingDetector.getEncoding(XMLEncodingDetector.java:99)\n     [java]     at\norg.apache.jasper.compiler.ParserController.determineSyntaxAndEncoding(ParserController.java:349)\n     [java]     at\norg.apache.jasper.compiler.ParserController.parse(ParserController.java:195)\n     [java]     at\norg.apache.jasper.compiler.ParserController.parse(ParserController.java:150)\n     [java]     at\norg.apache.jasper.compiler.ParserController.parse(ParserController.java:137)\n     [java]     at\norg.apache.jasper.compiler.Compiler.generateJava(Compiler.java:246)\n---------------------------------------------------------------------------',?,BUG
19076,'Severe Exception while processing Filter','Tomcat 5',' JSP API',lkarpel,dev,'I am attempting to run the most recent nightly of Tomcat 5 .. when using a \nfilter I get the following exception:\n\n--------------------------\n\nApr 15, 2003 11:25:26 AM org.apache.catalina.core.ApplicationDispatcher \ndoForward\nSEVERE: Shouldn\'t happen - old code\njava.lang.Throwable\n        at org.apache.catalina.core.ApplicationDispatcher.doForward\n(ApplicationDispatcher.java:464)\n        at org.apache.catalina.core.ApplicationDispatcher.forward\n(ApplicationDispatcher.java:361)\n        at com.eloquent.ecs.ERequest.forward(ERequest.java:3659)\n        at com.eloquent.ecs.ERequest.service(ERequest.java:1499)\n        at com.eloquent.ecs.EServlet.doService(EServlet.java:381)\n        at com.eloquent.ecs.EServlet.doGet(EServlet.java:344)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:740)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:288)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:206)\n        at com.eloquent.ecs.filters.ECompressionFilter.doFilter\n(ECompressionFilter.java:88)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:235)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:206)\n        at org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:263)\n        at org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:552)\n        at org.apache.catalina.core.ContainerBase.invoke\n(ContainerBase.java:1017)\n        at org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:196)\n        at org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:552)\n        at org.apache.catalina.core.ContainerBase.invoke\n(ContainerBase.java:1017)\n        at org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2698)\n        at org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:186)\n        at org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n        at org.apache.catalina.valves.ErrorDispatcherValve.invoke\n(ErrorDispatcherValve.java:171)\n        at org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:149)\n        at org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:172)\n        at org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:149)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:552)\n        at org.apache.catalina.core.ContainerBase.invoke\n(ContainerBase.java:1017)\n        at org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:163)\n        at org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:552)\n        at org.apache.catalina.core.ContainerBase.invoke\n(ContainerBase.java:1017)\n        at org.apache.coyote.tomcat5.CoyoteAdapter.service\n(CoyoteAdapter.java:199)\n        at org.apache.coyote.http11.Http11Processor.process\n(Http11Processor.java:630)\n        at \norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio\nn(Http11Protocol.java:463)\n        at org.apache.tomcat.util.net.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java:568)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:631)\n        at java.lang.Thread.run(Thread.java:534)\n\n----------------------------\n\nmy filter (a variant of the example compression filter) wraps the current \nservlet request in an class that extends HttpServletResponseWrapper .. for \nexample:\n\n     public class ECompressionServletResponseWrapper extends \nHttpServletResponseWrapper\n\nthe code in org.apache.catalina.core.ApplicationDispatcher.doForward makes a \ncheck to make sure the response is an instance of:\n\n    org.apache.catalina.connector.ResponseFacade\n\ncould that possibly be correct ?\n\nLenFixed. The exception should no longer be displayed. Let me know if the\nfunctionality is still not working.\n\nThanks,\n\n-- Jeanfrancois',?,BUG
19093,'IllegalStateException thown during SMAP generation','Tomcat 5',Jasper,Ryan.Lubke,dev,'The issues seems to surface when a JSP contains only a directive.\n\nStacktrace below\n----------------------------------------\n/pre></p><p><b>root cause</b> <pre>java.lang.IllegalStateException\n     [java]     at\norg.apache.jasper.compiler.SmapStratum.getString(SmapStratum.java:272)\n     [java]     at\norg.apache.jasper.compiler.SmapGenerator.getString(SmapGenerator.java:173)\n     [java]     at\norg.apache.jasper.compiler.SmapUtil.generateSmap(SmapUtil.java:141)\n     [java]     at\norg.apache.jasper.compiler.Compiler.generateJava(Compiler.java:302)\n     [java]     at org.apache.jasper.compiler.Compiler.compile(Compiler.java:452)\n     [java]     at org.apache.jasper.compiler.Compiler.compile(Compiler.java:438)\n------------------------------------------------------------------The problem comes when there is no debug line info for the JSP.  The generation\nof the SMAP is suppressed in this case.',?,BUG
19117,'Translation error not being raised by Jasper if a JSP document has mismatched encodings specified in the XML prolog and the pageEncoding attribute of the page directive','Tomcat 5',Jasper,Ryan.Lubke,dev,'JSP.4.1 states a translation error must occur of the encoding specified by the\nXML prolog and the encoding specified by the pageEncoding attribute of the page\ndirective do not match.\n\nThis worked in the previous nightly build, but is now failing.',?,BUG
19196,'Tomcat throws SSLPeerUnverifiedException when I invoke request using HTTPS.','Tomcat 5',Connector:HTTP,krishna.meduri,dev,'Tomcat throws the following exception on the server console when I invoke\nrequest using HTTPS:\n\nWARNING: Exception getting SSL attributes \njavax.net.ssl.SSLPeerUnverifiedException: peer not authenticated\n        at\ncom.sun.net.ssl.internal.ssl.SSLSessionImpl.getPeerCertificateChain(DashoA6275)\n        at\norg.apache.tomcat.util.net.jsse.JSSESupport.getX509Certificates(JSSESupport.java:113)\n        at\norg.apache.tomcat.util.net.jsse.JSSESupport.getPeerCertificateChain(JSSESupport.java:161)\n        at org.apache.coyote.http11.Http11Processor.action(Http11Processor.java:777)\n        at org.apache.coyote.Response.action(Response.java:225)\n        at\norg.apache.coyote.tomcat5.CoyoteAdapter.postParseRequest(CoyoteAdapter.java:273)\n        at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:197)\n        at\norg.apache.coyote.http11.Http11Processor.process(Http11Processor.java:630)\n        at\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:463)\n        at\norg.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:568)\n        at\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:631)\n        at java.lang.Thread.run(Thread.java:536)\n\n-----------------------------------------------------------------------------\n\nwhen I run my SSL based test, it throws this exception. A request to\nhttps://localhost:8443/index.html also throws this exception.Please check the nightly before submitting reports for 5.0.',?,OTHER
19219,'Exception from java.util.zip.ZipFile after reloading an application','Tomcat 5',Jasper,petr.jiricka,dev,'I am getting the following exception after after reloading an application which\nuses tag libraries. I am using Tomcat 5.0 nightly build 20030421 with JDK 1.4.2\nbeta (I believe this will be reproducible on 1.4.1 as well, though).\n\nI am attaching only the root cause, not the ServletException which wraps it.\nSteps to reproduce are below.\n\n\njava.lang.InternalError: jzentry == 0,\n jzfile = 406263984,\n total = 4,\n name = E:\\software\\tomcat50nightly\\webapps\\taglibtest\\WEB-INF\\lib\\Test1.jar,\n i = 3,\n message = invalid LOC header (bad signature)\n\tat java.util.zip.ZipFile$2.nextElement(ZipFile.java:321)\n\tat java.util.jar.JarFile$1.nextElement(JarFile.java:211)\n\tat\norg.apache.jasper.compiler.TldLocationsCache.processTldsInJar(TldLocationsCache.java:320)\n\tat\norg.apache.jasper.compiler.TldLocationsCache.processTldsInGlobalJars(TldLocationsCache.java:455)\n\tat org.apache.jasper.compiler.TldLocationsCache.init(TldLocationsCache.java:215)\n\tat\norg.apache.jasper.compiler.TldLocationsCache.getLocation(TldLocationsCache.java:188)\n\tat\norg.apache.jasper.JspCompilationContext.getTldLocation(JspCompilationContext.java:557)\n\tat org.apache.jasper.compiler.Parser.parseTaglibDirective(Parser.java:452)\n\tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:514)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1562)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:171)\n\tat org.apache.jasper.compiler.ParserController.parse(ParserController.java:248)\n\tat org.apache.jasper.compiler.ParserController.parse(ParserController.java:150)\n\tat org.apache.jasper.compiler.ParserController.parse(ParserController.java:137)\n\tat org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:250)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:458)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:444)\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:593)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:300)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:293)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:288)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:263)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:552)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1017)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:196)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:552)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1017)\n\tat org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2708)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:186)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat\norg.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:171)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:172)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:552)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1017)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:163)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:552)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1017)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:199)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:630)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:463)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:568)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:631)\n\tat java.lang.Thread.run(Thread.java:534)\n\n\nThe scenario in which this occurs is basically the following:\n1. Create a web application with a tag library and a JSP which uses this taglib\n2. Run the application in Tomcat (put it to e.g. webapps/taglibtest) and run the JSP\n3. Add a tag to the tag library, use this new tag in the JSP and copy it over to\nTomcat again\n4. Reload the application using the manager application:\nhttp://localhost:8080/manager/reload?path=/taglibtest\n5. Run the JSP again\nThis is basically a consequence of JDK bug 4425695/4843994:\n\nhttp://developer.java.sun.com/developer/bugParade/bugs/4843994.html\nhttp://developer.java.sun.com/developer/bugParade/bugs/4425695.html\n\nI believe it could be fixed by not caching the JarURLConnection in\nTldLocationsCache.processTldsInJar(...) by setting connection.setUseCaches(false).\n\nI am attaching two versions of the web module I tested this with, and steps to\nreproduce with these:\n\n1. Unzip wm1.zip to webapps/taglibtest\n2. Start Tomcat\n3. Run http://localhost:8080/taglibtest/UsesTestTL.jsp\n4. Unzip wm2.zip to webapps/taglibtest\n5. \"Touch\" the UsesTestTL.jsp file, so Jasper reloads it\n6. Reload the application using\nhttp://localhost:8080/manager/reload?path=/taglibtest\n7. Run http://localhost:8080/taglibtest/UsesTestTL.jsp again\nThe exception is displayed in the browser.Created attachment 5953\nThe first version of the test web moduleCreated attachment 5954\nThe second version of the test web moduleMany file locking issues were fixed, and this should make this kind of webapp\nupdate scenario work a lot better.\n\nHowever, I don\'t see how the scenario you describe could work reliably (on\nWindows, the JAR could be locked if you try to ovewrite it while the webapp is\nrunning). IMO, you should do:\n- stop webapp\n- update it\n- start webapp\nRemy, thanks for all the fixes.\n\nAs for whether this scenario can or can not work - I agree it won\'t work in 100\%\nof cases. However documentation:\n\nhttp://jakarta.apache.org/tomcat/tomcat-5.0-doc/appdev/source.html\nhttp://jakarta.apache.org/tomcat/tomcat-5.0-doc/appdev/processes.html\n\nseems to suggest that you should be doing \'compile\' and then \'reload\'. So do we\nwant to change the documentation to recommend doing \'undeploy\', then \'compile\'\nand then \'deploy\' ?\n\nWhat should Tomcat recommend to the users so development works reliably and\ncorrectly for them ?',?,BUG
19240,'Exception - too many files open on mac osx 10.2.5','Tomcat 5',Catalina,rajiv.mordani,dev,'Apr 22, 2003 5:21:50 PM org.apache.catalina.startup.TldConfig tldScanJar\nSEVERE: Exception processing JAR at resource path\njndi:/localhost/jstl-examples/WEB-INF/lib/jsp-api.jar in context /jstl-examples\njava.io.IOException: Too many open files\n        at java.io.UnixFileSystem.createFileExclusively(Native Method)\n        at java.io.File.checkAndCreate(File.java:1313)\n        at java.io.File.createTempFile(File.java:1401)\n        at java.io.File.createTempFile(File.java:1438)\n        at sun.net.www.protocol.jar.URLJarFile$1.run(URLJarFile.java:169)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at sun.net.www.protocol.jar.URLJarFile.retrieve(URLJarFile.java:164)\n        at sun.net.www.protocol.jar.URLJarFile.getJarFile(URLJarFile.java:42)\n        at sun.net.www.protocol.jar.JarFileFactory.get(JarFileFactory.java:78)\n        at\nsun.net.www.protocol.jar.JarURLConnection.connect(JarURLConnection.java:85)\n        at\nsun.net.www.protocol.jar.JarURLConnection.getJarFile(JarURLConnection.java:69)\n        at org.apache.catalina.startup.TldConfig.tldScanJar(TldConfig.java:467)\n        at org.apache.catalina.startup.TldConfig.tldScanJar(TldConfig.java:449)\n        at org.apache.catalina.startup.TldConfig.execute(TldConfig.java:228)\n        at org.apache.catalina.core.StandardContext.start(StandardContext.java:4018)\n        at\norg.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:842)\n        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:826)\n        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:623)\n        at\norg.apache.catalina.core.StandardHostDeployer.addChild(StandardHostDeployer.java:804)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at\norg.apache.commons.beanutils.MethodUtils.invokeMethod(MethodUtils.java:252)\n        at org.apache.commons.digester.SetNextRule.end(SetNextRule.java:260)\n        at org.apache.commons.digester.Rule.end(Rule.java:276)\n        at org.apache.commons.digester.Digester.endElement(Digester.java:1064)\n        at\norg.apache.xerces.parsers.AbstractSAXParser.endElement(AbstractSAXParser.java:546)\n        at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanEndElement(XMLDocumentFragmentScannerImpl.java:1073)\n        at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(XMLDocumentFragmentScannerImpl.java:1535)\n        at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:348)\n        at\norg.apache.xerces.parsers.DTDConfiguration.parse(DTDConfiguration.java:539)\n        at\norg.apache.xerces.parsers.DTDConfiguration.parse(DTDConfiguration.java:595)\n        at org.apache.xerces.parsers.XMLParser.parse(XMLParser.java:152)\n        at\norg.apache.xerces.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1125)\n        at org.apache.commons.digester.Digester.parse(Digester.java:1562)\n        at\norg.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:488)\n        at org.apache.catalina.core.StandardHost.install(StandardHost.java:868)\n        at\norg.apache.catalina.startup.HostConfig.deployDescriptors(HostConfig.java:511)\n        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:468)\n        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:835)\n        at\norg.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:429)\n        at\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1240)\n        at org.apache.catalina.core.StandardHost.start(StandardHost.java:804)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1232)\n        at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:520)\n        at org.apache.catalina.core.StandardService.start(StandardService.java:519)\n        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2313)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:572)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.commons.launcher.ChildMain.run(ChildMain.java:269)\nApr 22, 2003 5:21:50 PM org.apache.catalina.startup.TldConfig tldScanJar\nSEVERE: Exception processing JAR at resource path\njndi:/localhost/jstl-examples/WEB-INF/lib/xalan.jar in context /jstl-examples\njava.io.IOException: Too many open files\n        at java.io.UnixFileSystem.createFileExclusively(Native Method)\n        at java.io.File.checkAndCreate(File.java:1313)\n        at java.io.File.createTempFile(File.java:1401)\n        at java.io.File.createTempFile(File.java:1438)\n        at sun.net.www.protocol.jar.URLJarFile$1.run(URLJarFile.java:169)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at sun.net.www.protocol.jar.URLJarFile.retrieve(URLJarFile.java:164)\n        at sun.net.www.protocol.jar.URLJarFile.getJarFile(URLJarFile.java:42)\n        at sun.net.www.protocol.jar.JarFileFactory.get(JarFileFactory.java:78)\n        at\nsun.net.www.protocol.jar.JarURLConnection.connect(JarURLConnection.java:85)\n        at\nsun.net.www.protocol.jar.JarURLConnection.getJarFile(JarURLConnection.java:69)\n        at org.apache.catalina.startup.TldConfig.tldScanJar(TldConfig.java:467)\n        at org.apache.catalina.startup.TldConfig.tldScanJar(TldConfig.java:449)\n        at org.apache.catalina.startup.TldConfig.execute(TldConfig.java:228)\n        at org.apache.catalina.core.StandardContext.start(StandardContext.java:4018)\n        at\norg.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:842)\n        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:826)\n        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:623)\n        at\norg.apache.catalina.core.StandardHostDeployer.addChild(StandardHostDeployer.java:804)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at\norg.apache.commons.beanutils.MethodUtils.invokeMethod(MethodUtils.java:252)\n        at org.apache.commons.digester.SetNextRule.end(SetNextRule.java:260)\n        at org.apache.commons.digester.Rule.end(Rule.java:276)\n        at org.apache.commons.digester.Digester.endElement(Digester.java:1064)\n        at\norg.apache.xerces.parsers.AbstractSAXParser.endElement(AbstractSAXParser.java:546)\n        at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanEndElement(XMLDocumentFragmentScannerImpl.java:1073)\n        at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(XMLDocumentFragmentScannerImpl.java:1535)\n        at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:348)\n        at\norg.apache.xerces.parsers.DTDConfiguration.parse(DTDConfiguration.java:539)\n        at\norg.apache.xerces.parsers.DTDConfiguration.parse(DTDConfiguration.java:595)\n        at org.apache.xerces.parsers.XMLParser.parse(XMLParser.java:152)\n        at\norg.apache.xerces.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1125)\n        at org.apache.commons.digester.Digester.parse(Digester.java:1562)\n        at\norg.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:488)\n        at org.apache.catalina.core.StandardHost.install(StandardHost.java:868)\n        at\norg.apache.catalina.startup.HostConfig.deployDescriptors(HostConfig.java:511)\n        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:468)\n        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:835)\n        at\norg.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:429)\n        at\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1240)\n        at org.apache.catalina.core.StandardHost.start(StandardHost.java:804)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1232)\n        at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:520)\n        at org.apache.catalina.core.StandardService.start(StandardService.java:519)\n        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2313)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:572)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.commons.launcher.ChildMain.run(ChildMain.java:269)\nApr 22, 2003 5:21:50 PM org.apache.catalina.startup.TldConfig tldScanJar',?,OTHER
19265,'Server dies when I try to access a webapp.','Tomcat 5',Catalina,rajiv.mordani,dev,'When I deploy a webapp and start the server and try to access any webapp the\nserver dies with the following exception - \n\nINFO: Starting Coyote HTTP/1.1 on port 8080\njava.lang.NegativeArraySizeException\n        at\norg.apache.naming.resources.ProxyDirContext.cacheUnload(ProxyDirContext.java:1690)\n        at\norg.apache.naming.resources.ProxyDirContext.cacheLookup(ProxyDirContext.java:1511)\n        at\norg.apache.naming.resources.ProxyDirContext.getAttributes(ProxyDirContext.java:921)\n        at\norg.apache.catalina.startup.HostConfig.checkContextLastModified(HostConfig.java:672)\n        at org.apache.catalina.startup.HostConfig.run(HostConfig.java:971)\n        at java.lang.Thread.run(Thread.java:536)',?,BUG
19269,'procrun, ant fork, JSP compilation failure','Tomcat 5',Catalina,marc.lehmann,dev,'Tomcat component: procrun\nJVM: 1.4.2 beta (JAVA_HOME set appropriately)\n\nTomcat fails to compile JSP pages when started via \"tomcatw.exe //GT//Tomcat5\". \nHowever, everything works fine if fork is set to false in web.xml.\n\nTomcat started via startup.bat or Tomcat run as service \nvia \"tomcat.exe //RS//Tomcat5\" doesn\'t cause any JSP compilation problems with \nfork being set to true.\n\n2003-04-23 23:31:58 StandardWrapperValve[jsp]: Servlet.service() for servlet \njsp threw exception\norg.apache.jasper.JasperException: Unable to compile class for JSP\n\nAn error occurred at line: -1 in the jsp file: null\n\nGenerated servlet error:\n    [javac] Since fork is true, ignoring compiler setting.\n    [javac] Compiling 1 source file\n    [javac] Since fork is true, ignoring compiler setting.\n\n\n\n\tat org.apache.jasper.compiler.DefaultErrorHandler.javacError\n(DefaultErrorHandler.java:120)\n\tat org.apache.jasper.compiler.ErrorDispatcher.javacError\n(ErrorDispatcher.java:307)\n\tat org.apache.jasper.compiler.Compiler.generateClass(Compiler.java:410)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:450)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:434)\n\tat org.apache.jasper.JspCompilationContext.compile\n(JspCompilationContext.java:571)\n\tat org.apache.jasper.servlet.JspServletWrapper.service\n(JspServletWrapper.java:303)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile\n(JspServlet.java:293)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:288)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:206)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:294)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:490)\n\tat org.apache.catalina.core.ContainerBase.invoke\n(ContainerBase.java:1020)\n\tat org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:196)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:490)\n\tat org.apache.catalina.core.ContainerBase.invoke\n(ContainerBase.java:1020)\n\tat org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2625)\n\tat org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:180)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.valves.ErrorDispatcherValve.invoke\n(ErrorDispatcherValve.java:171)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:149)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:172)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:490)\n\tat org.apache.catalina.core.ContainerBase.invoke\n(ContainerBase.java:1020)\n\tat org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:163)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:490)\n\tat org.apache.catalina.core.ContainerBase.invoke\n(ContainerBase.java:1020)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service\n(CoyoteAdapter.java:196)\n\tat org.apache.coyote.http11.Http11Processor.process\n(Http11Processor.java:612)\n\tat \norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio\nn(Http11Protocol.java:430)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java:565)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:623)\n\tat java.lang.Thread.run(Unknown Source)I can reproduce that, but Mladen cannot. Fork is now set to false by default.The cause of the bug has been indentified: the bug occurs when the path to javac\nis not in the PATH variable.There\'s a workaround now implemented in procrun.',?,IMPROVEMENT
19276,'Attribute is missing quotes when it contains an EL expression in a document with XML syntax.','Tomcat 5',Unknown,erik,dev,'When an EL expression is used in the value of an attribute in template data, \nthe resulting attribute that is output is missing quotes.\n\nI\'m using the JSP xml syntax.\n\nThis template data:\n<a style=\"border:0px;\" href=\"${ref}\">Link</a>\n\nGives this output:\n<a style=\"border:0px;\" href=/jsp/projects/common/?skin=default>Link</a>\n\nPlease note that it is only the \"href\" attribute that\'s missing quotes. \nThe \"style\" attribute still has them, since it does not contain a EL expression.',?,BUG
19445,'tomcat doesn\'t startup the second time on mac os x 10.2.5','Tomcat 5',Catalina,rajiv.mordani,dev,'When I install tomcat 5 on mac os x 10.2.5 running jdk 1.4.1_01-14 mixed mode\ntomcat comes up the first time. However if I stop the server and restart it then\nI get the following exception. The server doesn\'t stop however I get a \"document\n contains no data\" error when I try to access any page.\nCreated Listener\nStandardServer.await: create[8005]: java.net.SocketException: Too many open files\njava.net.SocketException: Too many open files\n        at java.net.ServerSocket.createImpl(ServerSocket.java:245)\n        at java.net.ServerSocket.getImpl(ServerSocket.java:203)\n        at java.net.ServerSocket.bind(ServerSocket.java:309)\n        at java.net.ServerSocket.<init>(ServerSocket.java:183)\n        at org.apache.catalina.core.StandardServer.await(StandardServer.java:523)\n        at org.apache.catalina.startup.Catalina.await(Catalina.java:625)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:587)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.commons.launcher.ChildMain.run(ChildMain.java:269)\njava.lang.NullPointerException\n        at\norg.apache.catalina.startup.HostConfig.deployDescriptors(HostConfig.java:483)\n        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:468)\n        at org.apache.catalina.startup.HostConfig.run(HostConfig.java:968)\n        at java.lang.Thread.run(Thread.java:554)Note this exception doesn\'t happen on Mac os only. If you deploy a lot of\nwars(about 40 or so) on tomcat 5 then this also happens on solaris 8 and other\nplatforms as well.Tomcat now tries to avoid opening lots of files (without guarantees), and\ndoesn\'t leak file descriptor. However, I think this bug is trying to prove that\nan OS global shared VM is bad for server environments.Mac OS X imposes a low limit on the number of open file descriptors a process\nmay have, specifically 256 by default.  There is no easy way to fix this from\nJava, but in the catalina shell script, you should probably add a call to the sh\nbuiltin  ulimit to increase the number of allowed open files. For example:\n\nulimit -n 1024\n\nThis solved the problem in my application and probably would solve the problem\nin tomcat.',?,OTHER
19455,'session tracking with \'jsessionid\' fails when query string parameters present','Tomcat 5',Catalina,pierre.delisle,dev,'If you try the JSP page included below, (call it test.jsp)\nwith cookies disabled in your browser, \nyou\'ll get the following links (modulo the context path):\n\n/standard-examples/test.jsp?foo=bar\n/standard-examples/test.jsp;jsessionid=2E90D2BBD0180E2D92A9F2EC87E736D9?foo=bar\n\nThe first one works fine, the second one gets you to tomcat\'s default page.\n(tested with the nightly of 4-28-2003)\nThe bug does not exist with tomcat-4.1.24.\n\n---- test.jsp ------\n<\%\n   String context = request.getContextPath();\n   String url1 = context + \"/test.jsp?foo=bar\";\n   String url2 = response.encodeURL(url1);\n\%>\n\n<a href=\'<\%=url1\%>\'><\%=url1\%><br>\n<a href=\'<\%=url2\%>\'><\%=url2\%><br>This is specific to jsessionid (changing that value to something else won\'t\nwork). The code which strips it is very bad anyway, so this will be a good\nopportunity to rewrite it efficiently.Monsieur, votre bug a été corrigé.',?,BUG
19607,'ant undeploy only stops the Context, but doesn\'t remove physial files','Tomcat 5',Webapps:Examples,johannes.fiala,dev,'CURRENT BEHAVIOUR:\nAfter doing an ant undeploy using the manager app, the manager app acknowledges \nthe command with [undeploy] OK.\n\nHowever, \n*) the /webapps/myapp.xml file doesn\'t get removed\n*) the /work/Standalone/localhost/manager/myapp.WAR and myapp.xml doesn\'t get \nremoved either.\n\nNot having deleted /webapps/myapp.xml causes the application to show up next \ntime Tomcat is started.\n\nI also inspected the code, but only found code to stop the app at \nContainerBase.java, public void removeChild(Container child).\n\nEXPECTED BEHAVIOUR:\nThe application should be completely removed from the server.This is almost fixed in 5.0.3: expanded folders and the WAR will be removed. The\nXML will not be removed yet (AFAIK); this will be fixed in 5.0.4.This is fixed in CVS, as part of the deployer refactorings.*** Bug 21577 has been marked as a duplicate of this bug. ***',?,BUILD_SYSTEM
19610,'Tomcat does not support a keystore with multiple keys with different passwords for each key','Tomcat 5',Catalina,mike,dev,'Similar to bug 1400 in Tomcat 4.0 bug database...  I strongly disagree with\nthe \"WONT FIX\" reason.\n\nI and many others strongly need tomcat to use keystores like they were suppose \nto be used, i.e. have support for keyaliases and a different keypass for each \nkey then the password for the actual keystore.   Porting a J2EE web app from \nWeblogic 8 to TomCat/JBoss isn\'t clean at all... because I have to end up \ncreating TWO keystores... one for Tomcat to use to get the SSL\nkeys... and one for my application to use.\n\nTomcat should be able to support a keystore with more than one key each key \ndifferentiated by a keyalias and a seperate keypassword.  Right now, you can \nonly have one key... and the alias must be \'tomcat\' and the password must be \nthe same as the keystore itself.  That is simply not right!\n\nAgain refer to bug 1400 for more detailsIt seems like the tomcat5 CoyoteServerSocketFactory allows configurable \nkeystore file, keystore password, and doesn\'t have the \"tomcat\" user hard \ncoded.  Am I looking at the wrong place?  Is this bug still relevant?Added \"keyAlias\" property on CoyoteConnector, which allows specifying the\nparticular keypair and supporting cert chain to be used by the connector when it\nauthenticates itself to SSL clients.\n\nNotice that JSSE currently does not support assigning different passwords to\nindividual keys via its standard APIs. I was told this is being planned for a\nfuture release.\n',?,RFE
19622,'Jasper2 has javaEncoding hard coded to UTF-8','Tomcat 5',Jasper,johannes.fiala,dev,'CURRENT BEHAVIOUR:\nJasper2 has javaEncoding hard coded to UTF-8\n\nDESIRED BEHAVIOUR:\nJasper 2 should allow this parameter to be set using the Jasper2-task \ninvocation at build.xml.\nDefault could still be UTF-8, so no one has to change anything.\n\nI\'ll attach a suggested patch, maybe other parameters could need soft-coding as \nwell (I concentrated on javaEncoding).\n\nChanges:\nline 171: String javaEncoding = \"UTF-8\";\n\nline 319ff:\n    /* Patch: allow javaEncoding to be set as ant parameter */\n    public String getJavaEncoding() {\n\treturn javaEncoding;\n    }\n\n    public void setJavaEncoding(String e) {\n     \tjavaEncoding = e;\n    }Created attachment 6183\nthis file contains all the necessary changes, inline docs should maybe be changed (?)<p>\nAdditionally, this makes the usage of Jspc with ant more consistent with the \nJspc Tomcat compilation, which\nallows <code>javaEncoding</code> to be set in /conf/web.xml: \n<code>\n<!--   javaEncoding        Java file encoding to use for generating java  -->\n<!--                       source files. [UTF8]                           -->\n</code>\n\nHowever, there is a small inconsistency in the original source of TC \n4.1.24/5.0.1 compared to /conf/web.xml. \nIt is \"UTF8\" at web.xml, but \"UTF-8\" at JspC.java. I left this inconsistency, \nas I don\'t know the reasons.\n</p>\nMade javaEncoding configurable per enhancement request.  Default remains at \nUTF-8.  web.xml untouched.',?,RFE
19713,>,'Tomcat 5',Jasper,hans,dev,'When a <jsp:forward> action with <jsp:param> children is nested within the body\nof some other action, the generated inline code can\'t be compiled. The reason is\nthat the inline code ends up in a generated method where the \"request\" variable\nis not defined.\n\nExample JSP page:\n\n  <\%@ taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" \%>\n  <c:if test=\"true\">\n    <jsp:forward page=\"bar.jsp\">\n      <jsp:param name=\"foo\" value=\"bar\" />\n    </jsp:forward>\n  </c:if>\n\nGenerates inline code for <jsp:forward> in a method like this:\n\n  private boolean _jspx_meth_c_if_0(PageContext pageContext)\n          throws Throwable {\n    JspWriter out = pageContext.getOut();\n    /* ----  c:if ---- */\n    org.apache.taglibs.standard.tag.rt.core.IfTag _jspx_th_c_if_0 =\n(org.apache.taglibs.standard.tag.rt.core.IfTag)\n_jspx_tagPool_c_if_test.get(org.apache.taglibs.standard.tag.rt.core.IfTag.class);\n    _jspx_th_c_if_0.setPageContext(pageContext);\n    _jspx_th_c_if_0.setParent(null);\n    _jspx_th_c_if_0.setTest(true);\n    int _jspx_eval_c_if_0 = _jspx_th_c_if_0.doStartTag();\n    if (_jspx_eval_c_if_0 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {\n      do {\n        out.write(\"\\r\\n  \");\n        if (true) {\n          pageContext.forward(\"bar.jsp\" + ((\"bar.jsp\").indexOf(\'?\')>0? \'&\': \'?\')\n+ org.apache.jasper.runtime.JspRuntimeLibrary.URLEncode(\"foo\",\nrequest.getCharacterEncoding())+ \"=\" +\norg.apache.jasper.runtime.JspRuntimeLibrary.URLEncode(\"bar\",\nrequest.getCharacterEncoding()));\n          return true;\n        }\n    ...\n    }\n\nThe reference to \"request\", i.e., in \"request.getCharacterEncoding()\", leads to\ncompilation errors:\n\n      [javac] Compiling 1 source file\n    [javac]\n/home/hans/bin/jakarta-tomcat-5.0.2/work/Catalina/localhost/ora/org/apache/jsp/foo_jsp.java:84:\ncannot resolve symbol\n    [javac] symbol  : variable request \n    [javac] location: class org.apache.jsp.foo_jsp\n    [javac]           pageContext.forward(\"bar.jsp\" +\n((\"bar.jsp\").indexOf(\'?\')>0? \'&\': \'?\') +\norg.apache.jasper.runtime.JspRuntimeLibrary.URLEncode(\"foo\",\nrequest.getCharacterEncoding())+ \"=\" +\norg.apache.jasper.runtime.JspRuntimeLibrary.URLEncode(\"bar\",\nrequest.getCharacterEncoding()));Fixed.  Thanks for reporting it.',?,BUG
19910,'Cleanup for jakarta-tomcat-5/RUNNING.txt','Tomcat 5',Unknown,pepper,dev,'Grammar cleanup, including subject-verb agreement,\nMake $CATALINA_BASE & $CATALINA_HOME consistent.\nRemove implication that $CATALINA_BASE files should only include those different than standard files in \n$CATALINA_HOME; I don\'t believe if a file\'s not in $CATALINA_BASE the \'default\' is picked up from \n$CATALINA_HOME, but am not absolutely certain.\n\nSomeone should verify that Windows doesn\'t restrict listeners <= 1024 (I\'m pretty sure Win98 doesn\'t, \nbut don\'t know about W2k3).\n\nIndex: RUNNING.txt\n================================================================\n===\nRCS file: /home/cvspublic/jakarta-tomcat-5/RUNNING.txt,v\nretrieving revision 1.1\ndiff -u -r1.1 RUNNING.txt\n--- RUNNING.txt\t1 Aug 2002 21:00:18 -0000\t1.1\n+++ RUNNING.txt\t14 May 2003 03:13:40 -0000\n@@ -6,7 +6,7 @@\n \n This subproject contains Tomcat 5, a server that implements the Servlet 2.4\n and JSP 2.0 specifications from the Java Community Process\n-(http://www.jcp.org).  In order to install and run this container, you must do\n+<http://www.jcp.org/>.  In order to install and run this container, you must do\n the following:\n \n \n@@ -42,7 +42,7 @@\n * Unpack the binary distribution into a convenient location so that the\n   distribution resides in its own directory (conventionally named\n   \"jakarta-tomcat-5\").  For the purposes of the remainder of this document,\n-  the symbolic name \"<CATALINA_HOME>\" is used to refer to the full\n+  the symbolic name \"$CATALINA_HOME\" is used to refer to the full\n   pathname of the release directory.\n \n \n@@ -50,12 +50,12 @@\n \n Tomcat 5 can be started by executing the following commands:\n \n-      <CATALINA_HOME>\\bin\\startup.bat          (Windows)\n+      $CATALINA_HOME\\bin\\startup.bat          (Windows)\n \n-      <CATALINA_HOME>/bin/startup.sh           (Unix)\n+      $CATALINA_HOME/bin/startup.sh           (Unix)\n \n After startup, the default web applications included with Tomcat 5 will be\n-available by browsing:\n+available by visiting:\n \n     http://localhost:8080/\n \n@@ -69,23 +69,23 @@\n \n Tomcat 5 can be shut down by executing the following command:\n \n-      <CATALINA_HOME>\\bin\\shutdown            (Windows)\n+      $CATALINA_HOME\\bin\\shutdown            (Windows)\n \n-      <CATALINA_HOME>/bin/shutdown.sh         (Unix)\n+      $CATALINA_HOME/bin/shutdown.sh         (Unix)\n \n \n (4) Advanced Configuration - Multiple Tomcat 5 Instances\n \n In many circumstances, it is desirable to have a single copy of a Tomcat 5\n binary distribution shared among multiple users on the same server.  To make\n-this possible, you must pass a \"-Dcatalina.base=<CATALINA_BASE>\" argument when\n-executing the to the startup command (see (2)). In this\n-\"-Dcatalina.base=<CATALINA_BASE>\" argument, replace <CATALINA_BASE> with the\n-directory that contains the files unique to your Tomcat 5 instance.\n+this possible, you can pass a \"-Dcatalina.base=$CATALINA_BASE\" argument when\n+executing the startup command (see (2)). In this\n+\"-Dcatalina.base=$CATALINA_BASE\" argument, replace $CATALINA_BASE with the\n+directory that contains the files for your \'personal\' Tomcat 5 instance.\n \n-When you use this \"-Dcatalina.base=<CATALINA_BASE>\" argument, Tomcat 5 will\n+When you use this \"-Dcatalina.base=$CATALINA_BASE\" argument, Tomcat 5 will\n calculate all relative references for files in the following directories based\n-on the value of <CATALINA_BASE> instead of <CATALINA_HOME>:\n+on the value of $CATALINA_BASE instead of $CATALINA_HOME:\n \n * conf - Server configuration files (including server.xml)\n \n@@ -97,24 +97,27 @@\n \n * temp - Directory used by the JVM for temporary files (java.io.tmpdir)\n \n-If you do not pass the \"-Dcatalina.base=<CATALINA_BASE>\" argument to the startup command, \n<CATALINA_BASE> will default to the same value as <CATALINA_HOME> (which means that the same \ndirectory is used for all relative path resolutions).\n+If you do not pass the \"-Dcatalina.base=$CATALINA_BASE\" argument to the\n+startup command, $CATALINA_BASE will default to the same value as\n+$CATALINA_HOME (which means that the same directory is used for all\n+relative path resolutions).\n \n The administration and manager web applications, which are defined in the\n-<CATALINA_BASE>/webapps/admin.xml and <CATALINA_BASE>/webapps/manager.xml will\n-not run in that configuration, unless either:\n+$CATALINA_BASE/webapps/admin.xml and $CATALINA_BASE/webapps/manager.xml\n+files, will not run in that configuration, unless either:\n - The path specified in the docBase attribute of the Context element is made \n-  absolute, and replaced respectively by <CATALINA_HOME>/server/webapps/admin \n-  and <CATALINA_HOME>/server/webapps/manager\n-- Copying and linking both web applications in <CATALINA_BASE>, and modify \n-  accordingly the path specified in the docBase attribute of the Context \n-  element\n-- Disabling both web applications by removing <CATALINA_BASE>/webapps/admin.xml\n-  and <CATALINA_BASE>/webapps/manager.xml\n+  absolute, and replaced respectively by $CATALINA_HOME/server/webapps/admin \n+  and $CATALINA_HOME/server/webapps/manager\n+- Both web applications are copied or to $CATALINA_BASE, and\n+  the path specified in the docBase attribute of the Context \n+  element is modified appropriately\n+- Both web applications are disabled by removing\n+  $CATALINA_BASE/webapps/admin.xml and $CATALINA_BASE/webapps/manager.xml\n \n \n (5) Troubleshooting:\n \n-There are only really 3 things that can go wrong during the stand-alone\n+There are only really 3 things likely to go wrong during the stand-alone\n Tomcat 5 install:\n \n 1) The most common hiccup is when another web server (or any process for that\n@@ -125,26 +128,26 @@\n     \n    and search for \'8080\'.  Change it to a port that isn\'t in use, and is\n    greater than 1024, as ports less than or equal to 1024 require superuser\n-   access to bind to.\n+   access to bind to under UNIX.\n    \n    Restart Tomcat and you\'re in business.  Be sure that you replace the \"8080\"\n    in the URL you\'re using to access Tomcat.  For example, if you change the\n-   port to 1977, you would request the URL http://localhost:1977/.\n+   port to 1977, you would request the URL http://localhost:1977/ in your browser.\n \n 2) An \"out of environment space\" error when running the batch files in\n    Windows 95, 98, or ME operating systems.\n \n    Right-click on the STARTUP.BAT and SHUTDOWN.BAT files.  Click on\n-   \"Properties\" then on the \"Memory\" tab.  For the \"Initial environment\" field,\n+   \"Properties\", then on the \"Memory\" tab.  For the \"Initial environment\" field,\n    enter in something like 4096.\n    \n-   After you click apply, Windows will create shortcuts in the directory with\n+   After you click apply, Windows will create shortcuts\n    which you can use to start and stop the container.\n \n 3) The \'localhost\' machine isn\'t found.  This could happen if you\'re behind a\n    proxy.  If that\'s the case, make sure the proxy configuration for your\n-   browser knows that you shouldn\'t be going through the proxy to access the\n-   \"localhost\" machine.\n+   browser knows that you shouldn\'t be going through the proxy to access\n+   \"localhost\".\n    \n    In Netscape, this is under Edit/Preferences -> Advanced/Proxies, and in\n    Internet Explorer, Tools -> Internet Options -> Connections -> LAN Settings.Fixed.',?,DOCUMENTATION
19912,'Cleanup for jakarta-tomcat-5/BUILDING.txt','Tomcat 5',Catalina,pepper,dev,'Various grammar nits\nURLs should be in angle brackets (not parentheses) in plain text, per the RFC.\nWhy quote non-literal paths??\n\nIndex: BUILDING.txt\n================================================================\n===\nRCS file: /home/cvspublic/jakarta-tomcat-5/BUILDING.txt,v\nretrieving revision 1.30\ndiff -u -r1.30 BUILDING.txt\n--- BUILDING.txt\t26 Nov 2002 09:09:21 -0000\t1.30\n+++ BUILDING.txt\t14 May 2003 03:19:31 -0000\n@@ -5,8 +5,8 @@\n                  ===========================================\n \n This subproject contains the source code for Tomcat 5, a container that\n-implements the Servlet 2.4 and the JSP 2.0 specifications from the Java\n-Community Process (http://www.jcp.org).  In order to build a binary\n+implements the Servlet 2.4 and JSP 2.0 specifications from the Java\n+Community Process <http://www.jcp.org/>.  In order to build a binary\n distribution version of the container from a source distribution, \n do the following:\n \n@@ -47,28 +47,28 @@\n   the symbolic name \"${ant.home}\" is used to refer to the full pathname of\n   the release directory.\n \n-* Modify the PATH environment variable to include directory\n-  \"${ant.home}/bin\" in its list.  This makes the \"ant\" command line script\n+* Modify the PATH environment variable to include the directory\n+  ${ant.home}/bin in its list.  This makes the \"ant\" command line script\n   available, which will be used to actually perform the build.\n \n \n (1.2) Download and Install the Xalan 2 Distribution\n \n-* Download a binary distribution of version 2.x from:\n+* Download a binary distribution of Xalan version 2.x from:\n \n   http://xml.apache.org/dist/xalan-j/\n \n-  On a Windows platform, you will need:\n+  On a Windows platform, you probably want:\n     Xerces-J-bin.2.x.y.zip\n \n-  On a Unix platform, you will need:\n+  On a Unix platform, you probably want:\n     Xerces-J-bin.2.x.y.tar.gz\n \n * Unpack the binary distribution into a convenient location so that the\n   distribution resides in its own directory (conventionally named\n   \"xalan-2_x_y\").\n \n-* Copy the xalan.jar file from that distribution to the \"${ant.home}/lib\"\n+* Copy the xalan.jar file from that distribution to the ${ant.home}/lib\n   directory.\n \n \n@@ -94,8 +94,8 @@\n   file to indicate to Ant the proxy configuration. Read below.\n \n * WARNING: Running this command will checkout the Tomcat 5 sources from CVS, as\n-  well as download binaries to the \"/usr/local\" directory. Make sure this is\n-  appropriate to do so on your computer. On Windows, this usually corresponds\n+  well as download binaries to the /usr/local directory. Make sure this is\n+  appropriate to do on your computer. On Windows, this usually corresponds\n   to the \"C:\\usr\\local\" directory, unless Cygwin is used. Read below to \n   customize the directory used to download the binaries.\n \n@@ -116,7 +116,7 @@\n \n (3) Updating sources\n \n-It is recommended to regularly update the downloaded Tomcat 5 sources. \n+It is recommended that you regularly update the downloaded Tomcat 5 sources. \n To do this, execute the following commands:\n \n     cd ${tomcat.source}\n@@ -131,9 +131,5 @@\n     ant build\n \n In addition, \"ant build-depends\" will build packages that \n-tomcat depends on ( commons-logging for now ), to ease fixes\n-and debuging in those packages.\n-\n-\n-\n-  \n\\ No newline at end of file\n+tomcat depends on (commons-logging for now), to ease fixes\n+and debugging in those packages.Fixed.',?,DOCUMENTATION
19939,'Cleanup for jakarta-tomcat-5/RELEASE-NOTES','Tomcat 5',Catalina,pepper,dev,'Misc grammar cleanup.\n\nIndex: RELEASE-NOTES\n===================================================================\nRCS file: /home/cvspublic/jakarta-tomcat-5/RELEASE-NOTES,v\nretrieving revision 1.2\ndiff -u -r1.2 RELEASE-NOTES\n--- RELEASE-NOTES\t4 Feb 2003 23:41:01 -0000\t1.2\n+++ RELEASE-NOTES\t15 May 2003 02:52:21 -0000\n@@ -69,7 +69,7 @@\n putting unpacked classes into a \"classes\" directory (not created by default),\n or by placing them in JAR files in the \"lib\" directory.\n \n-Tomcat 5.0 also makes available Xerces 2 to web applications.\n+Tomcat 5.0 also makes Xerces 2 available to web applications.\n \n \n --------------------------\n@@ -90,12 +90,12 @@\n Some shared libraries (many are part of the JDK) keep references to objects\n instantiated by the web application. To avoid class loading related problems\n (ClassCastExceptions, messages indicating that the classloader \n-is stopped, ...), the shared libraries state should be reinitialized.\n+is stopped, etc.), the shared libraries state should be reinitialized.\n \n-Something which could help is to avoid putting classes which would be \n+Something which might help is to avoid putting classes which would be \n referenced by a shared static field in the web application classloader, \n-and put them in the shared classloader instead (the JARs should be put in the \n-\"lib\" folder, and classes should be put in the \"classes\" folder).\n+and putting them in the shared classloader instead (JARs should be put\n+in the \"lib\" folder, and classes should be put in the \"classes\" folder).\n \n \n --------------------\n@@ -114,13 +114,13 @@\n Linux and Sun JDK 1.2.x - 1.3.x:\n -------------------------------\n \n-Virtual machine crashes can be experienced when using certain combinations of\n+Virtual machine crashes may be experienced when using certain combinations of\n kernel / glibc under Linux with Sun Hotspot 1.2 to 1.3. The crashes were \n reported to occur mostly on startup. Sun JDK 1.4 does not exhibit the problems,\n and neither does IBM JDK for Linux.\n \n-The problems can be fixed by reducing the default stack size. At bash shell, \n-do \"ulimit -s 2048\"; use \"limit stacksize 2048\" for tcsh.\n+The problems can be fixed by reducing the default stack size. From a bash shell,\n+use \"ulimit -s 2048\"; use \"limit stacksize 2048\" for tcsh.\n \n GLIBC 2.2 / Linux 2.4 users should also define an environment variable:\n export LD_ASSUME_KERNEL=2.2.5\n@@ -136,24 +136,24 @@\n disabled by default, as our goal is to provide a fully secure default \n configuration. However, CGI and SSI remain available.\n \n-On Windows:\n+To enable CGI and SSI on Windows:\n * rename the file \%CATALINA_HOME\%\\server\\lib\\servlets-cgi.renametojar to\n   \%CATALINA_HOME\%\\server\\lib\\servlets-cgi.jar.\n * rename the file \%CATALINA_HOME\%\\server\\lib\\servlets-ssi.renametojar to\n   \%CATALINA_HOME\%\\server\\lib\\servlets-ssi.jar.\n * in \%CATALINA_HOME\%\\conf\\web.xml, uncomment the servlet declarations starting\n-  line 165 and 213, as well as the associated servlet mappings \n-  line 265 and 274. Alternately, these servlet declarations and mappings can\n+  on lines 165 and 213, as well as the associated servlet mappings on\n+  lines 265 and 274. Alternately, these servlet declarations and mappings can\n   be added to your web application deployment descriptor.\n \n-On Unix:\n+To enable CGI and SSI on Unix:\n * rename the file $CATALINA_HOME/server/lib/servlets-cgi.renametojar to\n   $CATALINA_HOME/server/lib/servlets-cgi.jar.\n * rename the file $CATALINA_HOME/server/lib/servlets-ssi.renametojar to\n   $CATALINA_HOME/server/lib/servlets-ssi.jar.\n * in $CATALINA_HOME/conf/web.xml, uncomment the servlet declarations starting\n-  line 165 and 213, as well as the associated servlet mappings \n-  line 265 and 274. Alternately, these servlet declarations and mappings can\n+  on lines 165 and 213, as well as the associated servlet mappings\n+  on lines 265 and 274. Alternately, these servlet declarations and mappings can\n   be added to your web application deployment descriptor.\n \n \n@@ -162,7 +162,7 @@\n ---------------------\n \n The URLs to be used in the policy file to grant permissions to JARs located\n-inside the web application repositories have changed in Tomcat 5.0.\n+inside the web application repositories have changed as of Tomcat 4.1.\n \n In Tomcat 4.0, codeBase URLs for JARs loaded from web application \n repositories were:\n@@ -176,8 +176,8 @@\n Symlinking static resources:\n ---------------------------\n \n-Unix symlinks will not work when used in a web application to link resources \n-located outside the web application root directory.\n+By default, Unix symlinks will not work when used in a web application to\n+link resources located outside the web application root directory.\n \n This behavior is optional, and the \"allowLinking\" flag may be used to disable\n the check.\n@@ -188,7 +188,7 @@\n ------------------------\n \n Starting with Tomcat 4.1.12, the invoker servlet is no longer available by \n-default in all webapp. Enabling it for all webapps is possible by editing\n+default in all webapps. Enabling it for all webapps is possible by editing\n $CATALINA_HOME/conf/web.xml to uncomment the \"/servlet/*\" servlet-mapping\n definition.Fixed.',?,DOCUMENTATION
19940,'Cleanup for jakarta-tomcat-5/resources/mbeans/tomcat5-ant.xml','Tomcat 5',Catalina,pepper,dev,'Suggested cleanup for resources/mbeans/tomcat5-ant.xml\n\nIndex: resources/mbeans/tomcat5-ant.xml\n===================================================================\nRCS file: /home/cvspublic/jakarta-tomcat-5/resources/mbeans/tomcat5-ant.xml,v\nretrieving revision 1.10\ndiff -u -r1.10 tomcat5-ant.xml\n--- resources/mbeans/tomcat5-ant.xml\t25 Apr 2003 14:38:50 -0000\t1.10\n+++ resources/mbeans/tomcat5-ant.xml\t15 May 2003 03:22:38 -0000\n@@ -4,7 +4,7 @@\n   <property file=\"build.properties\"/>\n \n   <property name=\"tomcat.home\" location=\".\" />\n-  <!-- That matches the build struct with build and embed at the same level -->\n+  <!-- This matches the build struct with build and embed at the same level -->\n   <property name=\"tomcat.webapps\" location=\"${tomcat.home}/../build/webapps\" />\n \n   <path id=\"tomcatCP-extra\" /> \n@@ -257,7 +257,7 @@\n          <attribute name=\"privileged\" value=\"true\" />\n        </mbean>\n \n-       <!-- The realm must be declared after the web module. ( for now ) -->\n+       <!-- The realm must be declared after the web module (for now). -->\n        <mbean name=\"${domain}:type=Realm,host=localhost,path=manager\" \n               code=\"org.apache.catalina.realm.MemoryRealm\" modeler=\"true\">\n          <attribute name=\"pathname\"\n@@ -409,7 +409,7 @@\n   </target>\n \n   <!-- ==================== Await ==================== \n-       Call this target if you want the build file to hung in \"await\". Tomcat stop or ^C will stop \n+       Call this target if you want the build file to hang in \"await\". Tomcat stop or ^C will \nstop \n        the ant execution\n     -->\n   <target name=\"await\" depends=\"init\"Fixed',?,CLEANUP
19941,'Comment cleanup for jakarta-tomcat-5/resources/confinstall/server_1.xml','Tomcat 5',Catalina,pepper,dev,'A comment says to uncomment entries that are already uncommented.\nClarify wording on what request.getRemoteHost() does without DNS.\n\nIndex: resources/confinstall/server_1.xml\n===================================================================\nRCS file: /home/cvspublic/jakarta-tomcat-5/resources/confinstall/server_1.xml,v\nretrieving revision 1.4\ndiff -u -r1.4 server_1.xml\n--- resources/confinstall/server_1.xml\t3 May 2003 21:55:13 -0000\t1.4\n+++ resources/confinstall/server_1.xml\t15 May 2003 03:25:09 -0000\n@@ -13,7 +13,7 @@\n <Server port=\"8005\" shutdown=\"SHUTDOWN\" debug=\"0\">\n \n \n-  <!-- Uncomment these entries to enable JMX MBeans support -->\n+  <!-- Comment out these entries to disable JMX MBeans support -->\n   <Listener className=\"org.apache.catalina.mbeans.ServerLifecycleListener\"\n             debug=\"0\"/>\n   <Listener className=\n\"org.apache.catalina.mbeans.GlobalResourcesLifecycleListener\"\n@@ -78,7 +78,7 @@\n          request.getRemoteHost().  This can have an adverse impact on\n          performance, so you can disable it by setting the\n          \"enableLookups\" attribute to \"false\".  When DNS lookups are disabled,\n-         request.getRemoteHost() will return the String version of the\n+         request.getRemoteHost() will return a String containing the\n          IP address of the remote client.\n     -->Fixed',?,DOCUMENTATION
19942,jakarta-tomcat-5/resources/confinstall/server_2.xml,'Tomcat 5',Catalina,pepper,dev,'s/will works/will work/\nClarify $CATALINA_HOME/logs (as written, it\'s confusing).\n\nIndex: resources/confinstall/server_2.xml\n===================================================================\nRCS file: /home/cvspublic/jakarta-tomcat-5/resources/confinstall/server_2.xml,v\nretrieving revision 1.9\ndiff -u -r1.9 server_2.xml\n--- resources/confinstall/server_2.xml\t3 May 2003 21:55:13 -0000\t1.9\n+++ resources/confinstall/server_2.xml\t15 May 2003 03:25:09 -0000\n@@ -116,7 +116,7 @@\n       <!-- Add the following attributes if you want to turn XML validation\n            on. Remember to comment the Host element above. \n            \n-           Note: XML Schema validationn will works with Xerces 2.0.1 or \n+           Note: XML Schema validationn will work with Xerces 2.0.1 or \n            Xerces 2.1. Xerces 2.0.2 and Xerces 2.2 have bugs that prevent \n            their use with Tomcat-->\n       <!--\n@@ -144,8 +144,8 @@\n         -->\n \n         <!-- Access log processes all requests for this virtual host.  By\n-             default, log files are created in the \"logs\" directory relative to\n-             $CATALINA_HOME.  If you wish, you can specify a different\n+             default, log files are created in $CATALINA_HOME/logs.\n+             If you wish, you can specify a different\n              directory with the \"directory\" attribute.  Specify either a relative\n              (to $CATALINA_HOME) or absolute path to the desired directory.\n         -->Fixed',?,BUG
19958,'Problems reading ServletInputStream','Tomcat 5',Connector:HTTP,lkarpel,dev,'We are having problems reading the ServletInputStream in\nTomcat 5.0.2. The data read is not what is expected.\n\nThe enclosed webapp example works fine in Tomcat 4.0.6 and\n4.1.24 .. but does NOT using 5.0.2 !!\n\nThe intent is to continue reading the request\'s input stream\nafter Tomcat has read the headers. For example we are having\nproblems parsing multipart/form-data posts and anything else\nthat contains data after the headers.\n\nThe enclosed zip file contains a webapp that can be used to\nduplicable the failure. I have enclosed log output the example\nwebapp produces from TC4.1 and TC5.0.\n\nI will post the zip file in a moment.\n\n1. unzip the enclised test.zip info c:\\ .. that is what the\n   server.xml files assume anyway\n\n2. test under TC4.1.24\n\n\ta. copy the tc41-server.xml to the tc41 config folder as server.xml\n\tb. start tc4.1.24\n\tc. start IE\n\td. ping http://server:8080/test/test\n\te. a form show be showing\n\tf. use the browse button and select the enclosed test.jpg file\n\tg. click submit\n\th. exit IE\n\ti. stop TC\n\tj. examine the log file (i have enclosed sample output in tc41.log)\n\t\n3. test under TC5.0.2\n\n\ta. copy the tc50-server.xml to the tc50 config folder as server.xml\n\tb. start tc5.0.2\n\tc. start IE\n\td. ping http://server:8080/test/test\n\te. a form show be showing\n\tf. use the browse button and select the enclosed test.jpg file\n\tg. click submit\n\th. exit IE\n\ti. stop TC\n\tj. examine the log file (i have enclosed sample output in tc50.log)\n\n4. compare the two log files .. note that the data read using TC5 is bad.Created attachment 6364\nExample webapp that demontrates the specified problem.I completely rewrote input handling based on the model used for output, and it\nis now much faster (and memory efficient). Maybe there are bugs that slipped\nthrough my tests, though (so I\'ll look into the report).The workaround I\'m using right now is to wrap request.getInputStream() with a\nBufferedInputStream. \n\nI\'m also looking at that bug (but I\'m not as good as Remy ;-) )\n\n-- JeanfrancoisI could reproduce the bug. The problem was that the input stream was incorrectly\nusing read() from the input buffer (instead, it should use readByte(); you can\npretty much imagine what was going on from there).\nNote that using readLine with the input stream is very inefficient (what it\nactually does is byte by byte reading). I\'m not sure this can be optimized,\nunless I add marking support to byte reading (not sure if it\'s worth it).\n\nIronically, I tested the readLine() method of the reader a lot more (probably\nbecause it looks totally nasty ;-) ).\n\nThanks for the test case. If all bug reports were like that, maybe there would\nbe zero open bugs in BZ ...I have tested against the latest nightlies and all is now ok .. thanks.',?,BUG
20029,'catalina.sh - command \"stop -force\" not working','Tomcat 5',Native:Integration,horombo,dev,'The \'if [ \"$1\" = \"-force\" ]\' branch of the stop command is never called because\nof the previous \"exec $_RUNJAVA... org.apache.catalina.startup.Bootstrap $@\nstop\" command (the processing of catalina.sh ends by calling exec). \n\nRemoving the exec command fixes the problem as far as I can see.\n\nFixed code snippet:\n\nelif [ \"$1\" = \"stop\" ] ; then\n\n  shift\n  \"$_RUNJAVA\" $JAVA_OPTS $CATALINA_OPTS \\\n    -Djava.endorsed.dirs=\"$JAVA_ENDORSED_DIRS\" -classpath \"$CLASSPATH\" \\\n    -Dcatalina.base=\"$CATALINA_BASE\" \\\n    -Dcatalina.home=\"$CATALINA_HOME\" \\\n    -Djava.io.tmpdir=\"$CATALINA_TMPDIR\" \\\n    org.apache.catalina.startup.Bootstrap \"$@\" stop\n\n  if [ \"$1\" = \"-force\" ] ; then\n    shift\n    if [ ! -z \"$CATALINA_PID\" ]; then\n       echo \"Killing: `cat $CATALINA_PID`\"\n       kill -9 `cat $CATALINA_PID`\n    fi\n  fi\n\n\nelseBut removing the exec will make shutdown.sh wait until shutdown is complete, \nnot return right away like now.  For a large system, this can easily be \nseveral seconds (or more, depending on custom shutdown code in user webapps).Since I don\'t see how this can work well in all situations (except if we add a\nnew command which would just kill Tomcat - not that good an idea IMO), I\'m\nwilling to make the change. We\'ll see how it works in practice ...',?,BUG
20086,'Broken link for JK Documentation','Tomcat 5',Webapps:Documentation,bhoran2,dev,'In the Tomcat 5.0 page, http://jakarta.apache.org/tomcat/tomcat-5.0-doc/, \nclicking on the \"JK Documentation\" link in the left column wants to go to \nhttp://jakarta.apache.org/tomcat/tomcat-5.0-doc/coyote/jk2/index.html, but \nnothing is found there.Created attachment 7000\nTest container servletAttached test container servlet for the wrong bug, please ignore ;)This now links to the online docs.',?,DOCUMENTATION
20291,'html wrong','Tomcat 5',' JSP API',mysign8,dev,'html wrong',?,OTHER
20320,'html wrong','Tomcat 5',Catalina:Modules,mysign8,dev,' ',?,OTHER
20894,'body-content value of \"JSP\" should be error if SimpleTag','Tomcat 5',Jasper,mark.roth,dev,'According to JSP 2.0 PFD3, JSP.7.1.5, \"The body of a Simple Tag, if present, is\ntranslated into a JSP Fragment and passed to the setJspBody method.\"\n\nAccording to JSP 2.0 PFD3, JSP.7.1.6, \"A translation error must occur if a piece\nof JSP code that is to be translated into a JSP Fragment contains scriptlets or\nscriptlet expressions.\"\n\nThere is nothing that explicitly requires that a <body-content> of \"JSP\" in the\nTLD for a SimpleTag must produce an error.  However, this is technically\ninvalid, and the JSP 2.0 specification will now say that it such a TLD will be\nconsidered invalid.\n\nIt would be very helpful for tag library developers if Tomcat can flag such an\nerror right away and indicate that the TLD is invalid for that reason.  This can\ntake the form of a translation error, for example.  This would be symmetrical\nwith the current treatment of body-content=\"JSP\" in Tag Files (which is\ncurrently explicitly required to produce a translation error).The way jasper is structured, no validation is done when TLDs are read. \nInstead, this error is now detected when custom tags are processed.  This is\nprobably good enough.',?,IMPROVEMENT
21010,'Error creating new context','Tomcat 5',Catalina,dario.bonino,dev,'Error saving (\"Commit changes\") new context with \'/\' char\ninto his name, for example i need to create \"/app/bpb\" context.\n\nWorkaround:\nI create \"/appbpb\" context and then I modify\nthe path attribute from \"/appbpb\" to \"/app/bpb\" \ninto the \"<HOME>/conf/Catalina/localhost/appbpb.xml\"Well, that\'s a known issue. None of the chars which aren\'t allowed in a filename\nare filtered out at the moment, so ...\nI think this is the same behavior as with TC 4.1.x.Actually, small correction: this doesn\'t happen in TC 4.1.x, as it doesn\'t try\nto save the context stuff as separate files.\nI\'ll slightly refactor things and expose a config file base field at the host\nlevel, and add escaping code in StandardContext. This should fix the issue, as\nwell as bug 19607.*** Bug 20217 has been marked as a duplicate of this bug. ***This should have been fixed as part of the deployer refactorings.\nThe context file name should now be decoupled from the path name. In case a\ncontext file doesn\'t exist (so it will be created automatically when saving\nchanges in the admin webapp), \'/\' will be escaped.',?,BUG
21045,'Manager app does find resources','Tomcat 5',Webapps:Administration,radim.kubacki,dev,'JDK1.4.1/Linux/Tomcat5.0.3\n\nCommands like \nhttp://localhost:8080/manager/remove?path=/build\nor \nhttp://localhost:8080/manager/deploy?path=/build&war=file:/usr/local/home/radim/Projects/wa/output/DebugConfig/build\nshows \'Cannot find message associated with key managerServlet.installed\' or\nCannot find message associated with key managerServlet.removed\' as their output\ninstead of strings that should come from properties file and begin with \'OK -\'I\'m happy to report that if you\'re French, there\'s no problem :)\n\nThe message key should be updated:\n- install -> deploy\n- remove -> undeploy\nThis will be in 5.0.4.Noone have contributed czech localization yet so I stick with english as it is\ndefault ;-). Anyway thanks for promt fix, my dev build works OK now.',?,BUG
21067,'tag file handler generation with array attributes','Tomcat 5',Jasper,crofton-2003,dev,'I have written a tag file with a attribute of string array. just like this:\n<\%@ attribute name=\"columns\" type=\"java.lang.String[]\"\%>\n\nI wrote a JSP file to invoke this tag file. the variable \"columns\" has been \nset.\n1. <tags:test columns=\"<\%= columns \%>\"/>\nWhen I pass attribute in the JSP file using scriptlet, it\'s ok.\n\n2. <tags:test columns=\"{columns}\"/>\nBut when I pass attribute using EL, something will be wrong, The following is \nthe error statement reported by japser compiler when compiling the JSP file:\nsetColumns(([Ljava.lang.String;) \norg.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate(\"${columns}\", \n[Ljava.lang.String;.class, (PageContext)pageContext, null, false));Fixed.  Thanks for reporting the bug.',?,BUG
21168,'Incorrect paths in generated SMAP file entries','Tomcat 5',Jasper,jph,dev,'One of the new features of Jasper in Tomcat 5 is that it attaches a \"Source\nMap\" attribute to class files to describe the file name and line number\nmapping from a JSP source file to the generated Java source file.\n\nThe SMAP that I see in the class files generated by Jasper (5.0.3 alpha)\nhas a couple of small problems:\n\n1. The second line of the SMAP, according to JSR-45, is the name of the\n   generated source file.  This name should be without path information,\n   but path information appears in the version generated by Jasper.\n\n2. In the \"*F\" section, there\'s a pair of lines that defines the JSP file.\n   The second line is the source path for the JSP file.  The path created\n   by Jasper contains a leading slash, making it an absolute path.  It\n   should be relative; the leading slash should not appear.The second line of the SMAP contains path information on Windows machines \nbecause SmapUtil.java\'s generateSmap() method calls unqualify() to remove the \npath information, and unqualify() only works on pathname strings with \"/\" as \nthe name-separator character.  I fixed this by rewriting unqualify().\n\nThe leading slash in the source path in the \"*F\" section originates deep \nwithin Tomcat (for instance, in a call to HttpServletRequest.getServletPath() \nwhen the request is first touched), so I chose to remove the leading slash \njust before writing the source path to the SMAP.\n\nI will attach a patch containing these fixes.Created attachment 7441\nProposed patchApplied patch with slight modification:\n\nInstead of (as suggested in the patch):\n\n  private static String unqualify(String path) {\n    File f = new File(path);\n    return f.getName();\n  }\n\nthe impl now does this:\n\n  private static String unqualify(String path) {\n    return path.substring(path.lastIndexOf(File.separator) + 1);\n  }\n\nwhich avoids generation of a File object.\n\n',?,BUG
21206,'Tomcat 5 - Jetspeed JSP Portlets do not display','Tomcat 5',Catalina,grenoml,dev,'Setup:\nRedHat Linux 8.0\nJ2SE 1.4.2-beta\nTomcat 5.0.3\nJetspeed 1.4-b4(release) and 1.4-b5-dev(from CVS)\n\n  Using Tomcat 5.0.3, Jetspeed will not display the contents of any of the JSP\nPortlets just their title bars.  And the only way that I have found to get these\nJSP Portlets to display is to select \'Edit account\' at the top of the Jetspeed\npage and then just cancel on the next page.  Jetspeed JSP Portlets just do not\nwork right with Tomcat 5.0.3.  \n\nthx,\nGerry Reno  BTW, I tried this with Tomcat 4.1.24 and the Jetspeed JSP Portlets work fine\nin that release.\n\nthx,\nGerry Reno\nPlease investigate this, and point out a TC 5 spec violation causing the wrong\nbehavior. I will close the report if a cause of this behavior cannot be\nidentiied, as it could be an application problem.Remy,\n  Yes, I am not discounting the possibility that this could be some type of app\nproblem.  However, the app is working perfectly fine under 4.1.24 and not under\n5.0.3.  I would think that the specs that relate to rendering of JSP content\nwould be the same as the JSP content in question was JSP 1.2 only - nothing was\nJSP 2.0.  Therefore it seems as though one or the other of the containers is not\ncompliant.  The app also appears to work ok under Resin.  I am not a spec expert\nthat could pinpoint exactly this problem.  Perhaps there is someone else more\nfamiliar with the specs and the Tomcat and/or Jetspeed code that could assist here.\n\nthx,\nGerry Reno\nI have tried this on win2k. The war file fails. If you expand the .war to\ndirectory form, then all is OK. \n\nIn .war form --> I get a zip exception. \n\nSo tomcat is OK with respect to running. The unpacking of the war is a different\nstory.\n\nFor thos curious, here is the part of the stack trace that might look important\nin case someone might have an immediate \"a ha!\":\nSEVERE: Exception processing JAR at resource path\nC:\\opt\\data\\src\\TOMCAT5\\jakarta-tomcat-5\\build\\webapps\\jetspeed\\WEB-INF\\lib\\jetspeed-1.4-b4.jar\nin context /jetspeed\njava.util.zip.ZipException: error in opening zip file\n\tat java.util.zip.ZipFile.open(Native Method)\n\tat java.util.zip.ZipFile.<init>(ZipFile.java:112)\n\tat java.util.jar.JarFile.<init>(JarFile.java:117)\n\tat java.util.jar.JarFile.<init>(JarFile.java:82)\n\tat org.apache.catalina.startup.TldConfig.tldScanJar(TldConfig.java:469)\n\tat org.apache.catalina.startup.TldConfig.tldScanJar(TldConfig.java:449)\n\tat org.apache.catalina.startup.TldConfig.execute(TldConfig.java:228)\n\tat org.apache.catalina.core.StandardContext.start(StandardContext.java:4037)\n\tat org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:868)\nTim,\n  All of the war files in all of my tests with 5.0.3 and 4.1.24 were\nfully expanded.  \n  What exactly are you saying?  Are you seeing the exact same problem? \nWhat did you mean when you say \'war file fails\'?   If you meant you\njust got a zip exception are you thinking this is related to JSP\nPortlets not displaying?\n\n????\nGerry Reno  Let me clarify this a little more.  Once you have installed the jetspeed.war\nfile go to the jetspeed home page http://localhost:8080/jetspeed .  Login as\nuser \'turbine\', password \'turbine\'.  Now, all the default portlets you see on\nthe page are Velocity Portlets.  You have to actually add JSP Portlets to the\npages before you can even begin to see the problem.   Click on the \'Edit HTML\'\nlink and select Home then select \'Add Portlet\' and from the list of portlets\nselect some of the JSP types such as JSP HelloWorld or JSP Stock Portfolio (on\nthe next page), save and apply your way out and then you should be able to see\nthe problem.\n\nthx,\nGerry Reno\nI don\'t get the exception on the .war.I can reproduce the behavior, but I don\'t know if it\'s caused by an actual\nTomcat or Jasper bug.\nIf I stop Tomcat and restart it, I can see the portlets. If I then add a new JSP\nportlet, none will get displayed (until I restart Tomcat).\n\nI recommend you debug this a bit more. I am not interested in Jetspeed, so\nunless you can point out some bad lower level behavior, I\'ll eventually close\nthe bug, assuming Jetspeed is doing something wrong at some point.I just tried it (tomcat 5.0.3, JDK 1.4.1_03, Windows 2000, Jetspeed 1.4b4).  \nDropped jetspeed.war in running tomcat webapps directory.  Went to \nhttp://localhost:8080/jetspeed, browsed around, everything was fine.  Edited a \nfew panes, no problems.  Added JSP Portfolio portlet, didn\'t get an error, but \ndidn\'t see anything in the portlet (am I supposed to?).  Logged out of \njetspeed, went to tomcat manager, logged in, reloaded jetspeed webapp.  Tried \nto access http://localhost:8080/jetspeed, got following exception:\nHorrible Exception: java.lang.Error: Error in BasePeer.initTableSchema\n(TURBINE_USER): The database is already in use by another process at \norg.apache.jetspeed.om.security.turbine.BaseTurbineUserPeer.initClass\n(BaseTurbineUserPeer.java:154) at \norg.apache.jetspeed.om.security.turbine.BaseTurbineUserPeer.\n(BaseTurbineUserPeer.java:128) at \norg.apache.jetspeed.services.security.turbine.TurbineUserManagement.getUser\n(TurbineUserManagement.java:166) at \norg.apache.jetspeed.services.JetspeedUserManagement.getUser\n(JetspeedUserManagement.java:97) at \norg.apache.jetspeed.services.security.turbine.TurbineAuthentication.getAnonymous\nUser(TurbineAuthentication.java:212) at \norg.apache.jetspeed.services.JetspeedAuthentication.getAnonymousUser\n(JetspeedAuthentication.java:102) at \norg.apache.jetspeed.services.JetspeedSecurity.getAnonymousUser\n(JetspeedSecurity.java:174) at \norg.apache.jetspeed.modules.actions.TemplateSessionValidator.doPerform\n(TemplateSessionValidator.java:97) at \norg.apache.jetspeed.modules.actions.JetspeedSessionValidator.doPerform\n(JetspeedSessionValidator.java:103) at org.apache.turbine.modules.Action.perform\n(Action.java:87) at org.apache.turbine.modules.ActionLoader.exec\n(ActionLoader.java:122) at org.apache.turbine.Turbine.doGet(Turbine.java:521) \nat javax.servlet.http.HttpServlet.service(HttpServlet.java:743)Following my post above, I restarted the tomcat server (restarting or reloading \nthe jetspeed application was insufficient), and logged back in.  I could see \nthe pane that I added with the same display (i.e. no data) in the JSP stock \nportfolio portlet.  That makes me think it\'s more likely a Jetspeed issue.Yoav,\n  When you didn\'t see anything in the JSP Stock Portfolio portlet that is the\nproblem that needs fixed!!!   I not inclined one way or the other to say whose\nissue this is.  It could be either a Tomcat or a Jetspeed issue at this point. \nThe behavior doesn\'t occur in 4.1.24 or Resin so ????   This other exception\nthat you got by reloading jetspeed I have never seen before (on Linux) and I\nhave reloaded jetspeed several times.\n\nthx,\nGerry Reno\nI have no idea if it\'s indeed a Jetspeed bug. I\'d like to know if it can be\nreproduced using something other than Jetspeed (in which case it could indicate\na buffering or RD bug). At this point, I don\'t feel like digging into Jetspeed\nto get the answer ...  I also opened a Jetspeed Bugzilla Bug 21232 on this issue and cross-referenced\nit to this bug.\n\nthx,\nGerry Reno\nSince the root cause of this can\'t be identified yet, I\'ll have to close the\nreport soon as I can\'t do anything useful with it. Please reopen if you have\nmore information allowing to indentify the root cause of this problem.\n\nI have to add that the JSP is only processed by Jasper once Tomcat is restarted\n(and no dynamic changes have any effect), as the generated source and compiled\nclass for a JSP portlet are only created then. As the logs are empty, I do not\nbelieve Jasper is the cause of this problem.  This is still a problem which completely prevents someone from using Jetspeed\nJSP Portlets and Tomcat 5.  I have not been able to find even a clue as to why\nthis is happening and the logs have been devoid of any information as to the\nsource of this problem.  I\'ve looked at the portal page source and everything\nabout the JSP Portlets is created, title bar, colors, name, except for their JSP\ncontent which shows up as a single blank line.  Jetspeed JSP Portlets run\nperfectly under Tomcat 3 and 4 but for some reason not under 5.  I did open a\nJetspeed bug on the same issue but the Jetspeed team doesn\'t want to do anything\nabout investigating behavior with Tomcat 5 since it is still alpha. I don\'t\nthink any of their developers have even installed TC5 yet.  As far as the state\nfor this bug, I think it should remain open.  The only servlet container that is\nexhibiting any problem with JSP Portlets is Tomcat 5.  Other versions of Tomcat\nand Resin work just fine.  Perhaps some change from the servlet spec has led to\nthe problem.\n\nGerry Reno\n\n\nSome progress: Jasper does get invoked in both scenarios through an include\n(with or without a server restart).\nHowever, in the first case, the processed JSP is:\n/portal/media-type/html/user/turbine/page/default.psml/media-type/html (bad)\nIn the second case, it is: /WEB-INF/templates/jsp/portlets/html/hello.jsp (good)\nI added a Thread.dumpStack in JspServlet.service, and the stack trace is\nidentical, so I don\'t understand how it could come from a RD dispatcher bug\n(which according to the stack trace is the only possible culprit).The bug turned out to be a dumb bug in Jasper (after spending one more hour\ndebugging the RD ...). This will be fixed in 5.0.7 (or in the next nightly;\napplying the patch is trivial if you\'re using the CVS code).\nEasy workaround: After editing, you need to click on the \"home\" link on the\nleft, or access your portal through a URI which doesn\'t have a pathInfo. I\'m\ndowngrading the severity of the bug.Re-opening the bug.\n\nSetup:\nRedHat Linux 8.0\nJ2SE 1.4.2\nTomcat 5.0.7-alpha\nJetspeed 1.4-b4(release) and 1.4-b5-dev(from CVS)\n\n  I downloaded the new version of Tomcat 5.0.7-alpha that included the fix for\nthis bug and began testing it this morning.  There are still problems with the\nJSP Portlet compilation:  Here is the error output from a sample jsp portlet:\n\n Error encountered processing a template:\n/portlets/html/hello.jsporg.apache.jasper.JasperException: Unable to compile\nclass for JSP at\norg.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:561)\nat\norg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:300)\nat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:293) at\norg.apache.jasper.servlet.JspServlet.service(JspServlet.java:240) at\njavax.servlet.http.HttpServlet.service(HttpServlet.java:856) at\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:286)\nat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\nat\norg.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:752)\nat\norg.apache.catalina.core.ApplicationDispatcher.doInclude(ApplicationDispatcher.java:640)\nat\norg.apache.catalina.core.ApplicationDispatcher.include(ApplicationDispatcher.java:552)\nat\norg.apache.turbine.services.jsp.TurbineJspService.handleRequest(TurbineJspService.java:202)\nat\norg.apache.turbine.services.jsp.TurbineJspService.handleRequest(TurbineJspService.java:163)\nat\norg.apache.jetspeed.portal.portlets.viewprocessor.JSPViewProcessor.processView(JSPViewProcessor.java:170)\nat\norg.apache.jetspeed.portal.portlets.GenericMVCPortlet.buildContent(GenericMVCPortlet.java:301)\nat\norg.apache.jetspeed.portal.portlets.GenericMVCPortlet.getContent(GenericMVCPortlet.java:219)\nat\norg.apache.jetspeed.portal.security.portlets.PortletWrapper.getContent(PortletWrapper.java:148)\nat sun.reflect.GeneratedMethodAccessor194.invoke(Unknown Source) at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\nat java.lang.reflect.Method.invoke(Method.java:324) at\norg.apache.velocity.runtime.parser.node.ASTMethod.execute(ASTMethod.java:260) at\norg.apache.velocity.runtime.parser.node.ASTReference.execute(ASTReference.java:207)\nat\norg.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:250)\nat org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94) at\norg.apache.velocity.runtime.parser.node.ASTIfStatement.render(ASTIfStatement.java:109)\nat org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94) at\norg.apache.velocity.runtime.parser.node.ASTIfStatement.render(ASTIfStatement.java:109)\nat\norg.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)\nat org.apache.velocity.Template.merge(Template.java:296) at\norg.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:492) at\norg.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:461) at\norg.apache.turbine.services.velocity.TurbineVelocityService.decodeRequest(TurbineVelocityService.java:494)\nat\norg.apache.turbine.services.velocity.TurbineVelocityService.handleRequest(TurbineVelocityService.java:336)\nat\norg.apache.turbine.services.velocity.TurbineVelocity.handleRequest(TurbineVelocity.java:143)\nat\norg.apache.jetspeed.portal.controls.VelocityPortletControl.getContent(VelocityPortletControl.java:170)\nat sun.reflect.GeneratedMethodAccessor190.invoke(Unknown Source) at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\nat java.lang.reflect.Method.invoke(Method.java:324) at\norg.apache.velocity.runtime.parser.node.ASTMethod.execute(ASTMethod.java:260) at\norg.apache.velocity.runtime.parser.node.ASTReference.execute(ASTReference.java:207)\nat\norg.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:250)\nat org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94) at\norg.apache.velocity.runtime.directive.Foreach.render(Foreach.java:344) at\norg.apache.velocity.runtime.parser.node.ASTDirective.render(ASTDirective.java:153)\nat org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94) at\norg.apache.velocity.runtime.directive.Foreach.render(Foreach.java:344) at\norg.apache.velocity.runtime.parser.node.ASTDirective.render(ASTDirective.java:153)\nat\norg.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)\nat org.apache.velocity.Template.merge(Template.java:296) at\norg.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:492) at\norg.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:461) at\norg.apache.turbine.services.velocity.TurbineVelocityService.decodeRequest(TurbineVelocityService.java:494)\nat\norg.apache.turbine.services.velocity.TurbineVelocityService.handleRequest(TurbineVelocityService.java:336)\nat\norg.apache.turbine.services.velocity.TurbineVelocity.handleRequest(TurbineVelocity.java:143)\nat\norg.apache.jetspeed.portal.controllers.VelocityPortletController.getContent(VelocityPortletController.java:136)\nat org.apache.jetspeed.portal.BasePortletSet.getContent(BasePortletSet.java:379)\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\nat java.lang.reflect.Method.invoke(Method.java:324) at\norg.apache.velocity.runtime.parser.node.ASTMethod.execute(ASTMethod.java:260) at\norg.apache.velocity.runtime.parser.node.ASTReference.execute(ASTReference.java:207)\nat\norg.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:250)\nat\norg.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)\nat org.apache.velocity.Template.merge(Template.java:296) at\norg.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:492) at\norg.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:461) at\norg.apache.turbine.services.velocity.TurbineVelocityService.decodeRequest(TurbineVelocityService.java:494)\nat\norg.apache.turbine.services.velocity.TurbineVelocityService.handleRequest(TurbineVelocityService.java:336)\nat\norg.apache.turbine.services.velocity.TurbineVelocity.handleRequest(TurbineVelocity.java:143)\nat\norg.apache.jetspeed.portal.controllers.VelocityPortletController.getContent(VelocityPortletController.java:136)\nat org.apache.jetspeed.portal.BasePortletSet.getContent(BasePortletSet.java:379)\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\nat java.lang.reflect.Method.invoke(Method.java:324) at\norg.apache.velocity.runtime.parser.node.ASTMethod.execute(ASTMethod.java:260) at\norg.apache.velocity.runtime.parser.node.ASTReference.execute(ASTReference.java:207)\nat\norg.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:250)\nat org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94) at\norg.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)\nat\norg.apache.velocity.runtime.parser.node.ASTIfStatement.render(ASTIfStatement.java:128)\nat org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94) at\norg.apache.velocity.runtime.parser.node.ASTIfStatement.render(ASTIfStatement.java:109)\nat\norg.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)\nat org.apache.velocity.Template.merge(Template.java:296) at\norg.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:492) at\norg.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:461) at\norg.apache.turbine.services.velocity.TurbineVelocityService.decodeRequest(TurbineVelocityService.java:494)\nat\norg.apache.turbine.services.velocity.TurbineVelocityService.handleRequest(TurbineVelocityService.java:336)\nat\norg.apache.turbine.services.velocity.TurbineVelocity.handleRequest(TurbineVelocity.java:143)\nat\norg.apache.jetspeed.portal.controls.VelocityPortletControl.getContent(VelocityPortletControl.java:170)\nat org.apache.jetspeed.util.template.JetspeedTool.getPane(JetspeedTool.java:181)\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39) at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\nat java.lang.reflect.Method.invoke(Method.java:324) at\norg.apache.velocity.runtime.parser.node.ASTMethod.execute(ASTMethod.java:260) at\norg.apache.velocity.runtime.parser.node.ASTReference.execute(ASTReference.java:207)\nat\norg.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:250)\nat org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94) at\norg.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)\nat\norg.apache.velocity.runtime.parser.node.ASTIfStatement.render(ASTIfStatement.java:128)\nat\norg.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)\nat org.apache.velocity.Template.merge(Template.java:296) at\norg.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:492) at\norg.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:461) at\norg.apache.turbine.services.velocity.TurbineVelocityService.decodeRequest(TurbineVelocityService.java:494)\nat\norg.apache.turbine.services.velocity.TurbineVelocityService.handleRequest(TurbineVelocityService.java:336)\nat\norg.apache.turbine.services.velocity.TurbineVelocity.handleRequest(TurbineVelocity.java:143)\nat\norg.apache.turbine.modules.screens.VelocityDirectScreen.buildTemplate(VelocityDirectScreen.java:123)\nat\norg.apache.turbine.modules.screens.TemplateScreen.doBuild(TemplateScreen.java:130)\nat org.apache.turbine.modules.Screen.build(Screen.java:99) at\norg.apache.turbine.modules.ScreenLoader.eval(ScreenLoader.java:129) at\norg.apache.turbine.util.template.TemplateScreen.toString(TemplateScreen.java:126)\nat\norg.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:321)\nat\norg.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)\nat org.apache.velocity.Template.merge(Template.java:296) at\norg.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:492) at\norg.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:461) at\norg.apache.turbine.services.velocity.TurbineVelocityService.decodeRequest(TurbineVelocityService.java:494)\nat\norg.apache.turbine.services.velocity.TurbineVelocityService.handleRequest(TurbineVelocityService.java:336)\nat\norg.apache.turbine.services.velocity.TurbineVelocity.handleRequest(TurbineVelocity.java:143)\nat\norg.apache.turbine.modules.layouts.VelocityDirectLayout.doBuild(VelocityDirectLayout.java:106)\nat org.apache.turbine.modules.Layout.build(Layout.java:91) at\norg.apache.turbine.modules.LayoutLoader.exec(LayoutLoader.java:123) at\norg.apache.turbine.modules.pages.DefaultPage.doBuild(DefaultPage.java:169) at\norg.apache.turbine.modules.Page.build(Page.java:90) at\norg.apache.turbine.modules.PageLoader.exec(PageLoader.java:123) at\norg.apache.turbine.Turbine.doGet(Turbine.java:563) at\njavax.servlet.http.HttpServlet.service(HttpServlet.java:743) at\njavax.servlet.http.HttpServlet.service(HttpServlet.java:856) at\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:286)\nat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\nat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:254)\nat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\nat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\nat\norg.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:256)\nat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:210)\nat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\nat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\nat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:190)\nat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\nat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:175)\nat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\nat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\nat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:156)\nat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\nat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\nat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:974) at\norg.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:207) at\norg.apache.coyote.http11.Http11Processor.process(Http11Processor.java:647) at\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:489)\nat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:575) at\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:649)\nat java.lang.Thread.run(Thread.java:534) JSPViewProcessor: Could not include the\nfollowing JSP Page: [hello.jsp] : Error encountered processing a\ntemplate:/portlets/html/hello.jsp: Unable to compile class for JSP\n\n\n  So we took our portal back over to Tomcat 4.1.24 just to check and all JSP\nPortlets are still working fine there.\n\n  This is only happening for the Jetspeed JSP Portlets.  Everything else in\nJetspeed is working (with the exception of the xml parser which still requires\nloading xalan 2.5.1 jars into common/endorsed)\n\nGerry RenoYou likely have a problem compiling JSPs. This works for me. Please don\'t reopen\nthe bug, unless you can make a more convincing argument there\'s a Tomcat flaw.Remy,\n\n  Ok, I\'m sure I would have noticed if my normal JSP weren\'t compiling but just\nto be sure about whether JSPs would compile, I just now went through and clicked\non all the JSP examples provided with Tomcat 5.0.7 and every one of them is\nworking just fine. Granted they\'re not too complicated but I\'m not seeing any\nproblem at all compiling JSPs so far with 5.0.7.  I went and dropped the\noriginal jetspeed.war into webapps and then added a JSP Portlet and received the\nsame error as I reported above.  This time I noticed another exception in the\nlog that may help:\n\nINFO: Server startup in 20610 ms\njava.lang.IllegalArgumentException: -82\n\tat\norg.apache.jasper.compiler.SmapStratum$LineInfo.setOutputLineIncrement(SmapStratum.java:124)\n\tat org.apache.jasper.compiler.SmapStratum.optimizeLineSection(SmapStratum.java:221)\n\tat org.apache.jasper.compiler.SmapUtil.evaluateNodes(SmapUtil.java:490)\n\tat org.apache.jasper.compiler.SmapUtil.generateSmap(SmapUtil.java:123)\n\tat org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:301)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:453)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:439)\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:555)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:300)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:293)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:286)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n\tat\norg.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:752)\n\tat\norg.apache.catalina.core.ApplicationDispatcher.doInclude(ApplicationDispatcher.java:640)\n\tat\norg.apache.catalina.core.ApplicationDispatcher.include(ApplicationDispatcher.java:552)\n\tat\norg.apache.turbine.services.jsp.TurbineJspService.handleRequest(TurbineJspService.java:202)\n\tat\norg.apache.turbine.services.jsp.TurbineJspService.handleRequest(TurbineJspService.java:163)\n\tat\norg.apache.jetspeed.portal.portlets.viewprocessor.JSPViewProcessor.processView(JSPViewProcessor.java:170)\n\tat\norg.apache.jetspeed.portal.portlets.GenericMVCPortlet.buildContent(GenericMVCPortlet.java:301)\n\tat\norg.apache.jetspeed.portal.portlets.GenericMVCPortlet.getContent(GenericMVCPortlet.java:219)\n\tat\norg.apache.jetspeed.portal.security.portlets.PortletWrapper.getContent(PortletWrapper.java:148)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.apache.velocity.runtime.parser.node.ASTMethod.execute(ASTMethod.java:260)\n\tat\norg.apache.velocity.runtime.parser.node.ASTReference.execute(ASTReference.java:207)\n\tat\norg.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:250)\n\tat org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94)\n\tat\norg.apache.velocity.runtime.parser.node.ASTIfStatement.render(ASTIfStatement.java:109)\n\tat org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94)\n\tat\norg.apache.velocity.runtime.parser.node.ASTIfStatement.render(ASTIfStatement.java:109)\n\tat org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)\n\tat org.apache.velocity.Template.merge(Template.java:296)\n\tat org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:492)\n\tat org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:461)\n\tat\norg.apache.turbine.services.velocity.TurbineVelocityService.decodeRequest(TurbineVelocityService.java:494)\n\tat\norg.apache.turbine.services.velocity.TurbineVelocityService.handleRequest(TurbineVelocityService.java:336)\n\tat\norg.apache.turbine.services.velocity.TurbineVelocity.handleRequest(TurbineVelocity.java:143)\n\tat\norg.apache.jetspeed.portal.controls.VelocityPortletControl.getContent(VelocityPortletControl.java:170)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.apache.velocity.runtime.parser.node.ASTMethod.execute(ASTMethod.java:260)\n\tat\norg.apache.velocity.runtime.parser.node.ASTReference.execute(ASTReference.java:207)\n\tat\norg.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:250)\n\tat org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94)\n\tat org.apache.velocity.runtime.directive.Foreach.render(Foreach.java:344)\n\tat\norg.apache.velocity.runtime.parser.node.ASTDirective.render(ASTDirective.java:153)\n\tat org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94)\n\tat org.apache.velocity.runtime.directive.Foreach.render(Foreach.java:344)\n\tat\norg.apache.velocity.runtime.parser.node.ASTDirective.render(ASTDirective.java:153)\n\tat org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)\n\tat org.apache.velocity.Template.merge(Template.java:296)\n\tat org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:492)\n\tat org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:461)\n\tat\norg.apache.turbine.services.velocity.TurbineVelocityService.decodeRequest(TurbineVelocityService.java:494)\n\tat\norg.apache.turbine.services.velocity.TurbineVelocityService.handleRequest(TurbineVelocityService.java:336)\n\tat\norg.apache.turbine.services.velocity.TurbineVelocity.handleRequest(TurbineVelocity.java:143)\n\tat\norg.apache.jetspeed.portal.controllers.VelocityPortletController.getContent(VelocityPortletController.java:136)\n\tat org.apache.jetspeed.portal.BasePortletSet.getContent(BasePortletSet.java:379)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.apache.velocity.runtime.parser.node.ASTMethod.execute(ASTMethod.java:260)\n\tat\norg.apache.velocity.runtime.parser.node.ASTReference.execute(ASTReference.java:207)\n\tat\norg.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:250)\n\tat org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)\n\tat org.apache.velocity.Template.merge(Template.java:296)\n\tat org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:492)\n\tat org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:461)\n\tat\norg.apache.turbine.services.velocity.TurbineVelocityService.decodeRequest(TurbineVelocityService.java:494)\n\tat\norg.apache.turbine.services.velocity.TurbineVelocityService.handleRequest(TurbineVelocityService.java:336)\n\tat\norg.apache.turbine.services.velocity.TurbineVelocity.handleRequest(TurbineVelocity.java:143)\n\tat\norg.apache.jetspeed.portal.controllers.VelocityPortletController.getContent(VelocityPortletController.java:136)\n\tat org.apache.jetspeed.portal.BasePortletSet.getContent(BasePortletSet.java:379)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.apache.velocity.runtime.parser.node.ASTMethod.execute(ASTMethod.java:260)\n\tat\norg.apache.velocity.runtime.parser.node.ASTReference.execute(ASTReference.java:207)\n\tat\norg.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:250)\n\tat org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94)\n\tat org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)\n\tat\norg.apache.velocity.runtime.parser.node.ASTIfStatement.render(ASTIfStatement.java:128)\n\tat org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94)\n\tat\norg.apache.velocity.runtime.parser.node.ASTIfStatement.render(ASTIfStatement.java:109)\n\tat org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)\n\tat org.apache.velocity.Template.merge(Template.java:296)\n\tat org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:492)\n\tat org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:461)\n\tat\norg.apache.turbine.services.velocity.TurbineVelocityService.decodeRequest(TurbineVelocityService.java:494)\n\tat\norg.apache.turbine.services.velocity.TurbineVelocityService.handleRequest(TurbineVelocityService.java:336)\n\tat\norg.apache.turbine.services.velocity.TurbineVelocity.handleRequest(TurbineVelocity.java:143)\n\tat\norg.apache.jetspeed.portal.controls.VelocityPortletControl.getContent(VelocityPortletControl.java:170)\n\tat org.apache.jetspeed.util.template.JetspeedTool.getPane(JetspeedTool.java:181)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.apache.velocity.runtime.parser.node.ASTMethod.execute(ASTMethod.java:260)\n\tat\norg.apache.velocity.runtime.parser.node.ASTReference.execute(ASTReference.java:207)\n\tat\norg.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:250)\n\tat org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:94)\n\tat org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)\n\tat\norg.apache.velocity.runtime.parser.node.ASTIfStatement.render(ASTIfStatement.java:128)\n\tat org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)\n\tat org.apache.velocity.Template.merge(Template.java:296)\n\tat org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:492)\n\tat org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:461)\n\tat\norg.apache.turbine.services.velocity.TurbineVelocityService.decodeRequest(TurbineVelocityService.java:494)\n\tat\norg.apache.turbine.services.velocity.TurbineVelocityService.handleRequest(TurbineVelocityService.java:336)\n\tat\norg.apache.turbine.services.velocity.TurbineVelocity.handleRequest(TurbineVelocity.java:143)\n\tat\norg.apache.turbine.modules.screens.VelocityDirectScreen.buildTemplate(VelocityDirectScreen.java:123)\n\tat\norg.apache.turbine.modules.screens.TemplateScreen.doBuild(TemplateScreen.java:130)\n\tat org.apache.turbine.modules.Screen.build(Screen.java:99)\n\tat org.apache.turbine.modules.ScreenLoader.eval(ScreenLoader.java:129)\n\tat\norg.apache.turbine.util.template.TemplateScreen.toString(TemplateScreen.java:126)\n\tat\norg.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:321)\n\tat org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:271)\n\tat org.apache.velocity.Template.merge(Template.java:296)\n\tat org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:492)\n\tat org.apache.velocity.app.Velocity.mergeTemplate(Velocity.java:461)\n\tat\norg.apache.turbine.services.velocity.TurbineVelocityService.decodeRequest(TurbineVelocityService.java:494)\n\tat\norg.apache.turbine.services.velocity.TurbineVelocityService.handleRequest(TurbineVelocityService.java:336)\n\tat\norg.apache.turbine.services.velocity.TurbineVelocity.handleRequest(TurbineVelocity.java:143)\n\tat\norg.apache.turbine.modules.layouts.VelocityDirectLayout.doBuild(VelocityDirectLayout.java:106)\n\tat org.apache.turbine.modules.Layout.build(Layout.java:91)\n\tat org.apache.turbine.modules.LayoutLoader.exec(LayoutLoader.java:123)\n\tat org.apache.turbine.modules.pages.DefaultPage.doBuild(DefaultPage.java:169)\n\tat org.apache.turbine.modules.Page.build(Page.java:90)\n\tat org.apache.turbine.modules.PageLoader.exec(PageLoader.java:123)\n\tat org.apache.turbine.Turbine.doGet(Turbine.java:563)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:743)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:286)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:254)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\n\tat\norg.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:256)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:210)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:190)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:175)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\n\tat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:156)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:974)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:207)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:647)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:489)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:575)\n\tat\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:649)\n\tat java.lang.Thread.run(Thread.java:534)\n\n\n  This particular exception in catalina.out that shows up when I access a\nJetspeed pane containing a JSP Portlet.  This is with using Tomcat as-is, right\nout of the jakarta-tomcat-5.0.7.tar.gz distribution and Jetspeed 1.4b4 as-is. \nHope this will help shed some light on the issue.\n\nthx,\nGerry Reno\n\nIllegalArgumentException in setOutputLineIncrement() is Bugzilla Bug 22277, \nand is fixed in CVS.',?,BUG
21279,'Proc Runner: No Listener Notification on Shutdown','Tomcat 5',Native:Packaging,marc.lehmann,dev,'The sample listener (provided with servlet-examples and jsp-examples) are not \nnotified on shutdown if TC has been started via proc runner. Starting and \nstopping via startup.bat and shutdown.bat works as expected.Ok, I can reproduce that. I find it odd that the shutdown hook of the VM isn\'t\ngetting invoked. Maybe the process is abruptly killed at some point.\n\nThere are alternative ways to start Tomcat if you need a workaround for now\n(including the Java launcher from the Commons, and the plain old .bat scripts).\nI hope you like the new .exe wrapper (assuming the bugs are fixed, of course).Proc runner now comes with the Java Option -Xrs preconfigured (as of TC 5.0.3). \nHowever, leaving the option out doesn\'t make a difference.\n\nI do like the new .exe wrapper. It\'s a very handy tool. Some more observation - hope it helps to pin down the problem:\nIf I start TC via proc runner and stop TC via shutdown.bat the method \ncontextDestroyed() is properly called.\n\nWindows Task-Manager:\nStopping TC via proc runner gives a peak CPU utilization of approx. 6\%, the \nextra CPU utilization lasts for approx. 5 seconds.\nStopping TC via shutdown.bat gives a peak CPU utilization of 100\%, the extra \nCPU utilization lasts from 15 to 35 seconds.I have added some logging to org.apache.catalina.startup.Bootstrap: main() is \nnever reached on shutdown via procrun. Looks like procrun just kills the JVM. \nWhat strikes me here is that no shutdown hook gets activated. If I shutdown TC \nvia telnet (port 8005) SessionListener and ContextListener are properly \nnotified. I have no tools available to actually look what procrun does on \nshutdown. Any help is much appreciated.Fixed now in the CVS, and should appear in 5.0.7.',?,BUG
21341,'Error page mechanism not working','Tomcat 5',Catalina,kevinj,dev,'I have an error-page entry in my web.xml file like this\n\n    <error-page>\n       \n<exception-type>com.develop.ejweb.lab.exception.BlogException</exception-type>\n        <location>/WEB-INF/error.jsp</location>\n    </error-page>\n\n\nIf I throw a BlogException the page does not get displayed\n\nThe exact same code works fine under Tomcat 4.1Created attachment 7325\nFix for defect 21341Details of above attached fix:\nThe call to processRequest in ApplicationDispatcher::doForward is replaced with \nthe body of processRequest with reversed check, so that in normal case invoke\n(outerRequest, response) gets called instead of invoke(request, response).\n\nNeed some inputs on the impact if this fix is made *inside* the \nApplicationDispatcher::processRequest method.\n\n--- src\\share\\org\\apache\\catalina\\core\\ApplicationDispatcher.java\n+++ modified\\src\\share\\org\\apache\\catalina\\core\\ApplicationDispatcher.java\n@@ -509\n           ApplicationFilterFactory.DISPATCHER_TYPE_ATTR);\n-if (disInt.intValue() != ApplicationFilterFactory.ERROR) {\n\n+if (disInt.intValue() == ApplicationFilterFactory.ERROR) {\n\nObservation: When status code 500 (Internal Serve Error) is returned, IE does \nnot show the error-page if the message in the page is less than some number (in \nmy case approx 500) of characters. This problem does not occur if Netscape is \nused. Looks like a client side problem.Created attachment 7326\nRe-submitting the same patch in unified diff format...Your patch is likely bad. The problem is likely the same that was causing FORM\nauth to cause problems when using a forward (instead of a redirect): because the\nrequest dispatcher was invoked from outside of the filter pipeline, its state\nwas incorrect.This is now fixed, and will be in 5.0.5.',?,BUG
21419,'error on startup - java.lang.NoSuchMethodException: org.apache.catalina.core.StandardHost.getHost()','Tomcat 5',Catalina,hoju,dev,'Using the latest CVS build from today (2003/07/08), starting Tomcat5 using\n\"catalina.bat run\" (under Win2k) and using a custom CATALINA_BASE results in the\nfollowing error on startup.  This worked just fine with Tomcat-5.0.3....\n\n\nD:\\myclasses\\Repository\\Enhydra\\XMLC_DSF_2003-05-19-2\\xmlc\\examples\\tomcat>run-tomcat\nUsing CATALINA_BASE:  \nD:\\myclasses\\Repository\\Enhydra\\XMLC_DSF_2003-05-19-2\\xmlc\\examples\\tomcat\\build\nUsing CATALINA_HOME:   C:\\Java\\Apache\\Jakarta\\tomcat-5-20030708\nUsing CATALINA_TMPDIR:\nD:\\myclasses\\Repository\\Enhydra\\XMLC_DSF_2003-05-19-2\\xmlc\\examples\\tomcat\\build\\temp\nUsing JAVA_HOME:       C:\\j2sdk1.4.1_02\nlog4j:WARN No appenders could be found for logger\n(org.apache.catalina.startup.Embedded).\nlog4j:WARN Please initialize the log4j system properly.\nCatalina.start: java.lang.NoSuchMethodException:\norg.apache.catalina.core.StandardHost.getHost()\njava.lang.NoSuchMethodException: org.apache.catalina.core.StandardHost.getHost()\n        at\norg.apache.commons.digester.Digester.createSAXException(Digester.java:2540)\n        at\norg.apache.commons.digester.Digester.createSAXException(Digester.java:2566)\n        at org.apache.commons.digester.Digester.startElement(Digester.java:1276)\n        at org.apache.xerces.parsers.AbstractSAXParser.startElement(Unknown Source)\n        at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanStartElement(Unknown\nSource)\n        at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(Unknown\nSource)\n        at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source)\n        at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n        at org.apache.xerces.parsers.DTDConfiguration.parse(Unknown Source)\n        at org.apache.xerces.parsers.XMLParser.parse(Unknown Source)\n        at org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)\n        at org.apache.commons.digester.Digester.parse(Digester.java:1548)\n        at org.apache.catalina.startup.Catalina.load(Catalina.java:511)\n        at org.apache.catalina.startup.Catalina.load(Catalina.java:549)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.load(Bootstrap.java:260)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:393)\nCatalina.start: java.lang.NoSuchMethodException:\norg.apache.catalina.core.StandardHost.getHost()\njava.lang.NoSuchMethodException: org.apache.catalina.core.StandardHost.getHost()\n        at\norg.apache.commons.digester.Digester.createSAXException(Digester.java:2540)\n        at\norg.apache.commons.digester.Digester.createSAXException(Digester.java:2566)\n        at org.apache.commons.digester.Digester.startElement(Digester.java:1276)\n        at org.apache.xerces.parsers.AbstractSAXParser.startElement(Unknown Source)\n        at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanStartElement(Unknown\nSource)\n        at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(Unknown\nSource)\n        at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source)\n        at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n        at org.apache.xerces.parsers.DTDConfiguration.parse(Unknown Source)\n        at org.apache.xerces.parsers.XMLParser.parse(Unknown Source)\n        at org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)\n        at org.apache.commons.digester.Digester.parse(Digester.java:1548)\n        at org.apache.catalina.startup.Catalina.load(Catalina.java:511)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:569)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)\njava.lang.reflect.InvocationTargetException\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)\nCaused by: java.lang.NullPointerException\n        at org.apache.catalina.startup.Catalina.await(Catalina.java:633)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:595)\n        ... 6 more\n\n\nAfter this, Tomcat just exists the JVM.  What changed between Tomcat-5.0.3 and\nthe current CVS to cause this error?\n\nJakeJacob, if you could try to substantiate your reports, that would be great. This\ndoesn\'t help anyone.\nAFAIK, there has never been any getHost method inside StandardHost, and there\nhasn\'t been any change between the StdHost from 5.0.3 and the StdHost from CVS\nHEAD. I would appreciate if you could debug a bit your setup, which most of the\ntime is not exactly clean.Hi Remy,\n\nI don\'t have the slightest clue of where to look in Tomcat.  Here is what I know\n(and thought was clear in the initial report)...\n\n1.  The problem didn\'t happen when using any previous version of Tomcat.  That\nis, everything works just fine from version 5.0.3 all the way back to all recent\nversions of 4.1.xx.\n\n2.  The only thing that changed was pointing CATALINA_HOME to the latest version\nof Tomcat built from CVS rather than some other version of Tomcat.  Really,\ntruly, not one other thing is different.  Not a single change was made to the\napplication; only the value of CATALINA_HOME in the batch script is different.\n\nGiven these premises, the conclusion follows that the problem is not my app, but\nsomething in Tomcat. If that conclusion is just way out of line, please describe\nyour reasoning.\n\nI\'m not saying that the issue is necessarily StandardHost.  What I\'m saying is,\nthat is what the stack trace says.  There is also a NullPointerException further\ndown the stack trace.  There\'s a lot of runtime reflection going on there and\nwhat is being reported is probably obscuring the real issue.  What I was hoping\nwas that the stack trace would be more clear to you than to me and that it would\nprovide a clue to the real source of the issue.\n\nFor your information, here is what the \"run-tomcat\" batch script looks like...\n\n@echo off\nset CATALINA_HOME=C:\\Java\\Apache\\Jakarta\\tomcat-5-20030708\nset\nCATALINA_BASE=D:\\myclasses\\Repository\\Enhydra\\XMLC_DSF_2003-05-19-2\\xmlc\\examples\\tomcat\\build\n\nrem remove the log files\ndel /Q \%CATALINA_BASE\%\\logs\\*\n\n\%CATALINA_HOME\%\\bin\\catalina.bat run\n\n\nPretty simple stuff.  Again, the only difference between when things work and\nwhen things don\'t is the value of CATALINA_HOME above.  Specifically, if I\nchange it to \"C:\\Java\\Apache\\Jakarta\\tomcat-5.0.3\", then Tomcat starts up just fine.\n\nYour criticism of my bug reports notwithstanding, most all of my bug reports\nhave lead to important modifications allowing Tomcat to work properly where it\nmay not have if not for my report because you wouldn\'t be aware of the issue if\nnot for the report.  So, I\'ll try to improve the reports but remember, I\'m an\ninterested Tomcat user, but not a Tomcat developer.  Please keep expectations in\nline with that fact.\n\nLet me know if you require any other specific types of information to make it\neasier to fix this issue.  I can provide instructions on reproducing the\nproblem, but that would require you to grab the latest source of XMLC.  I\'m not\nsure if you are willing to do that or not.  If so, let me know and I\'ll provide\nstep-by-step instructions.\n\nJakeIf something really bad happens during init (which doesn\'t happen in practice),\nthen the server instance is null, and you should get a NPE.\nThere\'s of course no call to any getHost( method (do a grep if you don\'t believe\nme) anywhere in the source - and there never was one -, except on the request\nmethod.\nDon\'t worry, if this bug is real, it seems obvious enough, and other people will\nreport it.\n\nCan\'t you really fix that kind of thing ?\nlog4j:WARN No appenders could be found for logger\n(org.apache.catalina.startup.Embedded).\nlog4j:WARN Please initialize the log4j system properly.Same problem, here is a small patch from me.\n\nWORKS FOR ME\n\nIndex: SetDocBaseRule.java\n===================================================================\nRCS file: /home/cvspublic/jakarta-tomcat-\ncatalina/catalina/src/share/org/apache/catalina/startup/SetDocBaseRule.java,v\nretrieving revision 1.1\ndiff -u -w -b -r1.1 SetDocBaseRule.java\n--- SetDocBaseRule.java 24 Jun 2003 22:37:05 -0000      1.1\n+++ SetDocBaseRule.java 9 Jul 2003 11:24:21 -0000\n@@ -118,8 +118,13 @@\n\n         Context child = (Context) digester.peek(0);\n         Deployer parent = (Deployer) digester.peek(1);\n+        Host host = null;\n+        if (!( parent instanceof StandardHost ))  {\n         Method method = parent.getClass().getMethod(\"getHost\", null);\n-        Host host = (Host) method.invoke(parent, null);\n+          host = (Host) method.invoke(parent, null);\n+        } else\n+          host = (Host)parent;\n+\n         String appBase = host.getAppBase();\n\n         if (!(host instanceof StandardHost)) {\nSounds convincing enough to me ;-) It seems you made a mistake trying to reopen\nthe bug.\nThis doesn\'t happen in normal mode for me however. how do you reproduce it ?\n\nAbout the patch: Maybe it could be cleaner, I\'ll see what I can do. The addition\nof a method somewhere could be needed.\nSorry, can\'t reproduce it in the quick. Seen this exception on my 2 development machines and on my dev-server,after patching SetDocBaseRule to check if its get a StandardHost or other thing, it\'s work for me. My Setup,dev-server: 1 host + 3 aliases, standalone tomcatdev-machines: 1 host, localhost onlyI\'m glad someone else is seeing this.  I tried reproducing it by just running\n\"$CATALINA_HOME/bin/catalina.bat run\", but I didn\'t see the error occur there.\n\nHere is how you can reproduce it for yourself:\n\n1.  Grab the latest XMLC CVS.  See instructions here:\nhttp://forge.objectweb.org/cvs/?group_id=49\n\n2.  cd to the root of the build and follow short instructions in the \"README\". \nXMLC should now be built.\n\n3.  cd to $XMLC_ROOT/examples/tomcat.  Copy \"build.properties.examples\" to\n\"build.properties\" and modify the path to \"tomcat.home\".  Now run \"ant\".  This\nwill build the examples and set up an environment for a custom CATALINA_BASE and\nuse the value you defined for tomcat.home for CATALINA_HOME.  Convenience\nscripts \"run-tomcat.bat\" and \"run-tomcat.sh\" will be generated for you.\n\n4.  run the appropriate script for your platform.  I run \"run-tomcat.bat\" on my\nwin2k platform.  You should now witness the stack trace that I reported if you\nare using the latest Tomcat5 CVS.  To test with another version of tomcat,\nmodify the tomcat.home property in build.properties to, say..., tomcat-5.0.3 and\nre-run \"ant\".  The scripts will be re-generated for you pointing to the\nappropriate CATALINA_HOME.  You should not witness the stack trace using\ntomcat-5.0.3.\n\n5.  If you care to view the application running under this custom CATALINA_BASE,\npoint your browser to:\nhttp://localhost:8081/xmlc/\n\nHopefully those instructions are clear enough.  Let me know if you have\ndifficulties.\n\n\nBTW, regarding your comments...\n\n>Can\'t you really fix that kind of thing ?\n>log4j:WARN No appenders could be found for logger\n>(org.apache.catalina.startup.Embedded).\n>log4j:WARN Please initialize the log4j system properly.\n\nThat started happening in recent Tomcat5 builds.  It doesn\'t occur when using\nTomcat-4.1.xx and actually didn\'t occur in early builds of Tomcat5 (sorry, not\nsure when exactly it started).  I suspect the reason it is happening has more to\ndo with commons-logging than Log4j.  I put log4j-1.2.8.jar in\nCATALINA_HOME/common/lib as a standard practice.  Since commons-logging sees\nLog4j in its classpath, it uses it.  The app in question actually uses no\nlogging whatsoever so this message is coming from something in Tomcat itself (or\nits 3rd party libraries) and not the example application.  If you are asking me\nto  track down the issue in commons-logging, you are barking up the wrong tree.\n I have nothing to do with commons-logging and, personally, I feel it has caused\nway more pain and suffering than it is worth.  The class loading tricks it uses\nto proxy other logging api\'s fails in lots of situations and is incredibly hard\nto debug.  If it were up to me, I\'d drop commons-logging like a bad habit and\njust use Log4j directly.  I know that won\'t happen, though, so I\'m not going to\npress the issue.  I can make Log4j work just fine for me in apps using Log4j\ndirectly so the Log4j warning message in question is pretty innocuous to me. \nI\'m not sure if the interaction is adversly affecting Tomcat5 logging when\ncommons-logging finds Log4j in its classpath or not?  As such, I\'m not very\nworried about it.  If you want to report a bug I\'m all for it, but the only\npeople who will be able to fix it are either Tomcat guys like yourself or\ncommons-logging guys.  I don\'t think many people at Log4j will have much\ninterest or be able to help in any way other than maybe Yoav Shapira who has\nmore hands-on experience with commons-logging as well as being a Log4j developer.\n\nJake\n\nOk, I reproduced it. You only need to have a Context element defined in server.xml.\nSo since this is not the preferred way in TC 5, I forgot to test it. Torsten\'s\npatch is correct, and I\'ll apply it. Thanks for the patch.\n\nJacob: Thanks for reporting the issue. About the log4j problem: I did change\nthings in the webapp classloader, but not in the main common classloader.',?,BUG
21553,'Host aliases are not mapped correctly','Tomcat 5',Catalina,grenoml,dev,'Using the following server.xml declaration:\n\n<Host \nclassName=\"org.apache.catalina.core.StandardHost\"\nappBase=\"vhosts/webapps/community-2.com\" \nautoDeploy=\"true\" \nbackgroundProcessorDelay=\"-1\"\nconfigClass=\"org.apache.catalina.startup.ContextConfig\"\ncontextClass=\"org.apache.catalina.core.StandardContext\" \ndebug=\"0\" \ndeployOnStartup=\"true\" \ndeployXML=\"true\" \ndomain=\"Catalina\"\nerrorReportValveClass=\"org.apache.catalina.valves.ErrorReportValve\"\nliveDeploy=\"true\" \nname=\"www.community-2.com\" \nunpackWARs=\"true\" \nxmlNamespaceAware=\"false\" \nxmlValidation=\"false\">\n  <Alias>community-2.com</Alias>\n  <Context path=\"/admin\"  \n   docBase=\"/usr/local/jakarta-tomcat/server/webapps/admin\" \n   debug=\"0\" privileged=\"true\" />\n  <Context path=\"/manager\" \n   docBase=\"/usr/local/jakarta-tomcat/server/webapps/manager\" \n   debug=\"0\" privileged=\"true\" />\n</Host>\n\nIf the /manager context is accessed as http://community-2.com/manager/html it\nresults in listing the webapps for http://localhost:8080/manager/html which is\nthe default Host.  It should be showing the webapps for the Host which contains\nthe alias.\n\nGerry RenoI think you should look into issues more before filing bugs. The problem here\nwas that alias mapping  was not implemented in the new mapper. The issue has\nnothing to do with the manager webapp.\nThis has now been implemented, and will be in 5.0.4.Remy,\n  Do you expect that everyone knows that alias mapping was not implemented?  I\nwas just reporting behavior that seemed abnormal.  I hope you don\'t expect\neveryone to sift through the HEAD and every possible discussion on dev where its\noften not even clear exactly what things are being implemented.  I did some\nsearches on the lists for alias and manager and got lots of hits.  I read\nthrough a reasonable number of these without locating any resolution so I opened\na bug.  Please excuse.\n\nGerry Reno\n\n\nWhy not file the bug as \"Host aliases are not mapped correctly\" ? It should have\nbeen clear for you too that the bug has nothing to do with the manager. Of\ncourse, the issue here is very simple, so it\'s not a big issue.Remy,\n  Agreed, this bug is about alias mapping.  The manager was just being used to\nillustrate the alias problem.  I\'ll change the summary title if the bug will\nallow it.\n\nGerry Reno\n',?,BUG
21600,'\'s lost after manager stop/start or reload','Tomcat 5',Catalina,hoju,dev,'I believe this was true with Tomcat-4.1.xx, but I\'m posting this as a 5.x.x bug\nsince I doubt the behavior will be changed for 4.x.xx...\n\nIf one sets <Parameter> elements in a context configuration file (ccf), they\nwill be read upon webapp startup, but as soon as one stops/starts or reloads the\nwebapp via the Tomcat manager app, the prevously configured <Parameter>\'s are\nnot taken into account.\n\nFor example, I have the following in my ccf...\n\n<Parameter name=\"log4j-log-home\" value=\"C:\\\" override=\"true\"/>\n<Parameter name=\"log4j-sysprop-name\" value=\"MyWebapp.log.home\" override=\"true\"/>\n\nUpon first startup, my webapp obtains this configuration information and reports...\n\nSetting system property [ MyWebapp.log.home ] to [ C:\\ ]\n\n\nwhen I reload the webapp via the Tomcat manager app, I get the following...\n\nNo System property name provided. Please set the \"log4j-sysprop-name\" context\nparameter.\n\n\nI imagine this issue also applies to setting <Environment> and other elements\nsupported by ccf\'s as well.\n\nIs this expected behavior?  I can\'t imagine it is.  I sure didn\'t expect it and\nit makes it difficult to configure webapps and trust that they will continue to\nstay configured througout the entirety of their deployment whether they are\nreloaded or not.\n\nJakeNo, you shouldn\'t assume anything, the JNDI resource are handled fine. The\nContextConfig was resetting the application parameters, which was wrong.Hi Remy,\n\nWas the fix done for just Tomcat-5 or was it also applied to the Tomcat-4.1.xx\ncodebase?  Just wondering if I can expect future versions of Tomcat-4.1.xx to\nwork properly.\n\nthanks,\n\nJakeThe fix is currently only in Tomcat 5.\nNote: I didn\'t actually test the fix (but the flaw in the code was evident, and\nsimilar to previous flaws in JNDI resources handling).\n\nIf you\'d like to experiment with Tomcat development, now would be the right time\nto get the sources and test the fix :)I tested the fix.  It seems to work great!  I\'d suggest that this fix also be\nadded to the next release of Tomcat-4.1.xx since people will be using that as\nthe stable release of Tomcat for quite a while...especially while Tomcat-5 is\nstill in alpha state (pre-servlet 2.4 release).\n\nJake',?,BUG
21731,'Found some bugs at tester (FIX with patch)','Tomcat 5',Tester,pr,dev,'I found some bugs at tester modul at current tomcat 5 cvs 19.07.2003 state.\n\nTwo are not found:\n\nInclude Bug with RequestDesipatcher\nTesterClient based on HttpUrlConnection can\'t read input with Status 500 \nResponse.\n    Check with HttpClient 2.0.0 and it works in a simple env.\n\nS. Dteail Patch and Report (attached)Created attachment 7391\nPatch to fix some Bugs at testerCreated attachment 7392\nBugReportCreated attachment 7393\nSimple Example with HttpClient to access and simulate HttpUrlConnection failureCreated attachment 7394\ntester build.properties for tomcat5Created attachment 7395\ntester/bin/build.properties (example)Ok, thanks, that\'s useful.\n\nThere are mistakes in the patch: the failures in the lifecycle test are real\n(but very minor) failures. I believe the JMX registration doesn\'t happen if the\ninit of a servlet fails, and so the new mapper (which uses JMX to update itself)\ndoesn\'t map the request to the servlet, which gives the 404.\nAbout the include failure: it fails because of the invoker servlet.I\'m in the process of applying your patches. Feel free to contribute more to the\ntester: switch to HttpClient, new tests, etc.\n\nNote: There\'s a socket mode in the current tester to fix the failures with 500\nand error pages (use the protocol attribute of the tester task).I start to evaluate anteater with success! I now start to look deeper inside \nTestClient to migrate or getting it working.\n\nOK: I start working at the Tester Module.\n     Anteater can produce a XML Report and better Status mail\n     I want start to have a active TestSuite with CruiseControl.\n\n---\n\nAnalyse Lifecycle again and I see this at \n\n org.apache.catalina.core.StandardWrapperFacade\n  L.195\n            } else if (available == Long.MAX_VALUE) {\n                hres.sendError(HttpServletResponse.SC_NOT_FOUND,\n                           sm.getString(\"standardWrapper.notFound\",\n                                        wrapper.getName()));\nHups! It look like that all permanent Unavailable Servlets send Status 404 !\n\nI\'m not in favor of using yet another external tool for the tester, as it\ncurrently doesn\'t justify it in terms of size or complexity (in socket mode, it\nworks ok). Now if you plan to contribute a lot to it to expand it, then it\'s\ndifferent (as lon as the tool has an appropriate license).\n\nAs for the unavailable, I think the 404 is right if it\'s permanent. It seems\nlogical. I\'ll have to check, but I remember there was a subtelty like that\nintroduced.Let us write more tests and than we look around to other tools.\n\nCan I help you to wrote more tests ?Yes, sure. That kind of work could get you a committer account very fast :)\n\nI fixed the remaining failures (except one, which is JSP related), so I\'m\nclosing this bug.',?,BUG
21753,'Custom tags within multiline comments generate compile error','Tomcat 5',Jasper,ecarmich,dev,'Jasper generates incorrect Java code when compiling a JSP page which contains \na custom tag inside a multiline comment, such as the following:\n\n<\%@ taglib uri=\"/test\" prefix=\"test\" \%>\n\nHello World\n<\%\n/*\n\%>\n\n<test:test/>\n\n<\%\n*/\n\%>\n\nThis is the error message return by the Java compiler:\n\nGenerated servlet error:\n    [javac] Compiling 1 source file\n\nC:\\jakarta-tomcat-5\n\\build\\work\\Catalina\\localhost\\webapp\\org\\apache\\jsp\\test_jsp.java:76: illegal \nstart of expression\n*/\n^\n\nThe problem is that generateCustomStartTag and generateCustomDoTag insert \nmultiline comments of their own.  The Java compiler interprets the \"*/\" at the \nend of the inserted multiline comment as the end of the multiline comment from \nthe JSP page, and returns an error when it finds the closing \"*/\" from the JSP \npage.\n\nI will attach a patch that fixes this.Created attachment 7411\nProposed patchNow fixed in the CVS HEAD.',?,BUG
21822,'Placing a Valve inside a Context gives Null Pointer Exception...','Tomcat 5',Catalina,banil,dev,'This was working in Tomcat 4.1.18, but is not working in 5.0.3 and 5.0.4\n\nPlacing a Valve inside the Context for admin.xml as follows:\n-------------------------------------------------------------------\n<Context path=\"/admin\" docBase=\"../server/webapps/admin\"\n        debug=\"0\" privileged=\"true\">\n \n  <Logger className=\"org.apache.catalina.logger.FileLogger\"\n             prefix=\"localhost_admin_log.\" suffix=\".txt\"\n          timestamp=\"true\"/>\n\n  <Valve className=\"org.apache.catalina.valves.RequestDumperValve\"/>\n\n</Context>\n-------------------------------------------------------------------\ngives following Null Pointer Exception:\n\nJul 23, 2003 10:08:42 AM org.apache.catalina.core.StandardHostDeployer install\nINFO: Installing web application from Config file URL file:D:\\Tomcat5.0.4\n\\jakarta-tomcat-5\\build\\conf\\Catalina\\localhost\\admin.xml\nJul 23, 2003 10:08:43 AM org.apache.catalina.core.StandardPipeline registerValve\nINFO: Can\'t register valve RequestDumperValve[/admin]\njava.lang.NullPointerException\n        at org.apache.catalina.valves.ValveBase.createObjectName\n(ValveBase.java:292)\n        at org.apache.catalina.core.StandardPipeline.registerValve\n(StandardPipeline.java:357)\n        at org.apache.catalina.core.StandardPipeline.addValve\n(StandardPipeline.java:492)\n        at org.apache.catalina.core.ContainerBase.addValve\n(ContainerBase.java:1306)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.commons.beanutils.MethodUtils.invokeMethod\n(MethodUtils.java:252)\n        at org.apache.commons.digester.SetNextRule.end(SetNextRule.java:256)\n        at org.apache.commons.digester.Rule.end(Rule.java:276)\n        at org.apache.commons.digester.Digester.endElement(Digester.java:1058)\n        at org.apache.crimson.parser.Parser2.maybeElement(Parser2.java:1536)\n        at org.apache.crimson.parser.Parser2.content(Parser2.java:1779)\n        at org.apache.crimson.parser.Parser2.maybeElement(Parser2.java:1507)\n        at org.apache.crimson.parser.Parser2.parseInternal(Parser2.java:500)\n        at org.apache.crimson.parser.Parser2.parse(Parser2.java:305)\n        at org.apache.crimson.parser.XMLReaderImpl.parse(XMLReaderImpl.java:442)\n        at org.apache.commons.digester.Digester.parse(Digester.java:1567)\n        at org.apache.catalina.core.StandardHostDeployer.install\n(StandardHostDeployer.java:515)\n        at org.apache.catalina.core.StandardHost.install(StandardHost.java:869)\n        at org.apache.catalina.startup.HostConfig.deployDescriptors\n(HostConfig.java:519)\n        at org.apache.catalina.startup.HostConfig.deployApps\n(HostConfig.java:470)\n        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:920)\n        at org.apache.catalina.startup.HostConfig.lifecycleEvent\n(HostConfig.java:399)\n        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent\n(LifecycleSupport.java:166)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1135)\n        at org.apache.catalina.core.StandardHost.start(StandardHost.java:795)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1127)\n        at org.apache.catalina.core.StandardEngine.start\n(StandardEngine.java:502)\n        at org.apache.catalina.core.StandardService.start\n(StandardService.java:519)\n        at org.apache.catalina.core.StandardServer.start\n(StandardServer.java:2312)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:577)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)\nJul 23, 2003 10:08:43 AM org.apache.struts.util.PropertyMessageResources <init>\nINFO: Initializing, config=\'org.apache.struts.util.LocalStrings\', \nreturnNull=true\n-------------------------------------------------------------------------\nGot same exception when placed a Context having a Valve inside server.xml.\nPlacing a Valve inside a Host seems to work fine.Analysis of the problem:\nIn ValveBase::createObjectName line 292, host is expected to have a non-null \nvalue. This will happen only if parent has been set for the current Context \nthat has a Valve definition.\n\nThis call can be traced back to org.apache.catalina.core.ContainerBase.addValve\n(ContainerBase.java:1306), which can be further traced back to \norg.apache.commons.digester.SetNextRule.end(SetNextRule.java:256).\n\nIf we look at ContextRuleSet::addRuleInstances, (line 248) statement:\ndigester.addObjectCreate(prefix + \"Context/Valve\",\n                                 null, // MUST be specified in the element\n                                 \"className\");\nis setting the corresponding Rule whose later execution (*end*) leads to NPE.\n\nAnother statement in same method (line 164):\n            digester.addSetNext(prefix + \"Context\",\n                                \"addChild\",\n                                \"org.apache.catalina.Container\");\nis responsible for correctly setting the parent-child relationship between Host \nand the current Context. But before the *end* of this Rule can be called, the \n*end* of the previous Rule gets called leading to NPE.\n\nHence, if we decide to retain the statement (line 291) \nHost host = (Host) container.getParent(); \nin ValveBase::createObjectName, then we should make sure that this call would \nreturn a non-null Host reference.\n\nOne of the ways to achieve this is the following modification:\n--------------------------------------------------------------------\n--- Tomcat5.0.4\\jakarta-tomcat-\ncatalina\\catalina\\src\\share\\org\\apache\\catalina\\startup\\SetDocBaseRule.java\n\tMon Jul 14 20:54:26 2003\n+++ Modified\\Tomcat5.0.4\\jakarta-tomcat-\ncatalina\\catalina\\src\\share\\org\\apache\\catalina\\startup\\SetDocBaseRule.java\n\tWed Jul 23 17:13:10 2003\n@@ -127,6 +127,8 @@\n         }\n         String appBase = host.getAppBase();\n \n+        child.setParent(host);\n+\n         if (!(host instanceof StandardHost)) {\n             return;\n         }\n---------------------------------------------------------------------\n\nAn additional call to child.setParent(host) in *begin* will make sure that \nlater call to getParent() returns a non-null Host reference.\n\nOf course, there could be other ways to fix this problem.Yes, there was one last bug with discrepancies between the pipeline lifecycle\nand the JMX registration of the valves.\nHopefully, that\'s the last bug of this kind (I had fixed a similar, more serious\nbug, in 5.0.3).Verified the fix in StandardPipeline. It works fine.',?,BUG
21823,'Compiler uses invoking page\'s PageInfo for handling tag files','Tomcat 5',Jasper,ernst.matthias,dev,'When Jasper finds a tagfile invocation, it\'ll find its TagInfo through calls to \nImplicitTagLibraryInfo#getTagFile -> TagFileProcessor#parseTagFileDirectives -> \nParserController#parseTagFileDirectives -> ... -> ParserController#determineSyntaxAndEncoding \n-> PageInfo#isXmlConfig() and friends. However, the *current* ParserController is used so that the \nPageInfo is that of the *calling* page and not the called tagfile.\n\nConsequently the wrong jsp-property group will be consulted.Created attachment 7526\nProposed patchThe patch attached above fixes this.  It also removes PageInfo\'s \nisXmlConfigSpecified and isXmlConfig variables, and all references to them, as \nthe fix eliminated the only code that used their values.Works like a charm. Thanks a lot. Please incorporate.',?,BUG
21917,'TldConfig.java does not set SystemId','Tomcat 5',Catalina,apache,dev,'Trying to use entities in tld xml file, XML parser throws:\n\norg.xml.sax.SAXParseException: Relative URI \"entities/converter_attributes.xml\";\ncan not be resolved without a base URI.\n\nThe problem seems to be caused by calling digester.parse(InputStream) method\ninstead of digester.parse(InputSource) one. To fix this, must change\nTldConfig.tldScanStream to accept InputSource instead of InputStream.\nRespectively, tldScanJar() and tldScanTld() need trivial changes to pass\nInputSource.\n\nSame bug exists in Tomcat 4.x as well. Should I enter the same bug there?Can you submit a patch to implement this ?This has now been fixed.',?,RFE
21970,'URL\'s referencing directories without trailing slash redirected to ROOT context','Tomcat 5',Catalina,hoju,dev,'Given a typed URL such as:\nhttp://localhost:8080/tomcat-docs/appdev\n\nExpected redirection:\nhttp://localhost:8080/tomcat-docs/appdev/\n\nActual redirection:\nhttp://localhost:8080/appdev/\n\nThe context is being stripped off upon redirection.\n\nJakeI suppose it\'s easier to file the bug after seeing the corresponding commit.\n\nremm        2003/07/29 05:15:47\n\n  Modified:    util/java/org/apache/tomcat/util/http/mapper Mapper.java\n  Log:\n  - Fix a bug redirecting to a folder: the context path was lost.\n    (ex: /tomcat-docs/images -> /tomcat-docs/images/ - previsouly, it would\n    get redirected to /images)\n',?,BUG
21978,'Certain tag file pathnames lead to compile errors','Tomcat 5',Jasper,ecarmich,dev,'Tomcat can\'t compile certain tag files:\n\n1) Tag files whose relative pathname contains a component (one of the \ndirectories, or the filename without the \".tag\" suffix) which is not a legal \nJava identifier.  Tomcat converts the relative pathname to a fully-qualified \nclass name, and if the parts aren\'t all legal Java identifiers, the Java \ncompiler will throw an error.\n\n2) Tag files in /<some_directories>/<immediate_parent_directory>/ when there\'s \na tag file in /<some_directories>/ with \nfilename \"<immediate_parent_directory>.tag\".  Here the problem is that the \npackage of the tag files in /<some_directories>/<immediate_parent_directory>/ \nclashes with the class of the \"<immediate_parent_directory>.tag\" tag file.  \nFor instance, the tag file /WEB-INF/tags/foo/bar.tag will have package name \norg.apache.jsp.tag.web.foo, which conflicts with the fully-qualified class \nname of the tag file /WEB-INF/tags/foo.tag.\n\nI will attach a patch that fixes this.Created attachment 7563\nProposed patchPatch applied.  I also added checks for Java keywords in the package names. \nThanks.\nGood catch on checking for Java keywords.  That also makes it possible to \nrefactor getDerivedPackageName and eliminate some duplicate code.  I will \nattach a patch implementing this.\n\nNo issues whatsoever with your commit fixing the bug I reported, so if you \ndon\'t think the new patch makes the code cleaner, feel free to change this bug \nticket back to \"Resolved/Fixed\".Created attachment 7574\nRefactoring getDerivedPackageName()I thought about refactoring that part, but was too lazy to actually do it.  Glad\nthat you did though.  Thanks.\n',?,BUG
22006,'Invalid SMAP line entries when running with mappedfile=true','Tomcat 5',Jasper,jschulz,dev,'I\'m running Tomcat5.0.5 with JspServlet options \"mappedfile=true\" \nand \"dumpSmap=true\".  The SMAP file appears to be incorrect for HTML sections \nof the servlet.\n\nFor example, take the following trivial JSP (shown with line numbers):\n1 <head>\n2   <title>My Title</title>\n3 \n4 </head>\n\nThe corresponding lines in the generated servlet are:\n40      out.write(\"<head>\\n\");\n41      out.write(\"  \");\n42      out.write(\"<title>My Title\");\n43      out.write(\"</title>\\n\");\n44      out.write(\"\\n\");\n45            out.write(\"</head>\");\n\nActual LineInfo section of the SMAP file:\n*L\n1:40,2\n2:42\n2:43,2\n4:45\n\nExpected LineInfo section:\n*L\n1:40\n2:41,3\n3:44\n4:45There are two reasons the Actual LineInfo differs from the Expected LineInfo:\n\n1) When a TemplateText node spans more than one line in the JSP, Jasper SMAPs \nit as if all of the node\'s output source was generated by the first line of \nthe node\'s input source, and the other lines in the node\'s input source \ncontributed nothing.\n\n2) Jasper SMAPs each node independently of the others, and makes no attempt to \nconsolidate the resulting line section.  I\'m not sure consolidation is \nactually required by the spec, but it reduces the size of the class files, so \nit\'s a good thing to do.\n\nI will attach a patch that fixes both of these.Created attachment 7636\nProposed patchI\'ve applied the patch, thanks.',?,BUG
22032,'missing security-policy in default-configuration','Tomcat 5',Unknown,mezger,dev,'when starting tomcat 5.0.5 with security-manager enabled (standard distribution,\nno configuration-changes, just catalina.sh start -security), it throws an\njava.security.AccessControlException when accessing any jsp-page (even\nindex.jsp). Adding the following lines to conf/catalina.policy resolved the\nproblem for me:\n\npermission java.lang.RuntimePermission\n\"accessClassInPackage.org.apache.jasper.runtime\";\npermission java.lang.RuntimePermission\n\"accessClassInPackage.org.apache.jasper.juntime.*\";\npermission java.lang.RuntimePermission\n\"defineClassInPackage.org.apache.jasper.runtime\";\npermission java.lang.RuntimePermission\n\"defineClassInPackage.org.apache.jasper.runtime.*\";\n\nThe stack-trace of the excepion is:\n\njava.security.AccessControlException: access denied (java.lang.RuntimePermission\naccessClassInPackage.org.apache.jasper.runtime)\n        at\njava.security.AccessControlContext.checkPermission(AccessControlContext.java:270)\n        at java.security.AccessController.checkPermission(AccessController.java:401)\n        at java.lang.SecurityManager.checkPermission(SecurityManager.java:542)\n        at java.lang.SecurityManager.checkPackageAccess(SecurityManager.java:1513)\n        at java.lang.ClassLoader$1.run(ClassLoader.java:326)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at java.lang.ClassLoader.checkPackageAccess(ClassLoader.java:324)\n        at java.lang.ClassLoader.defineClass0(Native Method)\n        at java.lang.ClassLoader.defineClass(ClassLoader.java:502)\n        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:123)\n        at\norg.apache.catalina.loader.WebappClassLoader.findClassInternal(WebappClassLoader.java:1657)\n        at\norg.apache.catalina.loader.WebappClassLoader.findClass(WebappClassLoader.java:882)\n        at\norg.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1345)\n        at\norg.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1225)\n        at org.apache.catalina.core.StandardWrapper$1.run(StandardWrapper.java:951)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at\norg.apache.catalina.core.StandardWrapper.loadServlet(StandardWrapper.java:947)\n        at\norg.apache.catalina.core.StandardWrapper.allocate(StandardWrapper.java:701)\n        at\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:183)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\n        at\norg.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:256)\n        at\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:210)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\n        at\norg.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:190)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n        at\norg.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:175)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\n        at\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:156)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:974)\n        at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:207)\n        at\norg.apache.coyote.http11.Http11Processor.process(Http11Processor.java:637)\n        at\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:488)\n        at\norg.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:568)\n        at\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:631)\n        at java.lang.Thread.run(Thread.java:536)As a better worksaround, in conf/catalina.properties, remove the jasper package\nfrom the list of protected packages. I will investigate why this exception is\nthrown.\n\nThanks,\n\n-- JeanfrancoisNice catch. The problem occurs only when precompiled JSPs are used (Source JSP\ndoesn\'t have the problem). I have modified your patch (we don\'t need to give\ndefineClassInPackage permission).\n\nThanks again.\n\n-- JeanfrancoisOK, but the problem occured not only with precompiled JSPs. For me, even the\nstandard tomcat webapps/index.jsp and all of the jsp-examples threw this\nexception. I think this shouldn\'t be the default behaviour with a fresh\ninstalled tomcat using the security manager.\nThanks for the workaround with removing the jasper-package from the\ncatalina.properties file. I hope this doesn\'t open any security holes...',?,BUG
22058,'incorrect JSP compilation','Tomcat 5',Jasper,gilles.scokart,dev,'I have a simple JSP that use a custom tag (file) writen by extending \nSimpleTagSupport.\n\nHere is the JSP :\n<\%@ taglib uri=\"c-rt.tld\" prefix=\"b\" \%>\n<\%@ taglib uri=\"templater.tld\" prefix=\"t\" \%>\n\n\n<b:forEach begin=\"0\" end=\"10\">\n\t<t:file name=\"t\">\n\t\t<b:if test=\"true\">\n\t\t</b:if>\n\t</t:file>\n</b:forEach>\n\nThe generated code doesn\'t compile.  The error is:\n_jspx_push_body_count_b_forEach_0 cannot be resolved (in the function invoke_0)\n\nHere is an extract of the generated code:\n\n private class test_jspHelper\n      extends org.apache.jasper.runtime.JspFragmentHelper\n  {\n    private javax.servlet.jsp.tagext.JspTag parentTag;\n\n    public test_jspHelper( int discriminator, JspContext jspContext, \njavax.servlet.jsp.tagext.JspTag parentTag ) {\n      super( discriminator, jspContext, parentTag );\n      this.parentTag = parentTag;\n    }\n    public boolean invoke0( java.io.Writer out ) \n      throws Throwable\n    {\n      javax.servlet.jsp.tagext.JspTag _jspx_th_t_file_0 = parentTag;\n      out.write(\"\\r\\n\\t\\t\");\n      if (_jspx_meth_b_if_0(_jspx_th_t_file_0, pageContext, \n_jspx_push_body_count_b_forEach_0))\n        return true;\n      out.write(\"\\r\\n\\t\");\n      return false;\n    }\n    public void invoke( java.io.Writer writer )\n      throws javax.servlet.jsp.JspException\n    {\n      java.io.Writer out = null;\n      if( writer != null ) {\n        out = this.jspContext.pushBody(writer);\n      } else {\n        out = this.jspContext.getOut();\n      }\n      try {\n        switch( this.discriminator ) {\n          case 0:\n            invoke0( out );\n            break;\n        }\n      }\n      catch( Throwable e ) {\n        if (e instanceof javax.servlet.jsp.SkipPageException)\n            throw (javax.servlet.jsp.SkipPageException) e;\n        throw new javax.servlet.jsp.JspException( e );\n      }\n      finally {\n        if( writer != null ) {\n          this.jspContext.popBody();\n        }\n      }\n    }Created attachment 7812\nSourcesHmm... The attached war file does not seem to contain the JSP page you quoted.It\'s \"test1.jsp\" in the .zipThe codes generated from the latest nightly build does not contain a reference\nto _jspx_push_body_count_b_forEach_0 in invoke0, and the page was successfully\ncompiled, so I consider this bug fixed.  You can verify that with 5.0.9.\n\nHowever at request tim, I did get a ClassCastException on\ntemplater.jsp.tag.FileTag.doTag(FileTag.java:20)\n\n      TemplatePageContext ctx = (TemplatePageContext) getJspContext();\n\nbut that\'s in your code.\n\nNext time you should provide a war file; that\'ll let me get to debugging\nquicker.\n\nAlso, you should use jstl 1.1 instead of jstl 1.0.I\'m still seeing this problem, with latest CVS and with 5.0.9.  I will attach \na .war file that reproduces the problem against 5.0.9.Created attachment 8063\n.war that reproduces the problem against 5.0.9',?,OTHER
22084,'JSP compiler incorrectly indents code','Tomcat 5',Jasper,ecarmich,dev,'If the text in a TemplateText node ends in \"\\n\", then if the mappedfile init \nparameter is set to true, or the line length exceeds CHUNKSIZE, the first line \nof Java code generated from the succeeding node will be indented too far.\n\nThe problem is that when visit(Node.TemplateText n) in Generator.java sees \nthe \"\\n\", it finishes the current line, and then calls out.printin() in order \nto properly indent the text that follows.  This works fine if there is text \nthat follows, but if there isn\'t, the effect is to overindent the first line \nin whatever code is generated by the next node to be visited.\n\nI will attach a patch that fixes this.Created attachment 7627\nProposed patchThis seems reasonable, and I have applied the patch. Thanks.',?,IMPROVEMENT
22090,'EL evaluation should cache parse results','Tomcat 5',Jasper,ernst.matthias,dev,'EL expressions are parsed on every evaluation. PageContextImpl uses an ExpressionEvaluator with \nbypassCaches=true. Either the standard caches should be used OR rather, a compiled page should \nhold parsed expressions in static fields. Then contention on the caches could be avoided, too.Created attachment 7630\nenable cachesEvidence (threaddumps) supports that the problem is not the parsing performance\nper se, but the allocation of three (8k+16k+16k) buffers per parser invocation:\n\nSimpleCharStream.java:\n#245:    buffer = new char[buffersize];\n#246:    bufline = new int[buffersize];\n#247:    bufcolumn = new int[buffersize];\n\n\"tcpConnection-8001-14\" daemon prio=1 tid=0x4e102df8 nid=0x33ca waiting for\nmonitor entry [bbdfe000..bbdff908]\n        at\norg.apache.commons.el.parser.SimpleCharStream.<init>(SimpleCharStream.java:245)\n        at\norg.apache.commons.el.parser.SimpleCharStream.<init>(SimpleCharStream.java:253)\n        at org.apache.commons.el.parser.ELParser.<init>(ELParser.java:1721)\n\nThis is kind of a commons/el problem, not a jasper one. I will try to patch el\nto use smaller buffers (which expression is 4k???). If that improves matters, I\nmight close this report although I still consider it valid.\nGood findings.\n\nI think those buffers should be owned by another component (Jasper\'s\nPageContextImpl IMO), and passed to commons-el), to allow reuse and avoid the\nallocation. This could be optional (commons-el would allocate buffers if none\nare passed): a new constructor would simply need to be added.\n\nBuffers bigger than 1K take a significant amount of time to allocate (and making\nthem too small might impact functionality), so even 4K would be too big IMO.Some measurements:\n\n1. no el cache, parser default buffers: 40 req/s, 1.8m/s\n2. no el cache, small parser buffers: 90req/s, 3.7m/s\n3. el cache: 200req/s, 8m/s\n4. non-synchronized el-cache (simulates parsed expression trees stored per\ntagfile instance): 210req/s, 8.5m/s\n\nlinux dual proc, 100mbit ethernet, j2sdk 1.4.2, resin 2.1.9, jasper 5.0.6\npage data completely in memory, ~70 simple el evaluations, 40k html\n\nstill voting for option 3 or 4.\nlast post on this subject.\nWell, I thought your second post meant that the benefit of using caching was\noffset by some buffer allocation. Looking at the code, the allocation doesn\'t\nseem to happen with the cache, so there\'s no problem.\nYour patch seems good, sorry for the misunderstanding.',?,BUG
22103,'JspC.execute do not close files','Tomcat 5',Jasper,gilles.scokart,dev,'When there is an error in the JSP file, and the JSP compiler is invoked from an \nANT script via JspC.execute(), the opened files are not closed.\n\nWhat seems to happen is that the java output files is created and opened, the \nerror in the JSP is detected and an exception is trigered without closing the \nopened files.\n\nThat raise problems when the ANT script is called from an IDE (like eclipse) \nthat does\'nt use a separate JVM to execute it.  In that case, the created empty \nfile can not be deleted without closing the IDE.\n\nIs it possible to add a finally clause somewhere to always close all opened \nfiles, even in case of errors ?Since you seem to have looked into the problem in detail, could you submit a\nsmall patch ?\nOtherwise, can you give more details on where the leak come from ?Oups, sorry I can not send you a patch.  But I have look in the source, and I \nthink that if you update the org.apache.jasper.compiler.Compiler.compile\n(boolean) method by insterting\n\nif (ctx.getWriter()!=null)\n{\n   ctx.getWriter().close();\n   ctx.setWriter(null);\n}\n\nin the finally clause.\n\nBTW, how can I give you patch if I don\'t have a CVS client?\nOk, the proposed change seems reasonable to me. Thanks. I assume you have\nverified it fixes your problem.Unfortunately, no.  I didn\'t have all the environment (and/or the time) I need \nto recompile and test the fix.  But as you said, it seems reasonable.\n\nThanks.',?,BUG
22133,'Scoping conflict for generated fragment helpers','Tomcat 5',Jasper,ernst.matthias,dev,'A JSP Fragment in a tag file that does EL may lead to problematic Java code.\n\nJSP Fragments of tag files are compiled into inner classes:\n\n  public final class com_coremedia_jsp_NewsTicker_body_tag\n    extends javax.servlet.jsp.tagext.SimpleTagSupport\n  {\n    ...\n\n    private class com_coremedia_jsp_NewsTicker_body_tagHelper\n      extends org.apache.jasper.runtime.JspFragmentHelper\n    {\n      ...\n      public void invoke0( java.io.Writer out ) \n        throws Throwable\n      {\n         ...\n        \nout.write((java.lang.String)org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate(\"${rows}\",\njava.lang.String.class, (PageContext)getJspContext(), null, false)); <<<<<<\n         ...\n      }\n    }\n\nBoth javac 1.3 and Eclipse\'s JDT compiler flag the call to #getJspContext as\ninvalid as this method is both inherited and defined in the enclosing class: \n\n  com_coremedia_jsp_NewsTicker_body_tag.java:206: getJspContext() is inherited  \n  from org.apache.jasper.runtime.JspFragmentHelper and hides method in outer  \n  class org.apache.jsp.tag.web.com_coremedia_jsp_NewsTicker_body_tag.  An  \n  explicit \'this\' qualifier must be used to select the desired instance.\n\nJavac 1.4.2 accepts this code and calls the inherited method.\n\nFrom my interpretation of the JLS, 1.4.2\'s behaviour seems correct and is the\nintended one, but the code won\'t be compilable with javac 1.3.The following patch resolves _this specific_ problem but there might be other\nimplicit calls to \'this\' lurking around:\n\n====\n//coremedia/thirdparty/apache/jakarta-jasper2/src/share/org/apache/jasper/compiler/JspUtil.java#2\n-\n/home/mernst/p4/main/thirdparty/apache/jasper2/src/share/org/apache/jasper/compiler/JspUtil.java\n====\n@@ -534,7 +534,7 @@\n          */\n        String jspCtxt = null;\n        if (isTagFile)\n-           jspCtxt = \"getJspContext()\";\n+           jspCtxt = \"this.getJspContext()\";\n        else\n            jspCtxt = \"pageContext\";\nYou can switch eclipse\'s compiler\'s \"compliance\" to 1.4 (what a multifaced beast !). Then it\'ll \ncompile that code.\n\nThe issue with 1.3 remains. How important is Jdk 1.3 compliance rated, by the way ?\n Ok, so your patch resolves JDK 1.3 compatibility then ?\nJDK 1.3 compatibility is important. the whole J2EE requires 1.4 now, but the web\ntier can (and should) still attempt to work with 1.3.Well, my patch resolves the issue for this particular call to #getJspContext(). In general all \nunqualified method calls that resolve to methods in both SimpleTagSupport and \nJspFragmentHelper will be flagged by the 1.3.1 compiler. Looks like \'getParentTag()\' might be \nanother candidate. Will check out.I have applied your patch, and it will be included in 5.0.7. Thanks.\nReopen the bug if you find other occurances of this bug.',?,BUG
22146,'TC 5.0.6 problems loading an a persisted session.','Tomcat 5',Catalina,lkarpel,dev,'During TC 5.0.6 startup I (sometimes) get the following exception. \n\nWe run with the the Manager set as follows:\n\n<Manager className=\"org.apache.catalina.session.StandardManager\" \ndistributable=\"true\" /> \n\nand get no errors when creating any session properties. The class \ncom.eloquent.ecs.EKey is contained in the web-inf/classes folder.\nIt looks like TC5 is trying to load an array of the EKey objects\nand failing .. \n\nI am not sure how to put together a duplicable example at this point.\nAny help as to what might be going on will help.\n\nAug 5, 2003 1:45:06 PM org.apache.catalina.session.StandardManager doLoad\nSEVERE: ClassNotFoundException while loading persisted sessions: \njava.lang.ClassNotFoundException: [Lcom.eloquent.ecs.EKey;\njava.lang.ClassNotFoundException: [Lcom.eloquent.ecs.EKey;\n        at org.apache.catalina.loader.WebappClassLoader.loadClass\n(WebappClassLoader.java:1378)\n        at org.apache.catalina.loader.WebappClassLoader.loadClass\n(WebappClassLoader.java:1225)\n        at org.apache.catalina.util.CustomObjectInputStream.resolveClass\n(CustomObjectInputStream.java:119)\n        at java.io.ObjectInputStream.readNonProxyDesc\n(ObjectInputStream.java:1513)\n        at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1435)\n        at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1560)\n        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1271)\n        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:324)\n        at org.apache.catalina.session.StandardSession.readObject\n(StandardSession.java:1387)\n        at org.apache.catalina.session.StandardSession.readObjectData\n(StandardSession.java:881)\n        at org.apache.catalina.session.StandardManager.doLoad\n(StandardManager.java:450)\n        at org.apache.catalina.session.StandardManager.load\n(StandardManager.java:377)\n        at org.apache.catalina.session.StandardManager.start\n(StandardManager.java:691)\n        at org.apache.catalina.core.StandardContext.start\n(StandardContext.java:3913)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1127)\n        at org.apache.catalina.core.StandardHost.start(StandardHost.java:792)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1127)\n        at org.apache.catalina.core.StandardEngine.start\n(StandardEngine.java:502)\n        at org.apache.catalina.core.StandardService.start\n(StandardService.java:519)\n        at org.apache.catalina.core.StandardServer.start\n(StandardServer.java:2311)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:578)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)\nAug 5, 2003 1:45:06 PM org.apache.catalina.session.StandardManager start\nSEVERE: Exception loading sessions from persistent storage\njava.lang.ClassNotFoundException: [Lcom.eloquent.ecs.EKey;\n        at org.apache.catalina.loader.WebappClassLoader.loadClass\n(WebappClassLoader.java:1378)\n        at org.apache.catalina.loader.WebappClassLoader.loadClass\n(WebappClassLoader.java:1225)\n        at org.apache.catalina.util.CustomObjectInputStream.resolveClass\n(CustomObjectInputStream.java:119)\n        at java.io.ObjectInputStream.readNonProxyDesc\n(ObjectInputStream.java:1513)\n        at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1435)\n        at java.io.ObjectInputStream.readArray(ObjectInputStream.java:1560)\n        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1271)\n        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:324)\n        at org.apache.catalina.session.StandardSession.readObject\n(StandardSession.java:1387)\n        at org.apache.catalina.session.StandardSession.readObjectData\n(StandardSession.java:881)\n        at org.apache.catalina.session.StandardManager.doLoad\n(StandardManager.java:450)\n        at org.apache.catalina.session.StandardManager.load\n(StandardManager.java:377)\n        at org.apache.catalina.session.StandardManager.start\n(StandardManager.java:691)\n        at org.apache.catalina.core.StandardContext.start\n(StandardContext.java:3913)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1127)\n        at org.apache.catalina.core.StandardHost.start(StandardHost.java:792)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1127)\n        at org.apache.catalina.core.StandardEngine.start\n(StandardEngine.java:502)\n        at org.apache.catalina.core.StandardService.start\n(StandardService.java:519)\n        at org.apache.catalina.core.StandardServer.start\n(StandardServer.java:2311)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:578)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)\n[main] <EServlet> WebApp Servlet started at: Tue Aug 05 13:45:06 MDT 2003Submitting a test case would help.Created attachment 7671\nA Webapp that has the problem.I have just attached a zip file containing a webapp the demonstates this problem\n\n1. Unzip the attached zip file into C:\\\n2. Add a Context to the server.xml for example\n\n     <Context path=\"/test\" docBase=\"C:/testapp\" debug=\"0\" reloadable=\"false\" />\n\n3. Start TC 5.0.6 .. I used startup.bat\n4. Ping the servlet: http://server:8080/test/test\n5. An HTML page with the word \'done\' should be displayed\n6. Stop TC .. I used control-C in the command window\n7. Start TC again .. I used startup.bat\n8. You should see an exception during startup.\n\nIt appears as though code in the vicinity of a.o.c.util.CustomObjectInputStream \nhas problems loading arrays of objects.\nI\'ll look at it. I think I saw that bug reported with 4.1.x, BTW. It\'s extremely\nunlikely to have been introduced in 5.0.x.I can reproduce this, but failed to fix the bug.\nI added traces in CustomObjectInputStream, and while there\'s a (normal) CNFE for\n[Ltest$EKey;, it loads correctly test$EKey. The behavior is in every way\nidentical between TC 4.1.x and 5.0.x (at least for what I could see), and yet I\ncouldn\'t reproduce the bug with Tomcat 4.1.x.\nIf someone could help, or has ideas, that would be cool :)I finally found a solution to the bug.Thanks !!',?,BUG
22174,'tomcat service launcher does not accept path to jvm.dll with spaces','Tomcat 5',Unknown,dylans,dev,'When reconfiguring the with the \"Configure Tomcat\" Application I try to select a\nserver\\bin\\jvm.dll from a directory that as a space in it. This does not work. a\njvm.dll from a directory without spaces works correctly.\n\nThis is probably a bug in commons-daemon, but affects tomcat5/windows installs*** Bug 22187 has been marked as a duplicate of this bug. ***I am not sure that 22187 is really a duplicate or not. In my examples there are \nno blanks .. but the service will still not start unless only the \nkeyword \'java\' is specified.Fixed now in the CVS and should appear in 5.0.7.\n\nAs near as I can tell, this is the same issue as #22187.  The problem was with \nthe quotes in the parameters, not with the spaces.I still have the same problem under version 5.0.24.\n\nWhen I try to install from the .exe binary the installation stops at \nc:\\j2sdk1.4.2_04\\jre\\bin\\server\\jvm.dll\n\nLarsInstallation from the .exe using c:\\j2sdk1.4.2 as the java directory works for \nme.\n\nInstallation from the .exe using c:\\java test (space in the name) as the java \ndirectory works for me.\n\nInstallation from the .exe using c:\\j2sdk1.4.2, and then using the Configure \nTomcat program to change the JDK to c:\\java test\\jre\\server\\bin\\jvm.dll also \nworks for me.\n\nAll these were done on a clean machine (no previous or other tomcat \ninstallations) with Tomcat 5.0.25, so I\'m pretty sure this bug is resolved.',?,OTHER
22192,'Dash chararcter in webapp path replaces other deployed webapp','Tomcat 5',Catalina,andy,dev,'If a dash character is present in a webapp path name, a webapp with the same \nname up to the dash will be rendered inoperable. For example, given \nservlet \'A\' deployed at path /test and servlet \'B\' deployed at /test-b, \nservlet \'A\' will be rendered inoperable after servlet \'B\' is deployed.\n\nIf servlet \'B\' is assigned a path with a dash (e.g. /testb), everything works.\n\nAndyThe fix for this will be in 5.0.7. This was caused by a flaw in the context\nmapping algorithm.',?,BUG
22266,'Keep template text together with mappedfile=\"true\"','Tomcat 5',Jasper,ecarmich,dev,'Jasper\'s mappedfile=true option doesn\'t always generate static content with \none print statement per input line.  Jasper creates a new Node every time it \nsees a \"<\" in the input, so when template text contains an HTML tag in the \nmiddle of an input line, the resulting Java code is split across multiple \noutput lines (and in my opinion is therefore harder to read).\n\nThis can be fixed by checking the text after the \"<\" before moving on to the \nnext Node.  I will attach a patch that implements this.Created attachment 7704\nProposed patchIt looks that was what was originally intended, so it\'s likely another great\npatch :)\nI\'ll apply both of your patches.I would have preferred that this optimization be done with a separate pass over\nthe parsed nodes, which combines contiguous template text nodes into one.  The\nlook-ahead used in this patch duplicates logic used in the other part of the\nParser (it also misses <jsp:text>, for instance), and may have some performance\nimpact.\n\nI\'ll leave this patch in for now, but may undo it when the separate optim pass\nis implemented later, unless Eric beats me to it!  :-)Unfortunately I\'ve thrown out the actual numbers I got in the performance \ntesting I did (all on a 1 GHz Windows XP laptop), but the salient results were \nas follows:\n1) The patch made Tomcat faster at compiling and serving pages with a \npreponderance of HTML tags versus JSP tags (the lookahead does take some extra \ntime, but is more than made up if the lookahead results in one less node to be \ntraversed later).  With the patch in place, Tomcat compiled and served \nindex.html from the jsp-examples webapp (renamed to index.jsp, obviously) \nabout 9\% faster than without the patch.\n2) On balance, however, the patch made Tomcat slower at compiling and serving \npages.  At least, when I tested against the jsp-examples webapp (with \nindex.jsp renamed back to index.html so it wasn\'t part of the test), time to \ncompile and serve was about 2\% slower.\n3) I couldn\'t find any difference in serving compiled pages with the patch in \nplace (I thought there might be a small improvement because the patch shrinks \nthe .class files).\n\nBased on those numbers, I decided not to submit the patch as an option \nconfigurable separately from mappedfile, or as a non-configurable \nenhancement.  But since the mappedfile documentation said it was intended for \ndebugging, I thought the performance hit was acceptable.\n\nI didn\'t test your idea of a separate pass through the parsed nodes, but I did \ntest code that, when about to create a new TemplateText node, checked to see \nif the previous node was also a TemplateText node, and if so, just appended \nits text to the previous node\'s (the ideas being that anything that conserved \nnodes might improve performance, and that I didn\'t like duplicating logic from \nanother part of the Parser, either).  But that was noticeably slower (I\'ve \nforgotten the numbers entirely) than the patch I submitted.\n\nAnyway, I submitted the patch as an enhancement, so I can\'t complain if it \ngets implemented differently or not at all.  The above is just to help folks \nmake an informed decision.There is no doubt that concatenating contiguous template texts into one improves\nthe runtime performance and I am not too worry about spending extra time during\ncompilation, since I believe web applications should be deployed precompiled.\n\nMy suggestion for a separate pass was motivated by the design principle to keep\nthe modules simple and direct.  The current compiler is made up of a number of\npasses, driven by the common data structure (Node and PageInof etc).  I\'d like\nto keep Parser only doing the basic parsing, but leaves the optimizations to\nother passes.  Not only will it be easier for debugging and maintenance,\nswitching on and off such optimizations will also made easier.\n\nLike I said, this no big deal, so I\'ll leave the patch in for now.  Anyway,\nthanks for contributing to improve Jasper, and don\'t let slight disagreements\nlike this prevent you from making more contributions in the future.It\'s just occurred to me that if the consolidation were done in a separate \npass, it would apply to JSPs in XML format as well.  So provided the \nperformance hit during compilation is acceptable (and I take your point that \nwebapps should be deployed precompiled), I agree a separate pass is the way to \ngo.\n\nBut if a performance hit during compilation is acceptable, is there any reason \nnot to do this consolidation even when mappedfile=\"false\"?  As you say, it \nshould improve runtime performance, and we always have JspUtil.CHUNKSIZE \n(which could be made a configurable parameter) to keep individual lines from \ngetting too long.  That was the only other downside that I found when I tested \nwith mappedfile=\"false\"-- very long template text sections were arguably even \nharder to follow all crammed into one output line than they were split at \nevery HTML tag.',?,RFE
22273,'[PATCH] Typo in jndi-resources-howto.html','Tomcat 5',Webapps:Documentation,yannc76,dev,'Sample configuration for JDBC Data Sources says \'jdbc/Employ*e*DB\' (par 2) \ninstead of \'jdbc/Employ*ee*DB\' (par 3)Created attachment 7713\nSimple patch to fix typo for JDBC sample configurationFixed, thanks.',?,DOCUMENTATION
22277,'IllegalArgumentException in setOutputLineIncrement()','Tomcat 5',Jasper,ecarmich,dev,'Jasper sometimes generates SMAP LineInfo entries with an outputStartLine of \n0.  These LineInfo entries are incorrect, and also can cause a fatal error in \nSmapStratum.java\'s optimizeLineSection(), making it impossible for Jasper to \ncompile the JSP.\n\nNote that the incorrect entries predate optimizeLineSection (they were present \nin Tomcat 5.0.4, and possibly earlier), but optimizeLineSection does blow the \nproblem out of proportion, turning a flawed SMAP into a failed compilation.  I \nwill attach a patch that fixes the blowing-out-of-proportion problem, at \nleast, in order to make Tomcat more usable until I (or anyone else who wants \nto try their hand) can fix the underlying outputStartLine=0 problem.  Another \nworkaround is to set suppressSmap=true.\n\nThe problem can be reproduced by compiling xml/xml.jsp from the jsp-examples \nwebapp that ships with Tomcat 5.  The SMAP generated for that JSP is as \nfollows:\n\nC:\\Program Files\\jakarta-tomcat-5.0.4\n\\work\\Catalina\\localhost\\test\\org\\apache\\jsp\\xml\\xml_jsp.java\nJSP\n*S JSP\n*F\n+ 0 xml.jsp\n/xml/xml.jsp\n*L\n8:0\n15:0,0\n16:0,0\n17:0,0\n17:47\n20:0,0\n21:51\n22:0,0\n24:0,0\n24:54\n25:56\n39:57\n42:0,0\n43:59\n44:60\n48:0,0\n49:64\n49:65\n49:66\n49:67\n49:68\n49:69\n49:70\n*ECreated attachment 7716\nProposed patchI have applied your workaround.I\'m not sure, but I think I have a related (same?) problem here:\n\nMy JSPs compiled with TC5.0.5/6, but fail all with TC5.0.7\n\nOfcourse numbers vary, but all are negative (?!). I can provide sample JSPs on \nrequest, but I don\'t have anything special going on there (Struts/JSTL-tags).\n\nSample Stacktrace (always the same):\n\n2003-08-12 07:57:15 StandardWrapperValve[jsp]: Servlet.service() for servlet \njsp threw exception\njava.lang.IllegalArgumentException: -41\n\tat \norg.apache.jasper.compiler.SmapStratum$LineInfo.setOutputLineIncrement\n(SmapStratum.java:124)\n\tat org.apache.jasper.compiler.SmapStratum.optimizeLineSection\n(SmapStratum.java:221)\n\tat org.apache.jasper.compiler.SmapUtil.evaluateNodes(SmapUtil.java:490)\n\tat org.apache.jasper.compiler.SmapUtil.generateSmap(SmapUtil.java:123)\n\tat org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:301)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:453)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:439)\n\tat org.apache.jasper.JspCompilationContext.compile\n(JspCompilationContext.java:555)\n\tat org.apache.jasper.servlet.JspServletWrapper.service\n(JspServletWrapper.java:300)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile\n(JspServlet.java:293)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:286)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:206)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:254)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:564)\n\tat org.apache.catalina.core.StandardContextValve.invokeInternal\n(StandardContextValve.java:256)\n\tat org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:210)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke\n(AuthenticatorBase.java:501)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:564)\n\tat org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:190)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:175)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:564)\n\tat org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:156)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:564)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:974)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service\n(CoyoteAdapter.java:207)\n\tat org.apache.coyote.http11.Http11Processor.process\n(Http11Processor.java:647)\n\tat \norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio\nn(Http11Protocol.java:489)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java:575)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:649)\n\tat java.lang.Thread.run(Thread.java:534)That\'s the same problem.  No need to provide sample JSPs (although I \nappreciate the offer); a patch fixing the crashing problem is already attached \nto this ticket and incorporated into CVS, and I\'m looking into the best way to \neliminate the root cause.\n\nTo make it easier for other people having this problem to find this ticket, \nI\'m changing the summary from \"SMAP LineInfo entries with an outputStartLine \nof 0\" (the root cause) to \"IllegalArgumentException in setOutputLineIncrement\n()\" (the error people actually see).Wrokaround: set \"supressSmap\" to \"true\" in \"conf/web.xml\".I believe Remy\'s commit from earlier today (\"Don\'t merge SMAP entries in the \noutptStartLines aren\'t consecutive\") fixes the IllegalArgumentException \nproblem (thanks, Remy!).  If that\'s right (I\'ve tested it, but then I tested \nmy original patch as well, so I\'m not taking that as a guarantee), it means my \nworkaround patch can be removed without IllegalArgumentException recurring.  \nOn the other hand the workaround patch also keeps the outputStartLine=0 \nLineInfos out of the SMAP, so taking it out before we\'ve fixed the root cause \nof outputStartLine=0 could be considered a regression, on the grounds that an \nincorrect SMAP is worse than an incomplete one.\n\nAlso, if Jasper were to start SMAPping page directives, then\n\n\tTemplateText<page import=\"org.foo.*\">\n\nwould generate an IllegalArgumentException if it weren\'t for Remy\'s fix.  This \nmeans that IllegalArgumentException is a bug in its own right, and not just a \nside effect of the outputStartLine=0 problem.  So to keep things clear, I \nthink we should use this ticket to track IllegalArgumentException only, and \nopen new tickets as needed to track outputStartLine=0.\n\nI\'ll close this ticket in a few days if there are no objections to this \napproach, and no reason to doubt Remy\'s commit.  If someone else wants to \nclose it sooner, that\'s fine with me.There\'s a side problem that causes the mappings to be incorrect for tags\ninvocations which are done in separate methods, rather than inside _jspService.\nThat\'s what really did cause the bug. I agree that this is fixed, and the other\nissues are other bugs.*** Bug 22508 has been marked as a duplicate of this bug. ****** Bug 22678 has been marked as a duplicate of this bug. ***',?,BUG
22291,'Missing ant tasks for JMX proxy functionality','Tomcat 5',Unknown,vivekchopra,dev,'The JMX proxy functionality in the Tomcat manager doesn\'t have ant tasks.\n\nThese are a bit awkward to use with the HTTP request format, so I wrote these \nand will be attaching the code to the bugzilla entry.Created attachment 7735\nThe JMX Query task codeCreated attachment 7736\nThe JMX Set task codeThanks. The advantage of this is that it works without additional stuff. The\npreffered way to interact with Tomcat through JMX is right now the various MX4J\nconnectors. Tomcat 5.0.x will be updated to JMX 1.2 and the remote JMX as soon\nas they are available.',?,BUILD_SYSTEM
22439,'NPE compiling JSP Document','Tomcat 5',Jasper,hans,dev,'The following JSP Document doesn\'t compile:\n\n<!DOCTYPE html\n  PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\"\n  \"http://www.w3c.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html \n  xmlns=\"http://www.w3c.org/1999/xhtml\" \n  xmlns:jsp=\"http://java.sun.com/JSP/Page\" \n  xml:lang=\"en\" lang=\"en\">\n\n  <jsp:directive.page contentType=\"text/html\" /> \n \n  <head>\n    <title>A JSP Document</title>\n  </head>\n  <body bgcolor=\"white\">\n    <h1>All Request Parameters</h1>\n\n    <ul> \n      <c:forEach xmlns:c=\"http://java.sun.com/jsp/jstl/core\"\n        items=\"${paramValues}\" var=\"current\"> \n        <li> \n          ${current.key}:\n          <c:forEach items=\"${current.value}\" var=\"parValue\">\n            <br/>${parValue} \n          </c:forEach>\n        </li> \n      </c:forEach> \n    </ul> \n\n    <jsp:element name=\"${param.element}\">\n      <jsp:attribute name=\"style\">${param.style}</jsp:attribute>\n      <jsp:body>${param.body}</jsp:body>\n    </jsp:element>\n\n  </body>\n</html>\n\nThe root cause for the exception is:\n\njava.lang.NullPointerException\n\torg.apache.jasper.compiler.PageInfo.popPrefixMapping(PageInfo.java:339)\n\torg.apache.jasper.compiler.JspDocumentParser.endPrefixMapping(JspDocumentParser.java:574)\n\torg.apache.xerces.parsers.AbstractSAXParser.endNamespaceMapping(Unknown Source)\n\torg.apache.xerces.parsers.AbstractSAXParser.endElement(Unknown Source)\n\torg.apache.xerces.impl.XMLNamespaceBinder.handleEndElement(Unknown Source)\n\torg.apache.xerces.impl.XMLNamespaceBinder.endElement(Unknown Source)\n\torg.apache.xerces.impl.dtd.XMLDTDValidator.endNamespaceScope(Unknown Source)\n\torg.apache.xerces.impl.dtd.XMLDTDValidator.handleEndElement(Unknown Source)\n\torg.apache.xerces.impl.dtd.XMLDTDValidator.endElement(Unknown Source)\n\torg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanEndElement(Unknown\nSource)\n\torg.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(Unknown Source)\n\torg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source)\n\torg.apache.xerces.parsers.DTDConfiguration.parse(Unknown Source)\n\torg.apache.xerces.parsers.DTDConfiguration.parse(Unknown Source)\n\torg.apache.xerces.parsers.XMLParser.parse(Unknown Source)\n\torg.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)\n\tjavax.xml.parsers.SAXParser.parse(Unknown Source)\n\torg.apache.jasper.compiler.JspDocumentParser.parse(JspDocumentParser.java:195)\n\torg.apache.jasper.compiler.ParserController.parse(ParserController.java:223)\n\torg.apache.jasper.compiler.ParserController.parse(ParserController.java:146)\n\torg.apache.jasper.compiler.ParserController.parse(ParserController.java:132)\n\torg.apache.jasper.compiler.Compiler.generateJava(Compiler.java:245)\n\torg.apache.jasper.compiler.Compiler.compile(Compiler.java:453)\n\torg.apache.jasper.compiler.Compiler.compile(Compiler.java:439)\n\torg.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:555)\n\torg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:300)\n\torg.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:293)\n\torg.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\nIt works fine with TC 5.0.4This is a regression from 5.0.6, and has been fixed in the head branch.  To\ngetaround it, either use 5.0.6 or the nightly build.*** Bug 22535 has been marked as a duplicate of this bug. ***',?,BUG
22478,'Ant manager deploy causing webapp to initialize twice','Tomcat 5',Webapps:Administration,hoju,dev,'If have my webapp sitting in CATALINA_HOME/webapps and my context configuration\nfile in conf/Catalina/localhost before Tomcat starts, initialization is done\nonce.  If, however, I do a deploy using the Ant manager deploy task,\ninitialization is performed twice.  Actually, this happens more clearly after an\nAnt manager deploy + html manager undeploy + Ant manager deploy.  The first time\nit is deployed, I get an exception from digester which seems to prevent the\nduplicate initialization.  I\'ll be attaching text file showing the log output\nfrom stdout.log (I run Tomcat as a WinXP service) and localhost_log that shows\nthe stack traces.\n\nLike I said, it is more clear the duplicate initialization is happening after a\ndeploy + undeploy + deploy.  Here is what it looks like beginning with the\nundeploy...\n\n\n3124297 [http8080-Processor25] INFO  org.apache.catalina.core.ContainerBase  -\nRemoving web application at context path /Barracuda\n3125031 [http8080-Processor25] INFO  org.apache.catalina.logger.LoggerBase  -\nunregistering logger Catalina:type=Logger,path=/Barracuda,host=localhost\n3192547 [http8080-Processor24] INFO \norg.apache.catalina.core.StandardHostDeployer  - Installing web application from\nConfig file URL\nfile:/D:/Java/Apache/Jakarta/tomcat-5.0.7/conf/Catalina/localhost/Barracuda.xml\n3192547 [http8080-Processor24] INFO \norg.apache.catalina.core.StandardHostDeployer  - Installing web application from\nURL jar:file:/D:/Java/Apache/Jakarta/tomcat-5.0.7/webapps/Barracuda.war!/\nAug 15, 2003 8:33:25 PM org.apache.catalina.loader.WebappClassLoader\nfindResourceInternal\nINFO: Lifecycle error : CL stopped\njava.lang.IncompatibleClassChangeError:\norg.apache.xerces.jaxp.DocumentBuilderFactoryImpl\n\tat\norg.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1251)\n\tat\norg.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1211)\n\tat javax.xml.parsers.FactoryFinder.newInstance(FactoryFinder.java:93)\n\tat javax.xml.parsers.FactoryFinder.find(FactoryFinder.java:174)\n\tat\njavax.xml.parsers.DocumentBuilderFactory.newInstance(DocumentBuilderFactory.java:93)\n\tat org.apache.log4j.xml.DOMConfigurator.doConfigure(DOMConfigurator.java:644)\n\tat org.apache.log4j.xml.DOMConfigurator.doConfigure(DOMConfigurator.java:616)\n\tat org.apache.log4j.xml.DOMConfigurator.doConfigure(DOMConfigurator.java:584)\n\tat org.apache.log4j.xml.XMLWatchdog.doOnChange(DOMConfigurator.java:815)\n\tat org.apache.log4j.helpers.FileWatchdog.checkAndConfigure(FileWatchdog.java:80)\n\tat org.apache.log4j.helpers.FileWatchdog.run(FileWatchdog.java:99)\nAug 15, 2003 8:33:26 PM org.apache.catalina.loader.WebappClassLoader\nfindResourceInternal\nINFO: Lifecycle error : CL stopped\njava.lang.IncompatibleClassChangeError:\norg.apache.xerces.jaxp.DocumentBuilderFactoryImpl\n\tat\norg.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1251)\n\tat\norg.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1211)\n\tat javax.xml.parsers.FactoryFinder.newInstance(FactoryFinder.java:93)\n\tat javax.xml.parsers.FactoryFinder.find(FactoryFinder.java:174)\n\tat\njavax.xml.parsers.DocumentBuilderFactory.newInstance(DocumentBuilderFactory.java:93)\n\tat org.apache.log4j.xml.DOMConfigurator.doConfigure(DOMConfigurator.java:644)\n\tat org.apache.log4j.xml.DOMConfigurator.doConfigure(DOMConfigurator.java:616)\n\tat org.apache.log4j.xml.DOMConfigurator.doConfigure(DOMConfigurator.java:584)\n\tat org.apache.log4j.xml.XMLWatchdog.doOnChange(DOMConfigurator.java:815)\n\tat org.apache.log4j.helpers.FileWatchdog.checkAndConfigure(FileWatchdog.java:80)\n\tat org.apache.log4j.helpers.FileWatchdog.run(FileWatchdog.java:99)\n\n[webapp specific initialization logging happens here.....]\n\n3216172 [ContainerBackgroundProcessor[StandardEngine[Catalina]]] INFO \norg.apache.catalina.startup.HostConfig  - restartContext(/Barracuda)\n3216672 [ContainerBackgroundProcessor[StandardEngine[Catalina]]] INFO \norg.apache.catalina.logger.LoggerBase  - unregistering logger\nCatalina:type=Logger,path=/Barracuda,host=localhost\n\n[webapp specific initialization logging happens...again...here.....]\n\n\nNote that after this happens, the webapp actually works fine.  It most certainly\nshouldn\'t be initializing twice, though.  I won\'t speculate as to the cause. \nI\'ll wait for some more inciteful interpretation from Remy, Bill Barker, or\nsomeone else more attuned to the workings of the Tomcat internals.\n\nJakeCreated attachment 7843\nlog of Digester exception upon first Ant manager deploymentThe bug, if there\'s one, is maybe that your context XML should be removed on\nundeploy. This works fine for me (the WAR, expanded dir, and expanded XML are\nall removed on undeploy, as long as their names match).\nAs for the \"CL stopped\" exception, well, log4j shouldn\'t have watchdog threads\nor similar stuff (or you should destroy your loggers manually when your\napplication is stopped).>The bug, if there\'s one, is maybe that your context XML should be removed on\n>undeploy. This works fine for me (the WAR, expanded dir, and expanded XML are\n>all removed on undeploy, as long as their names match).\n\nMy context configuration file (ccf) and everything else is removed just fine\nupon undeploy.  I\'ve verified this many times.  Also, Tomcat creates the ccf\nfrom the one I supply in the .war file; META-INF/context.xml.  I assume that is\nstill correct to do with Tomcat5, right?  That\'s the way Tomcat4.1.xx worked. \nIt must be right because it seems to extract it to the appropriate place and use it.\n\nBesides, given that with a virgin Tomcat server and my app never having been\ndeployed there before, I still get exceptions upon the first deploy shown in the\nstacktrace in the log file I attached.  Did you have a look at that yet?\nhttp://nagoya.apache.org/bugzilla/showattachment.cgi?attach_id=7843\n\nThis doesn\'t happen if I physically place the application there before Tomcat\nhas ever been started.  It only happens upon a manager app deployment, so I\nthink that pretty clearly implicates the manager application or some process it\nuses.\n\n>As for the \"CL stopped\" exception, well, log4j shouldn\'t have watchdog threads\n>or similar stuff (or you should destroy your loggers manually when your\n>application is stopped).\n\nI actually do manually shutdown Log4j when the application is stopped...\n\nSee for yourself here...\nhttp://cvs.apache.org/viewcvs/jakarta-log4j-sandbox/src/java/org/apache/log4j/servlet/InitContextListener.java?rev=1.7&content-type=text/vnd.viewcvs-markup\n\nHere\'s the relevant code from there...\n\npublic void contextDestroyed(ServletContextEvent sce) {\n    ServletContext context = sce.getServletContext();\n\n    cleanupLog4j(context);\n}\n\nprivate void cleanupLog4j(ServletContext context) {\n    //shutdown this webapp\'s logger repository\n    context.log(\n      \"Cleaning up Log4j resources for context: \"\n      + context.getServletContextName() + \"...\");\n    context.log(\"Shutting down all loggers and appenders...\");\n    org.apache.log4j.LogManager.shutdown();\n    context.log(\"Log4j cleaned up.\");\n}\n\nEither way, the watchdog is in the process of configuring itself at startup. \nHow is this a shutdown issue?  Additionally, although Log4j involved in the\nstack trace, it doesn\'t seem to be the cause of the issue.  These are the lines\nof significance...\n\njava.lang.IncompatibleClassChangeError:\norg.apache.xerces.jaxp.DocumentBuilderFactoryImpl\n\tat\norg.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1251)\n\nPlease explain to me how the Log4j watchdog is responsible for an\nIncompatibleClassChangeError in org.apache.xerces.jaxp.DocumentBuilderFactoryImpl?\n\nAnd then, of course, there is the issue which I don\'t believe you addressed at\nall which is the fact that the contextInitialized() in my servlet context\nlistener is running twice every time I do a deploy after an undeploy.\n\n\nI\'ll leave this bug invalid for now, but I don\'t believe that is the case.  I\ndon\'t see where I am doing anything wrong?  Tomcat should be able to deal with\nthis deployment just fine, but it isn\'t.\n\nJakeI\'ll look at the first part, but this worked fine for me when I tried it; the\nsecond part is invalid, and won\'t be resolved or looked into (this is bug 3888,\nwhich I am tired to discuss, and is invalid).\nlog4j has no buisness accessing anything from a thread outside of the control of\nthe container after the web application shutdown.Ok, I just tested with a completely fresh copy of Tomcat-4.1.27 and not only do\nI not get exceptions upon the first deploy (\nhttp://nagoya.apache.org/bugzilla/showattachment.cgi?attach_id=7843 ), future\nundeploys and deploys work perectly as well with no classloader errors or double\ninitialization.\n\nAm I not making a pretty good case that there is something wrong with Tomcat5\nand not my application if it works perfectly in a previous version of Tomcat? \nIts the same webapp, the only difference is Tomcat.\n\nReopening...\n\nJake>log4j has no buisness accessing anything from a thread outside of the control of\n>the container after the web application shutdown.\n\nLike I said before, Log4j is completely and utterly shut down.  All thread are\nstopped.  So, I agree with you about Log4j having no business continuing threads\nafter application shutdown, but it just not the case that Log4j is actually\nkeeping any open threads after application shutdown, so that argument is\ncompletely moot.\n\nJakeAs I said, I will consider the deployment bug, not the classloader errors. Do\nnot bother reopening the bug.Well, I see a log4j owned thread accessing a stopped classloader. The stack\ntrace is obvious enough. BTW, if you don\'t believe me, sorry, I don\'t care ;-)Your bug is misleading (not too surprising), but has merit: I knew about the\nextra restarts which were occurring after a manager deploy, but they have\nnothing to do with a double deployment of the webapp (what actually happens is\nthat the webapp gets deployed, then restarted right away - because of the\nweb.xml tracking code). I found a way to improve that code to avoid this\nscenario, so the issue will be fixed in 5.0.8.Remy,\n\nI\'ve tested your fix and it seems to have solved the duplicate initialization. \nI will look into how it is that Log4j seems to be accessing a stopped class\nclassloader even when I call LogManager.shutdown() in the contextDestroyed()\nmethod of my servlet context listener.  Maybe shutdown() is not doing everything\nit should be doing?  Anyway, I\'ll look into it.\n\nI am still seeing the Digester error upon initial deploy.  Here is how it looks\nnow..\n\n82437 [http8080-Processor25] INFO  org.apache.catalina.core.StandardHostDeployer\n - Processing Context configuration file URL\nfile:/D:/Java/Apache/Jakarta/tomcat-5-20030817/conf/Catalina/localhost/Barracuda.xml\n82437 [http8080-Processor25] INFO  org.apache.catalina.core.StandardHostDeployer\n - Installing web application from URL\njar:file:/D:/Java/Apache/Jakarta/tomcat-5-20030817/webapps/Barracuda.war!/\n104078 [ContainerBackgroundProcessor[StandardEngine[Catalina]]] INFO \norg.apache.catalina.core.StandardHostDeployer  - Processing Context\nconfiguration file URL\nfile:D:\\Java\\Apache\\Jakarta\\tomcat-5-20030817\\conf\\Catalina\\localhost\\Barracuda.xml\n104093 [ContainerBackgroundProcessor[StandardEngine[Catalina]]] ERROR\norg.apache.commons.digester.Digester  - End event threw exception\n\nNotice how Tomcat processes the context configuration file after the context has\nalready been installed?\n\n\nI also see the following in the log for my particular webapp after an undeploy,\nthen deploy...\n\n2003-08-17 17:48:50 createObjectName with\nStandardEngine[Catalina].StandardHost[localhost].StandardContext[/Barracuda]\n2003-08-17 17:50:35 createObjectName with\nStandardEngine[Catalina].StandardHost[localhost].StandardContext[/Barracuda]\n\nThe first line was logged at the end of an undeploy and the second at the\nbeginning of a deploy.  It seems fishy to me that it would do a\n\"createObjectName\" after an undeploy when the very same thing is done again upon\na deploy.  I don\'t know if this is significant or not.  If it isn\'t, just say so.\n\n\nJake\nI have not studied the bug report. By the looks of it it seems that it is due \nto a problem with the log4j configurator watchdog thread using a dead \nclassloader. The watchdog code in log4j 1.2.x does not have a notion of a \nlifecycle. In particular, LogManager.shutdown does not stop the watchdog thread.\nAtually, I don\'t think there is a way to stop a watchdog thread which is \ndefinetely a serious shortcoming of log4j watchdogs.\n\nPlease let me know if the above does not clarify the issue.\n\n--\nCeki',?,BUILD_SYSTEM
22494,'logVerbosityLevel not used anymore','Tomcat 5',Jasper,ecarmich,dev,'I don\'t believe Jasper\'s logVerbosityLevel initialization parameter is used \nanymore.  At least, I note the following:\n\n1) Jasper\'s logging is configurable via a log4j.properties file\n2) Changing logVerbosityLevel doesn\'t have any effect that I can see\n3) I can\'t find any reference to logVerbosityLevel in the code\n\nIf logVerbosityLevel really isn\'t used anymore, it should be taken out of \nTomcat\'s web.xml and jasper-howto.xml.\n\nI will attach a patch that implements this, and corrects some minor spelling \nmistakes in both files.Created attachment 7861\nProposed patchlogVerbosityLevel indeed seems unused -- patch done.',?,CLEANUP
22571,'NPE when using custom extends class','Tomcat 5',Jasper,william.barker,dev,'Jasper currently relies on the non-standard methods \"_jspInit\" \nand \"_jspDestroy\".  Since these methods are found nowhere in either the Servlet \nor Jsp specs, there is no reason that a custom \"extends\" class should either \nimplement them or call them.  The result is that all of the tag-pools remain un-\ninitialized, so the first access to a tag causes an NPE.\n\nInitialization is easy to solve (i.e. it could be moved to the constructor, you \ncould have a flag that is checked in _jspService, etc.).  Releasing is the hard \npart.  About all that I can see (without majorly changing the current \nimplementation) is to add a finalize method, which is just too ugly for \nwords :).\n\nThe other solution I can see would be to add code to the JSP page like:\n\n  private Tag getTag(org.apache.jasper.runtime.TagHandlerPool pool, Class tagC){\n    Tag result = null;\n    if(pool == null) {\n      try {\n        result = tagC.newInstance();\n      } catch(Exception ex) {\n      }\n    } else {\n      result = pool.get(tagC);\n    }\n    return result;\n   }\n   private void putTag(org.apache.jasper.runtime.TagHandlerPool pool, Tag tag) {\n    if( pool == null ) {\n      tag.release();\n    } else {\n      pool.reuse(tag);\n    }\n   }Created attachment 7895\nWar file that exibits the bugAll generated servlets will override javax.servlet.Servlet.init(). The overriden\ninit() first calls super.init(), followed by the initialization currently done\nin _jspInit().\n',?,BUG
22602,'Missing ant tasks for serverinfo and sessions','Tomcat 5',Webapps:Administration,vivekchopra,dev,'Ant tasks missing for two manager tasks- /serverinfo and /sessions. I have \nimplemented these, and will be uploading the files.Created attachment 7905\nImplementation of /serverinfo manager taskCreated attachment 7906\nImplementation of /sessions manager taskThanks for the patch. This will be integrated in 5.0.10.',?,BUILD_SYSTEM
22681,'AttributeNotFoundException in Host(localhost) icon','Tomcat 5',Webapps:Administration,bugzilla,dev,'When \"Host(localhost)\" icon on the Administration Tool is clicked,\njavax.management.AttributeNotFoundException is thrown each time as follows.\nI haven\'t seen this exception on TC5.0.7.\n\n[localhost_admin_log]\njavax.management.AttributeNotFoundException:  Cannot find attribute liveDeploy\n\tat org.apache.commons.modeler.BaseModelMBean.getAttribute\n(BaseModelMBean.java:306)\n\tat mx4j.server.interceptor.InvokerMBeanServerInterceptor.getAttribute\n(InvokerMBeanServerInterceptor.java:242)\n\tat mx4j.server.interceptor.DefaultMBeanServerInterceptor.getAttribute\n(DefaultMBeanServerInterceptor.java:138)\n\tat mx4j.server.interceptor.SecurityMBeanServerInterceptor.getAttribute\n(SecurityMBeanServerInterceptor.java:101)\n\tat mx4j.server.interceptor.DefaultMBeanServerInterceptor.getAttribute\n(DefaultMBeanServerInterceptor.java:138)\n\tat mx4j.server.interceptor.DefaultMBeanServerInterceptor.getAttribute\n(DefaultMBeanServerInterceptor.java:138)\n\tat \nmx4j.server.interceptor.ContextClassLoaderMBeanServerInterceptor.getAttribute\n(ContextClassLoaderMBeanServerInterceptor.java:198)\n\tat mx4j.server.MBeanServerImpl.getAttribute(MBeanServerImpl.java:1237)\n\tat org.apache.webapp.admin.host.EditHostAction.perform\n(EditHostAction.java:213)\n\tat org.apache.struts.action.Action.execute(Action.java:420)\n\tat org.apache.struts.action.RequestProcessor.processActionPerform\n(RequestProcessor.java:484)\n\tat org.apache.struts.action.RequestProcessor.process\n(RequestProcessor.java:274)\n\tat org.apache.struts.action.ActionServlet.process\n(ActionServlet.java:1482)\n\tat org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:743)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:286)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:206)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:258)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:564)\n\tat org.apache.catalina.core.StandardContextValve.invokeInternal\n(StandardContextValve.java:256)\n\tat org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:210)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke\n(AuthenticatorBase.java:577)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:564)\n\tat org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:196)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:175)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:564)\n\tat org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:156)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:564)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:974)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service\n(CoyoteAdapter.java:207)\n\tat org.apache.coyote.http11.Http11Processor.process\n(Http11Processor.java:647)\n\tat \norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio\nn(Http11Protocol.java:497)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java:575)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:649)\n\tat java.lang.Thread.run(Thread.java:536)The host properties are updated in admin.  The fix will be available in the \nnext release.There are also similar updates needed to the Connector element (more things\nchanged on that one).',?,BUG
22691,'TldConfig.getGlobalJarPath() throws an IOException which is not really catched','Tomcat 5',Catalina,thorsten_schmidt,dev,'For a special integration support I extended the commonLoader in \norg.apache.catalina.startup.Bootstrap with a specia parent class loader \n(normaly the system classloader is used). In this case \norg.apache.catalina.startup.TldConfig.getGlobalJarPath() will throw an \nIOException at getCononicalFile() (take a look at the JavaDoc of \nFile.getCanoncialFile()) which is never really catched. To fix this problem I \nwrapped this part in a try-catch-expression locally.This will be finxed in 5.0.10.',?,BUG
22698,'org.apache.catalina.realm.RealmBase missing main()','Tomcat 5',Catalina,mkearney,dev,'In the \"Digested Passwords\" section of the documentation is states:\n    * If you want to execute a command line utility to calculate the digested\npassword, simply execute\n\njava org.apache.catalina.realm.RealmBase \\\n    -a {algorithm} {cleartext-password}\n\n      and the digested version of this cleartext password will be returned to\nstandard output.\n\nHowever, RealmBase no longer has a main() method as was the case in Tomcat 3 and 4.\n\nThe proposed fix would be simply to copy the code from the previous release into\nthe release 5 codebase but I wouldn\'t presume to do so.   Thanks.The fix will be in 5.0.10.',?,BUG
22833,'Generated SMAP looks wrong','Tomcat 5',Jasper,marcus.nylander,dev,'In some cases the genereted SMAP seems wrong. If one looks at the JSR-45 and \ncompare it with the example below the SMAP seems wrong.\n\nThe Example is the same as in JSR-45. \n\nFile: Hello.jsp\n\n<HTML>\n<HEAD>\n<TITLE>Hello Example</TITLE>\n</HEAD>\n<BODY>\n<\%@ include file=\"greeting.jsp\" \%>\n</BODY>\n</HTML> \n\nFile 2: greeting.jsp\n\nHello There!<P>\nGoodbye on <\%= new java.util.Date() \%>\n\n\nThe output SMAP becomes:\n\nHello_jsp.java\nJSP\n*S JSP\n*F\n+ 0 /Hello.jsp\nHello.jsp\n+ 1 /greeting.jsp\ngreeting.jsp\n*L\n1,2:45   \n3:47,2\n4,2:49\n1#1:51,2\n2:52,2      <= seems wrong.. Should\'t it be 2#1:52,2\n6#0,3:54    \n*E\n\nIn all examples in JSR-45 they always use the file-id in the line info, \nshouldn\'t Jasper do the same? Like the following\n1#0,2:45   \n3#0:47,2\n4#0,2:49\n1#1:51,2\n2#1:52,2      \n6#0,3:54\n\n\nIt also looks like SMAP for JSP-declarations does not work. If I add a \n<\%!\n\tvoid test() {\n\t\tSystem.out.print(\"Hello there..\");\n\t}\n\%>\n\nfirst to Hello.jsp. The first SMAP-line mapping the declaration becomes 2,4:1 \nwhen should be 2,4:9 looking at the generated jsp.\n\n\n\n\nFirst example of generated JSP:\n\npackage org.apache.jsp;\n\nimport javax.servlet.*;\nimport javax.servlet.http.*;\nimport javax.servlet.jsp.*;\n\npublic final class Hello_jsp extends org.apache.jasper.runtime.HttpJspBase\n    implements org.apache.jasper.runtime.JspSourceDependent {\n\n  private static java.util.Vector _jspx_dependants;\n\n  static {\n    _jspx_dependants = new java.util.Vector(1);\n    _jspx_dependants.add(\"/greeting.jsp\");\n  }\n\n  public java.util.List getDependants() {\n    return _jspx_dependants;\n  }\n\n  public void _jspService(HttpServletRequest request, HttpServletResponse \nresponse)\n        throws java.io.IOException, ServletException {\n\n    JspFactory _jspxFactory = null;\n    PageContext pageContext = null;\n    HttpSession session = null;\n    ServletContext application = null;\n    ServletConfig config = null;\n    JspWriter out = null;\n    Object page = this;\n    JspWriter _jspx_out = null;\n\n\n    try {\n      _jspxFactory = JspFactory.getDefaultFactory();\n      response.setContentType(\"text/html\");\n      pageContext = _jspxFactory.getPageContext(this, request, response,\n      \t\t\tnull, true, 8192, true);\n      application = pageContext.getServletContext();\n      config = pageContext.getServletConfig();\n      session = pageContext.getSession();\n      out = pageContext.getOut();\n      _jspx_out = out;\n\n      out.write(\"<HTML>\\r\\n\");\n      out.write(\"<HEAD>\\r\\n\");\n      out.write(\"<TITLE>Hello Example\");\n      out.write(\"</TITLE>\\r\\n\");\n      out.write(\"</HEAD>\\r\\n\");\n      out.write(\"<BODY>\\r\\n\");\n      out.write(\"Hello There!\");\n      out.write(\"<P>\\r\\nGoodbye on \");\n      out.write(String.valueOf( new java.util.Date() ));\n      out.write(\"\\r\\n\");\n      out.write(\"</BODY>\\r\\n\");\n      out.write(\"</HTML>  \");\n    } catch (Throwable t) {\n      if (!(t instanceof javax.servlet.jsp.SkipPageException)){\n        out = _jspx_out;\n        if (out != null && out.getBufferSize() != 0)\n          out.clearBuffer();\n        if (pageContext != null) pageContext.handlePageException(t);\n      }\n    } finally {\n      if (_jspxFactory != null) _jspxFactory.releasePageContext(pageContext);\n    }\n  }\n}The JSR-45 spec says:\n\n\"Each LineInfo has the form: \'InputStartLine # LineFileID , RepeatCount : \nOutputStartLine , OutputLineIncrement\' where all but \'InputStartLine : \nOutputStartLine\' are optional.... If absent LineFileID defaults to the most \nrecent value (initially zero).\"\n\nIn other words LineFileID is only required when it differs from the LineFileID \nof the previous LineInfo.  To the best of my knowledge Jasper is consistent \nwith that.\n\nYou\'re absolutely right that Jasper should SMAP JSP declarations, but doesn\'t.Declaration are now properly mapped.  Thanks for reporting.',?,BUG
22848,'[PATCH] Fix typos/grammar in changelog.html','Tomcat 5',Webapps:Documentation,yannc76,dev,'Various minor grammar/spelling fixes, no content changes.Created attachment 8013\nFix some typos in changelog.htmlI have applied you patch. Thanks.Adding small new patch for 5.0.10 to this ticket.Created attachment 8087\nFix some typos in changelog.html for paragraph \"5.0.10\"Thanks.',?,DOCUMENTATION
22857,'Spaces in Tomcat install directory name causes CGI failure','Tomcat 5',Servlets:CGI,gordon.degrandis,dev,'If the Tomcat default install directory is used on Windows (NT/W2k/XP) the \ndefault name causes CGI scripts not to function. \nThe default install name for Tomcat is:\n<drive>:\\Program Files\\Apache Tomcat 4.0\\\nIn our case the install name is:\n<drive>:\\soft\\AR2\\Apache Tomcat 4.0\\\n\nIf a CGI script that uses Perl is used within this installation the result from \nthe CGI is output on the web page. The result on the web page is:\nCan\'t open perl script \"<drive>:\\soft\\AR2\\Apache\": No such file or directory\n\nThe message contains the installation directory name for Tomcat up to the first \nblank character. \nThe CGI path name once evaluated by Tomcat is:\n<drive>:\\soft\\AR2\\Apache Tomcat 4.0\\webapps\\adaptive\\WEB-INF\\Cgi\\exp.cgi\n\nThere does not seem to be a way to change this behaviour in the standard Tomcat \nproduct.\n\nOther information is available on request. I have the CGI script and all the \nlog files.\n\nThank youConfirmed. This is also an issue with TC5.\n\nThe problem is that the space character is used to delimit parameters passed \nto the perl interpreter. If the path to the perl script includes a space then \nthe interpreter assumes the path is shorter than it really is.\n\nI have posted proposed patches for TC4 and TC5 that work with Windows XP and \nshould work with NT and 2000 to the tomcat-dev list.The patch has been applied to CVS for TC4 and TC5. It will be available in the \nnext release.',?,BUG
22858,'CGI scripts without a file suffix causes Error=193','Tomcat 5',Servlets:CGI,gordon.degrandis,dev,'If you create or use a Perl CGI script that does not use a file suffix \n(IE. \".cgi\") then the CGI servlet within Tomcat generates error=193. \n\nThe solution is to rename the CGI with a \".cgi\" file extension. Making this \nchange though requires that all HTML pages that refer to the CGI must be \nchanged to reference the new CGI file name. \n\nThe CGI script without a file extension works correctly in Apache.\n\nThe path references have been modified.\nThe error log output is:\nIn the log file localhost_log.<date>.txt:\n2003-08-14 11:42:23 cgi: findCGI: path=/xml-mg-search, <drive>:\\soft\\AR2\\Apache \nTomcat 4.0\\webapps\\ROOT\\WEB-INF/cgi\n2003-08-14 11:42:23 cgi: findCGI: currentLoc=<drive>:\\soft\\AR2\\Apache Tomcat 4.0\n\\webapps\\ROOT\\WEB-INF\\cgi\n2003-08-14 11:42:23 cgi: findCGI: currentLoc=<drive>:\\soft\\AR2\\Apache Tomcat 4.0\n\\webapps\\ROOT\\WEB-INF\\cgi\n2003-08-14 11:42:23 cgi: findCGI: FOUND cgi at <Drive>:\\soft\\AR2\\Apache Tomcat \n4.0\\webapps\\ROOT\\WEB-INF\\cgi\\xml-mg-search\n2003-08-14 11:42:23 cgi: findCGI calc: name=xml-mg-search, \npath=<Drive>:\\soft\\AR2\\Apache Tomcat 4.0\\webapps\\ROOT\\WEB-INF\\cgi\\xml-mg-\nsearch, scriptname=/cgi-bin\\xml-mg-search, cginame=\\xml-mg-search\n2003-08-14 11:42:23 cgi: runCGI(envp=[{HTTP_USER_AGENT=Java1.3.1_05, \nREQUEST_METHOD=GET, AUTH_TYPE=, SERVER_NAME=localhost, SERVER_SOFTWARE=TOMCAT, \nHTTP_HOST=localhost, GATEWAY_INTERFACE=CGI/1.1, \nX_TOMCAT_SCRIPT_PATH=<Drive>:\\soft\\AR2\\Apache Tomcat 4.0\\webapps\\ROOT\\WEB-\nINF\\cgi\\xml-mg-search, REMOTE_ADDR=127.0.0.1, SERVER_PROTOCOL=HTTP/1.1, \nPATH_INFO=, REMOTE_HOST=localhost, QUERY_STRING=cgi=http\%3A\%2F\%2Flocalhost\%\n2Fcgi-bin\%2Fxml-mg-search&sid=0&app=\%2Fadaptive&laf=\%\n2FBBL&xsl=search.xsl&clslist=&vc=Gu006UREP40d013CodingSchemess003RSMr010RSM_Obje\nct\%\n3AV000002aa3d&query=visa&y=0&x=0&pa=Gu006UREP40d013CodingSchemess003RSMr010RSM_O\nbject\%3AV000002aa69&attrlist=&rid=CodingSchemes&bs=10&mgdb=CodingSchemes, \nHTTP_CONNECTION=keep-alive, SERVER_PORT=80, CONTENT_TYPE=, CONTENT_LENGTH=, \nHTTP_ACCEPT=text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2, \nSCRIPT_NAME=/cgi-bin\\xml-mg-search, REMOTE_USER=, REMOTE_IDENT=}], \ncommand=<Drive>:\\soft\\AR2\\Apache Tomcat 4.0\\webapps\\ROOT\\WEB-INF\\cgi\\xml-mg-\nsearch)\n2003-08-14 11:42:23 StandardWrapperValve[cgi]: Servlet.service() for servlet \ncgi threw exception\njava.io.IOException: CreateProcess: <Drive>:\\soft\\AR2\\Apache Tomcat 4.0\n\\webapps\\ROOT\\WEB-INF\\cgi\\xml-mg-search cgi=http\%253A\%252F\%252Flocalhost\%\n252Fcgi-bin\%252Fxml-mg-search sid=0 app=\%252Fadaptive laf=\%252FBBL \nxsl=search.xsl clslist= vc=Gu006UREP40d013CodingSchemess003RSMr010RSM_Object\%\n253AV000002aa3d query=visa y=0 x=0 \npa=Gu006UREP40d013CodingSchemess003RSMr010RSM_Object\%253AV000002aa69 attrlist= \nrid=CodingSchemes bs=10 mgdb=CodingSchemes error=193\n\tat java.lang.Win32Process.create(Native Method)\n\tat java.lang.Win32Process.<init>(Win32Process.java:61)\n\tat java.lang.Runtime.execInternal(Native Method)\n\tat java.lang.Runtime.exec(Runtime.java:546)\n\tat java.lang.Runtime.exec(Runtime.java:413)\n\tat org.apache.catalina.servlets.CGIServlet$CGIRunner.run\n(CGIServlet.java:1585)\n\tat org.apache.catalina.servlets.CGIServlet.doGet(CGIServlet.java:635)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:740)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:247)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:243)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:190)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2347)\n\tat org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:180)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.valves.ErrorDispatcherValve.invoke\n(ErrorDispatcherValve.java:170)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:170)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n\tat org.apache.catalina.valves.AccessLogValve.invoke\n(AccessLogValve.java:468)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:174)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.connector.http.HttpProcessor.process\n(HttpProcessor.java:1027)\n\tat org.apache.catalina.connector.http.HttpProcessor.run\n(HttpProcessor.java:1125)\n\tat java.lang.Thread.run(Thread.java:479)Confirmed. This is also an issue with TC5.\n\nThe CGI servlet includes a test for \".pl\" and \".cgi\". Any other suffix \n(including none) will fail.\n\nI have posted patches for TC4 and TC5 to the tomcat-dev list. The patches are \ntested with XP and should work with NT/2000.The patch has been applied to CVS for TC4 and TC5. It will be available in the \nnext release.',?,BUG
22867,'Tag handlers can\'t be inner/nested classes','Tomcat 5',Jasper,gthb,dev,'When I try to use a nested class such as com.foo.MyTag$Bar as a tag handler,\nthe JSP-generated class fails compilation due to the use of names containing $\nin source code. It says something like \"perchance you meant com.foo.MyTag.Bar\".\nWhen I try replacing the $ with a . in the TLD file, it gives me this:\n\no.a.j.JasperException: /headlines.jsp(11,2) Unable to load class generator\n  at o.a.j.compiler.DefaultErrorHandler.jspError(DefaultErrorHandler.java:94)\n  at o.a.j.compiler.ErrorDispatcher.dispatch(ErrorDispatcher.java:428)\n  at o.a.j.compiler.ErrorDispatcher.jspError(ErrorDispatcher.java:219)\n  at o.a.j.compiler.Parser.parseCustomTag(Parser.java:712)\n  at o.a.j.compiler.Parser.parseElements(Parser.java:804)\n  ...\n\n(where I replaced org.apache.jasper with o.a.j to make the stack trace readable\nin Bugzilla)\n\nMy exact same classes are working fine as tag handlers in the version of Tomcat\nintegrated into Borland Enterprise Server 5.2 (don\'t know what version that is,\nnor which modifications they may have made, but it\'s certainly somewhat older\nthan Tomcat 4.1.24), but I\'m seeing this failure in Tomcat 4.1.24 integrated\ninto JBoss 3.2.1. Thus I do not know for sure whether this problem is a result\nof a classloader bug introduced by the JBoss integration (or one fixed by the\nBES integration) or simply a Tomcat/Jasper bug that cropped up sometime between\nthese two versions.\n\nI also don\'t know whether this should go to the Jasper component or the Jasper2\ncomponent (no version info in the jasper-compiler.jar and jasper-runtime.jar\nmanifest files)It\'s Jasper2, apparently.\n\nThe second error message I got is presumably from this code in\norg.apache.jasper.compiler.Parser:\n\ntry {\n    tagHandlerClass\n\t= ctxt.getClassLoader().loadClass(tagInfo.getTagClassName());\n} catch (Exception e) {\n    err.jspError(start, \"jsp.error.unable.loadclass\", shortTagName,\n\t\t prefix);\n}\n\nso \"generator\" is just the name of my custom tag (which explains why I didn\'t\nfind a single hit for \"unable to load class generator\" in Google or the Apache\nBugzilla :) ... and it makes perfect sense that the classloader didn\'t find\nthis nested class by the nonstandard name syntax OuterClass.NestedClass\n(instead of the standard OuterClass$NestedClass syntax).\n\nSo the point remains that a nested class breaks JSP compilation if given with\nthe $ syntax, and breaks classloader lookup if given with the . syntax. So\nnested classes are not usable as tag handlers, at least as of version 4.1.24.\n\nThe root of this problem is that nested classes in Java have different names\nat compile time and at runtime. The fix is presumably to add logic to the JSP\nsource file generation, replacing all dollar signs in tag-handler classnames\nwith dots.\nYou\'re not giving enough details on the original error. Obviously declaring\nOuterClass.NestedClass in the TLD is wrong: the actual classname is\nOuterClass$NestedClass. So you shouldn\'t do that, that won\'t get you anywhere.Created attachment 8031\nLog snippet showing the error message from JSP compilationI\'ve attached a logfile taken from JBoss server.log, showing the error.\n\nI do know that A.B is not the (runtime) classname of the class :) but it is a\nvalid compile-time name (and A$B isn\'t). My JSP page was breaking at compile\ntime because of the A$B syntax in source code. So it wasn\'t a very dumb attempt.\nThe bug is with the code generator (I assume doing a replace(\'$\', \'.\') on the\ntag classname would solve the problem there; I can\'t see any side effect), as\nthe error log indicates.Even though this bug\'s product/version designation has been changed to Tomcat5,\nit is still present in the Tomcat 4.1 branch, and should be fixed there as well\n... assuming there are any more releases on that branch.\nThis probably needs clarification from the spec.\n\nBy doing a replace(\'$\', \'.\'), we are assuming that any class name containing a\n\'$\' is reference to an inner class, but this is not necessarily so.  I can\ncertainly define $foo to be my (non-inner) tag handler class.\n\nYou certainly can, but if you did that, you would pretty much have only yourself\nto blame when tools give you a hard time about it, because of this clause in the\nJava Language Specification (Section 3.8, Java Identifiers):\n\n    The Java letters include uppercase and lowercase ASCII Latin letters A-Z\n    (\\u0041-\\u005a), and a-z (\\u0061-\\u007a), and, for historical reasons,\n    the ASCII underscore (_, or \\u005f) and dollar sign ($, or \\u0024). The $\n    character should be used only in mechanically generated source code or,\n    rarely, to access preexisting names on legacy systems.\n    \nhttp://java.sun.com/docs/books/jls/second_edition/html/lexical.doc.html#40625\n\nGiven that, I think it would be fair to assume that \'$\' means a nested class\n... especially since doing that repairs a common use case that is currently\nbroken, perhaps at the cost of breaking an arcane one which is probably *also*\ncurrently broken :)\n\nBut this section of the JLS does beg the question: why is the JSP compiler\nrejecting an identifier with a \'$\' in it? Since it is legal (apparently in\nsource code as well -- I thought it wasn\'t), there shouldn\'t be a problem\nresolving a classname like A$B when there is an import declaration for A\nand A contains a static nested class called B -- should there? Is Sun\'s\njavac breaking the JLS by rejecting this?\nYes, apparently it is breaking it, and not by accident.\n\nhttp://developer.java.sun.com/developer/bugParade/bugs/4887861.html says:\n\n    jdk 1.4.2 does not allow the use of \"$\" to refer to inner classes anymore.\n    We have fixed the code generator to address this.\n\nhttp://developer.java.sun.com/developer/bugParade/bugs/4894381.html says:\n\n    JDK 1.4.2 does not allow to generate field type for setters and getters\n    for the inner classes as user-defined serializable CMP field types with\n    \'$\' as returned from getClass().getName(). Added code that replaces \'$\'\n    with \'.\' for the user-defined serializable CMP field types (blob but not\n    byte[]).\n\nSo apparently they have made this decision consciously in JDK 1.4.2, even\nthough it seems to contradict the JLS.\n\nSun\'s own workaround in Sun ONE app server was to replace \'$\' with \'.\' ...\nI would move for Tomcat to do the same.\nAh, I\'m probably wrong there ... the JLS does allow identifiers to contain \'$\',\nand javac still allows that. But javac no longer allows you to work with the\nassumption that a compiled nested class B in a top-level class A will be called\nA$B ... and the JLS never allowed us to make that assumption in the first place.\n\nSo I shouldn\'t be attempting to refer to this class with the A$B syntax. What,\nthen, is the correct way to refer to it? Must I use A.B syntax? I guess so,\naccording to JLS Section 6.7, Fully Qualified Names and Canonical Names:\n\n    A member class or member interface M of another class C has a fully\n    qualified name if and only if C has a fully qualified name. In that\n    case, the fully qualified name of M consists of the fully qualified\n    name of C, followed by \".\", followed by the simple name of M.\n\nBut presumably the only bug here is that using this correct A.B syntax is\nfailing with the abovementioned error: \"Unable to load class generator\"\n(where \"generator\" is just the tagname, which is placed in this error\nmessage instead of the classname registered for that tag, probably by\nmistake -- I guess that\'s a little \"extra bug\" here :) )\nPersonally, I would choose to do a replace \'$\' -> \'.\' in the generated source. I\ndon\'t see anyone willingly using \'$\' in a tagfile classname, except if it\'s an\ninner class ;-)Yeah, I also prefer binary names (\"outter$inner\") instead of canonical names\n(\"outter.inner\").  However, the J2EE folks still have not made a offical\ndecision yet.\n\nThere is simple algirithm that can let one compute the canonical name from a\nClass object, without the restriction that the top-level class name not\ncontinaing \'$\'.  The following is based on an algorithm by Mark Roth, the JSP\nspec lead:\n\nString getCanonicalName(Class c) {\n\n    Class outer = c.getDeclaringClass(c);\n    if (outer == null) {\n        return c.getName();\n    } else {\n        String innerName = c.getName().substring(outer.getName().length()+1);\n        return getCanonicalName(outer) + \".\" + innerName; \n    }\n}\n\nThis is slightly more compilicated than replacing \'$\' with \'.\', but it covers\nall cases.The decision is to use binary names, e.g. Outer$Inner.  I have fixed Jasper in\nTomcat 5 to accept that.  Let me know if it does not work for you.Can someone clarify what will happen now.  Will <tagclass>A$B</tagclass> be \nconverted to A.B in the generated .java file (if not, then javac 1.4.2+ will \nfail)?  Also, will this fix be in Tomcat 4.x branch?Sorry, wrong url...',?,OTHER
22986,'Web apps with context XML file don\'t start if CATALINA_BASE is set and absolute path is used for appBase','Tomcat 5',Catalina,radim.kubacki,dev,'I\'d like to run my own instance of Tomcat and use admin & manager apps. To avoid\ncoying of these apps I tried to setup CATALINA_BASE dir with conf, logs, work,\nand temp dirs and set appBase to $CATALINA_HOME/webapps (the actual path - not\nwith the variable). This works well on Linux but fails on WinXP with following\nexception:\njava.io.IOException: The filename, directory name, or volume label syntax is\nincorrect\n\tat org.apache.commons.digester.Digester.createSAXException(Digester.java:2540)\n\tat org.apache.commons.digester.Digester.createSAXException(Digester.java:2566)\n\tat org.apache.commons.digester.Digester.startElement(Digester.java:1276)\n\tat org.apache.xerces.parsers.AbstractSAXParser.startElement(Unknown Source)\n\tat org.apache.xerces.impl.dtd.XMLDTDValidator.startElement(Unknown Source)\n\tat\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanStartElement(Unknown\nSource)\n\tat\norg.apache.xerces.impl.XMLDocumentScannerImpl$ContentDispatcher.scanRootElementHook(Unknown\nSource)\n\tat\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(Unknown\nSource)\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown\nSource)\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n\tat org.apache.xerces.parsers.DTDConfiguration.parse(Unknown Source)\n\tat org.apache.xerces.parsers.XMLParser.parse(Unknown Source)\n\tat org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)\n\tat org.apache.commons.digester.Digester.parse(Digester.java:1567)\n\tat\norg.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:515)\n\tat org.apache.catalina.core.StandardHost.install(StandardHost.java:866)\n\tat org.apache.catalina.startup.HostConfig.deployDescriptors(HostConfig.java:529)\n\tat org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:474)\n\tat org.apache.catalina.startup.HostConfig.start(HostConfig.java:1008)\n\tat org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:399)\n\tat\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1135)\n\tat org.apache.catalina.core.StandardHost.start(StandardHost.java:792)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1127)\n\tat org.apache.catalina.core.StandardEngine.start(StandardEngine.java:502)\n\tat org.apache.catalina.core.StandardService.start(StandardService.java:519)\n\tat org.apache.catalina.core.StandardServer.start(StandardServer.java:2311)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:578)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\nthe problem is that \nnew File(<anything>,\n\"D:\\\\path\\\\to\\\\my\\\\catalina_home\\\\webapps\").getCannonicalFile()) always throws\nan exception. More accurately it fails when the child argument is absolute path.This is an obvious mistake in SetDocBaseRule. A few lines after that bad\ncanonicalization, there was the same call, with the right isAbsolute check. This\nis now fixed.Confirmed that it is OK (tested with 5.0.12).',?,BUG
22995,'[PATCH] add a new item to faq','Tomcat 5',Catalina,tagunov,dev,'--- connectors.orig\t2003-07-11 14:57:20.000000000 +0400\n+++ connectors.xml\t2003-09-08 \n19:32:04.000000000 +0400\n@@ -122,6 +122,13 @@\n      what\'s wrong?\n       </a>\n     </li>\n+    <li>\n+      <a \nhref=\"#generated\">\n+      Is there any way to control the content of automatically generated \n+      \n<code>mod_jk.conf-auto</code>? I need my own specific commands added\n+      to it.\n+      </a>\n+    \n</li>\n   </ul>\n </p>\n </section>\n@@ -288,10 +295,19 @@\n     </a>\n   </answer>\n \n-\n-\n-\n-\n+  \n<question>\n+    <a name=\"generated\">\n+    Is there any way to control the content of automatically \ngenerated \n+    <code>mod_jk.conf-auto</code>? I need my own specific commands added\n+    to \nit.\n+    </a>\n+  </question>\n+  <answer>\n+    There really is no need to. Just copy the \nautomatically generated\n+    <code>mod_jk.conf-auto</code> and edit it manually to your \npreference.\n+    None of production tomcat installations really use <code>mod_jk.conf-\nauto</code>\n+    as it is.\n+  </answer>\n </section>Created attachment 8100\nsame patch as an attachmentPatch made. Thanks!',?,RFE
23290,'Documentation Typo','Tomcat 5',Webapps:Documentation,ta_takaha,dev,'In tomcat-docs/building.xml, \n\"Ealier releases would also work, ...\"\nshould be\n\"Earlier releases would also work, ...\"fixed',?,DOCUMENTATION
23312,'Bug in setclasspath.sh startup script','Tomcat 5',Unknown,amoffet,dev,'Changes were made to introduce specialized behavior for os400.  In catalina.sh,\nthe variable os400 is set to either \"true\" or \"false\".  Thereafter, tests are\nmade in this fashion:\n\nif $os400; then\n\nThe same variable is also used in setclasspath.sh.  However, the test there is\n\nif [ ! \"$os400\" ]; then\n\nwhich will always evaluate to false, given that the variable is set.\n\nThe setclasspath.sh script can be modified to correct this faulty behavior by \nusing this form instead:\n\nif ! \"$os400\"; then\n\nAt the moment this problem prevents a user from starting Tomcat in debug mode.The \'if ! \"$os400\"; then\' breaks on other OS\'s (solaris?) which was why this was\nmade the current way. \n\nAny crossplatform *nix gurus know the correct syntax to keep sh on all os\'s happy?Maybe test explicitly for \"false\"?\n\nif [ \"$os400\" = \"false\" ]; then\n\nThis depends on having the \'test\' utility (which \'[\' is an alias for), however, but I guess that\'s \ncommon enough.\nFixed for 5.0.13',?,BUG
23344,'catalina.properties don\'t allow to add one jar file','Tomcat 5',Catalina,dario.bonino,dev,'My directory \"/X\" contains 4 jar files:\n- /X/jdbcOracle.jar\n- /X/jdbcMySQL.jar\n- /X/Xerces.jar\n- /X/Xalan.jar\n\nI updated shared.loader in catalina.properties (or common.loader, it\'s the same)\nvalue to see jdbc driver:\n\n- shared.loader=...default...,/X/jdbcOracle.jar,/X/jdbcMySQL.jar\n  => ClassNotFoundException: oracle.jdbc.driver.OracleDriver\n\n- shared.loader=...default...,/X/*.jar\n  => OK!This sounds reasonable. Can you submit a tested fix ?I\'ve added the possibility to add URLs to the list. This can be local or remote\nfolders, or single local or remote JARs.\nActually, you could probably use that to run Tomcat with the binary on a remote\nserver, using only the bootstrap stuff (this is similar to webstart, I guess).> This sounds reasonable. Can you submit a tested fix ?\n\nI was trying ... \nDon\'t throw the challenge and solve the problem the day after! :-)\nThanks.\n\n> Actually, you could probably use that to run Tomcat with the binary on a remote\n> server, using only the bootstrap stuff (this is similar to webstart, I guess).\n\nWe working on one huge application deployable on different application server.\nWe use Tomcat in the development environment, here we don\'t deploy anything:\nwe set tomcat classloaders to load classes from the IDE projects directories.While working on building tomcat-5.0.28 and testing web apps I came across the\nsame problem. I dived into the source code and fixed the actual problem (rather\nthan using url, eg, file:///<path>/<file>.jar). Please refer to the explanation\nbelow.\n\nWhen adding a jar file (eg, \"foo/bar.jar\") to the class loader\'s repository it\ntreats as a directory and therefore it cannot load any classes from this jar.\nThe following explains why it happens.\n\t\n--org.apache.catalina.startup.ClassLoaderFactory-- is responsible for creating\nclass loader instances. Each instance is of\norg.apache.catalina.loader.StandardClassLoader type, which in its turn extends\njava.net.URLClassLoader:\n\njava.net.URLClassLoader\n       / | \\\n         |\n         |\norg.apache.catalina.loader.StandardClassLoader\n\t\t\n\t\n--ClassLoaderFactory#createClassLoader(File unpacked[], File packed[], URL\nurls[], ClassLoader parent)-- is the actual method that creates class loaders.\nFirst argument (ie unpacked) contains jar files or directories ( that is where\nthe name \"unpacked\" comes from ). \nSecond argument (ie packed) is a directory packed with jar files\n\t\nClassLoaderFactory#createClassLoader method adds File.separator to the end of\nthe jar file path ( file.getCanonicalPath() + File.separator ) when constructing\na URL instance to represent a jar file and then adds a string representation of\na newly created URL to its list of repositories ( list.add(url.toString()) ) :\n\t\t\t-----------------------------------------------------------------------------\nif (unpacked != null) {\n  for (int i = 0; i < unpacked.length; i++)  {\n\tFile file = unpacked[i];\n\tif (!file.exists() || !file.canRead())\n\t    continue;\n\t    if (debug >= 1)\n\t         log(\"  Including directory or JAR \" \n\t                        + file.getAbsolutePath());\n\t    URL url = new URL(\"file\", null, \n\t                       file.getCanonicalPath() + File.separator);\n\t    list.add(url.toString());\n  }\n}\n\t       \n-----------------------------------------------------------------------------\n\t        \nFor instance, if \"unpacked\" argument contains \'/home/aa/lib/velocity.jar\' then a\nURL object is \'file:/home/aa/lib/velocity.jar/\' - a forward slash / (which is a\nUnix file separator) has been added to the url.\n\t\nAfter ClassLoaderFactory#createClassLoader adds all repositories to its\nrepository list it converts this list to array and constructs\nStandardClassLoader with it:\n\t\n\t\t-----------------------------------------------------------------------------\nString array[] = (String[]) list.toArray(new String[list.size()]);\nStandardClassLoader classLoader = null;\nif (parent == null)\n  classLoader = new StandardClassLoader(array);\n\t    -----------------------------------------------------------------------------\n\t    \nStandardClassLoader( String[] ) constructor converts each repository found in\nthe given array argument to a URL object:\n\t\t-----------------------------------------------------------------------------\nprotected static URL[] convert(String input[], URLStreamHandlerFactory factory) {\n  .....\n  url[i] = new URL(null, input[i], streamHandler);\n  .....\n}\n\t\t-----------------------------------------------------------------------------\n                                   \nFor instance, if the repositories array of String type contains\n\'file:/home/aa/lib/velocity.jar/\' then a URL object is\n\'file:/home/aa/lib/velocity.jar/\'. If the repository holds a path on Windows\nmachine then the URL object would have all backslashes  replaced all  with\nforward slashes ( URL object crated with new URL(null,\n\"file:I:\\lib\\velocity.jar\\\", streamHandler) would have\n\"file:I:/lib/velocity.jar/\" string representation ).\n    \nOnce StandardClassLoader( String[] ) converts repository array of a String type\ninto a URL type it calls its super constructor, which in fact is a\nURLClassLoader( URL[] ).\n    \nHowever, the contract for URLClassLoader( URL[] ) constructor indicates that\n\"Any URL that ends with a \'/\' is assumed to refer to a directory. \" and\ntherefore a jar file gets ignored by the loader.\n    \nFor instance, if the repositories array contains\n\'file:/home/aa/lib/velocity.jar/\' url object the URLClassLoader( URL[] )\nconstructor treats this url as a directory and therefore a jar file is never\nproperly loaded.\n    \nTherefore, a File.separator that got added to a jar file in\nClassLoaderFactory#createClassLoader method made it invalid because the actual\nclass loader assumes that this jar file is a directory.Created attachment 15410\nClassLoaderFactoryWithTheFixThe following illustrates the proposed solution (i\'ve also attached two files:\n\"ClassLoaderFactoryWithTheFix\" and a junit test \"ClassLoaderFactoryTest\")\n\n--ClassLoaderFactory#createClassLoader(File unpacked[], File packed[], URL\nurls[], ClassLoader parent)-- is to be modified so that it does not add\nFile.separator to the end of jar files found in the unpacked argument:\n     \n     \t-----------------------------------------------------------------------------\nif (unpacked != null) {\n  for (int i = 0; i < unpacked.length; i++)  {\n\tFile file = unpacked[i];\n\tif (!file.exists() || !file.canRead())\n\t  continue;\n\tif (debug >= 1)\n\t  log(\"  Including directory or JAR \" \n\t                        + file.getAbsolutePath());\n\t                \n\t  // THE FIX\n\t  StringBuffer filePath = new StringBuffer(file.getCanonicalPath());\n\t  if ( file.isDirectory() ) { \n\t    // Only add a file separator if a file represents a directory\n\t    filePath.append(File.separator);\n\t  }\n\t                                \n\t  URL url = new URL(\"file\", null, filePath.toString());\n\t  list.add(url.toString());\n  }\n}\t\n\t    -----------------------------------------------------------------------------Created attachment 15411\nJUnit test case for the ClassLoaderFactory fixSomeone else submitted a fix (for 5.5) that\'s simply to put file: in front of\nsingle jars, but keep *.jar as-is.  That works for me, and seems a lot simpler.\n Does it work for you as well?  BTW, the version for this bug seems to be\n5.0.12, which is really old.  Please try at least 5.0.28, but preferably 5.5.9.',?,RFE
23349,'Jakarta FAQ-o-matic link is dead.','Tomcat 5',Webapps:Documentation,ta_takaha,dev,'In introduction.html, Jakarta FAQ-o-matic link is dead.Fixed.',?,DOCUMENTATION
23373,'Servlet destroy() methods not being called at shutdown','Tomcat 5',Catalina,Dave,dev,'No servlet destroy() methods are being called at shutdown.\nThe problem is that the stopServer method in Catalina.java constructs a new \nStandardServer and the digester.parse(is); on line 423 results in a call back \nto setServer which means that when the SHUTDOWN command is sent to the server, \nit actually goes to the new !started server.Created attachment 8322\nThere are several ways to fix this. IMO this is probably the tidiest!This obviously works fine for me (I did test it again just to be sure). The\nstopServer method is run in a separate JVM, so there can\'t be any side effect ;-)\nPlease reopen if you can submit a ready to test WAR (with source for the\nservlet, so that it can be debugged if needed). Thanks.Sorry Remy. It was late last night. This happens when run with procrun \n(tomcat.exe) as a service. It runs in the same JVM. I haven\'t tested the patch \nbut it should do the trick.Bookkeeping, the previous comment looked loike an inadvertnet reopenOk. I\'ll try to be a bit more clear.\nThis is a bug. I did mean to re-open.\nWhen running TC5 as a service with procrun (tomcat.exe) it calls stopServer \nwithin the same JVM that is currently awaiting resulting in the server object \nin Catalina being replaced with one that isn\'t started and therefore when stop \nis called it is called on the wrong object.\nSorry, nothing of what you say is true. Please do not reopen the report, it is \nbogus. I wasted about 1 hour on this, but there fixes which are needed to the\nshutdown routines (which could cause what you see, because the VM could die\nbefore completing the shutdown procedure properly), so it\'s good in some ways :)Remy,\nI won\'t reopen it because you said not to, but I\'ve debugged this. How can I \nprove it to you? Look at procrun_destroy_jvm in procrun.c. It calls jni_attach \nwhich:\n    err = (*jvm)->AttachCurrentThread(jvm,\n                                      (void **)&env,\n                                      NULL);\nStepping over line 423 in Catalina.java results in a callback to setServer and \nthe Server object that stop gets called on is the same object.\nJust the fact that I can hit a break point at main in Bootstrap.java when I \ntry to stop the service proves it. Because I\'m attached to the JVM that the \nservice started.\n\nI created the service with:\nC:\\Tomcat\\Home\\bin\\tomcatw.exe //IS//TomcatDebugServer --DisplayName \"Apache \nTomcat Debug Server\" --Description \"Apache Tomcat 5.0.12 Server - \nhttp://jakarta.apache.org/tomcat/ - Debug Server\"  --\nInstall \"C:\\Tomcat\\Home\\bin\\tomcat.exe\" --\nImagePath \"C:\\Tomcat\\Home\\bin\\bootstrap.jar\" --StartupClass \norg.apache.catalina.startup.Bootstrap;main;start --ShutdownClass \norg.apache.catalina.startup.Bootstrap;main;stop --Java \nC:\\Tomcat\\J2SDK\\jre\\bin\\server\\jvm.dll --JavaOptions -server#-Xdebug#-\nXrunjdwp:transport=dt_socket,suspend=n,server=y,address=53006#-Xms512m#-\nXmx512m#-Xrs#-Dsp.log.suffix=\"_server1\"#-\nDjava.endorsed.dirs=\"C:\\Tomcat\\Home\\bin;C:\\Tomcat\\Home\\common\\endorsed\"#-\nDcatalina.base=\"C:\\Tomcat\\BaseServer1\"#-Dcatalina.home=\"C:\\Tomcat\\Home\"#-\nDjava.io.tmpdir=\"C:\\Tomcat\\BaseServer1\\temp\" --Startup manual --StdOutputFile \nC:\\Tomcat\\BaseServer1\\logs\\stdout.log --StdErrorFile C:\\Tomcat\\BaseServer1\n\\logs\\stderr.log --Arguments \"-config C:\\Tomcat\\BaseServer1\\conf\\server.xml\"\n\nMy problem is not that the JVM stops too early, it\'s that our webapp has some \ndaemon threads that are running. They don\'t get interupted because destroy \nnever gets called, therefore the service never stops.Reopening to change status.Your analysis is correct.  That is exactly what is happening.  \n\nThis is fixed now in the CVS, and should appear in 5.0.13.I couldn\'t reproduce the issue during testing with TC 5.0.12, and I couldn\'t\nfind any issues affecting the shutdown code either.\n\nThe only one is that apparently JDK 1.4 logging doesn\'t log reliably when called\nfrom a shutdown hook thread, for some reason. That made me think the proper\nshutdown didn\'t occur, but this isn\'t the case.Tested as Fixed in nightly build. Cheers.',?,BUG
23463,'Deployer ValidationTask not work! Missing Classes...','Tomcat 5',Unknown,pr,dev,'I have used client deployer bundle. \nBut compile fail with following message:\nBUILD FAILED\njava.lang.NoClassDefFoundError: org/apache/catalina/Manager\n        at org.apache.catalina.ant.ValidatorTask.execute\n(ValidatorTask.java:137)\n\n        at org.apache.tools.ant.Task.perform(Task.java:341)\n        at org.apache.tools.ant.Target.execute(Target.java:309)\n        at org.apache.tools.ant.Target.performTasks(Target.java:336)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1339)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1255)\n        at org.apache.tools.ant.Main.runBuild(Main.java:609)\n        at org.apache.tools.ant.Main.start(Main.java:196)\n        at org.apache.tools.ant.Main.main(Main.java:235)\n\nTotal time: 3 seconds\n\nOK: ContextConfig use more classes as at deployer lib exists. \nI add server/lib/catalina.jar and catalina-cluster.jar\n\nbut after this following error ocurred:\n\n\n[validator] 28.09.2003 13:32:46 org.apache.commons.digester.Digester error\n[validator] SCHWERWIEGEND: Parse Error at line 4 column 10: cvc-elt.1: Cannot \nfi\nnd the declaration of element \'web-app\'.\n[validator] org.xml.sax.SAXParseException: cvc-elt.1: Cannot find the \ndeclaratio\nn of element \'web-app\'.\n[validator]     at \norg.apache.xerces.util.ErrorHandlerWrapper.createSAXParseExce\nption(Unknown Source)\n[validator]     at org.apache.xerces.util.ErrorHandlerWrapper.error(Unknown \nSour\nce)\n[validator]     at org.apache.xerces.impl.XMLErrorReporter.reportError(Unknown \nS\nource)\n....\n\nbut the jsp translation is successful!\n\nPeterFor some unexplainable reason, the JDK tries to load this class, which is wrong\n(it is not used in any way; commenting out the contents of the\nContextConfig.managerConfig method - which is neither called nor static - fixes\nit, which proves my point).\n\nAs for the second part of the bug, well, sorry, validation doesn\'t actually work\nwith Xerces in the release (at least it doesn\'t for me; try Xerces 2.1 if you\nwant to validate with a DTD, but schema validation won\'t work). This is\nsupposedly fixed now.',?,OTHER
23525,'HttpSessionListener implementors are called to late according to Servlet Specification 2.4 Final Draft 3','Tomcat 5',' JSP API',ThorstenMoeller,dev,'The Servlet Specification 2.4 Final Draft 3 says on chapter SRV.15.1.14.1 \n(page 284 in PDF document) when the method \"sessionDestroyed\" of an \nimplementor of HttpSessionListener should be invoked:\n\npublic void sessionDestroyed(HttpSessionEvent se)\n--> Notification that a session is about to be invalidated. <--\n                                ^^^^^^^^^^^^^^^^^^^^^^^^^^\n\nThis is new and completely different comparing to the Servlet 2.3 specification\n(!) and means to me that the container first invokes \nHttpSessionListener.sessionDestroyed() and after that invalidate (destroy) the \nsession.\nAt the moment Tomcat 5 behaves like the Servlet 2.3 specification, which means \nthat the container invalidates the session and after that invoke \nHttpSessionListener.sessionDestroyed().\n\nI think Tomcat\'s behaviour must be changed according to the 2.4 specification!\n\nBtw: I found this because I implemented an HttpSessionListener which needs to \naccess the session to get an attribute stored in the session. At the moment I \nget an IllegalState exception because the container already invalidated the \nsession (Tomcat 5.0.12).\n\nSee also: http://nagoya.apache.org/eyebrowse/BrowseList?\nlistId=88&by=thread&from=503705\n\n\nRegards,\nThorstenThis is a regression. I\'ve already implemented the behaviour (see\nStandardSession v.1.6) but it seems something has changed.\n\n-- JeanfrancoisStandardSession 1.20 seems to have caused this. isValid() is used everywhere\nnow, and it returns false when the session is expiring (which seems wrong).I\'m considering this patch (which I don\'t have time to test). Jean-Francois, can\nyou test if it actually works ?\n\nRCS file:\n/home/cvs/jakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/session/StandardSession.java,v\nretrieving revision 1.22\ndiff -r1.22 StandardSession.java\n578c578\n<         if (!this.isValid || this.expiring) {\n---\n>         if (!this.isValid) {\n579a580,582\n>         }\n>         if (this.expiring) {\n>             return true;\nYes, will do it right now.\n\n-- JeanfrancoisApplied & modified Remy\'s patche. Now it works as expected.\n\nThanks,\n\n-- Jeanfrancois',?,BUG
23547,'documentation for the JAASRealm to go on the end of the Realms docs','Tomcat 5',Webapps:Documentation,adam.hardy,dev,' Created attachment 8421\nI\'m not on the tomcat-dev list but I am on the tomcat users if u have suggestions to improve this.In org.apache.catalina.realm.JAASRealm, it would make debugging an immense\namount easier if the log.debug calls on lines 315, 317, 350 and 353, i.e.\nwherever the catch is a throwable or bad exception, were changed to error() calls. \n\nJust took me a couple of hours of debugging to work out that my LoginModule was\nnot being found. Under debug level logging, the actual exception message gets\nlost in literally 500 lines of other debug stuff.\n\nThanks\nAdamThanks. It helps if the docs submission is in XML, though.',?,DOCUMENTATION
23610,'unknown SSI directives','Tomcat 5',Servlets:SSI,ThorstenMoeller,dev,'It seems that the following SSI directives are not implemented yet:\n\n<!--#if expr=\"...\"-->\n<!--#else  -->\n<!--#endif -->\n\nWhen using these directives in an .shtml file I get messages:\n\n12:20:44,038 INFO  [Engine] ssi: Unknown command: if\n12:20:44,038 INFO  [Engine] ssi: Unknown command: else\n12:20:44,038 INFO  [Engine] ssi: Unknown command: endif\n\nRegards,\nThorstenYes, that\'s true... I\'ll provide a few patches soon. Is anybody already \nworking on it? I implemented them at one point and then they were blown away by someone that \nhadn\'t noticed they were using an older version.  Supposedly my code was later \nfolded in but I guess that didn\'t really happen.\n\nYou make check back through the older version and find it.  It was back when the \nSSI stuff used to be in a different package.  I can track the code down if \nneeded.\n\nActually, I had implemented and verified every SSI directive in apache \nmod_include except the perl directive.\nNice. So it\'s just a matter of getting that code back to the repository ;) Some patches were indeed not ported to the Tomcat 5 branch, and would now need\nto be merged (which I\'m not going to do so a volunteer is needed).Point out the patches to me, I\'ll take a look.  The best thing would be to \nattach the patches (as .diff files) to this Bugzilla item, the diffs being \nagainst the current HEAD rather than an older version.\nTwo weeks, no action, I\'m closing this item for the tomcat 5.0.27 release and \nTOMCAT_5_0 branching, under the assumption no one cares enough about it.The Tomcat and Apache documentation states that these directives are\navailable.... It is my opinion that this should be fixed -or- the documentation\namended. The files were ported to 5.0.x back in September 2004. You need to use 5.0.29\nonwards or 5.5.1 onwards.',?,RFE
23691,'Incorrect custom tag SMAPping','Tomcat 5',Jasper,ecarmich,dev,'The java servlet Jasper generates from jsp-examples/cal/cal1.jsp has 137 \nlines.  But the SMAP includes the LineInfo \"19:167,6\", which SMAPs line 19 of \nthe JSP to lines that don\'t exist in the generated servlet.\n\nTaking out the \"doVisit(n);\" line in Generator.java\'s \nGenBuffer.adjustJavaLines function seems to fix this, but I\'m not going to \ncommit that change, as I don\'t understand the surrounding code fully.Hmm... cal1.jsp does not contain any custom tags and I didn\'t see the \"19:167,6\"\npart.  Maybe you meant simpletag/foo.jsp?  But I didn\'t see anything obviously\nwrong about its smap either.  Puzzled.Oops.  I meant jsp-examples/jsp2/simpletag/repeat.jsp.  Sorry for the \nconfusion.This is now fixed.  Boy, the SMAP tracking code can get complicated, especially\nif you mix fragments with classic custom tags!',?,BUG
23751,'Error with Saving Configuration','Tomcat 5',Webapps:Administration,manhole,dev,'When I \"Commit Changes\" button clicked, HTTP 500 Error occured\nand my configurations aren\'t saved.\n\nCaused by: java.io.FileNotFoundException:\n..\\..\\conf\\Catalina\\localhost\\jsp-examples.xml (The system cannot find the path\nspecified)\n\tat java.io.FileOutputStream.open(Native Method)\n\tat java.io.FileOutputStream.<init>(FileOutputStream.java:179)\n\tat java.io.FileOutputStream.<init>(FileOutputStream.java:131)\n\tat java.io.FileWriter.<init>(FileWriter.java:73)\n\tat org.apache.catalina.core.StandardServer.storeContext(StandardServer.java:1205)\n\tat org.apache.catalina.core.StandardServer.storeHost(StandardServer.java:1669)\n\tat org.apache.catalina.core.StandardServer.storeEngine(StandardServer.java:1551)\n\tat org.apache.catalina.core.StandardServer.storeService(StandardServer.java:2151)\n\tat org.apache.catalina.core.StandardServer.storeServer(StandardServer.java:2107)\n\tat org.apache.catalina.core.StandardServer.storeConfig(StandardServer.java:798)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.apache.commons.modeler.BaseModelMBean.invoke(BaseModelMBean.java:503)\n\t... 41 more\n\nfollowing is a patch to fix this issue.\n\nIndex: StandardServer.java\n===================================================================\nRCS file:\n/home/cvspublic/jakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/core/StandardServer.java,v\nretrieving revision 1.22\ndiff -u -r1.22 StandardServer.java\n--- StandardServer.java\t2 Sep 2003 21:22:04 -0000\t1.22\n+++ StandardServer.java\t12 Oct 2003 10:51:30 -0000\n@@ -855,10 +855,6 @@\n \n         if (configFile != null) {\n             File config = new File(configFile);\n-            if (!config.isAbsolute()) {\n-                config = new File(System.getProperty(\"catalina.base\"),\n-                                        configFile);\n-            }\n \n             // Open an output writer for the new configuration file\n             PrintWriter writer = null;\n@@ -1194,10 +1190,6 @@\n         if (configFile != null) {\n \n             File config = new File(configFile);\n-            if (!config.isAbsolute()) {\n-                config = new File(System.getProperty(\"catalina.base\"),\n-                                        configFile);\n-            }\n \n             // Open an output writer for the new configuration file\n             writer = null;I thought about it, and I think you can only get that if catalina.base is\nsomething like \"..\". I\'ll have to double check, but it would seem best to fix\nsetting the two system properties in Bootstrap (and always replace it with a\ncanonical path).Thank you for a reply.\nI found, when I execute startup.bat direct (ex. double-click), catalina.base\nwill be \"..\".\nBecause of it, FileNotFoundException occured.\n\nAnd The following patched are also solvable.\nPlease confirm, if it is not trouble.\n\nIndex: startup.bat\n===================================================================\nRCS file: /home/cvspublic/jakarta-tomcat-catalina/catalina/src/bin/startup.bat,v\nretrieving revision 1.4\ndiff -u -r1.4 startup.bat\n--- startup.bat\t4 Aug 2002 18:19:43 -0000\t1.4\n+++ startup.bat\t13 Oct 2003 15:10:14 -0000\n@@ -10,7 +10,7 @@\n if not \"\%CATALINA_HOME\%\" == \"\" goto gotHome\n set CATALINA_HOME=.\n if exist \"\%CATALINA_HOME\%\\bin\\catalina.bat\" goto okHome\n-set CATALINA_HOME=..\n+cd ..\n :gotHome\n if exist \"\%CATALINA_HOME\%\\bin\\catalina.bat\" goto okHome\n echo The CATALINA_HOME environment variable is not defined correctly\n\nIndex: catalina.bat\n===================================================================\nRCS file: /home/cvspublic/jakarta-tomcat-catalina/catalina/src/bin/catalina.bat,v\nretrieving revision 1.5\ndiff -u -r1.5 catalina.bat\n--- catalina.bat\t2 Oct 2003 17:07:40 -0000\t1.5\n+++ catalina.bat\t13 Oct 2003 16:22:52 -0000\n@@ -42,7 +42,7 @@\n if not \"\%CATALINA_HOME\%\" == \"\" goto gotHome\n set CATALINA_HOME=.\n if exist \"\%CATALINA_HOME\%\\bin\\catalina.bat\" goto okHome\n-set CATALINA_HOME=..\n+cd ..\n :gotHome\n if exist \"\%CATALINA_HOME\%\\bin\\catalina.bat\" goto okHome\n echo The CATALINA_HOME environment variable is not defined correctly*** Bug 23818 has been marked as a duplicate of this bug. ***I have fixed the issue.',?,BUG
23764,'logout in SSO from sessions in 2 or more webapps not working','Tomcat 5',Unknown,adam.hardy,dev,'If I have SSO enabled, and I log on to my webapp, and also visit a second webapp\non my localhost, I can\'t logout anymore.\n\nIf I go to the page which has the following JSP:\n\nremote user <\%=request.getRemoteUser() \%> in\nsession <\%= session.getId() \%>\n<\%\nsession.invalidate();\n\%>\n\nand refresh over and over always showed the following:\n\nremote user adam in session EB2543D909D52551EA58C77E963CDD17\nremote user adam in session EA33F35CCB3D1205A88226029C65939C\nremote user adam in session 8814C0365D3F0BDD97B1DE9B7EAECD17\nremote user adam in session 1B7F0424190985F24A294EA2344888C5\n\nThe only way to logout is to close my browser or delete the JSESSIONIDSSO cookie\nin mozilla. \n\nBut logout does work for just one app - if I only visit & login to one webapp,\nwhen I invalidate the session, I immediately get a login request.\n\nNB: The logout functions correctly when all my sessions expire. \n\nNB2: When some but not all of my sessions in one SSO time out, I can re-access\nthe timed-out webapps without seeing a login request. \n\nHope that describes it clearly,\n\nAdamThere is a difference in SingleSignOn.java between 4.1 and 5.0. But the diff\ndoesn\'t make sense to me: what follows is the diff from 4.1 to 5 for what I\n*guess* is the cause:\n-        // Deregister this single session id, invalidating associated sessions\n-        deregister(ssoId);\n+        if ( event.getData() != null \n+             && \"logout\".equals( event.getData().toString() )) {\n+            // logout of all applications\n+            deregister(ssoId);\n+        } else {\n+            // invalidate just one session\n+            deregister(ssoId, session);\n+        }\n\nDoing a grep for \"logout\" - I could not find one  - so I have no idea when the\ntrue part of the conditional gets executed. Any ideas?This could have been added for more control, so I would leave the feature in and\ntry to understand why. This is from a Patrick and Bob patch, so I don\'t think we\ncan get an explanation as to why it is the right thing to do from them.Logout has been removed from the Servlet spec (I did remove the method) and\nprobably forgot (wasn\'t aware of such behavour) that part. I will also take to look.\n\n-- JeanfrancoisIn the absence of a better solution, I\'ve reverted the change to SSO.',?,BUG
23767,'initial location of manager.xml context file not documented','Tomcat 5',Webapps:Documentation,adam.hardy,dev,'On line 91 in src/jakarta-tomcat-catalina/webapps/docs/manager-howto.xml it\nshould say something about finding the initial effective manager.xml context\nconfig file in $CATALINA_HOME/conf/Catalina/localhost/ \n\nThis manager.xml is installed by the initial tomcat-5.0.12 installation, at\nleast in the linux tarball, and it overrides any manager.xml which I put in\nappBase, at least for localhost.The documentation is accurate. Where did you find you could put XML files in the\nhost appBase exactly ?In my first paragraph in the bug description, I stated exactly where I found the\ninstruction on where to place the manager app\'s context configuration xml file.\nThis is the line (from tomcat 5.0.12):\n\n\"Install the manager.xml context configuration file in the appBase for your Host.\"\n\nYour question \"where did I find ....?\" therefore indicates that we are either\ntalking about different documentation or interpreting the documentation\ncompletely differently. \n\nI am not entering bugs in bugzilla for fun or as a means of getting support. I\nhave already raised this issue on the tomcat-user list:\n\nhttp://www.mail-archive.com/tomcat-user@jakarta.apache.org/msg106090.html\n\nand was therefore fairly certain that this is an issue. Please would you provide\nsome more indication as to why this is not an issue, or otherwise re-open this. \n\nFurther explanation will ultimately be of benefit to you as well, since others\nfacing the same situation as myself may well then read it here and learn from\nit, rather than opening another bug or generating more traffic on the lists.\n\nThanks\nAdamYour sentence was too convoluted for me, so I misunderstood it.Fixed. Thanks for the patch.',?,DOCUMENTATION
23881,'SingleSignOn and FormAuthenticator in embedded tomcat','Tomcat 5',Catalina,viorel,dev,'SingleSignOn valve and FormAuthenticator fail to authenticate correctly when \nTomcat works as embedded engine using a jaas realm (jboss). SingleSignOn code \nwrongly sets the principal inside request based on his cookie and \nFormAuthenticator just thinks everything is ok. In fact FormAuthenticator has \nto call authenticate again using the \'username\' and \'password\' stored inside \nthe entry for that ssoId (value of the cookie). One way to fix it is to set \nonly the request REQ_SSOID_NOTE (not the principal too) inside SingleSignOn \nvalve. FormAuthenticator has to make a SingleSignOn lookup, retrieve the \nusername and password and call authenticate. This should happen after checking \n(unsuccessfully) the credentials stored inside the session. This kind of fix \nmade it working for me , although the code is still somewhat not optimal - \n(associate is called way to often, and the same for register , which will reset \nthe cookie)also the register method in AuthenticatorBase creates a new cookie for \nSingleSignOn - i guess should check against an already existing cookie (using \nlookup) - and just call method associate in case this one exists. this solves a \npotential memory leak and the logout issue (register is called after every \nsuccessful authenticate with the container realm). Created attachment 9247\nPatch w/ diff and one new classAttached is a proposed patch.  It adds a configurable \nattribute \"requiresReauthentication\" to SingleSignOn.  If \"false\" (the \ndefault), applications will behave as they do now.  If \"true\", each incoming \nrequest will need to be reauthenticated to the Realm.  The various \nauthenticators have been modified to handle this.  In this case the \nSingleSignOnEntry serves as a store of authentication credentials.\n\nIf the 1st webapp a user visits uses FORM or BASIC auth, and then they visit \nanother app that requires DIGEST, the cached username/password from the \nFORM/BASIC authentication will not be sufficient information to do a digest \nauthentication, so the user will be prompted for a digest login.  Possibly we \ncould add a config option to allow a username/password authentication to \noverride the DIGEST auth specified in the web.xml.\n\nSimilarly, if the user first visits a webapp with DIGEST auth, and then visits \none that uses FORM or BASIC, again the cached credentials will not be \nsufficient (no cached password from the digest auth), so they will have to be \nprompted for their username/password.\n\nThe attached patch includes logic that deals with all this and ensures that a \nsingle SSO session is maintained throughout.\n\nOf course, if webapps in a deployment don\'t mix their authentication schemes, \nnone of the above details are an issue.\n\nThis bug was raised against TC 4; sorry the patch is against TC 5.  I can very \neasily pull together a TC4.1 version if desired.\n\nThis patch also addresses bug 10040.I think I\'m going to apply this patch. Esp since it has been tested in JB land\nfirst (otherwise, I wouldn\'t want to commit it so close to a release).I have applied your patch, thanks.Created attachment 9288\nPort of the TC5 patch to TC 4.1; includes related fix to 9077 and 10040*** Bug 4350 has been marked as a duplicate of this bug. ***Created attachment 9694\nPrevious patch to 4.1 updated to avoid conflict with patch applied today by Mark ThomasPatch attached a moment ago is a zip file which includes a diff plus a new \nclass.  The new class is just the existing SingleSignOnEntry inner class \nextracted out of SingleSignOn.I have applied you patch to TC4.',?,IMPROVEMENT
23953,'JAVA_HOME defined incorrectly breaks startup.bat','Tomcat 5',Catalina,jacek.laskowski,dev,'When JAVA_HOME is defined incorrectly startup.bat doesn\'t start up Catalina \neven though setclasspath.bat (invoked from within the batch) warns about the \nwrong variable and ends. That\'s where the problem is. The setclasspath.bat ends \nnor exits. The last line of setclasspath.bat should look like the following:\n\n   :end\n   exit\n\nWith the change, when JAVA_HOME is wrong, the startup.bat returns quietly (it \nreally should print out a message about it).Unfortunatelly, I make a mistake :-(\n\nThe script - setclasspath.bat - should have every \'goto end\' changed to \'goto \nexit\', and the last entries of setclasspath.bat should look as follows:\n\n:exit\nexit\n\n:endFixed.This is still a bug, please fix...It looks fixed and works for me, so either submit a test case that shows it \nbroken in Tomcat 5.0.27 or leave this bug closed.  Thanks.',?,BUG
24085,'[Administration] The group and role list disappear! When \"Create New User\", \"save\" directly without filling in form.','Tomcat 5',Webapps:Administration,webc,dev,'Hi, \n   In the \"Create New User\" page, click the \"save\" button directly without \nfilling the form. Then there will be a validate error, return to this page \nagian. But the \"Group\" and \"Role\" list disappear! Why?\n   This error also exists in the \"Edit a Exited User\" and \"Create New Group\".\n\nGood Luck!\n\ntigerlet.Fixed in TC 5 & 4.  Thanks for the report.',?,BUG
24186,'Jasper SystemLogHandler memory leak','Tomcat 5',Jasper,ernst.matthias,dev,'In an embedded setting it may be desirable to load and unload Jasper in an own\nclassloader. This is impossible with Jasper right now without a memory leak.\no.a.j.c.Compiler sets System.err to an instance of o.a.j.u.SystemLogHandler in\nits static initializer and never reset it. A new instance of Jasper will pick up\nthis instance as its \'wrapped\' PrintStream and so on ...\n\nThis way, System.err retains a reference chain to each incarnation of\nSystemLogHandler and the whole classloader cannot be unloaded. \n\nI propose to move the redirection to the JspRuntimeContext constructor and to\nundo it in JspRuntimeContext#destroy. With that change, Jasper can be unloaded\nwithout memory leak. Actually, since Jasper uses Ant for compilation which seems\nto support System.{out,err} redirect, it is not clear to me why the\nSystemLogHandler is in there (legacy?).\n\nWorkaround: manually reset System.err on unload.\n\npatch against current CVS:\n\n===================================================================\nRCS file:\n/home/cvspublic/jakarta-tomcat-jasper/jasper2/src/share/org/apache/jasper/compiler/Compiler.java,v\nretrieving revision 1.71\ndiff -u -r1.71 Compiler.java\n--- compiler/Compiler.java      1 Oct 2003 22:44:02 -0000       1.71\n+++ compiler/Compiler.java      28 Oct 2003 17:38:06 -0000\n@@ -98,12 +98,6 @@\n     // ----------------------------------------------------------------- Static\n \n \n-    static {\n-\n-        System.setErr(new SystemLogHandler(System.err));\n-\n-    }\n-\n     // Some javac are not thread safe; use a lock to serialize compilation, \n     static Object javacLock = new Object();\n\n===================================================================\nRCS file:\n/home/cvspublic/jakarta-tomcat-jasper/jasper2/src/share/org/apache/jasper/compiler/JspRuntimeContext.java,v\nretrieving revision 1.16\ndiff -u -r1.16 JspRuntimeContext.java\n--- compiler/JspRuntimeContext.java     2 Sep 2003 21:39:58 -0000       1.16\n+++ compiler/JspRuntimeContext.java     28 Oct 2003 17:38:06 -0000\n@@ -82,6 +82,7 @@\n import org.apache.jasper.Constants;\n import org.apache.jasper.JspCompilationContext;\n import org.apache.jasper.Options;\n+import org.apache.jasper.util.SystemLogHandler;\n import org.apache.jasper.runtime.JspFactoryImpl;\n import org.apache.jasper.security.SecurityClassLoad;\n import org.apache.jasper.servlet.JspServletWrapper;\n@@ -125,6 +126,8 @@\n      */\n     public JspRuntimeContext(ServletContext context, Options options) {\n \n+        System.setErr(new SystemLogHandler(System.err));\n+\n         this.context = context;\n         this.options = options;\n \n@@ -271,7 +274,10 @@\n     /**\n      * Process a \"destory\" event for this web application context.\n      */                                                        \n-    public void destroy() {                                    \n+    public void destroy() {\n+\n+        if(System.err instanceof SystemLogHandler)\n+            System.setErr(((SystemLogHandler)System.err).getWrapped());\n \n         threadStop();\n\n\n===================================================================\nRCS file:\n/home/cvspublic/jakarta-tomcat-jasper/jasper2/src/share/org/apache/jasper/util/SystemLogHandler.java,v\nretrieving revision 1.2\ndiff -u -r1.2 SystemLogHandler.java\n--- util/SystemLogHandler.java  2 Sep 2003 21:40:00 -0000       1.2\n+++ util/SystemLogHandler.java  28 Oct 2003 17:38:06 -0000\n@@ -79,7 +79,7 @@\n      */\n     public SystemLogHandler(PrintStream wrapped) {\n         super(wrapped);\n-        out = wrapped;\n+        this.wrapped = wrapped;\n     }\n \n \n@@ -89,7 +89,7 @@\n     /**\n      * Wrapped PrintStream.\n      */\n-    protected PrintStream out = null;\n+    protected PrintStream wrapped = null;\n \n \n     /**\n@@ -107,6 +107,10 @@\n     // --------------------------------------------------------- Public Methods\n \n \n+    public PrintStream getWrapped() {\n+      return wrapped;\n+    }\n+\n     /**\n      * Start capturing thread\'s output.\n      */\n@@ -142,7 +146,7 @@\n     protected PrintStream findStream() {\n         PrintStream ps = (PrintStream) streams.get(Thread.currentThread());\n         if (ps == null) {\n-            ps = out;\n+            ps = wrapped;\n         }\n         return ps;\n     }Created attachment 8777\npatch as attachmentThanks for the patch.  Applied.',?,BUG
24270,'NoClassDefFoundError when running in security mode','Tomcat 5',Jasper,cheng.fang,dev,'I ran standalone tomcat nightly (10/29/2003) build with -security option, and\ndefault catlina.policy. When executing a jsp that uses reflection, internal\nerror occurred:  It happened on both Windows 200 pro and Solaris 9 Sparc, with\nj2se 1.4.2_01/_02\n\njavax.servlet.ServletException: java.lang.NoClassDefFoundError:\norg/apache/tomcat/util/http/FastHttpDateFormat\n\tat com.sun.ts.tests.jsp.common.util.JspTestUtil.invokeTest(JspTestUtil.java:78)\n\tat org.apache.jsp.JspWriterTest_jsp._jspService(JspWriterTest_jsp.java:510)\n\tat org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:133)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:311)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:301)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:248)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.apache.catalina.security.SecurityUtil$1.run(SecurityUtil.java:284)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAsPrivileged(Subject.java:500)\n\tat org.apache.catalina.security.SecurityUtil.execute(SecurityUtil.java:306)\n\tat org.apache.catalina.security.SecurityUtil.doAsPrivilege(SecurityUtil.java:200)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:278)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.access$000(ApplicationFilterChain.java:97)\n\tat\norg.apache.catalina.core.ApplicationFilterChain$1.run(ApplicationFilterChain.java:187)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:183)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:256)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:563)\n\tat\norg.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:245)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:199)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:563)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:195)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:164)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:563)\n\tat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:156)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:563)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:209)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:781)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:549)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:589)\n\tat\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:666)\n\tat java.lang.Thread.run(Thread.java:534)\n\nThe offending lines are just simple use of reflection, and the page does not\ndirectly reference any server internal classes:\n74:        try {\n75:            Method method = testObject.getClass().getMethod(test, TEST_ARGS);\n76:            method.invoke(testObject, new Object[]{req, res, out});\n77:        } catch (InvocationTargetException ite) {\n78:            throw new ServletException(ite.getTargetException().toString());Created attachment 8840\nwar file to reproducehttp://localhost:8080/jsp_jspwriter_web/JspWriterTest.jsp?testname=jspWriterClearIOExceptionTest\nis the url that triggered the error with attached war.\n\nThe following is from catalina.out on Solaris:\nSecurity Violation, attempt to use Restricted Class:\norg.apache.jasper.compiler.Localizer\njava.security.AccessControlException: access denied (java.lang.RuntimePermission\naccessClassInPackage.org.apache.jasper.compiler)\n        at\njava.security.AccessControlContext.checkPermission(AccessControlContext.java:269)\n        at java.security.AccessController.checkPermission(AccessController.java:401)\n        at java.lang.SecurityManager.checkPermission(SecurityManager.java:524)\n        at java.lang.SecurityManager.checkPackageAccess(SecurityManager.java:1491)\n        at\norg.apache.catalina.loader.StandardClassLoader.loadClass(StandardClassLoader.java:820)\n        at\norg.apache.catalina.loader.StandardClassLoader.loadClass(StandardClassLoader.java:756)\n        at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:302)\n        at org.apache.jasper.runtime.JspWriterImpl.clear(JspWriterImpl.java:178)\n        at\norg.apache.jsp.JspWriterTest_jsp.jspWriterClearIOExceptionTest(JspWriterTest_jsp.java:231)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at\ncom.sun.ts.tests.jsp.common.util.JspTestUtil.invokeTest(JspTestUtil.java:76)\n        at org.apache.jsp.JspWriterTest_jsp._jspService(JspWriterTest_jsp.java:510)\n        at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:133)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n        at\norg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:311)\n        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:301)\n        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:248)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.security.SecurityUtil$1.run(SecurityUtil.java:284)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at javax.security.auth.Subject.doAsPrivileged(Subject.java:500)\n        at org.apache.catalina.security.SecurityUtil.execute(SecurityUtil.java:306)\n        at\norg.apache.catalina.security.SecurityUtil.doAsPrivilege(SecurityUtil.java:200)\n        at\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:278)\n        at\norg.apache.catalina.core.ApplicationFilterChain.access$000(ApplicationFilterChain.java:97)\n        at\norg.apache.catalina.core.ApplicationFilterChain$1.run(ApplicationFilterChain.java:187)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:183)\n        at\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:256)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:563)\n        at\norg.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:245)\n        at\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:199)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:563)\nFixed.\n\nThanks\n\n-- Jeanfrancois',?,BUG
24349,NullPointerException,'Tomcat 5',Catalina:Modules,franc_ois78,dev,'When deploying a web-app with bad URL, with the Tomcat Manager, NullPointerException\nis thrown at org.apache.catalina.manager.HTMLManagerServlet.java:423 (method list)\n(\nThe code is:\nargs[4] = new Integer(context.getManager().findSessions().length);\n                                      ^ null for mistyped directory\n)\nAfter this no application can be deployed, because this exception is rethrown.\n(Tomcat must be restarted)\nI have made some test:\nThe manager for the context of the mistyped URL does not exist.\nSo I modified the enclosing if statement\'s condition\nif (context != null && context.getManager() != null) \nThis version works, but does not report an error, at least I can try\nagain by correcting the web app location, without restarting tomcat.\n\nI hope it is enough.This seems to make sense. Maybe the context shouldn\'t be added in the first\nplace, though. I\'ll review this.Thanks. I\'ve applied the patch you were suggesting.*** Bug 24927 has been marked as a duplicate of this bug. ***',?,BUG
24482,'DOC \"creating a patch\" example doesn\'t work','Tomcat 5',Connector:AJP,kylev,dev,'The example command to create doco patch doesn\'t work, it lacks redirection (>).\n It also doesn\'t quite look like the other examples on the page.Created attachment 8970\nfix create patch example, CVS headFixed as suggested for 5.0.17.',?,DOCUMENTATION
24708,'Tomcat documentation is incorrect with regards to Tyrex and has broken links to Tyrex\'s web site.','Tomcat 5',Webapps:Documentation,metaboss,dev,'Hi there !\n\nMy name is Rost Vashevnik and I am Tyrex project admin. It has been brought to \nmy attention that links from Tomcat\'s documentation to Tyrex site are broken (I \nbelieve this is the case for all versions of Tomcat). Tyrex has moved from \nhttp://tyrex.exolab.org to http://tyrex.sourceforge.net some time ago. More \nimportantly (and embarassingly for us all) http://tyrex.exolab.org does not \nrespond properly any more. So your (and potentially our) user is at a loss what \nto do. \n\nI hope you coud fix it quikly to our common benefit.\n\nAlso we have just released another version of Tyrex, which uses latest third \nparty libraries. Please let me know if you would like me to review \nTomcat\'s \"How to counfigure Tyrex\" documentation and submit updated \ninstructions. \n\nThank you for your time\n\nKind regards\n\nRost VashevnikActually, the Tyrex object factory has been removed from Tomcat, so I\'ll have to\nremove the documentation, since Tyrex is now no longer supported (at least not\nuntil you ship a JNDI object factory for the connection pools - I couldn\'t find\none in the Tyrex repository).',?,DOCUMENTATION
24723,'JNDI Datasource HOWTO instructions incorrect - Name jdbc is not bound in this Context','Tomcat 5',Webapps:Administration,minfrin,dev,'If the instructions are followed to configure a JNDI DataSource pointing at a\npostgresql database that are posted at\nhttp://jakarta.apache.org/tomcat/tomcat-4.1-doc/jndi-datasource-examples-howto.html,\nthe result is the following exception:\n\njavax.naming.NameNotFoundException: Name jdbc is not bound in this Context\n\tat org.apache.naming.NamingContext.lookup(NamingContext.java:811)\n\tat org.apache.naming.NamingContext.lookup(NamingContext.java:194)\n\tat org.apache.catalina.realm.DataSourceRealm.open(DataSourceRealm.java:467)\n\tat org.apache.catalina.realm.DataSourceRealm.authenticate(DataSourceRealm.java:315)\n\tat\norg.apache.catalina.authenticator.BasicAuthenticator.authenticate(BasicAuthenticator.java:161)This functionality works fine (maybe you simply disabled naming). Please post\nabout that on tomcat-user.Not for me it doesn\'t, and tomcat-user has been of no help so far. :(\n\nHow does one \"disable naming\"? Nothing like this is mentioned in the HOWTO.\nSuccess at last.\n\nTurns out the HOWTO documentation is incomplete and incorrect.\n\n- The HOWTO claims that the <resource> section should go under the context. This\ndoes not work - a Google search has revealed a number of people with this\nproblem, and there is at least one bug report open.\n\nThe correct place (as in \"the place where it works\") to put <resources> is in\nthe <GlobalNamingResources> section, which goes under <Server>.\n\nA further problem with the HOWTO is consistency with regards to datasource\nnaming. Under the postgres section, the datasource is first named\n\"jdbc/postgres\", then it is named \"jdbc/mydb\" under web.xml. This is confusing\nto first time users.\n\nIn order to get Realms to work, the realm must refer to the datasource as\ndefined in the <globalnamingresources> section, not a datasource as renamed\nusing <resourcelink>. This is not made clear in the HOWTO.\n*** Bug 24836 has been marked as a duplicate of this bug. ***I actually got the DataSource working as per the example, but only if i used \nthe admin interface to add the resource. I added it under the context for my \napp, not in the global.\nHowever, this was almost a catch-22 because the admin interface would \ndump \"cannot find driverName\" if there wasn\'t a resource already defined.\nSo I went directly to the server.xml file and added a \"dummy\" resource, then \nthe admin interface would allow me to modify the url, login, etc.\nThen it worked.\nFor awhile.\nNow it seems that when i have ant pop the war file for my app into the tomcat \nwebapps dir, and delete the folder for my app under the  webapps dir, i get the \nnaming problem after restart.\n\nDo i have to be locked into the admin interface?\nwhatever\nDBCP can be configured in <GlobalNamingResources> and <Context>\n(ask configuration question on commons-user or tomcat-user)Have you gone through the howto step by step and confirmed that the problems\ndescribed in this report are not still present in the latest version of tomcat?\nIf not, then the bug is not fixed.\n\nRemember the bug is with the documentation. It should not be necessary to ask on\ntomcat user for clarity on usage when the docs are wrong.\nTomcat 5.0.12: Error: Cannot load JDBC driver class \'null\'\nToncat 5.0.19: Error: Cannot create JDBC driver of class \'\' for connect URL \'null\'\n- This not work! END!\nParameters:\nJAVA:\njava version \"1.4.1_02\"\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.4.1_02-b06)\nJava HotSpot(TM) Client VM (build 1.4.1_02-b06, mixed mode)\nTomcat-Config:\nserver.xml:\n<?xml version=\'1.0\' encoding=\'utf-8\'?>\n<Server>\n ...\n  <GlobalNamingResources>\n    <Resource name=\"jdbc/PoolDB\" type=\"javax.sql.DataSource\"/>\n    <ResourceParams name=\"jdbc/PoolDB\">\n      <parameter>\n        <name>validationQuery</name>\n        <value>select count(IdxAnb) from Anbieter</value>\n      </parameter>\n      <parameter>\n        <name>maxWait</name>\n        <value>5000</value>\n      </parameter>\n      <parameter>\n        <name>maxActive</name>\n        <value>30</value>\n      </parameter>\n      <parameter>\n        <name>password</name>\n        <value>...</value>\n      </parameter>\n      <parameter>\n        <name>url</name>\n    \n<value>jdbc:mysql://toshi554:3306/SysReserv2?useUnicode=true&amp;characterEncoding=ISO-8859-1</value>\n      </parameter>\n      <parameter>\n        <name>driverClassName</name>\n        <value>com.mysql.jdbc.Driver</value>\n      </parameter>\n      <parameter>\n        <name>maxIdle</name>\n        <value>10</value>\n      </parameter>\n      <parameter>\n        <name>username</name>\n        <value>xyz</value>\n      </parameter>\n    </ResourceParams>\n    ...\n  </GlobalNamingResources>\n  ...\n</Server>\n\nWEB-Application:\nweb.xml:\n                                                                                \n<!DOCTYPE web-app\n    PUBLIC \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"\n    \"http://java.sun.com/dtd/web-app_2_3.dtd\">\n                                                                                \n<web-app>\n ...\n  <resource-ref>\n      <description>DB SysReserv2 Connection</description>\n      <res-ref-name>jdbc/PoolDB</res-ref-name>\n      <res-type>javax.sql.DataSource</res-type>\n      <res-auth>Container</res-auth>\n  </resource-ref>\n ...                                                                               \n</web-app>You\'re missing the <factory> element, which is essential. \n\nBugzilla is a sub-optimal forum for discussing problems.  Bogdan, post your \nissue to tomcat-user and you will receive corrections, don\'t hijack this \nunrelated Bugzilla issue.\n\nGraham: please submit patches to correct any documentation problems you see to \nthe tomcat-dev list and I will gladly review and commit them as needed.\n\nThis particular item I\'m closing again, hopefully for good.\nA bug should only get closed when it is fixed or found to be invalid, and at no\nother time.\n\nHas the documentation been updated to reflect the correct behaviour? Has someone\nactually taken the time to verify this? I see no comment against this bug to\nshow it\'s been verified, nor do I see any patches logged against it for a\nproposed fix. Looking at the docs again, I see that the problems in the docs\nthat I posted are still there, so I can only conclude there has been no change.\n\nI (as in minfrin@apache.org) am reopening this bug until someone can actually\nverify that this bug is still present. Unfortunately I do not have the time to\ndo so now, as my time is focused on getting mod_ldap out of httpd experimental.\nClosing bugs arbitrarily that have not yet been fixed or verified (bug denial)\nis a waste of everybody\'s time, please don\'t do it.\nOK.  I\'ve modified the document to address the issues you raised.  You can see \nit in CVS at http://cvs.apache.org/viewcvs.cgi/jakarta-tomcat-\ncatalina/webapps/docs/jndi-datasource-examples-howto.xml and it will of course \nbe part of future tomcat 5 releases.  It will be visible on the website with \nthe next tomcat 5 release.\n\nIn addition, I\'ve verified the how-to works exactly as specified when following \nthe document to the letter, against Oracle and MySQL, on tomcat 5.0.25 (the \nlatest stable release at the time of this writing).  I did this verification \nputting the data source declarations both inside a Context and inside the \nGlobalNamingResources: both work equally well.\n\nI have not tested admin webapp editing of these data sources.  If a bug exists \nthere, feel free to submit another issue in bugzilla: this issue is for the \ndocumentation flaws.\n\nFinally, if you feel like the documentation is still lacking / misleading / \nwrong, I restate my earlier invitation for you to submit the text changes you\'d \nlike to see, and my earlier promise to quickly review and commit them.\n\nThis bug is not invalid: it\'s valid, and it\'s now fixed.',?,DOCUMENTATION
24779,'Jasper fails to parse correct XML syntax JSP page with certain EL expressions.','Tomcat 5',Jasper,growler,dev,'It appears that certain JSP 2.0 EL expressions may or may not work\ndepending on choosen JSP syntax. E.g., jsp page in standard syntax\n\n<html>\n  <head>\n  </head>\n  <body>\n    ${header[\"user-agent\"]}<br/>\n    \\${header[\"user-agent\"]}<br/>  \n  </body>\n</html>\n\nis ok, but jsp page in xml syntax \n\n<?xml version=\"1.0\" encoding=\"iso-8859-1\"?>\n<jsp:root xmlns:jsp=\"http://java.sun.com/JSP/Page\" version=\"2.0\">\n<jsp:directive.page contentType=\"text/html\"/>\n<html>\n  <head>\n  </head>\n  <body>\n    ${header[\"user-agent\"]}<br/>\n    \\${header[\"user-agent\"]}<br/>  \n  </body>\n</html>\n</jsp:root>\n\nwill result into \"org.apache.jasper.JasperException: /test.jsp() Unterminated ${\ntag\" exception.\n\nI believe the problem is withing JspDocumentParser.java code. The\ncharacters() function assumes that the parser always passes the content\nof a text node with a single call which is not always the case.\nActually, org.xml.sax.ContentHandler API specifies that \"SAX parsers may\nreturn all contiguous character data in a single chunk, or they may\nsplit it into several chunks\". Moreover, it splits text nodes content\ninto several chunks whenever it meets \'[\' or \']\' within the node, so the\ncode fails to parse any correct EL expression using array access syntax.\n\nAlso please note that escaping EL expression with \'\\\' character also doesn\'t\nwork with XML syntax.Fixed.',?,BUG
24787,'Alias Name field Limited to 24 characters','Tomcat 5',Webapps:Administration,gsexton,dev,'Using the administration application, if you change to a virtual host and select\n\"Create New Aliases\" from the \"Host Actions\" dropdown, the \"Alias Name\" text box\nhas a maxlength value of 24.\n\nThis is too short for all but the most trivial cases.\n\nThe length limitation should be increased to at least 128, or eliminated entirely.Fixed. The max is now 128.',?,IMPROVEMENT
24829,'The startup option \"-config\" doesnt work','Tomcat 5',Catalina,rboppe,dev,'When I start Catalina (Tomcat 5.0.14) using\n$ $CATALINA_HOME/bin/startup.sh -config $PATH_TO_MY_CONFIG/server.xml\n\nThe server does not start up. There are no error messges shown on stdout.\nWhen I use the debug option, and run from the jdb debugger, I get\n-----------\n> run\nSet uncaught java.lang.Throwable\nSet deferred uncaught java.lang.Throwable\n\n\nand then the application exits.Fixed.*** Bug 24858 has been marked as a duplicate of this bug. ***',?,BUG
24832,'JDBCAccessLogValve not working after database restart','Tomcat 5',Catalina,pr,dev,'The JDBCAccessLogValve not working after Database restart.\nI have ported the JDBCRealm connection handling. (s. patch)\nI added the also the user,password attributes to get it working with hsql \n1.7.1, 1.7.2 alpha and mysql 3.23.52\n\nwith hsql I used following table layout:\n\ndrop ts column \ndelete not null column to support common log pattern.\n\ndrop table tomcat_access IF EXISTS;\n-- drop INDEX i_access_ts ; \n-- drop INDEX i_access_remoteHost ; \n-- drop INDEX i_access_virtualHost  ; \n-- drop INDEX i_access_query  ; \n-- drop INDEX i_access_userAgent  ; \n\n\nCREATE TABLE tomcat_access (\n id INTEGER IDENTITY,\n remoteHost VARCHAR(60) ,\n user VARCHAR(30),\n timestamp TIMESTAMP NOT NULL,\n virtualHost VARCHAR(64),\n method VARCHAR(8),\n query VARCHAR(255) NOT NULL,\n status SMALLINT  NOT NULL,\n bytes INTEGER NOT NULL,\n referer VARCHAR(128),\n userAgent VARCHAR(128)\n );\nCREATE INDEX i_access_timestamp ON  tomcat_access (timestamp) ; \nCREATE INDEX i_access_remoteHost ON  tomcat_access (remoteHost) ; \nCREATE INDEX i_access_virtualHost ON  tomcat_access (virtualHost) ; \nCREATE INDEX i_access_query ON  tomcat_access (query) ; \nCREATE INDEX i_access_userAgent ON  tomcat_access (userAgent) ; \n\nMore ToDO:\nError handling is not really good . Log all Exceptions after Database gone.\nWith a datasouce support we can have parallel insert handling.\n\nPeterCreated attachment 9193\nPatch to JDBCAccessLogValve connection restart handlingSince there\'s basically nobody to maintain this component, I will apply your\npatch (it seems ok).',?,BUG
24904,'Namespace Resolution in XML View Fails','Tomcat 5',Jasper,scorley,dev,'Nesting custom tags with name \"text\" fail due to namespace resolution \nproblems.  See sample.war - http://localhost/sample/xml/xml.jsp.\n\norg.apache.jasper.JasperException: /xml/xml.jsp(14,37) <jsp:text> must not \nhave any subelements\n\torg.apache.jasper.compiler.DefaultErrorHandler.jspError\n(DefaultErrorHandler.java:83)\n\torg.apache.jasper.compiler.ErrorDispatcher.dispatch\n(ErrorDispatcher.java:402)\n\torg.apache.jasper.compiler.ErrorDispatcher.jspError\n(ErrorDispatcher.java:126)\n\torg.apache.jasper.compiler.JspDocumentParser.parse\n(JspDocumentParser.java:231)\n\torg.apache.jasper.compiler.ParserController.parse\n(ParserController.java:224)\n\torg.apache.jasper.compiler.ParserController.parse\n(ParserController.java:149)\n\torg.apache.jasper.compiler.ParserController.parse\n(ParserController.java:135)\n\torg.apache.jasper.compiler.Compiler.generateJava(Compiler.java:243)\n\torg.apache.jasper.compiler.Compiler.compile(Compiler.java:459)\n\torg.apache.jasper.compiler.Compiler.compile(Compiler.java:442)\n\torg.apache.jasper.JspCompilationContext.compile\n(JspCompilationContext.java:552)\n\torg.apache.jasper.servlet.JspServletWrapper.service\n(JspServletWrapper.java:291)\n\torg.apache.jasper.servlet.JspServlet.serviceJspFile\n(JspServlet.java:301)\n\torg.apache.jasper.servlet.JspServlet.service(JspServlet.java:248)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:856)Created attachment 9230\nsample war fileThis problem is not what you think it is, but it is a bug alright.  If you have\nused any tag name other than \"text\", it would have worked.  :)\n\nAnyway, thanks for reporting the bug.',?,BUG
24957,'EL treates operators as functions','Tomcat 5',Jasper,b_basham,dev,'The JSP/EL language is incorrectly treating operator keywords (such as \'and\'\n\'or\' \'mod\' and so on) as functions when the expression on the right of the\noperator is a parenthetical expression. \n\nFor example: ${7 div (3 + 2)}   gives a translation error because it thinks\nthat \'div\' should be treated as a function (but it cannot find the declaration\nof that function).\n\nI have a test webapp that I will submit.\n\n-Bryan BashamCreated attachment 9272\ntest webapp for failure of EL operatorsFixed.\n\nThanks for reporting the bug, and for providing the test.  If every bug has test\nas good as this, they\'d all have been fixed!',?,BUG
24968,'RELEASE-NOTES states wrong version of commons-dbcp','Tomcat 5',Webapps:Documentation,adam.hardy,dev,'RELEASE-NOTES says commons-dbcp 1.0 is provided. Version 1.1 is actually\npresent. Would have saved me a download.While I\'m at it, you could also note what version of xercesImpl.jar is included,\ni.e. v2.5, since it is not immediately obvious from the jar which version it is\nand since it is subject of a bug in the server.xml xml validation. ',?,DOCUMENTATION
24972,'Some *.sh scripts in tar not executable.','Tomcat 5',Native:Packaging,andreas.krueger,dev,'In my opinion, the *.sh scripts in jakarta-tomcat-5.0.14.tar.gz\nshould all have the executalbe bit set, consistently, but not all do:\n\n$ tar tvzf jakarta-tomcat-5.0.14.tar.gz \'*.sh\' |\n   perl -wane \'print $F[0], \"  \", $F[5], \"\\n\"\'\n-rwxr-xr-x  jakarta-tomcat-5.0.14/bin/digest.sh\n-rwxr-xr-x  jakarta-tomcat-5.0.14/bin/startup.sh\n-rwxr-xr-x  jakarta-tomcat-5.0.14/bin/tool-wrapper.sh\n-rwxr-xr-x  jakarta-tomcat-5.0.14/bin/catalina.sh\n-rwxr-xr-x  jakarta-tomcat-5.0.14/bin/shutdown.sh\n-rwxr-xr-x  jakarta-tomcat-5.0.14/bin/setclasspath.sh\n-rw-r--r--  jakarta-tomcat-5.0.14/bin/tool-wrapper-using-launcher.sh\n-rw-r--r--  jakarta-tomcat-5.0.14/bin/shutdown-using-launcher.sh\n-rw-r--r--  jakarta-tomcat-5.0.14/bin/startup-using-launcher.shCome to think of it, setclasspath.sh should probably not be marked\nexecutable, as it needs to be sourced in.',?,OTHER
25010,>,'Tomcat 5',Catalina:Modules,andreas.krueger,dev,'I would like to allow symbolic links for the entirety of my Tomcat installation.\n\nThe only way I know of allowing them is through\n\n\n   <Context ... >\n      <Resources\n         className=\"org.apache.naming.resources.FileDirContext\"\n         allowLinking=\"true\"\n      />\n   </Context>\n\nI propose the same functionality should also be available through\n<DefaultContext>.I think you\'re smart. Now look at the changelog for TC 5.0.15.I have found something to this respect in\nhttp://nagoya.apache.org/bugzilla/show_bug.cgi?id=25010\n\nAppearently, this bug, which I have reported for 5.0.14,\nhas been fixed in the present development.\n\nSo, there is a small bookkeeping error here:\nThis bug should have been RESOLVED/FIXED, but presently is RESOLVED/INVALID.\n\nI will reopen it to be able to correct this bookkeeping error.',?,RFE
25011,' .','Tomcat 5',Catalina:Modules,andreas.krueger,dev,'There is no documentation for the flag allowLinking, that enables\nsymbolic linking, at, e.g.,\n\nhttp://jakarta.apache.org/tomcat/tomcat-5.0-doc/config/resources.htmlDone. It is already documented for DefaultContext.',?,DOCUMENTATION
25033,'After install,remove and install application the app is not available','Tomcat 5',Catalina,pr,dev,'Sorry,\n\nI have installed a directory deployment with install ant task.\n\nApplication wotk OK\n\nThan I remove the App an installed again and I got 503 with every request.\n\nBut the Ant list taks say apllication is running.\nC:\\Dokumente\\tomcatKolumne\\2004-02\\example\\examples\\access>ant -f tomadmin.xml \nl\nist\nBuildfile: tomadmin.xml\n\nlist:\n     [list] OK - Auflistung der Webanwendungen f³r virtuellen Server localhost\n\n     [list] /admin:running:0:c:\\develop\\tomcat5\\jakarta-tomcat-5\n\\build/server/we\nbapps/admin\n\n     [list] /myapps:running:0:C:/Dokumente/tomcatKolumne/2004-\n02/example/example\ns/access/myapps\n\n     [list] /:running:0:C:\\Dokumente\\tomcatKolumne\\2004-02\\example\\logger-\nserver\n\\webapps\\ROOT\n\n     [list] /manager:running:0:c:\\develop\\tomcat5\\jakarta-tomcat-5\n\\build/server/\nwebapps/manager\n\n\nBUILD SUCCESSFUL\nTotal time: 1 second\n\nafter restart the application myapps work fine.\n\nSee example configuration.\n\nThe same catalina.base config work fine with 5.0.14 release.\n\nPeterCreated attachment 9311\nExample Application with catalina.base configurationUse deploy and undeploy rather than these deprecated tasks.I tested and the bug is not related to install. However, reloading the\napplication, which is very easy to do, fixes the problem.Hello,\n\nsomething with deregister AccessLog Valve goes wrong....\n\nLogger-Webdev:type=Valve,name=Access\nLogValve,seq=2,path=/myapps,host=localhost\n\nI thing the name is ObjectName wrong : What means the seq2\n\nPeter\n\nPS: OK I test with deploy/undeploy!\n\n\nsee following console output:\n\nINFO: Removing web application at context path /myapps\n26.11.2003 22:20:41 org.apache.catalina.core.StandardPipeline unregisterValve\nINFO: Can\'t unregister valve org.apache.catalina.valves.AccessLogValve@1ce85c4\njavax.management.InstanceNotFoundException: Logger-\nWebdev:type=Valve,name=Access\nLogValve,seq=2,path=/myapps,host=localhost\n        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getMBean\n(Defaul\ntMBeanServerInterceptor.java:1015)\n        at \ncom.sun.jmx.interceptor.DefaultMBeanServerInterceptor.unregisterMBean\n(DefaultMBeanServerInterceptor.java:361)\n        at com.sun.jmx.mbeanserver.JmxMBeanServer.unregisterMBean\n(JmxMBeanServer\n.java:535)\n        at org.apache.catalina.core.StandardPipeline.unregisterValve\n(StandardPip\neline.java:379)\n        at org.apache.catalina.core.StandardPipeline.stop\n(StandardPipeline.java:\n334)\n        at org.apache.catalina.core.StandardContext.stop\n(StandardContext.java:44\n40)\n        at org.apache.catalina.core.ContainerBase.removeChild\n(ContainerBase.java\n:995)\n        at org.apache.catalina.core.StandardHostDeployer.remove\n(StandardHostDepl\noyer.java:652)\n        at org.apache.catalina.core.StandardHost.remove(StandardHost.java:964)\n        at org.apache.catalina.manager.ManagerServlet.remove\n(ManagerServlet.java\n:1062)\n        at org.apache.catalina.manager.ManagerServlet.doGet\n(ManagerServlet.java:\n380)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:743)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(Appl\nicationFilterChain.java:284)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationF\nilterChain.java:204)\n        at org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperV\nalve.java:256)\n        at org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValv\neContext.java:151)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.jav\na:564)\n        at org.apache.catalina.core.StandardContextValve.invokeInternal\n(Standard\nContextValve.java:245)\n        at org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextV\nalve.java:199)\n        at org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValv\neContext.java:151)\n        at org.apache.catalina.authenticator.AuthenticatorBase.invoke\n(Authentica\ntorBase.java:594)\n        at org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValv\neContext.java:149)\n        at org.apache.catalina.valves.RequestFilterValve.process\n(RequestFilterVa\nlve.java:323)\n        at org.apache.catalina.valves.RemoteAddrValve.invoke\n(RemoteAddrValve.jav\na:131)\n        at org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValv\neContext.java:149)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.jav\na:564)\n        at org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.j\nava:195)\n        at org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValv\neContext.java:151)\n        at org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.j\nava:164)\n        at org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValv\neContext.java:149)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.jav\na:564)\n        at org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineVal\nve.java:156)\n        at org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValv\neContext.java:151)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.jav\na:564)\n        at org.apache.catalina.core.ContainerBase.invoke\n(ContainerBase.java:972)\n\n        at org.apache.coyote.tomcat5.CoyoteAdapter.service\n(CoyoteAdapter.java:21\n1)\n        at org.apache.coyote.http11.Http11Processor.process\n(Http11Processor.java\n:805)\n        at \norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.proce\nssConnection(Http11Protocol.java:696)\n        at org.apache.tomcat.util.net.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java\n:605)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadP\nool.java:677)\n        at java.lang.Thread.run(Thread.java:536)\n26.11.2003 22:20:41 org.apache.catalina.core.StandardPipeline unregisterValve\nINFO: Can\'t unregister valve org.apache.catalina.valves.AccessLogValve@139e351\njavax.management.InstanceNotFoundException: Logger-\nWebdev:type=Valve,name=Access\nLogValve,seq=2,path=/myapps,host=localhost\n        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getMBean\n(Defaul\ntMBeanServerInterceptor.java:1015)\n        at \ncom.sun.jmx.interceptor.DefaultMBeanServerInterceptor.unregisterMBean\n(DefaultMBeanServerInterceptor.java:361)\n        at com.sun.jmx.mbeanserver.JmxMBeanServer.unregisterMBean\n(JmxMBeanServer\n.java:535)\n        at org.apache.catalina.core.StandardPipeline.unregisterValve\n(StandardPip\neline.java:379)\n        at org.apache.catalina.core.StandardPipeline.stop\n(StandardPipeline.java:\n334)\n        at org.apache.catalina.core.StandardContext.stop\n(StandardContext.java:44\n40)\n        at org.apache.catalina.core.ContainerBase.removeChild\n(ContainerBase.java\n:995)\n        at org.apache.catalina.core.StandardHostDeployer.remove\n(StandardHostDepl\noyer.java:652)\n        at org.apache.catalina.core.StandardHost.remove(StandardHost.java:964)\n        at org.apache.catalina.manager.ManagerServlet.remove\n(ManagerServlet.java\n:1062)\n        at org.apache.catalina.manager.ManagerServlet.doGet\n(ManagerServlet.java:\n380)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:743)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(Appl\nicationFilterChain.java:284)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationF\nilterChain.java:204)\n        at org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperV\nalve.java:256)\n        at org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValv\neContext.java:151)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.jav\na:564)\n        at org.apache.catalina.core.StandardContextValve.invokeInternal\n(Standard\nContextValve.java:245)\n        at org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextV\nalve.java:199)\n        at org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValv\neContext.java:151)\n        at org.apache.catalina.authenticator.AuthenticatorBase.invoke\n(Authentica\ntorBase.java:594)\n        at org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValv\neContext.java:149)\n        at org.apache.catalina.valves.RequestFilterValve.process\n(RequestFilterVa\nlve.java:323)\n        at org.apache.catalina.valves.RemoteAddrValve.invoke\n(RemoteAddrValve.jav\na:131)\n        at org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValv\neContext.java:149)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.jav\na:564)\n        at org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.j\nava:195)\n        at org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValv\neContext.java:151)\n        at org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.j\nava:164)\n        at org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValv\neContext.java:149)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.jav\na:564)\n        at org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineVal\nve.java:156)\n        at org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValv\neContext.java:151)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.jav\na:564)\n        at org.apache.catalina.core.ContainerBase.invoke\n(ContainerBase.java:972)\n\n        at org.apache.coyote.tomcat5.CoyoteAdapter.service\n(CoyoteAdapter.java:21\n1)\n        at org.apache.coyote.http11.Http11Processor.process\n(Http11Processor.java\n:805)\n        at \norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.proce\nssConnection(Http11Protocol.java:696)\n        at org.apache.tomcat.util.net.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java\n:605)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadP\nool.java:677)\n        at java.lang.Thread.run(Thread.java:536)\n26.11.2003 22:20:41 org.apache.catalina.logger.LoggerBase stop\nINFO: unregistering logger Logger-\nWebdev:type=Logger,path=/myapps,host=localhost\n\nFixing it was rather trivial, also.\nUnderstanding your reports is quite a challenge, sometimes.The valve related trouble works for me (with a META-INF/context.xml).\n\nOTOH, you have to put the path of the context in context.xml, which is not clean\n(and should be infered from the context resource name). But this can be saved\nfor a future release.Hello,\n\nIn my example I have installed a directory app myapps with a separate \nmyapps.xml\ncontext file. In my context I have configured three AccessLogValves. Ohh, this \nexample is a demo  .\n\nWith one AccessLogValve the install,remove, install cycle work correct. \n\nI look at the VavleBase.createObjectName() and the see following\n\nL 278ff\n        Pipeline pipe=containerBase.getPipeline();\n        Valve valves[]=pipe.getValves();\n\nand\nL311\n\n    int seq=0;\n        for( int i=0; i<valves.length; i++ ) {\n            // Find other valves with the same name\n            if( valves[i]!=null &&\n                    valves[i].getClass() == this.getClass() &&\n                    valves[i] != this ) {\n                log.debug(\"Duplicate \" + valves[i] + \" \" + this + \" \" + \ncontainer);\n                seq++;\n            }\n        }\n        String ext=\"\";\n        if( seq > 0 ) {\n            ext=\",seq=\" + seq;\n        }\n\nI thing the StandardPipeline has all valves at startup. This means that all \nvalves registered with the seq=2 part.\n\nWith stop the StandardPipeLine the first Valve is unregistered and the next \nAccessLogValve has a probleme as reported.\n\nPeter\n\n\nAh, ok, I didn\'t think about this case. So I guess I can\'t always understand\nyou, but it\'s a good catch, the sequence alg was indeed bad (it is now fixed).*** Bug 25082 has been marked as a duplicate of this bug. ***',?,BUG
25079,'Tomcat 5.0.14 classloader bug','Tomcat 5',Catalina,gbevin,dev,'I think I\'ve stumbled into a bug in the webapp classloader in Tomcat 5.0.14.\n\nConsider the following servlet, which I mapped to /* for testing convenience.\n\nimport java.io.*;\nimport java.net.URL;\nimport javax.servlet.ServletException;\nimport javax.servlet.http.*;\n\npublic class Test extends HttpServlet\n{\n    public void service(HttpServletRequest req, HttpServletResponse res)\n    throws ServletException, IOException\n    {\n        PrintWriter out = res.getWriter();\n        URL rsrc = getClass().getResource(\"Test.class\");\n        String tst = rsrc.toString()+\" : \"+\n            rsrc.openStream()+\" : \"+\n            getClass().getResourceAsStream(\"Test.class\");\n        out.println(tst);\n        out.close();\n    }\n}\n\n\nWhen I put the compiled class file in ROOT/WEB-INF/classes\nand visit http://localhost:8080/ after a server startup, I get the following page:\n\nfile:/jakarta-tomcat-5.0.14/webapps/ROOT/WEB-INF/classes/Test.class :\njava.io.BufferedInputStream@6a3960 : java.io.ByteArrayInputStream@1dccedd\n\n\nWhen I create a jar file with just that class inside, put it in ROOT/WEB-INF/lib\n(after removing everything from ROOT/WEB-INF/classes before) and visit\nhttp://localhost:8080/ after a server restart, I get the following page:\n\nHTTP Status 500 -\ntype Exception report\nmessage\ndescription The server encountered an internal error () that prevented it from\nfulfilling this request.\nexception\njava.io.FileNotFoundException:\n/jakarta-tomcat-5.0.14/work/Catalina/localhost/_/loader/Test.class\n(No such file or directory)\njava.io.FileInputStream.open(Native Method)\njava.io.FileInputStream.(FileInputStream.java:106)\njava.io.FileInputStream.(FileInputStream.java:66)\nsun.net.www.protocol.file.FileURLConnection.connect(FileURLConnection.java:69)\nsun.net.www.protocol.file.FileURLConnection.getInputStream(FileURLConnection.java:156)\njava.net.URL.openStream(URL.java:913)\nTest.service(Test.java:13)\njavax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\nThe openStream() method has thrown this exception, and the\ngetResourceAsStream(\"Test.class\") method returns null.\n\nThere\'s clearly something wrong here, since the file is indeed not available on\nthat location. The work directory\n\"/jakarta-tomcat-5.0.14/work/Catalina/localhost/_\" just contains one file:\n\"tldCache.ser\" and no directory \"loader\" at all.\n\nI\'ve looked through the sources and found some things in\norg.apache.catalina.loader.WebappClassLoader.\n\nOn line 552, the following is done:\n\npublic void setWorkDir(File workDir) {\n    this.loaderDir = new File(workDir, \"loader\");\n}\n\nWhich is where the \"loader\" directory comes from.\n\nOn line 1085, the following is done:\n\nif (repository.endsWith(\".jar\")) {\n    // Copy binary content to the work directory if not present\n    File resourceFile = new File(loaderDir, name);\n    url = resourceFile.toURL();\n}\n\nOn line 1814, I found this:\n\n// Extract resources contained in JAR to the workdir\nif (!(path.endsWith(\".class\"))) {\n    byte[] buf = new byte[1024];\n    File resourceFile = new File\n        (loaderDir, jarEntry.getName());\n    if (!resourceFile.exists()) {\n    ...\n\nTo me it seems that the code on line 1085 assumes that the code on line 1814 has\nalready been executed before, somehow this isn\'t the case which leads to\nunretrieval resources when they are stored in jar files.\n\nI hope I identified this issue correctly and that it can be fixed for the next\nrelease.Fixed. This report is bad, however, so if the fox wasn\'t trivial, it would have\nbeen a WONTFIX: whatever you are trying to do is likely very wrong. I wonder how\nyou didn\'t come up with a patch. Mine was:\n\ndiff -r1.26 WebappClassLoader.java\n1085c1085,1086\n<                 if (repository.endsWith(\".jar\")) {\n---\n>                 if ((repository.endsWith(\".jar\")) \n>                     && (!(name.endsWith(\".class\")))) {\nThanks for the fix. I didn\'t submit any patch since it\'s the first time I look\nat tomcat\'s source code and have no idea of the global scope.*** Bug 25088 has been marked as a duplicate of this bug. ***',?,BUG
25138,'[PATCH] Can\'t store web application context with admintool.','Tomcat 5',Catalina,toraneko,dev,'Admin tools have a following problem. When I change Application Context and\nstore it\'s configuration with other than iso-8859-1, the configuration file\n($CATALINA_HOME/conf/Catalina/localhost/*) would be broken. The cause is\nStandardServer don\'t open file with utf-8 neither write xml header encoding.\n\nI wrote patch for this problem. Please took following patch and fix problem\nuntil tomcat5 final release.\n\nhttp://yamaguch.sytes.net/~tora/tmp/StandardServer.java.1.22.diff\n\n\nregards,\n\nTakashi OkamotoI also encountered this issue.\nWhen I describe <display-name> in web.xml by UTF-8(or our native encoding),\nthe admin tool copies it to $CATALINA_HOME/conf/Catalina/localhost/*.xml\nwithout the encoding specification.\nFinally, Tomcat fails to startup the context. \n\nRegards.In StandardServer.java, storeResources method has already been fixed as changes that Okamoto-\nsan proposed. The storeContext method should also be fixed ASAP.The patch is applied.  Thanks for the report and patch.',?,BUG
25160,'[PATCH] improve I18N for admintool','Tomcat 5',Webapps:Administration,toraneko,dev,'I send admintools I18N improve patch for tomcat4.1.x. This patch\nimprove more about I18N. This patch improve following problem:\n\n   + The left frame wasn\'t internationalized.\n   + Some of the word in right frame weren\'t internationalized.\n   + Some one miss understand\n       MessageResource.getString(java.lang.Locale locale, java.lang.String\n\t\t                 key ..)\n     API. ex. resources.getString(\"mssage\", locale);\n\nI modified English and Japanese ApplicationResources property\nfiles. However I don\'t know how can I tranlate for Esperanto. So I\nadded TODO comment in ApplicationResources_es.properties.\n\n\nPlease take following patch.\n\n  http://yamaguch.sytes.net/~tora/tmp/tomcat5-admin-i18n.patch\n\nand \n\n + add ApplicationResources.properties\n\n  http://yamaguch.sytes.net/~tora/tmp/ApplicationResources.properties\n\n  * this file is delived from ApplicationResources_en.properties.\n\n + remove ApplicationResources_en.properties.\n\nOne more ask here. SetCharacterEncodingFilter is commented. This means\nother than English people must modify web.xml for input thier own\ncharacter. I would like to uncommend SetCharacterEncodingFilter and\nset default encoding to utf-8. utf-8 is upper compatible with\niso-8859-1 and most of people won\'t be affected by utf-8. I would like\nto recommend it to conviniency for non English user.\n\nregards,\n\nTakashi OkamotoThanks for the patch.  Let me know if I missed anything.FYI, es is Spanish, (Español), not esperanto.\n\nJust comment that I\'m seeing tomcat-5.0.28 fail on a utf-8 filesystem due to ant\nbeing unable to move .properties files around. it is due to ISO-8859 files for\n_es.properties and _fr.properties being unreadable\n(sun.in.MalformedInputException) when locale is *.UTF-8',?,IMPROVEMENT
25193,'Wrong Content-Length in POST could cause information leakage / misbehaviour','Tomcat 5',Tester,christian.hufgard,dev,'Hi, since we had some strange behaviour according to some parts of our software, \nwe found something in Tomcat 4.1.18, 4.2.25 and 5.0.16 (guess so, also on lot of \nother versions..)\nIf a POST-request sends a wrong Content-length (too large), Tomcat does not send \na HTTP 400 Code but continues to process the request. This is no really problem \nso far, since all parameters whith the POST-request are still read in a correct \nmatter.\n\nBut if the client cuts the connection (presses the abort-button, goes offline, \nanyway..) Tomcat uses data from previous request to get the given \ncontent-length. (Seems the buffer is not cleared correctly). This could lead to \nsome critical information leakage on client side, if paramters are bounced back \nto client (e.g. preview-functions in guestbooks, forums, ...) and can also some \nreally strange behaviour if you use this information to generate and send an \nemail. So content from other \"mails\" is taken and filled into a new mail.\n\nIs there any workaround known?\n\n\nGreetz\n\nChristianI don\'t agree with this report. All the fields will be properly cleared at the\nend of the request processing, including the content length. There\'s also now a\nlimitation on the content length which is accepted by Tomcat when parsing\nparameters using getParameter.\nIf you want to reopen this, please submit a sequence of requests producing the\nbug (using za telnet).Have to correct me: Since this only occurs if the connection is closed, no \ninformation from other requests can leak to the client directly.\n\nHere the steps to reproduce this behaviour:\n\nwhith this jsp the problem can be prepared, just fill in some values and call it \na few times...\n[code]\n<HTML>\n<BODY>\n<FORM action=\"showIt.jsp\" method=\"post\">\n<BR><BR>\n<\%\n  for (int i = 0; i < 10; i++) {\n\%>\n  value <\%=i\%> <input type=\"text\" name=\"<\%=i\%>\" length=\"30\"> <br>\n<\%\n  }\n\%>\n<INPUT TYPE=\"SUBMIT\" NAME=\"Submit\" VALUE=\"Submit\">\n</FORM>\n</BODY>\n</HTML>\n[/code]\n\n\nshowIt.jsp simply writes all parameter set in the request to System.out:\n[code]\n<\%@page import=\"java.util.Enumeration\"\%>\n<\%\n  Enumeration names = request.getParameterNames();\n  String name;\n  String value;\n  System.out.println(\"====================\");\n  while (names.hasMoreElements()) {\n    name = (String)names.nextElement();\n    value = request.getParameter(name);\n    System.out.println(\"showIt.jsp\\t\"+name+\"=\"+value);\n  }\n  System.out.println(\"====================\");\n\%>\n[/code]\n\n\n\nFinally the java-Class that has to be run to show the problem: Just call it \nseveral times and look at catalina.out.\n[code]\nimport java.net.*;\nimport java.io.*;\n\npublic class DamagedPostRequest {\n\n  public DamagedPostRequest(String servername, int port, String webapps, int \nlength) throws Exception {\n    String request = \"POST \"+webapps+\"showIt.jsp HTTP/1.1\\n\"\n                    +\"Host: \"+servername, +\"n\"\n                    +\"Content-type: application/x-www-form-urlencoded\\n\"\n                    +\"Content-length: \"+length+\"\\n\"\n                    +\"\\n\";\n\n    Socket s = new Socket(InetAddress.getByName(servername), port);\n    OutputStream out = s.getOutputStream();\n    out.write(request.getBytes());\n    out.close();\n  }\n\n  public static void main(String[] args) throws Exception  {\n    DamagedPostRequest damagedPostRequest2 = new DamagedPostRequest(\"localhost\", \n8080, \"/\", 1000);\n  }\n}\n[/code]There\'s a basic defect in the code which reads the request body. If there\'s a\ndisconnect, then the full array could be parsed, although some of its data is\nbad. This will occur only for small posts (< 8KB).\nI suggest trying out this patch for a possible fix (if a bad read occurs, no\nparameters will be parsed, which is the most reliable behavior; I think the\nasumption of the alg is that there would be an IOE being thrown if there\'s a\nclient disconnect):\n\nRCS file:\n/home/cvs/jakarta-tomcat-catalina/catalina/src/share/org/apache/coyote/tomcat5/CoyoteRequest.java,v\nretrieving revision 1.25\ndiff -r1.25 CoyoteRequest.java\n2371,2372c2371,2374\n<                 readPostBody(formData, len);\n<                 parameters.processParameters(formData, 0, len);\n---\n>                 int actualLen = readPostBody(formData, len);\n>                 if (actualLen == len) {\n>                     parameters.processParameters(formData, 0, len);\n>                 }\n',?,BUG
25199,'Mapper throws NullPointerException, if no DefaultServlet is defined','Tomcat 5',Connector:HTTP,tfohrer,dev,'TestCase:\n 1. remove DefaultServlet from conf/web.xml \n 2. create/deploy a context with welcome-resources\n 3. try to access this context\n\n\nIndex: Mapper.java\n===================================================================\nRCS file:\n/home/cvspublic/jakarta-tomcat-connectors/util/java/org/apache/tomcat/util/http/mapper/Mapper.java,v\nretrieving revision 1.30\ndiff -u -w -b -r1.30 Mapper.java\n--- Mapper.java 21 Aug 2003 01:20:39 -0000      1.30\n+++ Mapper.java 4 Dec 2003 13:22:03 -0000\n@@ -708,7 +708,7 @@\n                         if (file != null && !(file instanceof DirContext) ) {\n                             internalMapExtensionWrapper(extensionWrappers,\n                                                         path, mappingData);\n-                            if (mappingData.wrapper == null) {\n+                            if (mappingData.wrapper == null &&\ncontext.defaultWrapper != null) {\n                                 mappingData.wrapper =\n                                     context.defaultWrapper.object;\n                                 mappingData.requestPath.setCharsYou should never remove the default servlet: it has the lowest priority, so\nwhether it is there or not should not have any impact on your application. A\ndefault servlet defined in your application will also override Tomcat\'s default\nservlet.\nI am willing to apply your fix for cosmetic reasons.Fixed.',?,BUG
25234,'HttpSessionListener called twice on session expiration','Tomcat 5',Catalina,Paul.Harvey,dev,'HttpSessionListener called twice on session expiration.\n\nAfter a (quick!) look at the source it seems to be being caused as \nprocessExpires (StandardManager.java) loops through the sessions calling \nisValid (StandardSession.java) on each.  Then isValid itself looks for timed \nout sessions and calls expires (StandardSession.java) where relevant which \ncalls the listeners.  However then isValid returns (false) back to \nprocessExpires which then itself calls expire and so the listeners are fired a \nsecond time.I\'ve just commented out the call to session.expire() in \nprocessExpires() - the listeners are now only called once.  However this is \npretty naive - I have not traced things through to see if this will have any \nother undesirable side effects.\nThis sounds reasonable. The session expiration code hadn\'t been changed from\nTomcat 4.1, while isValid actually expires sessions when it is called (in TC\n4.1, it didn\'t). This is obviously very easy to fix, and your fix seems logical.*** Bug 25600 has been marked as a duplicate of this bug. ****** Bug 27273 has been marked as a duplicate of this bug. ***',?,BUG
25263,'Incorrect SMAP generated for JSP','Tomcat 5',Jasper,todd,dev,'Below is an example SMAP, JSP, and generated Java file that demonstrate an \nerror in the SMAP generation.\n\nThe test JSP (with line numbers) looks like this:\n\n01  <!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\">\n02  <\%@ page language=\"java\" import=\"java.lang.*,java.util.*\" \%>\n03  <\%\n04  String path = request.getContextPath();\n05  String basePath = \"http://\"+request.getServerName()\n06  +\":\"+request.getServerPort()+path+\"/\";\n07  \%>\n08  <HTML>\n09    <HEAD>\n10      <BASE HREF=\"<\%=basePath\%>\">     \n11      <TITLE>My JSP \'TestJSP.jsp\' starting page</TITLE>\n12    </HEAD>\n13\n14      <BODY>\n15        <\% \n16          Date date = new Date(); \n17          out.println(\"Current time is: \" + date);\n18          out.println(\".  \");\n19          date = new Date(); \n20          out.println(\"Now the time is \" + date);\n21          out.println(\".  \");\n22        \%>\n23        <BR>This is my test JSP page. <BR>\n24      </BODY>\n25  </HTML>\n\nThe SMAP generated is as follows:\n\nSMAP\nTomcatTestJSP_jsp.java\nJSP\n*S JSP\n*F\n+ 0 TomcatTestJSP.jsp\nTomcatTestJSP.jsp\n*L\n1,3:42\n4,3:44\n6,4:47\n9:48,2\n10,5:50\n15,7:51\n21,5:58\n*E\n\nThe mapping of 10,5:50 is erroneous. It is both the wrong area within the \ngenerated java file, and it overlaps with the subsequent correct mapping of the \nembedded java scriptlet at 15,7:51.\n\nHere\'s the generated java file to which I added line number comments for \nillustration:\n\npackage org.apache.jsp;\n\nimport javax.servlet.*;\nimport javax.servlet.http.*;\nimport javax.servlet.jsp.*;\nimport java.lang.*;\nimport java.util.*;\n\npublic final class TomcatTestJSP_jsp extends \norg.apache.jasper.runtime.HttpJspBase\n    implements org.apache.jasper.runtime.JspSourceDependent {\n\n  private static java.util.Vector _jspx_dependants;\n\n  public java.util.List getDependants() {\n    return _jspx_dependants;\n  }\n\n  public void _jspService(HttpServletRequest request, HttpServletResponse \nresponse)\n        throws java.io.IOException, ServletException {\n\n    JspFactory _jspxFactory = null;\n    PageContext pageContext = null;\n    HttpSession session = null;\n    ServletContext application = null;\n    ServletConfig config = null;\n    JspWriter out = null;\n    Object page = this;\n    JspWriter _jspx_out = null;\n\n\n    try {\n      _jspxFactory = JspFactory.getDefaultFactory();\n      response.setContentType(\"text/html\");\n      pageContext = _jspxFactory.getPageContext(this, request, response,\n      \t\t\tnull, true, 8192, true);\n      application = pageContext.getServletContext();\n      config = pageContext.getServletConfig();\n      session = pageContext.getSession();\n      out = pageContext.getOut();\n      _jspx_out = out;\n\n      out.write(\"<!DOCTYPE HTML PUBLIC \\\"-//W3C//DTD HTML 4.01 \nTransitional//EN\\\">\\r\\n\\r\\n\"); // line number 42\n\nString path = request.getContextPath(); // line 44\nString basePath = \"http://\"+request.getServerName()+\":\"+request.getServerPort()\n+path+\"/\"; // line 45\n\n      out.write(\"\\r\\n<HTML>\\r\\n\\t<HEAD>\\r\\n\\t\\t<BASE HREF=\\\"\"); //line 47\n      out.print(basePath); // line 48\n      out.write(\"\\\">\\t\\t\\r\\n\\t\\t<TITLE>My JSP \'TestJSP.jsp\' starting \npage</TITLE>\\r\\n\\t</HEAD>\\r\\n\\r\\n\\t<BODY>\\r\\n\\t  \"); // line 49\n \n\t  \tDate date = new Date(); // line 51\n\t  \tout.println(\"Current time is: \" + date); // line 52\n      out.println(\".  \"); // line 53\n      date = new Date();  // line 54\n      out.println(\"Now the time is \" + date); // line 55\n      out.println(\".  \"); // line 56\n\t  \n      out.write(\"\\r\\n\\t\\t<BR>This is my test JSP page. \n<BR>\\r\\n\\t</BODY>\\r\\n</HTML>\\r\\n\");\n    } catch (Throwable t) {\n      if (!(t instanceof SkipPageException)){\n        out = _jspx_out;\n        if (out != null && out.getBufferSize() != 0)\n          out.clearBuffer();\n        if (pageContext != null) pageContext.handlePageException(t);\n      }\n    } finally {\n      if (_jspxFactory != null) _jspxFactory.releasePageContext(pageContext);\n    }\n  }\n}\n\nFrom this code, the lines 10-14 in the JSP should be mapped only to line 49 \n(like 10,5:49,0), but not to 50-54 as the 10,5:50 mapping dictates.  This is \ncertainly not the only time we\'ve seen problems with this latest release, but \nthis is one of the smallest test cases we could produce.\n\nFor the record, the mappings in the previous version we tested, 5.0.12 were \ncorrect and are reproduced below. \n\nSMAP\nTomcatTestJSP_jsp.java\nJSP\n*S JSP\n*F\n+ 0 /TomcatTestJSP.jsp\nTomcatTestJSP.jsp\n*L\n1,2:42\n4,3:45\n6,2:48\n8:49,2\n9:50,4\n10:53,3\n11:55,2\n12:56\n13:56,2\n14:57\n15,7:59\n21:66\n22:66,3\n23:68,2\n24:70\n*E\n\nAlthough the output lines are different, due to changes in the JSP to Java \ntranslation, you\'ll note that the lines prior to line 15 are properly generated \nto previous lines in the java file in a non-overlapping manner with the 15,7:59 \nmapping, which is where the next java block begins.  This problem with the SMAP \ncurrently prevents IDE\'s from properly supporting source-level JSP debugging.I think the problem is that when Jasper SMAPs a TemplateText node, it assumes \nthat when the input source line advances, the output source line advances as \nwell.  In 5.0.12, Jasper advanced the input source line and the output source \nline independently, and so SMAPped TemplateText nodes correctly.  I\'ve been \nmeaning to fix this regression since it was introduced, but I\'ve been slammed \nwith work, and so haven\'t had time.Argh!  When I concatenated adjecent template text strings, I forgot to update\nthe smap too!  I\'ll try to fix this.  In the meantime, use the compiler option\n\'mappedfile\' as a workaround, which you may want to do anyway when debugging.The suggested workaround of setting mappedfile to true works perfectly, once \nall the previously compiled JSP state is removed from the Tomcat work \ndirectory.  Thank you very much for the suggestion.\n\nBy the way, the default Tomcat settings are basically set up for debugging, \nexcept for mappedfile.  For example, checkInterval, classdebuginfo, \ndevelopment, keepgenerated, reloading are all set to development/debug settings \nby default.  Is there some special reason that mappedfile is not set \naccordingly?  Should it be?Maybe it should.  Come to think of it, we should just set a single flag, such as\n\'development\', to turn on/off debugging.  So setting development would set some\nreasbable default for checkInterval, classdebuginfo, development, keepgenerated,\nreloading, and mappedfile.  What do you think?\n\nAnyway, this bug is fixed now.\n\nI think a global flag that set some reasonable debug settings would be \nfantastic and make configuration much simpler.\n\nAnd, thanks for fixing the bug. :-)I don\'t agree with merging the debug parameters, as they impact different\nthings. For instance, to use mappedfile, you had to remove the old generated\nJSPs. The development flag OTOH will be used right away.\n\nFor production, the only real setting is to precompile the JSPs. Everything else\nis not relevant and you can use the defaults (avoid enabling the background\ncompilation thread, of course ;-) ).\n\nI think the defaults should be tweaked a bit:\n- mappedfile should be true by default in the \"normal\" Jasper (as development is\ntrue)\n- mappedfile should be false by default when precompiling\nOther defaults could be adjusted like this, with the general intent being what\nyou want (but without a super \"dev\" flag).That sounds reasonable.  Just getting mappedfile to default true, since \ndebugging is on anyway would be great.  I agree that the additional flexibility \nof the current model certainly has its place.  Nice compromise. +1 (as if I get \nto vote here ;-)Just from looking at the code for the fix, I think it will still give the \nwrong SMAP for TemplateText nodes longer than JspUtil.CHUNKSIZE.  \nGenerator.java advances the output line when JspUtil.CHUNKSIZE is exceeded, so \nthe SMAPping code should too.',?,BUG
25415,'in JSTL fmt Multiple setLocale work is not compatible JSTL 1.1 specif','Tomcat 5',Jasper,william,dev,'in JSTL 1.1 spec 8.3.2 about multiple setlocale work explain.\nbut in tomcat 5.0.16.in one jsp multiple setlocale ,the output html page is not \nwork in purpose.\n\nsame jsp work in tomcat 4.x ,work fine.so this is a critical bug.\n\nproduce steps:\n1.create two properties one is:Directory.properties,other is \nDirectory_zh_CN.properties.\n2.write a jsp with follow code:\n <f:setLocale value=\"en\"/>\n<f:setBundle basename=\"Directory\"/>\nName:<f:message key=\"name\"/>\nSex:<f:message key=\"sex\"/>\n<hr>follow is chinese\n<f:setLocale value=\"zh_CN\"/>\n<f:setBundle basename=\"Directory\" />\nName:<f:message key=\"name\"/>\nSex:<f:message key=\"sex\"/>\n\n3.see output .Created attachment 9501\nWhole test war.Created attachment 9502\nWork Correctly in Tomcat 4.1.3 snapshotThanks for the test case. Seeing what it does, I expect it is a JSTL bug (or\nmaybe this is not allowed, and worked by accident rather than by design).\nDisabling tag pooling makes this work (unsurprisingly), so you have an easy\nworkaround.Disabled tag pooling,no effect.still same before.\nmodifyed \%TOMCAT_HOME\%\\conf\\web.xml\n   <servlet>\n        <servlet-name>jsp</servlet-name>\n        <servlet-class>org.apache.jasper.servlet.JspServlet</servlet-class>\n        <init-param>\n            <param-name>fork</param-name>\n            <param-value>false</param-value>\n        </init-param>\n        <init-param>\n            <param-name>xpoweredBy</param-name>\n            <param-value>false</param-value>\n        </init-param>\n        <init-param>\n            <param-name>enablePooling</param-name>\n            <param-value>false</param-value>\n        </init-param>        \n        <load-on-startup>3</load-on-startup>\n    </servlet>\n\nThis does work. However, you need to remove your work directory (or only the\ngenerated JSP if you know what you\'re doing) to force a recompilation of the JSP.William,\n\nIf you are working with a JSP 2.0 container (which Tomcat 5.x is), I suggest you\nuse a JSTL 1.1 implementation. I have tested your page with Tomcat 5.0.16 and\nstandard-1.1.0-B1, and everything worked fine.\n\nHere is what you\'ll have to do:\n\n  1. Modify the JSTL URIs:\n\n       from: <\%@ taglib uri=\"http://java.sun.com/jstl/fmt\" prefix=\"f\" \%>\n         to: <\%@ taglib uri=\"http://java.sun.com/jsp/jstl/fmt\" prefix=\"f\" \%>\n\n  2. Change your web.xml so it is servlet 2.4 based:\n\n       from:\n<!DOCTYPE web-app\n    PUBLIC \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"\n    \"http://java.sun.com/dtd/web-app_2_3.dtd\">\n         to:\n<web-app xmlns=\"http://java.sun.com/xml/ns/j2ee\"\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n    xsi:schemaLocation=\"http://java.sun.com/xml/ns/j2ee web-app_2_4.xsd\"\n    version=\"2.4\">\n\n      from:\n  <context-param>\n    <param-name>javax.servlet. jsp.jstl.fmt.localizationContext</param-name>\n    <param-value>Directory</param-value>\n    <description>èµ„æº?æ–‡ä»¶</description>\n  </context-param>\n      to:\n  <context-param>\n    <description>èµ„æº?æ–‡ä»¶</description>\n    <param-name>javax.servlet. jsp.jstl.fmt.localizationContext</param-name>\n    <param-value>Directory</param-value>\n  </context-param>\n       \n  3. Use the standard-1.1-B1 jars\n\n     get rid of the jar files in your WEB-INF/lib directory, and copy\n     standard.jar and jstl.jar from stardard-1.1-B1.\n\nIf you could confirm that this works for you, and then close the bug, that would\nbe great.yes.test ok.\nclose this bug.\n',?,BUG
25419,'property string \"standardContext.resourcesStart\" is missing','Tomcat 5',Catalina,j.schwoerer,dev,'The property string \"standardContext.resourcesStart\" is missing in the\norg/apache/catalina/core/LocalStrings.properties file.Fixed.',?,IMPROVEMENT
25452,'JSP compile failure does not stop Ant build','Tomcat 5',Jasper,larry,dev,'When using Tomcat 5.0.16\'s org.apache.jasper.JspC class as a taskdef Ant tag, if\nthere is a failure in compiling a JSP file into a Java file, Ant does not know\nabout it.  Ant will continue the rest of the build regardless of any JSP compile\nfailures.  It might even report success depending on the rest of the build.\n\nI would think that a failed JSP compile should halt the build similar to a\nfailed Java compile.  (Or at least have a failOnError option.)  What I see\ninstead is that any JSPs that fail to compile will cause JspC to write an error\nmessage to the logging API and write out a zero-length Java file.  Ant, however,\njust continues building after the JspC task is done.\n\nI\'ve seen JSPs not compile for the following reasons: bug #25488, a taglib or\nJSP action tag is unbalanced, or because an include directive tries to include a\nfile that does not exist.  There are probably many other reasons a JSP would\nfail to be parsed.\n\nWorkarounds include having a human check the log output of the JspC tag for\nerror messages or do a \"find . -empty\" to find zero-length Java files.\n\nTo solve this issue I recommend having JspC.execute() throw an\norg.apache.tools.ant.BuildException on build errors.  This will work for both\nthe Ant build and when running from the commandline.  When running from the\ncommand line the main() method can catch and handle the exception appropriately.JspC has been modified to rethrow any exception raised during compilation, so\nthat should address your problem.  Please try the nightly build for Tomcat 5 to\nsee if that\'s good enough for you.',?,BUILD_SYSTEM
25493,'Need to have true RPC in the comm channel over cluster','Tomcat 5',Catalina:Cluster,fhanik,dev,'Need to send an ACK when a session is receivedFixed on 12/15/2003, will be included in the next release of tomcat 5',?,BUG
25555,'SingleSignOn valve config doc missing \'requireReauthentication\' attribute','Tomcat 5',Webapps:Documentation,bstansberry,dev,'The configuration doc page does not include the new \"requireReauthentication\" \nattribute recently added to the SingleSignOn valve.  The attribute was added \nas part of a patch to bug 23881 that I wrote.\n\nI\'m embarrassed to file a bug report for this, as I should have included the \ndocs in the original patch.  I just now figured out where the docs pages are \nin the source tree.\n\nPatch to followCreated attachment 9597\nPatch to /webapps/docs/config/valve.htmlPatch committed. Thanks much!',?,DOCUMENTATION
25593,'allowLinking attribute value is not preserved or ignored after context is reloaded','Tomcat 5',Catalina,vladislavi,dev,'<Context path=\"/myapp\" docBase=\"myapp\" debug=\"0\" privileged=\"true\" \ncrossContext=\"true\" reloadable=\"true\" allowLinking=\"true\" >\n\nI have a link in \"myapp/WEB-INF/classes/com\" that points to a directory \nlocated on an NFS share. After tomcat starts up \"myapp\" works perfectly fine. \nAfter the application gets reloaded (either my the manager or because of the \nclass file change) tomcat stops floowing the links for the application \ngenerating ClassNotFound exceptions.I\'ll try to look into it, but I\'d like to point out this is not a major issue\neven if it\'s valid. As a workaround, simply redeploy the webapp, which is not\nvery different from a reload anyway.This is now fixed.',?,BUG
25599,'Cannot change the Java VM option in the Configure Tomcat utility','Tomcat 5',Native:Integration,curtinjt,dev,'I\'m running Tomcat 5 on a Windows XP system with at least 6 different JDKs.  I\nhave my JAVA_HOME environment variable set to reference the default instance,\nthe one I use most often.  During the initial installation, the Tomcat installer\nasked me to point to the location of the JDK I wanted Tomcat to use, and it\npre-populated the field with the value of the JAVA_HOME variable.  This was\nfine, so I left the value alone and continued the installation.  When I checked\nthe values in the Configure Tomcat tool, I saw that the Java VM option read\nsimply \"java\" rather than the value I had seen during installation.  If I try to\nchange this value, and point to a specific Java executable from a specific JDK\nversion, Tomcat will not start up.  The process dies almost as soon as I run it,\nand it will not come back until I go into the Windows Registry and return the\nJava VM value to just \"java\".   I can find no other way to specify which Java\nversion Tomcat uses after installation, and I can\'t verify that it is using the\none I selected during installation.Further testing reveals that Tomcat will always use the JVM referenced in the\nWindows registry, regardless of the choice made during installation.  In my\ncase, this was C:\\Program Files\\Java\\j2re1.4.2_02 -- it was installed along with\nthe Java 1.4.2 SDK.  If this JVM instance does not exist on the Windows\nfilesystem, the installer will still act like everything is okay -- asking if\nyou want Tomcat to use the JDK referenced by your JAVA_HOME environment variable\n-- but when installation is complete, Tomcat *will not run*.  Tomcat needs to\nactually use the JDK that the user specifies during or after installation, and\nit needs to be able to run even if the silly JRE is not installed under\nC:\\Program Files.This is fixed now in the CVS, and will appear in 5.0.17.',?,BUG
25603,'HTTPS Connector ignores truststoreFile attribute','Tomcat 5',Connector:Coyote,curtinjt,dev,'When setting up a Connector to create an SSL listen socket over HTTPS, the\ntruststoreFile attribute of the Connector element is ignored by Tomcat 5. \nRegardless of the file path set in the attribute, Tomcat will only recognize the\ncertificate authority trust store located in\n\%JAVA_HOME\%\\jre\\lib\\security\\cacerts.  Setting an alternate location for the\ntrust store, as suggested in the Tomcat 5 documentation, has no effect.I think the implementation for configuring the truststore is missing, except for\nis type.I\'m marking as FIXED, since now the code matches the docs.  However, it should \nwork fine in 5.0.16 as long as you explicity configure the truststorePass on \nthe Connector.',?,BUG
25610,'javadocs of TLV.validate() need','Tomcat 5',' JSP API',t5jtjj502,dev,'Excerpts from http://nagoya.apache.org/bugzilla/show_bug.cgi?id=15703 : \n\n\n------- Additional Comments From Jan Luehe 2003-12-15 17:54 -------\n\nJSP.13.9.6 mentions that the \"uri\" parameter in TLV.validate()\ncorresponds to the taglib\'s uri in the XML view.\n\nThe javadocs of TLV.validate() describe the \"uri\" param as follows:\n\n @param uri the tag library\'s unique identifier\n \nThe JSP spec lead confirmed that the javadocs of TLV.validate() need\nto be clarified to match the spec.This appears to be fixed.  Note that since the 2.0 spec is already final, \nreopening will simply result in closing it as WONTFIX.',?,DOCUMENTATION
25681,'HTTP request params lost when sent with a URL ending with a folder w/o \'/\' at the end of URL','Tomcat 5',' JSP API',sabiq,dev,'Given a URL like:\nhttp://www.ultranet.tv/site/web_hosting?l=tr\nthe request logged in J2EE 1.4 DR (Tomcat 5) is:\n64.219.140.49 - - [21/Dec/2003:15:43:05 -0600] \"GET /site/web_hosting/ \nHTTP/1.1\" 200 7912\nThis apparently means that the request parameters have been lost while \nresolving the URL. \nIf the request URL is modifed to http://www.ultranet.tv/site/web_hosting/?\nl=tr, the log shows:\n64.219.140.49 - - [21/Dec/2003:15:36:35 -0600] \"GET /site/web_hosting/?l=tr \nHTTP /1.1\" 200 7842\nThus, the request parameters are apparently preserved.\nUnless the HTTP standards dictate that the request params in the first request \nshould be lost, which i can\'t imagine to be the case, this is a bug.\n\nP.S. In J2EE 1.4 Beta 2, the first request gets logged as follows:\n64.219.140.49 - - [21/Dec/2003:15:47:00 -0600] \"GET /site/web_hosting?l=tr \nHTTP/1.1\" 302 -\n64.219.140.49 - - [21/Dec/2003:15:47:00 -0600] \"GET /site/web_hosting/?l=tr \nHTTP/1.1\" 302 -\n64.219.140.49 - - [21/Dec/2003:15:47:03 -\n0600] \"GET /site/web_hosting/index.jsp?l=tr HTTP/1.1\" 200 7842\nP.P.S. It appears that there has been an attempt to make processing of these \nURLs more efficient by avoiding 302 responses, and resolving to the final \nlocation internally. However, this bug was introduced in doing so. The fix is \nlikely to be trivial for someone who is familiar with Tomcat architecture.\n\nThanks,\nrs.This has already been fixed in the CVS.',?,BUG
25703,'ExtendedLogValve use wrong filename after rotate or checkexits case','Tomcat 5',Catalina,pr,dev,'ExtendedLogValve use wrong dateFormater after rotate or checkexists\nwhen used with fileDateFormat=\"yyyy-MM-dd-HH\".\n\nExample:\n<Valve className=\"org.apache.catalina.valves.ExtendedAccessLogValve\"\n                        directory=\"logs\"\n                        prefix=\"myapps_ext_access_log.\"\n                        suffix=\".txt\"\n                        pattern=\"date time c-ip x-H(remoteUser) cs-method cs-\nuri-stem sc-status bytes c-dns cs(User-Agent) cs(Referer) x-S(Hello)\" \n                        resolveHosts=\"false\"\n                        fileDateFormat=\"yyyy-MM-dd-HH\"\n            \t\tcondition=\"nolog\" /> \n\nI look at code base and found that the wrong formatter are used.\nI switch to fileDateFormatter and it works (s. patch).\n\nPeterCreated attachment 9663\nFix wrong ExtendedAccessLogValveFixed thanks!',?,BUG
25774,'Documentation change needed for making unix daemon','Tomcat 5',Unknown,luke,dev,'The documentation tells users to run make for bulding the unix daemon, connectors, and other C/\nC++ code throughout the tomcat project.\n\nIt would be helpful to point out that they must run the gnu make (gmake) command to get the \ncompile to work instead of the native bsd make on freebsd systems.Added note to setup instructions as suggested.  Change will be reflected in \nnext release and next web site update.',?,DOCUMENTATION
25787,' won\'t be declared','Tomcat 5',Jasper,kip,dev,'When adding a new fragment to an existing tag-file, it will not apear in\nthe generated java class in org.apache....tag.web.name_tag.java file\nuntil the server has been restarted.\n\nMy source===>\n<?xml version=\'1.0\' encoding=\'iso-8859-1\' ?>\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 \nTransitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n\n<\%@ attribute name=\"body\"     fragment=\"true\" \%>\n<\%@ attribute name=\"leftmenu\" fragment=\"true\" \%>\n<\%@ attribute name=\"topmenu\"  fragment=\"true\" \%>\n========!\n\nLast one has been added after testing the first two. But it can not be\nused until i have restartede tomcat5.Since it\'s a tag, I have to assume you have to restart the webapp (use the manager).This actually works for me.\n\nIn Tomcat 5, any changes in a tagfile will trigger a recompilation of all the\n.jsp pages that reference it, as well as the tagfile itself, so I don\'t see why\nyou need to restart TC.  Please include a test case if you still have problems.\n\nNote also that the addition of <\%@ attribute name=\"xxx\" fragment=\"true\" \%> to\nthe tag file will not have any effect on the generated .class file, unless the\nfragment is also used in the tagfile, with an <jsp:invoke fragment=\"xxx\"/>. \nThis is just an optimization.\n\nReally ?\nSince the tag is a webapp wide resource, I would have thought a restart of the\nwebapp would be needed (and desired for performance reasons).\nIf I put \"development\" to \"false\", are those checks still made ? Hopefully not\n;-) (of course, it\'s still much better to precompile)Really, Remy.  :-)\n\nTC5 uses the same mechanism for tracking depdendencies on (statically) included\nfiles, tag files, and tld\'s.  It would be very inconvenient during development\nto have to redeploy the webapp every time an included file or a tagfile is\nmodified.\n\nThe dependencies are considered only when a JSP page is referenced and we are\ndeciding whether the page needs to be recompiled, so when development is false,\nthey are totally out of the picture.  At least I hope they are.  ;)Reopen to change statusUpon a closer look, there is a bug after all.  Apologies to kip@kipon.dk (Kjeld\nIngemann Poulsen)\n\nWhen compiling a tagfile, the cached TagInfo object was passed, even when the\ntagfile has been modified.  This is now fixed.  Thanks for reporting.',?,BUG
25792,'Session timeout implemented incorrectly','Tomcat 5',Catalina,ranlevy,dev,'Sessions expire even if they are accessed within the specified timeout\ninterval.  In our application it breaks application logic. I think that\nbug report #20083 refers to this problem and offers a fix.\n\nTo reproduce:  Use the two files SessionTimeoutBug.java and web.xml to create\nand deploy the bug-reproduction webapp, than direct browser to \nhttp://yourserver:8080/bug/SessionBugDemo, hit the URL on the page and wait for\ntimeouts.  The \"interval\" context parameter in web.xml defines an activity\ninterval in seconds and is set to 120 (every 120 seconds the browser sends a\n\"get\" request to the server). The \"session-timeout\" config parameter is set to\n3 minutes. Setting \"interval\" to 60 or lower shows a situation where the bug\nhas no effect.  \n\nActual result:  The first refresh behaves correctly (as the 120-second\ninterval falls within the 3 minutes timeout period) and the resulting history\npage shows that the session is alive. The second refresh causes start of a new\nsession, and the webapp start-page is displayed instead of the session history \npage.  When \"interval\" is set to 60, however, the history page is displayed \nrepeatedly, meaning that in this case the session never times out.\n\nExpected result:  that the session would never time out for any \"interval\" which\nis lower or equal to \"session-timeout\" (in this example - any interval up to\n180 seconds). The history page should continue to be displayed and evolve, and\nthe start-page should not be displayed after the demo app has begun.\n\nI used the downloaded binaries of 5.0.16.\n\n---------------------------- SessionTimeoutBug.java ----------------------\n\nimport java.io.*;\nimport javax.servlet.*;\nimport javax.servlet.http.*;\nimport java.util.*;\n\n\npublic class SessionTimeoutBug extends HttpServlet {\n  private int interval = 0;\n\n  public void init (ServletConfig config) throws ServletException {\n    ServletContext context = config.getServletContext ();\n    String str = context.getInitParameter (\"interval\");\n\n    try {\n      if (str != null) {\n        interval = Integer.parseInt (str);\n      }\n\n      if (interval < 0) {\n        interval = 0;\n      }\n    } catch (NumberFormatException e) {\n      interval = 0;     // no refresh\n    }\n  }\n\n\n  public void doGet (HttpServletRequest request, HttpServletResponse response)\n  throws IOException, ServletException {\n\n    HttpSession session = request.getSession (true);\n    String history = (String) session.getAttribute (\"history\");\n    String url = response.encodeURL (request.getRequestURI ());\n\n    if (history == null) {\n      genFirstPage (response, session, url);\n    } else {\n      genPage (response, session, url);\n    }\n  }\n\n\n  private void genFirstPage (HttpServletResponse response,\n                                         HttpSession session, String url)\n  throws IOException, ServletException {\n\n    session.setAttribute (\"history\", \"\");\n\n    PrintWriter out = response.getWriter ();\n    out.println (\"<html>\");\n    out.println (\"<head>\");\n    out.println (\"<title>Session Timeout Bug Demonstration</title>\");\n    out.println (\"</head>\");\n    out.println (\"<body>\");\n    out.println (\"To start demo click <a href=\\\"\" + url + \"\\\">here</a>.\");\n    out.println (\"</body>\");\n    out.println (\"</html>\");\n    out.close ();\n  }\n\n\n\n\n  private void genPage (HttpServletResponse response,\n                                         HttpSession session, String url)\n  throws IOException, ServletException {\n\n    String history = (String) session.getAttribute (\"history\");\n    history = history + \"<BR>Time = \" + (new Date ());\n    session.setAttribute (\"history\", history);\n\n    PrintWriter out = response.getWriter ();\n    out.println (\"<html>\");\n    out.println (\"<head>\");\n    out.println (\"<title>Session Timeout Bug Demonstration</title>\");\n\n    out.println (\"<meta http-equiv=\\\"refresh\\\" content=\\\"\" + interval + \";\" + \nurl + \"\\\">\");\n\n    out.println (\"</head>\");\n    out.println (\"<body>\");\n    out.println (\"<B>Refresh history: </B>\" + history);\n    out.println (\"<br>\");\n    out.println (\"<br><b>Session timeout is: </b>\" + \nsession.getMaxInactiveInterval() + \" seconds.\");\n    out.println (\"<br><b>Next refresh in: </b>\" + interval + \" seconds.\");\n    out.println (\"</body>\");\n    out.println (\"</html>\");\n    out.close ();\n  }\n\n}\n\n\n---------------------------- web.xml ----------------------\n\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n<!DOCTYPE web-app PUBLIC \"-//Sun Microsystems, Inc.//DTD Web Application \n2.3//EN\" \"http://java.sun.com/dtd/web-app_2_3.dtd\">\n\n<web-app>\n\n    <!-- General Description of the web application -->\n\n    <display-name>\n        Session Timeout Bug Demonstration Web Application\n    </display-name>\n    <description>\n        Session Timeout Bug Demonstration Web Application\n    </description>\n\n\n    <!-- Context Parameters -->\n\n    <context-param>\n        <param-name>interval</param-name>\n        <param-value>120</param-value>\n    </context-param>\n\n\n\n    <!-- Servlet Definitions -->\n\n    <servlet>\n        <servlet-name>SessionTimeoutBugDemonstration</servlet-name>\n        <servlet-class>SessionTimeoutBug</servlet-class>\n    </servlet>\n\n\n    <!-- Servlet Mapping -->\n\n    <servlet-mapping>\n        <servlet-name>SessionTimeoutBugDemonstration</servlet-name>\n        <url-pattern>/SessionBugDemo</url-pattern>\n    </servlet-mapping>\n\n\n    <!-- Session Timeout Definition -->\n\n    <session-config>\n        <session-timeout>3</session-timeout>\n    </session-config>\n\n</web-app>\n\n\n------------------------------------ END ------------------------------------Created attachment 9725\nwebapp to reproduce the bugThe session timeout in Tomcat seems to be implemented in a way that doesn\'t take\nthe background clean-up thread into account.\n\nStandardSession has two variables:\nthisAccessedTime - the time for current request\nlastAccessedTime - the time for last request (needed by\nHttpSession.getLastAccessedTime)\n\nThe times are updated only once per request by the container so that\nHttpSession.getLastAccessedTime() returns the time of the previous request. The\nsame variable is later used by the background thread to determine if the session\nshould be invalidated. Therefore the background cleanup thread checks the access\ntime of the _second_ latest request. This explains why 1 min refresh period\nworks with 3 min timeout while 2min refresh period does not. Isn\'t it possible\nthat the session could even be invalidated while processing a request?\n\nQuick\'n\'dirty fix would be as follows:\n======\ndiff -u -b -r1.26 StandardSession.java\n--- StandardSession.java        29 Nov 2003 18:06:35 -0000      1.26\n+++ StandardSession.java        30 Dec 2003 12:52:44 -0000\n@@ -584,7 +584,7 @@\n\n         if (maxInactiveInterval >= 0) {\n             long timeNow = System.currentTimeMillis();\n-            int timeIdle = (int) ((timeNow - lastAccessedTime) / 1000L);\n+            int timeIdle = (int) ((timeNow - thisAccessedTime) / 1000L);\n             if (timeIdle >= maxInactiveInterval) {\n                 expire(true);\n             }\n======\n\nMore elaborate way would be to cache the lastAccessedTime in the\nhttpsessionfacade and update the StandardSession.lastAccessedTime directly w/o\nthe thisAccessedTime in between. I could write the more elaborate\npatch if someone is willing to commit it.\n\nPlease comment.\nI have applied the patch, since I couldn\'t see any problem with it.',?,BUG
25796,'Multiple security-contraint entries in web.xml lead to too-restrictive behaviour','Tomcat 5',Catalina,darren.hague,dev,'I have a web.xml containing two security constraints:\n    <security-constraint>\n        <web-resource-collection>\n            <web-resource-name>PublicPages</web-resource-name>\n            <url-pattern>/AccountMan.do</url-pattern>\n            <http-method>GET</http-method>\n            <http-method>POST</http-method>\n        </web-resource-collection>\n        <user-data-constraint>\n            <transport-guarantee>NONE</transport-guarantee>\n        </user-data-constraint>\n    </security-constraint>\n    \n    <security-constraint>\n        <web-resource-collection>\n            <web-resource-name>UserPages</web-resource-name>\n            <url-pattern>*.do</url-pattern>\n            <http-method>GET</http-method>\n            <http-method>POST</http-method>\n        </web-resource-collection>\n        <auth-constraint>\n            <role-name>xsap_ebiz_user</role-name>\n        </auth-constraint>\n        <user-data-constraint>\n            <transport-guarantee>NONE</transport-guarantee>\n        </user-data-constraint>\n    </security-constraint>\n\nThe idea is that all *.do URLs are protected, with the exception of \nAccountMan.do which is publicly visible (no auth-constraint). \n\nThis works fine on Tomcat 4.1-29 and on SAP J2EE Engine 6.20. \n\nIn Tomcat 5.0-16 and 5.0-14 (the only releases I have tested), attempting to \naccess AccountMan.do brings up the login page instead of going straight to the \npage itself (a Struts forward to a Tiles definition).\n\nThis behaviour contradicts the Servlet 2.4 spec, SRV.12.8.1 Combining \nConstraints:\n\"A security constraint that does not contain an authorization constraint shall \ncombine with authorization constraints that name or imply roles to allow \nunauthenticated access.\"\n\nCheers,\nDarren Hague\n\nP.S. This is my first bugzilla report - please let me know if I could have done \nanything better.This has already been fixed in the CVS, and will show up in 5.0.17.',?,BUG
25805,'DataSourceRealm cannot find the JNDI DataSource','Tomcat 5',Catalina,akhayyat,dev,'Hi there,\n\nI am trying to use DataSourceRealm for my application to authenticate users \naccording to a mysql database as instructed in the HOW-TOs, but it does not \nseem to work although the DataSource Resource alone can be accessed and data \nqueried.\nWhen using the DataSourceRealm I get the following in the application log:\nException performing authenticati\non\njavax.naming.NameNotFoundException: Name java:comp is not bound in this Context\n        at org.apache.naming.NamingContext.lookup(NamingContext.java:814)\n        at org.apache.naming.NamingContext.lookup(NamingContext.java:197)\n        at org.apache.catalina.realm.DataSourceRealm.open(DataSourceRealm.java:4\n51)\n        at org.apache.catalina.realm.DataSourceRealm.authenticate(DataSourceReal\nm.java:299)\n        at org.apache.catalina.authenticator.FormAuthenticator.authenticate(Form\nAuthenticator.java:274)\n        at org.apache.catalina.authenticator.AuthenticatorBase.invoke(Authentica\ntorBase.java:493)\n        at org.apache.catalina.core.StandardValveContext.invokeNext(StandardValv\neContext.java:149)\n        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav\na:564)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.j\nava:195)\n        at org.apache.catalina.core.StandardValveContext.invokeNext(StandardValv\neContext.java:151)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.j\nava:164)\n        at org.apache.catalina.core.StandardValveContext.invokeNext(StandardValv\neContext.java:149)\n        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav\na:564)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineVal\nve.java:156)\n        at org.apache.catalina.core.StandardValveContext.invokeNext(StandardValv\neContext.java:151)\n        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav\na:564)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)\n        at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:21\n1)\n        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java\n:805)\n        at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.proce\nssConnection(Http11Protocol.java:696)\n        at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java\n:605)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadP\nool.java:677)\n\n\nI am defining all my application context, i.e. the datasource and the \nDataSourceRealm in a context xml file rather than server.xml, althouth I tried \nboth initially.\n\nHere is my application context xml related configuration:\n\n<Context ...>\n  <Logger../>\n  <Realm className=\"org.apache.catalina.realm.DataSourceRealm\"\n         dataSourceName=\"java:comp/env/jdbc/datasourcename\" \n               <!-- I tried also \"jdbc/datasourcename\" only, still no luck -->\n         .../>\n\n  <Resource auth=\"Container\" name=jdbc/datasourcename\"\n    type=\"javax.sql.DataSource\"/>\n  <ResourceParams name=\"jdbc/datasourcename\">\n    <parameter>\n      <name>factory</name>\n      <value>org.apache.commons.dbcp.BasicDataSourceFactory</value>\n    </parameter>\n    <parameter>\n      <name>driverClassName</name>\n      <value>com.mysql.jdbc.Driver</value>\n    </parameter>\n    <parameter>\n      <name>url</name>\n      <value>jdbc:mysql://localhost:port/dbname?autoReconnect=true</value>\n    </parameter>\n    <parameter>\n      <name>username</name>\n      <value>username</value>\n    </parameter>\n    <parameter>\n      <name>password</name>\n      <value>password</value>\n    </parameter>\n  </ResourceParams>The datasource must be a global resource. Please do not reopen this report.*** Bug 26509 has been marked as a duplicate of this bug. ***.Neil Katin provided a clean patch for this, so this has been implemented using a\nsimple flag on the realm.',?,OTHER
25807,'CGI, Can\'t open perl script, No such file or directory bug','Tomcat 5',Servlets:CGI,jemiller,dev,'I am able to use CGI without a problem using Tomcat 4. However, I can\'t get it \nto work with Tomcat. I uncommented the CGI related lines in conf/web.xml and \nTomcat appears to be attempting to execute my CGI Perl script. However, I keep \nreceiving the following error. Note, I know the path to the file is correct as \nI\'m able to view the file using less by pasting the path from the log into the \ncommand line.\n\n2003-12-29 14:24:01 StandardContext[]cgi: runCGI (stderr):Can\'t open perl \nscript \"\"/opt/jakarta-tomcat-5.0.16/webapps/ROOT/WEB-INF/cgi/awstats.pl\"\": No \nsuch file or directory\n2003-12-29 14:24:01 StandardContext[]cgi: runCGI: 1 lines received on stderr\n\nAlso, I just noticed that if I copy server/lib/servlets-cgi.jar from my Tomcat \n4 installation to my Tomcat 5 installation it works just fine, so, it appears \nto be a newly introduced bug.This has been fixed in CVS and will be included in the next release.',?,OTHER
25819,'java.lang.NoClassDefFoundError: org/apache/tomcat/util/buf/C2BConverter','Tomcat 5',Connector:Coyote,dario.bonino,dev,'Exception on first http request. (Low priority)\n    If I push the \"reload button\" the html page is OK.\n    If I send more request this Exception never happen.\n    \n    In attachment:\n    1) Stack trace\n    2) Piece on source in stack trace\n\"it.rgi.webapp.admin.htmlwriter.HtmlWriter.printConclusione(HtmlWriter.java:194)\"\n    3) My catalina.policy (Enabled!)\n\n    thank you,\n    bye.\n\n\n############################################################################################################\n############################################################################################################\n\njava.lang.NoClassDefFoundError: org/apache/tomcat/util/buf/C2BConverter\n\tat org.apache.jk.server.JkCoyoteHandler.appendHead(JkCoyoteHandler.java:333)\n\tat org.apache.jk.server.JkCoyoteHandler.action(JkCoyoteHandler.java:402)\n\tat org.apache.coyote.Response.action(Response.java:226)\n\tat org.apache.coyote.Response.sendHeaders(Response.java:418)\n\tat org.apache.jk.server.JkCoyoteHandler.doWrite(JkCoyoteHandler.java:240)\n\tat org.apache.coyote.Response.doWrite(Response.java:586)\n\tat org.apache.coyote.tomcat5.OutputBuffer.realWriteBytes(OutputBuffer.java:405)\n\tat org.apache.tomcat.util.buf.ByteChunk.flushBuffer(ByteChunk.java:428)\n\tat org.apache.tomcat.util.buf.ByteChunk.append(ByteChunk.java:348)\n\tat org.apache.coyote.tomcat5.OutputBuffer.writeBytes(OutputBuffer.java:438)\n\tat org.apache.coyote.tomcat5.OutputBuffer.write(OutputBuffer.java:425)\n\tat org.apache.coyote.tomcat5.CoyoteOutputStream.write(CoyoteOutputStream.java:108)\n\tat java.io.PrintStream.write(Unknown Source)\n\tat sun.nio.cs.StreamEncoder$CharsetSE.writeBytes(Unknown Source)\n\tat sun.nio.cs.StreamEncoder$CharsetSE.implFlushBuffer(Unknown Source)\n\tat sun.nio.cs.StreamEncoder.flushBuffer(Unknown Source)\n\tat java.io.OutputStreamWriter.flushBuffer(Unknown Source)\n\tat java.io.PrintStream.write(Unknown Source)\n\tat java.io.PrintStream.print(Unknown Source)\n\tat java.io.PrintStream.println(Unknown Source)\n\tat it.rgi.webapp.admin.htmlwriter.HtmlWriter.printConclusione(HtmlWriter.java:194)\n\tat it.rgi.webapp.admin.utility.RgiWebAdminLogin.doLogout(RgiWebAdminLogin.java:231)\n\tat\nit.rgi.webapp.admin.utility.RgiWebAdminLogin.testIfAuthenticationRequiredAdSendLoginPage(RgiWebAdminLogin.java:152)\n\tat it.rgi.webapp.admin.ServletAdmin.doGet(ServletAdmin.java:109)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:743)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n\tat java.lang.reflect.Method.invoke(Unknown Source)\n\tat org.apache.catalina.security.SecurityUtil$1.run(SecurityUtil.java:284)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAsPrivileged(Unknown Source)\n\tat org.apache.catalina.security.SecurityUtil.execute(SecurityUtil.java:306)\n\tat org.apache.catalina.security.SecurityUtil.doAsPrivilege(SecurityUtil.java:200)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:278)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.access$000(ApplicationFilterChain.java:97)\n\tat\norg.apache.catalina.core.ApplicationFilterChain$1.run(ApplicationFilterChain.java:187)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:183)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:256)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\n\tat\norg.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:245)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:199)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:195)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:164)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\n\tat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:156)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:211)\n\tat org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:309)\n\tat org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:387)\n\tat org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:673)\n\tat org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:615)\n\tat org.apache.jk.common.SocketConnection.runIt(ChannelSocket.java:786)\n\tat\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:677)\n\tat java.lang.Thread.run(Unknown Source)\n\n\n\n############################################################################################################\n############################################################################################################\n\npackage it.rgi.webapp.admin.htmlwriter;\n\n ......\n\npublic class HtmlWriter {\n\npublic static void printConclusione(...) throws IOException {\n    final PrintStream out = new PrintStream(response.getOutputStream());\n    ....\n    out.println(\"<TR><TD nowrap width=\\\"100\%\\\"><Font \"+FSTYLE_NORMAL+\">\"+CR);\n/*LINE 194 */ out.println(\"&nbsp; <A\nHREF=\\\"javascript:window.resizeTo(800,720);\\\"><IMG\nsrc=\\\"\"+RgiIcon.URLNAME+\"?duke\\\" ALIGN=\\\"bottom\\\" BORDER=0 ALT=\\\"Resize browser\nto 800x720 pixel.\\\"></A> 100\% pure Java technology.\");\n    out.println(\"&nbsp; Copyright © 2001 <B>RGI SpA</B>\");\n    ....\n    } // printConclusione\n    \n.......\n\n############################################################################################################\n############################################################################################################\n\n// ============================================================================\n// catalina.corepolicy - Security Policy Permissions for Tomcat 5\n//\n// This file contains a default set of security policies to be enforced (by the\n// JVM) when Catalina is executed with the \"-security\" option.  In addition\n// to the permissions granted here, the following additional permissions are\n// granted to the codebase specific to each web application:\n//\n// * Read access to the document root directory\n//\n// $Id: catalina.policy,v 1.10 2003/09/10 18:47:18 remm Exp $\n// ============================================================================\n\n\n// ========== SYSTEM CODE PERMISSIONS =========================================\n\n\n// These permissions apply to javac\ngrant codeBase \"file:${java.home}/lib/-\" {\n        permission java.security.AllPermission;\n};\n\n// These permissions apply to all shared system extensions\ngrant codeBase \"file:${java.home}/jre/lib/ext/-\" {\n        permission java.security.AllPermission;\n};\n\n// These permissions apply to javac when ${java.home] points at $JAVA_HOME/jre\ngrant codeBase \"file:${java.home}/../lib/-\" {\n        permission java.security.AllPermission;\n};\n\n// These permissions apply to all shared system extensions when\n// ${java.home} points at $JAVA_HOME/jre\ngrant codeBase \"file:${java.home}/lib/ext/-\" {\n        permission java.security.AllPermission;\n};\n\n\n// ========== CATALINA CODE PERMISSIONS =======================================\n\n\n// These permissions apply to the launcher code\ngrant codeBase \"file:${catalina.home}/bin/commons-launcher.jar\" {\n        permission java.security.AllPermission;\n};\n\n// These permissions apply to the daemon code\ngrant codeBase \"file:${catalina.home}/bin/commons-daemon.jar\" {\n        permission java.security.AllPermission;\n};\n\n// These permissions apply to the commons-logging API\ngrant codeBase \"file:${catalina.home}/bin/commons-logging-api.jar\" {\n        permission java.security.AllPermission;\n};\n\n// These permissions apply to the server startup code\ngrant codeBase \"file:${catalina.home}/bin/bootstrap.jar\" {\n        permission java.security.AllPermission;\n};\n\n// These permissions apply to the servlet API classes\n// and those that are shared across all class loaders\n// located in the \"common\" directory\ngrant codeBase \"file:${catalina.home}/common/-\" {\n        permission java.security.AllPermission;\n};\n\n// These permissions apply to the container\'s core code, plus any additional\n// libraries installed in the \"server\" directory\ngrant codeBase \"file:${catalina.home}/server/-\" {\n        permission java.security.AllPermission;\n};\n\n// ========== WEB APPLICATION PERMISSIONS =====================================\n\n\n// These permissions are granted by default to all web applications\n// In addition, a web application will be given a read FilePermission\n// and JndiPermission for all files and directories in its document root.\ngrant { \n    // Required for JNDI lookup of named JDBC DataSource\'s and\n    // javamail named MimePart DataSource used to send mail\n    permission java.util.PropertyPermission \"java.home\", \"read\";\n    permission java.util.PropertyPermission \"java.naming.*\", \"read\";\n    permission java.util.PropertyPermission \"javax.sql.*\", \"read\";\n\n    // OS Specific properties to allow read access\n    permission java.util.PropertyPermission \"os.name\", \"read\";\n    permission java.util.PropertyPermission \"os.version\", \"read\";\n    permission java.util.PropertyPermission \"os.arch\", \"read\";\n    permission java.util.PropertyPermission \"file.separator\", \"read\";\n    permission java.util.PropertyPermission \"path.separator\", \"read\";\n    permission java.util.PropertyPermission \"line.separator\", \"read\";\n\n    // JVM properties to allow read access\n    permission java.util.PropertyPermission \"java.version\", \"read\";\n    permission java.util.PropertyPermission \"java.vendor\", \"read\";\n    permission java.util.PropertyPermission \"java.vendor.url\", \"read\";\n    permission java.util.PropertyPermission \"java.class.version\", \"read\";\n\tpermission java.util.PropertyPermission \"java.specification.version\", \"read\";\n\tpermission java.util.PropertyPermission \"java.specification.vendor\", \"read\";\n\tpermission java.util.PropertyPermission \"java.specification.name\", \"read\";\n\n\tpermission java.util.PropertyPermission \"java.vm.specification.version\", \"read\";\n\tpermission java.util.PropertyPermission \"java.vm.specification.vendor\", \"read\";\n\tpermission java.util.PropertyPermission \"java.vm.specification.name\", \"read\";\n\tpermission java.util.PropertyPermission \"java.vm.version\", \"read\";\n\tpermission java.util.PropertyPermission \"java.vm.vendor\", \"read\";\n\tpermission java.util.PropertyPermission \"java.vm.name\", \"read\";\n\n    // Required for OpenJMX\n    permission java.lang.RuntimePermission \"getAttribute\";\n\n\t// Allow read of JAXP compliant XML parser debug\n\tpermission java.util.PropertyPermission \"jaxp.debug\", \"read\";\n\n    // Precompiled JSPs need access to this package.\n    permission java.lang.RuntimePermission\n\"accessClassInPackage.org.apache.jasper.runtime\";\n    permission java.lang.RuntimePermission\n\"accessClassInPackage.org.apache.jasper.runtime.*\";\n    \n};\n\n\n// You can assign additional permissions to particular web applications by\n// adding additional \"grant\" entries here, based on the code base for that\n// application, /WEB-INF/classes/, or /WEB-INF/lib/ jar files.\n//\n// Different permissions can be granted to JSP pages, classes loaded from\n// the /WEB-INF/classes/ directory, all jar files in the /WEB-INF/lib/\n// directory, or even to individual jar files in the /WEB-INF/lib/ directory.\n//\n// For instance, assume that the standard \"examples\" application\n// included a JDBC driver that needed to establish a network connection to the\n// corresponding database and used the scrape taglib to get the weather from\n// the NOAA web server.  You might create a \"grant\" entries like this:\n//\n// The permissions granted to the context root directory apply to JSP pages.\n// grant codeBase \"file:${catalina.home}/webapps/examples/-\" {\n//      permission java.net.SocketPermission \"dbhost.mycompany.com:5432\", \"connect\";\n//      permission java.net.SocketPermission \"*.noaa.gov:80\", \"connect\";\n// };\n//\n// The permissions granted to the context WEB-INF/classes directory\n// grant codeBase \"file:${catalina.home}/webapps/examples/WEB-INF/classes/-\" {\n// };\n//\n// The permission granted to your JDBC driver\n// grant codeBase\n\"jar:file:${catalina.home}/webapps/examples/WEB-INF/lib/driver.jar!/-\" {\n//      permission java.net.SocketPermission \"dbhost.mycompany.com:5432\", \"connect\";\n// };\n// The permission granted to the scrape taglib\n// grant codeBase\n\"jar:file:${catalina.home}/webapps/examples/WEB-INF/lib/scrape.jar!/-\" {\n//      permission java.net.SocketPermission \"*.noaa.gov:80\", \"connect\";\n// };\n\n// ##################### AGGIUNTE MANUALI EFFETTUATE DA BONINO DARIO\n#####################\n\n// These permissions apply to the servlet API classes and those that are shared\nacross\n// all class loaders located in the \"RGI/lib/common\" OR \"RGI/lib/shared\" directory\ngrant codeBase \"file:${catalina.home}/RGI/lib/-\" {\n    permission java.security.AllPermission;\n    };\n\n// Web applications permission, J2EE Specification 1.4\n// Minimum set of permissions that Web Components components can expect. \ngrant {\n\tpermission java.lang.RuntimePermission  \"loadLibrary.*\";\n\tpermission java.lang.RuntimePermission  \"queuePrintJob\";\n\tpermission java.net.SocketPermission    \"*\", \"connect\";\n\tpermission java.io.FilePermission       \"<<ALL FILES>>\", \"read,write\";\n\tpermission java.util.PropertyPermission \"*\", \"read\";\n    };\n\n// RGI JBasis and PassCompagnia requirements\ngrant {\n    permission java.util.PropertyPermission \"user.language\", \"write\"; //\nOPTIONAL, per poter cambiare i \"Regional Settings\"\n    permission java.net.SocketPermission \"*:1024-65535\", \"connect,accept,listen\";\n    // permission java.lang.RuntimePermission \"accessDeclaredMembers\"; // REFLECTION\n    // permission java.security.AllPermission; // DEBUG\n    };\n\n\n\n############################################################################################################\n############################################################################################################For now, the security manager support in TC 5 has been developed and tested with\nthe HTTP connector. The AJP connector may need additional permissions to work\nfor the time being (volunteers needed to add the missing PAs).A missing doPrivileged block is missing and the real exception is hidden for a\nreason I can\'t explain (I don\'t know how jk works...I will take a look). Just\nedit your catalina.properties and clean the following two properties:\n\npackage.access=\npackage.definition=\n\nor just remove org.apache.tomcat. \n\nIt should work.\n\n-- JeanfrancoisBased on the description of the bug, I believe that the patch I\'ve checked in \nwill fix the problem.  However, it will be a couple of days before I can free \nup a server to test Tomcat 5/Apache, so I can\'t really test it.  \n\nI\'d appreciate it if someone could test the Nightly so I could know if I could \nmark this as FIXED.I got a chance to take-down one of my servers sooner than I thought :).\n\nThis is fixed now in the CVS, and will appear in 5.0.17.',?,OTHER
25822,'tomcat shouldn\'t write tomcat-users.xml at startup','Tomcat 5',Catalina,xpoinsard,dev,'I am trying to start tomcat as normal user and carefully adding only required\npermissions and I found that during startup tomcat is writing the file\ntomcat-users.xml. I think it should only write this file when users are\nadded/modified/deleted and I think it would be a bad thing to have to make the\nentire conf directory writeable since it writes a tomcat-users.xml.new and then\nrenames it.\nI am using the standard binaries.\nFor info :\n30 déc. 2003 13:27:34 org.apache.naming.NamingContext lookup\nATTENTION: Une erreur s est produite durant la résolution de la référence\njava.io.FileNotFoundException:\n/usr/local/jakarta-tomcat-5.0.16/conf/tomcat-users.xml.new (Permission denied)\n        at java.io.FileOutputStream.open(Native Method)\n        at java.io.FileOutputStream.<init>(FileOutputStream.java:179)\n        at java.io.FileOutputStream.<init>(FileOutputStream.java:131)\n        at\norg.apache.catalina.users.MemoryUserDatabase.save(MemoryUserDatabase.java:508)\n        at\norg.apache.catalina.users.MemoryUserDatabaseFactory.getObjectInstance(MemoryUserDatabaseFactory.java:144)\n        at\norg.apache.naming.factory.ResourceFactory.getObjectInstance(ResourceFactory.java:176)\n        at javax.naming.spi.NamingManager.getObjectInstance(NamingManager.java:301)\n        at org.apache.naming.NamingContext.lookup(NamingContext.java:837)\n        at org.apache.naming.NamingContext.lookup(NamingContext.java:197)\n        at\norg.apache.catalina.mbeans.GlobalResourcesLifecycleListener.createMBeans(GlobalResourcesLifecycleListener.java:202)\n        at\norg.apache.catalina.mbeans.GlobalResourcesLifecycleListener.createMBeans(GlobalResourcesLifecycleListener.java:172)\n        at\norg.apache.catalina.mbeans.GlobalResourcesLifecycleListener.lifecycleEvent(GlobalResourcesLifecycleListener.java:144)\n        at\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)\n        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2336)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:581)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:398)\n30 déc. 2003 13:27:34\norg.apache.catalina.mbeans.GlobalResourcesLifecycleListener createMBeans\nGRAVE: Exception processing Global JNDI Resources\njavax.naming.NamingException:\n/usr/local/jakarta-tomcat-5.0.16/conf/tomcat-users.xml.new (Permission denied)\n        at org.apache.naming.NamingContext.lookup(NamingContext.java:849)\n        at org.apache.naming.NamingContext.lookup(NamingContext.java:197)\n        at\norg.apache.catalina.mbeans.GlobalResourcesLifecycleListener.createMBeans(GlobalResourcesLifecycleListener.java:202)\n        at\norg.apache.catalina.mbeans.GlobalResourcesLifecycleListener.createMBeans(GlobalResourcesLifecycleListener.java:172)\n        at\norg.apache.catalina.mbeans.GlobalResourcesLifecycleListener.lifecycleEvent(GlobalResourcesLifecycleListener.java:144)\n        at\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)\n        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2336)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:581)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:398)\n30 déc. 2003 13:27:34 org.apache.catalina.core.StandardService startThen use a realm which doesn\'t do that ...Created attachment 9763\npatch to save only when user database is modifiedHere is a simple patch that should prevent unnecessary file modifications.\nCould it be applied or is the \"always write file\" a feature ?How does this patch help?  If modified, you still have to write the file and \ntherefore still require the same directory/security permissions.If you don\'t plan to add users using the web interface, with this patch you can\ndisallow any write in the conf directory and add users only \"by hand\".\nWe could perhaps go further by writing the tempory files tomcat-users.xml.old\nand tomcat-users.xml.new in the temporary directory. Then only write right on\nthe file tomcat-users.xml would be required.\nBut since I am completely ingorant of tomcat internals, I don\'t where we can get\nthe tomcat temporary directory.You could use java.io.tmpdir.  I wish you had discussed this on the mailing \nlist before posting a bug (which I\'ve now modified to an enhancement request).Sorry, but I really thought it was a bug since the default configuration was\nimplying a lower security.\nIs java.io.tmpdir better than something like System.getProperty(\"catalina.base\")\n+ File.separator+ \"temp\" ?\nCreated attachment 9814\nreplacement for previous buggy patch-1 for your revised patch, sorry. Please do not reopen the bug.\nIf you do not agree, write your own custom realm, or use the older memory realm.My previous patch wasn\'t able to detect any user modification.\nSince it seems to have been applied to cvs, here is a patch that remove it and\nuses another method.\nLike discussed before, it uses a temporary file to save the file before\noverwriting the file in conf directory.\nWith this patch, write permission is only necessary for the file\ntomcat-users.xml and not for the entire directory.Sorry, but I\'m not interested. Either something simple works (like your first\npatch), or it doesn\'t. If it doesn\'t then since the \"issue\" is not significant,\nthen the patch will be reverted.My first patch doesn\'t work since it doesn\'t detect user modification.\nMy second remove the first patch and implements the following :\n- use a temporary file for write instead of conf/tomcat-users.xml.new\n- check wether conf/tomcat-users.xml is writable (if it exists)\n- rename the temporary files to conf/tomcat-users.xml\nIt removes the need to write in the directory.\n\nBy the way the old code had a very little bug :\n\n        File fileOld = new File(pathnameNew);\n        if (!fileOld.isAbsolute()) {\n            fileOld =\n                new File(System.getProperty(\"catalina.base\"), pathnameOld);\n        }\n\nwhen I expected \n\n        File fileOld = new File(pathnameOld);\n        if (!fileOld.isAbsolute()) {\n            fileOld =\n                new File(System.getProperty(\"catalina.base\"), pathnameOld);\n        }\n\n\nYour first patch works fine (at least it does what I wanted): the users are no\nlonger saved on startup, while updates using the admin webapp cause the file to\nbe saved.If you only modify an existing user, the change isn\'t detected and won\'t be\nsaved unless you add/remove another user.Created attachment 9829\ncomplete the first patch to correctly detect all modificationsSince you liked my first patch tentative, I completed it by detecting every\nmodifications made to the UserDatabase.\nI hope this could be accepted since it remains simple.Created attachment 9948\npatch containing fix for pathnameOldIf this solution doesn\'t fit, I could provide a ReadOnlyMemoryUserDatabase\nimplementation.',?,RFE
25838,'tomcat-jk.jar is missing all ajp classess','Tomcat 5',Connector:AJP,shiehj,dev,'I donwloaded a win32 binary version of Tomcat and installed on my PC. During \nsetting up JK connector to Apache, I got \"ClassNotFound\" exception when using \norg.apache.ajp.tomcat4.config.ApacheConfig\". Turned out that the whole tomcat-\njk.jar didn\'t have all the AJP classes. Copying a jar file from 4.1.24 with the \nsame name fixed the problem.*** Bug 25839 has been marked as a duplicate of this bug. ***org.apache.ajp.* is deprecated, and will not be available in Tomcat 5. Someone\ncould be interested in porting the functionality.The classes have been moved to the org.apache.jk.config package, and are now\nbundled, thanks to Bill.',?,OTHER
25878,'Host created with Admin Application only ready, after complete tomcat restart','Tomcat 5',Catalina,pr,dev,'The HostConfig are not create with MBeanFactory.createStandardHost, like the \nHostRuleSet do for every Host. The MBeanFactory.createStandardContext create a \nContextConfig. Only with the HostConfig Listener the automatic restart logic \nworks.\n\nAlso fix: After restart StandardHost (stop/start) a second ErrorValve exist. \nNot nice. \n\nAnother thing: Admin Application can\'t reflect automatic changes.\n   I thing we must add a refresh button and build the tree again....\n\nPeterCreated attachment 9783\nMBeanFactory hostconfig patchCreated attachment 9784\nStandard Host only one ErrorValve after restart patchYour patch has been committed. Thanks.',?,BUG
25885,'ApplicationParameter override  test with wrong value at StandardContext','Tomcat 5',Catalina,pr,dev,'StandardContext\n\n1724:ff\n    public void addApplicationParameter(ApplicationParameter parameter) {\n\n        synchronized (applicationParameters) {\n            String newName = parameter.getName();\n                   ######\n            for (int i = 0; i < applicationParameters.length; i++) {\n                if (name.equals(applicationParameters[i].getName()) &&\n                    #######\n                    !applicationParameters[i].getOverride())\n                    return;\n            }\n\nThe overide existing parameter test must be newName and not the Context name:\n\n    public void addApplicationParameter(ApplicationParameter parameter) {\n\n        synchronized (applicationParameters) {\n            String newName = parameter.getName();\n            for (int i = 0; i < applicationParameters.length; i++) {\n                if (newName.equals(applicationParameters[i].getName()) &&\n                    !applicationParameters[i].getOverride())\n                    return;\n            }\n\nPeterFixed. Thanks.',?,BUG
25886,'Feature: PersistenceManager less restrictive at createSession with maxActiveSessions','Tomcat 5',Catalina,pr,dev,'When I set maxActiveSessions > 0 the createSession() throw a \nIllegalStateException as more Session are used. Opps. I thing the \nprocessMaxActiveSwaps() sawp better idle sessions out after intervall.\n\nI have implemented a more less restrictive flag..\n\ns. patch and testcase. I also correct small cast and doc warnings.\n\nPeterCreated attachment 9791\nPersistenceManagerBaseCreated attachment 9792\nPersistenceManagerBaseTestFixed. The check is gone, I don\'t see the point of enforcing the active session\nvalue with a persistent manager.Good desicion !\n\nNow we can remove the rejectedSession Property also ....\n\nthanx\nPeter\n',?,RFE
25889,'JDBCStore hsqldb 1.7.1 connection faild and no connection reconnect after failed','Tomcat 5',Catalina,pr,dev,'Add following feature:\n\n1) The JDBC Store have no connection user and password arguments. Only with \nconnectionURL hsql 1.7.1 not work.\n\n2) after connection failed no auto reconnet.\n\ns. patches\n\nPeterCreated attachment 9794\nJDBCStore PatchCreated attachment 9795\nLocalPropertiesI\'ve applied your patch, which looked ok, but couldn\'t test it. Thanks.Created attachment 13815\nJDBCStore patch\n\nI recently upgraded to TC5.   But to my dismay, it started hammering my\ndatabase so hard that it was \ncrashing periodically.\t Looking at the code for JDBCStore I noticed that it is\nnow running every single \nquery twice even when it succeeds the first time.   I believe the intent was to\ntry to reconnect on a \ndatabase error but the side effect is to create twice as many queries as needed\nwhen the database is up.I have reopened this bug because of the problem introduced by it.   Specifically, each query is now \nbeing run twice even when the first one is successful.Comment on attachment 13815\nJDBCStore patch\n\nnote: this patch should fix the bug introduced by the previous patchI have applied the patch. Thanks.*** Bug 7043 has been marked as a duplicate of this bug. ***',?,BUG
25980,'Documentation relating to where jsp examples are needs update','Tomcat 5',Webapps:Documentation,nagray,dev,'The documentation needs to be updated to point to \n\nhttp://localhost:8080/jsp-examples/security/protected/\n\nInstead of the current\n\nhttp://localhost:8080/examples/jsp/security/protected/Thanks.\nThat page isn\'t really up to date anyway, so many more updates are needed.',?,DOCUMENTATION
26010,' path in server.xml doesn\'t like \"_\" (underscore) character.','Tomcat 5',Catalina,juliusdavies,dev,'stdout and logs/localhost_log.[date].txt complain when a <context> path\nattribute contains a \"_\" (underscore) character.\n\nThe webapp still deploys fine.  The error messages are annoying, that\'s all!  :-)\n\nThis generates error messages (in server.xml):\n<Context path=\"/test_\" debug=\"0\" docBase=\"/stuff/empty\"/>\n\nThis doesn\'t:\n<Context path=\"/test\" debug=\"0\" docBase=\"/stuff/empty\"/>\n\nstdout:\n==============================\nINFO: Processing Context configuration file URL\nfile:/home/juliusdavies/jakarta-tomcat-5/conf/Catalina/localhost/test_.xml\n8-Jan-2004 7:06:23 PM org.apache.commons.digester.Digester endElement\nSEVERE: End event threw exception\njava.lang.reflect.InvocationTargetException\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n[...]\nCaused by: java.lang.IllegalStateException: Context path /test_ is already in use\n        at\norg.apache.catalina.core.StandardHostDeployer.addChild(StandardHostDeployer.java:833)\n        ... 38 more\n\n\nlogs/localhost_log.[date].txt:\n==============================\n2004-01-08 19:06:23 StandardHost[localhost]: Error deploying application at\ncontext path null\njava.lang.IllegalStateException: Context path /test_ is already in use\n        at\norg.apache.commons.digester.Digester.createSAXException(Digester.java:2540)\n\n\n*  Version\njakarta-tomcat-5-bin-20040107\n\n* Tomcat component\norg.apache.catalina.core.StandardHostDeployer.addChild\n\n* Platform\nPC (Intel Pentium III)\n\n* OS\nLinux 2.4.18 (Debian)\n\n* JVM\nJava HotSpot(TM) Server VM (build 1.4.2-b28, mixed mode)\n\n* Web Server\nTomcat 5.0 listening on port 8080\n\n* Configuration\nNo change to default except single line:\n<Context path=\"/test_\" debug=\"0\" docBase=\"/stuff/empty\"/>\n\n\nps.  Am I seeing things?  I noticed that deleting a <Context> from \"server.xml\"\ndoesn\'t actually remove the webapp from service!  The webapp will still deploy\non Tomcat\'s next run.  Tomcat seems to use the conf/Catalina/**/*.xml files it\ncreates to accomplish this.\n\nI get a feeling that <context> inside \"server.xml\" is sort of deprecated, and\nthat I should just create individual \"context\" xml files inside conf/Catalina/\ninstead.Yes, for now, \'_\' can\'t be freely used in a context path, sorry. This will not\nbe fixed for a while. Use \'-\' instead..I have experimented with using \'#\' as a replacement character. If this doesn\'t\nwork well, I will revert the changes and set the bug back to LATER.My fix seems to be working. \'#\' should never end up being the first character,\nso it should work in all cases.',?,OTHER
26039,'spanish translations','Tomcat 5',Catalina,jesus,dev,'I have made some spanish translations. Where do I send them?.Created attachment 9895\nextended spanish translationsThe attachment looks like a jar file.  You need to submit your patch as \na \'diff\' file (preferably using \'cvs diff\') if you want it to be considered.Fixed. Thanks. Indeed, submitting a diff is a lot better.Created attachment 9991\nNew file for jakarta-servletapi-5 jsr154Created attachment 9992\nPatch for jakarta-servletapi-5 jsr154',?,IMPROVEMENT
26051,'HttpSession gets invalidated during service()','Tomcat 5',Catalina,jarno.peltoniemi,dev,'According to the SRV.7.5 in the Servlet spec v2.4:\n\"The session invalidation will not take effect until all servlets using that\nsession have exited the service method.\"\n\nTomcat doesn\'t try to ensure this in any way.\n\nTo reproduce, use a servlet with session-timeout 1 and put the following code to\nthe service method:\n\nHttpSession session = request.getSession();\nThread.sleep(120);\nsession.getLastAccessedTime(); // InvalidStateException gets thrownIndeed. As I don\'t see how to implement this (trying to keep a state flag would\nbe a nightmare, and there\'s no real way to know the state since it is\nmultithreaded), this will not be fixed. Session expiration was calculated wrong,\nand this was fixed. This could help a lot for this case.I should assume we will find a way to fix this, somehow..I have attempted to fix this, using the algorithm you suggested. It could cause\nregressions, so it might be reverted. For now, this should be fixed in the CVS code.*** Bug 26324 has been marked as a duplicate of this bug. ***',?,RFE
26106,'server.xml: setting Manager/pathname=\"\" disable session persistence','Tomcat 5',Webapps:Documentation,gilles,dev,'Documentation page to enhance: tomcat-docs/config/manager.html\n\nBy default tomcat 5 standard session manager enforces session persistence\nthrough tomcat shutdown/restart, which means all session attributes have to be\nserialisable.\n\nIt would be nice to mention that by defining a Manager element inside a Context\nelement, and setting the pathname attribute to an empty string disable session\npersistence.\n\nI guess this could be mentioned in the section \'Restart Persistence\' at the end\nof the page.Fixed.',?,DOCUMENTATION
26135,'Tomcat 5.0.16 leaks memory when a webapp is reloaded or stopped/started','Tomcat 5',Catalina,jporche,dev,'Tomcat 5.0.16 leaks a lot of memory when a webapp is reloaded. To duplicate, \nstart Tomcat.\n\nOpen Windows Task manager and view memory information for the java.exe process.\n\nGo to Tomcat Manager.\n\nReload Tomcat Admin webapp.\n\nMemory will increase for each reload request.  Memory also leaks when \nstopping/starting a webapp, but not as much as reload.  I lost about 15 \nmegabytes of memory after about 10 reload requests.  I waited about 10 to 15 \nminutes to see if memory ever went back down, but it never did.Please post on tomcat-user about this. This is a recurrent non issue.\nIf you want to reopen this bug, please use a profiler and point out leaked\nreferences (under Tomcat\'s control, obviously).I believe this is a bug within Tomcat...\n\nHere is a way to replicate it:\n\nUse the Struts blank war.\nAvailable here:\nhttp://mirrors.isc.org/pub/apache/jakarta/struts/binaries/jakarta-struts-1.1.zip\n\nLoad that webapp, and open two browser windows, one to the Tomcat Manager and\none to the Tomcat Status page.  View the available memory.  You will see it\ncycle within a meg as garbage collection is run.  Then use Tomcat Manager to\nreload the struts webapp.  The free memory should now be a meg less.  This will\ncontinue until you reach 0, when a major garbage collection will occur, but it\njust looks like memory is released, as the Total Memory usage has now increased.\n You can continue this cycle until the memory reaches the total allocated, and\nTomcat will fall over.\n\nIf this is truly a \"non issue\", then I feel the Tomcat developers need to answer\nthis issue more directly (like the release notes).\n\nWe have customers that run multiple occurrences of our webapp under a single\nTomcat, and need to reload... With the leak... they end up having to restart\nTomcat to free the memory... causing support issues.\n\nI look forward to become more educated on why this is (not) an issue...I looked into that already. While the classloader is not being garbage collected\n(this is the only object not being GCed) due to an unknown reason, no references\nare kept to it (as seen in a profiler), so from the Tomcat programming\nperspective, there\'s nothing to fix. Many \"simple\" webapps reload without\nleaking memory, but Struts webapps seem to pose a problem. Of course, there are\nalso ways for a shared library to cause GC trouble when reloading, and this\ncannot be fixed, so you cannot assume a webapp reload will never leak memory.\n\nThere\'s nothing in the release notes, because there\'s no conclusive information\navailable.*** Bug 32709 has been marked as a duplicate of this bug. ***I would have to agree, a memory leak of this magnitude renders the Manager\napplication useless.  If this is something that the Tomcat team will not\naddress, it should be noted in the release notes, or in the Manager App HOW-TO.\n Our organization made number of decisions based on the functionality of the\nManager app that were thrown out once we observed this memory leak.  Although\nthere may be no conclusive evidence showing this is a problem in Tomcat, a\nnumber of people have consistently observed this behavior in the Manager\napplication, and would agree that it is not desired behavior.  To save other\norganizations from going through the problems we did, a simple blurb about this\nknown behavior would be more that appreciated.\n\nThanks,\nJames NormanAfter seaching the net I found that there indeed exists a problem with Struts \nthat prevents web app class loaders from beeing garbage collected. The problem \nis that java beans information used by Struts is cached by \njava.beans.Introspector and never removed. A call to one of the methods \njava.beans.Introspector.flushCaches(), java.beans.Introspector.flushCaches\n(Class) or org.apache.commons.beanutils.PropertyUtilsBean.clearDescriptors() \nwould solve this.\n\nAfter doing a bit more searching I found that the Spring framework solves this \nproblem by providing a servlet context listener class \n(http://www.springframework.org/docs/api/org/springframework/web/util/Introspec\ntorCleanupListener.html) that calls Introspector.flushCaches() when a context \nis destroyed. \n\nTo test this, I modified the web.xml of the struts-examples web app to include \na listener definition using IntrospectorCleanupListener. After that I ran the \nWebPageConnector test program posted by James Norman on bug 32709. The program \nran over 1500 redeploys before i turned it off, at which time the memory \nconsumed by Tomcat (5.5) was about 30MB. Before the modification the program \ncould only run about 110 redeploys before an OutOfMemoryError occurred.\nVery good finding !\nI think I will add that to the stop method of the classloader, like there is a\nmethod to clear the classloader in commons-logging.\n\nThis is a very sneaky issue as the references to the classloader are never\ndisplayed by profilers ... Any other cool features like this in the JDK ?\n\nThe comment in the JDK source is hilarious:\n\n    /**\n     * Flush all of the Introspector\'s internal caches.  This method is\n     * not normally required.  It is normally only needed by advanced\n     * tools that update existing \"Class\" objects in-place and need\n     * to make the Introspector re-analyze existing Class objects.\n     */\nThat got it.  Thanks to all who resolved this, we can now run multiple apps\ninside of 1 tomcat.\n\n<snip>\n  Any other cool features like this in the JDK ?\n</snip>\n\nJust that super cool System.getProperties()\n\nThis is the same solution as was found previously in the following two bugs...\nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=26372\nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=27371\n\nThe solution was originally (as far as I know) found here...\nhttp://marc.theaimsgroup.com/?t=109578393000004&r=1&w=2\n\n\nIt would have been nice to have recognized this information back in September\n\'04 when Yoav posted references to the solution rather than having to re-figure\nit out independently in January \'05 and finaly take action.  In any case, I\'m\nglad it is finally fixed!\n\n\nJakeThis issue is incorrectly closed as WON\'T FIX even though the 5.5.8 changelog\nmarks it as fixed. Please reclose it as fixed.Oops, I can do this myself :)*** Bug 36548 has been marked as a duplicate of this bug. ***',?,BUG
26147,xsi:schemaLocation,'Tomcat 5',Webapps:Examples,rajutv,dev,'Hi\n\nI had verified xsi:schemaLocation in web.xml file under \'/webapps/jsp-\nexamples/WEB-INF/\' folder, it shows\n   xsi:schemaLocation=\"http://java.sun.com/xml/ns/j2ee web-app_2_4.xsd\"\n\ncorrect location is\nxsi:schemaLocation=\"http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd\"\n\n\nAnd also same in all web.xml files.Fixed. Thanks.According to XML Schema 1.0 spec at http://www.w3.org/TR/xmlschema-\n0/#schemaLocation,\n\nThe schemaLocation attribute contains pairs of values: The first member of \neach pair is the namespace for which the second member is the hint describing \nwhere to find to an appropriate schema document.\n\nHere\'s an excerpt from Sun\'s J2EE 1.4 RI samples:\n\n<web-app version=\"2.4\" xmlns=\"http://java.sun.com/xml/ns/j2ee\" \nxmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \nxsi:schemaLocation=\"http://java.sun.com/xml/ns/j2ee \nhttp://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd\">\n\nI guess \n\nxsi:schemaLocation=\"http://java.sun.com/xml/ns/j2ee web-app_2_4.xsd\"\n\ncan be validly used by some catalog system (equipped in Tomcat).\n\nIn conclusion, \nhttp://marc.theaimsgroup.com/?l=tomcat-dev&m=107417121117386&w=2\nshould be rolled back or \n\nxsi:schemaLocation=\"http://java.sun.com/xml/ns/j2ee \nhttp://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd\"\n\ncan be another alternative.\nThanks for the comments. I checked in the specification this time.',?,BUG
26162,'Typo in conf/server-minimal.xml','Tomcat 5',Unknown,yannc76,dev,'Line 14 has a typo which prevents the MemoryUserDatabaseFactory to work:\n\n<name>pathaame</name>\n          ^ \n\nshould be changed to\n\n<name>pathname</name>Fixed. Thanks.',?,BUG
26171,'NullPointerException in AccessLogValve','Tomcat 5',Catalina:Modules,sarmbruster,dev,'context.xml contains a AccessLogValve. After \"install\" (via ant task) everything\nworks. A subsequent \"remove\" and \"install\" of the same webapp cause the error\nbelow after pressing the reload button  in an existing session in the client\nbrowser:\n\n15.01.2004 16:39:50 org.apache.coyote.tomcat5.CoyoteAdapter service\nSCHWERWIEGEND: An exception or error occurred in the container during the\nrequest processing\njava.lang.NullPointerException\n        at\norg.apache.catalina.valves.AccessLogValve.getDate(AccessLogValve.java:1030)\n        at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:589)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\n        at\norg.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:195)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n        at\norg.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:164)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\n        at\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:156)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)\n        at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:211)\n        at\norg.apache.coyote.http11.Http11Processor.process(Http11Processor.java:805)\n        at\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:696)\n        at\norg.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:605)\n        at\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:677)\n        at java.lang.Thread.run(Thread.java:534)\n\nLooks like currentDate is not initialized under certain circumstances.Added a null check in the relevant method, which will generate a new date \nobject only if needed.  I wonder why the lifecycle start wasn\'t taking care of \nthis.',?,BUG
26191,'ClassCastException in JspDocumentParser','Tomcat 5',Jasper,trond,dev,'from JspDocumentParser.java Revision: 1.74\nlines 233-240\n        } catch (Exception e) {\n            jspDocParser.err.jspError(\n                new Mark(\n                    path,\n                    ((SAXParseException)e).getLineNumber(),\n                    ((SAXParseException)e).getColumnNumber()),\n                e.getMessage());\n        }\n\n\nSAXException thrown at line 1057 of JspDocumentParser.java results in\nClassCastExceptionCreated attachment 9976\nProposed patchI have to agree the code is usafe. It probably should be:\n} catch (SAXParseException e) {\n  // Do what we currently do\n} catch (SAXException e) {\n  // Reduced functionality (no line info)\n} catch (Exception e) {\n  // Unexpected error\n}Fixed. Thanks.',?,BUG
26229,'request.getRemoteUser() = null','Tomcat 5',Connector:AJP,soren,dev,'I have made a new installation of Tomcat 4.1.29 on my new DELL laptop running \nXP.\n\nI have copied the project to the new laptop and try set it up to work as on my \nwork machine.\n\nI am not able to get the login to work. I am using the <security-constraint> in \nmy web.xml.\n\nAt first I could not get the FORM login to work only BASIC. Then I changed the \nFORM action to <\%= response.encodeURL(\"j_security_check\") \%>, and I was able \nuse FORM login.\n\nThe next problem is that the auth is only accepted for the page that activated \nthe FORM page. For example <url-pattern>/public/*</url-pattern> contains \ntest.jsp and test2.jsp and when I link to test.jsp the FORM page is called. \nWhen succesfully logged in the request.getRemoteUser() is correct. But when I \nthen link from there to test2.jsp the request.getRemoteUser() is NULL and the \nFORM page is called again.\n\nPlease let me know if I sould send more info.Also when I have logged on to a page and press F5 (refresh) the FORM page is \ncalled and remoteUser is NULL.Sorry. The following is a mistake:\n******************************************\n\"Also when I have logged on to a page and press F5 (refresh) the FORM page is \ncalled and remoteUser is NULL.\"\n******************************************I know what is causing the problem now. It is one of the newest \"important \nupdates\" from Microsoft Update for XP.\n\nMore specificly:\n\n824145 Internet Explorer 6.0 security update.\n\nWhen uninstalling, it works again!This isn\'t a browser-specific thing as far as I can see - I\'ve tested with\nMozilla and IE.\n\nApache 1.3.29, JK2 2.0.2, Tomcat 4.1.29 all conspire (even with the\nrequest.tomcatAuthentication=false setting in jk2.properties) to somehow pass on\nthe appropriate headers, yet the remoteUser just isn\'t available to applications\n- in my case, that\'s a Cocoon 2.1.3 application, but the Cocoon stuff doesn\'t\nseem to be at fault.\n\nHowever, it all works fine in Tomcat 4.1.27, so I should imagine that something\nchanged between Tomcat releases and it all stopped working. Either that or the\nCocoon developers misunderstood some subtle aspect of the servlet specification,\nbut that doesn\'t seem likely to me.I\'ve experienced this as well. Ths solution seems to be to disable the native \nTomcat authentication on the connector as follows: \n \n    <!-- Define a Coyote/JK2 AJP 1.3 Connector on port 8009 --> \n    <Connector className=\"org.apache.coyote.tomcat4.CoyoteConnector\" \n               port=\"8009\" minProcessors=\"5\" maxProcessors=\"75\" \n               enableLookups=\"true\" redirectPort=\"8443\" \n               acceptCount=\"10\" debug=\"0\" connectionTimeout=\"0\" \n               useURIValidationHack=\"false\" tomcatAuthentication=\"false\" \n \n(The important part of the above being <b>tomcatAuthentication=\"false\"</b>.) \n \nI will follow up on this and let you know if it fixes my problem. Are the rest \nof you able to verify that this is indeed the solution (in which case I will \nclose this bug) ? This bug report has been transferred to Tomcat 5 because TC4 and TC5 share the \nconnectors and TC5 is now the focus of development effortYup, you need to turn that off.  In Tomcat 5, it\'s called clientAuth instead of \ntomcatAuthentication, and the Connector and SSL documentation pages have been \nupdated to reflect the attribute name change.',?,BUG
26237,'Use of absolute path for MemoryUserDatabase file may cause problem','Tomcat 5',Catalina,xpoinsard,dev,'I found a typo in MemoryUserDatabase.java line 555 with handling of absolute pathCreated attachment 10005\npatch to correct typoFixed. Thanks.',?,BUG
26242,' task','Tomcat 5',Jasper,stevel,dev,'Hi,\n\nWe are getting reports coming in that the latest releases of jasper are breaking\nAnt\'s <jspc> task, because that sets the verbosity option for output control,\nand changes in the args are breaking things. See bugrep #25345 for details.\n\nI think the immediate fix for ant1.6.1 would be to not pass on verbosity info,\nbut   we are bound to keep getting many reports about the same break with 1.6.0\nand 1.5; so please can you bring back the old -v0 style of option, and make\nchanges to the command mechanism in a more backwards compatible way in future\n-where possible.\n\nTa,I don\'t see the point of Ant documenting this, or having the pre declared task.\nAny reason for this ? Forward compatibility is one thing, but given other\nchanges in jspc behavior, I doubt it would still work.\n\nTomcat now properly documents the task and how to use it.Remy,\n\nIt is not so much that we document the Jasper task, but that we ship with our\nown task which \nis meant to support different back ends:\nhttp://ant.apache.org/manual/OptionalTasks/jspc.html\n\nIn theory that is, in practise we have left WebLogic alone until someone was\nprepared to write the adapter, so instead it supports various Tomcat 4.x\nreleases, handling name mapping appropriately.\n\nGiven it is therefore purely Jasper-centric (as far as we know), there is a lot\nto be said for killing the task and saying \'use the Tomcat supplied one\'; I\'d be\nhappy with that as it eliminates all version issues and makes bug hunting\neasier. This is something we can discuss for the 1.7 release. \n\nBut in the meantime, there are people out there using the Ant project\'s jasper\nadapter, and that one builds a java command with the -vN option, where N is a\nverbosity metric. If that is all that has changed, can we please, please, please\nhave it back :)\n\nBTW, what other changes have there been that would break stuff? Just so we know\nwhat to expect in bugreps?I\'ve added back the setter.',?,BUILD_SYSTEM
26261,'Another session timeout problem (similar to 25234)','Tomcat 5',Catalina,Paul.Harvey,dev,'HttpSessionListener called twice on session expiration.\n\nThe problem seems to be very similar to 25234.\n\nThis time the extra expires() is being called from evaluateIfValid() in\nStandardSession (the call to isValid() in evaluateIfValid() also calls \nexpires())\n\nI have commented out the extra call to expires() in my version which seems to \nfix the problem.This will happen rarely, though. Thanks.',?,BUG
26276,'Generated TLD inconsistent after tagfile changes','Tomcat 5',Jasper,krueger,dev,'It seems that the generated TLD is not updated for tagfiles after certain\nmodifications (e.g. changing attribute names of the tag) and therefore the\ngenerate source code is incorrect. Can easily be reproduced by changing an\nattribute\'s name of a tag in a tag file (the source code is regenerated after\nthe modification but does not contain the corresponding setter). This indicated\nthat the generated TLD is not updated to reflect the modification and therfore\nthe source code is generated on old metadata. See attached webapp for a test\ncase. Instructions for reproduction are on the startpage of the webapp.Created attachment 10022\nzip file containing test webapp with instructionsI did some more research. This is actually what happens: If both the jsp using\nthe tag and the tagfile have been modified, the tag class is generated but with\nan outdated TagInfo, thus the source code contains the old state (e.g. attributes).\n\nThis is because the old wrapper is not removed from the wrapperCache in\nJspRuntimeContext and the associated CompilationContext containing the outdated\nTagInfo is used for generating the tag\'s source code. After that it\'s a real\nmess because the timestamp of the tag of coures has changed and therefore jasper\nthinks the generated tag is up to date.\n\nTo fix this I put the following lines in the method Compiler.isOutDated(boolean)\n\n        targetLastModified = targetFile.lastModified();\n        if (targetLastModified < jspRealLastModified) {\n+            if(ctxt.isTagFile()){\n+               ctxt.getRuntimeContext().removeWrapper(ctxt.getJspFile());\n+            }\n            if (log.isDebugEnabled())\n                log.debug(\"Compiler: outdated: \" + targetFile + \" \" +\ntargetLastModified);\n            return true;\n        }\n\nI\'m new to jasper and anything but sure that this is a valid solution or if it\nhas negative side effects but as far as I can see it seems to work. I\'m not sure\nwhy removeWrapper is currently only called when a tag file is found to be\nmodified as part of the dependents list of a jsp (which is why it does not work\nnow if the jsp was modified as well because isOutDated returns before it gets to\nthat check).   \n\n Fixed.\n\nYou proposed is not quite right, but thanks for reporting, and for taking time\nlooking for a fix.',?,BUG
26335,'Modification check for tagfiles does not work recursively','Tomcat 5',Jasper,krueger,dev,'Example: \ntag1 defined in a tagfile\ntag2 defined in a tagfile which uses tag1\ntag3 defined in a tagfile which uses tag2\nindex.jsp uses tag3\ntagfile for tag1 is modified, reload of index.jsp does not reflect the changes\ndespite of development mode. see attached web application for a test case.\ninstructions to reproduce are on the welcome page.Created attachment 10050\nweb application with test caseFixed.  Thanks for providing good test case.',?,BUG
26341,'It\'s possible to call getAttribute() while session is invalidated without IAE','Tomcat 5',' JSP API',lbe.tech,dev,'While the session is invalidated all SessionBindingListener are notified with\nvalueUnbound(). In valueUnbound() it\'s possible to call e.g. getAttribute() on\nthe invalidating session without getting an IllegalArgumentException (which\nwasn\'t possible in Tomcat 4.1.29). And according to the servlet-spec (2.3 or\n2.4) it shouldn\'t be possible:\n\nExcept from HttpSession-API\n...\nFor session that are invalidated or expire, notifications are sent after the\nsession has been invalidatd or expired.\n...\n\nI would interpret this as: The valueUnbound() should be called AFTER the session\nis invalidated and so I have to get an IAE when calling session.getAttribute()\nin valueUnbound().\n\nThanks LarsI have this big urge about reverting the fix for \"bug\" 26051, and classify it as\na \"this will never be fixed\" issue. It would definitely avoid lots of problems.If I understand you right, you want to set this bug to \"will never be fixed\" and\nnot the other (26051), right?\nIf this bug won\'t be fixed, it\'s not possible for bound objects to determine if\nthey are unbound because of a normal removeAttribute()-call or a\nsession-invalidation.\nThe following scenario is not possible with tomcat 5:\nThe bound object has to do nothing if the value is simply removed from the\nsession (e.g. it is replaced by a proxy object and later restored again) and has\nto free some resources if the session is invalidated. \nWith tomcat 4 I could call session.getAttribute() and catch the IAE to know the\nsession is invalid (session.isValid() would be a nice method) - this doesn\'t\nwork with tomcat 5.\nI was obviously talking about 26051 (additional fixes are also needed in quite a\nfew places to really adress it).BTW, this works with 5.0.18, but not with the nightly (because of the new\naccessCount check in isValid()), right ? If it doesn\'t work, I don\'t understand\nhow it can be, and recommend you add debug in the StandardSession.expire and\nisValid to see what\'s going on.\nI recommend not using the nightlies for now: a few features will be added and\nthey will not be as stable as what they used to be.BTW: In my earlier submits I said IllegalArgumentException but meant\nIllegalStateException.\n\nMy problem occurs in 5.0.16, 5.0.18, nightly build (01/21/2004) because of the\nfollowing code in catalina.session.StandardSession (the implementation-excerpts\nbelow haven\'t changed since 5.0.16):\n\ninvalidate () { expire(); }\nexpire () { expire(true); }\nexpire(boolean)\n{\nthis.expiring=true;\n//invalidate session\nthis.expiring=false;\n}\n\ngetAttribute()\n{\nif (! isValid()) throw IllegalStateException ();\n...\n}\n\nisValid()\n{\nif (this.expiring) return true;\n...\n}\n\nSo while the invalidation the session is always valid.\nI forgot about the flag. This is contradicting the new policy about the session\nbeing still useable when the expiration notification is sent. I think\nconfirmation this is as intended is needed, otherwise, notification for\nattributes will have to be handled as yet another special case (or we\'ll have to\ndecide we don\'t care).How about setting \"expiring\" to FALSE *before* removing any attributes,\nand adding a \"backdoor\" into removeAttribute() that by-passes the validity\ncheck, as follows:\n\nIndex: StandardSession.java\n===================================================================\nRCS file:\n/home/cvs/jakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/session/StandardSession.java,v\nretrieving revision 1.29\ndiff -u -r1.29 StandardSession.java\n--- StandardSession.java        19 Jan 2004 23:39:05 -0000      1.29\n+++ StandardSession.java        22 Jan 2004 22:44:30 -0000\n@@ -706,19 +706,24 @@\n             if (manager != null)\n                 manager.remove(this);\n\n+            /*\n+             * Mark session as expired *before* removing its attributes, so\n+             * that its HttpSessionBindingListener objects will get an\n+             * IllegalStateException when accessing the session attributes\n+             * from within their valueUnbound() method\n+             */\n+            expiring = false;\n+\n             // Unbind any objects associated with this session\n             String keys[] = keys();\n             for (int i = 0; i < keys.length; i++)\n-                removeAttribute(keys[i], notify);\n+                removeAttribute(keys[i], notify, false);\n\n             // Notify interested session event listeners\n             if (notify) {\n                 fireSessionEvent(Session.SESSION_DESTROYED_EVENT, null);\n             }\n\n-            // We have completed expire of this session\n-            expiring = false;\n-\n         }\n\n     }\n@@ -1133,7 +1138,7 @@\n      */\n     public void removeAttribute(String name) {\n\n-        removeAttribute(name, true);\n+        removeAttribute(name, true, true);\n\n     }\n\n@@ -1150,14 +1155,17 @@\n      * @param name Name of the object to remove from this session.\n      * @param notify Should we notify interested listeners that this\n      *  attribute is being removed?\n+     * @param checkValid Indicates whether IllegalStateException must be\n+     * thrown if session has already been invalidated\n      *\n      * @exception IllegalStateException if this method is called on an\n      *  invalidated session\n      */\n-    public void removeAttribute(String name, boolean notify) {\n+    public void removeAttribute(String name, boolean notify,\n+                                boolean checkValid) {\n\n         // Validate our current state\n-        if (!isValid())\n+        if (checkValid && !isValid())\n             throw new IllegalStateException\n                 (sm.getString(\"standardSession.removeAttribute.ise\"));\nYes, I know how to fix this. Howerver, this is weird when compared to how\nsessionDestroyed is handled, so I was wondering if it was valid.Just a comment:\n\nI have a hard need to be able to getAttribute() from within an\nHttpSessionListener\'s sessionDestroyed() method.  I believe I should be able to\naccess any/all attributes for the duration of this call, i.e. that attribute\nremoval and/or invalid-state settings should be after sessionDestroyed() calls.\n\n[The reason I need the attributes is that HttpSessionListener knows/receives\n*nothing* apart from the HttpSession.  Oddly enough my listener needs to know\n*something* else.]To finish my last vague comment:\n\nI put the \"something else\" my listener needs to know into the session via a filter.Yes, inside sessionDestroyed, you should still have all access to the session.\nThis is new in Servlet 2.4, AFAIK. This should stay in, and I think this is a\nproblem with Jan\'s patch. I simply intend to move the remove attribute call\nafter the expiring = false (and add a protected removeAttributeInternal method,\nof course).Thanks for the heads-up.  My code did indeed fail in Tomcat 4.1 but work fine in\nTomcat 5.0.18.  [I\'ve since fixed it for 4.1 as well.]',?,OTHER
26373,'getServletContext().getRequestDispatcher() fails','Tomcat 5',' JSP API',mguillemot,dev,'In the init() method of a servlet, I\'ve got the followin code:\n\nrd_ = getServletContext().getRequestDispatcher(\"/internal/router.do\");\n\nwith Tomcat 5.0.16, I become null!!!\n\nIn Tomcat 4.1.29, this works correctly.I believe this works correctly (many test cases are based on this). Please\nsubmit a ready to use test case (packaged as a minimal .war) if you want to\nreopen this.Created attachment 10101\nWeb app with a single servlet trying to get a request dispatcherIn the attachment 10101 is a mini Webapp working under Tomcat 4.1.29 and failing\nunder Tomcat 5.0.16 with the following log:\n\n2004-01-27 21:04:11 StandardContext[/TestWebApp2]testServlet: Getting request\ndispatcher for path: /toto.jsp\n2004-01-27 21:04:11 StandardContext[/TestWebApp2]Error during mapping\njava.lang.NullPointerException\n        at\norg.apache.tomcat.util.http.mapper.Mapper.internalMapWrapper(Mapper.java:644)\n        at org.apache.tomcat.util.http.mapper.Mapper.map(Mapper.java:536)\n        at\norg.apache.catalina.core.ApplicationContext.getRequestDispatcher(ApplicationContext.java:462)\n        at\norg.apache.catalina.core.ApplicationContextFacade.getRequestDispatcher(ApplicationContextFacade.java:243)\n        at de.internetzky.test.TestServlet.init(TestServlet.java:62)\n        at javax.servlet.GenericServlet.init(GenericServlet.java:256)\n        at\norg.apache.catalina.core.StandardWrapper.loadServlet(StandardWrapper.java:1044)\n        at org.apache.catalina.core.StandardWrapper.load(StandardWrapper.java:887)\n        at\norg.apache.catalina.core.StandardContext.loadOnStartup(StandardContext.java:3948)\n        at org.apache.catalina.core.StandardContext.start(StandardContext.java:4271)\n        at\norg.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:866)\n        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:850)\n        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:633)\n        at\norg.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:316)\n        at org.apache.catalina.core.StandardHost.install(StandardHost.java:859)\n        at org.apache.catalina.startup.HostConfig.deployWARs(HostConfig.java:653)\n        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:472)\n        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1002)\n        at\norg.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:393)\n        at\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1133)\n        at org.apache.catalina.core.StandardHost.start(StandardHost.java:816)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1125)\n        at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:518)\n        at org.apache.catalina.core.StandardService.start(StandardService.java:519)\n        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2343)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:581)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:398)\n\n2004-01-27 21:04:11 StandardContext[/TestWebApp2]testServlet: rd: null\n2004-01-27 21:04:11 StandardContext[/TestWebApp2]Servlet /TestWebApp2 threw\nload() exception\njavax.servlet.ServletException: Failed initialization of request dispatcher for\npath >/toto.jsp<\n        at de.internetzky.test.TestServlet.init(TestServlet.java:70)\n        at javax.servlet.GenericServlet.init(GenericServlet.java:256)\n        at\norg.apache.catalina.core.StandardWrapper.loadServlet(StandardWrapper.java:1044)\n        at org.apache.catalina.core.StandardWrapper.load(StandardWrapper.java:887)\n        at\norg.apache.catalina.core.StandardContext.loadOnStartup(StandardContext.java:3948)\n        at org.apache.catalina.core.StandardContext.start(StandardContext.java:4271)\n        at\norg.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:866)\n        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:850)\n        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:633)\n        at\norg.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:316)\n        at org.apache.catalina.core.StandardHost.install(StandardHost.java:859)\n        at org.apache.catalina.startup.HostConfig.deployWARs(HostConfig.java:653)\n        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:472)\n        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1002)\n        at\norg.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:393)\n        at\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1133)\n        at org.apache.catalina.core.StandardHost.start(StandardHost.java:816)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1125)\n        at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:518)\n        at org.apache.catalina.core.StandardService.start(StandardService.java:519)\n        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2343)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:581)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:398)Ah, ok, it was only with a load on startup servlet.Yes it was \"only\" with a load on startup servlet. \nWhy FIXED? I don\'t see any mention of such a fix in the changelog of 5.0.17 or\n5.0.18. Can you be a bit more explicit. Thanks.FIXED = fixed in CVS, will be in the next release.',?,BUG
26414,'UserTransaction bound in comp/env Context when using ResourceLink','Tomcat 5',Catalina,krueger,dev,'currently it is not possible to use ResourceLinks to bind a UserTransaction in\nthe java:comp context of a web application because the way it is implemented\nResourceLinks are always bound in the java:comp/env context. I stumbled across\nthis because I thought it would make sense to configure my transaction manager\nonly in one place and have all my webapps access it via ResourceLinks instead of\ncopying the configuration for each webapp but that did not work. The current\nbehaviour is a little hard to understand and IMHO it doesn\'t hurt to treat\nResourceLinks pointing to a UserTransaction differently. I have attached a patch\nthat does this. Testing the patch I found that the Context implementation does\nnot seem to throw NameAlreadyBoundException when a name already exists and a\nbind fails (therefore after applying the patch you get a warning whenever a\nUserTransaction is bound via a ResourceLink). Shall I file this as a separate\nreport?\n\nThanks in advanceCreated attachment 10082\nPatch for proposed enhancementI think I\'m ok with your patch. However I have a question: did you try to add\nthe needed resource for the transaction in a DefaultContext ?No, I didn\'t, since in my case I have the webapps sharing the transactionmanager\ndeployed in separate services. \n\nBTW I\'ll attach a patch for the wrong Exception type thrown in\norg.apache.naming.NamingContext implementation. Then my other patch will not\ncreate a warning anymore.\n\n Created attachment 10083\nFixes Exception thrown when bind fails because the name is already boundFixed, thanks.',?,RFE
26432,'jsp-property-group url-pattern does not map correctly for paths','Tomcat 5',Jasper,tivv,dev,'Currently jsp-property-group url-pattern does not maps correctly for pathes. It\nthinks that path url-pattern /xxx/* maps for /xxx/my.jsp but not for\n/xxx/yyy/map.jsp.\nSo, now it is impossible (at least I can\'t find a way) to map some property\ngroup to all jsp pages: \"/\" does not go trough validate process (btw:should not\nit point to \"all\" according to specs? specs say that url-pattern is mathes same\nas for servlets and for servlets \"/\" means default servlet - it would be logical\nfor \"/\" working as \"all\") and \"/*\" means only \"pages in the root folder\".This is now fixed.  /xxx/* maps /xxx/yyy/map.jsp correctly now.\n\nThe url pattern \"/\" is meaningless in this context, since it is mapped to the\ndefault servlet, so it is ignored.  I\'ll need to talk with JSP spec lead on this.',?,BUG
26487,'JNDIRealm not working - using incorrect filter','Tomcat 5',Catalina:Modules,jimmidyson,dev,'When using the JNDIRealm, no role checking succeeds. Looking at the debug, this \nis due to an incorrect search filter being created, prepending and appending \ninvalid characters (\\28 and \\29) to the filter. The server.xml works fine on \nprevious versions. This occurs on both Windows and Linux. Log output:\n\n2004-01-27 14:48:02 JNDIRealm[Catalina]: Username tomcat successfully \nauthenticated\n2004-01-27 14:48:02 JNDIRealm[Catalina]:   getRoles(uid=tomcat,dc=test,dc=com)\n2004-01-27 14:48:02 JNDIRealm[Catalina]:   Searching role base \'dc=test,dc=com\' \nfor attribute \'cn\'\n2004-01-27 14:48:02 JNDIRealm[Catalina]:   With filter expression \n\'\\28uniqueMember=uid=tomcat,dc=test,dc=com\\29\'I\'ll look at this and see if it has to do with my recent patch for an encoding \nissue.  Could you please post your realm tag from server.xml, exactly as it \nappears?Here\'s my server.xml:\n\n<Server port=\"8005\" shutdown=\"SHUTDOWN\">\n  <Service name=\"Catalina\">\n    <Connector port=\"8080\" />\n\n    <!-- This is here for compatibility only, not required -->\n    <Connector port=\"8009\" protocol=\"AJP/1.3\" />\n\n    <Engine name=\"Catalina\" defaultHost=\"localhost\">\n      <Logger className=\"org.apache.catalina.logger.FileLogger\" />\n\n      <Realm\tclassName=\"org.apache.catalina.realm.JNDIRealm\"\n                connectionURL=\"ldap://lldapv.ldn.bzwint.com:389\"\n      \t\tdebug=\"99\" \n      \t\troleBase=\"ou=intranet,dc=barcapint,dc=com\"\n      \t\troleName=\"cn\" \n      \t\troleSearch=\"(uniqueMember={0})\" \n      \t\troleSubtree=\"true\" \n      \t\tuserBase=\"ou=intranet,dc=barcapint,dc=com\" \n      \t\tuserSearch=\"uid={0}\" \n      \t\tuserSubtree=\"true\"\n    \t/>\n\n      <Host name=\"localhost\" appBase=\"webapps\" />\n    </Engine>\n  </Service>\n</Server>\nAhh, I see the problem.  I did the RFC 2254 encoding on the whole search string \nwe were using, whereas it should only be done on the DN that the user enters, \nso you would go from a DN of  \"some(Strange)Username\" to a role search string \nof (uniqueMember=some\\28Strange\\29Username), not \n\\28uniqueMember=some\\28Strange\\29Username\\29\nI\'ll post the simple patch to make the encoding more focused.Created attachment 10244\nSimple fix in JNDIRealm for this problem against 5.x sourceIf somebody could commit this to Tomcat 5, and back port it (very very simple \nin this case since the JNDIRealm code is nearly identical in the two branches) \nto Tomcat 4, I would be much obliged.  Thanks.Patch applied to tomcat 4.1 and tomcat 5. Thanks Jeff!*** Bug 26834 has been marked as a duplicate of this bug. ****** Bug 26888 has been marked as a duplicate of this bug. ****** Bug 26834 has been marked as a duplicate of this bug. ***',?,BUG
26492,'Strange Session id behavior','Tomcat 5',Unknown,grelli,dev,'I\'m maintaining a JSP/servlet web using SSL, running on Apache 2.0.48 and Tomcat\n5.0.18.\nCookies are used for session identifier communication (not url rewriting).\n\nSome users using the web are experiencing very strange session id behaviour, the\nbehaviour is like this:\nWhen these users make their first request to the web, they already have an\nsession id that is invalid, i.e. request.getRequestedSessionId() is not null and\nthe id is not a session id that has been recently created by Tomcat (I\'ve a\nsession listener in Tomcat that logs session creation and destruction).\nAs expected, Tomcat creates a new session id for the users (because the session\nid is invalid) but the next requests from the users do not use that session id\nbut instead continue to use the session id that they used in the first request.\n So Tomcat continues to create new session ids for each request, example:\n\nrequest.getRequestedSessionId()\trequest.getSession(false).getId()\nrequest.getRequestURI()\n01A960C22480CE9F445CDE48DE333F31\t451BA13F85AE631148022C93DFDD2811\t/first_request.jsp\n01A960C22480CE9F445CDE48DE333F31\tCBF44C3C065502D6397BC44A7AB659F9\n/second_request.jsp\n01A960C22480CE9F445CDE48DE333F31\t6453C03AF5DD2B9EA1F27D225589E8B2\t/third_request.jsp\n01A960C22480CE9F445CDE48DE333F31\t93F173966F28A972A2E70C32CC8E848B\n/fourth_request.jsp\n\nIf the users close their browser and try again - they (most often) continue to\nhave the same problem but request.getRequestedSessionId() is not the same as it\nwas at last time...\n\nWhat could be the reason for this behaviour?This works reasonably well. However, if the client submits more that one session\ncookie, only the first one is takes into account right now. I think there\'s a\nbug or enhancement about that for 4.1.x.I\'ve fixed this.Thanks Remy for your reply\'s to this \"bug\" if is a bug in TomCat. \n\nAs I understand from your reply\'s there are some fix to this problem. Is the fix\nin the nightly build ore ca I get it by other ways?',?,RFE
26567,'defaultHost=\'\' incorrect causes no error','Tomcat 5',Catalina,alex,dev,'When the defaultHost attribute on Engine is not correctly pointing to a Host\nelement\'s name, there are no errors generated and no error documents are returned\nto the web browser.  This can cause, in my case, many hours of \"debugging\" until\nyou realize this.  In fact, no log entries are generated for access, etc.\n\nThis is a big \"useability\" issue for setting up new servers.Fixed. A warning message will now be logged during initialization.',?,IMPROVEMENT
26611,'Improper handling of javax.servlet.forward.request_uri during a forward and then an include','Tomcat 5',Catalina,kschneider,dev,'Basically, it looks like \"javax.servlet.forward.request_uri\" is part of the\nenumeration returned by request.getAttributeNames even though\nrequest.getAttribute(\"javax.servlet.forward.request_uri\") returns null. Here\'s a\nsimple test setup:\n\nforward.jsp:\n------------\n<jsp:forward page=\"${param.forward}\"/>\n\ninclude.jsp:\n------------\n<\%@ page contentType=\"text/plain\" \%>\n<jsp:include page=\"${param.include}\"/>\n\nprocess.jsp:\n------------\n<\%@ page contentType=\"text/plain\" \%>\n<\%@ page import=\"java.util.*\" \%>\n\n<\%\nArrayList attrNames = Collections.list(request.getAttributeNames());\npageContext.setAttribute(\"include.request_uri.name\",\n                        \nBoolean.valueOf(attrNames.contains(\"javax.servlet.include.request_uri\")));\npageContext.setAttribute(\"forward.request_uri.name\",\n                        \nBoolean.valueOf(attrNames.contains(\"javax.servlet.forward.request_uri\")));\n\%>\n\ninclude.request_uri name: ${pageScope[\'include.request_uri.name\']}\ninclude.request_uri value: ${requestScope[\'javax.servlet.include.request_uri\']}\nforward.request_uri name: ${pageScope[\'forward.request_uri.name\']}\nforward.request_uri value: ${requestScope[\'javax.servlet.forward.request_uri\']}\n\nSo, if you request:\n\nforward.jsp?forward=include.jsp&include=process.jsp\n\nYou\'ll get the following:\n\ninclude.request_uri name: true\ninclude.request_uri value: /process.jsp\nforward.request_uri name: true\nforward.request_uri value:Fixed.',?,BUG
26628,'Function without parameters never found','Tomcat 5',Jasper,ronald,dev,'I have a very simple function call in a JSP page:\n\n   ${test:foo()}\n\nThis function is defined in my taglib as:\n\n   <function>\n      <name>foo</name>\n      <function-class>functions.Foo</function-class>\n      <function-signature>java.lang.String foo()</function-signature>\n   </function>\n\nNo parameters are to be provided. However, the method\n\n   org.apache.jasper.compiler.Validator#getParameters(ELNode.Function)\n\nassumes that parameters are always present. In the abscence of\nparameters, an attempt is made to load a class \".class\", which is\nof course not found by any classloader.\n\nI will attach a simple test case for this bug as a war file.Created attachment 10201\nTest case for this bug (scwcd/jsp/test.jsp).Fixed.*** Bug 26974 has been marked as a duplicate of this bug. ****** Bug 28466 has been marked as a duplicate of this bug. ***',?,BUG
26662,'ClassCastException in GzipOutputFilter','Tomcat 5',Connector:Coyote,jakarta,dev,'When using the compression filter included with the coyote connector I get \nClassCastException\'s when navigating our site.  It is at line 165 in the \nGzipOutputFilter\n\n159     public long end()\n160        throws IOException {\n161        if (compressionStream == null) {\n162            compressionStream = new GZIPOutputStream(fakeOutputStream);\n163        }\n164        compressionStream.finish();\n165        return ((OutputFilter) buffer).end();\n166    }\n\nthe buffer being cast into an OutputFilter is not always an OutputFilter as \nshow in InternalOutputBuffer line 309 \n\n306    public void addActiveFilter(OutputFilter filter) {\n307\n308        if (lastActiveFilter == -1) {\n309            filter.setBuffer(outputStreamOutputBuffer);\n310        } else {\n311            for (int i = 0; i <= lastActiveFilter; i++) {\n312                if (activeFilters[i] == filter)\n313                    return;\n314            }\n315            filter.setBuffer(activeFilters[lastActiveFilter]);\n316        }\n317\n318        activeFilters[++lastActiveFilter] = filter;\n319\n320        filter.setResponse(response);\n321\n322    } \n\nas you can see if lastActiveFilter = -1 then the buffer is set to \noutputStreamOutputBuffer which is an OutputStreamOutputBuffer which inherits \nfrom OutputBuffer not OutputFilter so the cast fails.Long time since I last heard about your reports. Now you\'ll see that this must\nbe wrapped with another filter for content delimitation (either identity or\nchunked), which can be safely cast. If this doesn\'t happen, then you have a bug,\nbut quite frankly I really doubt it.Remy,\n\nI did not think you read my bug reports, I though you would have filtered them \nby now.. :-)\n\nI understand what you are saying, but I keep getting the following stacktrace...\n\nava.lang.ClassCastException\n\tat org.apache.coyote.http11.filters.GzipOutputFilter.end\n(GzipOutputFilter.java:165)\n\tat org.apache.coyote.http11.InternalOutputBuffer.endRequest\n(InternalOutputBuffer.java:439)\n\tat org.apache.coyote.http11.Http11Processor.action\n(Http11Processor.java:968)\n\tat org.apache.coyote.Response.action(Response.java:226)\n\tat org.apache.coyote.Response.finish(Response.java:348)\n\tat org.apache.coyote.tomcat5.OutputBuffer.close(OutputBuffer.java:328)\n\tat org.apache.coyote.tomcat5.CoyoteResponse.finishResponse\n(CoyoteResponse.java:497)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service\n(CoyoteAdapter.java:209)\n\tat org.apache.coyote.http11.Http11Processor.process\n(Http11Processor.java:828)\n\tat \norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio\nn(Http11Protocol.java:700)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java:584)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:683)\n\tat java.lang.Thread.run(Thread.java:536)\n\nThis would indicate to me that it is a bug..\n\n\nSo basically, you are complining about stacktraces in your logs, right ?\n\"I get ClassCastException\'s when navigating our site\" would be translated by a\nnormal guy as: I see the stacktrace in my browser.\nMaybe it could happen when finishing an error request.I added a filter for the only branch of the if which wasn\'t adding a filter. I\ndon\'t quite understand when this branch code was being run; possibly in the case\nof an error. So this is fixed.I know it seems silly (believe me I know!!) but I just do as management tells \nme to and they wanted me to see if I could get it fixed.. Okidoki. Feel free to test the patch.Remy,\n\nThe fix did not work.. I still get the classcastexception.  The stacktrace is \nthe same..\n\nSure. Please provide a test case (test telnet request + servlet or JSP if needed).*** Bug 27197 has been marked as a duplicate of this bug. ***\nI found what was causing the class cast exception.  The maxKeepAliveRequests is \nset to 100.  If more than 100 requests are sent to that connection then the \nHttp11Processor.process() sets keepAlive to false (which is the correct \nbehavior) but when Http11Processor.processResponse() is called the following \ncode \n\n1485        if (contentLength != -1) {\n1486            response.getMimeHeaders().setValue(\"Content-Length\")\n1487                .setInt(contentLength);\n1488            outputBuffer.addActiveFilter\n1489                (outputFilters[Constants.IDENTITY_FILTER]);\n1490            contentDelimitation = true;\n1491        } else {\n1492            if (entityBody && http11 && keepAlive) {\n1493                outputBuffer.addActiveFilter\n1494                    (outputFilters[Constants.CHUNKED_FILTER]);\n1495                contentDelimitation = true;\n1496                response.addHeader(\"Transfer-Encoding\", \"chunked\");\n1497            }\n1498        }\n\ndoes not add a filter there for causing the compression filter to be the only \none added.  \n\nI am attaching a patch that checks to see if there are any filters added before \nthe compression filter is and if not added the identityFilter.\n\nAll line numbers and the patch are for 5.0.18\n\nJohnCreated attachment 10835\nPatch for the HttpProcessor, fixes classCastExceptionCreated attachment 10836\nfixed the patch.. had a extra char in it. sorry remyThe current code reads:\n\n        if (contentLength != -1) {\n            response.getMimeHeaders().setValue(\"Content-Length\")\n                .setInt(contentLength);\n            outputBuffer.addActiveFilter\n                (outputFilters[Constants.IDENTITY_FILTER]);\n            contentDelimitation = true;\n        } else {\n            if (entityBody && http11 && keepAlive) {\n                outputBuffer.addActiveFilter\n                    (outputFilters[Constants.CHUNKED_FILTER]);\n                contentDelimitation = true;\n                response.addHeader(\"Transfer-Encoding\", \"chunked\");\n            } else {\n                outputBuffer.addActiveFilter\n                    (outputFilters[Constants.IDENTITY_FILTER]);\n            }\n        }\n',?,BUG
26715,'Sessions that have been persisted during a server restart never time out.','Tomcat 5',Catalina,strunk,dev,'This can easily be reproduced.\n1. create a session via request.getSession(true).\n2. restart the server so the session will be persisted and loaded again.\n3. wait until the session has timed out according to the value specified in web.xml.\n4. the session can still be accessed by the client and stays accessible if not\nexplicitly invalidated by a call to session.invalidate().\n\nLooking at the codebase I think the reason for this is the accessCount field in\nStandardSession being in an inconsistent state after sessions have been reloaded\nfrom file. The attached patch solves it for me.Created attachment 10249\nsee descriptionFixed. Thanks.',?,BUG
26796,'Using taglibs with tag files seem to break includes','Tomcat 5',Jasper,krueger,dev,'It seems that a taglib directive which refers to a taglib using tag files breaks\nsubsequent include directives in the jsp page (they are not processed). It\nsounds weird but we verified that in a real-world app, that it seems to be the\ntag files that caused the problem. A taglib with only functions worked fine. I\nattached a simplified case that demonstrates the problem.Created attachment 10282\nweb application with test caseThe code for the include isn\'t generated, so the reason nothing gets included\nisn\'t that mysterious.\n\n<\%@ page contentType=\"text/html; charset=UTF-8\" \%>\n<\%@ taglib prefix=\"test\" uri=\"test\" \%>\n\n<html>\n  <h1>Included text goes here:</h1>\n  <table border=\"1\">\n    <tr>\n      <td><\%@ include file=\"included.jsp\" \%></td>\n    </tr>\n  </table>\n</html>\n\n=>\n\n      out.write(\"\\r\\n\");\n      out.write(\"\\r\\n\");\n      out.write(\"\\r\\n\");\n      out.write(\"<html>\\r\\n\");\n      out.write(\"  <h1>Included text goes here:</h1>\\r\\n\");\n      out.write(\"  <table border=\\\"1\\\">\\r\\n\");\n      out.write(\"    <tr>\\r\\n\");\n      out.write(\"      <td>\");\n      out.write(\"</td>\\r\\n\");\n      out.write(\"    </tr>\\r\\n\");\n      out.write(\"  </table>\\r\\n\");\n      out.write(\"</html>\\r\\n\");\nFixed.  Thanks for reporting.*** Bug 27762 has been marked as a duplicate of this bug. ***',?,BUG
26805,'tomcat.exe --WorkingPath does not set current directory','Tomcat 5',Native:Integration,herold,dev,'When using tomcat.exe to install tomcat as a service (on Window XP, if it \nmatters), the --WorkingPath option appears to have no effect.\n\nI used to do this in tomcat 4, using the (different) version of tomcat.exe \nincluded therein, and it worked.  I have some context xml files that have \nrelative references to entity includes.\n\nWhen the service is installed with the tomcat5 version of tomcat.exe, the \ncurrent working directory is set to <windows>/system32.\n\nThe full command line I use is:\n\ntomcat.exe //IS//Tomcat \\\n--Java\nc:\\install\\3rdparty\\java1.4.2-win\\bin\\server\\jvm.dll --JavaOptions -Dcotageso\nft.home=c:/install#-Djava.endorsed.dirs=c:/install/3rdparty/jakarta-tomcat\n-5.0.18/common/endorsed#-Djava.class.path=c:/install/3rdparty/java1.4.2-win/l\nib/tools.jar;c:/install/3rdparty/jakarta-tomcat-5.0.18/bin/bootstrap.jar#-Dca\ntalina.base=c:/install/3rdparty/jakarta-tomcat-5.0.18#-Dcatalina.home=c:/cota\ngesoft/3rdparty/jakarta-tomcat-5.0.18#-Djava.io.tmpdir=c:/install/3rdparty/ja\nkarta-tomcat-5.0.18/tmp --ImagePath c:/install/3rdparty/jakarta-tomcat-5.0.18\n/bin/bootstrap.jar --StartupClass \norg.apache.catalina.startup.Bootstrap;main;sta\nrt --ShutdownClass org.apache.catalina.startup.Bootstrap;main;stop --\nStdOutputFi\nle c:\\install\\logs\\stdout.log --StdErrorFile c:\\install\\logs\\stderr.log --\nWorkingPath c:/install\n\n*** This bug has been marked as a duplicate of 26806 ***With Tomcat 5.0.28, this problem still exists. The actual bug to set the\nWorkingPath for JNI didn\'t go into procrun until 6/25/2004. I\'m not sure what\nversion of the sources you have used to build tomcat5.exe for 5.0.28, but it\'s\napparently from before that..\n\nI install it the way Bob described, and I can see the WorkingPath value set in\nthe registry for the Stop and Start subkeys, but the working path is completely\nignored.\n\nHowever, if I build procrun from top-of-tree sources for Commons Daemon and\nreplace tomcat5.exe with a copy of the prunsrvd.exe, workingpath works fine.\n\nCan you please pick up the latest prunsrvd and prunmgrd from Commons Daemon\nProcrun for the next release (5.0.29)? Thanks!You are correct. It was a problem with CVS branch.\nRight now I allways backport the binaries to TOMCAT_5_0 branch,\nand it will be picked up by the build.  ',?,OTHER
26838,'Improper handling of javax.servlet.include.query_string during a nested include with parameters','Tomcat 5',Catalina,kschneider,dev,'Example setup:\n\ninclude1.jsp:\n-------------\n<jsp:include page=\"/include2.jsp\">\n    <jsp:param name=\"foo\" value=\"bar\"/>\n</jsp:include>\n\ninclude2.jsp:\n-------------\n<jsp:include page=\"/process.jsp\"/>\n\nprocess.jsp:\n------------\n<\%@ page contentType=\"text/plain\" \%>\n<\%@ page import=\"java.io.*\" \%>\n<\%@ page import=\"java.util.*\" \%>\n\n<\%!\nprivate boolean areSomeVarsNull(PageContext pageContext,\n                                int scope,\n                                JspWriter out) throws IOException {\n    boolean someAreNull = false;\n    for (Enumeration names = pageContext.getAttributeNamesInScope(scope);\n         names.hasMoreElements();) {\n        String name = (String)names.nextElement();\n        if (pageContext.getAttribute(name, scope) == null) {\n            out.println(name + \" is null\");\n            someAreNull = true;\n        }\n    }\n    return someAreNull;\n}\n\%>\n\n<\%\nareSomeVarsNull(pageContext, PageContext.PAGE_SCOPE, out);\nareSomeVarsNull(pageContext, PageContext.REQUEST_SCOPE, out);\nareSomeVarsNull(pageContext, PageContext.SESSION_SCOPE, out);\nareSomeVarsNull(pageContext, PageContext.APPLICATION_SCOPE, out);\n\%>\n\nWhich results in:\n\njavax.servlet.include.query_string is null\n\nIn other words, \"javax.servlet.include.query_string\" was part of the attribute\nnames enumeration but it\'s value was null when accessed through getAttribute.\nThis is somewhat similar to Bug #26611.This is now fixed.',?,BUG
26906,'Unable to do operations like Rename/Move, Copy, Paste etc.','Tomcat 5',Servlets:WebDAV,rsudharsan,dev,'Could not do common operations like Rename/Move, Copy, Paste from Windows 2000 /\nNT with IE 6.0.2600\nTried to do similar operations from DAVExplorer-0.90 and failed.\nWhen probing further, I found some problem with identifying the destination\nlocation for the operations.\nApplied the attached patch to the src code (from the src tar not the CVS) and it\nnow works on both tools.\n\n<PATCH>\n--- WebdavServlet.java.orig\tThu Jan 15 22:59:32 2004\n+++ WebdavServlet.java\tFri Feb 13 11:10:41 2004\n@@ -1506,8 +1506,15 @@\n \n         destinationPath = \n             normalize(RequestUtil.URLDecode(destinationPath, \"UTF8\"));\n-\n-        int protocolIndex = destinationPath.indexOf(\"://\");\n+        int protocolIndex = destinationPath.indexOf(\":/\");\n+        if( protocolIndex >= 0 ) {\n+            if( destinationPath.charAt(protocolIndex+2) != \'/\' ) {\n+                // add a / to make it look good\n+                destinationPath = destinationPath.substring(0,\nprotocolIndex)+\"://\"+\n+                destinationPath.substring(protocolIndex+2);\n+            }\n+        }\n+        protocolIndex = destinationPath.indexOf(\"://\");\n         if (protocolIndex >= 0) {\n             // if the Destination URL contains the protocol, we can safely\n             // trim everything upto the first \"/\" character after \"://\"\n</PATCH>I don\'t think I can agree to this change: it looks to me like a very ugly hack.I have just committed an alternative patch to CVS that fixes this issue. This \nwill be included in the next release.\n\nMany thanks.*** Bug 27595 has been marked as a duplicate of this bug. ****** Bug 28399 has been marked as a duplicate of this bug. ****** Bug 28591 has been marked as a duplicate of this bug. ***',?,BUG
26979,'StandardServer don\'t save cluster config','Tomcat 5',Catalina:Cluster,pr,dev,'The new cluster configuration and the DeltaManager are very great.\nNow it is really nice to talk about cluster configurations. Thanx Flilip!\n\nAfter I have reconfigure my cluster to Tomcat 5.0.19 it works,\nbut I missing the save support and edit support at admin app.\n\nOk. I have made some changes and now the StandardServer implementation can \nsave also the new cluster configuration. :-) \n\nBut one problem I can\'t solve. The cluster is a module and the StandardServer\nclass is a core class. With my cluster config patch the compiling dependency\nbetween core classes and the later compile module classes are \nwrong!  :-(  \n  Only chance : comment it out the first compiling run !!!\n\nI hope one you have a good idea to solve these modules configuration issue.\n\nPeter\n\nPS: When you need help to add cluster config to Admin application\n    I can do the job.Created attachment 10379\nMcastService.patchCreated attachment 10380\nCatalinaCluster.patchCreated attachment 10381\nadd filter getterCreated attachment 10382\nSimpleTcpCluster.patchCreated attachment 10383\nAdd Cluster Config support to 5.0.19 and higher formatthanks for the info, I will work on this.Created attachment 10385\nHups, drop DeltaManager and SimpleTcpReplicationManager for ClusterI have some questions:\n\na) Why we used the properties at McastService ?\nI find direct attributes instead the Properties are simpler\n\nb) Can we add MBean support to the new Cluster implementation ?\n\nc) Why we drop the persistence serialize support from StandardManager ?\n     The SimpleTcpReplicationManager call support at start/stop\n     I thing when we drop the complete cluster, we loose all....\n\nPeter\nPS: Can I help to add some off this features ? \nNew StoreConfig module at Tomcat 5.5 can save cluster config. Backport\nto tomcat 5.0 is not planed.\n',?,RFE
26988,'Error during POST via CGI','Tomcat 5',Servlets:CGI,kws,dev,'The CGIServlet.java is erroneously adding 2 line feeds to the stdin stream of \nof a CGI process. The problem happens in the getPostInput() method. Even if no \nrequest parameters are present it will return a line feed. The calling method \nchecks for null, but based on the getPostInput method this can never occur. \nAdding the following code fixes the problem.\n\nprotected String getPostInput(Hashtable params) {\n...\nreturn qs.length() > 0 ? qs.append(lineSeparator).append(postInput).toString\n() : null;\n}\n\nThis only adds a line separator if parameters exist. I\'ve also looked at the \nouput string which is formated as follows (example using 2 params):\n\n\"param1=value1&parma2=value2&\nparam1=value1\nparam2=value2\n\n\"\n\nIs this the expected output format? The problematic code also exists for \nversion 5.0.19.\n\nKevinThis has been fixed in CVS and will be included in the next release. It has \nalso been fixed in the 4.1.x branch.\n\nI have applied a modified version of your patch.\n\nI agree the output format looks a little odd but I propose to leave it as \nchanging it may well break existing scripts and no-one has actually complained \nthat the format is invalid.',?,BUG
27050,'keystoreFile parameter, when specified as relative, is not treated relative to $CATALINA_BASE or catalina.base property','Tomcat 5',Connector:Coyote,drzewo,dev,'Tomcat docs on configuring SSL says (on keystoreFile attribute of http\nConnector): \"You can specify an absolute pathname, or a relative pathname that\nis resolved against the $CATALINA_BASE environment variable.\" \n\nHowever, specifying relative keystoreFile does not make tomcat resolve this file\nagainst $CATALINA_BASE (or -Dcatalina.base property). It seems it is resolved\nagainst current working directory.\n\nHow to reproduce this error:\n1. install tomcat (as nt service)\n2. create separate (striped down) base (say <BASE>) somewhere on your disk\n(conf, logs, work, temp, webapps(empty) directories)\n3. create keystore <BASE>/conf/catalina.keystore\n4. update <BASE>/conf/server.xml to enable https connector as \n    <Connector port=\"9443\" \n     maxThreads=\"50\" minSpareThreads=\"5\" maxSpareThreads=\"25\"\n     enableLookups=\"false\" disableUploadTimeout=\"true\"\n     acceptCount=\"100\" debug=\"0\" scheme=\"https\" secure=\"true\"\n     clientAuth=\"false\" sslProtocol=\"TLS\" \n     keystoreFile=\"conf/catalina.keystore\"\n    />\n5. using tomcatw.exe\" //ES//Tomcat5 update \"java options\" so they reference new\nbase, particularly append -Dcatalina.base=\"<BASE>\" to \"Java Options\"\n6. net start tomcat5\n7. observe stdout.log\n2004-02-18 22:25:42 org.apache.coyote.http11.Http11Protocol init\nSEVERE: Error initializing endpoint\njava.io.FileNotFoundException: conf\\catalina.keystore (The system cannot find\nthe file specified)\n8. now, use tomcatw.exe\" //ES//Tomcat5 in order to update Service \"Work Path\" to\nrefer to the new base\n9. Now tomcat DOES start https and finds conf/catalina.keystore relative to the\nnew work dir\n\nHow to obtain this error (the easier way):\n1. unpack/install tomcat\n2. create separate (striped down) base (say <BASE>) somewhere on your disk (bin,\nconf, logs, work, temp, webapps(empty) directories)\n3. create keystore <BASE>/conf/catalina.keystore\n4. update <BASE>/conf/server.xml to enable https connector as \n    <Connector port=\"9443\" \n     maxThreads=\"50\" minSpareThreads=\"5\" maxSpareThreads=\"25\"\n     enableLookups=\"false\" disableUploadTimeout=\"true\"\n     acceptCount=\"100\" debug=\"0\" scheme=\"https\" secure=\"true\"\n     clientAuth=\"false\" sslProtocol=\"TLS\" \n     keystoreFile=\"conf/catalina.keystore\"\n    />\n5. open cmd\n6. set CATALINA_BASE=<BASE> (dir containing conf subdir)\n7. cd \%CATALINA_BASE\%\\bin\n8. catalina.bat start\n9. oops, we\'re still getting \n2004-02-18 22:25:42 org.apache.coyote.http11.Http11Protocol init\nSEVERE: Error initializing endpoint\njava.io.FileNotFoundException: conf\\catalina.keystore (The system cannot find\nthe file specified)\n10. cd ..\n11. bin\\catalina.bat start\n12. NO java.io.FNFE this time\n\nAll this leads me to the conclusion that keystoreFile attribute value is\nresolved against current working directory instaed of $CATALINA_BASE\nProbably truststoreFile attribute suffers from the same problem.\n\nTested on both j2sdk1.4.2_03 as well on j2sdk1.5.0-beta1Fixed.\n\nDIFFS:\n\nIndex: JSSESocketFactory.java\n===================================================================\nRCS file:\n/home/cvs/jakarta-tomcat-connectors/util/java/org/apache/tomcat/util/net/jsse/JSSESocketFactory.java,v\nretrieving revision 1.13\ndiff -u -r1.13 JSSESocketFactory.java\n--- JSSESocketFactory.java      24 Jan 2004 04:56:32 -0000      1.13\n+++ JSSESocketFactory.java      18 Feb 2004 22:39:36 -0000\n@@ -58,6 +58,7 @@\n  */ \n package org.apache.tomcat.util.net.jsse;\n \n+import java.io.File;\n import java.io.FileInputStream;\n import java.io.FileNotFoundException;\n import java.io.IOException;\n@@ -309,7 +310,13 @@\n         InputStream istream = null;\n         try {\n             ks = KeyStore.getInstance(type);\n-            istream = new FileInputStream(path);\n+            File keyStoreFile = new File(path);\n+            if (!keyStoreFile.isAbsolute()) {\n+                keyStoreFile = new File(System.getProperty(\"catalina.base\"),\n+                                        path);\n+            }\n+            istream = new FileInputStream(keyStoreFile);\n+\n             ks.load(istream, pass.toCharArray());\n             istream.close();\n             istream = null;',?,BUG
27077,'DataSourceRealm throws NullPointerException when auth is tried and user has null password','Tomcat 5',Catalina,minfrin,dev,'I have a web application that is password protected against a postgres database,\ndefined like so:\n\n<Realm className=\"org.apache.catalina.realm.DataSourceRealm\" debug=\"0\"\n  dataSourceName=\"jdbc/GlobalPatricia\"\n  userTable=\"person\" userNameCol=\"uid\" userCredCol=\"user_password\"\n  userRoleTable=\"company_person\" roleNameCol=\"serial\"/>\n\nFor normal users logging in, this works fine.\n\nIf however, a user in the postgres database has their password field set to\n\"null\", and an attempt is made to log in as this user using any password, the\nexception below is thrown by tomcat.\n\nTomcat then returns a 200 OK to the browser, along with a blank page.\n\n2004/02/19 01:42:10 org.apache.coyote.tomcat5.CoyoteAdapter service\nSEVERE: An exception or error occurred in the container during the request\nprocessing\njava.lang.NullPointerException\n    at\norg.apache.catalina.realm.DataSourceRealm.authenticate(DataSourceRealm.java:369)\n    at\norg.apache.catalina.realm.DataSourceRealm.authenticate(DataSourceRealm.java:306)\n    at\norg.apache.catalina.authenticator.BasicAuthenticator.authenticate(BasicAuthenticator.java:182)\n    at\norg.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:551)\n    at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n    at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\n    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:195)\n    at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:164)\n    at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n    at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\n    at\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:156)\n    at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n    at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:564)\n    at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)\n    at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:206)\n    at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:828)\n    at\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:700)\n    at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:584)\n    at\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:683)\n    at java.lang.Thread.run(Thread.java:534)This realm could use some code merges from the regular JDBC realm.Would it be better to have DataSourceRealm realm extend JDBCRealm ? (Or vice versa)That would exclude a realm based on LDAP would it not?I agree on the usefulness of trying to merge the two realms.This should be fixed now, but I didn\'t test it.',?,BUG
27090,'CGI parameters use default encoding instead of UTF-8','Tomcat 5',Servlets:CGI,kws,dev,'The URLEncode.encode(\"\") API has been deprecated because it uses the default \nsystem encoding. All application/x-www-form-urlencoded encoding should be done \nin UTF-8.\n\nCode: CGIServlet.java\n\nFix:  URLEncode.encode(\"\",\"UTF-8\")This depends on your script. At most it should be configurable, but I\'d say\nusing platform encoding is not so bad.I\'ll make this configurable, with the default as is rather than UTF-8 as I \ndon\'t want to risk breaking any existing scripts. I\'ll try and do this tonight.The new parameter has been added to the CGI servlet. The fix has also been \nported to TC4.Note that this has been reverted in 4.1.x and 5.0.x as it introduced a JDK 1.4 \ndependency. It remains in 5.5.x',?,RFE
27100,'WebDAV locking implementation incompatible with some clients.','Tomcat 5',Servlets:WebDAV,ryan,dev,'Tested WebDAV servlet with Dreamweaver MX and DAVExplorer.  \n\nProblem: After either client obtains a lock, they are unable to perform any \nother operations on the locked resource.  All further operations on a locked \nresource return the SC_LOCKED status.  \n\nThis is particularly troublesome for Dreamweaver because it only works by \nacquiring locks -- i.e. there is no way to use Dreamweaver + webdav without \nlocking.I think the \"problem\" is that the servlet obsfucates lock tokens, which it has\nevery right to do (this is from memory).\nAnyway, the servlet supports WebDAV level 1, which doesn\'t include locking\n(which is very complex to implement completely, so is only partially implemented).\nI\'ll let Mark resolve this report.A couple of suggestions based on the recent comment.  \n\n- If only Level 1 is supported, and locking is not supported fully, then \nperhaps a configuration option would be warranted that:\n  - Keeps the servlet from reporting that it supports: level 2 and lock \nmethods.\n  - Makes lock operations a no-op for clients that still try to lock no matter \nwhat.Having had a good look through the spec I don\'t think that it does allow the \nlock token to be obsfucated. I am basing this opinion on the following quotes:\n- 6.3 <quote>Anyone can find out anyone else\'s lock token by performing lock \ndiscovery.</quote>\n- 17.3 Security through Obscurity\n<quote>\n   WebDAV provides, through the PROPFIND method, a mechanism for listing\n   the member resources of a collection.  This greatly diminishes the\n   effectiveness of security or privacy techniques that rely only on the\n   difficulty of discovering the names of network resources.  Users of\n   WebDAV servers are encouraged to use access control techniques to\n   prevent unwanted access to resources, rather than depending on the\n   relative obscurity of their resource names.\n</quote>\n\nI have just committed a patch to CVS that removes the lock obsfucation \nfunctionality. This will be included in the next release.\nIt has also been ported to TC4.*** Bug 10539 has been marked as a duplicate of this bug. ***',?,IMPROVEMENT
27104,'got an exception when testing a simple cluster app','Tomcat 5',Catalina:Cluster,rstarzer,dev,'hi,\n\nthis occured only once (so far)->\n\nfault:\n\njava.util.NoSuchElementException\n\tat java.util.LinkedList.remove(LinkedList.java:579)\n\tat java.util.LinkedList.removeFirst(LinkedList.java:131)\n\tat org.apache.catalina.cluster.session.DeltaRequest.addAction\n(DeltaRequest.java:149)\n\tat org.apache.catalina.cluster.session.DeltaRequest.setAttribute\n(DeltaRequest.java:116)\n\tat org.apache.catalina.cluster.session.DeltaSession.setAttribute\n(DeltaSession.java:1330)\n\tat org.apache.catalina.cluster.session.DeltaSession.setAttribute\n(DeltaSession.java:1311)\n\tat org.apache.catalina.cluster.session.DeltaSessionFacade.setAttribute\n(DeltaSessionFacade.java:177)\n\tat org.apache.jsp.index_jsp._jspService(index_jsp.java:50)\n\tat org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:133)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\tat org.apache.jasper.servlet.JspServletWrapper.service\n(JspServletWrapper.java:311)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile\n(JspServlet.java:301)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:248)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:284)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:204)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:257)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:564)\n\tat org.apache.catalina.core.StandardContextValve.invokeInternal\n(StandardContextValve.java:245)\n\tat org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:199)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:564)\n\tat org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:195)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:164)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:149)\n\tat org.apache.catalina.cluster.tcp.ReplicationValve.invoke\n(ReplicationValve.java:182)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:564)\n\tat org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:156)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:564)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service\n(CoyoteAdapter.java:206)\n\tat org.apache.coyote.http11.Http11Processor.process\n(Http11Processor.java:828)\n\tat \norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio\nn(Http11Protocol.java:700)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java:584)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:683)\n\tat java.lang.Thread.run(Thread.java:534)\n\n\nindex.jsp:\n\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\"\n\"http://www.w3.org/TR/html4/loose.dtd\">\n<html>\n<head>\n<title>Session Text</title>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\">\n</head>\n<\%\n\tString rep = new String(\"Replicated\");\n\tout.print(session.getId());\n\tsession.setAttribute(\"replicate\",rep);\n\%>\n<body>\n</body>\n</html>\n\nmulticast config:\n\n <Cluster  className=\"org.apache.catalina.cluster.tcp.SimpleTcpCluster\"\n\n                  name=\"xxxx\"\n\n                  debug=\"99\"\n\n                  serviceclass=\"org.apache.catalina.cluster.mcast.McastService\"\n\n                  mcastAddr=\"239.192.16.5\"\n\n                  mcastPort=\"45564\"\n\n                  mcastFrequency=\"500\"\n\n                  mcastDropTime=\"3000\"\n\n                  tcpThreadCount=\"12\"\n\n                  tcpListenAddress=\"auto\"\n\n                  tcpListenPort=\"4001\"\n\n                  tcpSelectorTimeout=\"100\"\n\n                  printToScreen=\"false\"\n\n                  expireSessionsOnShutdown=\"false\"\n\n                  useDirtyFlag=\"true\"\n\n                  replicationMode=\"pooled\"\n\n        />\n\nsynchronization problem or should this be caught and logged with lower \npriority ?\n\nthanks !I haven\'t been able to reproduce this, if you have a scenario where this \nhappens again, let me know and we will work it outI put in sync around the code that would cause thisWe are getting this issue on our servers at the moment.\nWe are using Tomcat 5.0.28 and I have seen this issue under Linux and Windows.\n\nOur site is constantly causing this issue, and the only solution is to get the\ncustomer to shutdown all of their browsers to disconnect from the session then\nstart again.\n\nIt seems that the DeltaSession gets lost and then when the replication happens\nit has some sort of internal error.\n\nAny ideas on a solution for this one? Filip fixed it on November 19, and Tomcat 5.0.30 was tagged 5 days later.  Your\noptions are to get 5.0.30, upgrade to 5.5.12, or sync the methods yourself.',?,BUG
27122,'IE plugins cannot access components through Tomcat 5 over SSL','Tomcat 5',Connector:HTTP,dpotter,dev,'SSL seems to be failing when the Content-Type header is set to \"image/svg+xml\".\n\nI\'ve only seen this failure when SSL was running on a Solaris machine.  (uname\n-a: SunOS [hostname removed] 5.8 Generic_108528-18 sun4u sparc SUNW,Ultra-60) \nWhen attempted on Windows, we were unable to duplicate the error.  This reliably\nfails when attempted on this specific Solaris machine.  If I get a chance, I\'ll\ntry to create a test-case and see if I can reproduce this on other Solaris\nmachines.  Unfortunately, this was a show-stopper for a release that\'s being\nmade today so I\'m pressed for time.\n\nBasically, what happens is that we\'re using a JSP page to create an SVG file. \nBecause of this, we have to set the Content-Type header to \"image/svg+xml\". \nWhen the MIME type is set to this value, the page fails to load in Internet\nExplorer 6 (SP1) with a message of \"connection failed\" or something similar. \nWhen an attempt was made in Opera, Opera responded by crashing.  Mozilla\nsuccessfully downloaded the file, though.\n\nHowever, when resetting the MIME type in the page to \"text/plain\" all three\nbrowsers can access the page without failure.  By back-revving Tomcat to version\n4.1.29, we were able to resolve this issue and access the page in all three\nbrowsers.\n\nI\'ll try and create a test-case later today and verify that it isn\'t just our\nSVG JSP that\'s failing but any that creates SVG but I\'m currently pressed for\ntime - sorry.How about trying with a telnet ? Either the content is sent or it is not.\nThere\'s nothing to investigate here, as there is nothing in Tomcat which is\nrelated to the content-type, so I urge posting on tomcat-user instead.Of course I haven\'t tried telnet, it\'s only happening over SSL.  I\'m not very\ngood at doing 128-bit encryption in my head and I doubt anyone else is either. \nIf I could find something that would do SSL and dump the actual HTTP transaction\nI would do that - I haven\'t yet (especially because form security is in place on\nthe webapp).\n\nHowever, considering that it *only* failed with the latest Tomcat 5 and works\njust fine in Tomcat 4 I find it hard to believe that there isn\'t something wrong\nwith Tomcat 5.  If it failed when back-revving the version, I might blame\nsomething else.  But this is 100\% reproducable among multiple clients and only\nwhen connecting to the Tomcat 5 server using SSL.\n\nThis *only* fails when using SSL through Tomcat 5.  It works with Tomcat 4,\nusing the same JDK and the same configuration.  It also works in Tomcat 5 if I\nuse the standard HTTP connector.  I can\'t figure out how to begin to debug this,\nbut if anyone can offer any suggestions on utilities to debug SSL connections\nI\'ll take a stab at it next week.Try \'openssl s_client\'.  It\'s my first stop when debugging SSL problems.Well, I understand, but the behavior you describe would be extremely strange. I\ndon\'t see how it can be a Jasper or container issue, and I don\'t see how it can\nbe a connector issue either (the connector doesn\'t have content-type specific at\nall either, except when HTTP compression is used). Tomcat 4.1.29 uses the same\nconnectors as 5.0.14, and similarly 4.1.30 uses the same as 5.0.18, so again I\ndon\'t understand a difference in behavior between the two \"branches\".OK, I finally got a chance to use \"openssl\" to try and manually run a couple of\nHTTP transactions.  I found one header I thought may be a problem that\'s\nincluded in Tomcat 5 but not Tomcat 4: \"Expires: Wed, 31 Dec 1969 19:00:00 EST\".\n Unfortunately, updating it to a more realistic \"expires\" date didn\'t allow IE\nto work.\n\nI\'m as stumped as everyone else is as to what might be causing this.  I think I\nneed to actually find a way to sniff out what IE is doing, but this definitely\nisn\'t working with IE 6 SP1 and Tomcat 5.0.18 on this one SVG page.  (I\'m\nwondering if it has to do with the form authentication - when I created a test\nJSP with no security constraints it worked through IE 6.)\n\nAs far as I can tell, though, Tomcat is generating the headers correctly... \nAlthough I can\'t figure out why IE would only not work with this page and work\nfine on all the others and why back-revving to Tomcat 4 would solve the problem.\n\nAnd now it appears that Opera 7.23 is working just fine on the page, as well as\nMozilla.  This is probably an Internet Explorer issue, not a Tomcat 5 issue, but\nit still is *weird*.  Anyone who has any ideas to help debug what Internet\nExplorer is doing would be appreciated - it always indicates that the \"Action\nwas canceled\" and says that the site was unavailable.\n\nFor reference:\n\nTOMCAT 4.1.29 HEADERS:\n\nHTTP/1.1 200 OK\nContent-Type: image/svg+xml;charset=ISO-8859-1\nDate: Wed, 25 Feb 2004 21:28:16 GMT\nServer: Apache-Coyote/1.1\nConnection: close\n\nTOMCAT 5.0.18 HEADERS:\n\nHTTP/1.1 200 OK\nPragma: No-cache\nCache-Control: no-cache\nExpires: Wed, 31 Dec 1969 19:00:00 EST\nContent-Type: image/svg+xml\nDate: Wed, 25 Feb 2004 21:21:46 GMT\nServer: Apache-Coyote/1.1\nConnection: closeAnd we have finally found the problem.  In an attempt to try and work around \nsome broken client (I can\'t be bothered to go back and see which one), Tomcat5 \nstarted adding adding the \"don\'t cache\" headers even for SSL requests.  I\'m in \na very small minority of disliking this \"feature\", so it is unlikely to change.\n\nThe work-around is to configure the Authenticator yourself:\n<Context path=\"/myapp\" docBase=\"myapp\">\n  <Valve className=\"org.apache.catalina.authenticator.FormAuthenticator\"\n          disableProxyCaching=\"false\" />\n</Context>\n\nOf course, if you\'re not using Form auth, then substitute the correct class in \nthe example above.Yep - that solved it.  Thanks!\n\n(Also, I see that Tomcat 5.0.19 was released, so I tested it against that\nversion and got the same problem on Solaris.)\n\nThis is a bug with the way Internet Explorer handles plugins, then.  My guess is\nthat the file isn\'t cached so that when the plugin attempts to access it, it\ndoesn\'t receive anything causing it to silently fail.\n\nI just tried uploading the Badgers-Badgers SWF and seeing if it would fail in\nthe same way, and it does.  So this happens with any IE plugin.\n\nMind you, the way Internet Explorer fails with this is weird.  It just indicates\nthat the resource is not available, despite all other indications being that it\nis.  It also happens when you attempt to directly access the resource through\nIE, it asks you to download the file and then tells you that it isn\'t available.\n It might be worth re-openning this bug and removing the \"no-cache\" behavior if\n\"MSIE\" appears in the User-agent header.*** Bug 28662 has been marked as a duplicate of this bug. ****** Bug 29336 has been marked as a duplicate of this bug. ****** Bug 29975 has been marked as a duplicate of this bug. ***Microsoft describes the exact behaviour of their bug on this webpage:\n\nhttp://support.microsoft.com/?id=316431\n\nMicrosoft says that this bug is \"by design\" and that they will not ifx it. This \nis just SOOO arrogant!!\n\n--\n\nTomcat adds the respective caching headers to the HTTP header automatically if \nand only if a resource of a webapp is being accessed for which a user data \nconstraint of CONFIDENTIAL has been set.\n\nI PROPOSE TO HAVE A SPECIAL ATTRIBUTE WITHIN THE CONNECTOR CONFIGURATION BY \nWHICH TOMCAT CAN BE FORCED NOT TO SET CACHING HEADERS ITSELF.\n\n*** PLUS ***\n\nI DON\'T LIKE THAT THIS BUG HAS BEEN MARKED AS INVALID!\nSEVERAL PEOPLE HAVE REPORTED THIS BEHAVIOUR AND a FIX IS POSSIBLE AND \nSTRAIGHTFORWARD TO APPLY.\n(Search for \'no-cache\' within the connector codebase and put an if(doCaching) \nbracket around it. That\'s all there is to it.)\n\nI leave it to the tomcat developers to reopen this bug as I regard it as \nsomehow impolite to do this myself. However, I strongly recommend you people to \ndo so. This bug is reproducible on every InternetExplorer. A lot of people will \nget headaches and spend days on investigation unless you add the proposed \nattribute to the connector configuration or at least place a comment on the \nwebpage which informs developers of the effect in question.*** Bug 30618 has been marked as a duplicate of this bug. ****** Bug 30618 has been marked as a duplicate of this bug. ****** Bug 36735 has been marked as a duplicate of this bug. ***I would like to add my support for the previous request to make the caching\nheaders (Pragma and Cache-Control) configurable in Tomcat 5.0.x.  \n\nBrief history: I use Tomcat 5.0.28 for a small webapp.  It sits behind Apache,\nwhich does SSL and forwards requests to Tomcat via mod_jk.  Users access the\nwebapp stricly with SSL.  The webapp\'s doc area has a few static power-point\nfiles, and that\'s where this problem bit me: IE users could not get power-point\nfiles.\n\nTo figure out what headers Tomcat sets in responses, I turned on the\nRequestDumperValve in the server.xml file.  Then I saw that every single request\n-- whether .gif, .html, .css, .ppt, or .jsp -- gets \"Cache-Control: no-cache\"\nand \"Pragma: no cache\" in the response headers.\n\nWhile these headers are absolutely appropriate for JSP pages, they are wholly\nunnecessary for static content.  I want my users\' browsers to cache static\ncontent like CSS sheets, images, etc. and thereby make fewer requests to my\nserver.  Everybody wins.\n\nThis thread helped me understand the problem:\nhttp://forum.java.sun.com/thread.jspa?threadID=233446&start=0&tstart=0 \n\nI finally used the solution from here, with one modification:\nhttp://www.jspinsider.com/content/dev/afessh/another-filter-every-site-should-have.html\nJayson Falkner explains servlet filters that set response headers; this means \nweb browsers will cache items like pictures and other static content.  Note that\nhis code does \"addHeader\" but that does NOT work; you have to do \"setHeader\" to\noverrride the cache-control that Tomcat adds.\n\nI am of the strong opinion that Tomcat needs some configuration setting so users\nlike me can tell the container what caching policy to apply by default.  Maybe\nsomething along the lines of a mime-types file would allow the caching policy to\nbe set based on file suffixes or file-name patterns. \n\nPlease consider this request seriously.  I am not a Tomcat dev and don\'t want to\nreopen this bug myself.  Thanks.\nReopening this bug - even though strictly speaking Tomcat\'s behaviour is not\nincorrect - because it seems to be a significant and common source of problems,\nand is not that easy for the user to diagnose. It occurs with or without SSL,\nand in a wider set of circumstances than invoking IE plugins. (My own variation\nis that download to a file in IE fails if a content-disposition header is set\nand the resource is subject to a security constraint).\n\nThe workaround given by Bill Barker is to configure each context:\n\n<Context path=\"/myapp\" docBase=\"myapp\">\n  <Valve className=\"org.apache.catalina.authenticator.FormAuthenticator\"\n          disableProxyCaching=\"false\" />\n</Context>\n\nThis works but reduces security more than is necessary, as it causes no cache\ncontrol headers to be issued at all.\n\nAn alternative workaround\n\n<Context path=\"/myapp\" docBase=\"myapp\">\n  <Valve className=\"org.apache.catalina.authenticator.FormAuthenticator\"\n          securePagesWithPragma=\"false\" />\n</Context>\n\nis better. It causes a header Cache-Control: private to be issued in place of\nthe default Cache-Control: none and Pragma: no-cache headers. This tells shared\ncaches not to cache the response, which I think is all that is necessary, while\nstill allowing downloads to work in IE.\n\nHowever, neither workaround is a good solution because it makes configuration\nmore difficult and because it duplicates knowledge of which authenticator is\nrequired between the web.xml and context.xml files.\n\nTherefore I suggest that AuthenticatorBase be changed to put out the\nCache-Control: private header by default. I think this is simply a matter of\nchanging the securePagesWithPragma field from true to false:\n\n    /**\n     * Flag to determine if we disable proxy caching with headers incompatible\n     * with IE \n     */\n    protected boolean securePagesWithPragma = true;\n    \nOther comments in this source file suggest that IE-incompatible headers are\nbeing issued because there is some unspecified problem with Mozilla when\ncache-control: private is used. However I can find no such problem at least with\ncurrent versions of Firefox. Since the choice therefore seems to be between\nworking around a known bug in all versions of IE, and working around a possible\nbug in some previous versions of Mozilla that does not affect current Firefox\nusers, I\'d argue that the former is the better thing to do. \nThe current behaviour is unlikely to change. I am marking this as an enhancement\nrather than WONTFIX in case someone cares enough to come up with a proposed patch.We just found that adding:\n\n<security-constraint>\n  <web-resource-collection>\n    <web-resource-name>Automatic SLL Forwarding</web-resource-name>\n    <url-pattern>/*</url-pattern>\n  </web-resource-collection>\n  <user-data-constraint>\n    <transport-guarantee>CONFIDENTIAL</transport-guarantee>\n  </user-data-constraint>\n</security-constraint>\n\nalso adds the headers that creates this issue.  Any ideas?  Using tomcat 5.5.25<transport-guarantee>CONFIDENTIAL</transport-guarantee> means SSL will be used so yes, you will hit this bug in IE. Workarounds as described above.We\'ve added the following to context.xml as a work-around:\n\n<Valve className=\"org.apache.catalina.authenticator.NonLoginAuthenticator\" disableProxyCaching=\"true\" securePagesWithPragma=\"false\" />\n\nFor reference, the original Mozilla issue described in bug 23887. I have confirmed that this bug no longer exists in the latest version of Firefox. I suspect it was fixed some time ago although I couldn\'t find it when I tried searching the Mozilla bug database.I have removed the Mozilla bug workaround in 7.0.x and changed the default of securePagesWithPragma to false. Both of these changes will be included in 7.0.15 onwards.\n\nI do not intend proposing these changes for back-port.',?,OTHER
27127,'Shutdown doesn\'t work with custom server port + non-default config file;','Tomcat 5',Catalina,debbie.utley,dev,'If I change the server port in a custom config file, stopping the server using \nthe shutdown batch file does not work.\n\nSteps:\n1. Create a file (say C:\\myserver.xml) with the following contents:\n------------\n<Server port=\"8081\" shutdown=\"SHUTDOWN\" debug=\"4\">\n  <Service name=\"Catalina\">\n    <Connector debug=\"4\" port=\"8080\"/>\n    <Engine name=\"Catalina\" defaultHost=\"localhost\" debug=\"0\">\n      <Host name=\"localhost\" debug=\"4\" appBase=\"webapps\"\n       unpackWARs=\"true\" autoDeploy=\"true\">\n      </Host>\n    </Engine>\n  </Service>\n</Server>\n------------\n\n2. execute\n   <tomcathome>\\bin\\startup -config C:\\myserver.xml\n\n3.  execute\n<tomcathome>\\bin\\shutdown -config C:\\myserver.xml\n\n4. This causes \njava.net.ConnectException: Connection refused: connect\n        at java.net.PlainSocketImpl.socketConnect(Native Method)\n        at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:305)\n        at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:171)\n        at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:158)\n        at java.net.Socket.connect(Socket.java:452)\n        at java.net.Socket.connect(Socket.java:402)\n        at java.net.Socket.<init>(Socket.java:309)\n        at java.net.Socket.<init>(Socket.java:124)\n        at org.apache.catalina.startup.Catalina.stopServer(Catalina.java:453)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.stopServer(Bootstrap.java:322)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:400)\n\n5. In the config file myserver.xml, change 8081 to the default value 8005.   \nNow steps 2 and 3 work as expected.\n\nThe problem appears to be that Bootstrap.main() ignores the -config argument if \nthe command is \"stop\".  Thus the server is listening on port 8081, but shutdown \nis using port 8005 as specified by the default server.xml.This is now fixed.',?,BUG
27156,'minSpareThreads / maxSpareThreads do not work with AJP connector','Tomcat 5',Connector:AJP,ruediger.pluem,dev,'Hi,\n\nI noticed that the minSpareThreads / maxSpareThreads settings do not work with\nthe AJP connector. To be more precise settings these values in the connector\nelement has no effect at all. Instead the default values for minSpareThreads /\nmaxSpareThreads are used for the ThreadPool. I had a look at the sources and\nnoticed that the appropriate setters are missing in\norg.apache.jk.common.ChannelSocket. As I do not have that in depth knowledge of\nthe code I am not sure if it was simply forgotten to implement or if having the\npossibiliy to change these settings via the configuration creates other\nproblems. But as the default values are used in the current situation I do not\nthink so.\nSo I created a small patch for this, which works fine for me. I will attach it\nto this report.\n\nBest regards\n\nRüdiger PlümCreated attachment 10490\nEnable minSpareThreads / maxSpareThreads for AJP ConnectorCommited thanks',?,RFE
27190,'Redirect problem with the COPY / MOVE request handling in the WebDAV servlet','Tomcat 5',Servlets:WebDAV,ruediger.pluem,dev,'Hi,\n\nthere is a redirect problem with the COPY / MOVE request handling in the WebDAV\nservlet of\nTomcat.\n\nEnvironment:\n\nI created the webdav application with the following web.xml file in\nwebapps/webdav/WEB-INF:\n\n<!DOCTYPE web-app\n    PUBLIC \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"\n    \"http://java.sun.com/dtd/web-app_2_3.dtd\">\n \n<web-app>\n \n  <servlet>\n    <servlet-name>webdav</servlet-name>\n    <servlet-class>org.apache.catalina.servlets.WebdavServlet</servlet-class>\n    <init-param>\n      <param-name>debug</param-name>\n      <param-value>10</param-value>\n    </init-param>\n    <init-param>\n      <param-name>listings</param-name>\n      <param-value>true</param-value>\n    </init-param>\n    <!-- Uncomment this to enable read and write access -->\n    <init-param>\n      <param-name>readonly</param-name>\n      <param-value>false</param-value>\n    </init-param>\n    <!--load-on-startup>1</load-on-startup-->\n  </servlet>\n  <servlet-mapping>\n    <servlet-name>webdav</servlet-name>\n    <url-pattern>/</url-pattern>\n  </servlet-mapping>\n\n</web-app>\n\nThe directory webapps/webdav/ is writable by the Tomcat jvm.\n\nI created the collection col  with cadaver (which worked fine).\n\nSo this is our starting point:\n\ndav:/webdav/> ls\nListing collection `/webdav/\': succeeded.\nColl:  col                                     0  Jan  1  1970\n\nIf you try to move the collection col to col1 which results in the following request\n\nMOVE /webdav/col HTTP/1.1\nUser-Agent: neon/0.23.0 cadaver/0.20.5\nConnection: TE\nTE: trailers\nDestination: http://127.0.0.1:8080/webdav/col1\nOverwrite: T\n\nyou get a 302 as response:\n\nHTTP/1.1 302 Moved Temporarily\nLocation: http://127.0.0.1:8080/webdav/col/\nTransfer-Encoding: chunked\nDate: Tue, 24 Feb 2004 13:37:41 GMT\nServer: Apache-Coyote/1.1\n\nThe reason for this behaviour is caused by the fact that MOVE /webdav/col is used\ninstead of MOVE /webdav/col/. If you use MOVE /webdav/col/ everything works fine.\n\nThis is the reason why there is the redirect-carefully special environment\nvariable within Apache\nas this problem is known with many webdav clients (see also\nhttp://httpd.apache.org/docs-2.0/env.html#special).\n\nThe actual redirect is created in the lines 753 - 767 of\n\norg/apache/tomcat/util/http/mapper/Mapper.java\n\nwhich creates this redirect long before the WebDAVServlet has a chance to handle\nthis situation on its own.\nAnd now I am a little helpless how to fix this :-).\n\n\nRegards\n\nRüdiger PlümThis is really painful. If this is my decision, then this will not be fixed.But this makes the webdav servlet inusable for the most used and most hated (at\nleast on the side of the people who implement webdav servers) webdav client: MS\nwebfolders. So I hope there will be a fix for this within Tomcat.\n\nRegards\n\nRüdiger\nYes, but then you will complain that redirect will always occur for the root\npath of a context (ex: a request to \"/webdav\") and that it also breaks broken\nclients. I think there\'s no point, and I recommend looking for other servers\nwhich would be more complex and legacy friendly (such as mod_dav, or Slide -\nalthough Slide won\'t help for the root path problem).You know the typical requester: If you give him a small finger he wants your\nwhole hand! :-).\n\nBut back to the problem: The problem with the root path of the context can be\nfixed by using the correct URL within MS Webfolders, but the other problems with\nMOVE and copy cannot be fixed this way.\n\nI admit that this problem is difficult to fix. Maybe there could be a check for\nthe request method in CoyoteAdapter.postParseRequest to prevent the redirect for\nCOPY and MOVE methods. Maybe there is the possibility of creating an xml\nattribute for the coyote connector which lets you specify which methods should\nnot do redirects with a default value to \"\". But I am not sure if it is easy to\nget the configuration settings for the coyote connector from this method.\nWhat happens if you use a url-pattern of /* for the servlet mapping? I have \nstepped though this using telnet and I don\'t see the 302. That being said, it \nstill doesn\'t work and I am looking into why.OK, I have looked at this further (using a url-pattern of /*) and it does \nwork. The errors I was seeing were as a result of an invalid cache due to \nprevious testing.\n\nThere is a minor issue in that the status code returned will always be 204. \nThis is not 100\% compliant with para 8.9.4 of the servlet spec.\n\nNote I am using the latest code from CVS.\n\nI\'l leave this open until I fix the status code issue but I am dropping the \nseverity.Yes, this is a good workaround (and is the mapping used in the webdav example\nwebapp): no welcome file processing (or folder redirection) will occur in that case.I can confirm that the change in the servlet mapping makes it work for me too\n(even with MS Webfolders :-)).\nThank you for looking into this and for your quick help.\nBTW: I noticed that the webdav webapp delivered with Tomcat 5.0.19 already uses\nthe /* and thus correct servlet mapping. Maybe a comment should be added to the\nweb.xml file that setting the mapping to / will break things with MS Webfolders.The status code issue has now been fixed in CVS for TC5 and TC4. I have also \nimproved the comment in the web.xml for TC5.',?,BUG
27276,'JAASCallbackHandler gives erroneous warning due to buggy implementation','Tomcat 5',Catalina,rlenard,dev,'If there is a null password set (the default for a PasswordCallback) then \nJAASCallbackHandler.handle() gets a NullPointerException at line 156 (trying to \nset the password).  This is just completely spurious.Any patch to propose ?Something like this should do it.\n$ diff JAASCallbackHandler.java{.orig,}\n156,157c156,161\n<                 ((PasswordCallback) callbacks[i]).setPassword\n<                     (password.toCharArray());\n---\n>                 final char[] passwordcontents;\n>                 if (password != null)\n>                     passwordcontents = passowrd.toCharArray();\n>                 else\n>                     passwordcontents = new char[0];\n>                 ((PasswordCallback) callbacks[i]).setPassword(passwordcontents\n);The proposed patch looks ok.',?,BUG
27296,'Session may be used before being declared valid','Tomcat 5',Catalina:Cluster,adeshpande,dev,'taken from my email : \n\nit seems that DeltaSession.setId() fires the\nsessionCreated events to registered listeners, but this happens before a\nsession is declared valid ( i.e. setValid(true) has not been called ).\n\nso when a  registered listener tries to utilize ( what it seems to\nbelieve is ) a newly created session, the setAttribute method throws the\nIllegalStateException..Created attachment 10594\npatch for issue . n.b. patch is against HEAD, but bug was reported against 5.0.19Fixed, thanks for the tip',?,BUG
27299,'Using -security and port 80 causes crash','Tomcat 5',Catalina,wbrogden,dev,'download and install jakarta-tomcat5.19.zip - feb 27 version\nSet environment CATALINA_HOME=C:\\Servers\\Tomcat-5.0.19\n  with port 8080 and no use of -security  - ok\n  with 8080 and -security in commandline - ok\n  \n  change server.xml to port 80 regular startup.bat\n  http://localhost/    - works fine\n\n  continue with server.xml port 80 with -security in startup.bat command line\n  \n try for  http://localhost/\n  no response, extended bunch of errors in command prompt window, \n  the total log is:\n\n2004-02-27 11:20:49 StandardContext[/balancer]org.apache.webapp.balancer.\nBalancerFilter: init(): ruleChain: [org.apache.webapp.balancer.RuleChain: [org.\napache.webapp.balancer.rules.URLStringMatchRule: Target string: News / Redirect \nURL: http://www.cnn.com], [org.apache.webapp.balancer.rules.\nRequestParameterRule: Target param name: paramName / Target param value: \nparamValue / Redirect URL: http://www.yahoo.com], [org.apache.webapp.balancer.\nrules.AcceptEverythingRule: Redirect URL: http://jakarta.apache.org]]\n2004-02-27 11:20:50 StandardContext[/jsp-examples]ContextListener: \ncontextInitialized()\n2004-02-27 11:20:50 StandardContext[/jsp-examples]SessionListener: \ncontextInitialized()\n2004-02-27 11:20:50 StandardContext[/servlets-examples]ContextListener: \ncontextInitialized()\n2004-02-27 11:20:50 StandardContext[/servlets-examples]SessionListener: \ncontextInitialized()\n2004-02-27 11:21:04 StandardWrapperValve[org.apache.jsp.index_jsp]: Servlet.\nservice() for servlet org.apache.jsp.index_jsp threw exception\njava.lang.NoClassDefFoundError: org/apache/tomcat/util/buf/HexUtils\n\tat org.apache.coyote.http11.filters.ChunkedOutputFilter.\ndoWrite(ChunkedOutputFilter.java:163)\n\tat org.apache.coyote.http11.InternalOutputBuffer.\ndoWrite(InternalOutputBuffer.java:612)\n\tat org.apache.coyote.Response.doWrite(Response.java:586)\n\tat org.apache.coyote.tomcat5.OutputBuffer.realWriteBytes(OutputBuffer.java:\n411)\n\tat org.apache.tomcat.util.buf.ByteChunk.append(ByteChunk.java:332)\n\tat org.apache.tomcat.util.buf.IntermediateOutputStream.write(C2BConverter.\njava:274)\n\tat sun.nio.cs.StreamEncoder$CharsetSE.writeBytes(StreamEncoder.java:336)\n\tat sun.nio.cs.StreamEncoder$CharsetSE.implFlushBuffer(StreamEncoder.java:\n404)\n\tat sun.nio.cs.StreamEncoder$CharsetSE.implFlush(StreamEncoder.java:408)\n\tat sun.nio.cs.StreamEncoder.flush(StreamEncoder.java:152)\n\tat java.io.OutputStreamWriter.flush(OutputStreamWriter.java:213)\n\tat org.apache.tomcat.util.buf.WriteConvertor.flush(C2BConverter.java:223)\n\tat org.apache.tomcat.util.buf.C2BConverter.flushBuffer(C2BConverter.java:\n166)\n\tat org.apache.coyote.tomcat5.OutputBuffer.realWriteChars(OutputBuffer.java:\n613)\n\tat org.apache.tomcat.util.buf.CharChunk.append(CharChunk.java:298)\n\tat org.apache.coyote.tomcat5.OutputBuffer.write(OutputBuffer.java:518)\n\tat org.apache.coyote.tomcat5.CoyoteWriter.write(CoyoteWriter.java:165)\n\tat org.apache.jasper.runtime.JspWriterImpl.flushBuffer(JspWriterImpl.java:\n161)\n\tat org.apache.jasper.runtime.JspWriterImpl.write(JspWriterImpl.java:368)\n\tat org.apache.jasper.runtime.JspWriterImpl.write(JspWriterImpl.java:379)\n\tat org.apache.jsp.index_jsp._jspService(index_jsp.java:50)\n\tat org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:133)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.\njava:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.\ninvoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.apache.catalina.security.SecurityUtil$1.run(SecurityUtil.java:284)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAsPrivileged(Subject.java:500)\n\tat org.apache.catalina.security.SecurityUtil.execute(SecurityUtil.java:306)\n\tat org.apache.catalina.security.SecurityUtil.doAsPrivilege(SecurityUtil.\njava:200)\n\tat org.apache.catalina.core.ApplicationFilterChain.\ninternalDoFilter(ApplicationFilterChain.java:278)\n\tat org.apache.catalina.core.ApplicationFilterChain.\naccess$000(ApplicationFilterChain.java:97)\n\tat org.apache.catalina.core.ApplicationFilterChain$1.\nrun(ApplicationFilterChain.java:187)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat org.apache.catalina.core.ApplicationFilterChain.\ndoFilter(ApplicationFilterChain.java:183)\n\tat org.apache.catalina.core.StandardWrapperValve.\ninvoke(StandardWrapperValve.java:257)\n\tat org.apache.catalina.core.StandardValveContext.\ninvokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:\n567)\n\tat org.apache.catalina.core.StandardContextValve.\ninvokeInternal(StandardContextValve.java:245)\n\tat org.apache.catalina.core.StandardContextValve.\ninvoke(StandardContextValve.java:199)\n\tat org.apache.catalina.core.StandardValveContext.\ninvokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:\n567)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.\njava:184)\n\tat org.apache.catalina.core.StandardValveContext.\ninvokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.\njava:164)\n\tat org.apache.catalina.core.StandardValveContext.\ninvokeNext(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:\n567)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.\njava:156)\n\tat org.apache.catalina.core.StandardValveContext.\ninvokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:\n567)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:206)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:\n833)\n\tat org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.\nprocessConnection(Http11Protocol.java:732)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:\n619)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.\nrun(ThreadPool.java:688)\n\tat java.lang.Thread.run(Thread.java:534)\n------------------------\nI also observed this with release 5.0.18This is indeed 100\% specific to port 80. Other ports don\'t do that.I committed an ugly fix for this issue (which, BTW, has a 100\% rational\nexplanation: try http://localhost:80/).',?,BUG
27300,'SMAP line numbers incorrect when JSP comments are present','Tomcat 5',Jasper,robw,dev,'If a JSP contains JSP comments, the generated servlet does not contain the JSP \ncomments. Consequently, the SMAP line mappings are incorrect. \n\nFor example, given a JSP:\n\n<html>\n  <head>\n    <title>Untitled Document</title>\n  </head>\n  <\%--\n  JSP comment\n  --\%>\n  <body>\n  </body>\n</html>\n\nThe relevant section of the generated servlet (lines 42 to 49, inclusive) is:\n\n      out.write(\"<html>\\n\");\n      out.write(\"  <head>\\n\");\n      out.write(\"    <title>Untitled Document</title>\\n\");\n      out.write(\"  </head>\\n\");\n      out.write(\"  \\n\");\n      out.write(\"  <body>\\n\");\n      out.write(\"  </body>\\n\");\n      out.write(\"</html>\");\n\nAnd the Generated SMAP is:\n\nSMAP\ntest_jsp.java\nJSP\n*S JSP\n*F\n+ 0 test.jsp\ntest.jsp\n*L\n1,8:42\n*E\n\nThe fix requires the following two modications:\n\n1) In the class org.apache.jasper.compiler.TextOptimizer, the overriden method \nvisit(Node.Comment n) must be removed.\n\n\n2) The inner class org.apache.jasper.compiler.Generator.GenerateVisitor must\noverride the method visit(Node.Comment n). I tested this, using the following \ncode, which works correctly:\n\n    public void visit(Node.Comment n) throws JasperException {\n            n.setBeginJavaLine(out.getJavaLine());\n            out.printin(\"out.write(\\\"<\%--\");\n            String text = n.getText();\n            boolean newLine = false;\n\n            if (text != null) {\n              for (int i = 0; i < text.toCharArray().length; i++)\n              {\n                if (newLine) {\n                  out.printin(\"out.write(\\\"\");\n                }\n\n                char ch = text.charAt(i);\n\n                if (ch == \'\\n\') {\n                  out.println(\"\\\\n\\\");\");\n                  newLine = true;\n                }\n                else {\n                  out.print(ch);\n                  newLine = false;\n                }\n              }\n            }\n\n            // @todo: should the closing tag have a newline appended to it?\n            if (newLine) {\n              out.printil(\"out.write(\\\"--\%>\\\");\");\n            }\n            else {\n              out.println(\"--\%>\\\");\");\n            }\n\n            n.setEndJavaLine(out.getJavaLine());\n        }Applying the first step in you suggestion seems to fix the line mapping problem.\n I don\'t think it is necessary, or even correct, to generate the jsp comments in\nthe response.  \n\nThanks for reporting and the patch.Kim-Man, you are indeed correct - I forgot that JSP comments should not be \nemitted. I\'ve verified independently that the first patch alone is sufficient. \n\nThanks for the fast response. ',?,BUG
27307,'Suggestions to improve JNDI/DataSource Howto','Tomcat 5',Webapps:Documentation,nagoya,dev,'Hi all,\n\nI\'ve been reading the Howto and have some suggestions (specially regarding the\nMySQL example):\n\n- it\'s necessary to copy the JDBC driver jar on TOMCAT_HOME/common/lib\n\n- you say: Please let us know if you have tested the new MySQL mm.mysql 3.0 driver. \n\nWell, I did (version 3.0.11-stable). It works the way it is, but I\'d suggest you\nupdate the howto to use the new driver. So, instead of :\n\n    <!-- Class name for mm.mysql JDBC driver -->\n    <parameter>\n       <name>driverClassName</name>\n       <value>org.gjt.mm.mysql.Driver</value>\n    </parameter>\n\nIt should be:\n\n    <!-- Class name for MySQL Connector/J driver -->\n    <parameter>\n       <name>driverClassName</name>\n       <value>com.mysql.jdbc.Driver</value>\n    </parameter>\n\n\n- section 3 (web.xml configuration) uses the old web.xml format (Servlet 2.3):\n\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n    <!DOCTYPE web-app PUBLIC\n    \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"\n    \"http://java.sun.com/dtd/web-app_2_3.dtd\">\n<web-app>\n  <description>MySQL Test App</description>\n  <resource-ref>\n      <description>DB Connection</description>\n      <res-ref-name>jdbc/TestDB</res-ref-name>\n      <res-type>javax.sql.DataSource</res-type>\n      <res-auth>Container</res-auth>\n  </resource-ref>\n</web-app>\n\nI know Tomcat 5 accepts both formats, but we should be \"incentiving\" people to\nuse the new one. So, it should be:\n\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n \n<web-app xmlns=\"http://java.sun.com/xml/ns/j2ee\"\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n    xsi:schemaLocation=\"http://java.sun.com/xml/ns/j2ee\nhttp://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd\"\n    version=\"2.4\">\n    \n  <description>MySQL Test App</description>\n  <resource-ref>\n      <description>DB Connection</description>\n      <res-ref-name>jdbc/TestDB</res-ref-name>\n      <res-type>javax.sql.DataSource</res-type>\n      <res-auth>Container</res-auth>\n  </resource-ref>\n\n</web-app>\n\n- section 4 (Test code). It would be nicer/simpler a JSTL/SQL example, like this:\n\n<\%@ taglib uri=\"http://java.sun.com/jsp/jstl/sql\" prefix=\"sql\" \%>\n<\%@ taglib uri=\"http://java.sun.com/jsp/jstl/core\" prefix=\"c\" \%>\n\n<sql:query var=\"rs\" dataSource=\"jdbc/TestDB\">\nselect id, foo, bar from testdata\n</sql:query>\n\n<html>\n  <head>\n    <title>DB Test</title>\n  </head>\n  <body>\n\n  <h2>Results</h2>\n  \n<c:forEach var=\"row\" items=\"${rs.rows}\">\n    Foo ${row.foo}<br/>\n    Bar ${row.bar}<br/>\n</c:forEach>\n\n  </body>\n</html>\n\n\n\nI can create a patch with these changes, if someone is willing to apply it (I\'m\na committer on other projects, so I know how painful the process is :-).\n\nRegards,\n\nFelipeYes, please submit a patch.Created attachment 10612\nResult of \'cvs diff -u\' on directory jakarta-tomcat-catalina/webapps/docsCreated attachment 10613\nNew patch with a warning about copying the JDBC driver jarCreated attachment 10614\nNew howto after running antOk, patch added:\n\nhttp://nagoya.apache.org/bugzilla/showattachment.cgi?attach_id=10613\n\nAnd also a \"screenshot\" of the results:\n\nhttp://nagoya.apache.org/bugzilla/showattachment.cgi?attach_id=10614\n\n-- Felipe\nFixed. Thanks.',?,IMPROVEMENT
27309,'NPE in ApplicationHttpRequest.java:546','Tomcat 5',Catalina,alef,dev,'If localSession comes back as null, localSession.access() throws a \nNullPointerException. There is a check for null but it is after the \nlocalSession.access() call.\nSuggested solution: put an if (localSession == null) around localSession.access\n() or move localSession.access() down after the existing null check.Sorry for the trouble. This is fixed now.*** Bug 27859 has been marked as a duplicate of this bug. ****** Bug 27969 has been marked as a duplicate of this bug. ***',?,BUG
27330,'[TagPlugins] Invalid generated JAVA code when nesting tags','Tomcat 5',Jasper,yannc76,dev,'Jasper in 5.0.19 generates invalid JAVA code when using the \nprovided \'tagPlugins.xml\' to replace JSTL1.1 tags w/ custom JAVA code.\n\nSame application/JSP pages compile and work fine w/ 5.0.16 and previous \nversions.\n\nAs far as I understand the problem, the code replacement for the <c:forEach> \ntag references \"pageContext\" inside its while()-loop, whereas it should use the \nprovided argument \"_jspx_page_context\" (the <c:forEach> tag is nested in other \ntags).\n\nNote: exactly the same problem could as well appear with the other tag \nreplacements since they\'re all referencing \"pageContext\" in their JAVA-code.\n\nI suppose the name of the PageContext parameter must have changed recently and \nhas not been updated in the TagPlugins yet?!The bug is not in the tag plugins, but you are right that it worked in 5.0.16.\nThe problem is in fixing another bug, page_context is no longer defined\nif the codes for a nested tag is generated in a separate method, which is\nwrong since page_context should be defined, as required by the spec.\n\nI\'ll check with Jan to fix this problem.  Thanks for reporting.Fix in CVS by defining pageContext (not page_context) in the body of the method\nfor nested tag.',?,BUG
27336,'digest.bat throws ClassNotFoundException','Tomcat 5',Catalina,florian.ebeling,dev,'The windows batch script digest.bat throws a ClassNotFoundException for \n\njavax.management.MBeanRegistration\n\nAs a workaround we included the jmx.jar in the tool-wrapper.bat, but I doubt \nthat this really fits well with the tool-wrapper.bat idea. Still, this fixes the\nmentioned problem. \n\nThe problem persists in 5.0.19.Fixed.',?,BUG
27338,'Wrong mappings for JSP Documents (.jspx)','Tomcat 5',Jasper,martin.grebac,dev,'See attached basic.jspx file translated to attached basic_jspx.java file.\nThe mapping for the file is:\n\nSMAP\nbasic_jspx.java\nJSP\n*S JSP\n*F\n+ 0 basic.jspx\njsp2/jspx/basic.jspx\n*L\n2:42\n3,2:44\n5:46,2\n9,5:49\n19,4:56\n*E\n\n So, there\'s a mapping between lines 19 -> 56 and 20->57 but it actually should\nbe 20 -> 56 and 21 -> 57 (seems like CDATA is not handled properly). \n The result is weird, because we are looping between \'CDATA\' and \'for (..)\'\nlines , not through the loop itself. There are other problems in the first\nscriptlet, too (again CDATA?).\n This prevents debugging of JSP Documents.Created attachment 10620\ngenerated servletCreated attachment 10621\njspFixed in CVS.  Thanks for reporting this bug and providing the test case.Thanks a lot - I really appreciate your really fast response. Will the fix get\nto 5.0.next release? \n\nSeems like I\'ll submit more bugs against some additional little problems with\nxml mappings, though ;O)',?,BUG
27368,'Incorrect smap mappings for text in JSP Documents','Tomcat 5',Jasper,martin.grebac,dev,'There are missing mappings for some text in XML Documents. See attached jsp +\nservlet. \n\nSMAP is:\n\nSMAP\nindex_jspx.java\nJSP\n*S JSP\n*F\n+ 0 index.jspx\nindex.jspx\n*L\n4:42\n7:46,3\n9:52\n*E\n\nLines 5,6,8 do not have any corresponding mappings - should be 43, 44, 50\nLine 7 is mapped to 46,3 - should be 45,5Created attachment 10634\nJSPCreated attachment 10635\ngenerated servletThis is now fixed in CVS, and will be included in the next Tomcat 5 release.',?,BUG
27447,'CoyoteReader.readLine() read ahead problems','Tomcat 5',Catalina,rbirch,dev,'When posting utf-8 data with either \\r\\n or \\n and that data exceeds the \nMAX_LINE_LENGTH the following I/O exception occurs:\nServlet threw exception\njava.io.IOException\n\tat org.apache.coyote.tomcat5.InputBuffer.reset(InputBuffer.java:463)\n\tat org.apache.coyote.tomcat5.CoyoteReader.reset(CoyoteReader.java:153)\n\tat org.apache.coyote.tomcat5.CoyoteReader.readLine\n(CoyoteReader.java:207)\n\tat symhttp.DBRActivationServlet.doPost(DBRActivationServlet.java:31)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:763)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:284)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:204)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:257)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:567)\n\tat org.apache.catalina.core.StandardContextValve.invokeInternal\n(StandardContextValve.java:245)\n\tat org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:199)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:567)\n\tat org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:184)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:164)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:567)\n\tat org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:156)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:567)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service\n(CoyoteAdapter.java:206)\n\tat org.apache.coyote.http11.Http11Processor.process\n(Http11Processor.java:833)\n\tat \norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio\nn(Http11Protocol.java:732)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java:619)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:688)\n\tat java.lang.Thread.run(Thread.java:536)\n\nIf there are NO \\r\\n or \\n then there is no problem sending data greater than \nMAX_LINE_LENGTH. \n\nHere is my servlet test code:public void doPost(HttpServletRequest request, \nHttpServletResponse response)\nthrows ServletException, IOException {\n    response.setContentType(CONTENT_TYPE);\n\n    System.out.println(\"Reading body data\\n\");\n    String contentLen = request.getHeader(\"Content-Length\");\n    if ( contentLen != null ) {\n      System.out.println(\"String Content-Length: \" + contentLen);\n      BufferedReader br = request.getReader();\n      String in = null;\n      while ( (in = br.readLine()) != null ){\n        System.out.println(in);\n      }\n    } else {\n      System.out.println(\"Null content-length\");\n    }\n    PrintWriter out = response.getWriter();\n    sendStuff(out);\n  }\n  //Clean up resources\n  public void destroy() {\n  }\n\nI think the problem area is in CoyoteReader.readLine() and the handling of \\n \nand \\r\\n. This seems to be around lines  178 - 194 of  \norg.apache.coyote.tomcat5.CoyoteReader.java. \n\nProblem occurred first in 5.0.16, did an upgrade and still had the problem in \n5.0.19, tried it in some version of Tomcat 4 and had no problems.I will try to fix this.\nI recommend however that you attempt to design stuff more efficiently. Your web\napplication is very likely slow.The bug is likely fixed, but this could cause regressions. Please test it.Thanks for the speedy work, but the problem still exists. I have attached 6 \ntest files and a simple test servlet. If I send these test files using our http \nclient or the curl http client the results are the same. The curl command line \nI use is:\n\ncurl -F \"name=@postBigLine.txt\" http://localhost:8082/Test/TestServlet\n\nThanksCreated attachment 10712\nThese are some files with text to test. We actually use XML, but these should suffice',?,BUG
27458,'Tomcat Online Documentation: Missing links to search for tomcat5 bugs','Tomcat 5',Webapps:Documentation,wbudreau,dev,'The page above should have better links to bugzilla.\n\nAlso, on page I was indirectly referenced to, there should be a link to \n Search the Tomcat 5 bug database <a\nhref=\"http://nagoya.apache.org/bugzilla/query.cgi?product=Tomcat\%205\"here.</a>\nCurrently there are only links to tomcat 3 and 4 categories.\n\n\nI apologize for posting this to this Tomcat bug database, but there is no mail\naddress for submitting these web page requests without joining a mailing list,\nnor is there a component of the tomcat/apache bugzilla database (I could\ndiscover) which allows for this type of request.',?,DOCUMENTATION
27469,'SourceDebugExtension attribute not present in inner-class classfile','Tomcat 5',Jasper,martin.grebac,dev,'See attached application and attached translated class files. There\'s an inner\nclass defined in the JSP - it\'s class file does not contain the\nSourceDebugExtension attribute. The mappings are defined in the outer class\nfile, but it\'s not correct and cannot be used through JDI - it\'s not possible to\nretrieve the mappings for the inner class in this case.\nI wouldn\'t consider this a very big problem for JSPs at all, but it is a problem\nfor tag files that do generate some inner classes and it\'s not possible to debug\ntag files at all on JSP level.\n\nI\'m enclosing a snippet of email discussion with Robert Field (I actually\nconsidered this to be a JDK bug at first):\n\n\"Someone should verify that there is no SourceDebugExtension on the inner class\nfirst.  If there is and we aren\'t using it that would be our problem.\"\n\n\"If there is no JSP stratum (no SourceDebugExtension in the class file) that\nsounds like a JSP bug.\"\n\n-RobertCreated attachment 10674\nTranslated sourceCreated attachment 10675\nWeb appArrgh!  The orginal JSR45 support implementation in Jasper never include inner\nclass!  :-(\n\nNote that in general, Jasper does not know about what\'s inside scriptlets, so it\ndoes not know about any inner classes that are defined in them.  This is likely\na WONTFIX for providing smaps for inner classes in scriptlets.  Glad you agree\nthis is not a big problem in practice.\n\nJasper does know about the inner classes it generates.  I\'ll see if smaps can be\nprovided for them.  Stay tuned.This fixed for jasper generated class files, but not for user defined inner classes.',?,IMPROVEMENT
27478,'cross context redirects don\'t reference correct session info when imported context redirects back to original context :','Tomcat 5',Catalina,adeshpande,dev,'I have discovered another problem, that somehow sessions are either getting lost\nor mixed up when you do cross context imports  in at least one advanced scenario :\n\n1) page Z in context \'a\' import a page X from context \'b\'\n2) page X in context \'b\' imports a page Y in context \'a\'\n\nin this case, the session that was created when you import page X in context b\nis the session that\'s available in page Y in context a.\n\nhere\'s my test case  ---\n\ntest_page1.jsp ( context \'/profile\' ) :\n\n   <\%@ taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" \%>\n   Test of cross context imports :\n   <\% request.getSession().setAttribute(\"test_attrib\", \"12345\"); \%>\n   <\% out.println(\"test_attrib in ( test_page1.jsp ) is \" +\n   session.getAttribute(\"test_attrib\") ); \%><br/>\n   <\% out.println(\"session id (  in test_page1.jsp) is : \" +\n   request.getSession().getId() ); \%> <br/>\n   <c:import url=\"/test_other.jsp\" context=\"/\" />\n\ntest_other.jsp ( context \'/\' ) :\n\n   <\%@ taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" \%>\n   <\% request.getSession().setAttribute(\"test_other_attrib\", \"54321\" );\n\%>\n   <\% out.println(\"test attrib ( in test_other.jsp ) is : \" +\n   request.getSession().getAttribute(\"test_attrib\") ); \%><br/>\n   <\% out.println(\"test other attrib ( in test_other.jsp) is : \" +\n   request.getSession().getAttribute(\"test_other_attrib\") ); \%><br/>\n   <\% out.println(\"session id (  in test_other.jsp) is : \" +\n   request.getSession().getId() ); \%> <br/>\n   <c:import url=\"/test_page2.jsp\" context=\"/profile\"/>\n\ntest_page2.jsp ( context \'/profile\' ) :\n\n   <\%@ taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" \%>\n   <\% out.println(\"test_attrib ( in test_page2.jsp ) is \" +\n   session.getAttribute(\"test_attrib\") ); \%> <br/>\n   <\% out.println(\"test other attrib ( in test_page2.jsp) is : \" +\n   request.getSession().getAttribute(\"test_other_attrib\") ); \%> <br/>\n   <\% out.println(\"session id (  in test_page2.jsp) is : \" +\n   request.getSession().getId() ); \%> <br/>\n\n\n\nThe output i get when I hit test_page1.jsp is :\n\n\nTest of cross context imports : test_attrib in ( test_page1.jsp ) is\n12345\nsession id ( in test_page1.jsp) is : 2796EBFF6C413841B7B2D496D7E8FD3F\ntest attrib ( in test_other.jsp ) is : null\ntest other attrib ( in test_other.jsp) is : 54321\nsession id ( in test_other.jsp) is : 2796EBFF6C413841B7B2D496D7E8FD3F\ntest_attrib ( in test_page2.jsp ) is null\ntest other attrib ( in test_page2.jsp) is : 54321\nsession id ( in test_page2.jsp) is : 2796EBFF6C413841B7B2D496D7E8FD3F\n\n\nThe output I get when i hit test_other.jsp is :\n\n\ntest attrib ( in test_other.jsp ) is : null\ntest other attrib ( in test_other.jsp) is : 54321\nsession id ( in test_other.jsp) is : 55B2068D3011D727DF15068ADAD713E2\ntest_attrib ( in test_page2.jsp ) is null\ntest other attrib ( in test_page2.jsp) is : null\nsession id ( in test_page2.jsp) is : 55B2068D3011D727DF15068ADAD713E2\n\n\nthe output that i get when i hit test_page2.jsp :\n\ntest_attrib ( in test_page2.jsp ) is 12345\ntest other attrib ( in test_page2.jsp) is : null\nsession id ( in test_page2.jsp) is : 2796EBFF6C413841B7B2D496D7E8FD3F2 fixes are necessary --\n\n1)  StandardContext.getContext(String path) does a check for  context==null when\nit should be checking for child==null (  a context==null would never fail, and\nif it was null, there\'d be an NPE long before )\n\n2) The other issue is that cross context requests are set crossContext  by\nchecking the current context vs. the originating request, instead of the\npreceding request, which means that when you import from context A to context B,\nthen from  B  back to A,  the second import is not considered cross context and\nthe session information is retrieved from the local session in the (wrong) context. \n\nI hope this is somewhat explanatory.  Please feel to contact me for clarification.This should be fixed now.',?,BUG
27513,'When ThreadPool is shutdown one idle thread is left behind','Tomcat 5',Unknown,sfzhi,dev,'When org.apache.tomcat.util.threads.ThreadPool.shutdown() is called it\nterminates all the idle threads except one (the last one that became idle). The\nproblem is that the mentioned method explicitly leaves that thread behind. That\ncan be easily seen (using a debugger) when tomcat is shutting down. In order to\nsolve the problem a very small correction is needed. In the mentioned method the\nline:\n\n    for(int i = 0 ; i < (currentThreadCount - currentThreadsBusy - 1) ; i++) {\n\nshould become:\n\n    for(int i = 0 ; i < (currentThreadCount - currentThreadsBusy) ; i++) {\n\nso that the loop would iterate over all the idle thread without exception.Fixed.',?,BUG
27517,'The pageEncoding attribute is not used, when charset value is set.','Tomcat 5',Catalina,petr.pisl,dev,'When you have jsp page saved in encoding UTF-8:\n\n<\%@page contentType=\"text/html;charset=ISO-8859-2\"\%>\n<\%@page pageEncoding=\"UTF-8\"\%>\n<html>\n<head><title>JSP Page</title></head>\n<body>\n?šš???ž?ž?ýýáýžýí\n<br><hr>\n</body>\n</html>\n\nthen the jsp file is read with ISO-8859-2 encoding. There are wrong Czech\ncharacters in the generated servlet.  But according to the JSP 2.0 specification\nthe file should be read with encoding from pageEncodintg (UTF-8 in my case) and\nthe responds has to be in charset value encoding ( ISO-8859-2).\n\nWe used the jasper-compiler.jar as jsp parser in NetBeans and we use the result\nof the parsing for saving and loading jsp files into the editor, where the wrong\nvalue of encoding causes problems.I don\'t agree with that interpretation.What do you exectly think?There is part of the specification:\n\nJSP.4.1\n...\nFor JSP pages in standard syntax, the page character encoding is determined from\nthe following sources:\n-A JSP configuration element page-encoding value whose URL pattern matches the page.\n-The pageEncoding attribute of the page directive of the page. It is a\ntranslation- time error to name different encodings in the pageEncoding\nattribute of the page directive of a JSP page and in a JSP configuration element\nwhose URL pattern matches the page.\n- The charset value of the contentType attribute of the page directive. This is\nused to determine the page character encoding if neither a JSP configuration\nelement page-encoding nor the pageEncoding attribute are provided.\n- If none of the above is provided, ISO-8859-1 is used as the default character\nencoding.\n\n\n\n\nAppendix JSP.D\nPage Encoding Detection\n....\n\n3. If the file is a JSP page in standard syntax, use these steps. \n\na. Check whether there is a JSP configuration element <page-encoding> whose URL\npattern matches this file. \n\nb. Read the file using the initial encoding and search for a pageEncoding\nattribute in a page declaration. The specification requires the attribute to be\nfound only if it is not preceded by non-ASCII characters, so simplified\nimplementations are allowed. \n\nc. Report an error if there are a <page-encoding> configuration element whose\nURL pattern matches this file and a pageEncoding attribute, and the two name\ndifferent encodings. \n\nd. If there is a <page-encoding> configuration element whose URL pattern matches\nthis file, the page character encoding is the one named in this element. \n\ne. Otherwise, if there is a pageEncoding attribute, the page character encoding\nis the one named in this attribute. \n\nf. Otherwise, read the file using the initial encoding and search for a charset\nvalue within a contentType attribute in a page declaration. If it exists, the\npage character encoding is the one named in this charset value. The\nspecification requires the attribute to be found only if it is not preceded by\nnon-ASCII characters, so simplified implementations are allowed. \n\ng. Otherwise, the page character encoding is ISO-8859-1.I think that:\n- you have way too much time on your hands\n- charset and pageEncoding define the same thing, so this is at best an issue of\npriorityI don\'t think so, that pageEncoding and charset define the same thing.\n\nAccording to chapter \"JSP.4.1 Page Character Encoding\" the pageEncoding is for\nencoding the page file itself. And according to chapter \"JSP.4.2 Response\nCharacter Encoding\" the charset encoding is used for responds. When both\nencoding are defined, then they are used for different things.Yes, of course. We have a disagreement then (sec 1.10.1). If nobody fixes this\nhorrible \"bug\" for a while, then I will resolve it appropriately.Hi Petr,\n\nyou\'re right, this is a bug. I\'ll commit a patch shortly.\n\nFor the time being, as a workaround, you may want to collapse the 2 page\ndirectives into a single page directive, like this:\n\n<\%@page contentType=\"text/html;charset=ISO-8859-2\" pageEncoding=\"UTF-8\"\%>\n\nJanHi Jan,\n\nyes, it\'s workaround, but people can have some problems during saving or opening\njsp files in the jsp editor in NetBeans IDE. We use jasper-compiler.jar for\nobtaining information about a jsp and the encoding is one of them. I\'m\nappreciate the  promiss of  fixing it.\n\nthanks\n\nPetr Thanks for the quick fix. \n*** Bug 29342 has been marked as a duplicate of this bug. ***',?,BUG
27520,'NullPointerException when using JspC on webapp tree containing unreadable dir','Tomcat 5',Jasper,seth.leger,dev,'When using JspC, it is possible to get a null pointer exception if the webapp\ntree you are attempting to compile contains an unreadable directory. Here are\nthe lines that cause the stack trace from JspC.java, CVS version 1.61:\n\n 806                             if (f.exists() && f.isDirectory()) {\n 807                                 String[] files = f.list();\n 808                                 String ext;\n 809                                 for (int i = 0; i < files.length; i++) {\n 810                                     File f2 = new File(s, files[i]);\n\nThere is no check before line 809 to see if File.list() returned a null value.\nTherefore, we get the following stack trace from the jspc Ant task:\n\n   [jasper2] java.lang.NullPointerException\n  [jasper2]     at org.apache.jasper.JspC.scanFiles(JspC.java:809)\n  [jasper2]     at org.apache.jasper.JspC.execute(JspC.java:856)\n  [jasper2]     at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  [jasper2]     at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n  [jasper2]     at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n  [jasper2]     at java.lang.reflect.Method.invoke(Method.java:324)\n  [jasper2]     at org.apache.tools.ant.TaskAdapter.execute(TaskAdapter.java:157)\n  [jasper2]     at\norg.apache.tools.ant.UnknownElement.execute(UnknownElement.java:306)\n  [jasper2]     at org.apache.tools.ant.Task.perform(Task.java:401)\n  [jasper2]     at\norg.apache.tools.ant.taskdefs.Sequential.execute(Sequential.java:102)\n  [jasper2]     at\norg.apache.tools.ant.UnknownElement.execute(UnknownElement.java:306)\n  [jasper2]     at org.apache.tools.ant.Task.perform(Task.java:401)\n  [jasper2]     at\norg.apache.tools.ant.taskdefs.Parallel$TaskRunnable.run(Parallel.java:457)\n  [jasper2]     at java.lang.Thread.run(Thread.java:536)\n\nIt would be much nicer if the task simply logged a warning or ignored the\nunreadable directory.',?,BUG
27553,'Bad cookie in request logged as error','Tomcat 5',Connector:Coyote,sam,dev,'Very minor issue but requests with badly formatted cookies \ngenerate log messages at severity level error.\n\nIm not sure what the general rule is for logging badly formatted requests\nis but a warning in the logs at most seems adequate.\n\nThe code below also seems to catch Exception rather than just\njava.lang.IllegalArgumentException\n\nSorry if I should have raised this as \"enhancement\" rather than \"minor\".\n\nI think this is the relevant code:\n\njakarta-tomcat-catalina/catalina/src/share/org/apache/coyote/tomcat5/CoyoteAdapter.java\nLine 430 onwards:\n            try {\n                Cookie cookie = new Cookie(scookie.getName().toString(),\n                                           scookie.getValue().toString());\n                cookie.setPath(scookie.getPath().toString());\n                cookie.setVersion(scookie.getVersion());\n                String domain = scookie.getDomain().toString();\n                if (domain != null) {\n                    cookie.setDomain(scookie.getDomain().toString());\n                }\n                cookies[idx++] = cookie;\n            } catch(Exception ex) {\n                log.error(\"Bad Cookie Name: \" + scookie.getName() + \n                    \" /Value: \" + scookie.getValue(),ex);\n            }\n\nThis is one of the stack traces I got in the mail :\n\n2004-03-09 16:21:51,390[CoyoteAdapteri ] Bad Cookie Name: Path /Value: /\n java.lang.IllegalArgumentException: Cookie name \"Path\" is a reserved token at\njavax.servlet.http.Cookie.<init>(Cookie.java:185) at\norg.apache.coyote.tomcat5.CoyoteAdapter.parseCookies(CoyoteAdapter.java:424) at\norg.apache.coyote.tomcat5.CoyoteAdapter.postParseRequest(CoyoteAdapter.java:332)\nat org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:204) at\norg.apache.coyote.http11.Http11Processor.process(Http11Processor.java:828) at\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:700)\nat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:584) at\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:683)\nat java.lang.Thread.run(Thread.java:536)\n\nCheers\n\nSam',?,IMPROVEMENT
27617,'ppt and vsd MIME types should be included in web.xml','Tomcat 5',Unknown,pontillo,dev,'Having the following MIME types represented in the default Tomcat web.xml would\nbe useful:\n\n    <mime-mapping>\n        <extension>ppt</extension>\n        <mime-type>application/powerpoint</mime-type>\n    </mime-mapping>\n    <mime-mapping>\n        <extension>vsd</extension>\n        <mime-type>application/x-visio</mime-type>\n    </mime-mapping>Fixed.The lines in web.xml currently distributed with Tomcat 5.0.28 do not work for\nInternet Exploder.  Further, the web.xml file omits an entry for \"PPS\"\n(power-point show) files.\n\nDetails: I hit problems while attempting to provide access to powerpoint files\nusing Tomcat 5.0.28.  That version is distributed with these lines in web.xml:\n\n    <mime-mapping>\n        <extension>ppt</extension>\n        <mime-type>application/powerpoint</mime-type>\n    </mime-mapping>\n\nI compared the mime-types with entries in Apache 2.20 mime.types file,\nwhere I find only this:\n\n    application/vnd.ms-powerpoint        ppt\n\nBased on my tests, Firefox works fine with the application/powerpoint\nentry, but IE does not.  IE seems to require the\napplication/vnd.ms-powerpoint variation, and Firefox accepts that as\nwell.  I used the following to replace what is shown above with good results:\n\n    <mime-mapping>\n        <extension>ppt</extension>\n        <mime-type>application/vnd.ms-powerpoint</mime-type>\n    </mime-mapping>\n    <mime-mapping>\n        <extension>pps</extension>\n        <mime-type>application/vnd.ms-powerpoint</mime-type>\n    </mime-mapping>\n\nPlease consider using these entries in the web.xml distributed with Tomcat.\n\nI do not have Visio, so could not test the behavior of IE on a Visio file, but\nthat probably should be checked as well.\n\nI contacted Scott Pontillo, the original reporter of this bug, and he made the\nfollowing suggestion:\n\n>    As a longer-term solution to this problem, maybe it would be good to\n>establish a process for importing the entries from the native Apache\n>server periodically? It seems they are kept more up-to-date for that\n>product...\n\nI\'ve taken it upon myself to reopen the bug since it is easily reproducible and\nseems like such a minor issue.  I apologize if this was premature.  Thanks for\nlistening. Fixed in head, thanks.',?,IMPROVEMENT
27629,'Memory problem with GZIPOutputFilter','Tomcat 5',Connector:Coyote,Christian.Nester,dev,'Hi,\n\nthe Deflater object, that is used inside the GZIPStream uses native memory. \nThis memory will only be free, when the Deflater\'s finializer runs. See also \nSun\'s Bugparades. If the memory is not free, an OutOfMemoryError is created \nsooner or later.\nIn an enviroment with a lot of memory the java GC might be invoked too late. I \nwas able to crash tomcat with a lot of memory and some test load in a few \nseconds.\nThe solution is to explizitly close the Deflater Objekt to free the native \nmemory. This can be done by closing the GZIP stream.\nMy propose solution to fix the problem in GZIPOutputFilter is included below.\nAfter that change, I was not able to reproduce the crash.\nPlease verify my solution.\n\nRegards,\nChristian\n\n\n    public long end()\n        throws IOException {\n        if (compressionStream == null) {\n            compressionStream = new GZIPOutputStream(fakeOutputStream);\n        }\n        compressionStream.finish();\n\t  long result = ((OutputFilter) buffer).end();\n        compressionStream.close(); // frees the deflater memory!\n        return result;\n    }And this wouldn\'t work ?\n    public long end()\n        throws IOException {\n        if (compressionStream == null) {\n            compressionStream = new GZIPOutputStream(fakeOutputStream);\n        }\n        compressionStream.finish();\n        compressionStream.close(); // frees the deflater memory!\n        return ((OutputFilter) buffer).end();\n    }Hi,\n\nI assume, that this would also work. I am not very familiar with the \narchitecture of the filtering, so I wanted to place the close() call as \nconservative as possible (after the buffer.end() call). It was just to be on \nthe save side.\n\nRegards,\nChristian\nAs I understand it, only finish will output data. close is supposed to release\nmemory, so there shouldn\'t be any problem.\nWe really need to use a byte array based Java implementation for compression.\nAll the native code and fake streams make the code really bad.',?,OTHER
27642,'trimSpaces property not settable via command-line options','Tomcat 5',Jasper,vahur.sinijarv,dev,'There is no command-line option to turn on \'trimSpaces\' while \nprecompiling .jsp-s.Added \"-trimSpaces\" option to JspC',?,RFE
27664,'Welcome files not found in combination with jsp-property-group','Tomcat 5',Unknown,ronald,dev,'My web.xml contains the following fragment:\n\n   <welcome-file-list>\n      <welcome-file>index.html</welcome-file>\n   </welcome-file-list>\n   <jsp-config>\n      <jsp-property-group>\n         <url-pattern>/notwelcome/*</url-pattern>\n      </jsp-property-group>\n   </jsp-config>\n\nThe URL\'s \'<contextRoot>/notwelcome/\' and \'<contextRoot>/notwelcome\' both do not\ndeliver the file \'index.html\' that is located in the directory /notwelcome.\nInstead they result in a 404. If I remove the jsp-property-group, the welcome\nfile is delivered.\n\nI will attach a test war to demonstrate this behavior.Created attachment 10787\nDemonstrates described behavior.I think we are not going to fix that.I can conform this: the JSP servlet (which will handle all /notwelcome/* URLs)\nwill not handle welcome files.That is not according to the JSP specification.\n\nNowhere in the spec it is stated that welcome files suddenly should not work any\nlonger if they happen to be inside a jsp-property-group. Specifying a\njsp-property-group with url-pattern \'/*\' now effectively disables all welcome\nfiles in the application.\n\nAn example from the JSP spec (1-90):\n\n<jsp-property-group>\n   <url-pattern>/ja/*</url-pattern>\n   <page-encoding>Shift_JIS</page-encoding>\n</jsp-property-group>\n\nThe Japanese target audience would probably not be very happy with the fact that\nany welcome files below \'/ja/*\' stopped functioning. I\'m reopening this bug.Developers know how to reopen bugs if somehow I\'m wrong. Please don\'t waste my\ntime and yours for now.I\'m working on a fix - stay tuned.I found another problem with respect to jsp-property-groups and url-mappings.\nSee bug 27704.Fixed (I\'ll let the community decide if they want to go with this fix).\n\nNotice that in your example, /notwelcome/index.html will be interpreted as a\nJSP, as it matches the url-pattern of the jsp-property-group.\n\n',?,IMPROVEMENT
27665,'Nested tags with scripting variables generates invalid code','Tomcat 5',Jasper,clemens.wagner,dev,'Using nested custom tags that create scripting variables leads Jasper to create invalid code. Example:\n\n<my:bean name=\"outer\">\n        <\%-- outer is null iff pageContext.findAttribute(\"outer\") is null --\%>\n        <my:bean name=\"inner\"/>\n        <\%-- inner is always null even if pageContext.findAttribute(\"inner\") is not  --\%>\n </my:bean>\n<\%-- outer is null iff pageContext.findAttribute(\"outer\") is null --\%>\n\nwhere the bean-tag sets a value in the pageContext with the given name and any value.\nThis bug is known since tomcat version 4.1 (see bug 19361).Please include a deployable test case in war file.Created attachment 10919\nWAR and complete source which demonstrate the bug.Fixed.',?,BUG
27704,'Result of request.getServletPath() wrong in case JSP inside jsp-property-group','Tomcat 5',Jasper,ronald,dev,'A JSP that maps to a url-pattern in a jsp-property-group does not return the\ncorrect result on calling request.getServletPath(). Instead, this call will\nalways return the property group url pattern minus the trailing \'/*\'.\n\nExample:\n<url-pattern>/level1/*</url-pattern>\n\nA JSP in the directory \'/level1/level2/test.jsp\' calls request.getServletPath().\nThe result is \'/level1\' i.o. \'/level1/level2/test.jsp\'. This may be related to\nbug 27664.\n\nI will attach a test.war file that demonstrates the described behavior.Created attachment 10803\nTest case for the described behavior.Well, again, this is normal: the JSP servlet is mapped to the\njsp-property-group. Again, very little chance of being fixed for now ;)Ok, this may be perfectly normal from a code perspective, but it is unexpected\nbehavior that has by now caused me to replace my Servlet2.4/JSP2.0 application\nfor a Servlet2.3/JSP1.2 application.\n\nOf course everything will also work using the older specs but I\'m looking\nforward to these issues being fixed in a (hopefully not to remote) future version.\n\nAnd thanks for not closing my bug this time so I\'d have to reopen it again ;)I completely disagree with your two bug reports. Either they are invalid or the\nspecification is broken. The main problem is this sentence: \"If at least one\n<jsp-propertygroup> contains the most specific matching URL pattern, the\nresource is considered to be a JSP file\". This is clearly extremely bad behavior\nwhen using wildcard patterns.\nI am going to veto any attempt to fix these last two \"bugs\" (with bug 27664)\nuntil I am explained why the specification is not broken.I do not understand the badness of this behavior. If a resource is matched by a\njsp-property-group, it should be considered a JSP file. If a resource has the\nextension .jsp it should be considered a JSP file. What\'s the difference between\nthese two?\n\nIf you include directories with the resources that match a url-pattern, this\nexplains bug 27664: a directory is then served as a JSP file, which can not be\nfound, resulting in a 404.\n\nHowever, JSP3.3 states: \"A JSP property group is a collection of properties that\napply to a set of files that represent JSP pages.\" Directories are apparently\nnot included in this definition.\n\nSRV9.10 states: \"The purpose of this mechanism is to allow the deployer to\nspecify an ordered list of partial URIs for the container to use for appending\nto URIs when there is a request for a URI that corresponds to a directory entry\nin the WAR not mapped to a Web component.\" Requests for a directory should\nresult in an attempt to append welcome files to this directory.The problem is that this jsp-property-group feature is that it conflicts with\nservlet mapping rules, and forces the JSP implementation to be a mini servlet\ncontainer in itslef.Ok, I agree with the fact that this will probably make a mini servlet container\nof the JSP implementation and that this is undesired. But not fixing this also\nmeans that Tomcat is not fully compliant with the spec. This may become a\nproblem when products that Tomcat is integrated into attempt to become J2EE 1.4\ncompatible.\n\nYou\'ll probably be happy to know this is the last thing I will say about this issue.As I said, I contend that this was not what was intended by the spec authors.\nDue to the \"servlet mapping\"-like effect of jsp-property-group, and yet the need\nto have web server like features and a JSP container (I\'m sure in 5 minutes\nyou\'ll be complaining that directory listings do not work), you need special JSP\nspecific processing in your servlet container (and this processing is relatively\ncomplex).\nTo implement jsp-property-group properly, you probably would have to do some\nmapping hacks, and assign some requests to the JSP servlet (after regular\nmapping), which is relatively complex (jsp-property-group/url-mapping is not\ntrivial, and you have to do it during request dispatching as well), has a\nperformance cost (similar to filter mapping), and introduces obvious\ndependencies with JSP.\nThat violates the original design idea of the independence of the servlet and\nJSP specs.Reopening so that I can close it as FIXED.\n',?,SPEC
27752,'context fails if the path contains subdirectories','Tomcat 5',Webapps:Administration,I.Dunn,dev,'The context works OK until I try to \'commit changes\' on any setting in the GUI\nweb admin or reboot the server.\n\neg context path for the webapp is\n  /courseCode/startDate\n\nthe directory URL is \n  file:/public/htmldocs/courseCode/startDate\n\nIf I press save, commit changes then log out, when I log back in again admin\nreturns the following error:\n   type Status report\n\n   message Error retrieving attribute debug\n\n   description The server encountered an internal error (Error retrieving\n   attribute debug) that prevented it from fulfilling this request.\n\nManager then does not show that the context exists. Any requests to the page\nshow This application is not currently available\n\nIf I reboot the server the context has gone as well.\n\nIf I use a flat context (eg /courseCode_startDate) it works.\n\nThis was not a problem in previous versions.What does your localhost_admin.log say when you log back into admin and get\n\"message Error retrieving attribute debug\" error on your browser?  Exception\ntrace detail would be helpful to see what\'s going on.This should be fixed now.As I missed the message to post the log, \n     and just in case you\'re still interested ;-)\n\n(I\'ve left the server restart log - just in case the problem was earlier)\n- hope this matches what you\'ve just fixed :-)\n\n**** restart server ****\n\n2004-03-22 13:25:02 StandardContext[/admin]action: Entered\nTreeControlTestAction:perform()\n2004-03-22 13:25:02 StandardContext[/admin]action: Tree expand/contract on\nCatalina:type=Service,serviceName=Catalina\n2004-03-22 13:25:02 StandardContext[/admin]action: Found Node:\nCatalina:type=Service,serviceName=Catalina\n2004-03-22 13:25:04 StandardContext[/admin]action: Entered\nTreeControlTestAction:perform()\n2004-03-22 13:25:04 StandardContext[/admin]action: Tree expand/contract on\nCatalina:type=Host,host=localhost\n2004-03-22 13:25:04 StandardContext[/admin]action: Found Node:\nCatalina:type=Host,host=localhost\n2004-03-22 13:25:20 StandardContext[/admin]action: Entered\nTreeControlTestAction:perform()\n2004-03-22 13:25:20 StandardContext[/admin]action: tree param is null\n2004-03-22 13:25:20 StandardContext[/admin]action: Select event on\nCatalina:j2eeType=WebModule,name=//localhost/m877/E,J2EEApplication=none,J2EEServer=none\n2004-03-22 13:25:20 StandardContext[/admin]action: Error retrieving attribute debug\njavax.management.InstanceNotFoundException:\nCatalina:type=Manager,path=/m877/E,host=localhost\n\tat\ncom.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getMBean(DefaultMBeanServerInterceptor.java:1015)\n\tat\ncom.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getAttribute(DefaultMBeanServerInterceptor.java:634)\n\tat com.sun.jmx.mbeanserver.JmxMBeanServer.getAttribute(JmxMBeanServer.java:667)\n\tat\norg.apache.webapp.admin.context.EditContextAction.perform(EditContextAction.java:269)\n\tat org.apache.struts.action.Action.execute(Action.java:420)\n\tat\norg.apache.struts.action.RequestProcessor.processActionPerform(RequestProcessor.java:484)\n\tat org.apache.struts.action.RequestProcessor.process(RequestProcessor.java:274)\n\tat org.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)\n\tat org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:743)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:284)\nat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:567)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:206)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:833)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:732)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:619)\n\tat\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:688)\n\tat java.lang.Thread.run(Thread.java:536)\n\n\nthanks,\n   <Ivan.',?,BUG
27790,'Exception during shutdown of 5.0.19 on JDK 1.3.1','Tomcat 5',Connector:Coyote,chuck.caldarale,dev,'It appears that a dependency on JDK 1.4 may have crept into the latest Tomcat \nrelease build. With 5.0.16, I\'m able to shut down Tomcat successfully when it\'s \nrunning on either 1.3 or 1.4; with the 5.0.19 release, shutdown requests on 1.4 \noperate correctly, but fail with an exception on 1.3:\n\n[INFO] Http11Protocol - -http11protocol.pause\n[ERROR] Catalina - -Catalina.stop <LifecycleException:  Cannot find message \nassociated with key \ncoyoteConnector.protocolHandlerPauseFailed>LifecycleException:Cannot find \nmessage associated with key coyoteConnector.protocolHandlerPauseFailed\n        at org.apache.coyote.tomcat5.CoyoteConnector.pause\n(CoyoteConnector.java:1462)\n        at org.apache.catalina.core.StandardService.stop\n(StandardService.java:560)\n        at org.apache.catalina.core.StandardServer.stop\n(StandardServer.java:2379)\n        at org.apache.catalina.startup.Catalina.stop(Catalina.java:643)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:618)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:398)\n\nThe server then hangs, but can be terminated with platform-specific kills.\n\nThe above came from a Win2K box, but was first observed on a non-Windows \nplatform as well - our mainframe JVM, which is stuck on 1.3 for a while.\n\nThe real exception has unfortunately been masked by the LifecycleException, \nsince the pause() method caught the original one and threw the Lifecycle error.\n\nThis is 100\% reproducible in a JDK 1.3 environment.\n\nThanks for taking a look.Found a bit more information about the problem: the original exception that \ntriggered the error was java/util/MissingResourceException, with a detail \nmessage of \"Can\'t find resource for bundle java.util.PropertyResourceBundle, \nkey http11protocol.pause\". I don\'t have a walkback yet.\nTomcat 5 supports the new servlet & JSP specifications, which require JDK 1.4\n(although it might work to some extent with JDK 1.3).Tomcat is not a JSSE container, so there is no requirement in the spec as to \nwhich JVM versions are supported.Well, then go ahead and fix this. I certainly will not.I think I found the problem. One of the recent changes to Http11Protocol.java \nadded pause() and resume() methods which call log.info() to record the actions. \nHowever, the corresponding messages were not placed in LocalStrings.properties, \nso errors occur when attempting to fetch the text. Under JDK 1.4, using the \njava.util.logging.Logger class, a message is printed, and no exception is \nthrown for the missing text. However, under 1.3, using the commons SimpleLog \nclass, an exception is thrown, which kills the main thread, resulting in the \nhang.\n\nI\'ve added the following to the properties file:\n\nhttp11protocol.endpoint.pauseerror=Error pausing endpoint\nhttp11protocol.pause=Pausing Coyote HTTP/1.1 on port {0}\nhttp11protocol.endpoint.resumeerror=Error resuming endpoint\nhttp11protocol.resume=Resuming Coyote HTTP/1.1 on port {0}\n\nI suspect that there may be other missing message strings, since the \nLifeCycleException seems to be complaining about a similar problem. This may \nalso explain the recent spate of e-mails on the tomcat-user list about missing \nmessages in the 1.4 log.\nAs I remembered, Remy added two of the missing messages long ago, and just \nadded the other two (at least if you\'re not using localized messages :).',?,BUG
27830,'\'null\' string in output for JSP documents when EL variable not set','Tomcat 5',Jasper,mkmelin+apache,dev,'correct: When e.g. ${param.test} is not set, for jsp pages the attribute value\nis an empty string if printed to output.\n\nwrong: When using jspx (jsp document) the string \"null\" is in the output instead.\nIf the param.test is set but null, the empty string is printed in jspx also (as\nshould be). \n\nSo, when using normal jsp pages, an empthy string is outputted both in case the\n${param.test} is in the document text or as an attribute value of some element.\nI expect jsp documents to behave the same way.\n\n\nTestcase:\n\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<!-- \n  - JSPX Testcase.\n  -->\n<html xmlns=\"http://www.w3.org/1999/xhtml\"\n      xmlns:jsp=\"http://java.sun.com/JSP/Page\"\n      xmlns:c=\"http://java.sun.com/jsp/jstl/core\"> \n\n  <head>\n    <title>Test</title>\n  </head>\n\n  <body>\n    <p>\n    When param.test is not set, for jsp pages the attribute value is an empty \n    string if printed to output. <br />\n    When using jspx (jsp document) the string\"null\" is in the output instead.\n    If the param.test is set but null, the empty string is printed in jspx also.\n    \n    <br />\n\n    Observe the difference:<br />\n    Not printed: \\${param.test} = ${param.test} <br />\n\n    but displayed as \"null\" here:<br />\n\n    <input type=\"text\" value=\"${param.test}\" />  \n\n    </p>\n\n  </body>\n</html>Fixed in CVS.',?,BUG
27948,'NPE with null fragment','Tomcat 5',Jasper,David.Holscher,dev,'jsp:invoke throws an NPE when the fragment is null. The spec clearly states \nthat null fragments should result in empty output.\n\nJSP.5.12 <jsp:invoke>\n... If the fragment identified by the given name is null,\n<jsp:invoke> will behave as though a fragment was passed in that produces no\noutput.Fixed in CVS',?,BUG
27988,'Unhelpful FileNotFoundException raised','Tomcat 5',Catalina,richard.beton,dev,'org.apache.naming.resources.DirContextURLConnection raises FileNotFoundException\non lines 311, 344, 382 and 396.  It would be more helpful if these provided a\nmessage string.\n\nFor example, change line 344 to\n        throw new FileNotFoundException(getURL().getFile());\n\nThis would make it easier to diagnose mistakes in server configurations.Here\'s my stack trace that left me baffled at first:\n\njavax.servlet.ServletException: Exception processing JAR at resource path\n/WEB-INF/lib/log4j-1.2.8.jar\n\tat org.apache.catalina.startup.ContextConfig.tldScanJar(ContextConfig.java:930)\n\tat org.apache.catalina.startup.ContextConfig.tldScan(ContextConfig.java:868)\n\tat org.apache.catalina.startup.ContextConfig.start(ContextConfig.java:647)\n\tat org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:243)\n\tat\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)\n\tat org.apache.catalina.core.StandardContext.start(StandardContext.java:3582)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1188)\n\tat org.apache.catalina.core.StandardHost.start(StandardHost.java:754)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1188)\n\tat org.apache.catalina.core.StandardEngine.start(StandardEngine.java:363)\n\tat org.apache.catalina.core.StandardService.start(StandardService.java:497)\n\tat org.apache.catalina.core.StandardServer.start(StandardServer.java:2190)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:512)\n\tat org.apache.catalina.startup.Catalina.execute(Catalina.java:400)\n\tat org.apache.catalina.startup.Catalina.process(Catalina.java:180)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:203)\n----- Root Cause -----\njava.io.FileNotFoundException\n\tat\norg.apache.naming.resources.DirContextURLConnection.getInputStream(DirContextURLConnection.java:344)\n\tat sun.net.www.protocol.jar.URLJarFile.retrieve(URLJarFile.java:161)\n\tat sun.net.www.protocol.jar.URLJarFile.getJarFile(URLJarFile.java:42)\n\tat sun.net.www.protocol.jar.JarFileFactory.get(JarFileFactory.java:78)\n\tat sun.net.www.protocol.jar.JarURLConnection.connect(JarURLConnection.java:85)\n\tat sun.net.www.protocol.jar.JarURLConnection.getJarFile(JarURLConnection.java:69)\n\tat org.apache.catalina.startup.ContextConfig.tldScanJar(ContextConfig.java:906)\n\tat org.apache.catalina.startup.ContextConfig.tldScan(ContextConfig.java:868)\n\tat org.apache.catalina.startup.ContextConfig.start(ContextConfig.java:647)\n\tat org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:243)\n\tat\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)\n\tat org.apache.catalina.core.StandardContext.start(StandardContext.java:3582)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1188)\n\tat org.apache.catalina.core.StandardHost.start(StandardHost.java:754)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1188)\n\tat org.apache.catalina.core.StandardEngine.start(StandardEngine.java:363)\n\tat org.apache.catalina.core.StandardService.start(StandardService.java:497)\n\tat org.apache.catalina.core.StandardServer.start(StandardServer.java:2190)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:512)\n\tat org.apache.catalina.startup.Catalina.execute(Catalina.java:400)\n\tat org.apache.catalina.startup.Catalina.process(Catalina.java:180)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:203)\nThe TLD scanning was completely re-written for Tomcat 7 so the error messages there should be a lot better.\n\nI have added the URL (where it isn\'t null) to the Exception message so it is available for any other code paths that may trigger it. This change has been made to 7.0.x and will be included in 7.0.9 onwards.\n\nI have also proposed the same change for 6.0.x and 5.5.x.\n\nSince 5.5.x is the oldest currently supported version, I am moving this bug to that version.Fixed in 6.0.x and will be included in 6.0.33 onwards.Fixed in 5.5.x, will be included in 5.5.34 onwards.',?,IMPROVEMENT
28058,'JspRuntimeLibrary.getContextRelativePath() can throw StringIndexOutOfBoundsException','Tomcat 5',Jasper,pruchaba_bah,dev,'A program I am working on is throwing an exception \njava.lang.StringIndexOutOfBoundsException: String index out of range: -1\nfrom within\norg.apache.jasper.runtime.JspRuntimeLibrary.getContextRelativePath\n(JspRuntimeLibrary.java:963)\n\nAccording to the docs http://jakarta.apache.org/tomcat/tomcat-5.0-\ndoc/servletapi/javax/servlet/http/HttpServletRequest.html#getServletPath(), \ngetServletPath() can return an empty string which is what is happening in my \napp.  The line in question:\n\n    uri.substring(0, uri.lastIndexOf(\'/\')) + \'/\' + relativePath\n\nwhere uri is an empty string is what is causing this exception to be thrown.  \nAs you can see uri.lastIndexOf is going to return -1 and uri.substring(0, -1) \njust does not work.I was able to reproduce your problem w/ TC 5.0.19.\n\nI assume you have a chain of jsp:include, and have the following jsp-config\nelement in your web.xml:\n\n    <jsp-config>\n      <jsp-property-group>\n        <url-pattern>/*</url-pattern>\n      </jsp-property-group>\n    </jsp-config>\n\nIf so, this bug has already been fixed - it is a duplicate of Bugzilla 27704\n(\"Result of request.getServletPath() wrong in case JSP inside\njsp-property-group\").\n\nThe fix is in CVS, and will be available in TC 5.0.21.\n\nPlease confirm that your problem is being caused by the above jsp-config, and I\nwill go ahead and close this bug as a duplicate of Bugzilla 27704.Thats my problem.  Though it\'s not a chain of jsp includes.  I have a servlet \nthat forwards a request to a JSP using the \"jsp\" named dispatcher.  The JSP \nthen has an include in it.The servlet is at\n\n  <servlet-mapping>\n    <servlet-name>foo</servlet-name>\n    <url-pattern>/*</url-pattern>\n  </servlet-mapping>\nCreated attachment 11064\nTest CaseI have attached a test case.\n\n/test/jsp/test.jsp displays \"This is a test\"\n/test/jsp/include.jsp throws java.lang.StringIndexOutOfBoundsExceptionI was able to reproduce this bug using the servlet wildcard mapping.\n\nBugzilla 27704 fixes the problem where the including JSP was mapped to by\na \"/*\" jsp-config mapping (and getServletPath() used to be empty), but it does\nnot address the case where a servlet mapped to by \"/*\" is the entry point.\n\nKin-Man committed a fix earlier that fixes this problem.I think your test case has a problem unrelated to the\nStringIndexOutOfBoundsException issue it uncovered.\n\nNot only the initial request, but also the target of your <jsp:include> will be\nrouted through your \"test\" servlet (due to the \"/*\" mapping), which means you\nend up doing a request dispatcher forward (from your servlet) inside an include.\n\nAs a result of this, you\'ll see this warning in the logs:\n\n  WARNING: Internal error flushing the buffer in release(): java.io.IOException:\nStream closed\n\nwhen releasing the page context of the including JSP.\nYou are right.  I ended up stripping out the code to handle that because I \nnever got that far.  Here is the code:\n\nimport java.io.IOException;\n\nimport javax.servlet.RequestDispatcher;\nimport javax.servlet.ServletContext;\nimport javax.servlet.ServletException;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\n\n/**\n * Example servlet\n *\n */\n\npublic class Test extends HttpServlet {\n\n\tpublic void service(HttpServletRequest req, HttpServletResponse resp)\n\t\tthrows ServletException, IOException {\n\t\n\t\tServletContext sc = getServletContext();\n\t\tRequestDispatcher rd = sc.getNamedDispatcher(\"jsp\");\n\n\t\tObject attr = req.getAttribute\t\t\t\t\t\n\t            (\"javax.servlet.include.request_uri\");\n\t\t\n\t\tif (attr != null) {\n\t\t\trd.include(req, resp);\n\t\t\treq.setAttribute(\"javax.servlet.include.request_uri\", \n                            attr);\n\t\t} else {\n\t\t\ttry {\n\t\t\t\trd.forward(req, resp);\n\t\t\t} catch (IllegalStateException e) {\n\t\t\t\trd.include(req, resp);\n\t\t\t}\n\t\t}\n\t}\n}\n\n',?,BUG
28107,'Enhance Tomcat\'s Ant tasks for easy build.xml configuration','Tomcat 5',Unknown,mraible,dev,'Cactus has a pretty slick feature in that its tasks can be defined very simply in your build.xml file.  \nHere\'s an example:\n\n        <taskdef resource=\"cactus.tasks\"\n            classpathref=\"cactus.classpath\"/>\n\nThis is because there is a \"cactus.tasks\" text file in its JAR file that defines all the tasks.  I\'ve done \nsomething similar in my Tomcat Ant Tasks HowTo (http://raibledesigns.com/wiki/Wiki.jsp?\npage=TomcatAntTasks) - but it\'d be much cleaner (and easier) if there was a tomcat.tasks file in \ncatalina-ant.jar.  \n\nThis bug is to (hopefully) inspire to make Tomcat\'s Ant integration easier and simpler.I\'m not convinced by the usefulness of it. It is a little smaller in the user\'s\nbuild script, but there are still things to add.2 lines of XML vs. 15 is a big difference IMO. ;-)It\'s an improvement. Thanks.',?,BUILD_SYSTEM
28131,'DeltaManager lost session expiration code line','Tomcat 5',Catalina:Cluster,rainer.jung,dev,'In DeltaManager.java in method processExpired from CVS version 1.15 until now \nthe line\n\nsession.expire();\n\nis lost (line number 918 in CVS version 1.18 resp. line 961 in 1.14).\n\nThis leads to no session in the cluster ever expires. Please insert the line \nagain.The manager calls isValid() on the session, the isValid() in return expires \nthe session if the idle time has been too long.\n\nare you seeing the sessions never disappearing?\n\nfilipSorry, I just realized that isValid is supposed to expire the session. But in \nfact I can\'t see it expiring. I added some debug code to DeltaSession and will \nprovide additional information soon.\n\nSorry about the wrong first assumption about session.expire, but for me it \nlooks like there is an expiration problem.Sorry, I just realized that isValid is supposed to expire the session. But in \nfact I can\'t see it expiring. I added some debug code to DeltaSession and I can \nsee the following: Every time the session is checked for expiration the value \nof \"accessCount\" is 1. session.access increases it to 2 and session.Endaccess \ndecreases is to 1. So it looks like the default value of access after creation \nof a new session object should be 0 instead of 1? If this is true, the same may \napply to recycle.Also: session/StandardSession.java uses accessCount=0 in initialization of a \nnew session and in recycle.I verified, that session expiration works, if you use accessCount=0 in creation \nand recycling of sessions in DeltaSession.java. Please correct.This has been fixed! Thanks Rainer for the detailed explanation*** Bug 28156 has been marked as a duplicate of this bug. ***',?,BUG
28147,'JasperException for jsp files that are symbolic links','Tomcat 5',Jasper,rickkw,dev,'Hi,\n\nI got the following exception when one of my JSP file in my webapp is actually a\nsymlink to a file in another directory location.  I verified that the symlink is\nvalid.  The file in question is chError.jsp.  Package name is\ncom.loudcloud.owm.shared.  Note that Jasper created extra directories\n(/soft/lco/occ/channels/shared/rsrc) for chError.jsp.\n\ngenerate\ngenerate/jsp\ngenerate/jsp/jsp.web.xml\ngenerate/jsp/com\ngenerate/jsp/com/loudcloud\ngenerate/jsp/com/loudcloud/owm\ngenerate/jsp/com/loudcloud/owm/shared\ngenerate/jsp/com/loudcloud/owm/shared/error_jsp.java\ngenerate/jsp/com/loudcloud/owm/shared/logout_jsp.java\ngenerate/jsp/com/loudcloud/owm/shared/soft\ngenerate/jsp/com/loudcloud/owm/shared/soft/lco\ngenerate/jsp/com/loudcloud/owm/shared/soft/lco/occ\ngenerate/jsp/com/loudcloud/owm/shared/soft/lco/occ/channels\ngenerate/jsp/com/loudcloud/owm/shared/soft/lco/occ/channels/shared\ngenerate/jsp/com/loudcloud/owm/shared/soft/lco/occ/channels/shared/rsrc\ngenerate/jsp/com/loudcloud/owm/shared/soft/lco/occ/channels/shared/rsrc/chError_jsp.java\n\n\n-----------------------------------------\n\n  [jasper2] (jasper.JspC                         762 ) ERROR-the file\n\'/soft/lco/occ/channels/shared/rsrc/chError.jsp\' generated the following general\nexception:\n  [jasper2] org.apache.jasper.JasperException: File\n\"/soft/lco/occ/channels/shared/rsrc/chError.jsp\" not found\n  [jasper2]     at\norg.apache.jasper.compiler.DefaultErrorHandler.jspError(DefaultErrorHandler.java:94)\n  [jasper2]     at\norg.apache.jasper.compiler.ErrorDispatcher.dispatch(ErrorDispatcher.java:404)\n  [jasper2]     at\norg.apache.jasper.compiler.ErrorDispatcher.jspError(ErrorDispatcher.java:154)\n  [jasper2]     at\norg.apache.jasper.compiler.JspUtil.getInputStream(JspUtil.java:882)\n  [jasper2]     at\norg.apache.jasper.xmlparser.XercesEncodingDetector.getEncodingMethod(XercesEncodingDetector.java:160)\n  [jasper2]     at\norg.apache.jasper.xmlparser.XMLEncodingDetector.getEncoding(XMLEncodingDetector.java:98)\n  [jasper2]     at\norg.apache.jasper.compiler.ParserController.determineSyntaxAndEncoding(ParserController.java:351)\n  [jasper2]     at\norg.apache.jasper.compiler.ParserController.doParse(ParserController.java:208)\n  [jasper2]     at\norg.apache.jasper.compiler.ParserController.parse(ParserController.java:139)\n  [jasper2]     at\norg.apache.jasper.compiler.Compiler.generateJava(Compiler.java:237)\n  [jasper2]     at org.apache.jasper.compiler.Compiler.compile(Compiler.java:456)\n  [jasper2]     at org.apache.jasper.JspC.processFile(JspC.java:747)\n  [jasper2]     at org.apache.jasper.JspC.execute(JspC.java:882)\n  [jasper2]     at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  [jasper2]     at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n  [jasper2]     at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n  [jasper2]     at java.lang.reflect.Method.invoke(Method.java:324)\n  [jasper2]     at org.apache.tools.ant.TaskAdapter.execute(TaskAdapter.java:124)\n  [jasper2]     at\norg.apache.tools.ant.UnknownElement.execute(UnknownElement.java:269)\n  [jasper2]     at org.apache.tools.ant.Task.perform(Task.java:364)\n  [jasper2]     at org.apache.tools.ant.Target.execute(Target.java:301)\n  [jasper2]     at org.apache.tools.ant.Target.performTasks(Target.java:328)\n  [jasper2]     at org.apache.tools.ant.Project.executeTarget(Project.java:1215)\n  [jasper2]     at org.apache.tools.ant.Project.executeTargets(Project.java:1063)\n  [jasper2]     at org.apache.tools.ant.Main.runBuild(Main.java:632)\n  [jasper2]     at org.apache.tools.ant.Main.startAnt(Main.java:183)\n  [jasper2]     at org.apache.tools.ant.launch.Launcher.run(Launcher.java:197)\n  [jasper2]     at org.apache.tools.ant.launch.Launcher.main(Launcher.java:56)I do not understand the issue. If linking to resources outside of the webapp\nroot, use allowLinking. If it still does not work, I think this is not going to\nbe fixed.No, no, no.\n\nThere resource, chError.jsp is local.  Except that when compiling this project,\nthis file is physically located in a different location, and referenced by a\nsymlink.\n\nfor example:\n\n> ls -l \nindex.jsp\nchError.jsp --> ../common_files/chError.jsp\n\nFor some reasons, Jasper treats a symbolic link file differently then a regular\nfile.  I have a good number of applications and all of them contain chError.jsp.\n I do not want to make copies of this file so I use symbolic link in each\napplication to link chError.jsp to a common location.  Jasper seems to have\ntrouble with that.   Once again, this is meant to be a local resource, not\nsomething outside of the application.\n\nI also don\'t know what you were referring to when you mentioned \"allowLinking\".\n I am using JspC with Jasper2.  I don\'t see such an option documented.\n\nThanks,This will not be fixed. If you care, please submit a fix.Hi Remy,\n\nI have tested a fix locally, and it takes just a minor change in JspC.execute()\nby replacing\n\n    String s = fjsp.getCanonicalPath();\n\nwith\n\n    String s = fjsp.getAbsolutePath();\n\nIt seems pretty harmless.  I don\'t have cvs submission permission yet, and I am\nin the process of figuring it out.  If you would be so kind, could you\nincorporate the fix in?\n\nThanks,\n--\nRick\n\nHi, \nPlease consider patching this.  \nThanks,\nRick\n--\n\n\nIndex: JspC.java\n===================================================================\nRCS file:\n/home/cvspublic/jakarta-tomcat-jasper/jasper2/src/share/org/apache/jasper/JspC.java,v\nretrieving revision 1.69\ndiff -u -r1.69 JspC.java\n--- JspC.java\t6 Apr 2004 17:58:59 -0000\t1.69\n+++ JspC.java\t8 Apr 2004 20:39:59 -0000\n@@ -830,7 +830,7 @@\n             Enumeration e = pages.elements();\n             while (e.hasMoreElements()) {\n                 String nextjsp = e.nextElement().toString();\n-                try {\n+                // try {\n                     File fjsp = new File(nextjsp);\n                     if (!fjsp.exists()) {\n                         if (log.isWarnEnabled()) {\n@@ -839,14 +839,21 @@\n                         }\n                         continue;\n                     }\n-                    String s = fjsp.getCanonicalPath();\n+                    // BZ#28147 getCanonicalPath() dereferences symbolic links.\n If the file\n+                    //          is a symbolic link to a file in a different\ndirectory, \n+                    //          getCanonicalPath() will cause the following\ns.startWith()\n+                    //          to fail to match the uriRoot, resulting in\nfile-not-found\n+                    //          error.  Changing to getAbsolutePath() will\nallow files that\n+                    //          are symbolic links to be found correctly.\n+                    // String s = fjsp.getCanonicalPath();\n+                    String s = fjsp.getAbsolutePath();\n                     //System.out.println(\"**\" + s);\n                     if (s.startsWith(uriRoot)) {\n                         nextjsp = s.substring(uriRoot.length());\n                     }\n-                } catch (IOException ioe) {\n+                // } catch (IOException ioe) {\n                     // if we got problems dont change the file name\n-                }\n+                // }\n \n                 if (nextjsp.startsWith(\".\" + File.separatorChar)) {\n                     nextjsp = nextjsp.substring(2);\nIf this is the only place where a change is needed, then it seems ok.',?,BUG
28156,'Session Expiration in Cluster broken after stopping one node','Tomcat 5',Catalina:Cluster,rainer.jung,dev,'After stopping one cluster node, expiration of the sessions replicated from \nthis node to the other nodes is broken. This is due to a bug in \nDeltaManager.java. In line 882 there is a call to session.access(), which \nincreases accessCount by 1. Since there is no call to session.endAccess, this \nsession will never expire.\n\nThe same seems to be true in line 870. If it is necessary to update timestamps \nwith session.access, you should also call session.setAccessCount(0) directly \nafter. In line 870 this might be appropriate, in line 882 there is dreq.execute \ndirectly before and dreq.execute already calls session.access and \nsession.endAccess, so I think one could drop line 882.\n\nThe Bug was first introduced in Version 1.8 of DeltaManager (TC 5.0.18).\n\nSince there was already another bug relating to accessCount>0 it seems to be a \ngood idea to check other uses of accessCount or session.access() as well.\n\nThanks for correcting.\n\n*** This bug has been marked as a duplicate of 28131 ***It is not a duplicate of 28131, which was also found by me.\n\n28131 prevented any expiration in a cluster. This bug here only applies if one \ncluster node is shutdown. Then the replicated sessions will no longer expire.\n\n28131 is resolved in DeltaSession.java, this bug here must be resolved in \nDeltaManager.java. Please leave open for comment by Filip Hanik.\n\nThanks.Thanks for the info, I haven\'t had time to play around with all this since we \njust moved from California to Texas. Thanks for your help!!',?,BUG
28161,'Replication messages get lost with AsyncSocketSender','Tomcat 5',Catalina:Cluster,rainer.jung,dev,'Using AsyncSocketSender we see, that under heavy load some session get not \nreplicated.\n\nWe added a lot of debug output statements, so we can see, that in \nAsyncSocketSender Method sendMessage(data) is reached and we finally end at the \nline, where the data is written to the socket.\n\nUnfortunately on the remote side we miss the incoming messages corresponding to \nthe missing session, although most sessions are replicated and we can see \naccordingly debugging output.\n\nWe use a 2 node Cluster using apache/mod_jk with load balancing/routing to both \ncluster nodes. We create app. 1500 sessions in a few seconds. Nearly 5\% of the \nsessions are missing. Some of the sessions of node 1 are missing on node 2, but \nalso some of the sessions from node 2 are missing on node 1. We couldn\'t \nobserve the problems under low load.\n\nCluster-Config: useDirtyFlag=true, mcastFrequency=500, mcastDropTime=3000, \ntcpSelectorTimeout=1000, tcpThreadCount=2, TC 5.0.21, OS is Solaris 9, JVM is \n1.4.2_03.\n\nAny help is highly appreciated, we are able to produce debugging output. Please \ngive hints.Async data send means that there is not time guarantee for when the session is \ndelivered. The session should not get lost without any error trace in the logs.\nI am still debating whether to remove this feature all together, but I left it \nin for people to play with. I have not found a case where async is useful, but \nI am sure there is which is why it is still there. Most of the time people \nwant to be ensured that the session gets replicated, that is when pooled mode \ncomes in.\n\nalso, from experience, using mod_jk in high load can result in \"lost\" \nsessions, cause it sometimes messes up the request and looses the session id.\nfrom my experience, pen (siag.nu/pen) works better as a load balancer\n\nI strongly suggest to retry the same test with replicationMode=\"pooled\" and \nsee if you get better results. \nPooled means that replication is synchronous, but on concurrent channels.\n\nFilipI respect your sugestion to not use asynchronous, although it looked to me like\nthe right way to do it.\n\nJust for your information: The messages really get lost, even after we stop load\nthe missing messages don\'t get replicated. So it\'s not just a problem of\nmessages getting replicated too late.\n\nThere are definitely only debug log stetments all the time, except for a few\ninfo messages giving mean values for replication data size. No other non debug\nlog statements on any cluster node. Also from what I see I\'m pretty sure, that\nthe replication data is written to the Socket.\n\nConcerning mod_jk: For this test case we used each session only once. So the\ncorrectness of the response through mod_jk somehow didn\'t matter. We could\neasily reproduce the same situation using build in Tomcat HTTP Connector\n(although we didn\'t do so until now).\n\nWe will retry using pooled, although I don\'t like the idea of having up to 25\nconnections (code constant) and threads for each pair of nodes in the cluster.\nAlso I had the impression, that in pooled mode TCP conections are only used a\nvery short time (I think I remember for only 100 messages? This application will\nbe under heavy load in production). \n\nWhy do I think asynchronous fits better?\n\nIn any synchronous situation if the replication is not fast enough I immediately\nget negative consequences for the application from the user point of view,\nbecause the request blocks ressources needed for accepting new requests as long\nas the replication hasn\'t finished. So if replication is slow for a few seconds\nI\'m in danger of loosing all free Apache-Slots resp. Tomcat worker threads for\nincoming requests.\n\nWhen I do asynchronous replication I only loose timely replication of the sesion\nchanges. If I route my request to the primary container, then I still profit\nfrom the cluster with respect to availability and servicability (I can shutdown\none of the containers without users loosing sessions). For these features it\ndoesn\'t really matter, if all request are replicated within milliseconds all the\ntime.\n\nI\'m sorry to bother you, but I think it\'s an important discussion.>We will retry using pooled, although I don\'t like the idea of having up to 25\n\nthis is not really a big resource issue, since no threads are holding on to \nthese connections, they just grab one from the queue when it is available, \nthen return it.\n\nlets reopen this bug re:/ async, once I get all moved in and have my computers \nset up I can start testing this again\n\nFilipalso, the problem with Async, is that it is using only one channel, hence \nduring heavy load, you will not get milli seconds throughput, cause it queues \nall the messages\n\nthe solution would be to make an async pooled mode,Maybe interesting: a simple \"Hello World\" JSP does NOT trigger the problem. But \nonce I add a scriptlet <\%session.setAttribute(\"COUNT\",new Integer(10));\%>\nthe problem arises.\n\nI can now reproduce without any apache or mod_jk involvement. I just start a 2 \nnode cluster and call the JSP via direct HTTP connections to node #1 200 times \nwith a delay between calls of 100ms.\n\nAfter calling 200 times, I can find 200 sessions on node #1, but only between \n170 and 195 sessions on node 2. I check session count via /manager/html, but I \nalso added debug output to see, that some sessions are indeed missing.\n\nI try to go deeper into cluster messages and the queue handling.Next info: If I use this JSP, then synchronous and pooled are both EXTREMELY \nslow, response times between 1000ms and 5000ms. As soon as I reduce \ntcpSelectorTimeout from 1000 to 10, I get more reasonable response times (10-\n50ms). Any idea, why tcpSelectorTimeout show such a tremendous effect?\n\nThen when I use multiple parallel clients, synchronous again gets too slow, so \nonly pooled is an alternative. Synchronous once showed a freeze (getting no \nmore anserws) for 15 seconds.\n\nBoth, synchronous and pooled do not show the problem of missing sessions.\n\nNevertheless I like the idea of having one or few dedicated replication \nconnections fed by a queue of work load and not directly coupled to the \nfinishing of the original response (asynchronous) much more.\nFirst: there are app. 6 System.out.print/ln in the cluster code. One of these \n(line 71 in the SmartQueue.java) prevented me from finding the solution earlier.\n\nHere is the SOLUTION: What happens is, that the \"smart\" feature of the smart \nqueue gets us into trouble. For my JSP two session messages are being send. One \nis of type 1 (EVT_SESSION_CREATED), and the second one is of type 13 \n(EVT_SESSION_DELTA). Both are being send very close to each other during the \nonly request in a session.\n\nMost of the time the system is fast enough to handle each message individually, \nbefore the next message is put into the queue. Every now and then the message \nof type 1 is not read from the queue before type 13 is generated. Then the \nqueue replaces the type 1 message in the queue by the type 13 message, and only \nthe type 13 message is send out. Then the receiving side seems to not create \nthe session, since the type 1 message is missing. I didn\'t check this last \npoint, because I think this is much clearer for you.\n\nIsn\'t there a general problem in using the Delta manager together with the \nsmart queue? Since you only send out delta messages, it doesn\'t look like a \ngood idea to replace pending messages with newer ones. In fact isn\'t it \nnecessary to send all deltas and to furthermore make sure, that they are send \nin the original order?\n\nAt least this makes clear, why the problem will only show up in asynchronous \nmode. In synchronous mode you will allways send all messages (and in the right \norder).\n\nMaybe it suffices to strip off the \"smart\" feature of the smart queue?The Deltamanager now uses a different Id to assign to its messages, that will \nmake them unique. This all the messages will get through.\n\nHowever, the async could be pooled in the same way the the synchronous is in \npooled mode, would increase performance alot :)',?,BUG
28178,'SSL Mutual Authentication Does Not Work with UserDatabaseRealm','Tomcat 5',Catalina,kevinj,dev,'Enable CLIENT-CERT.\nSet tomcat-users.xml to look like this:\n  <user username=\"CN=Kevin Jones, OU=DMUK, O=DevelopMentor, \nL=Cheltenham, ST=Glos, C=GB, \nEMAILADDRESS=kevinj@develop.com\" password=\"null\" roles=\"Kevin\"/>\nEnable UserDatabaseRealm (which is now the default realm) \n\nthe following exception occurs.\n\nSEVERE: Exception creating UserDatabase MBeans for UserDatabase\njavax.management.MalformedObjectNameException: Invalid character \'=\' in value\npart of property\n        at javax.management.ObjectName.construct(ObjectName.java:563)\n        at javax.management.ObjectName.<init>(ObjectName.java:1300)\n        at\norg.apache.catalina.mbeans.MBeanUtils.createObjectName(MBeanUtils.java:1520)\n        at org.apache.catalina.mbeans.MBeanUtils.createMBean(MBeanUtils.java:783)\n        at\norg.apache.catalina.mbeans.GlobalResourcesLifecycleListener.createMBeans(GlobalResourcesLifecycleListener.jav\na:280)\n        at\norg.apache.catalina.mbeans.GlobalResourcesLifecycleListener.createMBeans(GlobalResourcesLifecycleListener.jav\na:210)\n        at\norg.apache.catalina.mbeans.GlobalResourcesLifecycleListener.createMBeans(GlobalResourcesLifecycleListener.jav\na:172)\n        at\norg.apache.catalina.mbeans.GlobalResourcesLifecycleListener.lifecycleEvent(GlobalResourcesLifecycleListener.j\nava:144)\n        at\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:166)\n        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2338)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:594)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:398)\n\nNot sure if this is a problem in the MX beans handling of the = signs in the DN\nname used for the user.\n\nAssigned to Mark Thomas after an email exchangeCorrecting the component.\nThe \'=\' in the DN is the problem.Mark, what\'s the status of this?Sorry, slipped of my todo list. I\'ll look at this next week.\nI have now reminded myself what the problem was. The UserDataBaseRealm uses \nthe principal name when constructing the oname. With certificates this \nincludes several \'=\' characters. The JMX 1.1 does not allow these characters \nto be used in key properties. However, JMX 1.2 now includes support for \nquoting properties which would over come this. (BTW MX4J 2.x implements JMX \n1.2 and is currently at release 2.0.1)\n\nAs I see it, the options are:\n1. Do nothing for now. Upgrade to JMX 1.2 at some point in the future and come \nback to this issue then.\n2. Upgrade to JMX 1.2 now, and quote values (need to look into whether to \nquote all, some, etc)\n3. Continue with JMX 1.1 and introduce some form of arbitary character \nreplacement for certificates.\n\nIn the spirit of avoiding nugatory work - thoughts anyone?\n\nMy vote is for option 2.My vote is also for option 2, especially with Tomcat 5.1 coming up soon.  \nNugatory is a great word, I had to look it up and now I\'ll go use it in a \nconversation ;)This has been fixed in CVS. There might be some side-effects in the Admin app \nbut this code is in a state of flux at present. Once the Admin app stabalises, \nI will double-check the user database forms.',?,BUG
28234,'uri: worker property does not exist any more','Tomcat 5',Webapps:Documentation,odi,dev,'The documentation still lists the \'worker\' property in the examples. I guess\nthis should be replaced by \'group\'.\n\nPlus:\nWhy does the URL read tomcat-4.1 BTW if I browse the 5.0 documentation? Very\nconfusing.\nMore comprehensive examples of how to use the context property would be nice.\nAll in all documentation seems too fuzzy to me. It would definitely nice to have\ngood documentation on all the parameters of the JK2 configuration.\n\nCheers\n\nOrtwin GlückOn what page does \"the URL read tomcat-4.1 BTW if I browse the 5.0 \ndocumentation\" ?\n\nPlease submit clarified and/or enhanced text for those documentation areas you \nfeel are lacking.Go to: http://jakarta.apache.org/tomcat/index.html\nSelect \'Tomcat 5.0\' under \'Documentation\'\nSelect \'JK Documentation\' under \'Reference\'\n\nAll other links in the menu point to 5.0 documentation. But the JK Docs are 4.1I see what you mean.  The 4.1 location is the only one where we maintain the JK \ndocumentation.  How do you suggest we clarify this?Then just make the URLs look like 5.0. Either by deploying it twice or making a\nsymlink.OK, here\'s what I did:\n- Moved connector documentation to http://jakarta.apache.org/tomcat/connectors-\ndoc/jk2\n- Symlinked tomcat/tomcat-4.1-doc/jk2 to connectors-doc/jk2 so old links and \nbookmarks still work.\n- Modified project.xml and index.xml for tomcat 5 so that future releases use \nconnectors-doc and not the tomcat-4.1-doc URL when browsing the connector \ndocumentation.',?,DOCUMENTATION
28236,'org.apache.jasper.runtime.BodyContentImpl buffer is too small','Tomcat 5',Jasper,levadura,dev,'Well actually in reAllocBuff() method the policy is to incriment it by a \nconstant (512 bytes). In my case with a BIG <select> tag 99\% of CPU is \nused just to increment the buffer. \n\nThe suggestion is to use\n\n***************\nlen = Math.max(Constants.DEFAULT_TAG_BUFFER_SIZE, cb.length);\n***************\ninstead of\n***************\n        if (len < Constants.DEFAULT_TAG_BUFFER_SIZE) {\n            len = Constants.DEFAULT_TAG_BUFFER_SIZE;\n        }\n***************\n\nIn my case (I\'m using JSF RI 1.0) the change is from ~26 min to 2 sec.\n\nSincerely,\n\nunknownAnyway, why don\'t you suggest len = 2 * cb.length ?well actually changes above has a bug if:\n\nMath.max(Constants.DEFAULT_TAG_BUFFER_SIZE, cb.length) < len\n\nI just  pointed the problem, but I\'m not sure about the strategy to use in \nbuffer increment...',?,IMPROVEMENT
28244,'XML Comment between jsp:attribute cause attribute after comment was ignored','Tomcat 5',Jasper,eric_suen_cn,dev,'The jspx code:\n\n<?xml version=\"1.0\" ?>\n<fo:root xmlns:jsp=\"http://java.sun.com/JSP/Page\" \nxmlns:fo=\"http://www.w3.org/1999/XSL/Format\">\n <fo:block id=\"test\" font-weight=\"bold\" color=\"blue\" font-size=\"12pt\">\n  <jsp:element name=\"fo:inline\">\n   <jsp:attribute name=\"font-size\">9pt</jsp:attribute>\n   <!-- -->\n   <jsp:attribute name=\"color\">red</jsp:attribute>\n   <jsp:attribute name=\"font-weight\">bold</jsp:attribute>\n   <jsp:body>Hello World</jsp:body>\n  </jsp:element>\n </fo:block>\n</fo:root>\n\nthe output of resion 3.0.7 is:\n<fo:inline font-size=\"9pt\" color=\"red\" font-weight=\"bold\">Hello \nWorld</fo:inline>\n\nand the tomcat 5.0.19 is:\n<fo:inline font-size=\"9pt\">Hello World</fo:inline>\n\nRegardsThe spec (page 1.124) does not seems to allow for comments in between\njsp:attribute\'s.  However, this can be a spec oversight.\n\nFixed in CVS.',?,SPEC
28259,'Synchronous cluster very slow - select() bug','Tomcat 5',Catalina:Cluster,rainer.jung,dev,'In a TC cluster with synchronous replication there is a bug in using select() \nand registering operations on selectors.\n\nIf I use a high tcpSelectorTimeout (e.g. 1000ms) I can observe the secondary \nnode waiting in the midlle of a request until the timeout occurs, although \nreplication data is available. As a consequence requests take 1 second to work \non, although only the TC instances need only 20ms to process the request.\nNearly 1 second is spend waiting for select() to return in the middle of \nprocessing the request.\n\nI assume this is a bug in the logic handling the registration of operations on \nthe selector?\n\nIt is not a problem of high load, one can observe using single requests,\nbut it is necessary to use session atributes in the request.\n\nI expect the same problem to occur in pooled mode. The problem does not \nincrease response times in asynchronous mode, but I expect, that it will\nincrease replication time.\n\nHere is a protocol of what is happening. Most of these log lines are non \nstandard, I added them to the code, to find out the flow of control in this \nsituation. The intersting thing happens between step 5 and 6.\n\n1) Node 1: Request coming in at 12:39:32,563 :\n\n2004-04-07 12:39:32,563 (http-21080-Processor25)\norg.apache.catalina.core.StandardWrapper/DEBUG:   Returning non-STM instance\n2004-04-07 12:39:32,564 (http-21080-Processor25)\norg.apache.jasper.servlet.JspServlet/DEBUG: JspEngine --> /repit.jsp\n2004-04-07 12:39:32,564 (http-21080-Processor25)\norg.apache.jasper.servlet.JspServlet/DEBUG:         ServletPath: /repit.jsp\n2004-04-07 12:39:32,564 (http-21080-Processor25)\norg.apache.jasper.servlet.JspServlet/DEBUG:            PathInfo: null\n2004-04-07 12:39:32,564 (http-21080-Processor25)\norg.apache.jasper.servlet.JspServlet/DEBUG:            RealPath:\n/opt/iob3_tomcat_a/webapps/ROOT/repit.jsp\n2004-04-07 12:39:32,564 (http-21080-Processor25)\norg.apache.jasper.servlet.JspServlet/DEBUG:          RequestURI: /repit.jsp\n2004-04-07 12:39:32,564 (http-21080-Processor25)\norg.apache.jasper.servlet.JspServlet/DEBUG:         QueryString: null\n2004-04-07 12:39:32,564 (http-21080-Processor25)\norg.apache.jasper.servlet.JspServlet/DEBUG:      Request Params:\n\n2) Node 1: New session message EVT_SESSION_CREATED is being send at \n12:39:32,567:\n\n2004-04-07 12:39:32,566 (http-21080-Processor25)\norg.apache.catalina.cluster.session.DeltaManager/DEBUG: Sending \nEVT_SESSION_CREATED:\nSending creation of Session with  id=CD25AAD154CC01843779EA36B143D101.mkbtomcat1\nisValid=true isNew=true accessCount=0 maxInactiveInterval=900 \nisPrimarySession=true\ncreationTime=1081334372565 lastAccessedTime=1081334372565\nlastTimeReplicated=1081334372565\n2004-04-07 12:39:32,566 (http-21080-Processor25)\norg.apache.catalina.cluster.tcp.SimpleTcpCluster/DEBUG: Starting\nCatalinaCluster.send for msg 1 session \nCD25AAD154CC01843779EA36B143D101.mkbtomcat1\nand destination null\n\n3) Node 2: Message is being received at 12:39:32,568, sending ack at \n12:39:32,573:\n\n2004-04-07 12:39:32,568 (ClusterReceiver)\norg.apache.catalina.cluster.tcp.ReplicationListener/DEBUG: ReplicationListener\nlisten in while doListen after select returned n=1\n2004-04-07 12:39:32,568 (ClusterReceiver)\norg.apache.catalina.cluster.tcp.ReplicationListener/DEBUG: ReplicationListener \nwoke\nup in listen\n2004-04-07 12:39:32,568 (ClusterReceiver)\norg.apache.catalina.cluster.tcp.ReplicationListener/DEBUG: ReplicationListener\ncalling serviceChannel from readDataFromSocket in TcpReplicationThread\n2004-04-07 12:39:32,568 (ClusterReceiver)\norg.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread\ncalling notify in serviceChannel\n2004-04-07 12:39:32,568 (ClusterReceiver)\norg.apache.catalina.cluster.tcp.ReplicationListener/DEBUG: ReplicationListener\nlisten in while doListen before select with tcpSelectorTimeout=1000\n2004-04-07 12:39:32,569 (p.TcpReplicationThread[2])\norg.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread\nwoke up with key sun.nio.ch.SelectionKeyImpl@b3f9b8\n2004-04-07 12:39:32,569 (p.TcpReplicationThread[2])\norg.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread\nwoke up and calling drainChannel for key sun.nio.ch.SelectionKeyImpl@b3f9b8\n2004-04-07 12:39:32,569 (p.TcpReplicationThread[2])\norg.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread\nStarting drainChannel for key sun.nio.ch.SelectionKeyImpl@b3f9b8\n2004-04-07 12:39:32,569 (p.TcpReplicationThread[2])\norg.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread\ndrainChannel inner loop has count 401 and pkgcnt 1\n2004-04-07 12:39:32,571 (p.TcpReplicationThread[2])\norg.apache.catalina.cluster.session.DeltaManager/DEBUG: Manager () Received\nSessionMessage of type=SESSION-MODIFIED from\norg.apache.catalina.cluster.mcast.McastMember\n[tcp://10.254.65.100:5002,10.254.65.100,5002,\nalive=230840]\n2004-04-07 12:39:32,572 (p.TcpReplicationThread[2])\norg.apache.catalina.cluster.session.DeltaManager/DEBUG: Created a DeltaSession \nwith\nId[A981679B5BD40B418ED57F874DF8E1ED.mkbtomcat2] Total count=5\n2004-04-07 12:39:32,573 (p.TcpReplicationThread[2])\norg.apache.catalina.cluster.session.DeltaManager/DEBUG: Receiving\nEVT_SESSION_CREATED: Overwriting new Session with \nid=CD25AAD154CC01843779EA36B143D101.mkbtomcat1 isValid=true isNew=false\naccessCount=0 maxInactiveInterval=900 isPrimarySession=false\ncreationTime=1081334372572 lastAccessedTime=1081334372572\nlastTimeReplicated=1081334372571\n2004-04-07 12:39:32,573 (p.TcpReplicationThread[2])\norg.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread\ndrainChannel has pkgcnt 1\n2004-04-07 12:39:32,573 (p.TcpReplicationThread[2])\norg.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread\ndrainChannel sending ack for pkgcnt 1\n\nImportant: ClusterReceiver calls select() again at 12:39:32,568. This is the \nplace\nwhere now all the time goes by.\n\n4) Node 1: Received ack and proceeds with session.access() at 12:39:32,573. Ends\nsession.access() at 12:39:32,574:\n\n2004-04-07 12:39:32,573 (http-21080-Processor25)\norg.apache.catalina.cluster.session.DeltaManager/DEBUG: Created a DeltaSession \nwith\nId[CD25AAD154CC01843779EA36B143D101.mkbtomcat1] Total count=5\n2004-04-07 12:39:32,574 (http-21080-Processor25)\norg.apache.catalina.cluster.session.DeltaManager/INFO : End of session.access in\nid=CD25AAD154CC01843779EA36B143D101.mkbtomcat1 isNew=false\nlastAccessedTime=1081334372565 thisAccessedTime=1081334372574 accessCount=1\n\n5) Node 1: Proceeds working on request until Delta message of type \nEVT_SESSION_DELTA\n is being sent at 12:39:32,578:\n\n2004-04-07 12:39:32,576 (http-21080-Processor25)\norg.apache.catalina.cluster.tcp.ReplicationValve/DEBUG: Invoking replication \nrequest\non /repit.jsp\n2004-04-07 12:39:32,577 (http-21080-Processor25)\norg.apache.catalina.cluster.session.DeltaManager/DEBUG: DeltaManager request\nCompleted sending EVT_SESSION_DELTA  \nid=CD25AAD154CC01843779EA36B143D101.mkbtomcat1\nisValid=true isNew=false accessCount=1 maxInactiveInterval=900 \nisPrimarySession=true\ncreationTime=1081334372565 lastAccessedTime=1081334372565\nlastTimeReplicated=1081334372565\n2004-04-07 12:39:32,577 (http-21080-Processor25)\norg.apache.catalina.cluster.session.DeltaManager/DEBUG: DeltaManager request\nCompleted returns with msg non null\n2004-04-07 12:39:32,577 (http-21080-Processor25)\norg.apache.catalina.cluster.tcp.SimpleTcpCluster/DEBUG: Starting\nCatalinaCluster.send for msg 13 session \nCD25AAD154CC01843779EA36B143D101.mkbtomcat1\nand destination null\n2004-04-07 12:39:32,577 (http-21080-Processor25)\norg.apache.catalina.cluster.tcp.SimpleTcpCluster/DEBUG: Setting msgID in\nCatalinaCluster.send for msg 13 session \nCD25AAD154CC01843779EA36B143D101.mkbtomcat1\nand destination null to ABC9CBA\n2004-04-07 12:39:32,578 (http-21080-Processor25)\norg.apache.catalina.cluster.tcp.SimpleTcpCluster/DEBUG: Calling\nclusterSender.sendMessage for msg 13 session\nCD25AAD154CC01843779EA36B143D101.mkbtomcat1 ID ABC9CBA and destination NULL\n\n6) Now there is no activity for 993 milliseconds - which is the problem - until \n1003\nmilliseconds after the last call to select() in ClusterReceiver on node 2, \nalthough\nthere is one message of type EVT_SESSION_DELTA  waiting to be read. Finally the\nselect returns at 12:39:33,571 but with n=0 and another immediate call to select\n()\nreturns instantaneously with n=1. From here on everything proceeds normal, the\nmessage is being read and ack is sent at 12:39:33,577:\n\n2004-04-07 12:39:33,571 (ClusterReceiver)\norg.apache.catalina.cluster.tcp.ReplicationListener/DEBUG: ReplicationListener\nlisten in while doListen after select returned n=0\n2004-04-07 12:39:33,571 (ClusterReceiver)\norg.apache.catalina.cluster.tcp.ReplicationListener/DEBUG: ReplicationListener\nlisten in while doListen before select with tcpSelectorTimeout=1000\n2004-04-07 12:39:33,571 (ClusterReceiver)\norg.apache.catalina.cluster.tcp.ReplicationListener/DEBUG: ReplicationListener\nlisten in while doListen after select returned n=1\n2004-04-07 12:39:33,571 (ClusterReceiver)\norg.apache.catalina.cluster.tcp.ReplicationListener/DEBUG: ReplicationListener\nwokeup in listen\n2004-04-07 12:39:33,571 (ClusterReceiver)\norg.apache.catalina.cluster.tcp.ReplicationListener/DEBUG: ReplicationListener\ncalling serviceChannel from readDataFromSocket in TcpReplicationThread\n2004-04-07 12:39:33,571 (ClusterReceiver)\norg.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread\ncalling notify in serviceChannel\n2004-04-07 12:39:33,571 (ClusterReceiver)\norg.apache.catalina.cluster.tcp.ReplicationListener/DEBUG: ReplicationListener\nlisten in while doListen before select with tcpSelectorTimeout=1000\n2004-04-07 12:39:33,571 (p.TcpReplicationThread[1])\norg.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread\nwoke up with key sun.nio.ch.SelectionKeyImpl@b3f9b8\n2004-04-07 12:39:33,572 (p.TcpReplicationThread[1])\norg.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread\nwoke up and calling drainChannel for key sun.nio.ch.SelectionKeyImpl@b3f9b8\n2004-04-07 12:39:33,572 (p.TcpReplicationThread[1])\norg.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread\nStarting drainChannel for key sun.nio.ch.SelectionKeyImpl@b3f9b8\n2004-04-07 12:39:33,572 (p.TcpReplicationThread[1])\norg.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread\ndrainChannel inner loop has count 540 and pkgcnt 1\n2004-04-07 12:39:33,574 (p.TcpReplicationThread[1])\norg.apache.catalina.cluster.tcp.SimpleTcpCluster/DEBUG: Received in\nclusterSender.messageDataReceived msg 13 session\nCD25AAD154CC01843779EA36B143D101.mkbtomcat1\n2004-04-07 12:39:33,574 (p.TcpReplicationThread[1])\norg.apache.catalina.cluster.session.DeltaManager/DEBUG: Manager () Received\nSessionMessage of type=SESSION-DELTA from\norg.apache.catalina.cluster.mcast.McastMember\n[tcp://10.254.65.100:5002,10.254.65.100,5002,\nalive=230851]\n2004-04-07 12:39:33,576 (p.TcpReplicationThread[1])\norg.apache.catalina.cluster.session.DeltaManager/INFO : End of session.access in\nid=CD25AAD154CC01843779EA36B143D101.mkbtomcat1 isNew=false\nlastAccessedTime=1081334372572 thisAccessedTime=1081334373575 accessCount=1\n2004-04-07 12:39:33,576 (p.TcpReplicationThread[1])\norg.apache.catalina.cluster.session.DeltaManager/INFO : End of \nsession.endAccess in\nid=CD25AAD154CC01843779EA36B143D101.mkbtomcat1 isNew=false\nlastAccessedTime=1081334372572 thisAccessedTime=1081334373575 accessCount=0\n2004-04-07 12:39:33,577 (p.TcpReplicationThread[1])\norg.apache.catalina.cluster.session.DeltaManager/DEBUG: Receiving \nEVT_SESSION_DELTA:\nUpdating Session with  id=CD25AAD154CC01843779EA36B143D101.mkbtomcat1 \nisValid=true\nisNew=false accessCount=0 maxInactiveInterval=900 isPrimarySession=false\ncreationTime=1081334372572 lastAccessedTime=1081334372572\nlastTimeReplicated=1081334372571\n2004-04-07 12:39:33,577 (p.TcpReplicationThread[1])\norg.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread\ndrainChannel has pkgcnt 1\n2004-04-07 12:39:33,577 (p.TcpReplicationThread[1])\norg.apache.catalina.cluster.tcp.TcpReplicationThread/DEBUG: TcpReplicationThread\ndrainChannel sending ack for pkgcnt 1\n\n7) The ack is seen on node 1 at 12:39:33,579 and session.endAccess() ends the\nprocessing of the request\n\n2004-04-07 12:39:33,579 (http-21080-Processor25)\norg.apache.catalina.cluster.session.DeltaManager/INFO : End of \nsession.endAccess in\nid=CD25AAD154CC01843779EA36B143D101.mkbtomcat1 isNew=false\nlastAccessedTime=1081334372565 thisAccessedTime=1081334372574 accessCount=0Here is what causes the problem:\n\nin TcpReplicationThread line 142 the call to key.interestedOps blocks until the\nselect in the parallel execution of ReplicationListener returns the next time. \nI checked with adding debug output directly nefore and after.\n\nInternet sources confirm, that register and setting interestedOps are blocking \non select to the same selector.\n\nSome people suggest putting wakeup directly before register and interstedOps, \nbut since an interrupted select in ReplicationListener will very quickly do the \nnext select, I think you need some way of informing ReplicationListener to not \ndo the select until interestedOps has returned.\nWhy would you set tcpSelectorTimeout to 1000ms?\n\nThe tcpSelectorTimeout feature is in place because of a bug in java NIO. If \nyour NIO is working bug free, then tcpSelectorTimeout should be 0, cause the \nselector should wake up by itself when it receives a package. In many Unix \nJDKs this is not the case, hence you can set it to 50ms.\n\nI am setting this to INVALID, cause 1000ms in tcpSelectorTimeout is wrong. The \nproblem is in Java NIO, not in Tomcat, hence you have to set \ntcpSelectorTimeout to a reasonable value. On windows you can set to 0, no \ntimeout, cause on windows NIO works well, and the selector wakes up by itself \nwhen a data packet arrives\n\n\nFilipI\'m having a different opinion: it is well documented, that key.interestedOps() \nblocks waiting for select() to return - dependent on the JVM implementation. It \nis not a bug in the JVM!\n\nYou call interestedOps() in TcpReplicationThread line 142 although there is a \nparallelly executing select() call in ReplicationListener. So the interestedOps\n() blocks the TcPReplicationThread until the select() in ReplicationListener \nreturns. Since during that time OP_READ is not set, select might block a very \nlong time.\n\nOf course setting tcpSelectorTimeout to a very small value looks like a \nworkaround. But still it is not a safe solution: depending on the scheduling of \nthreads on CPUs it might happen, that ReplicationListener calls select() again, \nbefore interestedOps() is able to set the new flags.\n\nI really think you need a design, \n- where you check for pending interestedOps or register calls before retrying \nselect\n- where you \"register\" interestedOps or register calls as pending, afterwards \ncall wakeup, then do the interestedOps or register call and \nfinally \"unregister\" the calls.\n\nReopened - reason see my 2 last comments. tcpSelectorTimeout was only chosen so \nbig to demonstrate the bug.Yes, you are absolutely right, the interestOps in unix is blocking until \nselect is done.\n\nI will fix this, many thanks for the detailed bug reportThank you very much! I hope I don\'t bother you too much, but we plan to use TC\n5.0 cluster in a high load mission critical application starting June. So we try\nhard to help you improve robustness.\n\nI think you do a wonderful job and we try to be as precise as possible with our\nobservations.As always, I stand corrected about interestOps blocking. This has been fixed,\nhowever, setting tcpSelectorTimeout to 1000ms will still yield the same \nproblems because of selector.select() will not wake up if new data comes in on \nthe tcp channel.',?,IMPROVEMENT
28262,'Fix autodeploy bug at CVS HEAD','Tomcat 5',Catalina,pr,dev,'Hey,\n\nat 5.0.19 release the dir and war autodeploy feature don\'t work\nbut the current cvs head (07.04.2004) has a fix.\n\nAfter test I see a strange behavior.\n\nfirst example or bug\n====================\nstart tomcat\ncopy dir or war to webapps\nwait 1 sec\nlook a manager app \nOK. Apps are deploy and ready.\nremove dir or war with the manager app\n\nResult:\ndir is deleted but war\'s not !\n  work dir or context.xml removed\n  HostConfig not closed a jar pointer. (s. Patch)\n\nnext example\n============\nstart tomcat\ncopy dir or war to webapps\nwait 1 sec\nlook a manager app \nOK. Apps are deploy and ready.\nremove dir or war with the manager app\nwait 1 sec\ncopy dir or war again to webapps\nHups. Autodeployment not work anymore\n\nI look at HostConfig and see that all autodeploy xml,dirs and wars\nregistered at deployed list but not delete.\n\nI add a checkRemoveApps() method and call it inside check().\n\nNow second szenario work correct.\n\nRegards\nPeterCreated attachment 11171\nAutodeploy Patch HostConfigCreated attachment 11172\nLocalString.properties ( debug messages)Your patch works fine. Thanks.',?,BUG
28286,'Loosely couple SingleSignOn Valve and Authenticators','Tomcat 5',Catalina,bstansberry,dev,'Attached is a patch that loosens the coupling between the SingleSignOn valve \nimplementation and the various Authenticator classes.  Right now, all \nauthenticators check for an instance of the SingleSignOn class in the pipeline, \nand interact directly with it.  In the patch, SingleSignOn implements interface \nSSOValve, and all external classes interact with it through the interface.  This \nwill allow application developers to deploy custom SSO implementations without \nhaving to replace the entire TC5 Authenticator infrastructure.  This follows the \npattern used by other TC components.\n\nI\'ve been messing around with trying to use the SingleSignOn valve in a cluster \n(see enhancement request 28039) and can easily see how different implementations \nwould be appropriate for different environments.  My 28039 patch attacks the \nproblem by adding a property to SingleSignOn where deployers can specify use of \nan implementation of a new interface SSOClusterManager.  I think that\'s a valid \napproach, but loosening the coupling between SingleSignOn and Authenticators \nwill provide greater flexibility.Created attachment 11188\nPatch with a diff and new interface SSOValveYour two related patches seem useful. I\'ll look at them.Great.  I\'m sorry to say the two patches conflict (not logically, but in the \nsense that they are diffs to the same code base), but if one is committed I\'ll \ngladly redo the other.After reviewing, I am not going to apply this patch or the other. I don\'t see\nthe point of adding complexity and additional interfaces when SSO is used\nthrough a standard Valve (SingleSignOn), which can easily be extended to\nimplement the needed clustering support.I thought you might feel that way about the 28039 patch, which is one reason \nwhy I wrote the interface proposal ;-)  And, it\'s true an interface isn\'t \nabsolutely needed; subclassing would work.  The fact that SingleSignOnEntry is \nnot public (and I\'m not arguing it should be) is a big stumbling block in \neasily subclassing SingleSignOn, but getting around that problem in a subclass \nis no harder than writing a whole new implementation of an interface.\n\nBut, to get subclassing to work effectively, a couple things need to be \nchanged:\n\n1) AuthenticatorBase.reauthenticateFromSSO() invokes SingleSignOn.lookup().  \nThis method returns a SingleSignOnEntry, which is a package protected class.  \nThis effectively precludes subclassing this method.  \n\n2) SingleSignOn.update() is package protected, again preventing subclassing.\n\nI\'m attaching another patch that addresses these two issues by:\n\n1) Changing the way AuthenticatorBase.reauthenticateFromSSO() works so it does \nnot need to call SingleSignOn.lookup().  lookup() is now only called \ninternally in SingleSignOn, so someone who wished to write a subclass could \njust remove any calls to it, write their own lookup algorithm, and replace \nSingleSignOnEntry with their own class.\n\n2) Makes SingleSignOn.update() protected.\n\nMaybe 3rd time\'s the charm? ;-)Created attachment 11330\nPatch to allow subclassingI\'m all for making the entry public. I think I\'m going to apply your patch.This is committed. I don\'t see the point of not allowing to extend the entry as\nwell, so I also patched it.The constructor in SingleSignOnEntry is package protected, so the class cannot \nbe extended.  The attached patch makes the c\'tor protected.Created attachment 11566\nPatch to allow subclassing of SingleSignOnEntry',?,REFACTORING
28321,'Memory Leak','Tomcat 5',Jasper,rpatel,dev,'Server Setup:\niPlanetTM Web Server, Enterprise Edition 6.0\nWindows 2000\nTomcat 5.0.19\n\niPlanet is connected to the Tomcat server using the jk2 connector.\n\nI configured JMeter with 40 threads to repeated request the same JSP over and over.\nAll this JSP did was print out the Total Memory, Free Memory.\nAfter about 5000 requests, Tomcat got an out of memory error.\n\nSame test was done but hitting the tomcat container directly, \nsuccessfully served 15k requests with no memory leak\n\nTest was done again, but instead of IPlanet used Apache 2.  Successfully\nserved 15k requests with no memory leak.\n\nIn the test case using IPlanet, there were continuous error files that\nwere not present in the other test cases:\n\nApr 8, 2004 6:24:57 PM org.apache.jk.common.HandlerRequest decodeRequest\nWARNING: Error registering request\nApr 8, 2004 6:24:57 PM org.apache.jk.common.HandlerRequest invoke\nINFO: Unknown message 0Created attachment 11203\nTomcat stdout.logAlso, I tried the IPlanet->Tomcat test case using\nTomcat 5.0.18.  There was not memory leak.Created attachment 11220\nJProfiler Heap Snapshot showing path to garbage collection root.And did you try adding response = null; in JspWriterImpl.recycle to see what\nhappened ?\nI don\'t quite understand why or how it would really be a problem, though, as the\nreferences will go away sooner or later.Created attachment 11221\nList of objects in memoryNo I didn\'t want to mess around with the Tomcat code.  I would be happy if I\ncould just turn off JMX completely.You could try setting:\n  request.registerRequests=false\nin your jk2.properties file.  This will turn off the JMX registration of \nRequests.  \n\nTurning off the jmx registrations has solved the problem for us.  We were able to\ndo 100k requests with no memory leak.Bill, did you possibly fix this in 5.0.20?\n\nI am specifically referring to the changelog entry:\n\n  \"Fix JMX Request registration in JK (billbarker)\"\n\nI know that fixed other issues for which I was using\n\n  request.registerRequests=false\n\nRajesh, I would be interested in knowing if 5.0.2x exhibit the same issues in\nyour testing.There are a couple of other entries in the changelog that are related, but \nyes, this should be fixed in 5.0.20+.\n\nYou still should need to disable request-registration if you are using the JNI \nChannel, since the leak is still there.  Fixing it here requires changes to \nthe native side of the connector as well, since that is the only place that \nknows that a thread has died.\n\nMarking this as FIXED, since it looks like its a dup of the same-old request-\nregistration problem.*** Bug 28731 has been marked as a duplicate of this bug. ***',?,BUG
28333,'Add info on cvs login to tomcat build file.','Tomcat 5',Unknown,sandymac,dev,'On the building doc:\nhttp://jakarta.apache.org/tomcat/tomcat-5.0-doc/building.html you are told to\ndownload and run an ant build file:\nhttp://jakarta.apache.org/tomcat/tomcat-5.0-doc/build.xml to checkout tomcat\nsources. For people running this the first time the checkout target will fail\nbecause they need to login to CVS. It would be nice if the following task was\nadded near the top of the checkout target to inform the developer of what needs\nto be done.\n\n<echo level=\"info\"\n     message=\"If the checkouts fail, run `cvs -d ${cvsroot} login` and try again.\"/>Fixed.',?,DOCUMENTATION
28335,'janitorial javadoc clean ups to jakarta-tomcat-catalina','Tomcat 5',Catalina,sandymac,dev,'The to be attached patch cleans up only JavaDoc comments that have one of the\nfollowing problems:\n\nCorrected @param names is wrong or misspelled\nRemoved @param names that don\'t exists\nRemoved @param names that have no description\nRemoved @return tags without a description\nRemoved @exception tags for exceptions that are not thrown by the method\nCorrected @see tags\n\nIn the case where it wasn\'t obivious how to fix a javadoc comment, I just left\nit alone.Created attachment 11212\ncatalina javadoc clean upsChanges made and committed (along with a few more JavaDoc fixes).',?,DOCUMENTATION
28361,'foreach no longer works in tag file','Tomcat 5',Unknown,aminm,dev,'here is a simple tag file:\n\n<\%@ taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" \%>\n<\%@ attribute name=\"lista\" type=\"java.util.ArrayList\" required=\"true\" \nrtexprvalue=\"true\"\%>\n\n${lista[1]}\n\n<c:forEach var=\"elem\"  items=\"${lista}\">\n    <LI> ${elem}</LI>\n</c:forEach>\n\nHere is the output I get from tomcat 5.0.0.19:\n\ntype Exception report\n\nmessage \n\ndescription The server encountered an internal error () that prevented it from \nfulfilling this request.\n\nexception \n\norg.apache.jasper.JasperException: Unable to compile class for JSP\n\nAn error occurred at line: -1 in the jsp file: null\n\nGenerated servlet error:\n    [javac] Compiling 1 source file\n\nC:\\dev\\jakarta-tomcat-5.0.19\\work\\Catalina\\localhost\\jsp-\nexamples\\org\\apache\\jsp\\tag\\web\\listado_tag.java:185: cannot resolve symbol\nsymbol  : variable pageContext \nlocation: class org.apache.jsp.tag.web.listado_tag\npageContext.setAttribute(\n^\n1 error\n\n\n\torg.apache.jasper.compiler.DefaultErrorHandler.javacError\n(DefaultErrorHandler.java:127)\n\torg.apache.jasper.compiler.ErrorDispatcher.javacError\n(ErrorDispatcher.java:351)\n\torg.apache.jasper.compiler.Compiler.generateClass(Compiler.java:415)\n\torg.apache.jasper.compiler.Compiler.compile(Compiler.java:458)\n\torg.apache.jasper.compiler.Compiler.compile(Compiler.java:439)\n\torg.apache.jasper.JspCompilationContext.compile\n(JspCompilationContext.java:553)\n\torg.apache.jasper.servlet.JspServletWrapper.loadTagFile\n(JspServletWrapper.java:209)\n\torg.apache.jasper.compiler.TagFileProcessor.loadTagFile\n(TagFileProcessor.java:553)\n\torg.apache.jasper.compiler.TagFileProcessor.access$000\n(TagFileProcessor.java:93)\n\torg.apache.jasper.compiler.TagFileProcessor$TagFileLoaderVisitor.visit\n(TagFileProcessor.java:604)\n\torg.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1458)\n\torg.apache.jasper.compiler.Node$Nodes.visit(Node.java:2180)\n\torg.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2230)\n\torg.apache.jasper.compiler.Node$Visitor.visit(Node.java:2236)\n\torg.apache.jasper.compiler.Node$Root.accept(Node.java:485)\n\torg.apache.jasper.compiler.Node$Nodes.visit(Node.java:2180)\n\torg.apache.jasper.compiler.TagFileProcessor.loadTagFiles\n(TagFileProcessor.java:622)\n\torg.apache.jasper.compiler.Compiler.generateJava(Compiler.java:259)\n\torg.apache.jasper.compiler.Compiler.compile(Compiler.java:456)\n\torg.apache.jasper.compiler.Compiler.compile(Compiler.java:439)\n\torg.apache.jasper.JspCompilationContext.compile\n(JspCompilationContext.java:553)\n\torg.apache.jasper.servlet.JspServletWrapper.service\n(JspServletWrapper.java:291)\n\torg.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:301)\n\torg.apache.jasper.servlet.JspServlet.service(JspServlet.java:248)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\n\nnote The full stack trace of the root cause is available in the Tomcat logs.\n\n\n------------\n\nIt seems that a change done in Tomcat 5.0.0.19 got rid of pageContext in the \ndoTag(). Unfortunately foreach seems to need that.You must be using a stale tag file.\n\nAs of TC 5.0.19, the generated tag handler (corresponding to the tag file)\ngenerates this code:\n\n  _jspx_page_context.setAttribute(\"lista\", getLista());\n\nThis change was made in order to address Bugtraq 4984188 (\"pageContext used in\n*.tag files\"). With the fix, the implicit \"pageContext\" object is no longer\nexposed in tag files, to comply with the JSP spec.Ah, I think you are using one of the tag plugins?\nIn that case, you\'re right, this is a bug.\n\nThe tag plugins for <c:forEach> and <c:if> still reference \"pageContext\"\nin their generated code.\n\nAs a workaround, do not use any tag plugins, until this has been fixed.\n\n',?,BUG
28380,'Dynamic attributes with non-alphanumeric chars in names do not work in classic tag handlers with pooling enabled','Tomcat 5',Jasper,tivv,dev,'See summary.\nNeither \"style.width\" nor \"mynamespace:attribute\" attributes in tags do not work\nbecause Jasper\ntries to make pool variable based on this names. I suppose some escaping must be\nadded.No idea what you are talking about.  Dynamic attributes in classic tag handlers?\n Also, Jasper does not make variables out of dynamic attributes.\n\nPlease supply a test case (in war) if you still have problems.Yes.\nI have my own tag handler that implement DynamicAttributes interface, say\npublic class ComponentTag extends TagSupport implements\njavax.servlet.jsp.tagext.DynamicAttributes {\npublic synchronized void setDynamicAttribute(String uri, String localname,\nObject o) throws JspException {}\n}\n\nregistered as myTagLib:myTag.\n\nWhen I try to call <myTagLib:myTag myTagLib:myTagAttribute=\"attrvalue\"/>\nor <myTagLib:myTag style.width=\"100\%\"/> I am getting an exception from javac\nthat can\'t create tag pool variable in JSP class with \"style.width\" or\n\"myTagLib:myTagAttribute\" string in it\'s name.\nAh, so the bug covers that cases when there is a \'.\' or \':\' in the attribute\nnames.  I was lead off track with the mention of dynamic attributes.\n\nFixed in CVS.',?,BUG
28441,'HTTP 500 editing Context','Tomcat 5',Webapps:Administration,phps,dev,'I have a context called \"accounting\" with the following entry in server.xml:\n\n<Context path=\"/accounting\" docbase=\"accounting\">\n<Realm className=\"org.apache.catalina.realm.DataSourceRealm\" debug=\"99\"   \ndataSourceName=\"jdbc/accountingDB\" digest=\"md5\" userTable=\"employee\"\nuserNameCol=\"employee_id\" userCredCol=\"password\" userRoleTable=\"role\"\nroleNameCol=\"role\"/>\n<Logger className=\"org.apache.catalina.logger.FileLogger\" directory=\"logs\"\nprefix=\"accounting.log\" suffix=\".txt\" timestamp=\"true\"/>\n</Context>\n\nThe entire application works well. But if i try to use the Tomcat Administrator \nfor editing the DataSources or Realms of this context i get an HTTP 500 error.\nThe \"jdbc/accountingDB\" ressource is defined in GlobalNamingResources. Editing\nthis works well.\n\nThe errors are: For editing the contexts DataSources: \n\njavax.servlet.ServletException: Exception retrieving attribute \'driverClassName\'\n\torg.apache.jasper.runtime.PageContextImpl.doHandlePageException(PageContextImpl.java:867)\n\torg.apache.jasper.runtime.PageContextImpl.handlePageException(PageContextImpl.java:800)\n\tadmin.resources.listDataSources_jsp._jspService(listDataSources_jsp.java:429)\n\torg.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:133)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\torg.apache.struts.action.RequestProcessor.doForward(RequestProcessor.java:1069)\n\torg.apache.struts.action.RequestProcessor.processForwardConfig(RequestProcessor.java:455)\n\torg.apache.struts.action.RequestProcessor.process(RequestProcessor.java:279)\n\torg.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)\n\torg.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:743)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\torg.apache.struts.action.RequestProcessor.doForward(RequestProcessor.java:1069)\n\torg.apache.struts.action.RequestProcessor.processForwardConfig(RequestProcessor.java:455)\n\torg.apache.struts.action.RequestProcessor.process(RequestProcessor.java:279)\n\torg.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)\n\torg.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:743)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\n\nFor editing the contexts realms: \n\nHTTP Status 500 - Error retrieving attribute className\n\ntype Status report\n\nmessage Error retrieving attribute className\n\ndescription The server encountered an internal error (Error retrieving attribute\nclassName) that prevented it from fulfilling this request.\nApache Tomcat/5.0.18DataSourceRealm is not supported in admin webapp currently.  Only\nUserDatabaseRealm, JNDIRealm, JDBCRealm, and MemoryRealm are supported.  I\'ll go\nahead and add DataSourceRealm to admin, hence changing it to enhancement.\nRegarding context datasources, it works fine for me.  Can you attach the full\nserver.xml?  Probably something wrong with your DataSource definition.Full server.xml\n\n<Server port=\"8005\" shutdown=\"SHUTDOWN\" debug=\"0\">\n\t<Listener className=\"org.apache.catalina.mbeans.ServerLifecycleListener\"\ndebug=\"0\"/>\n\t<Listener\nclassName=\"org.apache.catalina.mbeans.GlobalResourcesLifecycleListener\" debug=\"0\"/>\n\t<!-- Global JNDI resources -->\n\t<GlobalNamingResources>\n\t\t<!-- Editable user database that can also be used by\n         UserDatabaseRealm to authenticate users -->\n\t\t<Resource name=\"UserDatabase\" auth=\"Container\"\ntype=\"org.apache.catalina.UserDatabase\" description=\"User database that can be\nupdated and saved\">\n    </Resource>\n\t\t<ResourceParams name=\"UserDatabase\">\n\t\t\t<parameter>\n\t\t\t\t<name>factory</name>\n\t\t\t\t<value>org.apache.catalina.users.MemoryUserDatabaseFactory</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>pathname</name>\n\t\t\t\t<value>conf/tomcat-users.xml</value>\n\t\t\t</parameter>\n\t\t</ResourceParams>\n\t\t<!-- mysql database -->\n\t\t<Resource name=\"jdbc/accountingDB\" auth=\"Container\" type=\"javax.sql.DataSource\"/>\n\t\t<ResourceParams name=\"jdbc/accountingDB\">\n\t\t\t<parameter>\n\t\t\t\t<name>factory</name>\n\t\t\t\t<value>org.apache.commons.dbcp.BasicDataSourceFactory</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>dataSourceName</name>\n\t\t\t\t<value>java:comp/env/jdbc/accountingDB</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>defaultAutoCommit</name>\n\t\t\t\t<value>false</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>maxActive</name>\n\t\t\t\t<value>100</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>maxIdle</name>\n\t\t\t\t<value>30</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>maxWait</name>\n\t\t\t\t<value>10000</value>\n\t\t\t</parameter>\n\t\t\t<!-- MySQL dB username and password for dB connections  -->\n\t\t\t<parameter>\n\t\t\t\t<name>username</name>\n\t\t\t\t<value>dummy</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>password</name>\n\t\t\t\t<value>dummy</value>\n\t\t\t</parameter>\n\t\t\t<!-- Class name for the official MySQL Connector/J driver -->\n\t\t\t<parameter>\n\t\t\t\t<name>driverClassName</name>\n\t\t\t\t<value>com.mysql.jdbc.Driver</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>url</name>\n\t\t\t\t<value>jdbc:mysql://localhost:3306/accounting?autoReconnect=true</value>\n\t\t\t</parameter>\n\t\t</ResourceParams>\n\t</GlobalNamingResources>\n\t<!-- Define the Tomcat Stand-Alone Service -->\n\t<Service name=\"Catalina\">\n\t\t<!-- Define a non-SSL Coyote HTTP/1.1 Connector on port 8080 -->\n\t\t<Connector port=\"80\" maxThreads=\"150\" minSpareThreads=\"25\"\nmaxSpareThreads=\"75\" enableLookups=\"false\" redirectPort=\"8443\" acceptCount=\"100\"\ndebug=\"0\" connectionTimeout=\"20000\" disableUploadTimeout=\"true\"/>\n\t\t<!-- Define a Coyote/JK2 AJP 1.3 Connector on port 8009 -->\n\t\t<Connector port=\"8009\" enableLookups=\"false\" redirectPort=\"8443\" debug=\"0\"\nprotocol=\"AJP/1.3\"/>\n\t\t<!-- Define the top level container in our container hierarchy -->\n\t\t<Engine name=\"Catalina\" defaultHost=\"localhost\" debug=\"0\">\n\t\t\t<!-- Global logger unless overridden at lower levels -->\n\t\t\t<Logger className=\"org.apache.catalina.logger.FileLogger\"\nprefix=\"catalina_log.\" suffix=\".txt\" timestamp=\"true\"/>\n\t\t\t<Realm className=\"org.apache.catalina.realm.UserDatabaseRealm\" debug=\"0\"\nresourceName=\"UserDatabase\"/>\n\t\t\t<Host name=\"localhost\" debug=\"0\" appBase=\"webapps\" unpackWARs=\"true\"\nautoDeploy=\"true\" xmlValidation=\"false\" xmlNamespaceAware=\"false\">\n\t\t\t\t<!-- PB -->\n\t\t\t\t<Valve className=\"org.apache.catalina.valves.AccessLogValve\"\ndirectory=\"logs\" prefix=\"localhost_access_log.\" suffix=\".txt\" pattern=\"common\"\nresolveHosts=\"false\"/>\n\t\t\t\t<!-- PB -->\n\t\t\t\t<Logger className=\"org.apache.catalina.logger.FileLogger\" directory=\"logs\"\nprefix=\"localhost_log.\" suffix=\".txt\" timestamp=\"true\"/>\n\t\t\t\t<!-- Tomcat Root Context -->\n\t\t\t\t<Context path=\"\" docBase=\"ROOT\" debug=\"0\"/>\n\t\t\t\t<Context path=\"/accounting\" docbase=\"accounting\">\n\t\t\t\t\t<Realm className=\"org.apache.catalina.realm.DataSourceRealm\" debug=\"99\"\ndataSourceName=\"jdbc/accountingDB\" digest=\"md5\" userTable=\"employee\"\nuserNameCol=\"employee_id\" userCredCol=\"password\" userRoleTable=\"role\"\nroleNameCol=\"role\"/>\n\t\t\t\t\t<Logger className=\"org.apache.catalina.logger.FileLogger\" directory=\"logs\"\nprefix=\"accounting.log\" suffix=\".txt\" timestamp=\"true\"/>\n\t\t\t\t</Context>\n\t\t\t</Host>\n\t\t</Engine>\n\t</Service>\n</Server>Added DataSourceRealm support in admin.  The fix is in cvs and should be\navailable in the next release.',?,RFE
28524,'Exception throw when creating new JNDI data source','Tomcat 5',Webapps:Administration,dtrott,dev,'Steps to reproduce:\n\nCreate three empty directories:\n\ntestcase\ntestcase\\WEB-INF\ntestcase\\WEB-INF\\classes\n\nCreate a file web.xml containing the following:\n\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE web-app PUBLIC \"-//Sun Microsystems, Inc.//DTD Web Application \n2.3//EN\" \"http://java.sun.com/dtd/web-app_2_3.dtd\">\n<web-app>\n   <resource-ref>\n    <description>Test connection</description>\n    <res-ref-name>jdbc/testdb</res-ref-name>\n    <res-type>javax.sql.DataSource</res-type>\n    <res-auth>Container</res-auth>\n  </resource-ref>\n</web-app>\n\n\nUse the Tomcat manager app to deploy the directory (context) /testcase\n\nNext log into the the \"Tomcat Administration Tool\" and open the datasources \npage:\n\n  Tomcat Server \n    Service (Catalina) \n     Host (localhost) \n      Context (/testcase) \n        Resources \n          Data Sources \n\nThe following exception is displayed in the right frame:\n\n\nHTTP Status 500 - \n\n--------------------------------------------------------------------------------\n\ntype Exception report\n\nmessage \n\ndescription The server encountered an internal error () that prevented it from \nfulfilling this request.\n\nexception \n\njavax.servlet.ServletException: Exception retrieving attribute \'driverClassName\'\n\torg.apache.jasper.runtime.PageContextImpl.doHandlePageException\n(PageContextImpl.java:867)\n\torg.apache.jasper.runtime.PageContextImpl.handlePageException\n(PageContextImpl.java:800)\n\tadmin.resources.listDataSources_jsp._jspService\n(listDataSources_jsp.java:431)\n\torg.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:133)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\torg.apache.struts.action.RequestProcessor.doForward\n(RequestProcessor.java:1069)\n\torg.apache.struts.action.RequestProcessor.processForwardConfig\n(RequestProcessor.java:455)\n\torg.apache.struts.action.RequestProcessor.process\n(RequestProcessor.java:279)\n\torg.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)\n\torg.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:743)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\torg.apache.struts.action.RequestProcessor.doForward\n(RequestProcessor.java:1069)\n\torg.apache.struts.action.RequestProcessor.processForwardConfig\n(RequestProcessor.java:455)\n\torg.apache.struts.action.RequestProcessor.process\n(RequestProcessor.java:279)\n\torg.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)\n\torg.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:743)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\n\nroot cause \n\njavax.servlet.jsp.JspException: Exception retrieving attribute \'driverClassName\'\n\torg.apache.webapp.admin.AttributeTag.doEndTag(AttributeTag.java:215)\n\tadmin.resources.listDataSources_jsp._jspx_meth_controls_attribute_1\n(listDataSources_jsp.java:743)\n\tadmin.resources.listDataSources_jsp._jspService\n(listDataSources_jsp.java:391)\n\torg.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:133)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\torg.apache.struts.action.RequestProcessor.doForward\n(RequestProcessor.java:1069)\n\torg.apache.struts.action.RequestProcessor.processForwardConfig\n(RequestProcessor.java:455)\n\torg.apache.struts.action.RequestProcessor.process\n(RequestProcessor.java:279)\n\torg.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)\n\torg.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:743)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\torg.apache.struts.action.RequestProcessor.doForward\n(RequestProcessor.java:1069)\n\torg.apache.struts.action.RequestProcessor.processForwardConfig\n(RequestProcessor.java:455)\n\torg.apache.struts.action.RequestProcessor.process\n(RequestProcessor.java:279)\n\torg.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)\n\torg.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:743)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\n\nnote The full stack trace of the root cause is available in the Tomcat logs.\n\n\n--------------------------------------------------------------------------------\n\nApache Tomcat/5.0.19I think you\'re getting the error because you have resource-ref in your web.xml\nbut no context datasource definition on either server.xml or context.xml.  Admin\nis expecting to find datasource and looking up its driverClassName but the\ndefinition isn\'t there.  As a workaround, you can add context datasource first\nvia admin or by hand in context.xml and add your resource-ref in web.xml.  I\nknow it\'s hacky.  I\'ll try to fix this for the next release but no time right now.I have confirmed that Amy Roh\'s workaround works.\n\nThank You.\nFixed - doesn\'t try to display context resource in admin unless you have full \nresource definition in your context.xml or server.xml.I attempted to verify this fix using nightly build:\n\njakarta-tomcat-5-bin-20040427.zip\n\nFirst I copied the Oracle JDBC driver into the directory:\n\njakarta-tomcat-5\\common\\lib\n\nI was able to successfully reach the data sources page:\n\n  Tomcat Server \n    Service (Catalina) \n     Host (localhost) \n      Context (/testcase) \n        Resources \n          Data Sources\n\n\nHowever I then tried to create a data source:\n\nJNDI Name:\t\t\tjdbc/testdb\nData Source URL:\t\tjdbc:oracle:thin:@paris:1521:d921\nJDBC Driver Class:\t\toracle.jdbc.driver.OracleDriver\nUser Name:\t\t\t[PRIVATE]\nPassword:\t\t\t[PRIVATE]\nMax. Active Connections:\t1\nMax. Idle Connections:\t1\nMax. Wait for Connection:\t5000\nValidation Query:\n\n\nAfter clicking the \"Save\" button, I received the following error:\n\nHTTP Status 500 - Error invoking operation addResource\n\n--------------------------------------------------------------------------------\n\ntype Status report\n\nmessage Error invoking operation addResource\n\ndescription The server encountered an internal error (Error invoking operation \naddResource) that prevented it from fulfilling this request.\n\n\n--------------------------------------------------------------------------------\n\nApache Tomcat/5.0\nYou did waste your time, sorry.\na) How about checking the date before hitting submit ?\nb) Don\'t use nightlies, use a CVS buildI have just (12:06 PM PST 04/28/04) done a build from CVS.\n\nThe \"Error invoking operation addResource\" bug still exists in the CVS build.\nWhat does admin log say?  The log should display the exception that\'s causing\nthe error.  The datasource add works for me.  The page now displays datasource\nif you have resource-ref in your web.xml with the corresponding\nGlobalNamingResource parameters.The exception in the admin log is given at the bottom of this post.\n\nHowever I just did a clean (deleting all files but build.xml) CVS build, so the \nJNDI data source is not defined.\n\nAs a test I tried editing my web.xml file (listed before) to remove the \nresource-ref section.\nIf the resource-ref section is missing it is possible to add the data source \n(without error), however it is a pain to have to deploy the application edit \nthe web.xml, then after defining the data-source edit the web.xml back.\n\n\n\njavax.management.RuntimeOperationsException: Exception invoking method \naddResourcenested exception is java.lang.IllegalArgumentException: Invalid \nresource name - already exists\'jdbc/testdb\'\njava.lang.IllegalArgumentException: Invalid resource name - already \nexists\'jdbc/testdb\'\n\tat org.apache.catalina.mbeans.NamingResourcesMBean.addResource\n(NamingResourcesMBean.java:221)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.apache.commons.modeler.BaseModelMBean.invoke\n(BaseModelMBean.java:501)\n\tat mx4j.server.interceptor.InvokerMBeanServerInterceptor.invoke\n(InvokerMBeanServerInterceptor.java:209)\n\tat mx4j.server.interceptor.DefaultMBeanServerInterceptor.invoke\n(DefaultMBeanServerInterceptor.java:123)\n\tat mx4j.server.interceptor.SecurityMBeanServerInterceptor.invoke\n(SecurityMBeanServerInterceptor.java:79)\n\tat mx4j.server.interceptor.DefaultMBeanServerInterceptor.invoke\n(DefaultMBeanServerInterceptor.java:123)\n\tat mx4j.server.interceptor.DefaultMBeanServerInterceptor.invoke\n(DefaultMBeanServerInterceptor.java:123)\n\tat \nmx4j.server.interceptor.ContextClassLoaderMBeanServerInterceptor.invoke\n(ContextClassLoaderMBeanServerInterceptor.java:144)\n\tat mx4j.server.MBeanServerImpl.invoke(MBeanServerImpl.java:1353)\n\tat org.apache.webapp.admin.resources.SaveDataSourceAction.perform\n(SaveDataSourceAction.java:171)\n\tat org.apache.struts.action.Action.execute(Action.java:420)\n\tat org.apache.struts.action.RequestProcessor.processActionPerform\n(RequestProcessor.java:484)\n\tat org.apache.struts.action.RequestProcessor.process\n(RequestProcessor.java:274)\n\tat org.apache.struts.action.ActionServlet.process\n(ActionServlet.java:1482)\n\tat org.apache.struts.action.ActionServlet.doPost(ActionServlet.java:525)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:717)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:810)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:237)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:157)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:214)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:104)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:520)\n\tat org.apache.catalina.core.StandardContextValve.invokeInternal\n(StandardContextValve.java:198)\n\tat org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:152)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:104)\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke\n(AuthenticatorBase.java:540)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:102)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:520)\n\tat org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:137)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:104)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:117)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:102)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:520)\n\tat org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:109)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:104)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:520)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:929)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service\n(CoyoteAdapter.java:160)\n\tat org.apache.coyote.http11.Http11Processor.process\n(Http11Processor.java:793)\n\tat \norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio\nn(Http11Protocol.java:702)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java:571)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:644)\n\tat java.lang.Thread.run(Thread.java:534)If you have resource-ref defined in your web.xml, you need to have your resource\ndefinition either under GlobalNamingResource in server.xml or context resource\nin your context.xml in order to view via admin.  I have fixed addResource so\nthat it also checks for duplicate resource using encoded jndi name also.',?,IMPROVEMENT
28603,'JspC Ant task does not detect errors on a second compile','Tomcat 5',Jasper,petr.jiricka,dev,'1. Set up an application with an Ant script to compile JSPs as recommended at\nhttp://jakarta.apache.org/tomcat/tomcat-5.0-doc/jasper-howto.html\n2. Write a JSP which contains erroneous text such that the first phase (JSP ->\nJava translation) fails e.g. by including <jsp:include x=\"50\"/> in the page.\n3. Compile the application using the Ant script - a Jasper exception will be\nreported.\n4. Compile the application again - build will succeed despite the error.Fixed by removing empty .java file (that was generated by \"new\nFileOutputStream()\") if parser/validator/generator throws exception.I must say this still does not work for me in Tomcat 5.0.24. I am attaching an\napplication which reproduces this issue. To reproduce:\n\n1. Unzip the attached testApp.zip\n2. Modify the build.properties file from testApp.zip to point to a Tomcat 5.0.24\ninstallation\n3. In the root directory of this test application, run Ant twice (I am using Ant\n1.6.1). The first time you run Ant, a compilation error is reported, but the\nsecond time it is not and build succeeds.\n\nThanks for looking at this.\nCreated attachment 11444\nThe test application which reproduces this issue.Hmm, this works for me (on UNIX).\n\nDo you see an empty JSP_jsp.java file being generated in your project\'s \"build\"\ndirectory? Such a file used to be generated, but my fix should have deleted it\n(using File.delete()).Ok, I\'ll look at this over the weekend and debug it on my side.I found out where the problem is: When the file is deleted, the outputstream\nthat writes this file is still open, so the delete operation fails on Windows.\nThe stream is closed too late. I will attach a patch that fixes this on my machine.\n\nCreated attachment 11489\nPatch that works for me.Created attachment 11499\nSet \'writer\' to NULL, so it won\'t be closed again in finallyThanks for investigating, Petr!\n\nI\'ve applied your patch, which I slightly modified by setting \'writer\' to NULL\nafter closing it in the exception handling code you added, so that it won\'t be\nclosed again in the finally.\n\nModified patch attached.Thanks!',?,BUG
28604,'JspC should not display the whole stack trace of errors','Tomcat 5',Jasper,petr.jiricka,dev,'1. Set up an application with an Ant script to compile JSPs as recommended at\nhttp://jakarta.apache.org/tomcat/tomcat-5.0-doc/jasper-howto.html\n2. Write a JSP which contains erroneous text such that the first phase (JSP ->\nJava translation) fails e.g. by including <jsp:include x=\"50\"/> in the page.\n3. Compile the application using the Ant script - a Jasper exception will be\nreported. This will be reported including the whole Jasper stack trace, which\nmakes the report unreadable. Just the error message with the location would be\nsufficient.Print rootcause\'s stack trace only if rootcause is different from\nJasperExceptionThanks, this is definitely an improvement. \n\nFor IDE usage, it would be useful to do some additional changes to the build\nerror format:\n\nNot including a link to line number in build.xml, as that is not too significant\nto the developet. Instead, including the full path of the JSP which contains the\nerror. Also, text \"org.apache.jasper.JasperException\" is unnecessary. So instead of:\n\nE:\\bugs\\28603_tomcat\\project\\build.xml:23: org.apache.jasper.JasperException:\n/JSP.jsp(6,0) Include action: Mandatory attribute page missing\n\nthe output would look like:\n\nE:\\bugs\\28603_tomcat\\project\\web\\JSP.jsp [6:0] Include action: Mandatory\nattribute page missing \n\nThis would make the error format consistent with Javac. Is this possible? Thanks.\n- Include full path of the JSP that contains the error:\n\n  Done!\n\n- Avoid including a link to line number in build.xml:\n\n  \'ant\' is adding the build.xml line number when catching the exception\n  thrown by JspC.execute(). I don\'t think there is anything we can do to\n  avoid this.\n\n- Text \"org.apache.jasper.JasperException\" is unnecessary:\n\n  The exception class name is printed by JasperException.toString(),\n  which is inherited from java.lang.Throwable.toString():\n\n    public String toString() {\n        String s = getClass().getName();\n        String message = getLocalizedMessage();\n        return (message != null) ? (s + \": \" + message) : s;\n    }\n\n  We could override JasperException.toString() to suppress the\n  exception class name and just output the exception message.\n  I agree the exception class name is redundant when using JspC,\n  but it is useful info when compiling via the JspServlet.\n  Won\'t be changed. :)\nOk, this is a sufficient solution for our purposes. Thanks a lot!\n',?,IMPROVEMENT
28610,'Max memory reports 0 on status page','Tomcat 5',Catalina,David.Holscher,dev,'After a bit a digging I found that bootstrap.jar includes \norg/apache/tomcat/util/compat/JdkCompat.class but not \norg/apache/tomcat/util/compat/Jdk14Compat.class which seems to cause the \nJdk14Compat not to be loadable even though it is in tomcat-util.jar. This \ncauses the memory size to report 0 on the status page. I suspect it may cause a \nfew other problems as well.Fixed in the CVS, and should be available in the next nightly.',?,BUG
28631,'JAASRealm fix to permit user-specified user/group Principals','Tomcat 5',Catalina,arjaquith,dev,'This bug report was previously posted to tomcat-dev as \"[PATCH] JAASRealm fixes\" on 24-Apr-2004.\n----\nThese patches enable JAASRealm to work as advertised.\nIn particular, JAASRealm can use user-specified Principal classes\nfor both user Principals and group Principals, just like\nthe documentation says it is supposed to be able to do. In addition,\nI have added support for digested passwords similar to the way the\nother Realm implementations work.\n\nI have patched three files: JAASRealm.java, JAASCallbackHandler.java,\nand LocalStrings.properties. I have unquestionably fouled up\nthe @version Javadoc tags... one assumes the responsible parties\n(surely not me!) can fix these prior to committing.Created attachment 11354\nJAASRealm.patchCreated attachment 11355\nJAASCallbackHandler.patchCreated attachment 11356\nLocalStrings.patchI should make clear that the patch files I submitted affect 5.0.19, but were diffed against those \nfrom CVS HEAD, on the morning of 4/14/2004. Sorry if that was not readily apparent.Please submit test cases for this patch if possible.No test cases?  This item may be closed if none are submitted.Two issues preventing me from writing test cases:\n\n1) It isn\'t clear how to do that.\n\nThere isn\'t much documentation on how testing works; I was a but put off by that initially. After some \ninvestigation, I found jakarta-tomcat-catalina/tester/src/bin/tester.xml, which indeed appears to be an \nAnt file that performs out-of-container HTTP testing. So, sure, I can see how, if the container were \nconfigured to use my JAASRealm patch, I could re-test the authentication tests in jakarta-tomcat-\ncatalina/tester/src/tester/org/apache/tester/Authentication0*.java.\n\nSounds simple, but it all turns on the phrase \"if the container were configured to use my JAASRealm \npatch.\" All of the tests use, by default, uses UserDatabaseRealm. How could I make Tomcat use \nJAASRealm instead? It appears that I would need to either:\n- Create a custom context descriptor for the \"tester\" webapp that uses JAASRealm\n- Edit the existing conf/server.xml file\n... as well as cause the test script to bounce the server and re-load it with the new context descriptor. \nAha. To do this, now I need to hack the tester.xml Ant script.\n\nI have *never* written a Tomcat test case before, so this is just my best guess on what it would take. \nAm I wrong?\n\n2) I\'m not sure what it would contain. \n\nRemember that JAASRealm needs an implementation of a JAAS LoginModule to function. There isn\'t one \nsupplied with Tomcat, so this means I\'d need to:\n- Create a dummy LoginModule that authenticates certain hard-coded users but not others (e.g., \"Fred/\nbedrock\" but not \"Barney/feet\")\n- Create a \"sample\" LoginModule that authenticates against an existing user registry, like tomcat-\nusers.xml. But that seems like real work to me; I might as well port MemoryRealm to JAAS while I\'m at \nit. (Which is essentially what I\'d be doing). \n\nFrankly, this seems like a lot of bother for a patch that I *know* works; is has been in production on my \npersonal wiki for about three months. I can do it if you want to, as long as you accept that this means \nthat there will be quite a bit of changes to certain build files, and other things.\n\nWhat is the best path forward? The key issue here is lack of flexibility in the test scripts, which don\'t \npermit changing Realms for exercising authentication tests.Typical test cases submitted for Tomcat are WAR files.  They contain the code \nto be tested along with the META-INF/context.xml file which is the Context \nelement with the proper declarations, e.g. for a Realm.  Don\'t bother using the \nTester approach, that\'s wasted effort on build files.\n\nFor this case a dummy LoginModule with hard-coded user names and passwords is \nfine.  Also for this case, since the Realm has to be in a common classloader \nrepository, a single WAR won\'t be possible, so maybe a separate JAR.\n\nBasically, we ask for whatever you would use to unit-test your own patch.  I \nunderstand it works for you, and that\'s great, and if you don\'t unit-test \nthat\'s also OK (I sometimes don\'t do it either, we\'re not perfect ;)).  But we \ndo prefer to have unit tests before committing into the core Tomcat code.\n\nI also wanted to assess your interest in this: I\'m glad you responded, and \nquickly.  If I ask for tests, give it a couple of months with no response, then \nask again and get no response within a month or so, I sometimes close the \nbugzilla issue for lack of interest.  Because you responded we can keep this \nopen and resolve it.After a bit (!) of a hiatus, patches against the most recent release (5.0.28), and matching test cases, are \nprogressing. I expect to have both submitted early next week.Created attachment 12761\nSmall Ant project that builds a test case WAR, dummy JAAS LoginModule JAR and associated context descriptors.Created attachment 12762\nJAASRealm.java (whole file, not a diff)Created attachment 12763\nJAASCallbackHandler.java (whole file; not a diff)Created attachment 12764\nLocalStrings.properties (whole file; not a diff)Created attachment 12765\nJAASRealm.java (patch cf. tomcat 5.028 release)Created attachment 12766\nJAASCallbackHandler (patch cf. tomcat 5.028 release)Created attachment 12767\nLocalStrings.properties (patch cf. tomcat 5.028 release)I\'ve uploaded a small Ant project contains a series of test cases for the JAASRealm patches. The patches \nwere made against the source tree for Tomcat 5.0.28.\n\nFirst, a short explanation of what the patch itself is all about. As several observers have\nnoted, the current JAASRealm implementation doesn\'t actually deliver on all of the functionality\nit promises, particularly with respect to its ability to return Principals of user-specified\ntypes. In addition, the current implementation is limited by its inability to hash\npasswords. The patch fixes both of these issues.\n\nFiles that have been modified (relative to jakarta-tomcat-catalina/catalina/src/share):\norg/apache/catalina/realm/JAASRealm.java\norg/apache/catalina/realm/LocalStrings.properties\norg/apache/catalina/realm/JAASCallbackHandler.java\n\nSee the other attachments to this bug for the patch files, whole files, and test case tar file.\nPatch applied on both TOMCAT_5_0 and HEAD (Tomcat 5.5) branches.  Thanks for \ncontributing.It looks like the most recent commit of JAASRealm has a slight problem in it. \n\nThe whole-file version I submitted has these lines, starting at line 536:\n\n            if (userPrincipal == null && userClasses.contains(principalClass)) {\n                userPrincipal = principal;\n                if( log.isDebugEnabled() ) {\n                    log.debug(sm.getString(\"jaasRealm.userPrincipalSuccess\", principal.getName()));\n                }\n            }\n            if (roleClasses.contains(principalClass)) {\n                roles.add(principal);\n                if( log.isDebugEnabled() ) {\n                    log.debug(sm.getString(\"jaasRealm.rolePrincipalAdd\", principal.getName()));\n                }\n            }\n\nThe current file in HEAD looks like this (also starting at 536):\n\n            if (userPrincipal == null && userClasses.contains(principalClass)) {\n                userPrincipal = principal;\n                if( log.isDebugEnabled() ) {\n                    log.debug(sm.getString(\"jaasRealm.userPrincipalSuccess\", principal.getName()));\n                }\n            }\n\n            if (roleClasses.contains(principalClass)) {\n                roles.add(principal.getName());\n            }\n\n            if (roleClasses.contains(principalClass)) {\n                roles.add(principal);\n                if( log.isDebugEnabled() ) {\n                    log.debug(sm.getString(\"jaasRealm.rolePrincipalAdd\", principal.getName()));\n                }\n            }\n\nThe middle chunk of code (3 lines) shouldn\'t be there. It is adding a String to what is supposed to be a \ncollection of Principal objects. This is causing downstream calls to hasRole(Principal, String) to choke \nand die with a ClassCastException.\n\nThe patch file I submitted also has this middle chunk marked for removal (-), so I think this was just a \nmistake in the commit process.My mistake -- good catch.  Thank you for pointing it out.  I\'ve fixed it on \nboth HEAD and TOMCAT_5_0.',?,BUG
28633,'Add JMX Support to ClusterManager','Tomcat 5',Catalina:Cluster,fhanik,dev,'Add this todo, since it is bugChanging to an enhancement request, and updating version to latest (5.5.12) as\nit\'s also accurate for the latest Tomcat ;)  This issue is getting old ;)it is done...',?,RFE
28634,'Extend StandardManager/StandardSession for DeltaManager/DeltaSession','Tomcat 5',Catalina:Cluster,fhanik,dev,'just betterChanging to enhancement request and updating to latest version.This has been fixed in TC 6.0.x and TC 5.5.x in the \"ha\" module.',?,RFE
28674,'ArrayOutBoundException in CoyoteAdapter.normalize','Tomcat 5',Connector:Coyote,tfohrer,dev,'TestCase:\n  1. get tomcat 5 release -> tested cvs, 5.0.19\n  2. unpack and start it\n  3. telnet localhost 8080\n  4. enter \"GET /jsp-examples/.. HTTP/1.0\\n\\n\n  5. see exception in catalina.out/console\n\nStackTrace:\n\nSCHWERWIEGEND: An exception or error occurred in the container during the\nrequest processing\njava.lang.ArrayIndexOutOfBoundsException: 16\n        at org.apache.coyote.tomcat5.CoyoteAdapter.normalize(CoyoteAdapter.java:560)\n        at\norg.apache.coyote.tomcat5.CoyoteAdapter.postParseRequest(CoyoteAdapter.java:283)\n        at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:204)\n        at\norg.apache.coyote.http11.Http11Processor.process(Http11Processor.java:833)\n        at\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:732)\n        at\norg.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:619)\n        at\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:688)\n        at java.lang.Thread.run(Thread.java:536)\n\n\nJava Code from CoyoteAdapter:  \n\n        // If the URI ends with \"/.\" or \"/..\", then we append an extra \"/\"\n        // Note: It is possible to extend the URI by 1 without any side effect\n        // as the next character is a non-significant WS.\n        if (((end - start) > 2) && (b[end - 1] == (byte) \'.\')) {\n            if ((b[end - 2] == (byte) \'/\')\n                || ((b[end - 2] == (byte) \'.\')\n                    && (b[end - 3] == (byte) \'/\'))) {\n                b[end] = (byte) \'/\'; <-- Exception occurs here b.length <= end\n                end++;\n            }\n        }It does not always fail, so the issue is extremely minor.',?,BUG
28696,'Jsp:root has invalid attribute: xsi:schemaLocation','Tomcat 5',Jasper,gturner,dev,'It seems that Jasper is a bit strict about attributes on an XML JSP root\nelement.  Example JSP (same JSP causing stack trace listed below):\n\n  <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n  <!-- $Id$ -->\n  <jsp:root xmlns:jsp=\"http://java.sun.com/JSP/Page\"\n            version=\"2.0\"\n            xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n            xsi:schemaLocation=\"http://java.sun.com/JSP/Page\nhttp://java.sun.com/dtd/jspxml.xsd\">\n  </jsp:root>\n\nThese attributes seem to be perfectly valid, page 3-17 of the JSP 2.0\nspecification (also in http://java.sun.com/dtd/jspxml.xsd) has this annotation\nabout the root element:\n\n  <xsd:element name = \"root\">\n    <xsd:annotation>\n      <xsd:documentation>\n        The root element of all JSP documents is named root.\n        \n        Authors may, if they wish, include schema location information.\n        If specified, the information may appear as attributes of\n        the root element as follows:\n\n        xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n        xsi:schemaLocation=\"http://java.sun.com/JSP/Page xsd-file-location\"\n\n        Documents should not specify the system identifier of a DTD\n        in a DOCTYPE declaration.\n      </xsd:documentation>\n    </xsd:annotation>\n    ...\n\nThe reason I am using (or trying to use) XMLSchema-instance is that it seems to\nbe the only way to trigger Ant\'s xmlvalidate task to perform XML Schema\nvalidation (perhaps the only way to trigger Xerces to perform Schema validation,\nnot just xmlvalidate).  It\'s probably absurd for me to think that my build\nscripts will be able to validate real-world JSPs, but I\'m one of those pedantic\nsorts of people, I dream of the day that an IDE (emacs!) can resolve all XML\nnamespaces into schemas, possibly JSP tag libraries into schema-like metadata\n(perhaps a plug-in for Xerces) and hack away happily without having 5 browser\ntabs and 2 PDFs open jumping back and forth.\n\n\nFull stack trace:\n\n2004-04-29 13:34:36 StandardWrapperValve[jsp]: Servlet.service() for servlet jsp\nthrew exception\norg.apache.jasper.JasperException: /index.jspx(6,96) Jsp:root has invalid\nattribute: xsi:schemaLocation\n\tat\norg.apache.jasper.compiler.DefaultErrorHandler.jspError(DefaultErrorHandler.java:83)\n\tat org.apache.jasper.compiler.ErrorDispatcher.dispatch(ErrorDispatcher.java:402)\n\tat org.apache.jasper.compiler.ErrorDispatcher.jspError(ErrorDispatcher.java:236)\n\tat org.apache.jasper.compiler.JspUtil.checkAttributes(JspUtil.java:348)\n\tat org.apache.jasper.compiler.Validator$ValidateVisitor.visit(Validator.java:432)\n\tat org.apache.jasper.compiler.Node$JspRoot.accept(Node.java:554)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2180)\n\tat org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2230)\n\tat org.apache.jasper.compiler.Node$Visitor.visit(Node.java:2236)\n\tat org.apache.jasper.compiler.Node$Root.accept(Node.java:485)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2180)\n\tat org.apache.jasper.compiler.Validator.validate(Validator.java:1518)\n\tat org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:247)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:456)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:439)\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:553)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:291)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:301)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:248)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:284)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:204)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:257)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:567)\n\tat\norg.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:245)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:567)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:184)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:164)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:567)\n\tat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:156)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:578)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:567)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:206)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:833)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:732)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:619)\n\tat\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:688)\n\tat java.lang.Thread.run(Thread.java:534)\n\n\n\nIn case your\'re curious (or someone at Sun is looking), Sun has bugs with their\nJSP XML Schema, first off the one they\'ve copied into the JSP 2.0 spec is really\nthe 1.2 XSD.  They don\'t seem to have a JSP 2.0 XSD anywhere.  The 1.2 XSD is\nlocked into version=\"1.2\" (very easy to change when using a Catalog and a local\ncopy of the XSD).  Finally a regular expression in the XSD is broken (also easy\nto fix as Xerces reports it in plain english!).  Here\'s the output of xmlvalidate:\n\n  [xmlvalidate] /dtd/jspxml.xsd:238:42: InvalidRegex: Pattern value\n\'[A-Za-z0-9_-]*/[A-Za-z0-9_-]*(;\\s*(charset=)?[A-Za-z0-9_-]*)?\' is not a valid\nregular expression. The reported error was: \'\'-\' is an invalid character range.\nWrite \'\\-\'.\'.\n  [xmlvalidate] /dtd/jspxml.xsd:249:42: InvalidRegex: Pattern value\n\'[A-Za-z0-9_-]*/[A-Za-z0-9_-]*\' is not a valid regular expression. The reported\nerror was: \'\'-\' is an invalid character range. Write \'\\-\'.\'.\n  [xmlvalidate]\n/home/gturner/src/newedgenetworks/zhenghesrc/server/src/web/index.jspx:6:96:\ncvc-complex-type.3.1: Value \'2.0\' of attribute \'version\' of element \'jsp:root\'\nis not valid with respect to the corresponding attribute use. Attribute\n\'version\' has a fixed value of \'1.2\'.Fixed in CVS.\n\nBTW, can\'t locate the quote of the spec in page 3-17 of JSP 2.0 Final, though it\nis in http://java.sun.com/dtd/jspxml.xsd.\n\nI\'ll forward your comment about JSP XML schema to JSP spec leads.  Thanks.',?,BUG
28709,'javax.servlet.http.HttpServletRequest.isRequestedSessionIdValid() returns true for an invalidated session!','Tomcat 5',Catalina,blumm,dev,'This is the of the code sequence executed:\n\n  javax.servlet.http.HttpServletRequestWrapper.getSession(true);\n  // here, the debugger shows that the session is valid\n  javax.servlet.http.HttpSession.invalidate();\n  // here the debugger shows that the session has been invalidated\n  javax.servlet.http.HttpServletRequestWrapper.getRequest();\n  javax.servlet.http.HttpServletRequest.isRequestedSessionIdValid();\n  // this call returns true, which is not expected!Cool, let\'s start.\nI disagree with that, please try the latest release.Created attachment 11576\nTest webapplications for the reproduction of the problem described in the bug report.I still think there is a bug in Tomcat 5.x. BTW I wrote two test\nweb-applications, which will reproduce the problem for you. I have attached code   \nfor you. Please take a look at the readme for some instructions about\ninstallation and execution.\n\nHere some comments about the generell idea of the test:\n\nServlet 1 includes Servlet2 in a cross context environment. It gets a dispatcher\nby \"coServletContext.getRequestDispatcher(coServletPath)\".\nServlet2 gets a new session on the first request and invalidates this session by\n\"httpSession.invalidate()\" and tests the invalidation by\n\"httpServletRequestWrapper.isRequestedSessionIdValid()\" on the second request.\n\"isRequestedSessionIdValid()\" returns \"true\" instead of \"false\", which is a bug\n from my point of view.\n\nWhat do you think? Thank you in advance for your help.The Servlet Specification states (SRV.7.3) that the session is withint the \nscope of the servlet context and cannot be shared.  Accordingly I don\'t think \nthe semantics of invalidation and the isRequestedSessionIdValid call are clear \nwhen doing cross-context includes.\n\nLooking at the code, it should be fine.  From CoyoteRequest:\n/**\n     * Return <code>true</code> if the session identifier included in this\n     * request identifies a valid session.\n     */\n    public boolean isRequestedSessionIdValid() {\n\n        if (requestedSessionId == null)\n            return (false);\n        if (context == null)\n            return (false);\n        Manager manager = context.getManager();\n        if (manager == null)\n            return (false);\n        Session session = null;\n        try {\n            session = manager.findSession(requestedSessionId);\n        } catch (IOException e) {\n            session = null;\n        }\n        if ((session != null) && session.isValid())\n            return (true);\n        else\n            return (false);\n    }\n\nStandardSession#invalidate calls StandardSession#expire:\npublic void expire(boolean notify) {\n\n        // Mark this session as \"being expired\" if needed\n        if (expiring)\n            return;\n\n        synchronized (this) {\n\n            if (manager == null)\n                return;\n\n            expiring = true;\n        \n            // Notify interested application event listeners\n            // FIXME - Assumes we call listeners in reverse order\n            Context context = (Context) manager.getContainer();\n            Object listeners[] = context.getApplicationLifecycleListeners();\n            if (notify && (listeners != null)) {\n                HttpSessionEvent event =\n                    new HttpSessionEvent(getSession());\n                for (int i = 0; i < listeners.length; i++) {\n                    int j = (listeners.length - 1) - i;\n                    if (!(listeners[j] instanceof HttpSessionListener))\n                        continue;\n                    HttpSessionListener listener =\n                        (HttpSessionListener) listeners[j];\n                    try {\n                        fireContainerEvent(context,\n                                           \"beforeSessionDestroyed\",\n                                           listener);\n                        listener.sessionDestroyed(event);\n                        fireContainerEvent(context,\n                                           \"afterSessionDestroyed\",\n                                           listener);\n                    } catch (Throwable t) {\n                        try {\n                            fireContainerEvent(context,\n                                               \"afterSessionDestroyed\",\n                                               listener);\n                        } catch (Exception e) {\n                            ;\n                        }\n                        log(sm.getString(\"standardSession.sessionEvent\"), t);\n                    }\n                }\n            }\n            accessCount = 0;\n            setValid(false);\n\n            // Remove this session from our manager\'s active sessions\n            if (manager != null)\n                manager.remove(this);\n\n            // Notify interested session event listeners\n            if (notify) {\n                fireSessionEvent(Session.SESSION_DESTROYED_EVENT, null);\n            }\n\n            // We have completed expire of this session\n            expiring = false;\n\n            // Unbind any objects associated with this session\n            String keys[] = keys();\n            for (int i = 0; i < keys.length; i++)\n                removeAttributeInternal(keys[i], notify);\n\n        }\n\n    }\n\nBecause of the Manager#remove call, the findSession call in CoyoteRequest will \nreturn null, and the isRequestedSessionIdValid method will return false.The excerpts from the code base look fine for me too. What makes me wonder is\nthat if the test-web-application uses\n\"coServletContext.getNamedDispatcher(coServlet)\"\ninstead of\n\"coServletContext.getRequestDispatcher(coServletPath)\"\nthen everything works as expected. I think there must be a consistent behavior.\nDid you run the test code that I have provided with the attachments? Is the bug\nin test code? \n\n\n\n\n The request wrapper used by the regular RD doesn\'t override this method (while\nthe named RD won\'t wrap).\n\nNo matter how I look at this, the answer to this issue remains the same: sorry,\nbut we don\'t care about it.Ok, actually, my first sentence is a problem: not wrapping for named forwards\nwould mean trouble with cross context and session handling. That\'s a separate\nissue, but will explain the different session behavior in that case (you\'re\ngoing to interact with the session from the first context, which is a problem).\nThis is the only case, because named includes will wrap.SRV.7.3(from Version 2.4) says:\n...\nTo illustrate this requirement with an example: if a servlet uses the\nRequestDispatcher to call a servlet in another Web application, any sessions\ncreated for and visible to the servlet being called must be different from those\nvisible to the calling servlet.\n\nBy the way the spec. does not distinguish at this point between a named request\ndispatcher and a regular one.\n\nWhat do you exactly mean by saying \"you\'re going to interact with the session\nfrom the first context, which is a problem\" ? Does not the Spec. cover the\nrequest wrapper in an consistent manner with SRV.7.3 ?The issue affecting named dispatcher has been fixed (no wrapping was done\npreviously, so cross context sessions couldn\'t be handled properly). For the\nrest, we won\'t fix it for now.Fixed by implementing\norg.apache.catalina.core.ApplicationHttpRequest.isRequestedSessionIdValid() to\ncheck the request\'s session id (if any) against the session manager of the\ncontext associated with the ApplicationHttpRequest (wrapper), which may be\ndifferent from the context of the nested request (it will be different if the\nrequest was dispatched into a foreign context).Fixed by implementing\norg.apache.catalina.core.ApplicationHttpRequest.isRequestedSessionIdValid() to\ncheck the request\'s session id (if any) against the session manager of the\ncontext associated with the ApplicationHttpRequest (wrapper), which may be\ndifferent from the context of the nested request (it will be different if the\nrequest was dispatched into a foreign context).So this is stated as fixed...\n\nWhat file revision and tomcat release is the fix in?Fix went into revision 1.22 of\njakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/core/ApplicationHttpRequest.java,\nwhich was tagged with TOMCAT_5_5_6.',?,BUG
28840,'NPE when using an Iterator for items in a JSTL forEach tag','Tomcat 5',Jasper,mike,dev,'If you specify an object that is an Iterator for the \"items\" attribute of a JSTL forEach tag, you get a \nNullPointerException.\n\nThe class org.apache.jasper.tagplugins.jstl.ForEach needs to have the following code inserted at line \n140\n\nctxt.generateJavaSource(\"else if (\" + itemsV + \" instanceof Iterator)\");\nctxt.generateJavaSource(iterV + \"=(Iterator)\" + itemsV + \";\");\n\n(apologies for not attaching a real diff)Thanks for the patch, which I have applied.',?,BUG
28852,'failonerror attribute on Ant tasks','Tomcat 5',Catalina,sbailliez,dev,'failonerror boolean attribute on manager Ant tasks would be a nice have to \nallow for more flexible operation within Ant build files.\n\nI will attach a patch next week that also fixes unecessary CRs during response \nread/print and missing url encoding in some tasks.Created attachment 11484\nfailonerror attributeThe patch also includes a small refactoring of the validation inside a validate\n() method, read/display response correctly (previous CRs problems) and add url \nencoding where it was not existing.*** Bug 10225 has been marked as a duplicate of this bug. ***failonerror support and the CR issue had already been fixed.\nI have added the URL encoding where it was missing.\n\nThis has been fixed in 7.0.x for 7.0.10 onwards and has been proposed for 6.0.x and 5.5.x.\n\nChanging the version to 5.5.x since that is the earliest supported version affected by this issue.Fixed in 6.0.x and will be included in 6.0.33 onwards.Fixed in 5.5.x and will be included in 5.5.34 onwards.',?,BUILD_SYSTEM
28875,'Multi-byte characters in default error page aren\'t printed out correctly.','Tomcat 5',Catalina,super-creek,dev,'Hi, \n\nWhen working the latest Tomcat 5, any multi-byte characters in the default \nerror page using ErrorReportValve are not printed out correctly.\n\nAs a result of detail investigation, I found that an error report had \nbeen written to the writer of response which didn\'t applied the \nsuitable character encoding in ErrorReportValve.\n\nSo, I suggest a solution to ensure that every multi-byte character \nis normally printed out in this page, and send the following patch. \n\n\nIndex: jakarta-tomcat-\ncatalina/catalina/src/share/org/apache/catalina/valves/ErrorReportValve.java\n===================================================================\nRCS file: /home/cvspublic/jakarta-tomcat-\ncatalina/catalina/src/share/org/apache/catalina/valves/ErrorReportValve.java,v\nretrieving revision 1.16\ndiff -u -w -r1.16 ErrorReportValve.java\n--- jakarta-tomcat-\ncatalina/catalina/src/share/org/apache/catalina/valves/ErrorReportValve.java\n\t8 May 2004 22:33:22 -0000\t1.16\n+++ jakarta-tomcat-\ncatalina/catalina/src/share/org/apache/catalina/valves/ErrorReportValve.java\n\t10 May 2004 10:40:52 -0000\n@@ -308,19 +308,16 @@\n \n         try {\n \n-            Writer writer = response.getReporter();\n-\n-            if (writer != null) {\n-\n-                Locale locale = Locale.getDefault();\n-\n                 try {\n-                    hres.setContentType(\"text/html\");\n-                    hres.setLocale(locale);\n+                hres.setContentType(\"text/html; charset=utf-8\");\n                 } catch (Throwable t) {\n                     if (debug >= 1)\n                         log(\"status.setContentType\", t);\n                 }\n+\n+            Writer writer = response.getReporter();\n+\n+            if (writer != null) {\n \n                 // If writer is null, it\'s an indication that the response has\n                 // been hard committed already, which should never happen\n\n\nI hope that this patch will be applied before next release.\n\nRegards,Created attachment 11496\nThe proposed patch to fix this bug in ErrorReportValve.Created attachment 11497\nThe ErrorReportValve class file that applied the patch.Kan,\n\nI thought revision 1.11 of CoyoteResponse.java already fixed this issue.\n\nCVS log:\n\nrevision 1.11\ndate: 2004/01/20 19:39:00;  author: luehe;  state: Exp;  lines: +8 -5\nFix for Bugtraq 4655010: Method sendError() of class HttpServletResponse\n                         does not send multi byte data\n\nUse response encoding when generating error report, so that the following\ncode works as expected:\n\n      response.setCharacterEncoding(<charset>);\n      response.sendError(<errorCode>, <message>);\n\n\nHere are the diffs for that revision:\n\nIndex: CoyoteResponse.java\n===================================================================\nRCS file:\n/home/cvs/jakarta-tomcat-catalina/catalina/src/share/org/apache/coyote/tomcat5/CoyoteResponse.java,v\nretrieving revision 1.10\nretrieving revision 1.11\ndiff -u -r1.10 -r1.11\n--- CoyoteResponse.java 15 Oct 2003 18:47:49 -0000      1.10\n+++ CoyoteResponse.java 20 Jan 2004 19:39:00 -0000      1.11\n@@ -1,7 +1,7 @@\n /*\n- * $Header:\n/home/cvs/jakarta-tomcat-catalina/catalina/src/share/org/apache/coyote/tomcat5/CoyoteResponse.java,v\n1.10 2003/10/15 18:47:49 jfarcand Exp $\n- * $Revision: 1.10 $\n- * $Date: 2003/10/15 18:47:49 $\n+ * $Header:\n/home/cvs/jakarta-tomcat-catalina/catalina/src/share/org/apache/coyote/tomcat5/CoyoteResponse.java,v\n1.11 2004/01/20 19:39:00 luehe Exp $\n+ * $Revision: 1.11 $\n+ * $Date: 2004/01/20 19:39:00 $\n  *\n  * ====================================================================\n  *\n@@ -107,7 +107,7 @@\n  *\n  * @author Remy Maucherat\n  * @author Craig R. McClanahan\n- * @version $Revision: 1.10 $ $Date: 2003/10/15 18:47:49 $\n+ * @version $Revision: 1.11 $ $Date: 2004/01/20 19:39:00 $\n  */\n \n public class CoyoteResponse\n@@ -529,9 +529,12 @@\n      * unexpected exception thrown during the servlet processing\n      * (and only in that case), null will be returned if the response stream\n      * has already been used.\n+     *\n+     * @exception IOException if an input/output error occurs\n      */\n-    public PrintWriter getReporter() {\n+    public PrintWriter getReporter() throws IOException {\n         if (outputBuffer.isNew()) {\n+            outputBuffer.checkConverter();\n             return writer;\n         } else {\n             return null;\n\n\nDo you have any test case to prove that this is still an issue? If so, please\nattach.\n\nThanks,\n\nJanJan,\n\nI attach screenshot of a test case that returns HTTP 404 status simply.\nUntil my first proposed patch is applied, this issue always occurs.\n\n\nRegards,\nCreated attachment 11507\nA test case that returns HTTP 404 status simply, without the first patch.Created attachment 11508\nA test case that returns HTTP 404 status simply, with the first patch.This problem isn\'t yet solved in Tomcat 5.0.27 release.\n\nIt doesn\'t occur in 4.1.30 release, but always happens in 5.0.x release.\nAny multi-byte character is not correctly printed into response reporter, \nindependently of the response locale setting.\n\nTherefore, it is impossible to read every multi-byte error messages which is \ndisplayed in default error page.\n(And many Japanese users are in trouble very much.)\n\nAccording to current ErrorReportValve source code, I have re-written my first \nproposed patch (see the following diff code).\nPlease apply it.\n\nIndex: jakarta-tomcat-\ncatalina/catalina/src/share/org/apache/catalina/valves/ErrorReportValve.java\n===================================================================\nRCS file: /home/cvspublic/jakarta-tomcat-\ncatalina/catalina/src/share/org/apache/catalina/valves/ErrorReportValve.java,v\nretrieving revision 1.21\ndiff -u -w -r1.21 ErrorReportValve.java\n--- jakarta-tomcat-\ncatalina/catalina/src/share/org/apache/catalina/valves/ErrorReportValve.java\n\t27 Jun 2004 23:56:23 -0000\t1.21\n+++ jakarta-tomcat-\ncatalina/catalina/src/share/org/apache/catalina/valves/ErrorReportValve.java\n\t17 Jul 2004 20:59:20 -0000\n@@ -284,19 +284,17 @@\n \n         try {\n \n-            Writer writer = response.getReporter();\n-\n-            if (writer != null) {\n-\n-                Locale locale = Locale.getDefault();\n-\n                 try {\n                 \tresponse.setContentType(\"text/html\");\n-                \tresponse.setLocale(locale);\n+                response.setCharacterEncoding(\"utf-8\");\n                 } catch (Throwable t) {\n                     if (container.getLogger().isDebugEnabled())\n                         container.getLogger().debug(\"status.setContentType\", \nt);\n                 }\n+\n+            Writer writer = response.getReporter();\n+\n+            if (writer != null) {\n \n                 // If writer is null, it\'s an indication that the response has\n                 // been hard committed already, which should never happen\nCreated attachment 12178\nThe re-written patch to fix this problem in ErrorReportValve.I haven\'t been looking into this problem much and maybe I\'m wrong somewhat.\n\nRegarding the latest patch, I\'m wondering if there is any reason to drop setLocale()\nfrom that portion.\n\nInvocation of either setCharacterEncoding() or setContentType() that precedes setLocale()\nseems to prevent setLocale() from changing the character encoding for the request.Thanks, Moriyoshi.\n\nPondering carefully, the root cause is only that response.getReporter() \nmethod has been invoked before content type and locale setter methods of \nresponse are called.\nOnce the response.getReporter() method is invoked, the setLocale() method and \nthe setCharacterEncoding() method of the response will process nothing.\n\nTherefore, I think that so far my submitted patches are basically no wrong.\nWhen the response.getReporter() method is invoked after setting content type \nand \nappropriate character encoding into this response, this issue surely will be \nsolved.\n\n\nRegards,\n\nKan OgawaI\'ve applied the re-written patch.  I think it looks OK, but I haven\'t re-built \nand re-run your test cases yet.  If you could do that when you get a chance, \nthat\'d be great.  Thanks for contributing the patch.Yoav, \n\nI downloaded Tomcat 5 nightly distribution (2004-07-28 Build), and have proved \nthat this problem was fixed in Japanese language environment.\n\nThanks,\nKan OgawaGood, thanks for checking.  I\'m verifying this issue.*** Bug 30691 has been marked as a duplicate of this bug. ***',?,BUG
28905,'ChannelSocket fills stdout log with \"connection timeout reached\"','Tomcat 5',Connector:AJP,George.Lindholm,dev,'My stdout log file keeps filling up with:\n\nMay 11, 2004 5:33:21 AM org.apache.jk.common.ChannelSocket processConnection\nINFO: connection timeout reached\n\nThey may be useful while debugging, but in a production environment these\nmessages just hide real problems logged to stdout.\n\nApache 2.0.49.\n\n   GeorgeI think the answer is that you should upgrade to a very new JK, which includes\nkeepalive support. I think the report will be invalid as soon as JK 1.2.6 is out.I\'m using 1.4.2_04.\n\n\nThe problem is actually caused by the connectionTimeout value set in\nthe Connector definition (not quite intuative, but that\'s what debuggers\nare there for).\n\nI\'m setting it to connectionTimeout=\"0\"',?,OTHER
28910,'RUNNING.txt has wrong info for admin.xml and manager.xml (documentation)','Tomcat 5',Webapps:Documentation,flarg,dev,'$CATALINA_HOME/RUNNING.txt contains the following text:\n\n\"The administration and manager web applications, which are defined in the\n$CATALINA_BASE/webapps/admin.xml and $CATALINA_BASE/webapps/manager.xml files\"\n\n\"- Both web applications are disabled by removing\n$CATALINA_BASE/webapps/admin.xml and $CATALINA_BASE/webapps/manager.xml\"\n\nThe problem:\n\nmanager.xml and admin.xml do not actually live under either of those directories.\n\nInstead, they live in these directories:\n\n\% find $CATALINA_HOME -follow -name manager.xml -o -name admin.xml\n/devel/tomcat/conf/Catalina/localhost/admin.xml\n/devel/tomcat/conf/Catalina/localhost/manager.xml\n/devel/tomcat/server/webapps/admin/admin.xml\n/devel/tomcat/server/webapps/manager/manager.xml(adding a link to the document\nhttp://cvs.apache.org/viewcvs.cgi/jakarta-tomcat-5/RUNNING.txt?view=markup)Fixed. Thanks',?,DOCUMENTATION
28914,'add a thread pool property to set thread priority for tuning quality of service','Tomcat 5',Catalina,quartz12h,dev,'it is not possible to tune quality of http services (responsiveness)\nthrough thread priority.\nother threads in the web app are of various priority than the http connector and\nwe want the connector to be of a higher/lower priority.\n\n1-\nadd connector thread pool property to server.xml to set initial thread priority.\n\n2-\nadditionnally, we would like a tomcat public API (perfectly knowing that it is\nnot jsdk2.x), maybe jmx but that overkill, to vary connector\'s thread pool\nthreads priorities according to application specific knowledge.Quite frankly, thread priority is a big lie (at least from Java). Look at the\njavadocs.Euh.. No. Sorry.\n(suns statements in javadoc about thread are known to be very forgiving for JVM\nimplementors. Most if not all serious jvm have correct priorities.)\n\nThere are plenty of JVMs out there that do correctly implements priority.\nAnd thrust me, it works. Here are some examples.\nPlease verify by yourself.\n\n-screen updater toggles back and forth between prio 4 and 6. It help propmptness\nof drawing.\n\n-finalizer has low prio, for obvious reason. It does run seldomly, as expected\nin idle times.\n\n-SEDA architecture like sandstorm works great!\nI myself created a seda thread manager based on priority and load detection. It\nruns very nicely on sun, ibm, jrockit JVM, on both win32 and linux platform.\n\nBesides, I raise the tomcat connector threads in a dirty way: enumerate thread,\nmatch name with regex, and raise prio to 7 (because I use prio 1 to 6 for\nsandstorm).\n\nTrust me, it really balances stage & queue load and work well. And with that\ntomcat prio raised, my web UI is responsive and I keep the control.\n\nIn other systems, with jmx timer and with container sheduling\nJSR 236 titled \"Timer for Application Servers\"\nhttp://jcp.org/en/jsr/detail?id=236\nthread priority will become a serious concern.\n\nPlease consider this RFE with \"normal priority\" (hehehe!)Done.  Need minor help from Amy Roh or another admin webapp expert on the \nwriting of modified configuration, will post on tomcat-dev, but the code is \nthere and seems to be working.for cross-ref purpose: see bug #27616\nPriority not applied.\n\nRun tomcat in a debugger, like eclipse, pause processors/monitors threads,\nlook at first stackframe (thread run()), the variable \'this\' (the thread).\nlook at the priority field: still = 5 (normal prio) instead of prescribed value.\n\nExpected to see the monitor thread and the processors threads at priority 8 in\nthe case below.\n\n\t<Connector\n\t\tport=\"1026\"\n\t\tmaxThreads=\"15\"\n\t\tminSpareThreads=\"2\"\n\t\tmaxSpareThreads=\"5\"\n\t\tenableLookups=\"false\" \n\t\tacceptCount=\"100\"\n\t\tdebug=\"1\"\n\t\tconnectionTimeout=\"20000\"\n\t\tdisableUploadTimeout=\"true\"\n\t\tthreadPriority=\"8\"\n\t\tredirectPort=\"18443\"\n\t/>\n\n\nThr: d P=05 ALIVE  \"http-1026-Processor1\" \n(org.apache.tomcat.util.threads.ThreadWithAttributes)\n\nThr: d P=05 ALIVE  \"http-1026-Processor2\" \n(org.apache.tomcat.util.threads.ThreadWithAttributes)\n\nThr:   P=05 ALIVE  \"http-1026-Monitor\"against 5.0.27\nOoops, I forgot the actual Thread#setPriority call.  Sorry about that ;)  Fixed \nin both TOMCAT_5_0 and CVS HEAD branches.',?,RFE
28937,'No error message for jsp.variable.alias','Tomcat 5',Jasper,mark.roth,dev,'Missing error message for omitting the required alias attribute when specifying\na variable directive in a tag file when name-from-attribute is specified.Fixed by replacing \"jsp.variable.alias\" with \"jsp.error.variable.alias\", for\nwhich an error message exists.\n\nSame for \"jsp.variable.either.name\" and \"jsp.variable.both.name\", which have\nbeen changed to \"jsp.error.variable.either.name\" and\n\"jsp.error.variable.both.name\", respectively.',?,IMPROVEMENT
28940,'Deployer can\'t treat multi-byte characters in JSP correctly','Tomcat 5',Unknown,yamagu,dev,'When jakarta-tomcat-5.0.24-deployer compiles web application,\nany multi-byte characters in JSP are not printed out correctly.\n\nJava-source produced by jasper2-task is written in \"UTF-8\" encoding,\nso javac-task requires \'encoding=\"UTF-8\"\' attribute.\n\n$ diff -u -w build.xml.org build.xml\n--- build.xml.org       2004-05-13 10:59:32.510158400 +0900\n+++ build.xml   2004-05-13 11:00:21.580718400 +0900\n@@ -53,6 +53,7 @@\n            optimize=\"off\"\n            debug=\"on\" failonerror=\"false\"\n            srcdir=\"${webapp.path}/WEB-INF/classes\"\n+           encoding=\"UTF-8\"\n           excludes=\"**/*.smap\">\n       <classpath>\n         <fileset dir=\"${webapp.path}/WEB-INF/lib\">Please tell me which build.xml file you\'re referring to, and redo the diff, as \nI don\'t see similar code the those line numbers.  Thanks.I\'m sorry.\nThat build.xml is \"jakarta-tomcat-5/resources/deployer/build.xml\" 1.4 in CVS.OK, fixed.  Thank you for reporting this issue.',?,BUG
28943,'Wrong command (cd CURRENT_DIR) in startup.bat and catalina.bat','Tomcat 5',Unknown,thaiha,dev,'Adter unzipping jakarta-tomcat-5.0.24, I tried to run by clicking on \nstartup.bat from a command prompt window. A new window was opened and Tomcat \nran OK in that window. But in the first window, I see these lines:\n\n----------------\nD:\\programs\\jakarta-tomcat-5.0.24\\bin>startup\nThe system cannot find the path specified.\nUsing CATALINA_BASE:   D:\\programs\\jakarta-tomcat-5.0.24\nUsing CATALINA_HOME:   D:\\programs\\jakarta-tomcat-5.0.24\nUsing CATALINA_TMPDIR: D:\\programs\\jakarta-tomcat-5.0.24\\temp\nUsing JAVA_HOME:       D:\\programs\\j2sdk1.4.2\nD:\\programs\\jakarta-tomcat-5.0.24\\bin>\n-----------------\n\nAnd I found the error is because the below command in in startup.bat(16):\ncd CURRENT_DIR\n\nI also see there is another \"cd CURRENT_DIR\" in catalina.bat(46). I guess this \nis also wrong.Created attachment 11599\nModified startup.bat showing solution: \"cd \%CURRENT_DIR\%\"*** Bug 29111 has been marked as a duplicate of this bug. ***Patch applied as suggested: thanks.',?,BUG
28959,'IOException using CoyoteReader.readLine() but not using .read()','Tomcat 5',Connector:Coyote,jim,dev,'I get IOExceptions when I use CoyoteReader.readLine to read the request\'s \ninput if the request has many lines to it.  If I read the request using \nCoyoteReader.read(), it works fine.  The stack trace (from my bug test code) \nis below.  I\'ll attach a war file that demonstrates the bug, as well as source \ncode.\n\nI originally discovered this under 5.0.19, but thought it was caused by bug \n#27447.  That bug was reported fixed in 5.0.20, but that fix did not fix this \nproblem.\n\n2004-05-13 10:30:15 StandardWrapperValve[bugTest]: Servlet.service() for \nservlet bugTest threw exception\njava.io.IOException\n\tat org.apache.coyote.tomcat5.InputBuffer.reset(InputBuffer.java:440)\n\tat org.apache.coyote.tomcat5.CoyoteReader.reset(CoyoteReader.java:121)\n\tat org.apache.coyote.tomcat5.CoyoteReader.readLine\n(CoyoteReader.java:178)\n\tat jimpkg.BugTest.doPost(BugTest.java:45)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:717)I seem to be having trouble uploading attachments, so I\'ve posted the war file \nand the zip file at:\nhttp://www.netyourwork.com/download/bugtest.war\nand\nhttp://www.netyourwork.com/download/tomcat-5.0.24-bugtest.zip\n\nI\'ll try again to attach them later.Please also submit the client code to reproduce the problem, as this works for\nme right now.I\'m not sure what you mean by \"submit the client code to reproduce the problem\"\n- both the war file and the zip file include /bugtest.html, which is the browser\npage that explains how to reproduce the bug and has a form that invokes the\nfirst servlet.  The zip file also includes the source code for the two servlets.\n To invoke the page on my default install of Tomcat, I use\nhttp://localhost:8080/bugtest/bugtest.html.\n\nI\'ve tried several times to attach the zip file and the war file to this bug\nreport, but with no success.  Perhaps because I\'m behind a firewall and a router\nusing NAT?I need some data you send to the servlet, as well as how you send it (= the\ncleint code). I didn\'t look at bugtest.html (the servlet code seemed obvious,\nyou could have done while(r.readLine() != null)), and it does look enough. I\'ll\ntry it. It would have been more reliable using a custom program, of course.I\'m unable to have bugreport.html work, right now (it doesn\'t seem to generate\nanything).The html page was just to enable me to quickly try different combinations of\nline length and number of lines, since some combinations worked and some did\nnot.  If after trying the html you still can\'t reproduce it, I\'ll write a little\njava program that tries the various combinations.I\'m ok with using your html file, but right now it doesn\'t work for me. For\nexample, it accesses the BugTest1 servlet (which I think should work), and it\nalso seems to send empty lines.Ok, I got the thing to work. It seems like this doesn\'t work with Mozilla..The test worked ok on IE, and the issue is now fixed.',?,BUG
28971,'problems if root-context and application-context sets cookies','Tomcat 5',Catalina,mario,dev,'I am not sure if this is a new bug (i have used tomcat4 for now and the .24\nrelease is my first try to move to tomcat5).\n\nTomcat (now) sets two cookies - one for the root-context and one for the\napplication context - say (/opsjs).\n\nNow on every request two cookies are sent to tomcat - one session-id for the\nroot context and one for the application-context. But it looks like tomcat cant\nhandle this case - maybe only the first cookie is processed and this do not\nmatch to the cookie-list for the application-context (just an idea) - so a new\nsession is started and a new cookie sent to the browser.\n\nI have had to disable the cookies on the root context.\n<Context path=\"\" docBase=\"ROOT\" debug=\"0\" cookies=\"false\"/> \n\nThen the application works like expected - only one cookie is sent.\n\nThe definition of the application context is:\n<Context path=\"/opsjs\"\n        docBase=\"/u/opsj\"\n        crossContext=\"false\"\n        debug=\"0\"\n        reloadable=\"false\"\n        trusted=\"false\" >\n...\n\nSince another user experienced the same problem i decided to enter this (new)\nbehaviour as critical.This is now fixed.  Index: CoyoteAdapter.java\n  ===================================================================\n  RCS file:\n/home/cvs/jakarta-tomcat-catalina/catalina/src/share/org/apache/coyote/tomcat5/CoyoteAdapter.java,v\n  retrieving revision 1.25\n  retrieving revision 1.26\n  diff -u -r1.25 -r1.26\n  --- CoyoteAdapter.java\t28 Apr 2004 22:05:10 -0000\t1.25\n  +++ CoyoteAdapter.java\t14 May 2004 11:00:25 -0000\t1.26\n  @@ -295,6 +295,9 @@\n               return false;\n           }\n   \n  +        // Parse session Id\n  +        parseSessionCookiesId(req, request);\n  +\n           return true;\n       }\n   \n  @@ -352,6 +355,14 @@\n               request.setRequestedSessionId(null);\n               request.setRequestedSessionURL(false);\n           }\n  +\n  +    }\n  +\n  +\n  +    /**\n  +     * Parse session id in URL.\n  +     */\n  +    protected void parseSessionCookiesId(Request req, CoyoteRequest request) {\n   \n           // Parse session id from cookies\n           Cookies serverCookies = req.getCookies();\nCreated attachment 11548\nExtract the package in the Tomcat installation folderCreated attachment 11549\nExtract the package in the Tomcat installation folder (zip format)',?,BUG
28989,'startup-using-launcher.{sh,bat} fail on windows','Tomcat 5',Unknown,bloch,dev,'Do I need a specific version of ant?\nI am runing ant 1.5.1 and have my ANT_HOME pointing there.\n\nI see a jar in ant 1.6 that looks like it has this class defined.\n\n-Eric\n\n\n\% ./startup-using-launcher.sh \njava.lang.NoClassDefFoundError: org/apache/tools/ant/launch/AntMain\n        at java.lang.ClassLoader.defineClass0(Native Method)\n        at java.lang.ClassLoader.defineClass(ClassLoader.java:486)\n        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:111)\n        at java.net.URLClassLoader.defineClass(URLClassLoader.java:248)\n        at java.net.URLClassLoader.access$100(URLClassLoader.java:56)\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:195)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:188)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:297)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:253)\n        at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:313)\n        at org.apache.commons.launcher.Launcher.start(Launcher.java:385)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at LauncherBootstrap.main(LauncherBootstrap.java:185)Grabbing the ant-launcher.jar from $ANT_HOME/lib (where ant is 1.6.1)\nand plopping the jar in my jre/lib/ext to tests... and things work with the .sh\nscript... but the .bat script still fails... the latter I attribute to \nsome likely failure with pathnames that have spaces or somethin...\n\nEricAdded ant-launcher.jar to common/lib directory and to launcher.properties \nfile.  This was separated out from ant.jar in Ant 1.6.\n\nIf you still have a problem with the bat file, please post it specifically (and \nprobably in a separate bugzilla issue).\n\nThanks.',?,OTHER
29035,'wrong sessionId in EVT_SESSION_ACCESSED message','Tomcat 5',Catalina:Cluster,rainer.jung,dev,'Hi,\n\nin the cluster module in class session/DeltaManager there is a small buglet in\nline 799. When sending EVT_SESSION_ACCESSED from a primary node the message is\ncreated using the sessionId plus timestamp as a sessionId. This session will not\nbe found on the receiving side. Just seperate sessionId from uniqueId in the\nmessage creation like in line 788. The patch is:\n\natlas1\% diff session/DeltaManager.java session/DeltaManager.java_patch\n798a799\n>                                              sessionId,\n\nThe line numbers are the same in CVS HEAD and in 5.0.24. The patch applies to both.Fixed in 1.26 of session/DeltaManager. Expected to be included in TC 5.0.26.',?,IMPROVEMENT
29038,'HostConfig.deployWars() might not create context xml for auto-deployed .war files','Tomcat 5',Catalina,dev,dev,'When a war file ist autodeployed a context xml should be automatically created \nin the $CATALINA_BASE/<engine>/<host> directory. In \norg.apache.catalina.startup.HostConfig.deployWars() the line\n\nostream = new BufferedOutputStream(new FileOutputStream(xml), 1024);\n\ncan fail because the parent directories of xml might not exist. The exception \nis silently swallowed. \n\nSolution: add xml.mkdirs(); before that line.I added the mkdirs() call as you suggest.  There could possibly be a \npermissions setup where the server user has permission to write the xml file \nbut not permission to create directories, but we require the latter implicitly \nanyways, so I don\'t think this is a big deal.  Thanks.Hey,\n\nthis fix not work corret.\nwith xml.mkdirs you generate a dircetory at conf/<enginename>/<hostname>/myapps.xml/\n\nthis is wrong and currently we can\'t autodeploy a new war with META-INf/context.xml\n\n-- At my server the conf/<enginename>/<hostname> directory generated at startup\ntime. I think for new host this is not made.\n\nI have find a fix. Before extract the META-INF/context.xml we must\ncheck the configBase.\n\nregards\npeter\nCreated attachment 11942\nPatch for lost configBase before autodeploy META-INF/context.xml',?,BUG
29048,'Request changes to java permissions in DataSourceRealm','Tomcat 5',Catalina,sjdavies,dev,'My problem is this. I need to modify the DataSourceRealm so that failed login \nattempts are recorded and an account gets locked after a certain number of \nlogin failures.\n\nI want to subclass the DataSourceRealm but unfortunately some of the key \nmethods, authenticate(x3 params), open and close are declared private. The app \nis to be deployed at a commercial ISP so changing the DatSourceRealm class \ndirectly isn\'t a possibility. I intend to copy the class and make the \nappropriate changes as a sibling but it would have been preferable to just \noverride these methods.\n\nI would request that the permissions on useful methods in the \norg.apache.catalina.realm.DataSourceRealm be modified from private to protected \nto make future changes easier. I am more than happy to do these changes myself \nand send the modified class to you.You can achieve it the other (simpler, imho) way round. Provided that you have\nthe table containing user data (username, password) as well as its status (say\nlocked), All you have to do is to create a view selecting only unlocked account\ntable rows and make your DataSourceRealm use this view instead of the table. \n\nI see no point in bloating DSR with user-specific/app-specific functionality.As you say, providing a view will provide some of the required function without\ncode modification. The problem is that if the users fails authentication the\ncounter must be increased, if the users passes authentication the counter is\nzeroed. That may be possible in a view but I can\'t see how to do it.\n\nThis is not a request for user-specific code to be placed in DSR. It is simply\nan enhancement request to change method visibility from private to protected.\nThis will not \'bloat\' the code space.\n\nClasses are often used in ways the original designer did not cater for. In\nattempting to reuse the functionality of DSR through subclassing, problems were\nencountered. Because methods such as open, close & credentials were private they\nhad to be re-implemented in the subclass even though they were direct copies of\nthe superclass implementations. The authenticate(x2 params) method had to be\ncopied because it relied on the private authenticate(x3 params).\n\nChanging the visibility will mean that app-specific subclasses can simply\noverride authenticate(x3). Surely this level of reuse is desirable?I like this request, and we do want to encourage such extension, especially for \nsuch a good use-case.  Please send a diff patch against the class with your \ndesired changes.Made authenticate, open, and close methods protected instead of private.',?,DESIGN_DEFECT
29056,java.util.ConcurrentModificationException,'Tomcat 5',Catalina,petteri.stenius,dev,'I sometimes see ConcurrentModificationException during Tomcat startup.\n\nThis issue was previously reported as #22388 for TC 5.0.7. The issue was \nmarked as resolved! Any instructions how to work around this startup problem? \n\nTomcat was installed from jakarta-tomcat-5.0.24.zip, the host is running J2SE \n1.4.2_02.\n\n\nWARNING: Error registering contexts\njava.util.ConcurrentModificationException\n        at java.util.HashMap$HashIterator.nextEntry(HashMap.java:782)\n        at java.util.HashMap$EntryIterator.next(HashMap.java:824)\n        at java.util.HashMap.putAllForCreate(HashMap.java:424)\n        at java.util.HashMap.clone(HashMap.java:656)\n        at mx4j.server.DefaultMBeanRepository.clone\n(DefaultMBeanRepository.java:56)\n        at mx4j.server.MBeanServerImpl.findMBeansByPattern\n(MBeanServerImpl.java:1603)\n        at mx4j.server.MBeanServerImpl.queryObjectNames\n(MBeanServerImpl.java:1568)\n        at mx4j.server.MBeanServerImpl.queryMBeans(MBeanServerImpl.java:1512)\n        at org.apache.coyote.tomcat5.MapperListener.init\n(MapperListener.java:126)\n        at org.apache.coyote.tomcat5.CoyoteConnector.start\n(CoyoteConnector.java:1510)\n        at org.apache.catalina.core.StandardService.start\n(StandardService.java:485)\n        at org.apache.catalina.core.StandardServer.start\n(StandardServer.java:2298)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:556)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:284)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:422)This is an issue with the MX4J release we\'re using. Start TC again (it happens\nrarely, so it should be ok), or replace the MX4J impl with the Sun RI (which\ndoesn\'t have the issue and has been used for all previous 5.0.x stable releases,\nbut that we can\'t bundle anymore due to the new ASF licensing policies).\n\n*** This bug has been marked as a duplicate of 22388 ***I just upgraded to 5.0.24 and I\'m getting this every time I start the server.\n\nThe server config has 3 Services, each with an Engine. The first \nService/Engine has 3 Hosts, while the other two Service/Engine only have 1 \nHost each.\n\nThe first Service/Engine seems to start up correctly, while the second two \nfail.\n\nWill this be resolved in 5.0.25? Or is the only option for me changing to the \nSun RI?Please do not reopen the report. Please reread my answer, everything is there.\n\n*** This bug has been marked as a duplicate of 22388 ***Upon further investigation I found my config file (brought forward from TC4) \nwas explicitly referring to the connector class:\n\n<Connector  className=\"org.apache.coyote.tomcat4.CoyoteConnector\" ...>\n\nRemoving this has resolved the issue.This appears to be fixed by commenting out the entire \n<mbean name=\"CoyoteConnector\"> element in\n<TOMCAT_HOME>server\\classes\\org\\apache\\catalina\\mbeans.  As far as I can tell,\nit does not cause any new problems.My previous advice was wrong - that file is not included in default Tomcat\nbuilds (and bizarrely it only fixed the problem for a few days).  \nHowever, using Sun\'s RI definitely seems to fix it.\n1. Download JMX 1.2.1 Reference Implementation from\nhttp://java.sun.com/products/JavaManagement/download.html\n2. Extract jmxri.jar to overwrite the file <TOMCAT_HOME>/bin/jmx.jar \n\nThis has worked perfectly for me for like a week.\n\nBy the way, Jakarta should consider giving this a closer look.  This problem is\nNOT rare for me and my team, and the server must be restarted after it happens.\n It also makes me uncomfortable patching a \"final\" product.  I\'m on Tomcat 5.0.29.\nUsing 5.0.29\n\nI\'m having the same trouble, it\'s consistant and critical for a production\nsystem. Restarting Tomcat usually doesn\'t help, and I have to remove all the\nwebapps in all the virtual hosts before I can get the system back up.\n\nI\'ve just entered my details in a reopened bug (26752), but it looks like I\nadded to the wrong ticket (I\'ll close that one again).\n\nI\'ve reopened this bug as it\'s clearly not resolved, patching a release version\nof Tomcat (comment #9) is *not* resolution. If this is fixed in a later release,\nlet us know.Confirmed that comment #6 resolves the issue.\nWhat version of tomcat can we expect this fix included in?\nDownload the news mx4j 2.1.1 http://mx4j.sourceforge.net/\nand copy mx4j.jar to your catalina.home/bin. Then delete existing\njmx.jar and move mx4j.jar to jmx.jar.\n\nPeterPlease read what Remy said about distribution licenses, and Peter\'s latest \nMX4J suggestion.  5.0.30 includes a later MX4J I think, but 5.5.7 includes it \nfor sure, and either way it\'s an easy swap.',?,BUG
29100,'jsp2-example-taglib has invalid schemaLocation','Tomcat 5',Webapps:Examples,gael.stevens,dev,'jakarta-tomcat-5.0.24/webapps/jsp-examples/WEB-INF/jsp2/jsp2-example-taglib.tld\ncontains:\nxsi:schemaLocation=\"http://java.sun.com/xml/ns/j2ee web-jsptaglibrary_2_0.xsd\n\nNote the space between j2ee and web-jsptaglibrary_2_0.xsd. It should be a \nslash. This causes some containers to fail resolve the schema location.Fixed in CVS.  However, you suggested fix is wrong, though.  See Bug 26147 for\ndetails.',?,BUG
29108,'\"chunked\" transfer-encoding is not working','Tomcat 5',Connector:HTTP,mengtat,dev,'I am running Tomcat 5.0.24 on an IBM\'s z/os machine. IE fails to show most of \nmy jsp pages (Netscape works in this case). Note that all my jsp pages are \nusing UTF8 encoding and at least one jsp:include tag.\n\nAfter some investigation, I find out that \norg.apache.coyote.http11.filters.ChunkedOutputFilter.java is causing the \nproblem. It uses getBytes() without specifing any encoding to generate \nEND_CHUNK.\n\n\t\tEND_CHUNK.setBytes(endChunkValue.getBytes(), \n                               0, endChunkValue.length());\n\nIn my case, z/os uses EBCDIC to encode END_CHUNK. Since my jsp pages are using \nUTF8 encoding, IE fails to detech the \"last chunks\" of my jsp pages.Please suggest a code patch (preferably in a CVS or RCS diff file format).I\'ve patched Jean Frederic style. This should fix the issue.On what version was this fixed?(In reply to comment #3)\n> On what version was this fixed?\n\nIf you\'re too stupid to look it up, why should I tell you?  Now go away and \nquit waisting people\'s time.This community reserved the right to block users behaving improperly.\nPlease be respectful. Thanks.\n\nThis bug tracking system is the place to look into for getting the fixed release.\nClosed bugs must contain a fixed release comment or attribute.\n\nNot everyone has the knowledge to drill down hundred of files in CVS to look for\nsome unknown comment. Thanks you for your comprehension.\n(In reply to comment #5)\n> This bug tracking system is the place to look into for getting the fixed release.\nNo it isn\'t. The change log is the definitive source for matching bug fixes\nagainst releases.\n\n> Closed bugs must contain a fixed release comment or attribute.\nWhilst committers do endeavour to do this when they commit a fix, there is no\npolicy within the Tomcat project that states that this must occur.\n\n> Not everyone has the knowledge to drill down hundred of files in CVS to look for\n> some unknown comment. Thanks you for your comprehension.\nIt is not necessary to use the source repository (which, for the record, is now\nin SVN rather than CVS). Again, look at the change log. (Hint: look at the log\nfor 5.0.x rather than 5.5.x as this bug was fixed quite some time ago).',?,BUG
29133,'\"catalina.sh stop -force\" doesn\'t work','Tomcat 5',Catalina,George.Lindholm,dev,'Using the \"stop -force\" option with catalina.sh results in the command:\n\norg.apache.catalina.startup.Bootstrap -force stop\n\nwhich causes Bootstrap to complain since -force is not a valid option.\n\n    GeorgeCreated attachment 11619\nFix parameter parsing so \"stop -force\" will work (and add option to help text)Fixed as suggested.  Thanks.',?,BUG
29166,'Expect: 100-Continue fails after 401 Unauthorized','Tomcat 5',Connector:HTTP,chrisfloersch,dev,'A POST to a protected servlet using Expect: 100-continue results in a 401 \nUnauthorized return. If that same connection is held open and the POST is \nresubmitted again using the Expect: 100-continue along with appropriate \nAuthorization credentials the 100 Continue is never sent. Timing out on waiting \nfor the 100 Continue and sending the entity body anyways results in a 505 HTTP \nVersion Not Supported.\n\nIn the following senario I am not using a front end web server nor the jk2 \nconnector. I am using tomcat 5.0.16 with a basic HTTP Connector running as a \nservice on Windows2000 with the latest service packs. There are no reported \nerrors in the logs.\n\njava version \"1.4.1\"\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.4.1-b21)\nJava HotSpot(TM) Client VM (build 1.4.1-b21, mixed mode)\n\n\n** REQUEST **\nPOST /client/servlet/EchoExample HTTP/1.1\nHost: localhost:8000\nUser-Agent: NetLib/1.0\nAccept: text/html, text/xml, text/plain, image/gif, image/png, image/jpeg, */*\nAccept-Language: en-us\nAccept-Charset: ISO-8859-1;q=0.8, UTF-8;q=0.6, *;q=0.3\nContent-Type: multipart/form-data; \n\tboundary=\"----=_Part_0_27379847.1085374393407\"\nContent-Length: 727\nTE: gzip;q=0.8, deflate;q=0.2\nExpect: 100-continue\nConnection: keep-alive\nPragma: no-cache\nCache-Control: no-cache\n\n** RESPONSE **\nHTTP/1.1 401 Unauthorized\nWWW-Authenticate: Basic realm=\"Realm 1\"\nContent-Type: text/html;charset=ISO-8859-1\nContent-Language: en-US\nContent-Length: 911\nDate: Mon, 24 May 2004 04:53:18 GMT\nServer: Apache-Coyote/1.1\n\nbunch of stuff here.....\n\n\n** RE REQUEST **\nPOST /client/servlet/EchoExample HTTP/1.1\nHost: localhost:8000\nUser-Agent: NetLib/1.0\nAccept: text/html, text/xml, text/plain, image/gif, image/png, image/jpeg, */*\nAccept-Language: en-us\nAccept-Charset: ISO-8859-1;q=0.8, UTF-8;q=0.6, *;q=0.3\nAuthorization: Basic dG9tY2F0MTp0b21jYXQ=\nContent-Type: multipart/form-data; \n\tboundary=\"----=_Part_0_27379847.1085374393407\"\nContent-Length: 727\nTE: gzip;q=0.8, deflate;q=0.2\nExpect: 100-continue\nConnection: keep-alive\nPragma: no-cache\nCache-Control: no-cache\n\n\n<= THIS IS WHERE THE 100 Continue is never sent and my client code timeouts =>\n<= I attempt to send entity body anyway assuming HTTP/1.0 client as per RFC =>\n\n** FINAL RESULT **\nHTTP/1.1 505 HTTP Version Not Supported\nDate: Mon, 24 May 2004 04:53:25 GMT\nServer: Apache-Coyote/1.1\nConnection: close\n\n\n\nThe work around on the client is to close the connection and get a new \nconnection before retrying. Obviously this defeats the point of using the \nExpect: 100-continue in the first place.\n\nIt seems that the same senario without the intermediary 401 Unauthorized works \nwithout issue.\n\nAfter some testing I have found that as long as the Content-Length < 5 it seems \nto work properly. But if the Content-Length >= 5 it never returns 100 Continue.Created attachment 11638\nSimple test case.. Needs a protected (basic auth) servlet100s are optional anyway. BTW, putting comments which look like science fiction\ndoesn\'t help the credibility of your bug report.\nI also think the code which handles 100s to be obvious enough. I recommend you\nlook into this further.Ok, I\'ve looked at this. Your test case is not particularly helpful: a simple\ntelnet is a lot better.\nThe purpose of 100 is to avoid transferring the (large) request content.\nKeepalive in that case is a very small bonus, and Tomcat doesn\'t handle this yet.',?,OTHER
29174,'complain about liveDeploy tags and enhance documentation of deployOnStartup','Tomcat 5',Catalina,hauser,dev,'coming from 4.1.27, my server.xml had a 3 host tags with each an\nunpackWARs=\"false\" autoDeploy=\"false\" liveDeploy=\"false\" setting and each a .war\nfile. All war files in the same directory.\nWith 5.0.24, it started to deploy 3*3, i.e. 9 times instead of only 3 like before.\n\nIt appears that liveDeploy is not longer used and now called autoDeploy?\nIf so, shouldn\'t the server.xml parser complain about this unknown attribute?\n\nSimilarly, autoDeploy appears now to be deployOnStartup? If so, it might be\nuseful to add a note in this respect in the description box for each of the two!and now, even that I have deployOnStartup=\"false\" unpackWARs=\"false\"\nautoDeploy=\"false\" liveDeploy=\"false\"\nfor each Host element, it still seems to deploy on startup.sh .\nI assume the reason for this is that in the web.xml, I use the tag\n\"load-on-startup\" . If this is correct, I assume this should be mentioned as well!I think the documentation is good enough (and I really hate whines ...).Since there is no DTD for the server.xml as per the faq\nhttp://jakarta.apache.org/tomcat/faq/misc.html#dtd i.e. is there a way other\nthan going through the source code where I can see whether the \"liveDeploy\" is\nstill valid and what it would do under tomcat 5?\n\nhttp://www.onjava.com/pub/a/onjava/2004/01/28/tomcat5.html?page=last appears to\nsuggest that liveDeploy no longer exists, but then I would expect a stackdump\ncomplaining about this when doing bin/startup.shYou should adjust your expectations regarding the stack dump or complaints \nabout unknown elements when it comes to parsing tomcat\'s server.xml.  You won\'t \nget any such stack dumps or warning messages, because:\n- There\'s no DTD/schema to validate server.xml, as you noted, and\n- We use Digester to scan for predefined patterns and attributes only, so \nunknown ones are simply ignored\n\nIf you find the documentation insufficient, please provide patches that are \nactual diff files, rather than general complaints.  We will gladly evaluate and \napply them as needed.\n\nThe source code is easy to download, and you can grep it for \"liveDeploy\" \nor \"autoDeploy\" to see exactly what the relevant code does.  If something is in \nthe code, then it\'s in the docs.  If it\'s not in the docs, it\'s irrelevant in \nthe code.\nI\'m closing this issue based on personal communication with Mr. Hauser.  \n\nMy invitation to submit documentation enhancements, and my promise to review \nand commit them quickly into our repository and web site, still stands.  Your \ncontributions would be very welcome and highly appreciated.\n',?,IMPROVEMENT
29246,'Error in jakarta-tomcat-5/build.xml:28','Tomcat 5',Catalina,tomcat-bugzilla,dev,'CVS version 040527 15:00 CEST\n\njakarta-tomcat-5/build.xml:28: Element type \"property\" must be followed by\neither attribute specifications, \">\" or \"/>\".\n\n<property name=\"ant-launcher.jar       value=\"${ant.home}/lib/ant-launcher.jar\"/>\nmust be\n<property name=\"ant-launcher.jar\"       value=\"${ant.home}/lib/ant-launcher.jar\"/>\n\nant-launcher.jar are missing in apache-ant-1.5.4/lib works with apache-ant-1.6.1/libMy fault, I fixed it shortly after committing the buggy version, sorry.',?,BUG
29247,'Error building jakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/startup/DigesterFactory.java','Tomcat 5',Catalina,tomcat-bugzilla,dev,'[javac]\n/opt/itr/tomcat5src/jakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/startup/DigesterFactory.java:1:\nillegal character: \\65533\n    [javac] ???/*\n    [javac] ^\n    [javac]\n/opt/itr/tomcat5src/jakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/startup/DigesterFactory.java:1:\nillegal character: \\65533\n    [javac] ???/*\n    [javac]  ^\n    [javac]\n/opt/itr/tomcat5src/jakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/startup/DigesterFactory.java:1:\nillegal character: \\65533\n    [javac] ???/*\n    [javac]   ^\n    [javac]\n/opt/itr/tomcat5src/jakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/startup/DigesterFactory.java:35:\nduplicate class: DigesterFactory\n    [javac] public class DigesterFactory{\n    [javac]        ^\n    [javac]\n/opt/itr/tomcat5src/jakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/ant/ValidatorTask.java:27:\ncannot access org.apache.catalina.startup.DigesterFactory\n    [javac] bad class file:\n/opt/itr/tomcat5src/jakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/startup/DigesterFactory.java\n    [javac] file does not contain class org.apache.catalina.startup.DigesterFactory\n    [javac] Please remove or make sure it appears in the correct subdirectory of\nthe classpath.\n    [javac] import org.apache.catalina.startup.DigesterFactory;\n    [javac]                                    ^\n    [javac] 5 errorsSame time as the build.xml line 28, only stranger: I don\'t know how some \nreally strange characters got into the file header.  Anyways, I fixed it \nwithin a few minutes of committing the buggy version, sorry about that.',?,BUG
29339,'Reset of \"Catalina:type=GlobalRequestProcessor,name=jk-9009\" without reboot','Tomcat 5',Connector:AJP,tomcat-bugzilla,dev,'The JMX attributes from a JK Connector have some mysterious behavior over time. \nWithout restart tomcat or the connector the values in this mbean (requestCount)\ngrow but decrease after some time. They \"reset\" not to 0! I can offer a chart of\nthis behavior. A HTTP connector works well. I use TC5 cvs 040601\n\nThe problems with counting more than one JK connector and the JMX naming problem\nare solved with billbarker@apache.org patches to the cvs. Thank you.Created attachment 11759\nrequestCount over time. should be crow all the time. fallback to 0 are reboots.It seems that RequestGroupInfo only counts the Request objects that are still \nalive.  Since JK Requests don\'t live as long a HTTP Requests, it\'s easier to \nsee this problem with JK.  Created attachment 11768\nThe same for http connectors. This is was I expected for jk also.Fixed now in the CVS.',?,IMPROVEMENT
29368,'Replace xmlParserAPIs.jar with xml-apis.jar','Tomcat 5',Unknown,blair,dev,'The install instructions for xerces2-j indicate that xmlParserAPIs.jar has been \ndeprecated and replaced by xml-apis.jar (ref: http://xml.apache.org/xerces2-\nj/install.html).\n\nThis enhancement is to replace xmlParserAPIs.jar and all references to it with \nxml-apis.jar.OK, done.',?,CLEANUP
29387,'Null pointer exception in CoyoteRequest in parseCookies() method when cookie name is reserved word','Tomcat 5',Catalina,flopitaux,dev,'The problem arrives when Tomcat receive an HTTP request with one of the cookie\nhave reserved name like \"Path\".\n\nSo because one of the cookie name is reserved name, it\'s throw\nIllegalArgumentException but the problem is that log object is null.\n\ni guest that you was wanted to write just log method and not log.info.\n\nCoyoteRequest.java from line 2330 :\nfor (int i = 0; i < count; i++) {\n            ServerCookie scookie = serverCookies.getCookie(i);\n            System.out.println(\"scookie=\"+scookie);\n            try {\n                Cookie cookie = new Cookie(scookie.getName().toString(),\n                                           scookie.getValue().toString());\n                cookie.setPath(scookie.getPath().toString());\n                cookie.setVersion(scookie.getVersion());\n                String domain = scookie.getDomain().toString();\n                if (domain != null) {\n                    cookie.setDomain(scookie.getDomain().toString());\n                }\n                cookies[idx++] = cookie;\n            } catch(IllegalArgumentException e) {\n                log.info(\"Bad Cookie: Name: \" + scookie.getName() \n                         + \" Value: \" + scookie.getValue());\n            }\n\nException throws : \njava.lang.NullPointerException\n        at\norg.apache.coyote.tomcat5.CoyoteRequest.parseCookies(CoyoteRequest.java:2343)\n        at\norg.apache.coyote.tomcat5.CoyoteRequest.getCookies(CoyoteRequest.java:1850)\n        at\norg.apache.coyote.tomcat5.CoyoteRequestFacade.getCookies(CoyoteRequestFacade.java:418)The most reasonable is to remove the log statement.Fixed.*** Bug 29681 has been marked as a duplicate of this bug. ***',?,BUG
29389,'package mx4j never loaded by webappX classloader','Tomcat 5',Webapps:Documentation,seebass,dev,'It seems the classes from mx4j.* are never loaded by webappX classloader but by \nsystem classloader. This is not in accordance with the documentation (tomcat-5.\n0-doc/class-loader-howto.html) and furthermore makes it impossible to access \nmx4j-tools.jar without adding it to system classpath.\n\nMaybe the problem is caused by the fact, that javax.managment.* is (correctly) \nalways loaded by system classloader.\n\njava.lang.ClassNotFoundException: mx4j.tools.naming.NamingService\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:199)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:187)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:289)\n        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:274)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:235)\n        at mx4j.server.interceptor.InvokerMBeanServerInterceptor.\ninstantiate(InvokerMBeanServerInterceptor.java:93)\n        at mx4j.server.interceptor.DefaultMBeanServerInterceptor.\ninstantiate(DefaultMBeanServerInterceptor.java:108)\n        at mx4j.server.interceptor.SecurityMBeanServerInterceptor.\ninstantiate(SecurityMBeanServerInterceptor.java:67)\n        at mx4j.server.interceptor.DefaultMBeanServerInterceptor.\ninstantiate(DefaultMBeanServerInterceptor.java:108)\n        at mx4j.server.interceptor.DefaultMBeanServerInterceptor.\ninstantiate(DefaultMBeanServerInterceptor.java:108)\n        at mx4j.server.interceptor.ContextClassLoaderMBeanServerInterceptor.\ninstantiate(ContextClassLoaderMBeanServerInterceptor.java:90)\n        at mx4j.server.MBeanServerImpl.instantiateImpl(MBeanServerImpl.java:840)\n        at mx4j.server.MBeanServerImpl.createMBean(MBeanServerImpl.java:958)\n        at mx4j.server.MBeanServerImpl.createMBean(MBeanServerImpl.java:926)\n        at org.sape.carbon.services.jmx.server.mx4j.DefaultJrmpRemotingImpl.\nconfigure(DefaultJrmpRemotingImpl.java:132)\n        at org.sape.carbon.core.component.lifecycle.DefaultLifecycleInterceptor.\ncallComponentConfigure(DefaultLifecycleInterceptor.java:973)\n        at org.sape.carbon.core.component.lifecycle.DefaultLifecycleInterceptor.\nconfigureComponent(DefaultLifecycleInterceptor.java:469)We will not address this, and is not a bug.OK - as mx4j is the implementation of javax.managment I guess it is considered \nbeeing part of the apache tomcat server and therefore delegated by the webappX \nclassloader. => no bug\n\nMy wish: Please update the documentation:\n\nhttp://jakarta.apache.org/tomcat/tomcat-5.0-doc/class-loader-howto.html\n\n1. chapter classloader definitions\n\"jmx.jar - The JMX 1.2 implementation.\" must be placed under System (currently: \nCommon)\n\n2. \nOld:\n...in accordance with the recommendations in the Servlet Specification, version \n2.3, section 9.6... \n(this is the chapter Web Application Archive File)\nNew:\n...in accordance with the recommendations in the Servlet Specification, version \n2.3, section 9.7.2 Web Application Classloader ...\n\n\n3 (and most important). delegation according package pattern\nadd\n- mx4j.*\n\nThanks\n\nOK, done for items 1 and 2 on your list.  I didn\'t add 3 to the document \nbecause it\'s simply false.  The classloader how-to correctly and completely \nlists the packages that are delegated, as you can easily verify by looking at \nthe source for org.apache.catalina.loader.WebappClassLoader.java (the \npackageTriggers field).',?,DOCUMENTATION
29399,'Wrong MBean name for jk connector Tomcat 5 cvs and JDK 1.3.1','Tomcat 5',Connector:AJP,tomcat-bugzilla,dev,'Name: Catalina:type=ThreadPool,name=jk-0.0.0.0\%2F0.0.0.0-9009\n\nOK under JDK 1.4.2\nName: Catalina:type=ThreadPool,name=jk-9009Fixed now in the CVS.',?,BUG
29418,'Umlaut problems when precompiling jsp files','Tomcat 5',Jasper,hauser,dev,'now that precompile no longer fails as reported in Bug 29160, it seems that\nUmlauts such as ü are dealt with correctly when compiled by tomcat at runtime on\nthe fly, but not when precompiling. For example my German jsp\'s do contain lines\nsuch as\n<\%@ page language=\"java\" \%><\%@ taglib uri=\"/WEB-INF/lib/struts-template.tld\" pre\nfix=\"template\" \%>...\n<?xml version=\"1.0\" encoding=\"iso-8859-1\"?>\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.1//EN\"\n\"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd\">\n<html xmlns=\"http://www.w3.org/1999/xhtml\" xml:lang=\"de\">\n<html:xhtml />\n<head>\n...\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\" />\n\nis it possible that when precompiling from ant, it assumes the default UTF8?\n\nMight I have to 1. state the page encoding at the top of the page in a different\nway, or 2. try Jikes?Yes, JspC assumed default UTF-8.  A new javaEncoding attribute has been added \nto JspC and now your problem should be solved.  This will be available in the \n5.0.27 build.',?,RFE
29470,'GlobalResourcesLifecycleListener: Error message should be debug message','Tomcat 5',Catalina,rainer.jung,dev,'In\n\norg/apache/catalina/mbeans/GlobalResourcesLifecycleListener.java rev=1.4 \n\nin line 205 there is a wrong log level log.error(). This should be log.debug()\ninstead. The message only shows up, when debug is set to >=3, but the message\ntext says ERROR, although it is just an informational message. All similar\nmessages in GlobalResourcesLifecycleListener are with level debug. Example message:\n\n2004-06-09 17:58:33,133 (main)\norg.apache.catalina.mbeans.GlobalResourcesLifecycleListener/ERROR:   Creating\nRole MBean for role <role rolename=\"manager\"/>\n\nContext diff for suggested patch follows, thanks for considering.\n\n***************\n*** 202,208 ****\n          while (roles.hasNext()) {\n              Role role = (Role) roles.next();\n              if (debug >= 3) {\n!                 log.error(\"  Creating Role MBean for role \" + role);\n              }\n              if (MBeanUtils.createMBean(role) == null) {\n                  throw new IllegalArgumentException\n--- 202,208 ----\n          while (roles.hasNext()) {\n              Role role = (Role) roles.next();\n              if (debug >= 3) {\n!                 log.debug(\"Creating Role MBean for role \" + role);\n              }\n              if (MBeanUtils.createMBean(role) == null) {\n                  throw new IllegalArgumentExceptionFixed.',?,IMPROVEMENT
29472,'Embedded overrides add/remove Connector, but not findConnectors','Tomcat 5',Catalina,arieh.markel,dev,'The problem I am having relates to the Embedded class.\n\nIt centers around the problem that \'connectors\' is a private variable\nin the class, and there is no overriding of \'findConnectors\' (which\nis defined in StandardService).\n\nTherefore, findConnectors() on Embedded returns a value related to its\nsuperclass (StandardService) own (private) connectors[] variable, while\nthe class manages its own private list. \n\n-- \n\nA possible solution would be to:\n\n    - remove connectors private definition from Embedded\n    - make connectors in StandardService \'protected\'\n\n-- \n\nI understand that one would not expect to query connectors when using\nEmbedded. However, in the context I am using, I have variants that may\nuse either Embedded, or Catalina (or a modification of Catalina/Bootstrap\nthat I have developed).getConnectorNames() was suffering from the same problem.\n\nFixed by:\n\n- changing \"initialized\", \"connectors\", and \"container\" from private to\n  protected in StandardService,\n- removing \"connectors\" from Embedded,\n- leveraging StandardService\'s addConnector() and removeConnector() from\n  Embedded, and\n- storing the most recently added Engine in Embedded\'s \"container\" (so that it\n  is used when calling connector.setContainer() in\n  Standardservice.addConnector())\nFollowing Jan\'s comments and my inspection of the code of\nEmbedded and StandardService, it appears that there may still be several\nissues laying around that could be resolved by a refactoring of many\nof the methods.\n\nI believe that the Listener subscription logic is duplicated.\nIt should be possible for the subclasses (Embedded) not to override the\nvariables nor the code.\n\nThe debug (variable, setter, getter) appears to be duplicated as well.\nSo is the Lifecycle creation.\n\nAlso, the start() method on both appears to not share the same activities\nhappening. Worthwhile to consider Embedded to invoke appropriately\nsuper.start().\n\nSimilarly for stop().',?,DESIGN_DEFECT
29478,'problem with JSPC and useBean and static initialization','Tomcat 5',Jasper,jgrannis,dev,'We have a form bean that does some static initialization which references some\nclasses which only work if the system is actually running.  For some reason,\nthough, when jspc is processing the useBean tag referring to this bean, it tries\nto instantiate the bean, which fails b/c, of course, it is not doing so in the\ncontext of a running system, but is doing so while building.  We did not have\nthis problem with jasper 1, but we do in jasper 2.  Also, fyi, we have tomcat\n5.0.26 (least, that\'s what it says on system startup) but that wasn\'t an option\nin the version box.  Here\'s the tag from the jsp:\n\n<jsp:useBean id=\"MaintainProductForm\"\nclass=\"com.fuelquest.products.web.MaintainProductForm\" scope=\"request\"/>\n\nhere\'s the jspc output, including the stack trace:\n\njspc:\n     [java] log4j:WARN No appenders could be found for logger\n(org.apache.jasper.compiler.JspRuntimeContext).\n     [java] log4j:WARN Please initialize the log4j system properly.\n     [java] java.lang.NoClassDefFoundError\n     [java]     at\ncom.fuelquest.relationships.AbstractRelationshipTypeProvider.getRelationshipType(AbstractRelationshipTypeProvider.java:71)\n     [java]     at\ncom.fuelquest.products.ProductRelationshipTypes.getProductFtaRelationshipType(ProductRelationshipTypes.java:71)\n     [java]     at\ncom.fuelquest.products.web.MaintainProductForm.<clinit>(MaintainProductForm.java:76)\n     [java]     at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native\nMethod)\n     [java]     at\nsun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)\n     [java]     at\nsun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)\n     [java]     at java.lang.reflect.Constructor.newInstance(Constructor.java:274)\n     [java]     at java.lang.Class.newInstance0(Class.java:308)\n     [java]     at java.lang.Class.newInstance(Class.java:261)\n     [java]     at\norg.apache.jasper.compiler.Generator$GenerateVisitor.visit(Generator.java:1212)\n     [java]     at org.apache.jasper.compiler.Node$UseBean.accept(Node.java:1116)\n     [java]     at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2163)\n     [java]     at org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2213)\n     [java]     at org.apache.jasper.compiler.Node$Visitor.visit(Node.java:2219)\n     [java]     at org.apache.jasper.compiler.Node$Root.accept(Node.java:456)\n     [java]     at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2163)\n     [java]     at\norg.apache.jasper.compiler.Generator.generate(Generator.java:3261)\n     [java]     at\norg.apache.jasper.compiler.Compiler.generateJava(Compiler.java:244)\n     [java]     at org.apache.jasper.compiler.Compiler.compile(Compiler.java:470)\n     [java]     at org.apache.jasper.JspC.processFile(JspC.java:776)\n     [java]     at org.apache.jasper.JspC.execute(JspC.java:905)\n     [java]     at org.apache.jasper.JspC.main(JspC.java:195)\n     [java] Exception in thread \"main\" \n\n     [java] Java Result: 1\n\nWe can probably code around this problem, but it does seem a bit \"odd\", to say\nthe least, that jasper would be instantiating classes and form beans in order to\ngenerate java code....it seems like it could learn everything it needs to by\ninspecting the Class without needing to actually create an instance.  I\'m not\nreally defending the static initialization that takes place in the class, it\nwasn\'t really my idea, but it really shouldn\'t matter to jasper one way or the\nother.The call to newInstance is guarded by a try/catch, so its failure should not\ncause the compilation to be aborted.  Please attach a test case.went and looked at the try-catch block.  You are trapping Exception. \nNoClassDefFoundError is not an Exception, it\'s an Error.  You should consider\ntrapping Throwable instead, if you want to guarantee the newInstance will not\ncause compilation to fail.Fixed in CVS.  Bean instantiations are now avoided at compilation time.',?,BUG
29521,'No destroy methods called on service shutdown','Tomcat 5',Native:Integration,johan.philippe,dev,'If the Tomcat server is stopped using shutdown.bat, then the shutdown sequence\nis completed without any problems and the appropriate destroy methods of the\nservlets and contextDestroyed methods of the ContextListener are called.\n\nIf the same server instance is stopped using either:\n- the Apache Monitor task icon\n- the Windows Services panel\n- the command net stop \"Apache Tomcat\"\n\nThen these destroy methods do not get called and the server is just \"killed\".\n\nUsing: \nJava 1.4.2_04\nStandard configuration and example applicationsI don\'t think so: are you absolutely certain that is the case ?\nPlease don\'t get abused by the fact commons-logging may be stopping logging stuff.You are probaly trying to \"kill\" the Tomcat using Task Manager.\nSeems to me that the Task Manager gives you a warning that the application is\ngoing to be shut down \'abnormarly\', and gives you a proper warning:\n\n\"The process will not be given the chance to save its state or data before it is\nterminated.\"I am absolutely sure.\nIn the destroy methods, I have added code that generates output, no matter what.\nThis includes\n- the standard system.out / system.err usage\n- create a file with a timestamp\n- updating my configuration storage file (what I need)\n\nAnd no, there is no KILL involved.\nI ask for a nice and clean shutdown using the Stop Service.\nBut still it behaves as if it had been killed.\n\nI\'ve verified what the user is reporting.  It seems that the service stop only \npauses the connector and doesn\'t completely shutdown things.  Neither the \nexample\'s app listeners nor my own test ones get the contextDestroyed method.BTW, my tests are with 5.0.26, on Win 2K, JDK 1.4.2_04.I\'m raising the priority on this run: it\'s bad if we can\'t properly stop the \nwindows service.I would like to close that bug.\n\nThere has been some work on procrun recently that surely\naddress those issues. Can anyone test if this is the case with\nthe latest distribution, or at least provide a simple test case\n(in java please :).\nI tested on Win 2k Server with j2sdk1.4.2_05\nFrom:\n   -The windows service manager\n   -net stop / net start\n   -The start menu tools\n\nIn all 3 cases the destroy methods of the servlet and the contextListener were\ncalled.\n\nAttaching a test war file and a stdout.log file.Created attachment 13154\nWar fileCreated attachment 13155\noutput from testOh, test was with 5.0.29.OK, I\'ve repeated the tests, it works fine.  So use 5.0.29 or later, you should \nbe OK.Have verified the status with the original configuration and this problem is\nindeed fixed when using 5.0.29 beta\n\nThanks*** Bug 31239 has been marked as a duplicate of this bug. ****** Bug 38010 has been marked as a duplicate of this bug. ***',?,BUG
29561,'NullPointerException in Compiler.java:547','Tomcat 5',Jasper,no.spam.lkral,dev,'When executing JSPC through an Ant target I receive the following stack trace:\n\njspc:\n     [java] java.lang.NullPointerException\n     [java]     at org.apache.jasper.compiler.Compiler.isOutDated\n(Compiler.java:547)\n     [java]     at org.apache.jasper.JspC.processFile(JspC.java:775)\n     [java]     at org.apache.jasper.JspC.execute(JspC.java:905)\n     [java]     at org.apache.jasper.JspC.main(JspC.java:195)\n     [java] org.apache.jasper.JasperException\n\nI think the missing check for (jsw==null) starts at line 560 .\n\nTested with: Tomcat 5.0.26Please attach test case, including build.xmlCreated attachment 11851\na simple test caseFixed, problem occurred only if servlet class already existed.\nThanks for reporting the issue!',?,BUG
29584,'JNDI documentation could be more clear','Tomcat 5',Unknown,bim2003,dev,'The JNDI documentation is not entirely clear as to the number of JNDI contexts \nand their relationship. I am reading the page entitled, \"JNDI Resources HOW-TO\".\n\nThe top of the page states that each web app receives a unique initial context. \nSo far, so good.\n\nThen, under \'Configuring JNDI Resources\', the explanation talks about elements \nthat live inside either <Context> or <DefaultContext> in server.xml. \n\nFirst clarification: Since <Context> elements are frequently created in \nseparate files in the Catalina directory, this text should reference those \nfiles.\n\nSecond clarification issue: the page \'globalresources.html\' explicitly states \nthat <Environment/> elements in the GlobalNamingResources propagate \nautomatically into each web application. To me, that implied that the other \nresources defined in GlobalNamingResources would also propagate. They don\'t, at \nleast in the \'custom factory\' case. Under \'Resource Definitions\', the text says \nthat you can declare the characteristics of resource-env-ref\'s for a web.xml in \nthe GlobalNamingResources. This may be true of the standard factories, but it \nis NOT true for custom factories. Unless that\'s deemed to be a defect, this \ntext should state, explicitly, that custom factories require a ResourceLink \nelement to make them available in the per-web-application InitialContext.\n\nBack to the JNDI howto.  \n\nThird clarification:\n\nThe initial reference to <ResourceLink> mentions the global JNDI context \nwithout referencing the GlobalNamingResources link. The terminology here is not \nquite consistent with the definition of \'Global Resources\' below. It would be \nclearer to include an href to GlobalNamingResources in the <ResourceLink> \nbullet, since ResourceLink is (I think) only useful for GlobalNamingResources.\n\nFourth clarification: Under \'Adding Custom Resource Factories\', the reference \nto conf/server.xml should be more specific. It should state that you have three \nchoices: <Context>, <DefaultContext>, or <GlobalNamingResources> with a \n<ResourceLink> to make it available in Context or DefaultContext. Possibly, the \nsame clarification is apropos for the standard resource factories, though the \nspecial cases for them in the source might render it unnecessary.Great.  Next, please submit documentation patches for these pages containing \nthe text you\'d like to see in them.I\'ll treat your comment as indicating that you have decided that the current \nbehavior is entirely intended :-).\n\nCan I prepare patches from 5.0.25, or do I have to get set up for CVS?\nNo, it\'s by design, but the docs could be better.  You can do patches from \n5.0.25 but CVS head is preferable.  CVS directions are at \nhttp://www.apache.org/dev/contributors.html#cvsbasics.\nCreated attachment 11884\nProposed doc improvementCreated attachment 11885\nclarifications to globalresources.htmlHere are the proposed changes.\n\nNote that in the second patch I made use of the <![CDATA[ ]]> construct\nto save myself all those &lt; and &gt; blots.Each of the attachments has errors. I\'m posting fixed ones, now that I\'ve been \nable to build and test them.Created attachment 11887\nFIXED patch to globalresource.sxmlCreated attachment 11888\nFIXED patch to jndi howto.Fixed patches applied.  Thank you for your contribution.',?,DOCUMENTATION
29597,'JspC has javaEncoding hard coded to UTF-8','Tomcat 5',Jasper,julien,dev,'The Java Encoding is hard coded to UTF-8, when running JspC from the command line. \n\nBug 19622 concerned the Ant task (which now understands the javaEncoding\nparameter), this one is quite similar.\n\nI would like a new switch, so that another encoding can be selected when\nlaunching from the command line.\n\nFor example :\n<java classname=\"org.apache.jasper.JspC\"\n              fork=\"true\"\n              failonerror=\"true\"\n              classpathref=\"jasper.classpath\">\n              \n              (...)\n              <arg value=\"-javaEncoding\"/>\n              <arg value=\"ISO-8859-1\"/>\n              (...)\n</java>\n\nI am ready to write and submit a patch. Contact me at http://www.julien-dubois.com.\n\nJulien Dubois.OK, done.',?,IMPROVEMENT
29661,'Host Names parsing is case sensitive','Tomcat 5',Unknown,francois.jeanmougin,dev,'Virtual Hosts is managed by the Host: header in HTTP1.x queries. Recent wap \nterminals do not lower case the host name. Host name parsed by (I assume) the \nCoyote connector is used as is (with potential upper character). RFC2616 says \nthat the Host header should be treated case insensitive (see section 3.2.3).\n\nWell, it is not really obvious because it talks about clients, I assume that a \nserver should treat a Host: header case-insensitively. Because it can leads to \nbroken connections, or unwanted 400 errors, I tag it as critical.\n\nThank you for al your work,\n\nFrançois.Sorry, I am not convinced: please find something which discusses the Host\nheader, and try to provide a patch.Create a Host entry like this :\n\n<Host name=www.toto.com ...>\nAdd a context here\n</Host>\n\nTest it with a simple telnet or netcat :\nnc yourhost:80 < EOT\nGET /index.jsp HTTP/1.1\nHost:www.toto.com \n\n\n\nEOT\n(Be carefull to add a double <CR>)\nYou will got your page. Now, do :\nnc yourhost:80 < EOT\nGET /index.jsp HTTP/1.1\nHost:WWW.toto.com \n\n\n\nEOT\nYou will have a 400 (invalid request) error.\n\nI can try to llok at the code and provide a patch but I never tried to read \ntomcat sources. If you can point me in which part of the code this is done, I \ncan try to read it.\n\nAs far as I know, it is NOT a invalid \"bug\" :), even if you could consider it \nas a misfeature. In fact, most of the good\'all navigators do it for the user, \nit is clearly a wap (bad) terminal problem.\n\nFrançois.Fixed in the CVS, and should appear in 5.0.28.',?,IMPROVEMENT
29688,'HostConfig NullPointerException','Tomcat 5',Catalina,sd,dev,'The following Exception was thrown:\n\njava.lang.NullPointerException\n        at org.apache.catalina.startup.HostConfig.deployDescriptors\n(HostConfig.java:490)    \n\nA first analyse of source code:\n\n    protected void deployDescriptors(File configBase, String[] files)\n\nthe \"files[]\" parameter might be null, but is not tested on null in body of \nmethod. The calling functions also don\'t check for a null array. Simple \nsolution would be:\n\nuse:\n\n    protected void deployDescriptors(File configBase, String[] files) {\n\n        if (!deployXML || files==null)\n           return;\n        [...]\n\ninstead of:\n\n    protected void deployDescriptors(File configBase, String[] files) {\n\n        if (!deployXML)\n           return;\n        [...]\n\nIn all cases i found the calling methods use the File.list() mtehod to create \narray without check, but according to J2SE API Doc \"null\" is allowed as return \nvalue of \"list()\", so a check might make sense.After taking a deeper look into source code, there are several more points \nwhere the files list is not checked against null values.\nThe NPE is actually blocking the whole Tomcat, because of infinite number of \nexceptions (s. log). So could someone please commit the patch I provided \nearlier. It\'s just simple null value checking.\n\nThanks,\n Sascha\n\nfrom LOG:\n\n25.06.2004 10:06:58 \norg.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor \nprocessChildren\nSCHWERWIEGEND: Exception invoking periodic operation:\njava.lang.NullPointerException\n        at org.apache.catalina.startup.HostConfig.deployDescriptors\n(HostConfig.java:445)\n        at org.apache.catalina.startup.HostConfig.deployApps\n(HostConfig.java:427)\n        at org.apache.catalina.startup.HostConfig.check(HostConfig.java:1064)\n        at org.apache.catalina.startup.HostConfig.lifecycleEvent\n(HostConfig.java:327)\n        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent\n(LifecycleSupport.java:119)\n        at org.apache.catalina.core.StandardHost.backgroundProcess\n(StandardHost.java:800)\n        at \norg.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChild\nren(ContainerBase.java:1619)\n        at \norg.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChild\nren(ContainerBase.java:1628)\n        at \norg.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run\n(ContainerBase.java:1608)\n        at java.lang.Thread.run(Thread.java:534)\n25.06.2004 10:06:58 \norg.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor \nprocessChildren\nSCHWERWIEGEND: Exception invoking periodic operation:\njava.lang.NullPointerException\n        at org.apache.catalina.startup.HostConfig.deployDescriptors\n(HostConfig.java:445)\n        at org.apache.catalina.startup.HostConfig.deployApps\n(HostConfig.java:427)\n        at org.apache.catalina.startup.HostConfig.check(HostConfig.java:1064)\n        at org.apache.catalina.startup.HostConfig.lifecycleEvent\n(HostConfig.java:327)\n        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent\n(LifecycleSupport.java:119)\n        at org.apache.catalina.core.StandardHost.backgroundProcess\n(StandardHost.java:800)\n        at \norg.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChild\nren(ContainerBase.java:1619)\n        at \norg.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChild\nren(ContainerBase.java:1628)\n        at \norg.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run\n(ContainerBase.java:1608)\n        at java.lang.Thread.run(Thread.java:534)\n25.06.2004 10:06:58 \norg.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor \nprocessChildren\nSCHWERWIEGEND: Exception invoking periodic operation:\njava.lang.NullPointerException\n        at org.apache.catalina.startup.HostConfig.deployDescriptors\n(HostConfig.java:445)\n        at org.apache.catalina.startup.HostConfig.deployApps\n(HostConfig.java:427)\n        at org.apache.catalina.startup.HostConfig.check(HostConfig.java:1064)\n        at org.apache.catalina.startup.HostConfig.lifecycleEvent\n(HostConfig.java:327)\n        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent\n(LifecycleSupport.java:119)\n        at org.apache.catalina.core.StandardHost.backgroundProcess\n(StandardHost.java:800)\n        at \norg.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChild\nren(ContainerBase.java:1619)\n        at \norg.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChild\nren(ContainerBase.java:1628)\n        at \norg.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run\n(ContainerBase.java:1608)\n        at java.lang.Thread.run(Thread.java:534)\niHey,\n\nI have made a patch to fix some NPE risks.\n\nalso this patch include the xml.mkdir fix.\nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=29038\n\nregards\npeterCreated attachment 11947\nHostConfigAs mentioned before the NPE is blocking the tomcat, it\'s even impossible to \nshut down the server:\n\nCatalina.stop: java.net.SocketException: Broken pipe\njava.net.SocketException: Broken pipe\n        at java.net.SocketOutputStream.socketWrite0(Native Method)\n        at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)\n        at java.net.SocketOutputStream.write(SocketOutputStream.java:115)\n        at org.apache.catalina.startup.Catalina.stopServer(Catalina.java:414)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.stopServer(Bootstrap.java:333)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:424)\n\nThe server shuts down normally if the NPE is not in the log-file, whenever the \nNPE is in the logs, the shutdown script failed with above exception (no need to \ntell me something about killing processes). I would really appreciate if the \npatch could be applied and committed.  Any reason why this didn\'t happen ? If \nthere are any concerns, could you please tell me ?\n\n-SaschaHey,\n\nhere my HostConfig.class.\n\ncopy to server/classes/org/apache/catalina/startup\n\nregards\npeterCreated attachment 12026\nHostConfig with NPE und XML.mkdirs Patch*** Bug 30331 has been marked as a duplicate of this bug. ****** Bug 30249 has been marked as a duplicate of this bug. ****** Bug 30462 has been marked as a duplicate of this bug. ***Patch applied in TOMCAT_5_0 branch as suggested here.  Modified portions \napplied on CVS HEAD as HostConfig on HEAD has already been significantly \nmodified for Tomcat 5.5.*** Bug 30899 has been marked as a duplicate of this bug. ***',?,BUG
29727,'JNDI env-entry not reload when context reloaded','Tomcat 5',Catalina,rengels,dev,'If environment entries are changed in web.xml, and the application context is \nrestarted, the values in the JNDI context are the old values.\n\nIf the environment entries are changed via the Tomcat \'admin\' interface, then \nthe values provided to the context are correct.\n\nThe following code is can be used to check the environment:\n\n        try {\n            InitialContext ic = new InitialContext();\n            NamingEnumeration enum = ic.listBindings(\"java:comp/env\");\n\n            while (enum.hasMore()) {\n                Binding binding = (Binding) enum.next();\n                jndi.setProperty(binding.getName(), \"\" + binding.getObject());\n                System.out.println(\"jndi setting: \" + binding.getName() + \"=\" \n+ binding.getObject());\n            }\n        } catch (NamingException e) {\n            System.err.println(\"unable to read JNDI settings, \" + e);\n        }\n\n\nThe web.xml fragment looks as follows:\n\n\t<env-entry>\n\t\t<env-entry-name>DatabaseURL</env-entry-name>\n\t\t<env-entry-value>jdbc:hsqldb:hsql://localhost</env-entry-value>\n\t\t<env-entry-type>java.lang.String</env-entry-type>\n\t</env-entry>The JNDI context is discarded between restarts, so I doubt that this is the\ncase. I recommend you investigate the issue further.as I said, the application works correctly (i.e. the new value is picked up) \nwhen the environment value is changed via the Tomcat Admin interface, but does \nnot work when the value is changed by manually editting the web.xml and \nstop/start the application.\n\nSo how can this be an application level problem?\n\nThe only thing I can thing of is that it is somehow related to a Classloader \nissue??? But I am not sure why it would work with the Admin interface then.\n\n\nalso, I found someone else reported the same issue on the mailing list...\n\nhttp://archives.real-time.com/pipermail/tomcat-users/2003-March/103584.htmlThe code as posted can\'t be compiled: what\'s the \"jndi\" variable?\n\nIf you post a complete test case, i.e. a WAR file that I can drop into my \nTomcat installation to reproduce your problem, I\'ll be glad to look at it.\n\nIn addition, can you please test 5.0.28, the latest stable Tomcat 5.0 release \nat the time of this writing?Created attachment 12809\nwar file to demonstrate env-entry problemI have posted the war file. I ran the test against 5.0.28 - no change, problem \nstill exists. Thanks for looking into this.\n\nTo test:\n\ninstall war in server\n\nbrowse to <webserver>/<context>/listenv.jsp\n\n-  the current value of the env-entry should be displayed\n\nchange the web.xml env-entry using some text editor.\n\nreload the context, or allow tomcat to auto reload on change.\n\nbrowse to <webserver>/<context>/listenv.jsp (refresh needs to be performed)\n\n-  the OLD value is still displayed\n\nchange the env-entry using the tomcat \'admin\' web interface. post changes.\n\nbrowse to <webserver>/<context>/listenv.jsp (refresh needs to be performed)\n\n-  the NEW value is still displayed\nCould you please consider the following modification of\norg.apache.catalina.core.NamingContextListener class:\n\nit was:\n\npublic void lifecycleEvent(LifecycleEvent event) {\n...\n            // Binding the naming context to the class loader\n            if (container instanceof Context) {\n                // Setting the context in read only mode\n                ContextAccessController.setReadOnly(getName());\n                try {\n                    ContextBindings.bindClassLoader\n                        (container, container,\n                         ((Container)\ncontainer).getLoader().getClassLoader());\n                } catch (NamingException e) {\n                    log(sm.getString(\"naming.bindFailed\", e));\n                }\n            }\n...\n}\n\nI think, it should be:\n\n\npublic void lifecycleEvent(LifecycleEvent event) {\n...\n            // Binding the naming context to the class loader\n            if (container instanceof Context) {\n\n\n\n               namingResources.addPropertyChangeListener(this);\n\n\n\n                // Setting the context in read only mode\n                ContextAccessController.setReadOnly(getName());\n                try {\n                    ContextBindings.bindClassLoader\n                        (container, container,\n                         ((Container)\ncontainer).getLoader().getClassLoader());\n                } catch (NamingException e) {\n                    log(sm.getString(\"naming.bindFailed\", e));\n                }\n            }\n...\n}\n\n\nThank you,\nIgorCreated attachment 13292\nIf Environment entry is changed using admin app, the change is not visisble in JNDI. Patch to solve this problemSorry, this patch is wrong :-( Please do not apply itThe comments from Igor are not correct. It works ok if you change the variable\nvia the admin interface - it does not work if you manually change the web.xml,\nand stop/restart the web application.Updating version to 5.0.28.The chances of this getting fixes in Tomcat 5.0.x are now slim.  Can either or\nboth of you test with 5.5.7 (or 5.5.9 which will be out in a couple of days) and\nlet us know if it works or not?  That would be great...I did a simple test with tomcat 5.5.9. Environment entries are reloaded when \ncontext is reloaded.\n\nBut if I change environment entry in admin application, it is not reloaded. To \nforce application to see new entries user will have to reload context, which is \ndangerous operation.\n\nIt would be great if application would see new value after changing it in admin \napplication too.\n\n(In reply to comment #12)\n> The chances of this getting fixes in Tomcat 5.0.x are now slim.  Can either or\n> both of you test with 5.5.7 (or 5.5.9 which will be out in a couple of days) \nand\n> let us know if it works or not?  That would be great...\n\nThat\'s pointless: accessing JNDI is costly, and is supposed to be read only in\nthe first place. As a result, webapps should be reading values, etc, in init,\nand that\'s it.My original bug, is that if the web.xml file is modified (via text editor, etc.)\nwhile the context is running, and the context is restarted, the container is\nsupposed to detect this and load the new JNDI values.\n\nThis is according to the J2EE specification.\n\nThis does not occur in 5.0. I have not yet tested with the 5.5 release, but\nbased on the fact that nothing has been posted as a direct fix for this, I am\nfairly certain the problem still exists.As a developer I want to have possiblity to change environment entries without \nrestarting, reloading ... My application should work 24/7 and I do not want to \nrestart or reload application because of I need to change only one parameter.\n\nEnvironment entries are very convinient to store init parameters. And I do not \nwant to change parameters too often. But it would be nice if I could change \nsomething in application parameters without restart.\n\nI can \"change\" environment entries in admin application. What is this feature \nfor, if it do not do anything, just changes value in admin?This can be done via JMX. Assume you have a webapp called /myapp with a JNDI\nenvironment string called i/need. It can be queried via the JMPXproxy in the\nmanager app. Here\'s the ouput example:\n\nName:\nCatalina:type=Environment,resourcetype=Context,path=/myapp,host=localhost,name=i/need\nmodelerType: org.apache.catalina.mbeans.ContextEnvironmentMBean\nclassName: org.apache.catalina.deploy.ContextEnvironment\nname: i/need\noverride: false\ntype: java.lang.String\nvalue: less cowbell\n\nSo your search URL would be (unescaped for readability ...)\nhttp://localhost/manager/jmxproxy?qry=Catalina:type=Environment,resourcetype=Context,path=/myapp,host=localhost,name=i/need\n\nAnd can be set via\nhttp://localhost/manager/jmxproxy?set=Catalina:type=Environment,resourcetype=Context,path=/myapp,host=localhost,name=i/need&att=value&val=more+cowbell\n\nMore information:\nhttp://jakarta.apache.org/tomcat/tomcat-5.0-doc/manager-howto.html#What\%20is\%20JMX\%20Proxy\%20Servlet\nReopening bug. you cannot close as won\'t fix. your solution is not related to\nthis bug. This is a different bug, in that manual changes made to a web.xml\nfile, are not seen in the JNDI environment after a context restart. This is not\nadhering to the J2EE specification.Sure I can close the bug ;) This will not be fixed.Sorry, but you are an idiot, or have very little reading comprehension skills.\n\nThis bug needs to be fixed, it is not J2EE compliant. You do not need to fix the\nrequest in comment #13, that changes are visible in the JNDI context without a\nreload when changes are made via the admin interface. There is not in J2EE that\nstates that a container must update the JNDI context in real-time, but not sure\nthat the feature wouldn\'t be helpful as Igor has pointed out.(In reply to comment #20)\n> Sorry, but you are an idiot\n\nThat sounds good to me :)\n\nTo translate since you apparently have very little general comprehension skills,\nthis minor issue will not be fixed in the 5.0.x branch.How is it a minor issue? Do you run any large, multiple server, sites at all? It\nis fairly common to update deployed application by copying new web.xml files to\nthe deployment directories, and then use the Tomcat weburl to restart the context.\nWhy is this bug not moved to the 5.5 branch then?\n\nThe J2EE specification states that the JNDI variables for an application are\nreloaded during a CONTEXT RESTART. This is the only way for init() methods in a\nservlet to retrieve any changed values.\n\nThis bug is NOT related to Igor\'s comments where he wants JNDI changes to be\nvisible as they are made.\n\nFor what it is worth, I tested this behavior with Jetty and it works as expected.Tested against 5.5.x and is still present. I am working on a fix...\n\nNote, I am only considering the original bug report.This is fixed in svn and will be in 5.5.21 onwards.',?,BUG
29779,'Package Path wrong at admin class SetCharacterEncodingFilter','Tomcat 5',Webapps:Administration,pr,dev,'HEy,\n\nAt Admin the Class SetCharcterEncodingFilter has wrong package path.\n\nregards \nPeterCreated attachment 11938\ncorrect package pathFixed, thanks.',?,BUG
29826,'Installation always exits with an error code.','Tomcat 5',Catalina,assaf,dev,'when running the tomcat installation from an NSIS script , the installation \nalways returns an error code to the main script .\nexample :\n----------------------------------------------------------------------------\nNoJInstall:\nIfErrors 0 NoAbort\n    MessageBox MB_OK \"Couldn\'t find a Tomcat Jakarta Web server installed. \nSetup will now install a FOO required Jakarta .\"\n    DetailPrint \"Couldn\'t find a Tomcat Jakarta Web server installed. Setup \nwill now install a Foo required Jakarta .\"\n    execwait \"C:\\jakarta-tomcat-5.0.25.exe\"\n    IfErrors 0 Problem\n\n Problem:\n      Sleep 300\n      Abort\n------------------------------------------------------------------------\nwhen finishing the jakarta installer , there are two check boxes , at first i \nthought that unmarking them caused the error , but in a second try i left them \nmarked and the same error happened.\n\ni think the error is generated by the \"close\" button in the end of the install.Created attachment 12034\nNew setclasspath.batCreated attachment 12035\nNew catalina.batThis problem is due to the call to exit in setclasspath.bat.  The syntax should probably be \"exit /b \nerrorlevel\".  There\'s also a typo in catalina.bat, CURRENT_DIR vs. \%CURRENT_DIR\%.  I\'ve attached \nproposed fixes for the two files.Thank you for reporting this bug and posting patches.  I\'ve applied the \nsetclasspath exit code patch.  The catalina.bat \%current_dir\% one was already \napplied in 5.0.26 or 5.0.27, so no action needed there.\n\nIn the future, if possible post diff patches rather than the full file.',?,BUG
29831,'Support for boolean property in bean factory','Tomcat 5',Unknown,meder,dev,'The attached patch adds support for boolean properties to the BeanFactory.Created attachment 11966\nAdd boolean property support to BeanFactoryDone, thanks.',?,RFE
29866,'JspReader#skipUntil may try to read beyond the end of the file','Tomcat 5',Jasper,bodewig,dev,'I\'ll attach a very simple JSP to reproduce the problem.\n\nIf you have a JSP that contains at least one \'<\' character and ends with a \':\'\nJasper will die with an ArrayIndexOutOfBoundsException in JspReader#peekChar.\n\nDigging deeper I see that the situation I describe will invoke\nJspWriter.skipUntil(\":root\").  This will match the colon as the last char and\nthen invoke peekChar unconditionally.\n\nI think peekChar should have a \n\n\tif (!hasMoreInput())\n\t    return -1;\n\nblock on top just like nextChar, but I didn\'t look close enough to be sure this\nwouldn\'t cause bad side effects.\n\nStack trace looks like this:\n\njava.lang.ArrayIndexOutOfBoundsException: 6\n        at org.apache.jasper.compiler.JspReader.peekChar(JspReader.java:156)\n        at org.apache.jasper.compiler.JspReader.skipUntil(JspReader.java:281)\n        at\norg.apache.jasper.compiler.ParserController.hasJspRoot(ParserController.java:538)\n        at\norg.apache.jasper.compiler.ParserController.determineSyntaxAndEncoding(ParserController.java:369)\n        at\norg.apache.jasper.compiler.ParserController.doParse(ParserController.java:170)\n        at\norg.apache.jasper.compiler.ParserController.parse(ParserController.java:101)\n        at org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:203)\n        at org.apache.jasper.compiler.Compiler.compile(Compiler.java:461)\n        at org.apache.jasper.compiler.Compiler.compile(Compiler.java:442)\n        at org.apache.jasper.compiler.Compiler.compile(Compiler.java:430)\n        at\norg.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:511)\n        at\norg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:274)\n        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:292)\n        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:236)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:810)\n        at\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:237)\n        at\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:157)\n        at\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:214)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:104)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:520)\n        at\norg.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:198)\n        at\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:152)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:104)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:520)\n        at\norg.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:137)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:104)\n        at\norg.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:117)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:102)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:520)\n        at\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:104)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:520)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:929)\n       at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:160)\n        at\norg.apache.coyote.http11.Http11Processor.process(Http11Processor.java:793)\n        at\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:702)\n        at\norg.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:571)\n        at\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:644)\n        at java.lang.Thread.run(Thread.java:534)Created attachment 11995\nsimple JSP that demonstrates the problem.Note that there is no newline at the end of the attached file, the colon has to be\nthe very last character.Now that bugzilla notifications work again, I\'ll add a random comment to raise\nawareness ;-)\n\nThe most simple JSP to demonstrate the bug consists of a single < character, two\ncharacters <: will work as well.\nI didn\'t have problems with <: or <br/>:, though I did got the exception with <.\n\nFixed in CVS.  Thanks for reporting and the suggested fix.*** Bug 32044 has been marked as a duplicate of this bug. ***Kin-Man, it appears that you\'ve only fixed CVS HEAD since the problem still appears\nin 5.0.28 and 5.0.29.\n\nI know that 5.5.x is supposed to be the new product line now, but is there any\nchance you could merge the fix into the TOMCAT_5_0 branch so a potential future\nversion of the 5.0.x series picks it up?\n\nI\'m currently getting a different kind of problem with 5.5.x (report will follow\nonce I have analyzed it) so upgrading is not an option for me right now.Reopening bug for Tomcat 5.0.30 as a reminder to myself.OK, fix ported to 5.0.30.*** Bug 33042 has been marked as a duplicate of this bug. ***',?,BUG
29869,'Better support for JSR 77 state notfications at Context and Wrapper','Tomcat 5',Catalina,pr,dev,'Hey,\n\nI have see that context and wrapper has a implement\na NotificationBroadcaster to send JSR 77 complaint\nstate information \n\nProblem is: We can\'t register a NotificationListener.\n\n\nI have tested with MX4J 2.0.1\nTomcat current CVS Head\n\nOne problem still exists:\n\nI can only register the Listener directly and not with\nthe mbeanserver.addNotificationListener() methods.\n\naccess code example:\ntry {\n   ObjectName managercontext = new ObjectName(\n\t\t\t\t\n\"Catalina:j2eeType=WebModule,name=//localhost/,J2EEApplication=none,J2EEServer=none\");\n   log.info(managercontext);\n// work\t\t    \n   StandardContext context =(StandardContext) \n        mserver.getAttribute(managercontext, \"managedResource\");\n   context.addNotificationListener(this, null, null);\n// not work\n// log.info(context.getName() + \".(\" +context.getDocBase() + \")\");\n// mserver.addNotificationListener(managercontext,this,null,null);\n   log.info(\"Notfication to ROOT added\");\n} catch (Exception e) {\n    log.error(e);\n}\n\nOther strange things:\na)   it is a problem to get the j2ee.state.starting message.\n     No chance to register before manager or autodeployment procedure\n     create and start context or wrapper!\nb)   Context destroy is not called at StandardHostDeployer!\n     j2ee.state.deleted to emitted.\n     Clear/remove NotificationBroadcaster is not implemened at destroy.\n\nSee my patches (base implementations. :-)\n\nregards\nPeterCreated attachment 11997\nStandardContext with NotifcationEmitter supportCreated attachment 11998\nStandardWrapper with NotifcationEmitter supportPatch committed (by Remy, I\'m just cleaning up Bugzilla).  Thanks for \ncontriburing it.',?,IMPROVEMENT
29887,'Recursive Tag files modification check causes StackOverflowError','Tomcat 5',Jasper,krueger,dev,'Recursive Tag files modification check causes StackOverflowError presumably\nbecause a tag file making use of itself is added to the list of its dependents,\ncausing the modification check to loop infinitely. See attached test case.Created attachment 12014\ntest app with instructions to reproduce the bugI\'m adding a patch that works around the problem by not allowing the recursive\ndependency to be added to the page. This is rather dealing with the symptoms\nthan a good solution but it solves and might help to illustrate my current problem.I don\'t see any patch.  Anyway, not allowing recursive dependencies to be added\nto the page actually works, and is the simplest solution.  Fixed in CVS.\n\nThanks for reporting this bug.Oops, obviously forgot to upload the patch. Your fix makes absolute sense.\nThanks for yet another quick reaction!*** Bug 31382 has been marked as a duplicate of this bug. ***There is still a problem with recompiling recursive tag file, but not with\nArgen\'s test case from 31382.  The problem occurs only for indiret recursive tag\nfiles (t.tag uses t2.tag which use t.tag), and it occurs not during dependency\nchecking, but in the JSP compilation itself.\n\nThis is now fixed in CVS.  Thanks for being persistent. :)',?,BUG
29914,'StandardServer.storeConfig() not saved DefaultContext Listeners','Tomcat 5',Catalina,pr,dev,'Hey,\n\nstoreDefaultContext()\n===========================================\nHey,\n\nI implement a new store server.xml mechanisnm and detectet following strange\nbehaviour: \n\nConfig \n\n<DefaultContext>\n   <Listener className=\"org.apache.catalina.listener.InfoLifecycleListener\"/>\n</DefaultContext>\n\nare not saved with StandardServer.storeConfig()\n\n1) wrong Lifecycle Listener storage\n\tStandardDefaultContext not implement Lifecycle.\n\tReason: the configuered LifecycleListener not saved at DefaultContext instead\n\tall Listener saved at every Context. Hups!\n\t\n\ts. StandardDefaultContext.installDefaultContext addLifecycleListener\n\t\n\tThis store mechaismn generate an error situation after deploy new applications\n\nHmm at my implementation I made following changes:\n- delete the Lifecycle instanceof check \n- check every Listener at context\nthere are not at Engine or Host DefaultContext!\n- Also check\n2) ResourceLink not saved at storeNamingResource\n\tcorrect for GlobalNamingResource but wrong for DefaultContext and Context\n\n3)  After storeConfig the DefaultContext looks like this\n       <DefaultContext\nclassName=\"org.apache.catalina.core.StandardDefaultContext\" reloadable=\"true\">\n\n     strange effect this class is included at the skippables[] array!\n\nregards\nPeterHey,\n\n\ncan we change the Listener Event handling to context.\nInstead add the Lifcycle Listener from DefaultContext to Context\nbetter call all Listener add DefaultContext at \n\nImplement a spezial LifecycleSupport class to\nhandle StandardContext.fireLifecycleEvent() with DefaultCOntext Lifecycle Listeners.\n\n\nregards\nPeter\nBefore we can implemented a better defaultContext support\nwe must add removeLifecycleListener and findLifecycleListeners.\n\nregards\npeter\n\ns. Patch\nCreated attachment 12058\nBetter LifecycleListenerSupport at DefaultContextSzenario:\nDefaultContext with LifecycleListener info\nstart context\nstop context\nstart context\n\nHups:\nNow the context have two DefaultContext Listener info\n\nProblem is: That installDefaultContext() called at every context start, but\nthe DefaultContext LifecycleListener not delete at stop!\n\nRegards\nPeter\n\n\nAt which use case the follwing code at\nStandardDefaultContext.importDefaultContext() make sense?\n\n       if (!(context instanceof StandardContext)) {\n            ContextEjb [] contextEjb = findEjbs();\n\nI thing the NamingContextListener transfer all DefaultContext information.\nafter DefaultContext get the lifecycleEvent.\n\nStrange is the addLocalEjb at NamingContextListener is not yet implemented...\n\nregards\npeter\nDude, please get out of the habit of using Bugzilla as a conversation forum, \nespecially with yourself ;)  Use the mailing lists to discuss bugs and \nenhancements, approaches to them, and iterations.  Only post the final \niteration to Bugzilla if possible.  That makes it much easier for us to \nevaluate and commit your suggestions.OK, patch applied on TOMCAT_5_0 branch.  It\'s not relevant to Tomcat 5.5 (see \nDefaultContext replacement discussions on tomcat-dev for that).',?,RFE
29923,'localized resources for example servlets in Portuguese','Tomcat 5',Webapps:Examples,jmedeiros,dev,'# Copyright 2004 The Apache Software Foundation\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\n# $Id: LocalStrings_pt.properties,v 1.2 2004/07/05 16:40:33 jmedeiro Exp $\n\n# Default localized resources for example servlets\n# This locale is pt_PT\n\nhelloworld.title=Ola Mundo!\n\nrequestinfo.title=Exemplo da Informacao do Pedido\nrequestinfo.label.method=Metodo:\nrequestinfo.label.requesturi=URI do Pedido:\nrequestinfo.label.protocol=Protocolo:\nrequestinfo.label.pathinfo=Informacao do Caminho:\nrequestinfo.label.remoteaddr=Endereco Remoto:\n\nrequestheader.title=Exemplo da Cebeceira do Pedido\n\nrequestparams.title=Examplo de Parametros do Pedido\nrequestparams.params-in-req=Parametros neste pedido:\nrequestparams.no-params=Sem Parametros, Por favor entre alguns\nrequestparams.firstname=Primeiro Nome:\nrequestparams.lastname=Apelido:\n\ncookies.title=CExamplo de Cookies\ncookies.cookies=O se browser esta a enviar os seguintes cookies:\ncookies.no-cookies=O seu browser nao esta a enviar nenhuns cookies\ncookies.make-cookie=Crie um cookie para enviar para o seu browser\ncookies.name=Nome:\ncookies.value=Valor:\ncookies.set=Acabou de enviar o seguinte cookie para o seu browser:\n\nsessions.title=Examplo de sessoes\nsessions.id=Identificador da Sessao:\nsessions.created=Criada:\nsessions.lastaccessed=Ultima vez acedida:\nsessions.data=Os seguintes dados fazem parte da sua sessao:\nsessions.adddata=Adicione data a sua sessao\nsessions.dataname=Nome do atributo da sessao:\nsessions.datavalue=Valor do atributo da Sessao:Created attachment 12038\nLocalised Strings in PortugueseI requested on tomcat-dev that someone with jakarta-servletapi-5 commit this.Commited. Thanks Yoav for the push ;-)',?,DOCUMENTATION
29936,'XML parser loading problems by container','Tomcat 5',Catalina,p_nevilleuk,dev,'I\'m trying to use JSTL 1.1 with this version of tomcat and have both saxon and \ncrimson in my web-app.\n\nIf we have crimson and saxon in our webapp lib then tomcat tries to use crimson \nas the xml parser when reading the web.xml and compiling the jsp and we get the \nprefix error:\n\norg.apache.jasper.JasperException: <h3>Validation error messages from \nTagLibraryValidator for c</h3><p>null: java.lang.IllegalStateException: can\'t \ndeclare any more prefixes in this context</p><h3>Validation error messages from \nTagLibraryValidator for fmt</h3><p>null: java.lang.IllegalStateException: can\'t \ndeclare any more prefixes in this context</p>\n\nIf we remove crimson, tomcat uses saxon (aelfred parser) and this fails on \nreading the web.xml (javax.xml.parsers.ParserConfigurationException: AElfred \nparser is namespace-aware)\n\nIf we remove saxon and crimson then we are okay (defaults to xerces in the \ntomcat endorsed directory?)\n\nIt seems to me that tomcat is using the parser in my web-app to read the \nweb.xml rather than using xerces from the endorsed directory.  \n\nThe same web-app runs without problems in version 5.0.16.  \n\nTomcat seems to be using the service provider mechanism in 5.0.25 as I have \nproperty files in C:\\Java\\jakarta-tomcat-5.0.25\n\\work\\Catalina\\localhost\\diabetes\\loader\\META-INF\\services (can\'t find any \ndocuments on this).\n\nIf I\'m using more than one parser won\'t this cause problems as tomcat is \nsetting only one parser and xslt processor here?\n\nAny comments are gratefully received.\n\nThanks,\nPeter NevilleBTW: Java SDK is version 1.4.2_01I am afraid if you want this resolved, you\'ll have to investigate this further.\nOne thing which really hurts your report is the fact that this would be a\nclassloader issue, and yet there is no relevant functional changes in the\nclassloader since 5.0.16.Are you sure you haven\'t duplicated the tagdef in the JSP multiple times?\n\nFor example - this would cause an error:\n<\%@ taglib uri=\"http://java.sun.com/jstl/core/c.tld\" prefix=\"c\" \%>\n<\%@ taglib uri=\"http://java.sun.com/jstl/core/c.tld\" prefix=\"c\" \%>\n\nOr this:\n<\%@ taglib uri=\"http://java.sun.com/jstl/core/c.tld\" prefix=\"c\" \%>\n<\%@include page=\"foo.jsp\"\%> \n\nwhere foo.jsp also has:\n<\%@ taglib uri=\"http://java.sun.com/jstl/core/c.tld\" prefix=\"c\" \%>Remy: You mention that there hasn;t been any classloader chnages since 5.0.16, \nbut to the best of my knowledge 5.0.16 did not store service provider details \nin the apache work/catalina/localhost/webapp/loader sub-directories.\nAre there any explanations on this available?\n\nTim:\n\nThe taglibs are declared as:\n\n<\%@ taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" \%>\n<\%@ taglib prefix=\"fn\" uri=\"http://java.sun.com/jsp/jstl/functions\" \%>\n<\%@ taglib prefix=\"fmt\" uri=\"http://java.sun.com/jsp/jstl/fmt\" \%>\n\nSo not multiple declarations - there ins aninclude but this doesn\'t use taglibs.\n\nThe problem is instantly resolved by removing saxon and crimson from the web-\napp lib.\n\n\nThanks for your help so far...Also, I must set my web.xml for the web-app to :\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n<web-app xmlns=\"http://java.sun.com/xml/ns/j2ee\"\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n    xsi:schemaLocation=\"http://java.sun.com/xml/ns/j2ee web-app_2_4.xsd\"\n    version=\"2.4\">\n\ninstead of :\n\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n<!DOCTYPE web-app\n    PUBLIC \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"\n    \"http://java.sun.com/dtd/web-app_2_3.dtd\">\n<web-app>\n\n\nOtherwise tomcat gives errors when compiling the jsp indicating that it can\'t \nfind bean properties etc.If you don\'t know what 5.0.16 has and what it does not have, I think you need to\ncheck the CVS history. I really cannot see anything I\'d like to test in this bug\nreport (except the usual: we don\'t support replacing the XML provider, except\nusing the JVM provided mechanism).for what it\'s worth I\'m seeing the same thing with:\n\ntomcat 5.0.25\njstl 1.1\nj2dsk 1.4.2_05\nlinux\n\nfor a web app that has crimson in the WEB-INF/lib. Removing the JAR that\ncontains crimson fixes it. It\'s surprising to me that tomcat is using the parser\nit finds in the web app for web.xml and JSP compilation - not what I\'d expect\nand will probably trip other people up the same way.This issue is also prevalent in 5.5.x.  To reproduce, do the following:\n\n1) Remove all stock webapps that come with the standard installation.  This\nincludes the ones in server/webapps.  Remember to remove the configurations in\nconf/Catalina.\n2) Add a webapp that has a saxon parser located in WEB-INF/lib.  For instance,\none from sourceforge.\n3) Start Tomcat.  You should a stack trace similar to this:\n\nJun 7, 2007 11:33:29 AM org.apache.commons.digester.Digester getParser\nSEVERE: Digester.getParser: \njavax.xml.parsers.ParserConfigurationException: AElfred parser is namespace-aware\n\tat\ncom.icl.saxon.aelfred.SAXParserFactoryImpl.newSAXParser(SAXParserFactoryImpl.java:37)\n\tat org.apache.commons.digester.Digester.getParser(Digester.java:686)\n\tat org.apache.commons.digester.Digester.getXMLReader(Digester.java:902)\n\tat org.apache.commons.digester.Digester.parse(Digester.java:1548)\n\tat org.apache.catalina.startup.ContextConfig.defaultConfig(ContextConfig.java:515)\n\tat org.apache.catalina.startup.ContextConfig.start(ContextConfig.java:623)\n\tat org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:216)\n\tat\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)\n\tat org.apache.catalina.core.StandardContext.start(StandardContext.java:4290)\n\tat org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:823)\n\tat org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:807)\n\tat org.apache.catalina.core.StandardHost.addChild(StandardHost.java:595)\n\tat\norg.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:277)\n\tat org.apache.catalina.core.StandardHost.install(StandardHost.java:832)\n\tat org.apache.catalina.startup.HostConfig.deployWARs(HostConfig.java:625)\n\tat org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:431)\n\tat org.apache.catalina.startup.HostConfig.start(HostConfig.java:983)\n\tat org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:349)\n\tat\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1091)\n\tat org.apache.catalina.core.StandardHost.start(StandardHost.java:789)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1083)\n\tat org.apache.catalina.core.StandardEngine.start(StandardEngine.java:478)\n\tat org.apache.catalina.core.StandardService.start(StandardService.java:480)\n\tat org.apache.catalina.core.StandardServer.start(StandardServer.java:2313)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:556)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:287)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:425)\nJun 7, 2007 11:33:29 AM org.apache.catalina.startup.ContextConfig defaultConfig\nSEVERE: Parse error in default web.xml\njava.lang.NullPointerException\n\tat org.apache.commons.digester.Digester.getXMLReader(Digester.java:902)\n\tat org.apache.commons.digester.Digester.parse(Digester.java:1548)\n\tat org.apache.catalina.startup.ContextConfig.defaultConfig(ContextConfig.java:515)\n\tat org.apache.catalina.startup.ContextConfig.start(ContextConfig.java:623)\n\tat org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:216)\n\tat\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)\n\tat org.apache.catalina.core.StandardContext.start(StandardContext.java:4290)\n\tat org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:823)\n\tat org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:807)\n\tat org.apache.catalina.core.StandardHost.addChild(StandardHost.java:595)\n\tat\norg.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:277)\n\tat org.apache.catalina.core.StandardHost.install(StandardHost.java:832)\n\tat org.apache.catalina.startup.HostConfig.deployWARs(HostConfig.java:625)\n\tat org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:431)\n\tat org.apache.catalina.startup.HostConfig.start(HostConfig.java:983)\n\tat org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:349)\n\tat\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1091)\n\tat org.apache.catalina.core.StandardHost.start(StandardHost.java:789)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1083)\n\tat org.apache.catalina.core.StandardEngine.start(StandardEngine.java:478)\n\tat org.apache.catalina.core.StandardService.start(StandardService.java:480)\n\tat org.apache.catalina.core.StandardServer.start(StandardServer.java:2313)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:556)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:287)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:425)\n\nI believe the issue here is that when the Digester to parse web.xml is set in\nContextConfig, the path to WEB-INF/lib is established for the WebappClassloader.\n When the SAXParserFactory is created with newInstance() within the call to\nDigester.getParser(), the rules dictate that it will search thirdmost for a file\nMETA-INF/services/javax.xml.parsers.SAXParserFactory in jars available, and it\nwill find it in saxon.jar, prior to defaulting to a platform default parser. \nThis webapp parser is now used for parsing the web.xml file, but since this task\nis the container\'s responsibility, it should not be used.  As a note, this\nparticular parser needs to be namespace-aware and the setting of it being not\nnamespace-aware throws this exception.\n\nA possible solution is to load the (default) parser into the Digester prior to\nhaving it being loaded by the WebappClassloader.  Since this appears to be\none-time settable, it will use this parser regardless of what the webapp has.Eddy, which particular sourceforge webapp did you use to test this?The webapp was one of my own, but you just need a bare one, I believe.  It\ncontained a saxon parser from Sourceforge, which overrides the default parser.This works for me, at least I can\'t reproduce by following the steps provided\nhere, with the latest source from svn.\n\nPlease test this with the latest 5.5.x release. If you still see the issue,\nplease provide the simplest possible WAR that reproduces the issue on a clean\nTomcat install along with any additional configuration steps that may be required.Created attachment 20889\nWAR causing problem for containerI\'ve attached a small problematic WAR that just contains a blank web.xml along\nwith a saxon.jar in the WEB-INF/lib.  Remember that you need to remove ALL the\napps that come with Tomcat (rm -fr webapps/*) as well as the configs (rm -fr\nconf/Catalina).\nI can replicate this issue with the provided war on 5.5.x. It seems odd that\nthis only occurs with the conf/Catalina and other webapps missing.The root cause of this issue is the ContextConfig class creating the parser for web.xml whilst it is using the webapp\'s classloader. This causes a problem if the app being processed includes an xml parser.\n\nI have committed a fix to trunk and will propose it for 6.0.x and 5.5.x.*** Bug 43444 has been marked as a duplicate of this bug. ***This has been committed to 6.0.x and will be in 6.0.17 onwards.This has been fixed in 5.5.x and will be included in 5.5.27 onwards.',?,BUG
29938,'cygwin windows dirs treated as path vars instead of dirs (includes PATCH)','Tomcat 5',Catalina,amoebaworks,dev,'1) JAVA_HOME, CATALINA_HOME, CATALINA_BASE, CATALINA_TMPDIR are not path \nvariables (ie: bin\\java:/usr/local/java) but are directories (the other type of \npaths :-). When the conversion is made back to windows dirs, the cygpath \ncommands have the \'--path\' option included, which shouldn\'t be there. See \ncygpath help for more info on paths & dirs.\n\nSo need a fix so that no \'--path\' option should be set for JAVA_HOME, \nCATALINA_HOME, CATALINA_BASE, CATALINA_TMPDIR.\n\n2) Also I sometimes use CATALINA_BASE of \'.\' cygpath converts this to \'.\\\' \nwith \'cygpath --windows .\' (why I don\'t know) but this later causes \nthe \'touch \"$CATALINA_BASE\"/logs/catalina.out\' on line 203 to fail because the \nconverted path is: \'.\\/logs/catalina.out\'. If the cygpath option \'--absolute\' \nis added it prevents this case from happening.\n\nSo need another fix for CATALINA_BASE to have the \'--absolute\' option added. \n\nActually it can be added to JAVA_HOME, CATALINA_HOME, and CATALINA_TMPDIR too \nwithout problems but usually these don\'t have \'.\' as their dirpath. It probably \nshould be added for these too for consistency.\n\n------------------------------------------------\nHere\'s the diff for the patch:\ncatalina.sh (rev 1.14) \n117,120c117,120\n<   JAVA_HOME=`cygpath --path --windows \"$JAVA_HOME\"`\n<   CATALINA_HOME=`cygpath --path --windows \"$CATALINA_HOME\"`\n<   CATALINA_BASE=`cygpath --path --windows \"$CATALINA_BASE\"`\n<   CATALINA_TMPDIR=`cygpath --path --windows \"$CATALINA_TMPDIR\"`\n---\n>   JAVA_HOME=`cygpath --windows --absolute \"$JAVA_HOME\"`\n>   CATALINA_HOME=`cygpath --windows --absolute \"$CATALINA_HOME\"`\n>   CATALINA_BASE=`cygpath --windows --absolute \"$CATALINA_BASE\"`\n>   CATALINA_TMPDIR=`cygpath --windows --absolute \"$CATALINA_TMPDIR\"`actually noticed that JSSE_HOME needs to be updated too. Here\'s the new patch:\n\n$ diff catalina-new.sh catalina-1.14.sh\n75c75\n<   [ -n \"$JSSE_HOME\" ] && JSSE_HOME=`cygpath --unix \"$JSSE_HOME\"`\n---\n>   [ -n \"$JSSE_HOME\" ] && JSSE_HOME=`cygpath --path --unix \"$JSSE_HOME\"`\n117,120c117,120\n<   JAVA_HOME=`cygpath --absolute --windows \"$JAVA_HOME\"`\n<   CATALINA_HOME=`cygpath --absolute --windows \"$CATALINA_HOME\"`\n<   CATALINA_BASE=`cygpath --absolute --windows \"$CATALINA_BASE\"`\n<   CATALINA_TMPDIR=`cygpath --absolute --windows \"$CATALINA_TMPDIR\"`\n---\n>   JAVA_HOME=`cygpath --path --windows \"$JAVA_HOME\"`\n>   CATALINA_HOME=`cygpath --path --windows \"$CATALINA_HOME\"`\n>   CATALINA_BASE=`cygpath --path --windows \"$CATALINA_BASE\"`\n>   CATALINA_TMPDIR=`cygpath --path --windows \"$CATALINA_TMPDIR\"`\n122c122\n<   JSSE_HOME=`cygpath --absolute --windows \"$JSSE_HOME\"`\n---\n>   JSSE_HOME=`cygpath --path --windows \"$JSSE_HOME\"`patch applied. Thanksno prob. thanks for applying it ;-)\n\nBTW:\ncatalina.sh 1.16: line 78\n[ -n \"$JSSE_HOME\" ] && JSSE_HOME=`cygpath --absolute --unix \n\"$JSSE_HOME\"`\n\ndoesn\'t need the --absolute option since the unix formats are okay to \nbegin with (doesn\'t matter if it\'s there or not). It was the windows format \nthat needed fixing, but whatever works.',?,BUG
29971,'Commented out page directive is parsed','Tomcat 5',Jasper,petr.pisl,dev,'If I have this page:\n<\%@page contentType=\"text/html\"\%>\n<\%--<\%@page pageEncoding=\"ISO-8859-2\"\%>--\%>\n<html>\n    <head><title>JSP Page</title></head>\n    <body>\n    </body>\n</html>\n\nThen the second page directive is parsed as well and the response encoding and\nthe file encoding is ISO-8859-2. It should be ISO-8859-1.The original case is fixed but if I compile this page:\n<\%-- --\%>\n<\%--<\%@page pageEncoding=\"xxx\"\%>--\%>\n<html>\n    <head><title>JSP Page</title></head>\n    <body>\n    </body>\n</html>\n\nJasper throws:\nJasperException: Unsupported encoding: xxx\n\nWithout the 1st comment the page works fine.JSP.1.6 Quoting and Escape Conventions\n\nQuoting in Scripting Elements\nA literal \%> is quoted by \%\\>\nI don\'t understand how your comment influence this issue. This issue is that jsp\nparser returns encoding from jsp comment. Fixed jan 11, 2005',?,BUG
30028,'session attributes Map may become inconsistent start causing \"strange\" problems','Tomcat 5',Catalina,vlad,dev,'Hi,\n\nAccess to StandardSession.attributes field is not synchronized; if used in\nframes or in any other way asynchronousely, session.setAttribute() or\nsession.removeAttribute() may make StandardSession.attributes HashTable\ninconsistent.\n\nWe have experienced a situation where attributes.getKeys().size() had become\ngreater then the number of the elements in the Set. This caused\nStandardSession.keys() to throw NoSuchElement exception and serialization for\nthat session to be broken permanently. That in its turn caused cluster to become\ninconsistent and so on.\n\nI do appreciate that the relevant synchronization is expected to be done by\ndevelopers but it is not always possible to enforce that. Some software we use\nis either close-source obfuscated type, or a big project developed and tested by\na third party on a different application server. Either way existing sites dont\nwork properly on Tomcat and we are not in a position to rewrite/modify the code\nto make those sites more \"intellegent\" so to speak.\n\nAnyway, i would like to suggest a fix to StandardSession.java:\n\n34a35,36\n> import java.util.Collections;\n> import java.util.Map;\n119,120c121\n<     protected HashMap attributes = new HashMap();\n< \n---\n>     protected Map attributes = Collections.synchronizedMap(new HashMap());\n\nThis is a patch for the 5.0.27 source.\n\nThanks,\nVladObviously, session access isn\'t synchronized, and needs syncing in the user code\nas needed. I thought this was obvious when reading the servlet specification\n(glad your have a workaround for your third party libraries).Remy,\n\n<quote>\n\nSRV.7.7.1 Threading Issues\n\nMultiple servlets executing request threads may have active access to a single\nsession object at the same time. The Developer has the responsibility for\nsynchronizing access to session resources as appropriate.\n\n</quote>\n\nI wouldnt say this implies that HttpSession is not guaranteed to be thread-safe\nand to be fair it is quite ambiguous about either. As to my interpretation the\nspec is talking about objects that are stored in session. And it would be\nlogical because the container cannot possibly synchronize access to them.\n\nThe session itself is a different matter altogether. It is a container resource\nand I dont think it would qualify as a \"session resource\" the spec is going on\nabout. I would say that the container have to synchronize calls to\nsetAttribute/removeAttribute to ensure session consistency.\n\nPerformance difference between HashMap and the synchronized map is negligible\nand the advantages are obvious. Basically unless session is accessed by the\nsingle servlet implementing SingleThreadModel there is no way to gurantee\nsession connsistency? Even <jsp:useBean> does not synchronize against the\nsession. So everyone is a winner if StandardSession.attributes is synchronized?\n\nI do hope that what i said here makes sense because Tomcat is one of the few\nservers that doesnt care about setAttribute/removeAttribute thread safety, which\nis a shame.\n\nRegards,\nVlad\nHey,\n\nI think we must sync the session data structure!\nIt make a big difference that app data are inconsistence or\nthe container data structure! Simple change and a very positive\neffect.\n\nregards\npeterRemy,\n\nexcuse my poor english please, what i did mean to say in the last paragraph is\nthat Tomcat is one of the few containers that doesnt provide thread-safe\nset/removeAttribute calls. \"doesnt care\" wasnt appropriate, sorry\n\nRegards,\nVladThe spec says the session sync is responsibility of the developer. It does not\nmatter what other containers do.\n\nSince the spec does not call for this, therefore it is not a bug. At best it\nwould be an enhancement.\n\nIntroducing a sync\'d HashMap does not fix the issue in cases where you are in a\ncluster and 2 requests for the same session on to different nodes occurs.Tim,\n\n\"The spec says the session sync is responsibility of the developer.\"\n\ni think that you are ignoring the fact that the spec is ambiguous about syncing\nsession access. Moreover the spec is saying about \"session resources\".\n\nGiven that the sync problem is *easy* to rectify on the container side with no\nside effects it is a reasonable thing to do. I dont mind calling it an\nenhancement either.\n\nCluster problem you described is a different matter. If you use \"sticky\" load\nbalancing you wouldnt have experienced that.\n\nVladHi,\n\nI\'m reopening this bug, since i\'m also having problems with this issue, and I\nreally think that someone could take a better look at this. I don\'t think the\nbug is invalid.\n\nI can see the problem happening when my application or tomcat itself tries to\ninvalidate a session, the problem happens in the method expire():\n\nStandardWrapperValve[action]: Servlet.service() for servlet action threw exception\njava.lang.ArrayIndexOutOfBoundsException: -6\n        at java.util.AbstractCollection.toArray(AbstractCollection.java:177)\n        at\norg.apache.catalina.session.StandardSession.keys(StandardSession.java:1523)\n        at\norg.apache.catalina.session.StandardSession.expire(StandardSession.java:706)\n        at\norg.apache.catalina.session.StandardSession.expire(StandardSession.java:632)\n        at\norg.apache.catalina.session.StandardSession.invalidate(StandardSession.java:1051)\n        at\norg.apache.catalina.session.StandardSessionFacade.invalidate(StandardSessionFacade.java:149)\n        at\nbr.com.digitro.supervisor.webapp.controller.actions.LogOutAction.execute(LogOutAction.java:31)\n        at\norg.apache.struts.action.RequestProcessor.processActionPerform(RequestProcessor.java:484)\n        at\norg.apache.struts.action.RequestProcessor.process(RequestProcessor.java:274)\n        at org.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)\n        at org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)\n\n\nAs you can see, this -6 is the result of a call to the size() method of\nattributes.keySet().\n\nPlease, let\'s not use the spec as an excuse for not doing things the right way.\nThe spec clearly says that the developer has the responsibility for\nsynchronizing access to \"session resources\", but doesn\'t say anything about the\nsession itself.\n\nThe container can and should synchronize the access to the session attribute\nmap, it would avoid many strange problems. Another side effect of this problem\nis that tomcat isn\'t even able to invalidate expired sessions in this situation.\n\nThis was fixed quite some time ago.Indeed. It seems it has been fixed in Tomcat 5.5.16.\nJust for information, this issue is very similar to the one in BUG 36541.\n(perhaps a duplicate...)\n',?,IMPROVEMENT
30048,'Setting compressableMimeTypes is ignored.','Tomcat 5',Connector:Coyote,ronald,dev,'I put this in my server.xml for the Connector.\ncompression=\"on\"\ncompressableMimeTypes=\"text/html,text/xml,text/plain,text/javascript,text/css\"\nBut it still doesn\'t compress text/javascript and text/css.\nI checked this by sniffing the network traffic.\nThe text/html is compressed.\nAfter looking in the source code, I couldn\'t find where the \ncompressableMimeTypes are set, but it is possible, that I\'m missing something \nhere.The code for setting the compressableMimeTypes is in the protocol processor, \ne.g. http://cvs.apache.org/viewcvs.cgi/jakarta-tomcat-\nconnectors/http11/src/java/org/apache/coyote/http11/Http11Processor.java?\nrev=1.112&view=markup for HTTP 1.1.  I believe it\'s being called and set.If I grep in jakarta-tomcat-catalina for compressableMimeType I get this.\n\n>grep -r --mmap compressableMimeType *\ncatalina/src/conf/server.xml:\n   compressableMimeType=\"text/html,text/xml\"\nwebapps/docs/config/http.xml:\n   <attribute name=\"compressableMimeTypes\" required=\"false\">\n\n(whitespace edited for readability)\nCan there be a typo, that there is a missing \'s\' in compressableMimeType_s_?\n\nIt seems to work if I do not use the \'s\' in my config. But all the documentation \nI found talks about compressableMimeTypes.\nLooking at the code, all the references are to compressableMimeTypes with an S \nat the end.  So it would appear the typo is in server.xml.  But it\'s strange \nthat you say it works without the S, and fails with the S.  Is that also true \non 5.0.28?Docs updated in CVS to reflect correct spelling.  Thanks for pointing this out.',?,DOCUMENTATION
30067,'\"Scripting elements are disallowed here\" exception behind scriptless tag','Tomcat 5',Jasper,mschovanek,dev,'[jdk 1.4.2_04]\n\nI got the exception for a script-less tag following by scriplet section in JSP\nin XML syntax. The scriptlet is *behind* the tag. The same code in Standard JSP\nsyntax works for me.\n\n- xindex.jspx - throws the exception:\n<jsp:root version=\"2.0\"\n    xmlns:jsp=\"http://java.sun.com/JSP/Page\"\n    xmlns:tag=\"urn:jsptagdir:/WEB-INF/tags\">\n    <tag:EmptyTag/>\n    <jsp:scriptlet>String x;</jsp:scriptlet>\n</jsp:root>\n\n- index.jsp - works for me:\n<\%@ taglib tagdir=\"/WEB-INF/tags/\" prefix=\"tag\"\%>\n<tag:EmptyTag/>\n<jsp:scriptlet>String x;</jsp:scriptlet>\n\n- EmptyTag.tag\n<\%@tag body-content=\"scriptless\"\%>\n<h1>Empty Tag</h1>Created attachment 12098\nScripting elements exception are disallowed here - exception.I see the bug is supposed to be fixed in 5.0.28.\n\nAre there work-arounds for 5.0.27?\n',?,BUG
30073,'NPE when compiling .jspx with broken xml format in jspcmode','Tomcat 5',Jasper,martin.grebac,dev,'While compiling jsp in broken xml format:\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<jspX:root xmlns:jsp=\"http://java.sun.com/JSP/Page\" version=\"2.0\">\n\n    <!-- to change the content type or response encoding change the following\nline -->\n    <jsp:directive.page contentType=\"text/xml;charset=UTF-8\"/>\n\n    <!-- any content can be specified here, e.g.: -->\n    <jsp:element name=\"text\">\n        <jsp:attribute name=\"lang\">EN</jsp:attribute>\n        <jsp:body>Sample text</jsp:body>\n    </jsp:element>\n</jsp:root>\n\nwith jasper in jspc mode, we get following exception:\n\njava.lang.NullPointerException\norg.apache.jasper.compiler.Mark.getURL(Mark.java:213)\norg.apache.jasper.compiler.ErrorDispatcher.dispatch(ErrorDispatcher.java:355)\norg.apache.jasper.compiler.ErrorDispatcher.jspError(ErrorDispatcher.java:90)\norg.apache.jasper.compiler.JspDocumentParser.parse(JspDocumentParser.java:201)\norg.apache.jasper.compiler.ParserController.doParse(ParserController.java:197)\norg.apache.jasper.compiler.ParserController.parse(ParserController.java:101)\norg.apache.jasper.compiler.Compiler.generateJava(Compiler.java:203)\norg.apache.jasper.compiler.Compiler.compile(Compiler.java:461)\norg.apache.jasper.JspC.processFile(JspC.java:761)\norg.apache.jasper.JspC.execute(JspC.java:885)\norg.netbeans.modules.web.project.ant.JspC.main(JspC.java:39)\norg.apache.jasper.JasperException\n\nWhen JspServlet invokes compilation everything works ok, but ErrorDispatcher in\njspcmode probably gets null in mark.getUrl() call and .toString() method then\nthrows uncaught NPE.',?,BUG
30117,'ResourceParams ignored in default context','Tomcat 5',Webapps:Administration,Andrew.Premdas,dev,'Setting up a DBCP pool. If I place correct <Resource> and <ResourceParams> \ntags in the default context, the params are not loaded.\n\nIf I create an application context <context ...> and place the same <Resource> \nand <ResourceParams> tags the params are now correctly loaded.\n\nBug or feature?\n\nTags in full are below just in case you need them. Location in server.xml is \njust before the </host> tag at the end of server.xml\n\n---- tags ----\n\n\t\t\t<Resource\n\t\t\t\tname=\"jdbc/DataWarehouse\"\n\t\t\t\tauth=\"Container\"\n\t\t\t\ttype=\"javax.sql.DataSource\"\n\t\t\t/>\n\t\t\n\t\t\t<ResourceParams name=\"jdbc/DataWarehouse\">\n\t\t\t\t<!-- Driver class and URL -->\n\t\t\t\t<parameter>\n\t\t\t\t   <name>factory</name>\n\t\t\t\t   \n<value>org.apache.commons.dbcp.BasicDataSourceFactory</value>\n\t\t\t\t</parameter>\n\t\t\t\t\n\t\t\t\t<parameter>\n\t\t\t\t   <name>driverClassName</name>\n\t\t\t\t   <value>oracle.jdbc.OracleDriver</value>\n\t\t\t\t</parameter>\n\t\t\t\n\t\t\t\t<parameter>\n\t\t\t\t\t<name>url</name>\n\t\t\t\t\n\t<value>jdbc:oracle:thin:@acudw1.acu.man.ac.uk:1521:dw1</value>\n\t\t\t\t</parameter>\n\t\t\t \n\t\t\t\t<!-- account details -->\n\t\t\t\n\t\t\t\t<parameter>\n\t\t\t\t\t<name>username</name>\n\t\t\t\t\t<value>web_image</value>\n\t\t\t\t</parameter>\n\t\t\t\n\t\t\t\t<parameter>\n\t\t\t\t\t<name>password</name>\n\t\t\t\t\t<value>pr0ject</value>\n\t\t\t\t</parameter>\n\t\t\t\n\t\t\t\t<!-- pooling controls -->\n\t\t\t\n\t\t\t\t<parameter>\n\t\t\t\t\t<name>maxActive</name>\n\t\t\t\t\t<value>20</value>\n\t\t\t\t</parameter>\n\t\t\t\n\t\t\t\t<parameter>\n\t\t\t\t\t<name>maxIdle</name>\n\t\t\t\t\t<value>10</value>\n\t\t\t\t</parameter>\n\t\t\t\n\t\t\t\t<parameter>\n\t\t\t\t\t<name>maxWait</name>\n\t\t\t\t\t<value>-1</value>\n\t\t\t\t</parameter>\n\t\t\t\t\n\t\t\t\t<!-- prevent pool leaks -->\n\t\t\t\t<parameter>\n\t\t\t\t\t<name>removeAbandoned</name>\n\t\t\t\t\t<value>true</value>\n\t\t\t\t</parameter>\n\t\t\t\t\n\t\t\t\t<parameter>\n\t\t\t\t\t<name>removeAbandonedTimeout</name>\n\t\t\t\t\t<value>60</value>\n\t\t\t\t</parameter>\n\t\t\t\t\n\t\t\t\t<parameter>\n\t\t\t\t\t<name>logAbandoned</name>\n\t\t\t\t\t<value>true</value>\n\t\t\t\t</parameter>\n\t\t\t\t\n\t\t\t</ResourceParams>\n\n----\nput them in this context and they work\n\n<Context \n\t\t\tpath=\"/poolSpike\" \n\t\t\treloadable=\"true\" \n\t\t\tdocBase=\"C:\\andy\\workspace\\poolSpike\" \n\t\t\tworkDir=\"C:\\andy\\workspace\\poolSpike\\work\">\n\t\n\n</Context>With Remy\'s new patches for 5.5 this will be fixed by using a default context\nfile used in a similar manner that we use web.xml.\n\nBut there is no known date for a 5.5 release.\n\nSo unless someone objects - I\'ll mark this as \"fixed\".',?,BUG
30144,'res.setContentType in SSIServlet.java line 167','Tomcat 5',Servlets:SSI,duarthur,dev,'In SSIServlet.java line 167, the code is \nres.setContentType(\"text/html;charset=UTF-8\");\nBut in DefaultServlet.java, the content type is found from web.xml, the code is \n// Find content type.\n        String contentType =\n            getServletContext().getMimeType(resourceInfo.path);\n\nI don\'t know if it\'s a problem.It\'s not a problem, but a decent thing to fix anyways.  I made it check the \nresource MIME type first, and use it if found, otherwise use text/html and UTF-\n8 as the default.',?,IMPROVEMENT
30149,'IllegalArgumentException when using context-param in web.xml','Tomcat 5',Catalina,cheng.fang,dev,'It appears any wars with context-param failed to\ndeploy.  When parsing web.xml, context-param elements are parsed and added\nto map twice for some reason, and thus cause the second adding to throw\nIllegalArgumentException.\n\nI instrumented\napache/jakarta-tomcat-\ncatalina/catalina/src/share/org/apache/catalina/core/StandardContext.java\naddParameter method\n\nHere it shows context-param was added twice:\n\nINFO: Installing web application at context path /jsp-examples from URL\nfile:/.../jakarta-tomcat-5/webapps/jsp-examples\n### name=webmaster value=myaddress@mycompany.com\n### map={}\n### value=null\n### to add ok\n### name=webmaster value=myaddress@mycompany.com\n### map={webmaster=myaddress@mycompany.com}\n### value=myaddress@mycompany.com\n### to throw\n\nTo repruduce it, just add to jsp-examples/web-inf/web.xml:\n\n    <context-param>\n      <param-name>webmaster</param-name>\n      <param-value>myaddress@mycompany.com</param-value>\n      <description>\n        The EMAIL address of the administrator to whom questions\n        and comments about this application should be addressed.\n      </description>\n    </context-param>\n\nStack trace from catalina.log:\nJul 15, 2004 9:54:37 PM org.apache.tomcat.util.digester.Digester endElement\nSEVERE: End event threw exception\njava.lang.reflect.InvocationTargetException\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.tomcat.util.IntrospectionUtils.callMethodN\n(IntrospectionUtils.java:907)\n        at org.apache.tomcat.util.digester.CallMethodRule.end\n(CallMethodRule.java:576)\n        at org.apache.tomcat.util.digester.Rule.end(Rule.java:228)\n        at org.apache.tomcat.util.digester.Digester.endElement\n(Digester.java:1057)\n        at org.apache.crimson.parser.Parser2.maybeElement(Parser2.java:1720)\n        at org.apache.crimson.parser.Parser2.content(Parser2.java:1963)\n        at org.apache.crimson.parser.Parser2.maybeElement(Parser2.java:1691)\n        at org.apache.crimson.parser.Parser2.parseInternal(Parser2.java:667)\n        at org.apache.crimson.parser.Parser2.parse(Parser2.java:337)\n        at org.apache.crimson.parser.XMLReaderImpl.parse(XMLReaderImpl.java:448)\n        at org.apache.tomcat.util.digester.Digester.parse(Digester.java:1561)\n        at org.apache.catalina.startup.ContextConfig.applicationConfig\n(ContextConfig.java:234)\n        at org.apache.catalina.startup.ContextConfig.start\n(ContextConfig.java:557)\n        at org.apache.catalina.startup.ContextConfig.lifecycleEvent\n(ContextConfig.java:187)\n        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent\n(LifecycleSupport.java:119)\n        at org.apache.catalina.core.StandardContext.start\n(StandardContext.java:4285)\n        at org.apache.catalina.core.ContainerBase.addChildInternal\n(ContainerBase.java:755)\n        at org.apache.catalina.core.ContainerBase.addChild\n(ContainerBase.java:739)\n        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:595)\n        at org.apache.catalina.core.StandardHostDeployer.install\n(StandardHostDeployer.java:276)\n        at org.apache.catalina.core.StandardHost.install(StandardHost.java:832)\n        at org.apache.catalina.startup.HostConfig.deployWARs\n(HostConfig.java:584)\n        at org.apache.catalina.startup.HostConfig.deployApps\n(HostConfig.java:398)\n        at org.apache.catalina.startup.HostConfig.check(HostConfig.java:997)\n        at org.apache.catalina.startup.HostConfig.lifecycleEvent\n(HostConfig.java:298)\n        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent\n(LifecycleSupport.java:119)\n        at org.apache.catalina.core.StandardHost.backgroundProcess\n(StandardHost.java:800)\n        at \norg.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChild\nren(ContainerBase.java:1511)\n        at \norg.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChild\nren(ContainerBase.java:1520)\n        at \norg.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run\n(ContainerBase.java:1500)\n        at java.lang.Thread.run(Thread.java:534)\nCaused by: java.lang.IllegalArgumentException: Duplicate context initialization \nparameter webmaster\n        at org.apache.catalina.core.StandardContext.addParameter\n(StandardContext.java:2116)\n        ... 35 more\nJul 15, 2004 9:54:37 PM org.apache.catalina.startup.ContextConfig \napplicationConfig\nSEVERE: Parse error in application web.xml\njava.lang.IllegalArgumentException: Duplicate context initialization parameter \nwebmaster\n        at org.apache.tomcat.util.digester.Digester.createSAXException\n(Digester.java:2740)\n        at org.apache.tomcat.util.digester.Digester.createSAXException\n(Digester.java:2766)\n        at org.apache.tomcat.util.digester.Digester.endElement\n(Digester.java:1060)\n        at org.apache.crimson.parser.Parser2.maybeElement(Parser2.java:1720)I traced the problem to CallMethodRule class, where callMethodN was invoked \ntwice.  With the following change, Tomcat works fine with context-param.  I \nalso tested this change with jsp tck.  I will appreciate it if someone could \nreview and apply it.\n\nIndex: CallMethodRule.java\n===================================================================\nRCS file: /home/cvspublic/jakarta-tomcat-\nconnectors/util/java/org/apache/tomcat/util/digester/CallMethodRule.java,v\nretrieving revision 1.1\ndiff -u -r1.1 CallMethodRule.java\n--- CallMethodRule.java 26 Jun 2004 17:41:30 -0000      1.1\n+++ CallMethodRule.java 22 Jul 2004 19:24:05 -0000\n@@ -572,7 +572,6 @@\n             sb.append(\")\");\n             digester.log.debug(sb.toString());\n         }\n-        IntrospectionUtils.callMethodN(target, methodName, paramValues, \nparamTypes);\n         Object result = IntrospectionUtils.callMethodN(target, methodName,\n                 paramValues, paramTypes);\n         processMethodCallResult(result);\nFixed by applying Cheng\'s patch.',?,BUG
30155,'Problem with viewing mail session','Tomcat 5',Webapps:Administration,lubx,dev,'After compile and deploy the application (myapp) to tomcat, trying to view the\nMail Session set-up in Admin, Admin throws exception.  \nIt doesn\'t happen at very first time to set up the Mail Session, after modify\nthe setting, or modifying the server context file, it will keep throwing the\nexception even undo  all changes in config file. \nThis bug could be repeated after following the fix of  bug #29255.\n\nException:\njavax.servlet.ServletException: Exception retrieving attribute \'mail.smtp.host\'\n\torg.apache.jasper.runtime.PageContextImpl.doHandlePageException(PageContextImpl.java:825)\n\torg.apache.jasper.runtime.PageContextImpl.handlePageException(PageContextImpl.java:758)\n\tadmin.resources.listMailSessions_jsp._jspService(listMailSessions_jsp.java:431)\n\torg.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:94)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:810)\n\torg.apache.struts.action.RequestProcessor.doForward(RequestProcessor.java:1069)\n\torg.apache.struts.action.RequestProcessor.processForwardConfig(RequestProcessor.java:455)\n\torg.apache.struts.action.RequestProcessor.process(RequestProcessor.java:279)\n\torg.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)\n\torg.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:697)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:810)\n\torg.apache.struts.action.RequestProcessor.doForward(RequestProcessor.java:1069)\n\torg.apache.struts.action.RequestProcessor.processForwardConfig(RequestProcessor.java:455)\n\torg.apache.struts.action.RequestProcessor.process(RequestProcessor.java:279)\n\torg.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)\n\torg.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:697)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:810)\n\nRoot Cause:\n\njavax.servlet.jsp.JspException: Exception retrieving attribute \'mail.smtp.host\'\n\torg.apache.webapp.admin.AttributeTag.doEndTag(AttributeTag.java:170)\n\tadmin.resources.listMailSessions_jsp._jspx_meth_controls_attribute_1(listMailSessions_jsp.java:761)\n\tadmin.resources.listMailSessions_jsp._jspService(listMailSessions_jsp.java:391)\n\torg.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:94)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:810)\n\torg.apache.struts.action.RequestProcessor.doForward(RequestProcessor.java:1069)\n\torg.apache.struts.action.RequestProcessor.processForwardConfig(RequestProcessor.java:455)\n\torg.apache.struts.action.RequestProcessor.process(RequestProcessor.java:279)\n\torg.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)\n\torg.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:697)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:810)\n\torg.apache.struts.action.RequestProcessor.doForward(RequestProcessor.java:1069)\n\torg.apache.struts.action.RequestProcessor.processForwardConfig(RequestProcessor.java:455)\n\torg.apache.struts.action.RequestProcessor.process(RequestProcessor.java:279)\n\torg.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)\n\torg.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:697)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:810)I can\'t reproduce.  Can you attach your config files?  From the exception, it\nlooks like your mail session resource is missing \"mail.smtp.host\" parameter.I actually removed the configuration regarding the mail session both in web.xml\nand context.xml. here goes the web.xml, context.xml and server.xml:\n\nweb.xml:\n\n<web-app>\n<!--  Omit other config  -->\n     <resource-ref>\n        <description>DB Connection</description>\n        <res-ref-name>jdbc/dsapp1</res-ref-name>\n        <res-type>javax.sql.DataSource</res-type>\n        <res-auth>Container</res-auth>\n    </resource-ref>\n<!--    <resource-ref>-->\n<!--        <description>mail</description>-->\n<!--        <res-ref-name>mail/Session_send</res-ref-name>-->\n<!--        <res-type>javax.mail.Session</res-type>-->\n<!--        <res-auth>Container</res-auth>-->\n<!--    </resource-ref>-->\n\n        <!-- The tomcat role -->\n    <security-role>\n        <description>Default Role for All Users</description>\n        <role-name>tomcat</role-name>\n    </security-role>\n</web-app>\n\ncontext.xml:\n\n<Context path=\"/dsapp1\" docBase=\"dsapp1\" debug=\"99\" reloadable=\"true\">\n    <Logger className=\"org.apache.catalina.logger.FileLogger\" \n        prefix=\"dsapp1_log.\" suffix=\".txt\" timestamp=\"true\"/>\n\n\n    <!-- NOTE: If you want to use a DataSourceRealm, the Resource must be a\n               global resource -->\n    <Realm className=\"org.apache.catalina.realm.JDBCRealm\" debug=\"99\"\n          driverName=\"com.mysql.jdbc.Driver\"\n      \nconnectionURL=\"jdbc:mysql://localhost/dsapp1?autoReconnect=true&amp;useUnicode=true&amp;characterEncoding=UTF-8\"\n      connectionName=\"test\" connectionPassword=\"test\"\n           userTable=\"app_user\" userNameCol=\"username\" userCredCol=\"password\"\n       userRoleTable=\"user_role\" roleNameCol=\"role_name\" />\n    <Resource name=\"jdbc/dsapp1\" auth=\"Container\" type=\"javax.sql.DataSource\"/>\n    <ResourceParams name=\"jdbc/dsapp1\">\n        <parameter>\n            <name>factory</name>\n            <value>org.apache.commons.dbcp.BasicDataSourceFactory</value>\n        </parameter>\n        <!-- Maximum number of dB connections in pool. Make sure you\n             configure your mysqld max_connections large enough to handle\n             all of your db connections. Set to 0 for no limit.\n             -->\n        <parameter>\n            <name>maxActive</name>\n            <value>100</value>\n        </parameter>\n<!-- Omit other config -->\n    </ResourceParams>\n    <!-- This is not working -->\n<!--    <Resource name=\"mail/Session\" auth=\"Container\"\ntype=\"javax.mail.Session\"/>-->\n<!--    <ResourceParams name=\"mail/Session\">-->\n<!--        <parameter>-->\n<!--            <name>mail.smtp.host</name>-->\n<!--            <value>localhost</value>-->\n<!--        </parameter>-->\n<!--    </ResourceParams>-->\n</Context>\n\nserver.xml:\n\n?xml version=\'1.0\' encoding=\'utf-8\'?>\n<Server>\n  <Listener className=\"org.apache.catalina.mbeans.ServerLifecycleListener\"/>\n  <Listener\nclassName=\"org.apache.catalina.mbeans.GlobalResourcesLifecycleListener\"/>\n  <GlobalNamingResources>\n    <Environment name=\"simpleValue\" type=\"java.lang.Integer\" value=\"30\"/>\n    <Resource auth=\"Container\" description=\"User database that can be updated\nand saved\" name=\"UserDatabase\" type=\"org.apache.catalina.UserDatabase\"/>\n    <Resource name=\"mail/Session_send\" type=\"javax.mail.Session\"/>\n    <ResourceParams name=\"UserDatabase\">\n      <parameter>\n        <name>factory</name>\n        <value>org.apache.catalina.users.MemoryUserDatabaseFactory</value>\n      </parameter>\n      <parameter>\n        <name>pathname</name>\n        <value>conf/tomcat-users.xml</value>\n      </parameter>\n    </ResourceParams>\n    <ResourceParams name=\"mail/Session_send\">\n      <parameter>\n        <name>mail.smtp.host</name>\n        <value>smtp.host.net</value>\n      </parameter>\n    </ResourceParams>\n  </GlobalNamingResources>\n <Service name=\"Catalina\">\n    <Connector acceptCount=\"100\" connectionTimeout=\"20000\"\ndisableUploadTimeout=\"true\" port=\"8080\" redirectPort=\"8443\">\n    </Connector>\n    <Connector port=\"8009\" protocol=\"AJP/1.3\"\nprotocolHandlerClassName=\"org.apache.jk.server.JkCoyoteHandler\" redirectPort=\"8443\">\n    </Connector>\n    <Engine defaultHost=\"localhost\" name=\"Catalina\">\n      <Host appBase=\"webapps\" name=\"localhost\">\n        <Logger className=\"org.apache.catalina.logger.FileLogger\"\nprefix=\"localhost_log.\" suffix=\".txt\" timestamp=\"true\"/>\n      </Host>\n      <Logger className=\"org.apache.catalina.logger.FileLogger\"\nprefix=\"catalina_log.\" suffix=\".txt\" timestamp=\"true\"/>\n      <Realm className=\"org.apache.catalina.realm.UserDatabaseRealm\"/>\n    </Engine>\n  </Service>\n</Server>\n\nthanks for your time\n\nbill5.0.25 has a known issue with the naming-factory.jar missing the \njavax.mail.Session factory support.  Use 5.0.27.  I\'m going to close this issue \nas I\'m 99\% sure this is the problem, but if I\'m wrong feel free to reopen the \nissue and change the version from 5.0.25 to 5.0.27.  Thanks.This has been re-opened but no additional comment provided. Closing again as\nfixed based on Yoav\'s last comment.',?,BUG
30159,'Incorrect spelling of word in .jspx example','Tomcat 5',Webapps:Examples,jadecristal,dev,'In the examples application, the word \"prove\" is spelled \"proove\" at path, in\nthe last line of generated code (where the current date/time is displayed):\n\n/jsp-examples/jsp2/jspx/basic.jspx\n\nVersion: the current release, 5.0.27 - not shown in the Apache Bug Database\nVersion selection box.',?,DOCUMENTATION
30179,'Not all entries in catalina.properties are correctly used by the classloaders','Tomcat 5',Catalina,thorsten.kamann,dev,'In catalina.properties I can define path to use for the classloaders.\nThe entry ${catalina.home}/ext/lib/*.jar does work, bit if I want to add only\none special jar in combination of the placeholder ${catalina.home} or\n${catalina.base} this doesn\'t work, eg:\n${catalina.home}/ext/lib/test.jar\n\nThe resolution for this bug is in the attached patch.\n\nBest regards\nThorstenCreated attachment 12155\nThis patch resolves the problem with the classloaders and the catalina.properties entriesPatch applied in TOMCAT_5_0 branch.  Patch applied in CVS_HEAD.  Thanks!',?,BUG
30239,'Connector documentation is not up-to-date for IIS 6','Tomcat 5',Native:Packaging,jessh,dev,'The IIS portion of the Tomcat connector documentation makes no mention of the\nextra steps required to get the connectors working with IIS 6.  These are\nclearly documented elsewhere on the web\n(http://www.rit.edu/~ack5504/tomcat-iis6-howto/tomcat-iis6-howto.html amongst\nother places), so there is little reason not to incorporate this information. \nNot bundling this information leaves most people attempting this configuration\ncompletely lost -- and they just give up.- Added link to this IIS how-to document in Wiki pages\n- Updated JK IIS how-to page with section on IIS 5 and 6 which points readers \nto the wiki page with the many how-to links and references.\n\n(These changes will be visible next time the docs site is updated, and of \ncourse in the next releases).',?,DOCUMENTATION
30241,'Enhance build script to use branch argument when checking out files','Tomcat 5',Catalina,yoavs,dev,'With the TOMCAT_5_0 branch now effective, the build files need to be modified \nso that when they check out from CVS they use a branch directive.  The default \nshould of course be HEAD.Already done, cool ;)  See cvstag property in build.xml.',?,RFE
30245,'Documentation omission','Tomcat 5',Unknown,neriuslandys,dev,'This is a documentation bug.  My motivation for filing this bug is that I wanted\nto have a tomcat AJP 1.3 connector bind to 127.0.0.1 instead of grabbing an\nexternal IP - not finding documentation on how to do this I consulted the source\ncode.  Reading the source code for\norg/apache/coyote/tomcat5/CoyoteConnector.java gave me the idea to try an\n\'address=\"127.0.0.1\"\' attribute in a <Connector /> definition in my server.xml\nconfig file.  Adding such an attribute to the Connector definition did indeed\nachieve my desired affect.\n\nPerhaps the documentation at the URL\nhttp://jakarta.apache.org/tomcat/tomcat-5.0-doc/config/ajp.html should document\nthe use of the \"address\" attribute in some or all Connectors.Fixed documentation, thanks.SERA QUE SI, DONDE ESTA EL ECADESSSSSS',?,DOCUMENTATION
30289,'Wrong SMAP mappings with body dependent tags','Tomcat 5',Jasper,martin.grebac,dev,'The actual debugger bug description is here:\nhttp://www.netbeans.org/issues/show_bug.cgi?id=45360\n\nSee attached web app - important files are mostly these:\nWebApplication3/web/index.jsp and \nWebApplication3/build/generated/src/org/apache/jsp/index_jsp.class.smap\nWebApplication3/build/generated/src/org/apache/jsp/index_jsp.java\n\nI think that issue 29638\n(http://issues.apache.org/bugzilla/show_bug.cgi?id=29638) mentions the same.\n\nMapping part of the smap for index.jsp looks like this:\n\n1,4:57\n4:81,29\n4,7:93\n10,3:63\n\nI believe the second mapping shouldn\'t be there, because then it causes debugger\nto completely skip the contents of the tag body and also breakpoints in those\nareas are not reflected. This is quite serious issue, as it makes debugging of\njsps with tags (like from Jstl and Struts, e.g.) completely unusable.Created attachment 12199\nweb application with all the needed filesFixed in CVS.  Thanks for reporting.',?,BUG
30291,'Wrong smap in expressions and scriptlets','Tomcat 5',Jasper,martin.grebac,dev,'See attached .zip file for the actual files. One of problems is e.g. in this\nmapping line:\n9,4:50\nwhich does not correspond with the actual lines.Created attachment 12217\nzip with filesFixed in CVS.  Thnaks for reporting.',?,BUG
30314,'Review new HostConfig and add something','Tomcat 5',Catalina,pr,dev,'Hello Remy,\n\nI have look inside the new HostConfig. Great!\n\nFind some FIXME answer and fix small bugs.\n   see my comments and questions.\n\nHow we can add the watch resource support?\n\n- Look for WEB-INF/web.xml, conf/<enginename>/<host>/<app>.xml\n  Changeses add war File\n- How we can handle remove work/ explanded War Dirs\n   see my removeContextAp\n- Why we change the deploy order at deployApps?\n    5.0.xx has\n        descriptors\n        wars\n        directory\n    New HostConfig\n        descriptors\n        directory\n        wars\n    Problem are\n     expanded wars without META-INF/context.xml - After restart only\n     directory are deployed!\n\nToDo:\n    Add Watch Ressouces support\n    Refactoring for long methods and some small code duplications\n    Test, Test\n    Check LocalStrings\n\n\nregards\npeter\n\n\n\n\nregards.Created attachment 12214\nHostConfig with Fixes and new questionsCreated attachment 12215\nChanged LocalString for HostConfigI think it\'s really difficult to jump in the middle of someone\'s patches (which\nI committed mostly for backup purposes - not that I expect my brand new laptop\nto fail right away, but you never know ;) ) without causing conflicts.\nI\'ll obviously make tons of adjustments, but not all in the direction of your\npatch (you try too much to blend the old stuff with the new stuff, which wasn\'t\nmy intention, otherwise there\'s no point rewriting the code).I committed some updated code, which seems to work, more or less. It\'s not done\nyet, but it\'s getting there. Some of your suggestions were good, thanks (but you\nshould post them on tomcat-dev, probably).Hello Remy,\n\nyou mean that post better patches and comments at the tomdev list? \n\nregards\nPeterYes, to talk about development issues, I think it\'s better.',?,IMPROVEMENT
30325,'[PATCH] $CATALINA_HOME set unconditionally in bin/catalina.sh','Tomcat 5',Catalina,guillaume,dev,'...whereas in bin/catalina.bat it is only set if not defined, as documented.Created attachment 12226\nPatch not to set $CATALINA_HOME if already defined (applies to bin/catalina.sh).Provided patch to fix the problem. Done on Tomcat 5.0.27 but works on 5.0.25 as\nwell.This seems reasonable.  Patch committed.  Thanks.',?,BUG
30346,'service.bat did not work properly; Unable to find a javac compiler','Tomcat 5',Unknown,leif.hanack,dev,'When using the /bin/service.bat on a windows system the service is created, \nbut seems to leave a not 100\% functional tomcat. tomcat is starting fine. If \nyou browse a uncompiled jsp, you receive the following message:\n\n..\norg.apache.jasper.JasperException: Unable to compile class for JSP\n..\nUnable to find a javac compiler;\ncom.sun.tools.javac.Main is not on the classpath.\nPerhaps JAVA_HOME does not point to the JDK\n\torg.apache.tools.ant.taskdefs.compilers.CompilerAdapterFactory.getCompi\nler(CompilerAdapterFactory.java:106)\n..\n\nThe environment variables are set correct! Running the /bin/startup script \neverything works fine, i.e. jsp\'s got compiled correct.\n\nAt my web-search i found people who have the same problem, but i couldn\'t \nfound the bug in the database. Someone tell to use the windows-installer-exe \n(jakarta-tomcat-5.0.27.exe) and define the JAVA_HOME to use. I\'ve done this \nand the guy was right. \n\nThe service that was installed within the installation process of jakarta-\ntomcat-5.0.27.exe works fine. This service compiles jsp\'s as well, but the \nservice.bat did not!\n\nIt would be great to hear soon from you:)\n\nThanks in advance, LeifIf you want to hear from us, the mailing lists are a better place than \nBugzilla.  And if you want hear positive feedback, please post suggested \npatches and/or test cases with your bugs when possible ;)  Thanks.Just closing the bug report :)\nAlready fixed in the CVS.\n',?,OTHER
30352,'CLIENT-CERT auth doesn\'t work with DataSourceRealm and JDBCRealm','Tomcat 5',Catalina,tilk,dev,'CLIENT-CERT authentication, as defined in RealmBase, requires working\ngetPrincipal() method. However, DataSourceRealm and JDBCRealm have dummy\ngetPrincipal(), which always returns null, so CLIENT-CERT auth doesn\'t work with\nthese realms. Why is it like that? Will it be fixed?Did you actually try testing CLIENT-CERT authentication? ;)  It works.  Check \nout http://marc.theaimsgroup.com/?l=tomcat-user&m=109275632305374&w=2 for \nexample.Are you, like, totally brain-dead?  CLIENT-CERT auth only works with \nMemoryRealm and (in 5.5.x) UDBRealm.  With the other Realms, it\'s just like the \nreporter states it is.  The example URL you give (marc.theaimsgroup.com) has role-name *. If web.xml \nhas inside security-role any role-name other than * then tomcat will give 403 \nto users in that role.Changing this to an enhancement request.  OP, if you want to work on this, a \npatch would be gladly welcome.This is now fixed in CVS for TC5.5.x',?,RFE
30359,'If installed as service by Installer tempdir property is invalid','Tomcat 5',Native:Integration,wknauf,dev,'During install I choose the option to install Tomcat as a service. \n\nAfterwards I found out that the Java property \"java.io.tmpdir\"\n(System.getProperty(\"java.io.tmpdir\") ) pointed to the tomcat base dir (in my\ncase: \"D:\\Programme\\Apache Group\\Tomcat5\", not to the \"temp\" subdir\n(\"D:\\Programme\\Apache Group\\Tomcat5\\temp\").\n\nIn the \"service.bat\" file this is correctly specified\n(\"-Djava.io.tmpdir=\%CATALINA_BASE\%\\temp\").\n\nSo this was my workaround: remove the service, reinstall it with this file.\n\nThe OS is Windows Server 2003.Fixed in the CVS.\nThx. for spotting that',?,BUG
30415,'DocBase folders that end with .war are incorrectly handled as WAR files','Tomcat 5',Catalina,miles.chaston,dev,'If a \"Context\" is defined with a doc base that is a folder ending with \".war\", \nthe SetDocBaseRule class misinterprets that as a WAR file that it needs to read \nusing ExpandWar.  This fails with the following stack trace:\n\njava.util.zip.ZipException: Access is denied\n        at java.util.zip.ZipFile.open(Native Method)\n        at java.util.zip.ZipFile.<init>(ZipFile.java:112)\n        at java.util.jar.JarFile.<init>(JarFile.java:127)\n        at java.util.jar.JarFile.<init>(JarFile.java:65)\n        at sun.net.www.protocol.jar.URLJarFile.<init>(URLJarFile.java:55)\n        at sun.net.www.protocol.jar.URLJarFile.getJarFile(URLJarFile.java:40)\n        at sun.net.www.protocol.jar.JarFileFactory.get(JarFileFactory.java:78)\n        at sun.net.www.protocol.jar.JarURLConnection.connect\n(JarURLConnection.java:85)\n        at sun.net.www.protocol.jar.JarURLConnection.getJarFile\n(JarURLConnection.java:69)\n        at org.apache.catalina.startup.ExpandWar.expand(ExpandWar.java:155)\n        at org.apache.catalina.startup.SetDocBaseRule.begin\n(SetDocBaseRule.java:129)\n        at org.apache.commons.digester.Digester.startElement(Digester.java:1273)\n        at org.apache.catalina.util.CatalinaDigester.startElement\n(CatalinaDigester.java:65)\n        at org.apache.xerces.parsers.AbstractSAXParser.startElement(Unknown \nSource)\n...\n\nWhat should happen is that the folder is recognized as such and read like \nnormal.  This bug (or at least the effect) has existed since at least tomcat \n4.1.27.\n\nPossible fix note:\nThe problem comes from SetDocBaseRule line 123.  If the test first looked to \nsee if it was a folder, this problem could be avoided.How about not using .war as a docBase? ;)Fixed on TOMCAT_5_0 branch.  I\'ll take a look at CVS HEAD, but this might not \nbe relevant for Tomcat 5.5.  I still think it\'s a dubious use-case that should \nbe avoided.',?,IMPROVEMENT
30561,'NamingService doesn\'t correctly start/stop','Tomcat 5',Catalina,dev,dev,'1/ When you start the NamingService for the first time, with no\nContext.INITIAL_CONTEXT_FACTORY property, everything works fine. The default\nvalue is null.\n\n2/ When you stop the NamingService, the property is then \"\", and not null.\n\n3/ If you want to restart the NamingService, the \"oldValue\" isn\'t null and so\nit\'s used. So, the NamingService doesn\'t start.\n\nThis is my solution, in the start method:\n\noldValue = System.getProperty(Context.INITIAL_CONTEXT_FACTORY);\nif (oldValue != null >>>>>>>> && oldValue.length() > 0 <<<<<<<<<) {\n   oldIcValue = oldValue;\n} else {\n   System.setProperty(Context.INITIAL_CONTEXT_FACTORY, Constants.Package \n     + \".java.javaURLContextFactory\");\n}\n\nNow, when you start + stop + start the NamingService, the service works fine.\n\n\nFredericDone as suggested.  Thanks ;)',?,BUG
30568,'Cannot find daemon loader','Tomcat 5',Catalina,bugdatabase.tomcat.jgombos,dev,'There are multiple defects.  Some are likely to be defects with the Gentoo \ndistribution of Tomcat5, and at least one of the defects (documented below) is \nin Catalina.  For the history of installation issues, see the following two \nURLS:\n\n  http://forums.gentoo.org/viewtopic.php?t=208259\n  http://bugs.gentoo.org/show_bug.cgi?id=59899\n\nI spotted another report of this issue in an Apache mailing list:\n\n  http://www.mail-archive.com/commons-dev@jakarta.apache.org/msg30457.html\n\nSkipping the installation issues (because they may be in the scope of the \nGentoo folks), I will go right to the problem that results following a manual \ninstall as per the Tomcat documentation.\n\nExecution of:\n\n    cd $CATALINA_HOME\n    ./bin/jsvc -Djava.endorsed.dirs=./common/endorsed -cp ./bin/bootstrap.jar \\\n        -outfile ./logs/catalina.out -errfile ./logs/catalina.err \\\n        org.apache.catalina.startup.Bootstrap\n\nResults in:\n\n  jsvc.exec error: Cannot find daemon loader \n    org/apache/commons/daemon/support/DaemonLoader\n  jsvc.exec error: Service exit with a return value of 1\n\nI see no reason why jsvc would not be able to find the Daemon Loader.  The JAR \nfile is in the $CATALINA_HOME/bin folder, and looking at the table of contents \nreveals the class that jsvc cannot find.\n\nAlso, it may still be worthwhile to look at the Gentoo installation issues, \nbecause the ./configure script that comes packaged with Tomcat fails when \nuname -m returns \"ppc64\".I don\'t have a Gentoo system to test.  This works for me on Solaris and RHEL by \nfollowing the Tomcat docs, no problem.\n\nbootstrap.jar includes commons-daemon.jar in its manifest Class Path.  If \ncommons-daemon.jar is in the same directory with the proper file permissions, \nyou should have no problem with this.  If you do have a problem, it\'s a \nconfiguration or installation issue, not a Tomcat bug.\n\nFinally, please use separate Bugzilla issues for separate bugs, don\'t combine \nthem.  For example, the ./configure script bug you report should be a separate \nissue.  (That one as I mentioned I can\'t test because I don\'t have a Gentoo \nsystem).  Thanks.\nI see this same issue with Tomcat-5.0.28 binary distribution (on RedHat Linux 9\nand J2SDK-1.4.1).\nFollowed the instructions at\nhttp://jakarta.apache.org/tomcat/tomcat-5.0-doc/setup.html\nand get the same problems and described in this issue.\n\nFollowing $CATALINA_HOME/RUNNING.txt and using startup.sh is okay.\nOK, if you want, please submit doc patches for setup.xml and I\'ll modify that \nfile so that the instructions are correct.Perhaps you misinterpret my comments. The documentation describes two different\nways to start Tomcat. The method described in RUNNING.txt works okay. The method\ndescribed in setup.html fails with this \"daemon loader\" error.I understand your comments, I think ;)  I\'m asking you to provide a diff patch \nof setup.xml so that it is correct.OK, I\'ve added a note to cover this situation to the setup.xml (which becomes \nsetup.html) files, on both the Tomcat 5.0 and 5.5 branches.  Thanks for \nreporting this issue.',?,DOCUMENTATION
30583,'Cannot switch of tld scan for Embedded tomcat','Tomcat 5',Catalina,Christian.Pesch,dev,'Hi,\n\nI\'m using the Embedded tomcat 5.0.27 for servlets only. So a minimalistic setup\nis ok. When starting up, the StandardContext does a TLD scan, which fails als it\nfinds a TLD, which is not meant to be used in this setup:\n\njava.lang.NullPointerException\n        at\norg.apache.catalina.startup.DigesterFactory.register(DigesterFactory.java:174)\n        at\norg.apache.catalina.startup.DigesterFactory.registerLocalSchema(DigesterFactory.java:130)\n        at\norg.apache.catalina.startup.DigesterFactory.newDigester(DigesterFactory.java:92)\n        at\norg.apache.catalina.startup.TldConfig.createTldDigester(TldConfig.java:408)\n        at org.apache.catalina.startup.TldConfig.tldScanStream(TldConfig.java:508)\n        at org.apache.catalina.startup.TldConfig.tldScanJar(TldConfig.java:472)\n        at org.apache.catalina.startup.TldConfig.execute(TldConfig.java:307)\n        at org.apache.catalina.core.StandardContext.start(StandardContext.java:4282)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1083)\n        at org.apache.catalina.core.StandardHost.start(StandardHost.java:789)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1083)\n        at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:478)\n        at org.apache.catalina.startup.Embedded.start(Embedded.java:846)\n        at\ncom.coremedia.servlet.tomcat.EmbeddedTomcat.start(EmbeddedTomcat.java:118)\n\nPlease consider making the TLD scan optional, as thought about in \nStandardContext:\n\norg.apache.catalina.core.StandardContext, line 4260ff\n\n               // Read tldListeners. XXX Option to disable\n                TldConfig tldConfig = new TldConfig();\n                tldConfig.setContext(this);\n\nThe workaround to overwrite this large start() method is not very elegant\nand error prone.OK, feature added.  StandardContext now has a processTlds attribute which you \ncan set to false in your use-case.  I also took processTlds() out of the big \nstart() method so that classes extending StandardContext can easily modify \nprocessTlds behavior.  All of this will be available in Tomcat 5.0.29 and 5.5.0.',?,RFE
30587,'ExtendedAccessLogValve typo for  x-H(requestedSessionIdValid)','Tomcat 5',Catalina,funkman,dev,'Per the link there\'s a typo in ExtendedAccessLogValve. The link has a PATCH too. \n\nJust copying from the tomcat-dev list - so its not lost.OK, fixed.  Thanks for submitting the patch.',?,DOCUMENTATION
30602,'Subject is not available during the first call to the servlet which use the basic authentication','Tomcat 5',Catalina,jjureta,dev,'Hi,\n\nI’m using jakarta-tomcat-5.0.27-src and Windows XP.\n\nI made a servlet that print current subject principals (authenticated user).\nThe servlet code is:\n\n<code>\nprivate void doQuery(\nHttpServletRequest request,\nHttpServletResponse response)\nthrows ServletException, IOException {\n\nresponse.setContentType(\"text/html\");\nPrintWriter out = response.getWriter();\n\nout.println(\"<HTML>\");\nout.println(\"<HEAD>\");\nout.println(\"<TITLE>TestServletProtected</TITLE>\");\n\nout.println(\"<META HTTP-EQUIV=\\\"Pragma\\\" CONTENT=\\\"no-cache\\\">\");\nout.println(\"<META HTTP-EQUIV=\\\"Expires\\\" CONTENT=\\\"-1\\\">\");\n\nout.println(\"</HEAD>\");\n\nout.println(\"<BODY>\");\n\nout.println(\"<br>\");\nout.println(request.getAuthType());\nout.println(\"</br>\");\nout.println(\"<br>\");\nout.println(request.getRemoteUser());\nout.println(\"</br>\");\nout.println(\"<br>\");\nout.println(request.getUserPrincipal());\nout.println(\"</br>\");\nout.println(\"<br>\");\nout.println(request.isUserInRole(\"tomcat\"));\nout.println(\"</br>\");\nout.println(\"<br>\");\nout.println(request.isUserInRole(\"admin\"));\nout.println(\"</br>\");\n\nSubject subject = Subject.getSubject(AccessController.getContext());\nout.println(\"<br>\");\nout.println(subject);\nout.println(\"</br>\");\n\nsubject =\n(Subject) request.getSession(true).getAttribute(\n\"javax.security.auth.subject\");\n\nout.println(\"<br>\");\nout.println(subject);\nout.println(\"</br>\");\nout.println(\"</BODY>\");\n\nout.println(\"</BODY>\");\nout.println(\"</HTML>\");\n\nout.close();\n    }\n</code>\n\nThe first time I call this servlet I get:\nBASIC \ntomcat \nGenericPrincipal[tomcat(admin,manager,tomcat,)] \ntrue \ntrue \nnull \nnull\n\nThe next time I get:\nBASIC \ntomcat \nGenericPrincipal[tomcat(admin,manager,tomcat,)] \ntrue \ntrue \nSubject: Principal: GenericPrincipal[tomcat(admin,manager,tomcat,)] \nSubject: Principal: GenericPrincipal[tomcat(admin,manager,tomcat,)]\n\nI found that SecurityUtil.execute trying to find the subject in the current \nsession, \nbut because the session is not been created yet, the subject passed to the \nfunction \nSubject.doAsPrivileged is null.\n\nWhen I changed the code in the function SecurityUtil.execute to:\n\n// The first argument is always the request object\nif (targetArguments != null \n&& targetArguments[0] instanceof HttpServletRequest){\nHttpServletRequest request = \n(HttpServletRequest)targetArguments[0];\n\nHttpSession session = request.getSession(false);\nif (session != null){\nsubject =        (Subject)session.getAttribute(Globals.SUBJECT_ATTR);\n}\n                \nif ((subject == null) && (principal != null)){\nsubject = new Subject();\nsubject.getPrincipals().add(principal);\n                        \nif(session != null) {\nsession.setAttribute(Globals.SUBJECT_ATTR, subject);\n}\n}\n}\n\nEverything looks OK except that the subject is not in the session \n(request.getSession(true).getAttribute(\n\"javax.security.auth.subject\"); return null).I will investigate more, but your fix make sense. More to come.\n\n-- Jeanfrancois Fixed. Will be available in the next release of Tomcat 5.\n\nMerci :-)\n\n-- Jeanfrancois',?,BUG
30615,'Installing Tomcat as a Windows Service fails to recognize non-standard service name','Tomcat 5',Unknown,smcrae,dev,'Usinng service.bat to install Tomcat 5 as a Windows service does not respect \nthe service name passed from the command line. Error appears to be in line 64 \nof service.bat:\n\nERRANT:  set PR_DISPLAYNAME=Apache Tomcat\n\nCORRECT: set PR_DISPLAYNAME=\%SERVICE_NAME\%\n\nOptionally there could be hard coded values in there like this: (our solution)\n\nOPTIONAL: set PR_DISPLAYNAME=Apache Tomcat \%SERVICE_NAME\%Well, It\'s not a major bug :)\n\nAnyhow the patched version is in the CVS.\nIt sets the display name to a different value ony if the service name\nhas been provided at the command line.\nCool, thanks. Only marked it as major since the install fails if you attempt to \ninstall the service multiple times (like we do). The script runs and fails but \nstill says the service was installed. Perhaps there should be a check for the \nreturn value from the executable to indicate success/failure in the file?',?,BUG
30624,'unable to load tiles-definition.war when running embedded tomcat','Tomcat 5',Catalina,sudhir.srinivas,dev,'I was prototyping using tomcat embedded in my java application. Was trouble \nhaving launch a webapp based on tiles/struts. i got this error when i tried to \nrun the standard example of tiles-definiton.war. This war properly loads when \nrunning tomcat as a stand alone web container.\n\n\njava.lang.NullPointerException\n        at org.apache.catalina.realm.RealmBase.findSecurityConstraints\n(RealmBase\n.java:428)\n        at org.apache.catalina.authenticator.AuthenticatorBase.invoke\n(Authentica\ntorBase.java:455)\n        at org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValv\neContext.java:102)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.jav\na:520)\n        at org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.j\nava:137)\n        at org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValv\neContext.java:104)\n        at org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.j\nava:117)\n        at org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValv\neContext.java:102)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.jav\na:520)\n        at org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineVal\nve.java:109)\n        at org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValv\neContext.java:104)\n        at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.jav\na:520)\n        at org.apache.catalina.core.ContainerBase.invoke\n(ContainerBase.java:929)\n\n        at org.apache.coyote.tomcat5.CoyoteAdapter.service\n(CoyoteAdapter.java:16\n0)\n        at org.apache.coyote.http11.Http11Processor.process\n(Http11Processor.java\n:799)\n        at \norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.proce\nssConnection(Http11Protocol.java:705)\n        at org.apache.tomcat.util.net.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java\n:577)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadP\nool.java:683)\n        at java.lang.Thread.run(Thread.java:534)Created attachment 12409\nthe java file that i compile to run tomcat embeddedI\'ve added better null checking in RealmBase#findSecurityConstraints on both \nthe TOMCAT_5_0 and CVS HEAD branches.  Thanks for pointing this out.We have seen this bug on 5.5.23\n\njava.lang.NullPointerException\nat org.apache.catalina.realm.RealmBase.findSecurityConstraints(RealmBase.java:501)\nat\norg.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:426)\n\nPlease assert the necessity to reopen, or spin off a bug for the 5.5.x branch.\nThanks.\n',?,BUG
30636,'NullPointerException in DigesterFactory','Tomcat 5',Catalina,rgrzywinski,dev,'A misconfigured server will cause the following:\n\njava.lang.NullPointerException\n\tat org.apache.catalina.startup.DigesterFactory.register\n(DigesterFactory.java:174)\n\tat org.apache.catalina.startup.DigesterFactory.registerLocalSchema\n(DigesterFactory.java:139)\n\tat org.apache.catalina.startup.DigesterFactory.newDigester\n(DigesterFactory.java:92)\n\tat org.apache.catalina.startup.ContextConfig.createWebXmlDigester\n(ContextConfig.java:435)\n        ...\n\nThe defect occurs because a resource is loaded from the ClassLoader and is \nnever checked for null.  Lines 173 - 174 of \norg.apache.catalina.startup.DigesterFactory should be changed to:\n\n        URL url = DigesterFactory.class.getResource(resourceURL);\n        if(url == null)\n            throw new WhateverIsAnAppropriateException(<\"The resource \nidentified by \\\"\" + resourceURL + \"\\\" does not exist.\">);\n        /* else -- the URL for the resource exists */\n        schemaResolver.register(resourcePublicId , url.toString() );\n\nwhere the text in <>\'s is replaced with the appropriate resource bundle \nmechanism.\n\nI would recommend that a code audit is performed to determine other such uses \nof getResource(), getResourceAsStream(), etc without appropriate null checks to \nensure a consistent and pleasant user experience.Added Log and NPE checking to DigesterFactory.  Thanks.',?,BUG
30650,'Override Object.equals() in StandardSession','Tomcat 5',' JSP API',phps,dev,'Consider to override Object.equals() and Object.hashCode() in StandardSession\nor rather StandardSessionFacade. Isn\'t it a good idea, that equals() would\nreturn  something like: session.getId().equals(otherSession.getId()).\n\nIf its not a good idea, please add a explicit Javadoc comment that sessions are\nonly considered as equal if they are \"reference-equal\".I don\'t think it\'s a good idea when seen in light of clustering, and so I\'ve \nadded explicit comments as you requested.',?,DOCUMENTATION
30756,'MySQL DBCP Example on JNDI Datasource Documentation','Tomcat 5',Webapps:Documentation,s803738,dev,'MySQL DBCP Example Documentation\n\nThe following suggestions help to make sure that the example application works.\n\nSuggestions\n\n1. Add the \"flush privileges\" to the list of SQL commands for DBTest database\n2. To replace \"...Foo ${row.foo}...\" with \"... Foo <c:out value=\"${row.foo}\" /> ...\"\n3. TO replace \"...Bar ${row.bar}...\" with \"...Bar <c:out value=\"${row.bar}\" /> ... \"\n4. To include the following lines in the web.xml\n  <taglib>\n    <taglib-uri>http://java.sun.com/jsp/jstl/sql</taglib-uri>\n    <taglib-location>/WEB-INF/tlds/sql.tld</taglib-location>\n  </taglib>\n\n  <taglib>\n    <taglib-uri>http://java.sun.com/jsp/jstl/core</taglib-uri>\n    <taglib-location>/WEB-INF/tlds/c.tld</taglib-location>\n  </taglib>\n5. To include a sample directory structure about how the files are likely to be\nkept. For example,\n\n/DBTest/\n/DBTest/test.jsp\n/DBTest/WEB-INF\n/DBTest/WEB-INF/web.xml\n/DBTest/WEB-INF/lib/standard.jar\n/DBTest/WEB-INF/lib/jstl.jar\n/DBTest/WEB-INF/lib/*.jar\n/DBTest/WEB-INF/tlds/c.tld\n/DBTest/WEB-INF/tlds/sql.tld\n/DBTest/WEB-INF/tlds/*.tld\n/DBTest/WEB-INF/classes\n\n6. To replace the following sentence \"...Once you have JSTL, copy jstl.jar and\nstandard.jar to your web app\'s WEB-INF/lib directory...\" with the following\nsentence -> \"...Once you have JSTL, you can copy all the jar and tld files to\nyour web app\'s lib and tlds folders respectively ...\"7. There is also a problem with the web.xml example for mysql DBCP. It has a\ndouble open-tag:\n\n---------------\n<web-app xmlns=\"http://java.sun.com/xml/ns/j2ee\"\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n    xsi:schemaLocation=\"http://java.sun.com/xml/ns/j2ee\nhttp://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd\"\n    version=\"2.4\">\n<web-app> \n  <description>MySQL Test App</description>\n  ...\n---------------\n1 - Is it strictly necessary, and if so exactly what text should be there?\n2,3 - Are they strictly necessary?  I think they\'re just an alternative JSTL \nsyntax, so I won\'t add those now.\n4 - Is not needed.\n5 - Just clutters things up, that\'s why we have the First Webapp tutorial.\n6 - I don\'t like the vague alternative text, suggest something clearer maybe.\n7 - That\'s an error, I\'ve fixed it in CVS (both TOMCAT_5_0 and HEAD branches).\n\nThanks for your help.  Next time send .diff patches please.',?,DOCUMENTATION
30762,'destroy method in servlet called before contextDestroyed method in ServletContextListener class.','Tomcat 5',Unknown,dldiehl,dev,'I created an implementation of ServletContextListener and was expecting its \ncontextDestroyed(ServletContextEvent event) method to be invoked AFTER the \ndestroy() method of the single servlet for the web app.  The 2.4 servlet spec \nstates:\n\npublic void contextDestroyed(ServletContextEvent sce)\n  Notification that the servlet context is about to be shut down. All servlets \nand filters have been destroy()ed before any ServletContextListeners are \nnotified of context destruction.\n\n\nUsing Tomcat 5.0.25 and 5.0.27, the servlet destroy() method was invoked AFTER \nthe contextDestroyed() method, in violation of the spec.  I tried with and \nwithout <load-on-startup> in the web.xml to see if this made a difference, and \nit did not.\n\nNOTE:  The order of calls on the initialization side was correct and as I \nexpected.  The method contextInitialized(ServletContextEvent event) in my \nServletContextListener class was called before the init() methods of my \nservlet (and filters).Hmm, it seems you\'re right.  I\'m attaching a WAR that shows this behavior.  I\'m \nnot sure how we haven\'t detected this in our tests and the Sun TCK tests.  I\'ll \nask on tomcat-dev.Created attachment 12549\nA simple WAR showing this (writes to System.out)Fix committed on TOMCAT_5_0 branch.This bug seem to have revived in Tomcat 5.5.16 and currently present in Tomcat\n5.5.17.This has been re-fixed in SVN.\n\nThanks for the report.*** Bug 39038 has been marked as a duplicate of this bug. ***',?,BUG
30763,'would be nice to have \"failonerror\" attribute for UndeployTask','Tomcat 5',Catalina:Modules,edburns,dev,'It would be nice to be able to do <remove ... failonerror=\"false\"> in my\nbuild.xml file.Created attachment 12495\ntrivial fix for this trivial feature requestOK, done.  Thanks.',?,RFE
30770,'Crash on missing \"user-agent\" / compression enabled','Tomcat 5',Connector:HTTP,elmar,dev,'When accessing tomcat (in standalone mode and compression=\"on\") the server\nrefuses to handle any request if there is no user-agent transferred.\n\nIn catalina.out there is an exception noted:\n\nSCHWERWIEGEND: Error finishing response\njava.lang.NullPointerException\n        at\norg.apache.coyote.http11.Http11Processor.isCompressable(Http11Processor.java:1379)\n        at\norg.apache.coyote.http11.Http11Processor.prepareResponse(Http11Processor.java:1441)\n        at org.apache.coyote.http11.Http11Processor.action(Http11Processor.java:892)\n        at org.apache.coyote.Response.action(Response.java:180)\n        at\norg.apache.coyote.http11.InternalOutputBuffer.endRequest(InternalOutputBuffer.java:388\n        at\norg.apache.coyote.http11.Http11Processor.process(Http11Processor.java:836)\n        at\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http\n        at\norg.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:577)\n        at\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:683)\n        at java.lang.Thread.run(Thread.java:536)\n\nThe problem can be reproduced with the \"konqueror\" browser, there is an option\nnot to send browser identification. If browser-identification is send everything\ngoes right, if the switch is changed the error does occurr.Fixed now in the CVS, and should appear in the next Tomcat release.',?,BUG
30803,'WebApp classloader fails to load classes from CATALINA_HOME\\shared\\lib','Tomcat 5',Catalina,tal_f,dev,'In the case which my web application is located under CATALINA_HOME\\webapps \neverything works fine.\nBut, when I take the same web application and put it outside the tomcat \ndirectory and add a context.xml file to CATALINA_HOME\\conf\\Engine\\Host , this \ncontext points to the physical location of the webapp,what happens is that the \ncontext is loaded propelrly but when i try to activate my classes located \nunder my webapplication/lib in a jar file which are dependant on the mysql \njdbc jars which are located under CATALINA_HOME\\shared\\lib which is a valid \nplace according to the class loader delegation model I get a \nClassNotFoundException\nregarding the classes located under CATALINA_HOME\\shared\\lib in jar filesFixed in 5.0.28 and 5.5.2.Bug occurs in 5.0.30Works for me in 5.5.5 and 5.0.30, from a clean simple test.',?,BUG
30869,'JAAS module name is not allowed in jaas.conf file','Tomcat 5',Catalina,alex_blewitt,dev,'When running with the JAASRealm, the container sets the JAAS application name to \nbe the container\'s name:\n\n--- 8< --- JAASRealm.java --- 8< ---\npublic void setContainer(Container container) {\n  super.setContainer(container);\n  String name=container.getName();\n  if( appName==null  ) {\n    appName=name;\n    log.info(\"Setting JAAS app name \" + appName);\n  }\n}\n--- 8< --- JAASRealm.java --- 8< ---\n\nHowever, the container\'s name always starts with a /, which isn\'t an allowable\nname in the JAAS specification:\n\n--- 8< --- stdout --- 8< ---\n...\nINFO: Setting JAAS app name /MyApp\n...\n--- 8< --- stdout --- 8< ---\n\n--- 8< --- jaas.conf --- 8< ---\n/MyApp {\n  com.example.MyJAASLoginModule required;\n};\n--- 8< --- jaas.conf --- 8< ---\n\nThe Sun Security barfs at the \'/\' on leading MyApp, so it can\'t be speficied.\nThe default name \'Tomcat\' doesn\'t work either, because the JAAS name has already\nbeen set, and this cannot be set in the config file.\n\nInstead, you have to use \'other\' which is applicable to all apps in the application.\n\nThe fix would be to check whether there are any unprintable characters in the\napplication name, and if so, fix them. Of course, what constitutes an\nunprintable character is up to Sun\'s Configuration parser, which probably isn\'t\nthat good.\n\nA quick fix would be:\n\n--- 8< --- JAASRealm.java.fix --- 8< ---\npublic void setContainer(Container container) {\n  super.setContainer(container);\n  String name=container.getName();\n  if( appName==null  ) {\n    if (name.startsWith(\"/\")) name.substring(1);\n    appName=name;\n    log.info(\"Setting JAAS app name \" + appName);\n  }\n}\n--- 8< --- JAASRealm.java.fix --- 8< ---\n\nbut in reality, you\'d need to check for all other non-printable characters and\nreplace/delete them as appropriate, because a name may have other / characters\n(e.g. /MyApp/Other).Of course, I meant \'name=name.substring(1)\'.Can you point to the class or code in \"Sun Security\" that \"barfs\" at the \nleading slash please?  Also if you could attach your suggested patch in .diff \nformat, that\'d be great.  Thanks ;)I\'m not sure I can find the code for the barf, because I don\'t have the Sun\nsource code :-) \n\nI think the problem is in com.sun.security.auth.login.ConfigFile which is the\nclass reading the jaas.config file (actually, the name isn\'t relevant -- it\'s\nthe file pointed to by the URL in -Djava.security.auth.login.config or by\ndefault in ${user.home}/.java.login.config)\n\nThe JavaDoc isn\'t up to much: ConfigFile is\n\nhttp://java.sun.com/j2se/1.4.2/docs/guide/security/jaas/spec/com/sun/security/auth/login/ConfigFile.html\n\nwhich says it parses the file with the syntax described in:\n\nhttp://java.sun.com/j2se/1.4.2/docs/api/javax/security/auth/login/Configuration.html\n\nand all it says in there is\n\n\"Each entry in the Configuration is indexed via an application name.\n\nApplicationName {\n\t      ModuleClass  Flag    ModuleOptions;\n\t      ModuleClass  Flag    ModuleOptions;\n\t      ModuleClass  Flag    ModuleOptions;\n};\n\"\n\nSo Tomcat is setting the name OK programmatically, but the ConfigFile parser\nonly seems to allow [a-zA-Z]+ as the ApplicationName, so fails at the initial /\n\nThus, if you try and use a config file:\n\n/MyAppRoot {\n  com.example.LoginModule required;\n};\n\nthen the ConfigFile parser doesn\'t successfully read it.\n\nIt seems that the ConfigFile uses lazy loading, so it doesn\'t parse the first\nlogin request when using JAAS.\n\nSorry, can\'t paste in .diff format; I don\'t have the Tomcat source code on a\nmachine with a \'.diff\' command -- I just eyeballed the problem to find out why\nthe name was being set with a leading \'/\'.OK, done for both 5.0.29 and 5.5.3.  My initial implementation is simply to \nremove leading slash if one is present.  I made the relevant method protected \nso extenders of JAASRealm can easily modify this behavior.',?,BUG
30905,'Windows installed doesn\'t setup properly','Tomcat 5',Unknown,jerry.nelson,dev,'When running jakarta-tomcat-5.0.27.exe, the installer looks for j2re instead of \nj2sdk and the environment is not setup correctly.  Because of this, Tomcat \ncannot find Javac to compile JSP files, which means JSP web pages cannot run.  \nNo matter how you setup the environment manually, it still does not work.First of all it is not true. You can use tomcat5w and set the\nJVM desired.\nAnyhow this issue has been fixed in the cvs.\nWait for 5.0.28 that will be released next week.\n',?,BUG
30936,'Adding HTTPS Connector with Administration webapp mangles server.xml','Tomcat 5',Webapps:Administration,juha_motorsportcom,dev,'Installed Tomcat 5.0.28 from zip and installed as service with service.bat.\nService.bat did not work without modifications in 5.0.27, but now OK.\nModified service to use username Tomcat, started service, OK.\n\nAdded HTTPS-connector with Administration webapp, keystore configured to be in \nconf\\tomcat.keystore.\nKeystore also in user Tomcat home directory as .keystore, but no reference to \nit in configuration files.\n\nHitting Save button in Administration webapp did not change server.xml on disk, \nOK, https pages load OK with browser but certificate comes from .keystore file \nin user Tomcat home directory, not from configured file.\n\nHitting Save button and Commit changes buttons restarts? Tomcat and the \nserver.xml is modified with new Connector :\n\n    <Connector acceptCount=\"100\" connectionTimeout=\"20000\" \ndisableUploadTimeout=\"true\" port=\"8080\" redirectPort=\"8443\" \nmaxSpareThreads=\"75\" maxThreads=\"150\" minSpareThreads=\"25\">\n    </Connector>\n    <Connector port=\"8009\" protocol=\"AJP/1.3\" \nprotocolHandlerClassName=\"org.apache.jk.server.JkCoyoteHandler\" \nredirectPort=\"8443\">\n    </Connector>\n    <Connector keystoreFile=\"C:\\Ohjelmatiedostot\\jakarta-tomcat-5.0.28\n\\conf\\tomcat.keystore\" keystorePass=\"changeit\" port=\"8443\" redirectPort=\"-1\" \nscheme=\"https\" secure=\"true\" sslProtocol=\"TLS\" algorithm=\"SunX509\" \nclientauth=\"false\" keypass=\"changeit\" keystore=\"C:\\Documents and \nSettings\\Tomcat\\.keystore\" keytype=\"JKS\" protocol=\"TLS\" secure=\"true\">\n      <Factory className=\"org.apache.coyote.tomcat5.CoyoteServerSocketFactory\" \nkeystoreFile=\"C:\\Ohjelmatiedostot\\jakarta-tomcat-5.0.28\\conf\\tomcat.keystore\"/>\n    </Connector>\n\nstderr.log at the end of this email.\n\nthen HTTPS not working. Same problem with Tomcat 5.0.27.\nTomcat 5.0.19 with Save and Commit changes --> server.xml OK but needs stopping \nand starting Tomcat-service manually to read correct keystore file, then OK.\n\nRegards,\n\nJuha (Kuopio, Finland)\n\nstderr.log :\n\n30.8.2004 11:30:57 org.apache.commons.digester.Digester fatalError\nSEVERE: Parse Fatal Error at line 24 column 369: Attribute \"secure\" was already \nspecified for element \"Connector\".\norg.xml.sax.SAXParseException: Attribute \"secure\" was already specified for \nelement \"Connector\".\n\tat org.apache.xerces.util.ErrorHandlerWrapper.createSAXParseException\n(Unknown Source)\n\tat org.apache.xerces.util.ErrorHandlerWrapper.fatalError(Unknown Source)\n\tat org.apache.xerces.impl.XMLErrorReporter.reportError(Unknown Source)\n\tat org.apache.xerces.impl.XMLErrorReporter.reportError(Unknown Source)\n\tat org.apache.xerces.impl.XMLScanner.reportFatalError(Unknown Source)\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanAttribute\n(Unknown Source)\n\tat \norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanStartElement(Unknown \nSource)\n\tat \norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.\ndispatch(Unknown Source)\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument\n(Unknown Source)\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n\tat org.apache.xerces.parsers.XMLParser.parse(Unknown Source)\n\tat org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)\n\tat org.apache.commons.digester.Digester.parse(Digester.java:1548)\n\tat org.apache.catalina.startup.Catalina.load(Catalina.java:489)\n\tat org.apache.catalina.startup.Catalina.load(Catalina.java:528)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.apache.catalina.startup.Bootstrap.load(Bootstrap.java:250)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:424)\n30.8.2004 11:30:57 org.apache.commons.digester.Digester fatalError\nSEVERE: Parse Fatal Error at line 24 column 369: Attribute \"secure\" was already \nspecified for element \"Connector\".\norg.xml.sax.SAXParseException: Attribute \"secure\" was already specified for \nelement \"Connector\".\n\tat org.apache.xerces.util.ErrorHandlerWrapper.createSAXParseException\n(Unknown Source)\n\tat org.apache.xerces.util.ErrorHandlerWrapper.fatalError(Unknown Source)\n\tat org.apache.xerces.impl.XMLErrorReporter.reportError(Unknown Source)\n\tat org.apache.xerces.impl.XMLErrorReporter.reportError(Unknown Source)\n\tat org.apache.xerces.impl.XMLScanner.reportFatalError(Unknown Source)\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanAttribute\n(Unknown Source)\n\tat \norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanStartElement(Unknown \nSource)\n\tat \norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.\ndispatch(Unknown Source)\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument\n(Unknown Source)\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n\tat org.apache.xerces.parsers.XMLParser.parse(Unknown Source)\n\tat org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)\n\tat org.apache.commons.digester.Digester.parse(Digester.java:1548)\n\tat org.apache.catalina.startup.Catalina.load(Catalina.java:489)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:548)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:287)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:425)\n30.8.2004 11:30:57 org.apache.catalina.startup.Catalina start\nINFO: Server startup in 0 ms\njava.lang.reflect.InvocationTargetException\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:287)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:425)\nCaused by: java.lang.NullPointerException\n\tat org.apache.catalina.startup.Catalina.await(Catalina.java:619)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:579)\n\t... 6 moreHey,\n\nyes, that is a really existing problem. I have start to implement\na better saving server.xml mechanism. But believe me, that is currently\nnot easy. I hope at next week to commit a first version for Tomcat 5.5.0\n\nAfter testing, I will see to made a backport to 5.0.x release line.\n\nRegards\nPeterI actually think this might be much simpler: both the Connector and the \nProtocolHandler have a \"secure\" attribute, so the persister outputs it twice \nand Digester complains.  This is not an i18n issue like some other admin \npersistence errors.\n\nBTW, you\'re too late for 5.5.0 ;)*** Bug 30198 has been marked as a duplicate of this bug. ***One of my customers has experienced this problem lately.  For them, server.xml\nis modified every time Tomcat is restarted.  The only workaround I know of is to\noverwrite server.xml just before starting Tomcat, every time.\nThis should be fixed in the new storeconfig module that\'s shipping with Tomcat\n5.5.9, which itself will be out in a couple of days.  Can you please test it\nwhen you get a chance and let us know how it works?Sorry but cannot test for a while. I am on vacation for 2 months, soon sitting\nunder a palm tree in Barbados and sipping rum punch. Hopefully I don\'t see any\ncats named Tom while in Barbados ;)\n\n--juhaWhat a nice long vacation... If you do see any such cats, make sure to take a\npicture.  We could use nifty graphics...Almost 4 months later: can you please test the 5.5.9 StoreConfig enhancements to\nsee if they solve your problem?5.5.10 I hope solve the problem,\nbut I see no chance to make a backport from storeconfig to the 5.0.x code base.\n\nAfter returning from my vacation I forgot to test .... Sorry Yoavs ....\n\nThe reason is that I have moved to a completely different project, aviation\nrelated, and I have not had anything to do with Java, Tomcat or even web servers!\n\n--juha',?,IMPROVEMENT
30949,'After Failed Include, Request and Response not Unwrapped','Tomcat 5',Catalina,sdgoldst,dev,'In org.apache.catalina.core.ApplicationDispatcher.doInclude(ServletRequest \nrequest, ServletResponse response), after invoke() is called to perform the \ninclude, the request and response objects are normally unwrapped.  However, if \na ServletException or IOException is thrown, the unwrapping does not take place.\n\nThis leads to problems in environments in which cross context includes are \nbeing performed.  For example, \n\n1.  Web App A performs an include to a Servlet in Web App B\n2.  The Servlet in Web App B throws a ServletException\n3.  Web App A catches the ServletException and attempts to forward to an error \njsp.\n\nStep 3 above will fail due to the fact that the request has not been \nunwrapped.  The active request will contain the ServletContext of web app B and \nthe jsp file will not be found.Ok. Since I don\'t want to use a finally for that (as the exception is rethrown \nin invoke), I think moving the unwrapping in the invoke method (before the \ncode which rethrows the exception) would be appropriate.That seems like a reasonable solution.OK, I\'ve moved the ApplicationDispatcher unwrap requests to the invoke method \nas Remy suggested.  Done on both the Tomcat 5.0 and 5.5 CVS branches.I detect a similar problem with wrapped request at ApplicationDispatcher.forward und include.\nThe wrapped request are not recylced after an exceptions. Arrg!\n\n- With STRICT_SERVLET_COMPLAINS this means we have still a HTTPSession memory leak\n- and at cluster crossContext session replication are not triggered.\n\nCurrently the only chance I see, is a double try/catch implementation. Look at my checkin at tomcat \n5.5.24 revision  545127.\n\nBut I don\'t really like the double try/catch for wrapped request!\n\nPeterI\'m running into an issue that I think is a side effect of this patch. When\nforward() calls invoke() the request object now gets unwrapped. Then the forward\nmethod again tries to unwrap the already unwrapped request. As a result I am\ngetting a ClassCastException in unwrapRequest (ApplicationDispatcher.java:814).\nIt seems like unwrapRequest should be setting wrappedRequest to null before\nexiting so subsequent calls to the method don\'t do anything. Does this seem\nreasonable?Mike - having stepped through the code, I don\'t see the problem you are\ndescribing. If you still see the issue, please open a new Bugzilla item and\nprovide the steps to reproduce and/or a simple test war.I have committed a fix for this that doesn\'t require additional\ntry/catch/finally blocks. See r572854 (TC5.5.x) and r572856 (TC6.0.x)',?,BUG
30984,'Add an ability to compile JSPs to specified target JVM','Tomcat 5',Jasper,drzewo,dev,'I installed Tomcat 5.0.28 on W2K box. During installation I provided path to\nj2sdk 5.0 beta 3 build 60, therefore tools.jar has been taken from this\nparticular distro. After that I had been forced to switch JVM to IBM\'s 1.4.1\n(WebSphere 5.1 AppClient). Tomcat starts with no problem, however, Jasper\ncompiles JSP with javac from tools.jar (jvm 5.0 compliant) and makes compiled\nclasses unusable for the 1.4.1 jvm. \n\nThe simplest workaround is to overwrite tools.jar with the one that comes with\nthe jdk that tomcat is run on.  However, the simple solution is to provide the\n\"target\" parameter to JspServlet and pass it along to ant javac compiler. \n\n...Yes, I know we\'re going to get rid of ant compiler... ;) BTW, I wonder which\nversion of classes JDT will produce. Maybe this also should be up to the user to\ndecide?OK, added compilerTargetVM option to JspServlet and JspC.Based on mu recent experience, javac params source and target are interrelated.\nFor example, the default source version for the 5.0 RC b63 is 1.5 which implies\n1.5 as a target. For example using ant 1.6.2 on j2sdk1.5 (hell, cannot get used\nto switching to 5.0, either can Sun, I suppose ;) the following\n\n<javac target=\"1.4\" ... /> \n\nresults in:\n\n [javac] javac: target release 1.4 conflicts with default source release 1.5\n\nProviding source attribute to ant\'s javac task forces compiler to downgrade to\n1.4 sources.\n\n<javac target=\"1.4\" source=\"1.4\" ... /> \n\nI\'d be more than delighted if you could also provide the source parameter in the\nsame manner as you have done with the compilerTargetVM. BTW, I have no idea if\nthis also affects JDT. We\'re waiting for your patches :)Yes, this also affects JDT.  And please do NOT reopen one issue to ask for \nsomething else to be done, even if it\'s related.The reason why I reopened was the fact that the solution you provided\n*partially* works. What I wanted to point out is the fact that the \"target\"\nparameter alone seems not to be sufficient. Sorry for reopening but I still\nconsider adding \"source\" parameter is essential for this very enhancement to be\nfully functional. My bad I haven\'t indicated it in my initial submission. ',?,RFE
31001,'NPE and incorrect for MBeansFactory createStandardService method signature description in mbeans-descriptor.xml','Tomcat 5',Catalina,alexsmr,dev,'MBeansFactory createStandardService method has not correct descriptor:\n\n<operation   name=\"createStandardService\"\n       description=\"Create a new StandardService\"\n            impact=\"ACTION\"\n       returnType=\"java.lang.String\">\n   <parameter name=\"parent\"\n       description=\"MBean Name of the associated parent component\"\n            type=\"java.lang.String\"/>\n   <parameter name=\"name\"\n       description=\"Unique name of this Service\"\n            type=\"java.lang.String\"/>\n</operation>\n\nthe method signature however is createStandardService(String, String, String) \nthat results in runtime exception.\n\nEven if you specify correct parameters, the method will throw NPE on return \nstatement because the ObjectName for the service was not initialized.\n\nAlex.Fixed in TOMCAT_5_0 and CVS HEAD -- thanks for reporting it.',?,BUG
31018,'Race condition in SystemLogHandler.java','Tomcat 5',Unknown,rrg,dev,'The org.apache.tomcat.util.log.SystemLogHandler class (source code in\njakarta-tomcat-connectors) handles, among other things, capturing of\nSystem.out and System.err so that they can be redirected to an\napplication\'s log file.  It makes use of another class (CaptureLog) to\nhold the captured data, and maintains a stack of unused CaptureLog\ninstances to avoid creating new ones where possible.\n                                                                                \nThis \"reuse\" stack is global to the class and it looks like the use of\nit is not thread-safe.  The startCapture() method acquires a\nCaptureLog() this way:\n                                                                                \n    if (!reuse.isEmpty()) {\n        log = (CaptureLog)reuse.pop();\n    } else {\n        log = new CaptureLog();\n    }\n                                                                                \nThere\'s a race between the call to isEmpty() and the call to pop().\nWe\'ve been able to reliably elicit a java.util.EmptyStackException at\nthis point with an application under heavy load.\n                                                                                \nReplacing the above code with\n                                                                                \n    synchronized (reuse) {\n        log = reuse.isEmpty() ? new CaptureLog() : (CaptureLog)reuse.pop();\n    }\n                                                                                \neliminates the problem (with no effect on performance that we could\nobserve).\n                                                                                \nAn alternative approach might be to catch the (rare)\nEmptyStackException and treat it as equivalent to the isEmpty==true\ncase, but this seems cleaner.\n                                                                                \nThere would seem to be no need to synchronize the code that pushes\nold CaptureLog instances onto the reuse stack since java.util.Stack\nis already synchronized.Fixed, thanks.',?,BUG
31051,'Incorrect instruction in documentation file RUNNING.TXT','Tomcat 5',Unknown,lap_junior,dev,'To configure the Tomcat with JDK 1,4 in archive RUNNIN.TXT it says: \n\n\"(2) Place the compat package to jar in Tomcat\'s server classpath by copying it \ninto the #CATALINA_HOME/server/lib directory.\" ,\n\nbut the correct is unzip the package in $<catalina_home>\\Ooof, picky people ;)  I\'ve fixed it in CVS, thanks for pointing it out.',?,DOCUMENTATION
31052,'org.apache.naming.factory.BeanFactory does not propage root exceptions','Tomcat 5',Catalina:Modules,gawor,dev,'Only the error messages are propagated in the NamingException:\n\n            } catch (java.beans.IntrospectionException ie) {\n                throw new NamingException(ie.getMessage());\n            }\n\nSince some exceptions do not have a message associated with it, it is very hard \nsometimes to tell what went wrong from the NamingException. So it would be nice \nif the actual exception was chained with the NamingException. The change is \nsmall:\n\n            } catch (java.lang.IllegalAccessException iae) {\n                NamingException ex = new new NamingException(iae.getMessage());\n                ex.setRootCause(iae);\n                throw ex;\n            }\n\nAlso, there is a call to e.printStackTrace() which probably shouldn\'t be there.Now that we require JDK 1.4 where setRootCause is available, this fix is \npossible, so I\'ve done it in TOMCAT_5_0 and HEAD.  Thanks.Thanks! Btw, the setRootCause() method on NamingException was actually \navailable in 1.3.x (if not before that even).\n\n',?,IMPROVEMENT
31065,'unused import in jsp code causes failure in jdt compiler','Tomcat 5',Jasper,dillenbu,dev,'My jsp code includes a common \"init.jsp\" that in turn imports all my \npackages.  When I upgraded to tomcat 5.5.0, none of my jsp code worked because \nthe jdt compiler is much more restrictive.  I found the error and corrected it \nby modifying JDTCOmpiler.java as follows:\n\n*** jakarta-tomcat-\njasper/jasper2/src/share/org/apache/jasper/compiler/JDTCompiler.java\tSun \nSep  5 14:41:20 2004\n--- jakarta-tomcat-\njasper/jasper2/src/share/org/apache/jasper/compiler/JDTCompiler.java.orig\n\tSun Sep  5 14:41:05 2004\n***************\n*** 263,270 ****\n                       CompilerOptions.GENERATE);\n\n          settings.put(CompilerOptions.OPTION_ReportDeprecation,\n\n                       CompilerOptions.IGNORE);\n\n-         settings.put(CompilerOptions.OPTION_ReportUnusedImport,\n\n-                      CompilerOptions.IGNORE);\t\t\n\n  \n\n          if (ctxt.getOptions().getJavaEncoding() != null) {\n\n              settings.put(CompilerOptions.OPTION_Encoding,This is a widespread item (although prbably not best coding practice).  I found\nit in the jsp examples, e.g. cal1.jspFixed in 5.5.1.  We mistakingly treated unused import warnings as errors.',?,BUG
31090,'The session \"disappears\" when the context name contains the space character','Tomcat 5',Catalina,erania,dev,'Well, I am not quite sure it is a bug, but I lost one day to find where my\nproblem was, so it may be helpful :)\nWhen the context name contains a space character (\' \') everything works fine ,\nexcept that the session object in the request is null (and a new session is\ncreated when getSession is invoked ) even if a session has already been initialized.\nFor example:\npublic class MyServlet extends HttpServlet {\n\n    protected void doGet(HttpServletRequest request, HttpServletResponse response)\n            throws ServletException, IOException {\n       doPost(request, response);\n    }\n    \n    protected void doPost(HttpServletRequest request, HttpServletResponse response)\n            throws ServletException, IOException {\n      \n        response.setContentType(\"text/html\");\n        PrintWriter out = response.getWriter();\n        out.println(\"<html><body><a href=\\\"MyServlet\\\"> click me!</a><br>\");\n        out.println(request.getSession().getAttribute(\"hello\"));\n        out.println(\"</body></html>\");\n        request.getSession().setAttribute(\"hello\", \"Hello!\");\n        \n    }\n}\n\nWhen the context name contains a space (fo example: \"Sample Project\") and you\nload the page and click on the link, the result is always :\nclick me\nnull\n\nWhen you change the name to \"SampleProject\", the problem is gone.Where are you defining this context name?  In the web.xml (display-name \nattribute)?  In the context.xml file for the context?  Or explicitly by making \nit a directory in the webapps directory?In the server.xml.\nI am using Eclipse and a tomcat plugin for it. It defines the context in the\nserver.xml file.Can you attach your server.xml file to this report please?Created attachment 12843\nserver.xmlCreated attachment 12844\nThe Eclipse project for testingI\'ve verified your bug outside Eclipse, and I\'m attaching a WAR that lets one \nreproduce it on an out-of-the-box tomcat.  Deploying this war as \nSessionSpace.war versus \"Session Space.war\" shows the bug.\n\nI\'m updating the comopnent, platform, OS, version fields of the bug report as \nwell.Created attachment 12851\nWAR to reproduce bugThis is due to browsers not recognizing spaces in the session cookie\'s path. See\nthe headers from two hits to the example (from the war file by Yoav Shapira).\n\nI\'m attaching a patch to fix this.\nTested with MSIE 6 and Mozilla 1.7.2\n\n\nHeaders ========================================================\nhttp://localhost:8080/Sample\%20App/test\n\n\n\nGET /Sample\%20App/test HTTP/1.1\n\nHost: localhost:8080\n\nUser-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.7.2) Gecko/20040803\n\nAccept:\ntext/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5\n\nAccept-Language: en-us,en;q=0.5\n\nAccept-Encoding: gzip,deflate\n\nAccept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7\n\nKeep-Alive: 300\n\nConnection: keep-alive\n\nCache-Control: max-age=0\n\n\n\nHTTP/1.x 200 OK\n\nServer: Apache-Coyote/1.1\n\nSet-Cookie: JSESSIONID=33047CF84AA4E7159F1262C21D4FEA83; Path=/Sample App\n\nContent-Type: text/html;charset=ISO-8859-1\n\nContent-Length: 165\n\nDate: Wed, 13 Oct 2004 01:31:50 GMT\n\n----------------------------------------------------------\n\nhttp://localhost:8080/Sample\%20App/test\n\n\n\nGET /Sample\%20App/test HTTP/1.1\n\nHost: localhost:8080\n\nUser-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.7.2) Gecko/20040803\n\nAccept:\ntext/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5\n\nAccept-Language: en-us,en;q=0.5\n\nAccept-Encoding: gzip,deflate\n\nAccept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7\n\nKeep-Alive: 300\n\nConnection: keep-alive\n\nReferer: http://localhost:8080/Sample\%20App/test\n\nCache-Control: max-age=0\n\n\n\nHTTP/1.x 200 OK\n\nServer: Apache-Coyote/1.1\n\nSet-Cookie: JSESSIONID=82313411257D1DA54FDFD741D4E1FE78; Path=/Sample App\n\nContent-Type: text/html;charset=ISO-8859-1\n\nContent-Length: 165\n\nDate: Wed, 13 Oct 2004 01:32:03 GMT\n\n----------------------------------------------------------Created attachment 13058\nPatch to encode spaces in session cookie pathGood investigation and finding, OK patch.  OK because replaceAll is in JDK 1.4, \nso I can use the patch as-is for Tomcat 5.5, but for Tomcat 5.0 we need the \nsame thing in JDK 1.3-compatible format.  Maybe I\'ll just URLEncoder.encode the \ncookie\'s path?Ahh, good point.\n\nI originally went with the URLEncoder but it was encoding the \"/\" at the\nbeginning.  \n\nSo, to go this route, I would either need to strip out the \"/\" before encoding or \ndo a replace afterwards.  If characters other than spaces don\'t need to be considered, maybe use this\npatch on 5.5x. and use the URLEncoder for the older release?\n\nNote:  The Request class doesn\'t import URLEncoder yet so this means one more\nobject created for each request.  This needs to be added to the object creation\ninvolved with pulling and replacing the \"/\".   Probably trivial but I know there\nis a lot of effort being made to increase performance and it\'s a shame to add\nmore overhead just to support spaces in a context path. \n\n\n\n\nMaybe add a URL encoded path field on the Context. (URL encoding stuff all the\ntime is a bit expensive, and it could be needed)\nI\'ll try it later today.\n\nBTW, before making any changes: cookie values should be URL encoded then ? I\ndon\'t remember that, but maybe it\'s true. Can anyone confirm ?Actually, I think cookies shouldn\'t be URL encoded. See the ServerCookie class,\nand in particular the maybeQuote and isToken methods. Now \' \' isn\'t part of the\n\"special\" list anymore, for some reason.\n\nOTOH, the Cookie class from the servlet API includes:\n    private static final String tspecials = \",; \";\n\nI think the bug will only need a change there.IMHO, Remy\'s idea is best.  But it will throw an IAE since the session cookie \nis v0.  Probably we could just remove the version check in maybeQuote, since \nI\'m guessing that most UAs probably support quoted values, even if they don\'t \nsupport all of RFC2019.\n\nUsing the JDK1.3 j.n.URLEncoder is going to cause more problems then it will \never solve, given that it uses the platform encoding (which is unlikely to be \nutf-8 :).  If you have to encode the path, use the UEncoder in the Response.Ah, yes, I missed that \"small\" point. I thought I had a really good idea here ;)\n\nBTW, can you explain the tspecials descrepancy between the two cookies classes\nfor the tspecial field ?It looks like the ServerCookie value is the one from jakarta-servletapi (aka \nservlet-2.2), and simply hasn\'t been updated.After discussion on the tomcat-dev list, I\'m closing this as WONTFIX because \nit\'s a contrived use-case: the browser will never send a request with a space \ncharacter in it (it\'d be encoded as \%20, which is handled fine by Tomcat).Yes, but the problem is that TC will set a cookie based on the unencoded path,\nand the browser doesn\'t make the association between that and the URL (somehow).\nIn theory, we would need to URL encode the context path using straight conversion..It is fixed now, but the fix assumes UTF-8 encoding for URLs. I guess even if it\ndoesn\'t work always, it\'s better than it it never works.Forgot to mention: for really tricky situations (i18n ...), you can also choose\nto set the cookie path to \"/\" by using emptySessionPath=\"true\" on the Connector.',?,BUG
31098,'\'assert\' keyword missing from list of Java keywords','Tomcat 5',Jasper,petr.jiricka,dev,'Class org.apache.jasper.compiler.JspUtil has an algorithm that determined class\nnames of generated Java files, and that handles Java keywords specially (thanks\nto class variable javaKeywords). However, keyword \'assert\' is missing from this\nlist.Added \"assert\" and \"enum\" to the Java keyword list.',?,BUG
31110,'o.a.c.servlets.LocalStrings missing','Tomcat 5',Catalina,drzewo,dev,'During startup tomcat complains about missing resource:\norg.apache.catalina.servlets.LocalStrings\n\n2004-09-08 09:31:13 org.apache.coyote.http11.Http11Protocol init\nINFO: Initializing Coyote HTTP/1.1 on http-10080\n2004-09-08 09:31:13 org.apache.catalina.startup.Catalina load\nINFO: Initialization processed in 2375 ms\n2004-09-08 09:31:14 org.apache.catalina.core.StandardService start\nINFO: Starting service Catalina\n2004-09-08 09:31:14 org.apache.catalina.core.StandardEngine start\nINFO: Starting Servlet Engine: Apache Tomcat/5.5.1\n2004-09-08 09:31:14 org.apache.catalina.core.StandardHost start\nINFO: XML validation disabled\nCan\'t find resource org.apache.catalina.servlets.LocalStrings WebappClassLoader\n  delegate: false\n  repositories:\n----------> Parent Classloader:\norg.apache.catalina.loader.StandardClassLoader@80d1ff\n\n[Ljava.net.URL;@1955970\n2004-09-08 09:31:17 org.apache.coyote.http11.Http11Protocol start\nINFO: Starting Coyote HTTP/1.1 on http-10080\n2004-09-08 09:31:18 org.apache.jk.common.ChannelSocket init\nINFO: JK2: ajp13 listening on /0.0.0.0:10009\n2004-09-08 09:31:18 org.apache.jk.server.JkMain start\nINFO: Jk running ID=0 time=0/125 \nconfig=d:\\java\\eclipse-3.1-M1\\tomcat5.5\\conf\\jk2.properties\n2004-09-08 09:31:18 org.apache.catalina.startup.Catalina start\nINFO: Server startup in 4968 msBack in 5.0.28 times, o.a.c.servlets.LocalStrings.properties has been placed in\nservlets-common.jar, which seems to be gone right now. All other packages\ndefault LocalStrings properties are there (that is: in catalina.jar).\nservlets-common.jar IMHO should be back to hold those LocalStrings for\no.a.c.servlets same as naming-common.jar does for o.a.naming. But I still might\nbe wrong...',?,OTHER
31129,'updates/fix for jndi-datasource-examples-howto.html','Tomcat 5',Webapps:Documentation,atingley,dev,'jndi-datasource-examples-howto.html (an excellent reference, btw):\n\nSection 2:  Needs update for Tomcat 5.0.27:\nInstead of referring to $CATALINA_HOME/conf/server.xml for adding the\n\"/DBTest\" context path, the contents of this file should appear in a\n*new* $CATALINA_HOME/conf/Catalina/localhost/DBTest.xml file.\n\nSection 3:  Typo:\nExtraneous <web-app> tag following the verbose <web-app xmlns=...> tag.\nWill cause numerous cut-paste-induced errors starting up DBTest app!\nSolution is to remove the either of the <web-app> start tags.Putting it in server.xml is still valid, so I don\'t want to change the doc and \nconfuse users.  The 2nd point has already been addressed in CVS (it was \nreported as Bugzilla 30756).  Thanks though.',?,DOCUMENTATION
31132,missing,'Tomcat 5',Catalina,smore,dev,'There are certain shell tests that do not work properly on the 400\'s qshell. \nLike -x and -r.\n\nThese will only work if:\n   1. The user is the owner of the file\nor 2. The file\'s group ownership is by the user\'s PRIMARY group.\n\nIf the file\'s group ownership is in the user\'s secondary groups, the qshell \ntests will fail, even though it has authority to run/read it.\n\nI have been making changes like this:\n\n\n#!/bin/sh\n# -----------------------------------------------------------------------------\n# Start Script for the CATALINA Server\n#\n# $Id: startup.sh,v 1.3 2002/08/04 18:19:43 patrickl Exp $\n# -----------------------------------------------------------------------------\n\nos400=false\ncase \"`uname`\" in\nOS400*) os400=true;;\nesac\n\n\n# resolve links - $0 may be a softlink\nPRG=\"$0\"\n\nwhile [ -h \"$PRG\" ] ; do\n  ls=`ls -ld \"$PRG\"`\n  link=`expr \"$ls\" : \'.*-> \\(.*\\)$\'`\n  if expr \"$link\" : \'.*/.*\' > /dev/null; then\n    PRG=\"$link\"\n  else\n    PRG=`dirname \"$PRG\"`/\"$link\"\n  fi\ndone\n \nPRGDIR=`dirname \"$PRG\"`\nEXECUTABLE=catalina.sh\n\n# Check that target executable exists\nif $os400; then\n  # -x will Only work on the os400 if the files are: \n  # 1. owned by the user\n  # 2. owned by the PRIMARY group of the user\n  # this will not work if the user belongs in secondary groups\nelse\n  if [ ! -x \"$PRGDIR\"/\"$EXECUTABLE\" ]; then\n    echo \"Cannot find $PRGDIR/$EXECUTABLE\"\n    echo \"This file is needed to run this program\"\n    exit 1\n  fi\nfi\n\nexec \"$PRGDIR\"/\"$EXECUTABLE\" start \"$@\"Please attach your proposed changes in diff -u format, instead of the whole \nfile.  When you do that I\'ll be glad to look at them and commit them.  Thanks.Created attachment 13289\nPatch for startup.shCreated attachment 13290\nPatch for catalina.shCreated attachment 13291\nPatch for setclasspath.shOK, done for Tomcat 5.0.30 and 5.5.5.  Thanks for submitting this patch.',?,TEST
31171,'ClassCastException in org.apache.jasper.runtime.PageContextImpl.getException','Tomcat 5',Jasper,srevilak,dev,'I am writing to report a case where calling PageContextImpl.getException()\ncan result in a ClassCastException.  This occurred in tomcat 5.0.19,\nbut examination of tomcat 5.0.28\'s source code, the problem could\noccur there as well.\n\nIn my application, I have an jsp declared as an error page.  This\nerror page uses a tag to record some additional information.  The\nfirst few lines of this tag are as follows:\n\n    public void doTag() throws IOException, JspException\n    {\n\ttry {\n\n\t    PageContext context = (PageContext)getJspContext();\n\t    JspWriter out = context.getOut();\n            HttpServletRequest request = (HttpServletRequest) context.getRequest();\n            Throwable error = context.getException();\n            // proceed to log the exception and some of the\n            // surrounding contextual information\n\nIn one case, the `catch\' associated with this try caught a\nClassCastException from PageContextImpl.getException():\n\n  // line 608 in 5.0.19\'s PageContextImpl.java\n  // line 560 in 5.0.28\'s PageContextImpl.java\n  public Exception getException() { return (Exception)request.getAttribute(EXCEPTION); }\n\n\nThis would occur if the error was a result of a java.lang.Throwable.\n\n\nWhat possible paths might lead up to this?\n\nThe _jspService() generated by JspC typically terminates with\nsomething like the following:\n\n    } catch (Throwable t) {\n      if (!(t instanceof SkipPageException)){\n        out = _jspx_out;\n        if (out != null && out.getBufferSize() != 0)\n          out.clearBuffer();\n        if (pageContext != null) pageContext.handlePageException(t);\n      }\n    } finally {\n      if (_jspxFactory != null) _jspxFactory.releasePageContext(pageContext);\n    }\n\nIt\'s catching a Throwable.\n\nPageContextImpl.handlePageException() (lines 730 - 745 in version\n5.0.28) does this: \n\n\n   public void handlePageException(final Throwable t)\n        throws IOException, ServletException\n    {\n        if (t == null)\n            throw new NullPointerException(\"null Throwable\");\n\n        if (System.getSecurityManager() != null){\n            try{\n                AccessController.doPrivileged(new PrivilegedExceptionAction(){\n                    public Object run() throws Exception{\n                        doHandlePageException(t);\n                        return null;\n                    }\n                });\n\n\nIt\'s dealing with throwables.\n\nContinuing on to doHandlePageException(), (lines 763 - 786 in version\n5.0.28):\n\n    private void doHandlePageException(Throwable t)\n        throws IOException, ServletException {\n\n        if (errorPageURL != null && !errorPageURL.equals(\"\")) {\n\n            /*\n             * Set request attributes.\n             * Do not set the javax.servlet.error.exception attribute here\n             * (instead, set in the generated servlet code for the error page)\n             * in order to prevent the ErrorReportValve, which is invoked as\n             * part of forwarding the request to the error page, from\n             * throwing it if the response has not been committed (the response\n             * will have been committed if the error page is a JSP page).\n             */\n            request.setAttribute(\"javax.servlet.jsp.jspException\", t);\n            request.setAttribute(\"javax.servlet.error.status_code\",\n                new Integer(HttpServletResponse.SC_INTERNAL_SERVER_ERROR));\n            request.setAttribute(\"javax.servlet.error.request_uri\",\n            ((HttpServletRequest) request).getRequestURI());\n            request.setAttribute(\"javax.servlet.error.servlet_name\",\n                     config.getServletName());\n                try {\n                    forward(errorPageURL);\n\n\nIt\'s also dealing with Throwables.\n\n\nThe following two (short) jsp files reproduce the problem consistently.\n\n\n--------------- Page: foo.jsp -----------------------------------\n<\%@ page session=\"false\"\n         language=\"java\" \n         errorPage=\"/myerror.jsp\"\n\%>\n\n<html><body>hello world</body></html>\n<\%\n  if (1 + 1 == 2) {\n    throw new Throwable(\"The cake fell in the mud\");\n  }\n\%>\n------------------------------------------------------------------\n\n\n------------------- Page: myerror.jsp ----------------------------\n<!-- myerror.jsp -->\n<\%@ page session=\"false\"\n         language=\"java\"\n         isErrorPage=\"true\"\n         import=\"java.io.PrintWriter\"\n\%>\n\nAn error occurred:\n\n<pre>\n<\%\nout.println(pageContext.getException().toString());\n\n\%>\n</pre>\n------------------------------------------------------------------\n\n\nPerhaps getException() could take extra steps to ensure that the\nobject being returned is indeed an exception (and wrap it if it\'s\nnot).Good, interesting catch.  It seems like something simple in the PageContext \nimlpementation, like\n\nif(! (exception instanceof Exception)) {\n  exception = new JspException(exception);\n}\n\nwould be a good wrap.  It only wraps if needed, and the JspException \nconstructor takes a Throwable root cause, so I think we\'ll be all set.  I\'ll \nwait to see what more experienced Jasper developers (Kin-Man?) think of this.Yoav Shapira\'s suggestion (2004-09-15 18:14) seems like a reasonable way to handle this.  If my \nopinion matters :)Fixed for 5.0.29 and 5.5.3.',?,BUG
31185,'Tomcat service management GUI corrupts configuration','Tomcat 5',Native:Packaging,cowwoc,dev,'1) Start up tomcat5w.exe (service manager)\n2) Click on startup tab\n3) Notice that argument is \"start\" (or at least, it should be)\n4) Click on shutdown tab\n5) Notice that argument is \"stop\"\n6) Click OK\n7) Run tomcat5w.exe again\n8) Click on startup tab\n9) Notice that argument magically changed to \"stop\" (!!)\n10) The only way to bring the value back to \"start\" is to change the argument\nvalue to \"start\", click APPLY and then OK. Clicking OK alone seems to not save\nthe value to disk.\n\nSo there are two major problems here:\n\n1) Configuration values are being corrupted by the GUI (leads to hours of fun\ndebugging what the heck is going wrong)\n2) Clicking OK is not enough to save changes to disk. Apply is meant to be an\noptional button, not required.\n\nI consider this a major bug in the native packaging because it is very easy to\ncorrupt the configuration and then one spends hours trying to figure out what\nthe heck is going wrong with Tomcat. The logging output isn\'t very helpful either.Correction on bug #2 (clicking apply is required). Clicking OK works fine. Bug\n#1 still exists though.Fixed in the CVS.\nYou may try the binaries from CVS:\n\nhttp://cvs.apache.org/viewcvs.cgi/*checkout*/jakarta-tomcat-\nconnectors/procrun/bin/tomcat5w.exe?rev=1.2.2.2\n',?,BUG
31209,'Setting caseSensitive to false for FileDirContext seems to have no effect','Tomcat 5',Catalina,paul,dev,'For some time I have used the following Context Element for webapps to disable\ncase sensitivity in resource names.\n\n<Context path=\"/iCom\" docBase=\"../webapps/iCom\" debug=\"0\">\n  <Resources\n    className=\"org.apache.naming.resources.FileDirContext\" caseSensitive=\"false\" />\n</Context>\n\nThis worked fine in early releases of Tomcat 5 (e.g. Tomcat 5.0.12) but at some\npoint it stopped working (by Tomcat 5.0.19 it was no longer working, and is\nstill not working in 5.0.28).  I\'ve checked the documentation for 5.0.28 and so\nfar as I can see the above should still work fine.I figured out that by changing the Context element\n<Context path=\"/iCom\" docBase=\"iCom\" debug=\"0\" caseSensitive=\"false\" />\n\nI managed to turn off case sensitivity again.\n\nSorry to bother you.',?,OTHER
31257,'java.endorsed.dirs is not used when JSP compilation is forked','Tomcat 5',Jasper,james_defelice,dev,'When the JSP compiler forks a javac process, it should check to see what the \ncurrently endorsed directories are (check the system \nproperty \"java.endorsed.dirs\" - otherwise, classes end up missing and JSP \npages do not properly compile.  We experienced a problem when we explicitly \nset the java.endorsed.dirs property on the command line, and the JSP compiler \ndid not use it when javac was forked.\n\nI have patched org.apache.jasper.compiler.Compiler to support this:\n*** src.original\\jakarta-tomcat-jasper\\jasper2\n\\src\\share\\org\\apache\\jasper\\compiler\\Compiler.java       Tue Jun 15 17:30:35 \n2004\n--- src\\org\\apache\\jasper\\compiler\\Compiler.java        Thu Sep 16 00:05:14 \n2004\n\n***************\n*** 349,358 ****\n--- 349,369 ----\n              extdirs.setPath(exts);\n              javac.setExtdirs(extdirs);\n              info.append(\"    extension dir=\" + exts + \"\\n\");\n          }\n\n+         // Add endorsed directories\n+         String endorsed = System.getProperty(\"java.endorsed.dirs\");\n+         if(endorsed != null) {\n+             Javac.ImplementationSpecificArgument endorsedArg = \njavac.createCompilerArg();\n+             endorsedArg.setLine(\"-J-Djava.endorsed.dirs=\"+endorsed);\n+             info.append(\"    endorsed dir=\" + endorsed + \"\\n\");\n+         }\n+         else {\n+             info.append(\"    no endorsed dirs specified\\n\");\n+         }\n+\n          // Configure the compiler object\n          javac.setEncoding(javaEncoding);\n          javac.setClasspath(path);\n          javac.setDebug(ctxt.getOptions().getClassDebugInfo());\n\ntrue, i should probably check ctxt.getOptions().getFork() in the if() as well, \nbut since i always fork it doesn\'t matter to me.Thanks for submitting this enhancement.  I\'ve applied it to both the Tomcat 5.0 \nand 5.5 branches: it will be in 5.0.29 and 5.5.3.  However, this applies to the \nAnt/Javac compiler only, not to the JDT compiler, which is the default in \n5.5.3.  If you have an equivalent patch for the JDT compiler, please submit \nit.  Otherwise, I\'ll do some research to try to find the equivalent JDT \ncompiler option, but if you submit a patch it\'ll get done faster.There is still a bug in this fixing.\nWhen the endorsed dir is like:\n   C:\\Program Files\\Java\\jdk1.5.0_11\\jre\\lib\\endorsed\nthe space char in dir will cause a compile error. \"Files\\Java\\jdk1.5.0_11\n\\jre\\lib\\endorsed\" part will be treated as a new parameter of javac. Please use \nquotation marks to quotate each dir in the endorsed dir list.The quoting issue has been fixed in trunk and proposed for 5.5.x and 6.0.xThis has been committed to 6.0.x and will be in 6.0.17 onwards.This has been fixed in 5.5.x and will be included in 5.5.27 onwards.',?,BUG
31277,'Applciation deployed twice after restart if path doesn\'t match war filename','Tomcat 5',Webapps:Documentation,peter.edwards,dev,'If you upload a war file using the HTML manager interface it places the war \nfile in the webapps directory. It also extracts the context.xml file and places \nthis in conf/Catalina/localhost using the war file to generate the new \nfilename. So if the war file is called MyApp.war, the context file is \nMyApp.xml. So far, so good.\n\nIf the context file declares the path to be \"/myapp\" the application is \ndeployed in the context /myapp.\n\nNow, if you restart the server you get two instances of your application. One \nbecause of the MyApp.war file in webapps - this is deployed as /MyApp. The \nsecond is due to the context file (MyApp.xml) but this deploys as /myapp.\n\nI don\'t know what the correct behaviour should be but the restriction is that \nyour path must be the same as the war filename.Turn off autoDeploy and this won\'t happen.  It\'s not a Tomcat bug, merely a \nconfiguration issue.I did have the flag autoDeploy set to false but your comment pointed me in the \nright direction. The flag that needs turning off is in fact deployOnStartup. So \nthe host element needs to be:\n<Host name=\"localhost\" debug=\"0\" appBase=\"webapps\" unpackWARs=\"false\" \nautoDeploy=\"false\" deployOnStartup=\"false\">\n\nI think there is still an issue around the documentation. The help on Automatic \nApplication Deployment is misleading (http://jakarta.apache.org/tomcat/tomcat-\n5.0-doc/config/host.html#Automatic\%20Application\%20Deployment).\n\n1. I think the first action happens even when deployOnStartup is false - I \ndidn\'t try this attribute because I thought it would stop things deploying on \nstartup but it doesn\'t. Actually it solves the problem I was having by only \ndeploying things from context files in \n$CATALINA_HOME/conf/[engine_name]/[host_name], but doesn\'t deploy things from \nappBase.\n2. Should the second action read \"Any web application archive file <ins>within \nthe application base directory</ins> that does not have a corresponding \ndirectory of the same name...\"\n3. The paragraph starting \"In addition to the automatic deployment\" doesn\'t \nmention the attribute \"autoDeploy\" but I think this is what it is referring to.\n4. The last paragraph starting \"When using automatic deployment,\" doesn\'t \nreflect the fact that if you upload a war file, the docBase attribute is \nignored and the file goes in the appBase directory. Hence you get double \ndeployment on restart unless you disable deployOnStartup\n\nI accept that this was in fact a configuration issue but hopefully the \ndocumentation can be made clearer.\n\nThanksOK, doc clarified (for 5.0.29 and 5.5.3).',?,DOCUMENTATION
31288,'MailSessionFactory should allow authentication to be configured','Tomcat 5',Catalina,joe,dev,'Looking for a way to configure a JNDI JavaMail session, I ran into\n<http://www.mail-archive.com/tomcat-dev@jakarta.apache.org/msg43073.html>. It\nlooks like the only way to do this is through manually opening the transport in\ncode; there should be a way to configure an authenticated session through\nserver.xml and the MailSessionFactory.Created attachment 12769\nPatch to add a \'password\' property to MailSessionFactory initialisation.Changing components for Tomcat 5.5.Done for 5.5.9.  Thanks for submitting this patch.',?,RFE
31339,'admin app throwing struts exceptions','Tomcat 5',Webapps:Administration,blake,dev,'when a service is clicked on in the left navigaiton frame:\nHTTP Status 500 - \n\n--------------------------------------------------------------------------------\n\ntype Exception report\n\nmessage \n\ndescription The server encountered an internal error () that prevented it from \nfulfilling this request.\n\nexception \n\njavax.servlet.ServletException: Define tag cannot set a null value\n\torg.apache.jasper.runtime.PageContextImpl.doHandlePageException\n(PageContextImpl.java:825)\n\torg.apache.jasper.runtime.PageContextImpl.handlePageException\n(PageContextImpl.java:758)\n\tadmin.service.service_jsp._jspService(service_jsp.java:864)\n\torg.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:94)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\torg.apache.struts.action.RequestProcessor.doForward\n(RequestProcessor.java:1069)\n\torg.apache.struts.action.RequestProcessor.processForwardConfig\n(RequestProcessor.java:455)\n\torg.apache.struts.action.RequestProcessor.process\n(RequestProcessor.java:279)\n\torg.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)\n\torg.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:689)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\n\nroot cause \n\njavax.servlet.jsp.JspException: Define tag cannot set a null value\n\torg.apache.struts.taglib.bean.DefineTag.doEndTag(DefineTag.java:272)\n\tadmin.service.service_jsp._jspService(service_jsp.java:253)\n\torg.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:94)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\torg.apache.struts.action.RequestProcessor.doForward\n(RequestProcessor.java:1069)\n\torg.apache.struts.action.RequestProcessor.processForwardConfig\n(RequestProcessor.java:455)\n\torg.apache.struts.action.RequestProcessor.process\n(RequestProcessor.java:279)\n\torg.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)\n\torg.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:689)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\n\nnote The full stack trace of the root cause is available in the Apache \nTomcat/5.0 logs.\n\n\n--------------------------------------------------------------------------------\n\nApache Tomcat/5.0\n\n************************************************************\n************************************************************\n************************************************************\n\nwhen a host is clicked on on the left navigation frame:\n\nHTTP Status 500 - \n\n--------------------------------------------------------------------------------\n\ntype Exception report\n\nmessage \n\ndescription The server encountered an internal error () that prevented it from \nfulfilling this request.\n\nexception \n\njava.lang.NullPointerException\n\torg.apache.struts.taglib.logic.CompareTagBase.condition\n(CompareTagBase.java:179)\n\torg.apache.struts.taglib.logic.NotEqualTag.condition\n(NotEqualTag.java:90)\n\torg.apache.struts.taglib.logic.ConditionalTagBase.doStartTag\n(ConditionalTagBase.java:218)\n\tadmin.host.host_jsp._jspService(host_jsp.java:450)\n\torg.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:94)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\torg.apache.struts.action.RequestProcessor.doForward\n(RequestProcessor.java:1069)\n\torg.apache.struts.action.RequestProcessor.processForwardConfig\n(RequestProcessor.java:455)\n\torg.apache.struts.action.RequestProcessor.process\n(RequestProcessor.java:279)\n\torg.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)\n\torg.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:689)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\n\nnote The full stack trace of the root cause is available in the Apache \nTomcat/5.0 logs.\n\n\n--------------------------------------------------------------------------------\n\nApache Tomcat/5.0This is a bit mysterious, as neither host.jsp nor the \nEdit/Add/SaveHostAction.java files have changed in more than six months.  I\'ll \nhave to dig a bit deeper it seems ;)You must have some weird configuration error, because it works for me.  I\'m \nunable to reproduce your issue.\n\nHere are the steps I took and other details:\n- Download jakarta-tomcat-5.0.28.zip from the Jakarta binaries download page, \nunzip to c:\\ (I\'m running Windows XP SP2, Sun JDK 1.4.2_04).\n- Edit conf/tomcat-users.xml to add an admin user, startup the server using \nstatup.bat.\n- Go to the Administration link, login to the admin webapp, click around \nserver, service, host (in fact I clicked on every link I could find, all \nworked).\n- I even add a brand new host, saved, committed changed, then deleted, no \nproblem.  Same with adding a service.\n\nI suggest you use the tomcat-user mailing list to ask for help if you do a \nclean installation and still get this issue.Created attachment 17533\nuse the domain parameter instead of TomcatTreeBuilder.DEFAULT_DOMAIN\n\nthis bug is caused by the following method in \norg.apache.webapp.admin.Lists.java class\n\nThe method is : \n\npublic static String getAdminAppService (MBeanServer mbserver, String domain,\nHttpServletRequest\nrequest)\n\tthrows Exception {\n\n\tString adminDomain = TomcatTreeBuilder.DEFAULT_DOMAIN;\n\t// Get the admin app\'s service name\n\tStringBuffer sb = new StringBuffer(adminDomain);\n\tsb.append(\":type=Service,*\");\n\tObjectName search = new ObjectName(sb.toString());\n\t // other parts\n\treturn service;\n\n    }\n\nas you can see it always uses the TomcatTreeBuilder.DEFAULT_DOMAIN to find the\nservice. but this value is hard coded as \"Catalina\"\n\nso if someone rename the Engine name(defuaul Catalina) in server.xml it causes\nthis error.\n\nsome we have to use the domain paramenter as follows\n StringBuffer sb = new StringBuffer(domain);Blake, does Amila\'s patch fix your issue?\n\nThe relevant code is still intact in the 5.5 branch as of 5.5.16, so this is not\njust a 5.0 issue.This has been fixed in 5.5.x and will be included in 5.5.19 onwards.\n\nThanks for the report and the patch.',?,BUG
31356,'Duplicate sessions counter not incremented in ManagerBase','Tomcat 5',Catalina,mike,dev,'The incrementing of this counter was lost during a refactor from version\n1.29 to 1.30 of ManagerBase. The attached patch adds in back again\nin the code to detect duplicate session ids in generateSessionId().Created attachment 12828\ndiff to fix problemOK, I\'ve applied your patch, fixing this item for now.  As Remy said, the whole \nduplicates counting and tracking may be removed in a future release.',?,BUG
31362,'Start Catalina under JPDA debugger with \"-security\" option fails','Tomcat 5',Catalina,sherold,dev,'Starting Catalina under JPDA debugger with \"-security\" option fails. You will\nget following error message:\n\nError occurred during initialization of VM\n-Xrun library failed to init: jdwp\nJDWP unable to access JVMDI Version 1.\nMaybe you need to start the VM with the -Xdebug option\n\nThis is a windows jdk1.4 specific bug. It can be fixed by modifying the\nbin/catalina.bat startup script like this:\n\n- \%_EXECJAVA\% \%JAVA_OPTS\% \%CATALINA_OPTS\%\n-Xrunjdwp:transport=\%JPDA_TRANSPORT\%,address=\%JPDA_ADDRESS\%,server=y,suspend=n\n\%DEBUG_OPTS\%\n+ \%_EXECJAVA\% \%JAVA_OPTS\% \%CATALINA_OPTS\% -Xdebug\n-Xrunjdwp:transport=\%JPDA_TRANSPORT\%,address=\%JPDA_ADDRESS\%,server=y,suspend=n\n\%DEBUG_OPTS\%OK, fixed.  Thanks for pointing it out ;)',?,BUG
31364,'Missing resource in org/apache/catalina/core/LocalStrings.properties','Tomcat 5',Catalina,yoavs,dev,'... causes problems with webapp reload.  The missing resource is keyed \nstandardContext.stoppingContext.Original mailing list post reporting error:\n\nHi Guys,\n\nVersion: 5.0.28\n\nScenario:\n\nOne of our web applications has context reload=\"true\" set so that we can deploy \nsingle class patches (side question: is there a better way of hot-deploying \nsingle-class patching?)\n\nHowever, every time we copy the new class over the existing class, Tomcat \nbegins to reload but throws the following exception stack trace about 6 times \nin a row (in stdout) and the UI presents error 503 application unavailable on \nrequests. \n\nTomcat never recovers from this and we have to restart the service.\n\nINFO: Reloading this Context has started\n22-Sep-2004 10:02:25 org.apache.catalina.core.StandardContext reload\nSEVERE: Cannot find message associated with key standardContext.stoppingContext\nLifecycleException:  Manager has not yet been started\n\tat org.apache.catalina.session.StandardManager.stop\n(StandardManager.java:680)\n\tat org.apache.catalina.core.StandardContext.stop\n(StandardContext.java:4474)\n\tat org.apache.catalina.core.StandardContext.reload\n(StandardContext.java:3015)\n\tat org.apache.catalina.core.StandardContext.backgroundProcess\n(StandardContext.java:4629)\n\tat \norg.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChild\nren(ContainerBase.java:1619)\n\tat \norg.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChild\nren(ContainerBase.java:1628)\n\tat \norg.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChild\nren(ContainerBase.java:1628)\n\tat \norg.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run\n(ContainerBase.java:1608)\n\tat java.lang.Thread.run(Unknown Source)\n22-Sep-2004 10:02:25 org.apache.catalina.core.StandardContext start\nINFO: Container StandardContext[] has already been started\n22-Sep-2004 10:02:36 org.apache.catalina.core.StandardContext reload\n\nKind regards, Allistair.\n\n\n<FONT SIZE=1 FACE=\"VERDANA,ARIAL\" COLOR=BLUE> \n-------------------------------------------------------\nQAS Ltd.\nDevelopers of QuickAddress Software\n<a href=\"http://www.qas.com\">www.qas.com</a>\nRegistered in England: No 2582055\nRegistered in Australia: No 082 851 474\n-------------------------------------------------------\n</FONT>\n\n\n---------------------------------------------------------------------\nTo unsubscribe, e-mail: tomcat-user-unsubscribe@jakarta.apache.org\nFor additional commands, e-mail: tomcat-user-help@jakarta.apache.orgFixed for both Tomcat 5.0 and 5.5.Hi, I still get this in 5.0.28, even though the bugzilla settings show it as \nclosed for 5.0.28.\n\nTomcat Manager shows:\nFAIL - Application at context path / could not be started\n\nVersions:\nApache Tomcat/5.0.28 1.4.2_04-b05 Sun Microsystems Inc. Windows 2003 5.2 x86 \n\nStack Trace:\nDec 6, 2006 11:55:28 PM org.apache.catalina.core.StandardContext reload\nSEVERE: Cannot find message associated with key standardContext.stoppingContext\nLifecycleException:  Manager has not yet been started\n        at org.apache.catalina.session.StandardManager.stop\n(StandardManager.java:680)\n        at org.apache.catalina.core.StandardContext.stop\n(StandardContext.java:4496)\n        at org.apache.catalina.core.StandardContext.reload\n(StandardContext.java:3037)\n        at org.apache.catalina.startup.HostConfig.restartContext\n(HostConfig.java:873)\n        at org.apache.catalina.startup.HostConfig.checkContextLastModified\n(HostConfig.java:759)\n        at org.apache.catalina.startup.HostConfig.check(HostConfig.java:1085)\n        at org.apache.catalina.startup.HostConfig.lifecycleEvent\n(HostConfig.java:327)\n        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent\n(LifecycleSupport.java:119)\n        at org.apache.catalina.core.StandardHost.backgroundProcess\n(StandardHost.java:800)\nThis is expected. We don\'t patch previous releases to fix bugs. Fixes are\nincluded in the next release after the fix was made. Where a release has not\nbeen made since the fix, you can obtain the latest code from SVN which will\ninclude the fix.',?,BUG
31436,'missing \% before and after CURRENT_DIR in startup.bat','Tomcat 5',Catalina,pander,dev,'missing \% before and after CURRENT_DIR in startup.bat\n\nsee line 16\nchange from\ncd CURRENT_DIR\nto\ncd \%CURRENT_DIR\%Fixed four months ago.  Update your Tomcat version.',?,BUG
31447,'Contribution: system daemon script for GNU/Linux','Tomcat 5',Catalina,pander,dev,'Here is a contribution of a system daemon script for GNU/Linux to mangege \nstarting and stopping of Tomcat. It has been developed and tested on RedHat \nEnterprise Server 3 but had been made with other distributions in mind. RedHat \n(and probably also for Mandrake) specfied code (/etc/rc.d/init.d/functions) is \nonly activated when available.\n\nIt would be very nice to ship Tomcat with a out of the box worknig system \ndeamon script for Linux.\n\n#!/bin/bash\n#\n# Startup script for the Tomcat Servlet Container\n#\n# chkconfig: - 86 14\n# description: Tomcat is the servlet container that is used in the official \\\n#              Reference Implementation for the Java Servlet and JavaServer \\\n#              Pages technologies\n \n# Source function library.\nif [ -x /etc/rc.d/init.d/functions ]; then\n\t. /etc/rc.d/init.d/functions\nelse\n\techo_success() {\n\t\techo -n \"[  OK  ]\"\n\t\techo -ne \"\\r\"\n\t\treturn 0\n\t}\n\techo_failure() {\n\t\techo -n \"[FAILED]\"\n\t\techo -ne \"\\r\"\n\t\treturn 1\n\t}\nfi\nprog=tomcat\nTOMCAT_HOME=/opt/tomcat\n\nstart() {\n\techo -n $\"Starting $prog: \"\n\tsu - root -c $TOMCAT_HOME/bin/startup.sh > /dev/null\n\tRETVAL=$?\n\tif [ $RETVAL -eq 0 ]; then\n\t\techo_success\n\telse\n\t\techo_failure\n\tfi\n\techo\n\t[ $RETVAL = 0 ] && touch /var/lock/subsys/$prog\n\treturn $RETVAL\n}\nstop() {\n\techo -n $\"Stopping $prog: \"\n\tsu - root -c $TOMCAT_HOME/bin/shutdown.sh > /dev/null\n\tRETVAL=$?\n\tif [ $RETVAL -eq 0 ]; then\n\t\techo_success\n\telse\n\t\techo_failure\n\tfi\n\techo\n\t[ $RETVAL = 0 ] && rm -f /var/lock/subsys/$prog\n\treturn $RETVAL\n}\n\n# See how we were called.\ncase \"$1\" in\n  start)\n\tstart\n\t;;\n  stop)\n\tstop\n\t;;\n  restart)\n\tstop\n\tstart\n\t;;\n  status)\n\tINSTANCES=`ps --columns 512 -aef|grep java|grep tomcat|grep \norg.apache.catalina.startup.Bootstrap|wc -l`\n\tif [ $INSTANCES -eq 0 ]; then\t\n\t\techo $prog is stopped\n\t\tREVAL=3\n\telse\n\t\tif [ $INSTANCES -eq 1 ]; then\t\n\t\t\techo $prog is running 1 instance...\n\t\telse\n\t\t\techo $prog is running $INSTANCES instances...\n\t\tfi\n\t\tREVAL=0\n\tfi\n\t;;\n  *)\n\techo $\"Usage: $prog {start|stop|restart|status|help}\"\n\texit 1\nesac\n\nexit $RETVALI wonder what the proper CVS location for this is.  jakarta-tomcat-\ncatalina/catalina/src/bin might be the place, but I\'m thinking we might need a \nnew contrib directory for some other OS-specific scripts we\'re getting via the \nmailing list.OK, added for Tomcat 5.0.30.  See bin/contrib directory.  Thanks for submitting \nthis.',?,RFE
31465,'JSP encoding is wrong','Tomcat 5',Jasper,David.Holscher,dev,'I have the following text in a JSP with no encoding declared:\n\nCopyright © 2003 by \n\nThe copyright symbol does not come out correctly. I checked the file and the \nstored character code is 0xA9 which is correct for ISO-8859-1. I checked the \nJSP 2.0 spec and the default encoding is still supposed to be ISO-8859-1. Yet \nthe result is\n\nCopyright Â© 2003 by\n\nThis can be easily reproduced by creating an empty web application and putting \njust Copyright © 2003 by into a jsp file.\n\nLooking at the generated Java file I see\n\n      out.write(\"Copyright Â© 2003 by\\r\\n\");The reason for the seemly extra character in out.write() is that the java file\nJasper generated is defaulted to utf8 encoding (0xa9 is 0xc2a9 in utf8). \nHowever, you cannot just set the Jasper option javaEncoding to ISO-5589-1,\nbecause you\'ll then also need to set a javac option to use the same encoding,\nand  currently you cannot change the javac source encoding.\n\nLooks like the only way for this to work is to use urt8 for both the page and\nthe response.  :(On second thought, what I said wasn\'t entirely correct.  :(\n\nJasper is still correct to output the bytes 0xc2a9 because of the difference in\nencoding.  However, druing javac compilation, these bytes should be translated\nback to the original 0xa9, and everything should be OK.  The problem seems to be\nin the JDT compiler, or its setup codes.\n\nAs a work around, use ant compilation to use JDK 1.4 javac. I have a fix for this that I will commit very shortly. I came across whilst \nlooking at another bug.Patch committed and verified.',?,BUG
31495,'Context reload causes ClusterManager to stop operating','Tomcat 5',Catalina:Cluster,bhobbs,dev,'A functioning clustered application works fine when the tomcat server is\ninitially started.  Sessions are replicated, etc.\n\nAs soon as the context is reloaded on one server, the sessions are no longer\nreplicated between servers.  A full tomcat restart is required to restore this\nfunctionality.\n\nThe application and configuration are known to be functional, and the problem\ndoes not occur on 5.0.25.  The problem only occurs on our 5.0.28 installation. \nWe have downgraded our installation to verify this, and the same functionality\nthat does not work properly on 5.0.28 does in fact work on 5.0.25.\n\nThere is a thread with the subject of \"Clustering and session replication\" in\nthe tomcat-users mailing list, starting on 9/29/2004.\n\nAll relevant output is below:\n--Host \"A\" catalina.out from context reload--\nSep 29, 2004 3:47:26 PM org.apache.catalina.cluster.session.DeltaManager\nstart\nWARNING: Manager[/nahrgisdev], requesting session state from\norg.apache.catalina.cluster.mcast.McastMember[tcp://10.0.0.2:4001,\n10.0.0.2,4001, alive=253140]. This operation will timeout if no\nsession state has been received within 60 seconds\nSep 29, 2004 3:48:26 PM org.apache.catalina.cluster.session.DeltaManager\nstart\nSEVERE: Manager[/nahrgisdev], No session state received, timing out.\n\n--Host \"B\" catalina.out from context reload--\nSep 29, 2004 3:50:16 PM org.apache.catalina.cluster.session.DeltaManager start\nWARNING: Manager[/nahrgisdev], requesting session state from\norg.apache.catalina.cluster.mcast.McastMember[tcp://10.0.0.1:4001,10.0.0.1,4001,\nalive=681060]. This operation will timeout if no session state has been received\nwithin 60 seconds\nSep 29, 2004 3:50:16 AM org.apache.catalina.cluster.session.DeltaManager start\nINFO: Manager[/nahrgisdev], session state received in 109 ms.Fixed, the container reuses the Manager instead of creating a new one upon \ncontext reload, and the DeltaManager wasn\'t readding itself to the cluster \nupon restart.',?,BUG